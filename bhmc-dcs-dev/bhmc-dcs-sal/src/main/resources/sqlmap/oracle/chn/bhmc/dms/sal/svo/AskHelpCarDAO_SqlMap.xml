<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="chn.bhmc.dms.sal.svo.service.dao.AskHelpCarDAO">

    <!-- 목록 갯수  -->
    <select id="selectAskHelpCarsByConditionCnt" parameterType="AskHelpCarSearchVO" resultType="int">
        SELECT COUNT(*)
          FROM SA_0424T A                   /* 특수차판매신청 HEADER */
          LEFT OUTER JOIN (
                      SELECT DLR_CD
                           , USR_ID
                           , REQ_NO
                           , SUM(SPC_CAR_QTY) AS SPC_CAR_QTY          -- 수량 합계
                        FROM SA_0422T
                        GROUP BY  DLR_CD, USR_ID, REQ_NO
                      ) B                   /* 특수차판매신청 DETAIL */
             ON A.DLR_CD = B.DLR_CD
            AND A.USR_ID = B.USR_ID
            AND A.REQ_NO = B.REQ_NO
           LEFT OUTER JOIN ( SELECT DLR_CD
                             , USR_ID
                             , REQ_NO
                             , MAX(EVAL_DT) AS EVAL_DT        -- 심사일자
                          FROM SA_0423T
                           GROUP BY DLR_CD, USR_ID, REQ_NO
                      ) C
             ON A.DLR_CD = C.DLR_CD
            AND A.USR_ID = C.USR_ID
            AND A.REQ_NO = C.REQ_NO
          WHERE A.TP_CD != 'N7'
            AND A.DEL_YN != 'Y'
         <if test='sDlrCd != null and sDlrCd != ""'>
           AND A.DLR_CD = #{sDlrCd}              -- 딜러코드
         </if>
         <if test='sApproveCd != null and sApproveCd != ""'>
           AND A.APPROVE_CD = #{sApproveCd}  -- 상태
         </if>
         <if test='sTpCd != null and sTpCd != ""'>
           AND A.TP_CD = #{sTpCd}            -- 차량유형
         </if>
         <if test='sStartReqDt != null'>
           AND A.REQ_DT <![CDATA[>=]]> TRUNC(#{sStartReqDt},'DD')
         </if>
         <if test='sEndReqDt != null'>
           AND A.REQ_DT <![CDATA[<]]> TRUNC(#{sEndReqDt},'DD')+1
         </if>
    </select>

    <!-- 조회 목록  -->
    <select id="selectAskHelpCarsByCondition" parameterType="AskHelpCarSearchVO" resultType="AskHelpCarVO">
        SELECT * FROM
        ( SELECT ROWNUM AS RNUM, T1.* FROM
               (
                SELECT A.DLR_CD
                     , (SELECT DLR_NM FROM CM_0101T WHERE DLR_CD = A.DLR_CD) AS DLR_NM
                     , A.USR_ID
                     , (SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.USR_ID) AS USR_NM
                     , A.REQ_NO
                     , A.REQ_CAR_NO
                     , A.REQ_DT
                     , A.EVAL_GRADE_CD
                     , A.SALE_PRSN_NM
                     , A.SALE_PRSN_TEL_NO
                     , A.TP_CD
                     , A.REQ_TP
                     , A.UPLOAD_SEQ_RENEWAL
                     , A.UPLOAD_SEQ
                     , A.REMARK
                     , A.APPROVE_CD
                     , A.APPROVE_END_DT
                     , A.LAST_APPROVE_CNT
                     , A.LAST_APPROVE_DT
                     , A.DEL_YN
                     , A.FSDM_AGR_YN
                     , A.FSMD_AGR_DT
                     , A.REG_USR_ID
                     , A.REG_DT
                     , A.UPDT_USR_ID
                     , A.UPDT_DT
                     , B.SPC_CAR_QTY
                     , A.FILE_NM
                     , A.FILE_DOC_NO
                     , A.FILE_NO
                     , A.FILE_UPLOAD_DT
                     , C.EVAL_DT
                     , A.POLICY_NOTICE  AS POLICY_CONT
                  FROM SA_0424T A                   /* 특수차판매신청 HEADER */
                  LEFT OUTER JOIN (
                              SELECT DLR_CD
                                   , USR_ID
                                   , REQ_NO
                                   , SUM(SPC_CAR_QTY) AS SPC_CAR_QTY          -- 수량 합계
                                FROM SA_0422T
                                GROUP BY  DLR_CD, USR_ID, REQ_NO
                              ) B                  /* 특수차판매신청 DETAIL */
                     ON A.DLR_CD = B.DLR_CD
                    AND A.USR_ID = B.USR_ID
                    AND A.REQ_NO = B.REQ_NO
                   LEFT OUTER JOIN ( SELECT DLR_CD
                                     , USR_ID
                                     , REQ_NO
                                     , MAX(EVAL_DT) AS EVAL_DT        -- 심사일자
                                  FROM SA_0423T
                                   GROUP BY DLR_CD, USR_ID, REQ_NO
                              ) C
                     ON A.DLR_CD = C.DLR_CD
                    AND A.USR_ID = C.USR_ID
                    AND A.REQ_NO = C.REQ_NO
                  WHERE A.TP_CD != 'N7'
                    AND A.DEL_YN != 'Y'
                 <if test='sDlrCd != null and sDlrCd != ""'>
                   AND A.DLR_CD = #{sDlrCd}              -- 딜러코드
                 </if>
                 <if test='sApproveCd != null and sApproveCd != ""'>
                   AND A.APPROVE_CD = #{sApproveCd}  -- 상태
                 </if>
                 <if test='sTpCd != null and sTpCd != ""'>
                   AND A.TP_CD = #{sTpCd}            -- 차량유형
                 </if>
                 <if test='sStartReqDt != null' >
                   AND A.REQ_DT <![CDATA[>=]]> TRUNC(#{sStartReqDt},'DD')
                 </if>
                 <if test='sEndReqDt != null' >
                   AND A.REQ_DT <![CDATA[<]]> TRUNC(#{sEndReqDt},'DD')+1
                 </if>
                 ORDER BY
                 <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "salePrsnNm"'>A.SALE_PRSN_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "salePrsnTelNo"'>A.SALE_PRSN_TEL_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "reqTp"'>A.REQ_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "reqDt"'>A.REQ_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "evalDt"'>C.EVAL_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "spcCarQty"'>B.SPC_CAR_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "approveYn"'>A.APPROVE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                    A.REQ_DT ASC
                                </otherwise>
                            </choose>
                         </foreach>
                    </when>
                    <otherwise>
                            A.REQ_DT ASC
                    </otherwise>
                </choose>
                ) T1
                <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
                </where>
         )
         <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 구원차/대부차 상세 조회  -->
    <select id="selectAskHelpCarPopupContainsByConditionCnt" parameterType="AskHelpCarSearchVO" resultType="int">
        SELECT COUNT(*)
          FROM SA_0424T A
        WHERE A.DLR_CD = #{sDlrCd}
          AND A.USR_ID = #{sUsrId}
          AND A.REQ_NO = #{sReqNo}
    </select>

    <select id="selectAskHelpCarPopupContainsByCondition" parameterType="AskHelpCarSearchVO" resultType="AskHelpCarVO">
        SELECT A.DLR_CD
             , (SELECT DLR_NM FROM CM_0101T WHERE DLR_CD = A.DLR_CD) AS DLR_NM
             , A.USR_ID
             , (SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.USR_ID) AS USR_NM
             , A.REQ_NO
             , A.REQ_DT
             , A.EVAL_GRADE_CD
             , A.SALE_PRSN_NM
             , A.SALE_PRSN_TEL_NO
             , A.TP_CD
             , A.REQ_TP
             , A.UPLOAD_SEQ_RENEWAL
             , A.UPLOAD_SEQ
             , A.REMARK
             , A.APPROVE_CD
             , A.APPROVE_END_DT
             , A.LAST_APPROVE_CNT
             , A.LAST_APPROVE_DT
             , A.DEL_YN
             , A.FSDM_AGR_YN
             , A.FSMD_AGR_DT
             , A.FILE_NM
             , A.FILE_DOC_NO
             , A.FILE_NO
             , A.FILE_UPLOAD_DT
             , A.REG_USR_ID
             , A.REG_DT
             , A.UPDT_USR_ID
             , A.UPDT_DT
             , A.POLICY_NOTICE AS POLICY_CONT
          FROM SA_0424T A
        WHERE A.DLR_CD = #{sDlrCd}
          AND A.USR_ID = #{sUsrId}
          AND A.REQ_NO = #{sReqNo}
    </select>


    <!-- 구원차/대부차신청 팝업 차량유형 설명조회 -->
    <select id="selectAskHelpCarPopupContsByConditionCnt" parameterType="AskHelpCarSearchVO" resultType="int">
    SELECT COUNT(*)
      FROM SA_0171T
     WHERE 1 = 1
     <if test='sTpCd != null and sTpCd != ""' >
       AND POLICY_TP = #{sTpCd}
     </if>
    </select>

    <select id="selectAskHelpCarPopupContsByCondition" parameterType="AskHelpCarSearchVO" resultType="AskHelpCarPopupCarVO">
        SELECT POLICY_CONT
          FROM SA_0171T
         WHERE 1 = 1
         <if test='sTpCd != null and sTpCd != ""' >
           AND POLICY_TP = #{sTpCd}
         </if>
    </select>

    <!-- 구원차/대부차량신청 차량내역 조회 -->
    <select id="selectAskHelpCarPopupCarsByConditionCnt" parameterType="AskHelpCarSearchVO" resultType="int">
        SELECT COUNT(*)
         FROM SA_0422T     --특수차판매신청명세
        where DLR_CD = #{sDlrCd}
          and USR_ID = #{sUsrId}
          and REQ_NO = #{sReqNo}
    </select>

    <select id="selectAskHelpCarPopupCarsByCondition" parameterType="AskHelpCarSearchVO" resultType="AskHelpCarPopupCarVO">
        SELECT A.DLR_CD              --딜러코드
             , (SELECT DLR_NM FROM CM_0101T WHERE DLR_CD = A.DLR_CD) AS DLR_NM
             , A.USR_ID              --사용자ID
             , (SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.USR_ID) AS USR_NM
             , A.REQ_NO              --요청번호
             , A.REQ_SEQ             --요청일련번호
             , A.CARLINE_CD          --차종코드
             , FN_GET_CARLINE_NM(A.CARLINE_CD) AS CARLINE_NM
             , A.MODEL_CD            --모델코드
             , FN_GET_MODEL_TP_CD(A.MODEL_CD, A.OCN_CD) AS FSC_CD
             , FN_GET_MODEL_TP_NM(A.MODEL_CD, A.OCN_CD) AS FSC_NM
             , FN_GET_MODEL_NM(A.MODEL_CD) AS MODEL_NM
             , A.OCN_CD              --OCN코드
             , FN_GET_OCN_NM(A.MODEL_CD, A.OCN_CD) AS OCN_NM
             , A.EXT_COLOR_CD        --외장색상코드
             , FN_GET_EXT_COLOR_NM(A.EXT_COLOR_CD) AS EXT_COLOR_NM
             , A.INT_COLOR_CD        --내장색상코드
             , FN_GET_INT_COLOR_NM(A.INT_COLOR_CD) AS INT_COLOR_NM
             , A.SPC_CAR_QTY         --특수차량수량
             , A.ORD_NO              --오더번호
             , A.BEF_ORD_NO          --이전오더번호
         FROM SA_0422T A    --특수차판매신청명세
        WHERE A.DLR_CD = #{sDlrCd}
          AND A.USR_ID = #{sUsrId}
          AND A.REQ_NO = #{sReqNo}
    </select>

    <!-- 구원차/대부차량신청 심사내역 조회 -->
    <select id="selectAskHelpCarPopupEvlsByConditionCnt" parameterType="AskHelpCarSearchVO" resultType="int">
        SELECT COUNT(*)
         FROM SA_0423T     --특수차판매신청명세
        where DLR_CD = #{sDlrCd}
          and USR_ID = #{sUsrId}
          and REQ_NO = #{sReqNo}
    </select>

    <select id="selectAskHelpCarPopupEvlsByCondition" parameterType="AskHelpCarSearchVO" resultType="AskHelpCarPopupEvlVO">
      SELECT A.DLR_CD              --딜러코드
           ,A.USR_ID              --사용자ID
           ,A.REQ_NO              --요청번호
           ,A.SPC_ORD_SEQ         --특수오더일련번호
           ,A.EVAL_RSLT_YN        --심사결과여부
           ,A.PEVAL_ID            --심사자ID
           ,A.EVAL_DT             --심사일자
           ,A.REMARK              --비고
           ,A.REG_USR_ID          --등록자ID
           ,A.REG_DT              --등록일자
           ,A.UPDT_USR_ID         --수정자ID
           ,A.UPDT_DT             --수정일자
      FROM SA_0423T A    --특수차판매심사정보
     where DLR_CD = #{sDlrCd}
       and USR_ID = #{sUsrId}
       and REQ_NO = #{sReqNo}
    </select>

    <!-- 구원차/대부차량신청 팝업 차량 저장 -->
    <insert id="insertAskHelpCarPopupCars" parameterType="AskHelpCarPopupCarVO">
        INSERT
          INTO SA_0422T(
               DLR_CD
             , USR_ID
             , REQ_NO
             , REQ_SEQ
             , CARLINE_CD
             , MODEL_CD
             , OCN_CD
             , EXT_COLOR_CD
             , INT_COLOR_CD
             , SPC_CAR_QTY
             , ORD_NO
             , BEF_ORD_NO
             , REG_USR_ID
             , REG_DT
             , UPDT_USR_ID
             , UPDT_DT
         )VALUES(
               #{dlrCd}
             , #{usrId}
             , #{reqNo}
             /*, SEQ_SA_0422T.NEXTVAL*/
             , (SELECT NVL(MAX(REQ_SEQ),0)+1 FROM SA_0422T WHERE DLR_CD = #{dlrCd} AND USR_ID = #{usrId} AND REQ_NO = #{reqNo})
             , #{carlineCd}
             , #{modelCd}
             , #{ocnCd}
             , #{extColorCd}
             , #{intColorCd}
             , #{spcCarQty}
             , ''
             , ''
             , #{regUsrId}
             , SYSDATE
             , #{updtUsrId}
             , SYSDATE
        )
         <selectKey resultType="String" keyProperty="reqSeq" order="AFTER">
            SELECT MAX(REQ_SEQ) AS reqSeq FROM SA_0422T WHERE DLR_CD = #{dlrCd} AND USR_ID = #{usrId} AND REQ_NO = #{reqNo}
         </selectKey>
    </insert>

    <!-- 구원차/대부차량신청 팝업 차량 수정 -->
    <update id="updateAskHelpCarPopupCars" parameterType="AskHelpCarPopupCarVO">
        UPDATE SA_0422T
           set CARLINE_CD = #{carlineCd}
             , MODEL_CD = #{modelCd}
             , OCN_CD = #{ocnCd}
             , EXT_COLOR_CD = #{extColorCd}
             , INT_COLOR_CD = #{intColorCd}
             , SPC_CAR_QTY = #{spcCarQty}
             , UPDT_USR_ID = #{updtUsrId}
             , UPDT_DT = SYSDATE
         WHERE DLR_CD = #{dlrCd}
           AND USR_ID = #{usrId}
           AND REQ_NO = #{reqNo}
           AND REQ_SEQ = #{reqSeq}
    </update>

    <!-- 구원차/대부차량신청 팝업 차량 삭제 -->
    <delete id="deleteAskHelpCarPopupCars" parameterType="AskHelpCarPopupCarVO">
        DELETE
          FROM SA_0422T
         WHERE DLR_CD = #{dlrCd}
           AND USR_ID = #{usrId}
           AND REQ_NO = #{reqNo}
           AND REQ_SEQ = #{reqSeq}
    </delete>

    <!-- 구원/대부차량 신청 저장 -->
    <insert id="insertAskHelpCars" parameterType="AskHelpCarVO">
        INSERT
          INTO SA_0424T(
             DLR_CD
           , USR_ID
           , REQ_NO
           , REQ_DT
           , EVAL_GRADE_CD
           , SALE_PRSN_NM
           , SALE_PRSN_TEL_NO
           , TP_CD
           , REQ_TP
           , UPLOAD_SEQ_RENEWAL
           , UPLOAD_SEQ
           , REMARK
           , APPROVE_CD
           , DEL_YN
           , FILE_NM            -- 인수차량 이미지 파일명
           , FILE_DOC_NO        -- 인수차량 이미지 파일 문서번호
           , FILE_NO            -- 인수차량 이미지 파일번호
           <if test='fileImgUploadFlag != "" and fileImgUploadFlag != "N"'>
           , FILE_UPLOAD_DT     -- 인수차량 이미지 업로드한 시간
           </if>
           , REG_USR_ID
           , REG_DT
           , UPDT_USR_ID
           , UPDT_DT
           , POLICY_NOTICE
           , REQ_CAR_NO
          )VALUES(
             #{dlrCd}
           , #{usrId}
           , #{reqNo}
           , #{reqDt}
           , (SELECT GRADE_CD FROM SA_0435T WHERE WRK_DSTIN_CD  = '03')
           , #{salePrsnNm}
           , #{salePrsnTelNo}
           , #{tpCd}
           , #{reqTp}
           , #{uploadSeqRenewal}
           , #{uploadSeq}
           , #{remark}
           , 'A'
           , 'N'
           , #{fileNm}
           , #{fileDocNo}
           , #{fileNo}
           <if test='fileImgUploadFlag != "" and fileImgUploadFlag != "N"'>
           , SYSDATE
           </if>
           , #{regUsrId}
           , SYSDATE
           , #{updtUsrId}
           , SYSDATE
           , (SELECT POLICY_CONT FROM SA_0171T WHERE POLICY_TP = #{tpCd})
           , (SELECT #{dlrCd} || TO_CHAR(SYSDATE, 'YYMM') || LPAD(TO_CHAR(NVL(SUBSTR(MAX(REQ_CAR_NO),10,12), 0)+1), 3, '0' ) FROM SA_0424T WHERE DLR_CD = #{dlrCd} AND USR_ID = #{usrId} AND SUBSTR(REQ_CAR_NO, 1, 9) = #{dlrCd}||TO_CHAR(SYSDATE, 'YYMM') )
          )
    </insert>

    <!-- 구원/대부차량 신청 수정 -->
    <update id="updateAskHelpCars" parameterType="AskHelpCarVO">
        UPDATE SA_0424T
           SET REQ_DT = #{reqDt}
             , SALE_PRSN_NM = #{salePrsnNm}
             , SALE_PRSN_TEL_NO = #{salePrsnTelNo}
             , TP_CD = #{tpCd}
             , REQ_TP = #{reqTp}
             , UPLOAD_SEQ_RENEWAL = #{uploadSeqRenewal}
             , UPLOAD_SEQ = #{uploadSeq}
             , REMARK = #{remark}
             , FILE_NM = #{fileNm}         -- 인수차량 이미지 파일명
             , FILE_DOC_NO = #{fileDocNo}  -- 인수차량 이미지 파일 문서번호
             , FILE_NO = #{fileNo}         -- 인수차량 이미지 파일번호
            <if test='fileImgUploadFlag != "" and fileImgUploadFlag == "A"'>
             , FILE_UPLOAD_DT = SYSDATE    -- 인수차량 이미지 업로드한 시간
            </if>
            <if test='fileImgUploadFlag != "" and fileImgUploadFlag == "B"'>
             , FILE_UPLOAD_DT = NULL    -- 인수차량 이미지 업로드한 시간
            </if>
             , UPDT_USR_ID = #{updtUsrId}
             , UPDT_DT = SYSDATE
             , POLICY_NOTICE = (SELECT POLICY_CONT FROM SA_0171T WHERE POLICY_TP = #{tpCd})
         WHERE DLR_CD = #{dlrCd}
           AND USR_ID = #{usrId}
           AND REQ_NO = #{reqNo}
    </update>

    <!-- 구원/대부차량 신청 삭제 -->
    <update id="deleteAskHelpCars" parameterType="AskHelpCarSearchVO">
        UPDATE SA_0424T
           SET DEL_YN = 'Y'
         WHERE DLR_CD = #{sDlrCd}
           AND USR_ID = #{sUsrId}
           AND REQ_NO = #{sReqNo}
    </update>

    <!-- 구원/대부차량 신청 확정 -->
    <update id="confirmAskHelpCars" parameterType="AskHelpCarSearchVO">
        UPDATE SA_0424T
           SET APPROVE_CD = 'B'
         WHERE DLR_CD = #{sDlrCd}
           AND USR_ID = #{sUsrId}
           AND REQ_NO = #{sReqNo}
    </update>

    <!-- 구원차/대부차신청 차량등록 관련 서류 갱신 -->
    <update id="updateCarRegDoc" parameterType="AskHelpCarVO">
        UPDATE SA_0424T
           SET UPLOAD_SEQ = #{uploadSeq}
         WHERE DLR_CD = #{dlrCd}
           AND USR_ID = #{usrId}
           AND REQ_NO = #{reqNo}
    </update>

    <!-- 구원차/대부차신청 갱신심사 서류 갱신 -->
    <update id="updateCarRcpDoc" parameterType="AskHelpCarVO">
        UPDATE SA_0424T
           SET UPLOAD_SEQ_RENEWAL = #{uploadSeqRenewal}
         WHERE DLR_CD = #{dlrCd}
           AND USR_ID = #{usrId}
           AND REQ_NO = #{reqNo}
    </update>

    <!-- 구원차/대부차신청 인수차량 이미지 갱신 -->
    <update id="updateCarImgDoc" parameterType="AskHelpCarVO">
        UPDATE SA_0424T
           SET FILE_NM = #{fileNm}
             , FILE_DOC_NO = #{fileDocNo}
             , FILE_NO = #{fileNo}
            <if test='fileImgUploadFlag != "" and fileImgUploadFlag == "A"'>
             , FILE_UPLOAD_DT = SYSDATE    -- 인수차량 이미지 업로드한 시간
            </if>
            <if test='fileImgUploadFlag != "" and fileImgUploadFlag == "B"'>
             , FILE_UPLOAD_DT = NULL    -- 인수차량 이미지 업로드한 시간
            </if>
         WHERE DLR_CD = #{dlrCd}
           AND USR_ID = #{usrId}
           AND REQ_NO = #{reqNo}
    </update>

    <!-- 구원차/대부차량 심사목록 갯수  -->
    <select id="selectAskHelpCarJudgesByConditionCnt" parameterType="AskHelpCarSearchVO" resultType="int">
        SELECT COUNT(1)
          FROM (
                SELECT CASE WHEN NVL(USE_EVAL_YN, 'B') = 'B' THEN 'B'
                            WHEN NVL(USE_EVAL_YN, 'B') = 'Y' THEN 'C'
                            ELSE 'D'
                        END AS USE_APPROVE_CD
                     , CASE WHEN APPROVE_CD = 'A' THEN '02'
                            WHEN APPROVE_CD = 'B' THEN '02'
                            WHEN APPROVE_CD = 'C' THEN '01'
                            WHEN APPROVE_CD = 'D' THEN '01'
                            ELSE '01'
                        END AS APPROVES_CD
                     , K.*
                  FROM (
                        SELECT A.DLR_CD
                             , C.DLR_NM
                             , C.DIST_CD
                             , A.USR_ID
                             , (SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.USR_ID) AS USR_NM
							 , C.DIST_OFFICE_CD
							 , C.SDPT_CD
                             , A.REQ_NO
                             , A.REQ_CAR_NO
                             , A.SALE_PRSN_NM
                             , A.SALE_PRSN_TEL_NO
                             , A.TP_CD
                             , A.REQ_TP       -- 신청구분
                             , A.UPLOAD_SEQ_RENEWAL
                             , A.UPLOAD_SEQ
                             , B.SPC_CAR_QTY  -- 수량
                             , A.REQ_DT       -- 신청일자
                             , D.EVAL_DT      -- 심사일자
                             , A.APPROVE_CD   -- 승인여부(상태)
                             , D.EVAL_RSLT_YN -- 심사결과
                             , DECODE(NVL(A.FILE_DOC_NO, 'N'), 'N', 'N', 'Y') AS CAR_IMG_YN
                             , A.FILE_NM
                             , A.FILE_DOC_NO
                             , A.FILE_NO
                             , A.FILE_UPLOAD_DT
                             , A.POLICY_NOTICE  AS POLICY_CONT
                             , A.UPDT_USR_ID
                             , A.UPDT_DT
                             , NVL(D.SPC_ORD_SEQ,0) AS SPC_ORD_SEQ
                             , (SELECT GRADE_CD FROM SA_0435T WHERE WRK_DSTIN_CD = '06') AS MAX_EVAL   -- 심사최종등급
                             , (SELECT TO_NUMBER(EVAL_GRADE_CD) FROM SA_0156T WHERE USR_ID = #{sUserId} AND WRK_DSTIN_CD = '06') AS USE_EVAL -- 사용자 심사등급
                             , E.USE_EVAL_YN                    -- 사용자 심사여부
                          FROM SA_0424T A
                         INNER JOIN (
                                     SELECT USR_ID, MNG_DLR_CD
                                       FROM SA_0439T
                                       GROUP BY USR_ID, MNG_DLR_CD
                                     ) X
                            ON A.DLR_CD = X.MNG_DLR_CD
                          LEFT OUTER JOIN (
                                    SELECT DLR_CD
                                         , USR_ID
                                         , REQ_NO
                                         , SUM(SPC_CAR_QTY) AS SPC_CAR_QTY          -- 수량 합계
                                      FROM SA_0422T
                                      GROUP BY  DLR_CD, USR_ID, REQ_NO
                                    ) B                   /* 특수차판매신청 DETAIL */
                           ON A.DLR_CD = B.DLR_CD
                          AND A.USR_ID = B.USR_ID
                          AND A.REQ_NO = B.REQ_NO
                         LEFT OUTER JOIN CM_0101T C
                           ON A.DLR_CD = C.DLR_CD
                         LEFT OUTER JOIN ( SELECT DLR_CD
                                                , USR_ID
                                                , REQ_NO
                                                , MAX(SPC_ORD_SEQ) AS SPC_ORD_SEQ -- 최종 심사 차수
                                                , MAX(EVAL_DT) AS EVAL_DT        -- 심사일자
                                                , MAX(EVAL_RSLT_YN) as EVAL_RSLT_YN  -- 심사결과여부
                                             FROM SA_0423T
                                            GROUP BY DLR_CD, USR_ID, REQ_NO
                                          ) D
                          ON A.DLR_CD = D.DLR_CD
                         AND A.USR_ID = D.USR_ID
                         AND A.REQ_NO = D.REQ_NO
                        LEFT OUTER JOIN ( SELECT DLR_CD
                                               , USR_ID
                                               , REQ_NO
                                               , MAX(EVAL_RSLT_YN) AS USE_EVAL_YN -- 사용자의 심사 여부
                                            FROM SA_0423T
                                     <!--  WHERE PEVAL_ID = #{sUserId} -->
                                         GROUP BY DLR_CD, USR_ID, REQ_NO
                                         ) E
                         ON A.DLR_CD = E.DLR_CD
                        AND A.USR_ID = E.USR_ID
                        AND A.REQ_NO = E.REQ_NO
                       WHERE A.TP_CD != 'N7'
                         AND A.DEL_YN != 'Y'
                         AND A.APPROVE_CD IN ('B', 'C', 'D')    /* 승인신청, 승인, 불승인*/
                         AND X.usr_id = #{sUserId}
                         AND EXISTS (
                                SELECT DLR_CD
                                  FROM CM_0101T
                                 WHERE DLR_CD     = A.DLR_CD
                                   AND DMS_USE_YN = 'Y'
                          )
                       <if test='sDlrCd != null and sDlrCd != ""'>
                         AND A.DLR_CD = #{sDlrCd}              -- 딜러코드
                       </if>
                       <if test='sUsrId != null and sUsrId != ""'>
                         AND A.USR_ID = #{sUsrId}              -- 딜러코드
                       </if>
                       <if test='sReqNo != null and sReqNo != ""'>
                         AND A.REQ_NO = #{sReqNo}
                       </if>
                       <if test='sApproveCd != null and sApproveCd != ""'>
                         AND A.APPROVE_CD = #{sApproveCd}  -- 상태
                       </if>
                       <if test='sTpCd != null and sTpCd != ""'>
                         AND A.TP_CD = #{sTpCd}            -- 차량유형
                       </if>
                       <if test='sStartReqDt != null' >
                         AND A.REQ_DT <![CDATA[>=]]> TRUNC(#{sStartReqDt},'DD')
                       </if>
                       <if test='sEndReqDt != null' >
                         AND A.REQ_DT <![CDATA[<]]> TRUNC(#{sEndReqDt},'DD')+1
                       </if>
                       <if test='sReqCarNo != null and sReqCarNo != ""'>
                       <choose>
                         <when test='@org.apache.commons.lang3.StringUtils@contains(sReqCarNo,"*")'>
                           <bind name='sReqCarNo' value='@org.apache.commons.lang3.StringUtils@replace(sReqCarNo, "*", "%")' />
                             AND A.REQ_CAR_NO LIKE #{sReqCarNo}
                         </when>
                         <otherwise>
                             AND A.REQ_CAR_NO = #{sReqCarNo}
                         </otherwise>
                       </choose>
                       </if>
                       <if test='sCarImgYn != null and sCarImgYn != ""'>
                           AND DECODE(NVL(A.FILE_DOC_NO, 'N'), 'N', 'N', 'Y') = #{sCarImgYn}
                       </if>
                       <if test='sEvalRsltYn != null and sEvalRsltYn != ""'>
                           AND D.EVAL_RSLT_YN = #{sEvalRsltYn}
                       </if>
                       <if test='sDiviCd != null and sDiviCd != ""'>
                           AND C.SDPT_CD = #{sDiviCd}
                       </if>
                       <if test='sOffCd != null and sOffCd != ""'>
                           AND C.DIST_OFFICE_CD = #{sOffCd}
                       </if>
                       ) K
                   WHERE  K.USE_EVAL <![CDATA[ <= ]]> K.SPC_ORD_SEQ+1
                     AND  K.USE_EVAL <![CDATA[ <= ]]> K.MAX_EVAL
                   ) Z
               WHERE 1 = 1
               <if test='sUseApproveCd != null and sUseApproveCd != ""'>
                 AND Z.USE_APPROVE_CD = #{sUseApproveCd}
               </if>
               <if test='sApprovesCd != null and sApprovesCd != ""'>
                 AND Z.APPROVES_CD = #{sApprovesCd}
               </if>
    </select>

    <!-- 구원차/대부차량 심사목록 조회 -->
    <select id="selectAskHelpCarJudgesByCondition" parameterType="AskHelpCarSearchVO" resultType="AskHelpCarVO">

        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM
               (
                SELECT Z.*
                  FROM (
                        SELECT CASE WHEN NVL(USE_EVAL_YN, 'B') = 'B' THEN 'B'
                                    WHEN NVL(USE_EVAL_YN, 'B') = 'Y' THEN 'C'
                                    ELSE 'D'
                                END AS USE_APPROVE_CD
                             , CASE WHEN APPROVE_CD = 'A' THEN '02'
                                    WHEN APPROVE_CD = 'B' THEN '02'
                                    WHEN APPROVE_CD = 'C' THEN '01'
                                    WHEN APPROVE_CD = 'D' THEN '01'
                                    ELSE '01'
                                END AS APPROVES_CD
                             , K.*
                          FROM (
                                SELECT A.DLR_CD
                                     , C.DLR_NM
                                     , C.DIST_CD
                                     , A.USR_ID
                                     , (SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.USR_ID) AS USR_NM
                                     , C.DIST_OFFICE_CD                                                   --사업부코드
                                     , (SELECT OFF_NM
                                          FROM CM_2601T Y
                                         WHERE Y.DIVI_CD = C.SDPT_CD
                                           AND Y.OFF_CD  = C.DIST_OFFICE_CD
                                       ) AS OFFICE_NM                                                      --사업부명
                                     , C.SDPT_CD                                                           --사무소코드
                                     , (SELECT DIVI_NM FROM CM_2501T WHERE DIVI_CD = C.SDPT_CD) AS SDPT_NM --사무소명
                                     , A.REQ_NO
                                     , A.REQ_CAR_NO
                                     , A.SALE_PRSN_NM
                                     , A.SALE_PRSN_TEL_NO
                                     , A.TP_CD
                                     , A.REQ_TP       -- 신청구분
                                     , A.UPLOAD_SEQ_RENEWAL
                                     , A.UPLOAD_SEQ
                                     , B.SPC_CAR_QTY  -- 수량
                                     , A.REQ_DT       -- 신청일자
                                     , D.EVAL_DT      -- 심사일자
                                     , A.APPROVE_CD   -- 승인여부(상태)
                                     , D.EVAL_RSLT_YN -- 심사결과
                                     , DECODE(NVL(A.FILE_DOC_NO, 'N'), 'N', 'N', 'Y') AS CAR_IMG_YN
                                     , A.FILE_NM
                                     , A.FILE_DOC_NO
                                     , A.FILE_NO
                                     , A.FILE_UPLOAD_DT
                                     , A.POLICY_NOTICE  AS POLICY_CONT
                                     , A.UPDT_USR_ID
                                     , A.UPDT_DT
                                     , NVL(D.SPC_ORD_SEQ,0) AS SPC_ORD_SEQ
                                     , (SELECT GRADE_CD FROM SA_0435T WHERE WRK_DSTIN_CD = '06') AS MAX_EVAL   -- 심사최종등급
                                     , (SELECT TO_NUMBER(EVAL_GRADE_CD) FROM SA_0156T WHERE USR_ID = #{sUserId} AND WRK_DSTIN_CD = '06') AS USE_EVAL -- 사용자 심사등급
                                     , E.USE_EVAL_YN                    -- 사용자 심사여부
                                  FROM SA_0424T A
                                 INNER JOIN (
                                             SELECT USR_ID, MNG_DLR_CD
                                               FROM SA_0439T
                                               GROUP BY USR_ID, MNG_DLR_CD
                                             ) X
                                    ON A.DLR_CD = X.MNG_DLR_CD
                                  LEFT OUTER JOIN (
                                            SELECT DLR_CD
                                                 , USR_ID
                                                 , REQ_NO
                                                 , SUM(SPC_CAR_QTY) AS SPC_CAR_QTY          -- 수량 합계
                                              FROM SA_0422T
                                              GROUP BY  DLR_CD, USR_ID, REQ_NO
                                            ) B                   /* 특수차판매신청 DETAIL */
                                   ON A.DLR_CD = B.DLR_CD
                                  AND A.USR_ID = B.USR_ID
                                  AND A.REQ_NO = B.REQ_NO
                                 LEFT OUTER JOIN CM_0101T C
                                   ON A.DLR_CD = C.DLR_CD
                                 LEFT OUTER JOIN ( SELECT DLR_CD
                                                        , USR_ID
                                                        , REQ_NO
                                                        , MAX(SPC_ORD_SEQ) AS SPC_ORD_SEQ -- 최종 심사 차수
                                                        , MAX(EVAL_DT) AS EVAL_DT        -- 심사일자
                                                        , MAX(EVAL_RSLT_YN) as EVAL_RSLT_YN  -- 심사결과여부
                                                     FROM SA_0423T
                                                    GROUP BY DLR_CD, USR_ID, REQ_NO
                                                  ) D
                                  ON A.DLR_CD = D.DLR_CD
                                 AND A.USR_ID = D.USR_ID
                                 AND A.REQ_NO = D.REQ_NO
                                LEFT OUTER JOIN ( SELECT DLR_CD
                                                       , USR_ID
                                                       , REQ_NO
                                                       , MAX(EVAL_RSLT_YN) AS USE_EVAL_YN -- 사용자의 심사 여부
                                                    FROM SA_0423T
                                            <!--   WHERE PEVAL_ID = #{sUserId}   -->
                                                 GROUP BY DLR_CD, USR_ID, REQ_NO
                                                 ) E
                                 ON A.DLR_CD = E.DLR_CD
                                AND A.USR_ID = E.USR_ID
                                AND A.REQ_NO = E.REQ_NO
                               WHERE A.TP_CD != 'N7'
                                 AND A.DEL_YN != 'Y'
                                 AND A.APPROVE_CD IN ('B', 'C', 'D')    /* 승인신청, 승인, 불승인*/
                                 AND X.usr_id = #{sUserId}
                                 AND EXISTS (
                                        SELECT DLR_CD
                                          FROM CM_0101T
                                         WHERE DLR_CD     = A.DLR_CD
                                           AND DMS_USE_YN = 'Y'
                                  )
                               <if test='sDlrCd != null and sDlrCd != ""'>
                                 AND A.DLR_CD = #{sDlrCd}              -- 딜러코드
                               </if>
                               <if test='sUsrId != null and sUsrId != ""'>
                                 AND A.USR_ID = #{sUsrId}              -- 딜러코드
                               </if>
                               <if test='sReqNo != null and sReqNo != ""'>
                                 AND A.REQ_NO = #{sReqNo}
                               </if>
                               <if test='sApproveCd != null and sApproveCd != ""'>
                                 AND A.APPROVE_CD = #{sApproveCd}  -- 상태
                               </if>
                               <if test='sTpCd != null and sTpCd != ""'>
                                 AND A.TP_CD = #{sTpCd}            -- 차량유형
                               </if>
                               <if test='sStartReqDt != null' >
                                 AND A.REQ_DT <![CDATA[>=]]> TRUNC(#{sStartReqDt},'DD')
                               </if>
                               <if test='sEndReqDt != null' >
                                 AND A.REQ_DT <![CDATA[<]]> TRUNC(#{sEndReqDt},'DD')+1
                               </if>
                               <if test='sReqCarNo != null and sReqCarNo != ""'>
                               <choose>
                                 <when test='@org.apache.commons.lang3.StringUtils@contains(sReqCarNo,"*")'>
                                   <bind name='sReqCarNo' value='@org.apache.commons.lang3.StringUtils@replace(sReqCarNo, "*", "%")' />
                                     AND A.REQ_CAR_NO LIKE #{sReqCarNo}
                                 </when>
                                 <otherwise>
                                     AND A.REQ_CAR_NO = #{sReqCarNo}
                                 </otherwise>
                               </choose>
                               </if>
                               <if test='sCarImgYn != null and sCarImgYn != ""'>
                                   AND DECODE(NVL(A.FILE_DOC_NO, 'N'), 'N', 'N', 'Y') = #{sCarImgYn}
                               </if>
                               <if test='sEvalRsltYn != null and sEvalRsltYn != ""'>
                                   AND D.EVAL_RSLT_YN = #{sEvalRsltYn}
                               </if>
                               <if test='sDiviCd != null and sDiviCd != ""'>
                                   AND C.SDPT_CD = #{sDiviCd}
                               </if>
                               <if test='sOffCd != null and sOffCd != ""'>
                                   AND C.DIST_OFFICE_CD = #{sOffCd}
                               </if>
                               ) K
                           WHERE  K.USE_EVAL <![CDATA[ <= ]]> K.SPC_ORD_SEQ+1
                             AND  K.USE_EVAL <![CDATA[ <= ]]> K.MAX_EVAL
                           ) Z
                       WHERE 1 = 1
                       <if test='sUseApproveCd != null and sUseApproveCd != ""'>
                         AND Z.USE_APPROVE_CD = #{sUseApproveCd}
                       </if>
                       <if test='sApprovesCd != null and sApprovesCd != ""'>
                         AND Z.APPROVES_CD = #{sApprovesCd}
                       </if>
                 ORDER BY
                 <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "reqCarNo"'>Z.REQ_CAR_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "distCd"'>Z.DIST_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "dlrCd"'>Z.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "dlrNm"'>Z.DLR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "tpCd"'>Z.TP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "salePrsnNm"'>Z.SALE_PRSN_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "salePrsnTelNo"'>Z.SALE_PRSN_TEL_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "reqTp"'>Z.REQ_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "spcCarQty"'>Z.SPC_CAR_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "reqDt"'>Z.REQ_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "evalDt"'>Z.EVAL_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "approveCd"'>Z.APPROVES_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "evalRsltYn"'>Z.EVAL_RSLT_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                    Z.REQ_CAR_NO DESC, Z.REQ_NO DESC
                                </otherwise>
                            </choose>
                         </foreach>
                    </when>
                    <otherwise>
                            Z.REQ_CAR_NO DESC, Z.REQ_NO DESC
                    </otherwise>
                </choose>
                ) T1
                <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
                </where>
         )
         <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 구원차/대부차량 심사목록 엑셀 다운로드  -->
    <select id="selectAskHelpCarJudgesExcelByCondition" parameterType="AskHelpCarSearchVO" resultType="AskHelpCarVO">

        SELECT * FROM
        ( SELECT ROWNUM AS RNUM, T1.* FROM
               (
                SELECT Z.*
                      ,T.VIN_NO
                      ,T.GR_DT          --입고일자
                      ,T.CUST_SALE_DT   --출고일자
                      ,T.PLT_GI_DT      --공장출고일자
                  FROM (
                        SELECT CASE WHEN NVL(USE_EVAL_YN, 'B') = 'B' THEN 'B'
                                    WHEN NVL(USE_EVAL_YN, 'B') = 'Y' THEN 'C'
                                    ELSE 'D'
                                END AS USE_APPROVE_CD
                             , CASE WHEN APPROVE_CD = 'A' THEN '02'
                                    WHEN APPROVE_CD = 'B' THEN '02'
                                    WHEN APPROVE_CD = 'C' THEN '01'
                                    WHEN APPROVE_CD = 'D' THEN '01'
                                    ELSE '01'
                                END AS APPROVES_CD
                             , K.*
                          FROM (
                                SELECT A.DLR_CD
                                      ,C.DLR_NM
                                      ,C.DIST_CD
                                      ,A.USR_ID
                                      ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.USR_ID) AS USR_NM
                                      ,C.DIST_OFFICE_CD                                                   --사업부코드
                                      ,(SELECT OFF_NM
                                          FROM CM_2601T Y
                                         WHERE Y.DIVI_CD = C.SDPT_CD
                                           AND Y.OFF_CD  = C.DIST_OFFICE_CD
                                       ) AS OFFICE_NM                                                      --사업부명
                                      ,C.SDPT_CD                                                           --사무소코드
                                      ,(SELECT DIVI_NM FROM CM_2501T WHERE DIVI_CD = C.SDPT_CD) AS SDPT_NM --사무소명
                                      ,A.REQ_NO
                                      ,A.REQ_CAR_NO
                                      ,A.SALE_PRSN_NM
                                      ,A.SALE_PRSN_TEL_NO
                                      ,A.TP_CD        -- 차량유형 SAL142
                                      ,FN_CMM_CD_NM('SAL142',A.TP_CD, #{sLangCd} , 'N') AS TP_CD_NM
                                      ,A.REQ_TP       -- 신청구분 SAL143
                                      ,FN_CMM_CD_NM('SAL143',A.REQ_TP, #{sLangCd} , 'N') AS REQ_TP_NM
                                      ,A.UPLOAD_SEQ_RENEWAL
                                      ,A.UPLOAD_SEQ
                                      ,B.SPC_CAR_QTY  -- 수량
                                      ,A.REQ_DT       -- 신청일자
                                      ,D.EVAL_DT      -- 심사일자
                                      ,A.APPROVE_CD   -- 승인여부(상태)
                                      ,D.EVAL_RSLT_YN -- 심사결과
                                      ,DECODE(NVL(A.FILE_DOC_NO, 'N'), 'N', 'N', 'Y') AS CAR_IMG_YN
                                      ,A.FILE_NM
                                      ,A.FILE_DOC_NO
                                      ,A.FILE_NO
                                      ,A.FILE_UPLOAD_DT
                                      ,A.POLICY_NOTICE  AS POLICY_CONT
                                      ,A.UPDT_USR_ID
                                      ,A.UPDT_DT
                                      ,NVL(D.SPC_ORD_SEQ,0) AS SPC_ORD_SEQ
                                      ,(SELECT GRADE_CD FROM SA_0435T WHERE WRK_DSTIN_CD = '06') AS MAX_EVAL   -- 심사최종등급
                                      ,(SELECT TO_NUMBER(EVAL_GRADE_CD) FROM SA_0156T WHERE USR_ID = #{sUserId} AND WRK_DSTIN_CD = '06') AS USE_EVAL -- 사용자 심사등급
                                      ,E.USE_EVAL_YN                    -- 사용자 심사여부
                                      ,B.CARLINE_CD
                                      ,B.MODEL_CD
                                      ,B.OCN_CD
                                      ,B.EXT_COLOR_CD
                                      ,B.INT_COLOR_CD
                                      ,FN_GET_CARLINE_NM(B.CARLINE_CD) AS CARLINE_NM
                                      ,FN_GET_MODEL_NM_NC(B.MODEL_CD) AS MODEL_NM
                                      ,FN_GET_OCN_NM_NC(B.MODEL_CD, B.OCN_CD) AS OCN_NM
                                      ,FN_GET_EXT_COLOR_NM(B.EXT_COLOR_CD) AS EXT_COLOR_NM
                                      ,FN_GET_INT_COLOR_NM_NC(B.INT_COLOR_CD) AS INT_COLOR_NM
                                      ,FSCP_CHM_MMM
                                      ,A.LAST_APPROVE_DT
                                      ,A.APPROVE_END_DT
                                      ,B.ORD_NO
                                  FROM SA_0424T A
                                 INNER JOIN (
                                             SELECT USR_ID, MNG_DLR_CD
                                               FROM SA_0439T
                                               GROUP BY USR_ID, MNG_DLR_CD
                                             ) X
                                    ON A.DLR_CD = X.MNG_DLR_CD
                                  LEFT OUTER JOIN (
                                            SELECT A.DLR_CD
                                                 , A.USR_ID
                                                 , A.REQ_NO
                                                 , MAX(A.CARLINE_CD)     AS CARLINE_CD
                                                 , MAX(A.MODEL_CD)       AS MODEL_CD
                                                 , MAX(A.OCN_CD)         AS OCN_CD
                                                 , MAX(A.EXT_COLOR_CD)   AS EXT_COLOR_CD
                                                 , MAX(A.INT_COLOR_CD)   AS INT_COLOR_CD
                                                 , MAX(B.FSCP_CHM_MMM )  AS FSCP_CHM_MMM
                                                 , SUM(A.SPC_CAR_QTY)    AS SPC_CAR_QTY          -- 수량 합계
                                                 , MAX(A.ORD_NO)         AS ORD_NO
                                              FROM SA_0422T A LEFT OUTER JOIN SA_0105T B
                                                ON A.MODEL_CD = B.MODEL_CD
                                               AND A.OCN_CD   = B.OCN_CD
                                              GROUP BY  A.DLR_CD, A.USR_ID, A.REQ_NO
                                            ) B                   /* 특수차판매신청 DETAIL */
                                   ON A.DLR_CD = B.DLR_CD
                                  AND A.USR_ID = B.USR_ID
                                  AND A.REQ_NO = B.REQ_NO
                                 LEFT OUTER JOIN CM_0101T C
                                   ON A.DLR_CD = C.DLR_CD
                                 LEFT OUTER JOIN ( SELECT DLR_CD
                                                        , USR_ID
                                                        , REQ_NO
                                                        , MAX(SPC_ORD_SEQ) AS SPC_ORD_SEQ -- 최종 심사 차수
                                                        , MAX(EVAL_DT) AS EVAL_DT        -- 심사일자
                                                        , MAX(EVAL_RSLT_YN) as EVAL_RSLT_YN  -- 심사결과여부
                                                     FROM SA_0423T
                                                    GROUP BY DLR_CD, USR_ID, REQ_NO
                                                  ) D
                                  ON A.DLR_CD = D.DLR_CD
                                 AND A.USR_ID = D.USR_ID
                                 AND A.REQ_NO = D.REQ_NO
                                LEFT OUTER JOIN ( SELECT DLR_CD
                                                       , USR_ID
                                                       , REQ_NO
                                                       , MAX(EVAL_RSLT_YN) AS USE_EVAL_YN -- 사용자의 심사 여부
                                                    FROM SA_0423T
                                                   WHERE PEVAL_ID = #{sUserId}
                                                 GROUP BY DLR_CD, USR_ID, REQ_NO
                                                 ) E
                                 ON A.DLR_CD = E.DLR_CD
                                AND A.USR_ID = E.USR_ID
                                AND A.REQ_NO = E.REQ_NO
                               WHERE A.TP_CD IN ( 'NS' ,'N5')
                                 AND A.DEL_YN != 'Y'
                                 AND A.APPROVE_CD IN ('B', 'C', 'D')    /* 승인신청, 승인, 불승인*/
                                 AND X.usr_id = #{sUserId}

                               <if test='sDlrCd != null and sDlrCd != ""'>
                                 AND A.DLR_CD = #{sDlrCd}              -- 딜러코드
                               </if>
                               <if test='sUsrId != null and sUsrId != ""'>
                                 AND A.USR_ID = #{sUsrId}              -- 딜러코드
                               </if>
                               <if test='sReqNo != null and sReqNo != ""'>
                                 AND A.REQ_NO = #{sReqNo}
                               </if>
                               <if test='sApproveCd != null and sApproveCd != ""'>
                                 AND A.APPROVE_CD = #{sApproveCd}  -- 상태
                               </if>
                               <if test='sTpCd != null and sTpCd != ""'>
                                 AND A.TP_CD = #{sTpCd}            -- 차량유형
                               </if>
                               <if test='sStartReqDt != null' >
                                 AND A.REQ_DT <![CDATA[>=]]> TRUNC(#{sStartReqDt},'DD')
                               </if>
                               <if test='sEndReqDt != null' >
                                 AND A.REQ_DT <![CDATA[<]]> TRUNC(#{sEndReqDt},'DD')+1
                               </if>
                               <if test='sReqCarNo != null and sReqCarNo != ""'>
                               <choose>
                                 <when test='@org.apache.commons.lang3.StringUtils@contains(sReqCarNo,"*")'>
                                   <bind name='sReqCarNo' value='@org.apache.commons.lang3.StringUtils@replace(sReqCarNo, "*", "%")' />
                                     AND A.REQ_CAR_NO LIKE #{sReqCarNo}
                                 </when>
                                 <otherwise>
                                     AND A.REQ_CAR_NO = #{sReqCarNo}
                                 </otherwise>
                               </choose>
                               </if>
                               <if test='sCarImgYn != null and sCarImgYn != ""'>
                                   AND DECODE(NVL(A.FILE_DOC_NO, 'N'), 'N', 'N', 'Y') = #{sCarImgYn}
                               </if>
                               <if test='sEvalRsltYn != null and sEvalRsltYn != ""'>
                                   AND D.EVAL_RSLT_YN = #{sEvalRsltYn}
                               </if>
                               <if test='sDiviCd != null and sDiviCd != ""'>
                                   AND C.SDPT_CD = #{sDiviCd}
                               </if>
                               <if test='sOffCd != null and sOffCd != ""'>
                                   AND C.DIST_OFFICE_CD = #{sOffCd}
                               </if>
                               ) K
                           WHERE  K.USE_EVAL <![CDATA[ <= ]]> K.SPC_ORD_SEQ+1
                             AND  K.USE_EVAL <![CDATA[ <= ]]> K.MAX_EVAL
                           ) Z LEFT OUTER JOIN (
                                        SELECT A.DLR_CD
                                              ,A.VIN_NO1
                                              ,A.VIN_NO2
                                              ,B.VIN_NO
                                              ,A.CARLINE_CD
                                              ,A.MODEL_CD
                                              ,A.OCN_CD
                                              ,A.EXT_COLOR_CD
                                              ,A.INT_COLOR_CD
                                              ,A.SORD           --오더유형
                                              ,A.SVNO           --오더번호
                                              ,B.GR_DT          --입고일자
                                              ,B.CUST_SALE_DT   --출고일자
                                              ,B.PLT_GI_DT      --공장출고일자
                                          FROM SA_0416T A , SA_0121T B
                                         WHERE A.VIN_NO1    = B.VIN_NO1
                                           AND A.VIN_NO2    = B.VIN_NO2
                                           AND A.CARLINE_CD = B.CARLINE_CD
                                           AND A.DLR_CD     = B.DLR_CD
                                           AND A.SORD IN ( 'NS' ,'N5')
                                    ) T
                                    ON T.DLR_CD     = Z.DLR_CD
                                   AND T.CARLINE_CD = Z.CARLINE_CD
                                   AND T.SORD       = Z.TP_CD
                                   AND T.SVNO       = Z.ORD_NO
                       <where>
                       <if test='sUseApproveCd != null and sUseApproveCd != ""'>
                             Z.USE_APPROVE_CD = #{sUseApproveCd}
                       </if>
                       <if test='sApprovesCd != null and sApprovesCd != ""'>
                         AND Z.APPROVES_CD = #{sApprovesCd}
                       </if>
                       </where>
                 ORDER BY
                 <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "reqCarNo"'>Z.REQ_CAR_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "distCd"'>Z.DIST_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "dlrCd"'>Z.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "dlrNm"'>Z.DLR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "tpCd"'>Z.TP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "salePrsnNm"'>Z.SALE_PRSN_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "salePrsnTelNo"'>Z.SALE_PRSN_TEL_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "reqTp"'>Z.REQ_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "spcCarQty"'>Z.SPC_CAR_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "reqDt"'>Z.REQ_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "evalDt"'>Z.EVAL_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "approveCd"'>Z.APPROVES_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "evalRsltYn"'>Z.EVAL_RSLT_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                    Z.REQ_CAR_NO DESC, Z.REQ_NO DESC
                                </otherwise>
                            </choose>
                         </foreach>
                    </when>
                    <otherwise>
                            Z.REQ_CAR_NO DESC, Z.REQ_NO DESC
                    </otherwise>
                </choose>
                ) T1
                <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
                </where>
         )
         <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 구원차/대부차량 심사-정책입력(팝업) 확정 -->
    <update id="confirmPolicyInputPopupUpdate" parameterType="AskHelpCarPopupCarVO">
          UPDATE SA_0171T
             SET POLICY_CONT = #{policyCont}
               , UPDT_USR_ID = #{updtUsrId}
               , UPDT_DT = SYSDATE
           WHERE POLICY_TP = #{tpCd}
    </update>

    <!-- 구원차/대부차량 심사-정책삭제  -->
    <delete id="deleteConfirmPolicyPopup" parameterType="AskHelpCarPopupCarVO">
          DELETE FROM SA_0171T
           WHERE POLICY_TP = #{tpCd}
    </delete>

    <insert id="confirmPolicyInputPopupInsert" parameterType="AskHelpCarPopupCarVO">
          INSERT INTO SA_0171T(
                 POLICY_TP
               , POLICY_CONT
               , REG_USR_ID
               , REG_DT
               , UPDT_USR_ID
               , UPDT_DT
             )VALUES(
                 #{tpCd}
               , #{policyCont}
               , #{regUsrId}
               , SYSDATE
               , #{updtUsrId}
               , SYSDATE
             )
    </insert>

    <!-- 차량유형 설명 이력저장 -->
    <insert id="insertCarPopupContHists" parameterType="AskHelpCarPopupCarVO">
        INSERT INTO SA_0175T    --특수차정책이력
        (
          POLICY_TP          --정책유형
         ,SEQ                --일련번호
         ,POLICY_CONT        --정책내용
         ,REG_USR_ID         --등록자ID
         ,REG_DT             --등록일자
         ,UPDT_USR_ID        --수정자ID
         ,UPDT_DT            --수정일자
        )
        VALUES
        (
          #{tpCd}              --정책유형
         ,( SELECT NVL(MAX(SEQ), 0)+1 FROM SA_0175T WHERE POLICY_TP = #{tpCd} )
         ,#{policyCont}        --정책내용
         ,#{regUsrId}          --등록자ID
         ,SYSDATE
         ,#{updtUsrId}         --수정자ID
         ,SYSDATE
        )
    </insert>

    <!-- 특수차정책 인터페이용 프로시져  -->
    <update id="procCarPopupContHists" parameterType="cancDeliveryVO" statementType="CALLABLE">
        {CALL SP_SAL_DCS_P_0175T_IF(
              'SAL132'
            , #{tpCd, mode=IN, jdbcType=VARCHAR})}
    </update>

    <!-- 구원차/대부차 심사 상세 조회  -->
    <select id="selectAskHelpCarJudgePopupContainCnt" parameterType="AskHelpCarSearchVO" resultType="int">
        SELECT count(1)
          FROM SA_0424T A
        LEFT OUTER JOIN SA_0423T B
           ON A.DLR_CD = B.DLR_CD
          AND A.USR_ID = B.USR_ID
          AND A.REQ_NO = B.REQ_NO
          AND B.PEVAL_ID = #{sUserId}
        WHERE A.DLR_CD = #{sDlrCd}
          AND A.USR_ID = #{sUsrId}
          AND A.REQ_NO = #{sReqNo}
        GROUP BY A.DLR_CD, A.USR_ID, A.REQ_NO
    </select>

    <select id="selectAskHelpCarJudgePopupContain" parameterType="AskHelpCarSearchVO" resultType="AskHelpCarVO">
        SELECT A.DLR_CD  AS DLR_CD
             , (SELECT DLR_NM FROM CM_0101T WHERE DLR_CD = A.DLR_CD) AS DLR_NM
             , A.USR_ID  AS USR_ID
             , (SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.USR_ID) AS USR_NM
             , A.REQ_NO  AS REQ_NO
             , MAX(B.SPC_ORD_SEQ)  AS SPC_ORD_SEQ
             , MAX(A.REQ_DT)  AS REQ_DT
             , MAX(A.EVAL_GRADE_CD)  AS EVAL_GRADE_CD
             , MAX(A.SALE_PRSN_NM)  AS SALE_PRSN_NM
             , MAX(A.SALE_PRSN_TEL_NO)  AS SALE_PRSN_TEL_NO
             , MAX(A.TP_CD)  AS TP_CD
             , MAX(A.REQ_TP)  AS REQ_TP
             , MAX(A.UPLOAD_SEQ_RENEWAL)  AS UPLOAD_SEQ_RENEWAL
             , MAX(A.UPLOAD_SEQ)  AS UPLOAD_SEQ
             , MAX(A.REMARK)  AS REMARK
             , MAX(A.APPROVE_CD)  AS APPROVE_CD
             , CASE WHEN MAX(A.APPROVE_CD) = 'A' THEN '02'
                    WHEN MAX(A.APPROVE_CD) = 'B' THEN '02'
                    WHEN MAX(A.APPROVE_CD) = 'C' THEN '01'
                    WHEN MAX(A.APPROVE_CD) = 'D' THEN '01'
                    ELSE '01'
                END AS APPROVES_CD
             , CASE WHEN NVL(MAX(B.EVAL_RSLT_YN), 'B') = 'B' THEN 'B'
                    WHEN NVL(MAX(B.EVAL_RSLT_YN), 'B') = 'Y' THEN 'C'
                    ELSE 'D'
                END AS USE_APPROVE_CD
             , MAX(A.APPROVE_END_DT)  AS APPROVE_END_DT
             , MAX(A.LAST_APPROVE_CNT)  AS LAST_APPROVE_CNT
             , MAX(A.LAST_APPROVE_DT)  AS LAST_APPROVE_DT
             , MAX(A.DEL_YN)  AS DEL_YN
             , MAX(A.FSDM_AGR_YN)  AS FSDM_AGR_YN
             , MAX(A.FSMD_AGR_DT)  AS FSMD_AGR_DT
             , MAX(A.FILE_NM) AS FILE_NM
             , MAX(A.FILE_DOC_NO) AS FILE_DOC_NO
             , MAX(A.FILE_NO) AS FILE_NO
             , MAX(A.FILE_UPLOAD_DT) AS FILE_UPLOAD_DT
             , MAX(A.REG_USR_ID)  AS REG_USR_ID
             , MAX(A.REG_DT)  AS REG_DT
             , MAX(A.UPDT_USR_ID)  AS UPDT_USR_ID
             , MAX(A.UPDT_DT)  AS UPDT_DT
             , MAX(B.EVAL_RSLT_YN)  AS EVAL_RSLT_YN
             , MAX(B.PEVAL_ID)  AS PEVAL_ID
             , MAX(B.EVAL_DT)  AS EVAL_DT
             , MAX(B.REMARK)  AS JUDGE_REMARK
             , MAX(A.POLICY_NOTICE)  AS POLICY_CONT
          FROM SA_0424T A
         LEFT OUTER JOIN SA_0423T B
           ON A.DLR_CD = B.DLR_CD
          AND A.USR_ID = B.USR_ID
          AND A.REQ_NO = B.REQ_NO
          AND B.PEVAL_ID = #{sUserId}
        WHERE A.DLR_CD = #{sDlrCd}
          AND A.USR_ID = #{sUsrId}
          AND A.REQ_NO = #{sReqNo}
        GROUP BY A.DLR_CD, A.USR_ID, A.REQ_NO
    </select>

    <!-- 특수차 심사정보 저장 -->
    <insert id="insertAskHelpCarJudgeDetail" parameterType="AskHelpCarJudgeSaveVO">
          INSERT INTO SA_0423T(
                 DLR_CD
               , USR_ID
               , REQ_NO
               , SPC_ORD_SEQ
               , EVAL_RSLT_YN
               , PEVAL_ID
               , EVAL_DT
               , REMARK
               , REG_USR_ID
               , REG_DT
               , UPDT_USR_ID
               , UPDT_DT
             )VALUES(
                 #{dlrCd}
               , #{usrId}
               , #{reqNo}
               , (SELECT NVL(MAX(SPC_ORD_SEQ), 0)+1 FROM SA_0423T WHERE DLR_CD = #{dlrCd} AND USR_ID = #{usrId} AND REQ_NO = #{reqNo})
               , #{evalRsltYn}
               , #{regUsrId}
               , SYSDATE
               , #{remark}
               , #{regUsrId}
               , SYSDATE
               , #{updtUsrId}
               , SYSDATE
             )
           <selectKey resultType="int" keyProperty="spcOrdSeq" order="AFTER">
               SELECT MAX(SPC_ORD_SEQ) AS spcOrdSeq FROM SA_0423T SA_0423T WHERE DLR_CD = #{dlrCd} AND USR_ID = #{usrId} AND REQ_NO = #{reqNo}
           </selectKey>
    </insert>

    <!-- 심사 승인/불승인 여부 저장 -->
    <update id="updateAskHelpCarJudgeHeader" parameterType="AskHelpCarJudgeSaveVO">
        UPDATE SA_0424T
           SET APPROVE_CD = #{approveCd}
             , APPROVE_END_DT = SYSDATE
             , UPDT_USR_ID = #{updtUsrId}
             , UPDT_DT = SYSDATE
            <if test='approveCd != null and approveCd == "C"' >
             , LAST_APPROVE_CNT = #{lastApproveCnt}
             , LAST_APPROVE_DT = SYSDATE
            </if>
         WHERE DLR_CD = #{dlrCd}
           AND USR_ID = #{usrId}
           AND REQ_NO = #{reqNo}
    </update>

    <!-- 특수차 주차 조회  -->
    <select id="selectWeek" parameterType="AskHelpCarSearchVO" resultType="AskHelpCarPopupCarVO">
        SELECT BTO_YY_MM_DT AS ORD_YY_MM_DT
             , BTO_CNT      AS ORD_PRID
          FROM SA_0432T
         WHERE BTO_WRK_TP = DECODE(#{sTpCd}, 'N1', 'B', 'H')   -- H
           AND SYSDATE BETWEEN START_DT AND END_DT
         ORDER BY BTO_YY_MM_DT, BTO_CNT ASC
    </select>
    <select id="selectWeekCnt" parameterType="AskHelpCarSearchVO" resultType="int">
        SELECT COUNT(*)
          FROM SA_0432T
         WHERE BTO_WRK_TP = DECODE(#{sTpCd}, 'N1', 'B', 'H')   -- H
           AND SYSDATE BETWEEN START_DT AND END_DT
         ORDER BY BTO_YY_MM_DT, BTO_CNT ASC
    </select>

    <!-- 딜러오더 키 조회 -->
    <select id="selectOrdNo" parameterType="AskHelpCarPopupCarVO" resultType="java.lang.String">
     SELECT NVL(LPAD(MAX(ORD_NO)+1 ,4,'0'), '0001')
       FROM SA_0417T
      WHERE DLR_CD = #{dlrCd}
        AND ORD_YY_MM_DT = #{ordYyMmDt}
        AND ORD_PRID = #{ordPrid}
        AND ORD_NO <![CDATA[ < ]]> '5000'
    </select>

    <!-- 특수차 심사 후 딜러오더 생성 -->
    <insert id="insertHelpCarDrlOrd" parameterType="AskHelpCarPopupCarVO">
        INSERT INTO SA_0417T    --딜러오더마스터
        (
          DLR_CD                       --딜러코드
         ,ORD_TP                       --오더유형
         ,ORD_YY_MM_DT                 --오더년월
         ,ORD_PRID                     --오더기간
         ,ORD_NO                       --오더번호
         ,CARLINE_CD                   --차종코드
         ,MODEL_CD                     --모델코드
         ,OCN_CD                       --OCN코드
         ,EXT_COLOR_CD                 --외장색상코드
         ,INT_COLOR_CD                 --내장색상코드
         ,ORD_QTY                      --오더수량
         ,ORD_STAT_CD                  --오더상태코드
         ,APPLY_STAT_CD                --적용상태코드
         ,ERP_TARG_YN                  --ERP대상여부
         ,ERP_SEND_YN                  --ERP전송여부
         ,ORD_DT                       --오더일자
         ,SCRN_ID                      --SCRNID
         ,REG_USR_ID                   --등록자ID
         ,REG_DT                       --등록일자
         ,UPDT_USR_ID                  --수정자ID
         ,UPDT_DT                      --수정일자
        )
        VALUES
        (
          #{dlrCd}                       --딜러코드
         ,#{tpCd}                        --오더유형
         ,#{ordYyMmDt}                   --오더년월
         ,#{ordPrid}                     --오더주기
         ,#{ordNo}                       --오더번호
         ,#{carlineCd}                   --차종코드
         ,#{modelCd}                     --모델코드
         ,#{ocnCd}                       --OCN코드
         ,#{extColorCd}                  --외장색상코드
         ,#{intColorCd}                  --내장색상코드
         ,#{spcCarQty}                   --오더수량
         ,'1D'                           --오더상태코드
         ,'1D'                           --적용상태코드
         ,'Y'                            --ERP대상여부
         ,'N'                            --ERP전송여부
         ,SYSDATE                        --오더일자
         ,''                             --SCRNID
         ,#{regUsrId}                    --등록자ID
         ,SYSDATE                        --등록일자
         ,#{updtUsrId}                   --수정자ID
         ,SYSDATE                        --수정일자
        )
    </insert>

    <!-- 특수차 심사 후 딜러오더 생성 interfaceTable-->
    <insert id="insertHelpCarDrlOrdInterface" parameterType="AskHelpCarPopupCarVO">
        INSERT
          INTO SA_0417IS
        (     SEQ
            , DLR_CD
            , ORD_TP
            , ORD_YY_MM_DT
            , ORD_PRID
            , ORD_NO
            , CARLINE_CD
            , MODEL_CD
            , OCN_CD
            , EXT_COLOR_CD
            , INT_COLOR_CD
            , ORD_QTY
            , ORD_STAT_CD
            , TRSF_DLR_CD
            , ORD_DT
            , REG_USR_ID
            , REG_DT
            , UPDT_USR_ID
            , UPDT_DT
            , IFRESULT
        )
        VALUES
        ((SELECT NVL(MAX(SEQ), 0) + 1 AS SEQ
             FROM SA_0417_1IS
            WHERE ORDT_CMPN_ID = 'H'
              AND ORDT_CORP_CD = 'A07AA'
              AND ORDT_DLR_CD = #{dlrCd}
              AND ORDT_TYPE = #{tpCd}
              AND ORDT_YYMM = #{ordYyMmDt}
              AND ORDT_WEEK = #{ordPrid}
              AND ORDT_ORD_NO = #{ordNo})
         ,#{dlrCd}
         ,#{tpCd}
         ,#{ordYyMmDt}
         ,#{ordPrid}
         ,#{ordNo}
         ,#{carlineCd}
         ,#{modelCd}
         ,#{ocnCd}
         ,#{extColorCd}
         ,#{intColorCd}
         ,#{spcCarQty}
         ,'1D'
         ,#{dlrCd}
         ,SYSDATE
         ,#{regUsrId}
         ,SYSDATE
         ,#{updtUsrId}
         ,SYSDATE
         ,'N'
         )
    </insert>

    <!-- 심사확정 승인 후 오더번호 업데이트 -->
    <update id="updateAskHelpCarOrdNo" parameterType="AskHelpCarPopupCarVO">
        UPDATE SA_0422T
           SET ORD_NO = #{ordNo}
         WHERE DLR_CD = #{dlrCd}
           AND USR_ID = #{usrId}
           AND REQ_NO = #{reqNo}
    </update>


    <!-- 구원차/대부차량신청. : 구원차/대부차주문신청종보수신1 프로시져  -->
    <insert id="procSpCarReq1" parameterType="AskHelpCarPopupCarVO" statementType="CALLABLE">
        {CALL SP_SAL_DMS_P_0422T_IF(
              'SAL094'
            , #{dlrCd, mode=IN, jdbcType=VARCHAR}
            , #{usrId, mode=IN, jdbcType=VARCHAR}
            , #{reqNo, mode=IN, jdbcType=NUMERIC}
            , #{reqSeq, mode=IN, jdbcType=NUMERIC}
        )}
    </insert>


    <!-- 구원차/대부차량신청. : 구원차/대부차주문신청종보수신2 프로시져  -->
    <insert id="procSpCarReq2" parameterType="AskHelpCarVO" statementType="CALLABLE">
        {CALL SP_SAL_DMS_P_0424T_IF(
              'SAL095'
            , #{dlrCd, mode=IN, jdbcType=VARCHAR}
            , #{usrId, mode=IN, jdbcType=VARCHAR}
            , #{reqNo, mode=IN, jdbcType=NUMERIC}
        )}
    </insert>

    <!-- 구원차/대부차 오더등록 프로시져 심사완료후 쿼리로 입력하는 내용으로 변경. 호출 안 함.2016.08.23-->
    <update id="procSpDrlOrd" parameterType="AskHelpCarPopupCarVO" statementType="CALLABLE">
        {CALL SP_SAL_DMS_P_0417T_IF(
              'SAL059'
            , #{dlrCd, mode=IN, jdbcType=VARCHAR}
            , #{tpCd, mode=IN, jdbcType=VARCHAR}
            , #{ordYyMmDt, mode=IN, jdbcType=VARCHAR}
            , #{ordPrid, mode=IN, jdbcType=VARCHAR}
            , #{ordNo, mode=IN, jdbcType=VARCHAR}
        )}
    </update>

    <!-- 시승차주문심서결과정보 송신 프로시져 -->
    <update id="procAskHelpCarJudge" parameterType="AskHelpCarJudgeSaveVO" statementType="CALLABLE">
        {CALL SP_SAL_DCS_P_0423T_IF(
              'SAL093'
            , #{dlrCd, mode=IN, jdbcType=VARCHAR}
            , #{usrId, mode=IN, jdbcType=VARCHAR}
            , #{reqNo, mode=IN, jdbcType=NUMERIC}
            , #{spcOrdSeq, mode=IN, jdbcType=NUMERIC}
        )}
    </update>

</mapper>