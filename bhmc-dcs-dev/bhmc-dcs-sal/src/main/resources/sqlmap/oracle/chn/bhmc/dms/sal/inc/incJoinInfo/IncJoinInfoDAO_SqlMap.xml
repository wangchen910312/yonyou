<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="chn.bhmc.dms.sal.inc.service.dao.IncJoinInfoDAO">

	<!-- 보험가입정보관리목록 조회  -->
	<select id="selectIncJoinInfoByCondition" parameterType="IncJoinInfoSearchVO" resultType="IncJoinInfoVO">
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT SA0216.DLR_CD || SA0216.INC_NO AS INC_PK
                     , FN_GET_CARLINE_NM(SA0216.CARLINE_CD) AS CARLINE_NM
                     , FN_GET_MODEL_NM(SA0216.MODEL_CD) AS MODEL_NM
                     , FN_GET_OCN_NM(SA0121.MODEL_CD,SA0121.OCN_CD) AS OCN_NM
                     , (SELECT EXT_COLOR_NM FROM SA_0107T WHERE EXT_COLOR_CD = SA0121.EXT_COLOR_CD) AS EXT_COLOR_NM
                     , (SELECT INT_COLOR_NM FROM SA_0108T WHERE INT_COLOR_CD = SA0121.INT_COLOR_CD) AS INT_COLOR_NM
                     , CR0101.CUST_TP,CR0101.CUST_NM
                     , SA0216.DLR_CD,SA0216.INC_NO,SA0216.CARLINE_CD,SA0216.MODEL_CD,SA0216.VIN_NO,SA0216.ENGIN_SERIAL_NO
                     , SA0216.CART_NO,SA0216.CAR_SALE_DT,SA0216.INC_EXPC_TOT_AMT,SA0216.REAL_INC_TOT_AMT
                     , SA0216.INC_FEE_TOT_AMT,SA0216.SALE_ID,SA0216.INC_JOIN_DT,SA0216.CUST_NO,SA0216.CUST_TEL_NO
                     , SA0216.INC_PROFIT_NM,SA0216.INC_PRSN_ID,SA0216.CONTRACT_NO,SA0216.INC_RCPT_NM,SA0216.CUST_SSN_CRN_NO
                     , SA0216.INC_CMP_CD,SA0216.DUTY_INC_NO,SA0216.CMC_INC_NO
                     , SA0216.REG_USR_ID,SA0216.REG_DT,SA0216.UPDT_USR_ID,SA0216.UPDT_DT
                  FROM SA_0216T SA0216, CR_0101T CR0101,SA_0121T SA0121
                 WHERE 1=1
                   AND SA0216.CUST_NO = CR0101.CUST_NO(+)
                   AND SA0216.VIN_NO = SA0121.VIN_NO(+)
                   AND SA0216.DLR_CD = #{sDlrCd}
                 <if test='sVinNo1 != null and sVinNo1 != ""'>
                    AND SUBSTR(SA0216.VIN_NO,0,11) = #{sVinNo1}
                 </if>
                 <if test='sVinNo2 != null and sVinNo2 != ""'>
                    AND SUBSTR(SA0216.VIN_NO,12,6) = #{sVinNo2}
                 </if>
                 <if test='sVinNo != null and sVinNo != ""'>
                    AND SA0216.VIN_NO = #{sVinNo}
                 </if>
                 <if test='sSaleId != null and sSaleId != ""'>
                    AND SA0216.SALE_ID = #{sSaleId}
                 </if>
                 <if test='sIncCmpCd != null and sIncCmpCd != ""'>
                    AND SA0216.INC_CMP_CD = #{sIncCmpCd}
                 </if>
                 <if test='sCustNo != null and sCustNo != ""'>
                    AND SA0216.CUST_NO = #{sCustNo}
                 </if>
                 <if test='sContractNo != null and sContractNo != ""'>
                    AND SA0216.CONTRACT_NO = #{sContractNo}
                 </if>
                 <if test='sIncJoinStartDt != null'>
                     <choose>
                         <otherwise>
                             AND SA0216.INC_JOIN_DT <![CDATA[>=]]> #{sIncJoinStartDt}
                         </otherwise>
                     </choose>
                 </if>
                 <if test='sIncJoinEndDt != null'>
                     <choose>
                         <otherwise>
                             AND SA0216.INC_JOIN_DT <![CDATA[<=]]> #{sIncJoinEndDt} + 1
                         </otherwise>
                     </choose>
                 </if>
                 <if test='sCarSaleStartDt != null'>
                     <choose>
                         <otherwise>
                             AND SA0216.CAR_SALE_DT <![CDATA[>=]]> #{sCarSaleStartDt}
                         </otherwise>
                     </choose>
                 </if>
                 <if test='sCarSaleEndDt != null'>
                     <choose>
                         <otherwise>
                             AND SA0216.CAR_SALE_DT <![CDATA[<=]]> #{sCarSaleEndDt} + 1
                         </otherwise>
                     </choose>
                 </if>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
         ORDER BY
         <choose>
            <when test='sort != null'>
                <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                    <choose>
                        <when test='item.field == "custNo"'>CUST_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "custNm"'>CUST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "custTelNo"'>CUST_TEL_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "carlineNm"'>CARLINE_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "modelNm"'>MODEL_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "vinNo"'>VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "incCmpCd"'>INC_CMP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "incAmt"'>INC_EXPC_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "realIncAmt"'>REAL_INC_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "profitAmt"'>INC_FEE_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "incNo"'>INC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "saleNm"'>SALE_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "incJoinDt"'>INC_JOIN_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "carRegNo"'>CAR_REG_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "carSaleDt"'>CAR_SALE_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "incPrsnId"'>INC_PRSN_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "icnProfitNm"'>INC_PROFIT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <otherwise>
                            INC_NO DESC
                        </otherwise>
                    </choose>
                </foreach>
            </when>
            <otherwise>
                INC_NO DESC
            </otherwise>
        </choose>
	</select>



	<!-- 보험가입정보관리목록 갯수  -->
	<select id="selectIncJoinInfoByConditionCnt" parameterType="IncJoinInfoSearchVO" resultType="int">
        SELECT COUNT(*) AS VALUE
          FROM SA_0216T SA0216, CR_0101T CR0101,SA_0121T SA0121
         WHERE 1=1
           AND SA0216.CUST_NO = CR0101.CUST_NO(+)
           AND SA0216.VIN_NO = SA0121.VIN_NO(+)
           AND SA0216.DLR_CD = #{sDlrCd}
         <if test='sVinNo1 != null and sVinNo1 != ""'>
            AND SUBSTR(SA0216.VIN_NO,0,11) = #{sVinNo1}
         </if>
         <if test='sVinNo2 != null and sVinNo2 != ""'>
            AND SUBSTR(SA0216.VIN_NO,12,6) = #{sVinNo2}
         </if>
         <if test='sVinNo != null and sVinNo != ""'>
            AND SA0216.VIN_NO = #{sVinNo}
         </if>
         <if test='sSaleId != null and sSaleId != ""'>
            AND SA0216.SALE_ID = #{sSaleId}
         </if>
         <if test='sIncCmpCd != null and sIncCmpCd != ""'>
            AND SA0216.INC_CMP_CD = #{sIncCmpCd}
         </if>
         <if test='sCustNo != null and sCustNo != ""'>
            AND SA0216.CUST_NO = #{sCustNo}
         </if>
         <if test='sContractNo != null and sContractNo != ""'>
            AND SA0216.CONTRACT_NO = #{sContractNo}
         </if>
         <if test='sIncJoinStartDt != null'>
             <choose>
                 <otherwise>
                     AND SA0216.INC_JOIN_DT <![CDATA[>=]]> #{sIncJoinStartDt}
                 </otherwise>
             </choose>
         </if>
         <if test='sIncJoinEndDt != null'>
             <choose>
                 <otherwise>
                     AND SA0216.INC_JOIN_DT <![CDATA[<=]]> #{sIncJoinEndDt} + 1
                 </otherwise>
             </choose>
         </if>
         <if test='sCarSaleStartDt != null'>
             <choose>
                 <otherwise>
                     AND SA0216.CAR_SALE_DT <![CDATA[>=]]> #{sCarSaleStartDt}
                 </otherwise>
             </choose>
         </if>
         <if test='sCarSaleEndDt != null'>
             <choose>
                 <otherwise>
                     AND SA0216.CAR_SALE_DT <![CDATA[<=]]> #{sCarSaleEndDt} + 1
                 </otherwise>
             </choose>
         </if>
	</select>

    <select id="selectSungCd" parameterType="IncJoinInfoSearchVO" resultType="IncJoinInfoVO">
        SELECT SUNG_CD,MAX(SUNG_NM) AS SUNG_NM
          FROM CM_0205T
         WHERE USE_YN = 'Y'
         GROUP BY SUNG_CD
    </select>


    <select id="selectCityCd" parameterType="IncJoinInfoSearchVO" resultType="IncJoinInfoVO">
        SELECT CITY_CD,MAX(CITY_NM) AS CITY_NM
          FROM CM_0205T
         WHERE 1=1
           AND SUNG_CD = #{sungCd}
           AND USE_YN = 'Y'
         GROUP BY CITY_CD
    </select>

    <select id="selectDistCd" parameterType="IncJoinInfoSearchVO" resultType="IncJoinInfoVO">
        SELECT DIST_CD,DIST_NM AS DIST_NM,ZIP_CD
          FROM CM_0205T
         WHERE 1=1
           AND SUNG_CD = #{sungCd}
           AND CITY_CD = #{cityCd}
           AND USE_YN = 'Y'
    </select>



    <!-- 보험정보를 등록한다. -->
    <insert id="insertIncJoinInfo" parameterType="IncJoinInfoVO">
        INSERT INTO SA_0216T(
               DLR_CD           ,INC_NO
              ,CARLINE_CD       ,MODEL_CD           ,VIN_NO             ,ENGIN_SERIAL_NO    ,CART_NO         ,CAR_REG_NO
              ,CAR_SALE_DT      ,INC_EXPC_TOT_AMT   ,REAL_INC_TOT_AMT   ,INC_FEE_TOT_AMT    ,SALE_ID         ,INC_JOIN_DT
              ,CUST_NO          ,CUST_TEL_NO        ,INC_PROFIT_NM      ,INC_PRSN_ID        ,CONTRACT_NO     ,INC_RCPT_NM
              ,CUST_SSN_CRN_NO  ,INC_CMP_CD         ,DUTY_INC_NO        ,CMC_INC_NO         ,CUST_SSN_CRN_TP ,CUST_TP
              ,REG_USR_ID       ,REG_DT             ,UPDT_USR_ID        ,UPDT_DT
              ,CAR_BRAND_CD     ,USE_CAR_NM         ,NCAR_DSTIN_CD
        )VALUES(
               #{dlrCd}         ,(SELECT 'INC' || LPAD(NVL(MAX(SUBSTR(INC_NO,-10)),0)+1,'10','0') FROM SA_0216T)
              ,#{carlineCd}     ,#{modelCd}         ,#{vinNo}           ,#{enginSerialNo}   ,#{cartNo}       ,#{carRegNo}
              ,#{carSaleDt}     ,#{incExpcTotAmt}   ,#{realIncTotAmt}   ,#{incFeeTotAmt}    ,#{saleId}       ,#{incJoinDt}
              ,#{custNo}        ,#{custTelNo}       ,#{incProfitNm}     ,#{incPrsnId}       ,#{contractNo}   ,#{incRcptNm}
              ,#{custSsnCrnNo}  ,#{incCmpCd}        ,#{dutyIncNo}       ,#{cmcIncNo}        ,#{custSsnCrnTp} ,#{custTp}
              ,#{regUsrId}      ,SYSDATE            ,#{regUsrId}        ,SYSDATE
              ,#{carBrandCd}    ,#{useCarNm}        ,#{ncarDstinCd}
        )
        <selectKey resultType="String" keyProperty="incNo" order="AFTER">
            SELECT MAX(INC_NO) AS incNo FROM SA_0216T WHERE DLR_CD = #{dlrCd}
        </selectKey>
    </insert>


    <!-- 보험정보를 내용을 저장.  -->
    <update id="updateIncJoinInfo" parameterType="IncJoinInfoVO">
        UPDATE SA_0216T
           SET INC_EXPC_TOT_AMT = #{incExpcTotAmt}
             , REAL_INC_TOT_AMT = #{realIncTotAmt}
             , INC_FEE_TOT_AMT = #{incFeeTotAmt}
             , SALE_ID = #{saleId}
             , INC_PROFIT_NM = #{incProfitNm}
             , INC_PRSN_ID = #{incPrsnId}
             , INC_RCPT_NM = #{incRcptNm}
             , INC_CMP_CD = #{incCmpCd}
             , DUTY_INC_NO = #{dutyIncNo}
             , CMC_INC_NO = #{cmcIncNo}
             , UPDT_USR_ID = #{updtUsrId}
             , UPDT_DT = SYSDATE
        WHERE 1=1
          AND DLR_CD = #{dlrCd}
          AND INC_NO = #{incNo}
    </update>


    <select id="selectCustContractNoCnt" parameterType="IncJoinInfoSearchVO" resultType="int">
        SELECT COUNT(*) AS VALUE
          FROM SA_0201T SA0201,SA_0121T SA0121,CR_0101T CR0101
         WHERE 1=1
           AND SA0201.DLR_CD = SA0121.DLR_CD
           AND SA0201.CONTRACT_NO = SA0121.CONTRACT_NO
           AND SA0201.VIN_NO = SA0121.VIN_NO
           AND SA0201.CONTRACT_CUST_NO = CR0101.CUST_NO
           AND SA0201.CONTRACT_CUST_NO = #{sCustNo}
           AND SA0201.CONTRACT_STAT_CD = '50'
           AND SA0201.DLR_CD = #{sDlrCd}
    </select>

    <!-- 고객정보 불러온다. -->
    <select id="selectCustContractNo" parameterType="IncJoinInfoSearchVO" resultType="IncJoinInfoVO">
        SELECT *
          FROM (    
                SELECT SA0201.CONTRACT_NO
                     , SA0201.dlr_cd
                     , SA0201.CONTRACT_CUST_NO 
                     , SA0121.VIN_NO
                     , SA0201.CARLINE_CD
                     , FN_GET_CARLINE_NM(SA0201.CARLINE_CD) AS CARLINE_NM
                     , SA0201.MODEL_CD
                     , FN_GET_MODEL_NM(SA0201.MODEL_CD) AS MODEL_NM
                     , SA0201.OCN_CD
                     , FN_GET_OCN_NM(SA0201.MODEL_CD, SA0201.OCN_CD) AS OCN_NM
                     , SA0201.EXT_COLOR_CD
                     , (SELECT EXT_COLOR_NM FROM SA_0107T WHERE EXT_COLOR_CD = SA0201.EXT_COLOR_CD) AS EXT_COLOR_NM
                     , SA0201.INT_COLOR_CD
                     ,(SELECT INT_COLOR_NM FROM SA_0108T WHERE INT_COLOR_CD = SA0201.INT_COLOR_CD) AS INT_COLOR_NM
                     , CR0101.CUST_TP
                     , CR0101.HP_NO AS CUST_TEL_NO
                     , SA0121.ENGIN_SERIAL_NO
                     , SA0121.CERT_NO AS CART_NO
                     , SA0121.CAR_REG_NO
                     , SA0121.temp1 as USE_CAR_NM
                     , SA0121.CAR_BRAND_CD AS CAR_BRAND_CD
                     , '' AS CAR_BRAND_NM
                     , SA0121.NCAR_DSTIN_CD
                  FROM SA_0201T SA0201
                     , SA_0121T SA0121
                     , CR_0101T CR0101
                 WHERE SA0201.DLR_CD = SA0121.ORD_DLR_CD(+)
                   AND SA0201.CONTRACT_NO = SA0121.CONTRACT_NO(+)
                   AND SA0201.VIN_NO = SA0121.VIN_NO(+)
                   AND SA0201.CONTRACT_CUST_NO = CR0101.CUST_NO(+)
                   AND SA0201.CONTRACT_CUST_NO = #{sCustNo}
                   AND SA0201.CONTRACT_STAT_CD IN ('20','50')
                   AND SA0201.DLR_CD = #{sDlrCd}
            UNION      
                SELECT A.*
                     , ( SELECT Z1.CMM_CD_NM
                           FROM (SELECT A.CMM_CD
                                      , NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM
                                   FROM CM_0303T A
                                   LEFT OUTER JOIN CM_0304T B
                                     ON A.CMM_GRP_CD = B.CMM_GRP_CD
                                    AND A.CMM_CD = B.CMM_CD
                                    AND B.LANG_CD = #{sLangCd}
                                 WHERE A.CMM_GRP_CD = 'COM019'
                                   AND A.USE_YN = 'Y'
                                 ) Z1
                         WHERE A.CAR_BRAND_CD = Z1.CMM_CD
                       ) AS CAR_BRAND_NM
                  FROM (    
                        SELECT '外代客户 '  AS CONTRACT_NO --  타사고객
                             , A.DLR_CD
                             , B.CUST_NO AS CONTRACT_CUST_NO
                             , C.VIN_NO
                             , MAX(C.CARLINE_CD) AS CARLINE_CD
                             , '' AS CARLINE_NM
                             , '' AS MODEL_CD
                             , '' AS MODEL_NM
                             , '' AS OCN_CD
                             , '' AS OCN_NM
                             , '' AS EXT_COLOR_CD
                             , '' AS EXT_COLOR_NM
                             , '' AS INT_COLOR_CD
                             , '' AS INT_COLOR_NM
                             , MAX(B.CUST_TP) AS CUST_TP
                             , MAX(B.HP_NO) AS HP_NO
                             , MAX(C.ENGIN_SERIAL_NO) AS ENGIN_SERIAL_NO
                             , MAX(C.CERT_NO) AS CERT_NO
                             , MAX(C.CAR_REG_NO) AS CAR_REG_NO
                             , MAX(C.TEMP1) AS USE_CAR_NM
                             , MAX(C.CAR_BRAND_CD) AS CAR_BRAND_CD
                             , MAX(C.NCAR_DSTIN_CD) AS NCAR_DSTIN_CD
                          FROM SA_0123T A
                             , CR_0101T B
                             , SA_0121T C
                         WHERE A.DLR_CD = B.DLR_CD
                           AND A.BP_CD  = B.CUST_NO
                           AND A.DLR_CD = C.ORD_DLR_CD
                           AND A.CAR_ID = C.CAR_ID
                           AND A.USE_YN = 'Y'
                           AND C.NCAR_DSTIN_CD = 'O'               
                           AND A.BP_CD = #{sCustNo}
                           AND a.DLR_CD = #{sDlrCd}
                           GROUP BY A.DLR_CD, B.CUST_NO, C.VIN_NO 
                       ) A
            )
    </select>


    <!-- 보험가입명세 목록의 갯수를 조회한다. -->
    <select id="selectIncDetailItemCnt" parameterType="IncJoinInfoSearchVO" resultType="int">
        SELECT COUNT(*) AS VALUE
          FROM SA_0253T SA0253
         WHERE 1=1
           AND SA0253.DLR_CD = #{sDlrCd}
           AND SA0253.INC_NO = #{sIncNo}
    </select>


    <!-- 보험가입명세 목록을 조회한다. -->
    <select id="selectIncDetailItem" parameterType="IncJoinInfoSearchVO" resultType="IncJoinInfoVO">
        SELECT SA0253.DLR_CD || SA0253.INC_NO || SA0253.INC_TP AS INC_PK
             , SA0253.DLR_CD,SA0253.INC_NO,SA0253.INC_TP,SA0253.INC_EXPC_AMT,SA0253.REAL_INC_AMT
             , SA0253.INC_PRID,SA0253.INC_START_DT,SA0253.INC_END_DT,SA0253.INC_AMT,SA0253.REMARK
             , SA0253.REG_USR_ID,SA0253.REG_DT,SA0253.UPDT_USR_ID,SA0253.UPDT_DT
          FROM SA_0253T SA0253
         WHERE 1=1
           AND SA0253.DLR_CD = #{sDlrCd}
           AND SA0253.INC_NO = #{sIncNo}
    </select>




    <!-- 보험가입명세 등록. -->
    <insert id="insertIncDetailItem" parameterType="IncJoinInfoVO">
        INSERT INTO SA_0253T(
               DLR_CD           ,INC_NO             ,INC_TP             ,INC_EXPC_AMT       ,REAL_INC_AMT   ,INC_PRID
              ,INC_START_DT     ,INC_END_DT         ,INC_AMT            ,REMARK
              ,REG_USR_ID       ,REG_DT             ,UPDT_USR_ID        ,UPDT_DT
        )VALUES(
               #{dlrCd}         ,#{incNo}           ,#{incTp}           ,#{incExpcAmt}      ,#{realIncAmt}  ,#{incPrid}
              ,#{incStartDt}    ,#{incEndDt}        ,#{incAmt}          ,#{remark}
              ,#{regUsrId}      ,SYSDATE            ,#{regUsrId}        ,SYSDATE
        )
    </insert>



    <!-- 보험가입명세 수정. -->
    <update id="updateIncDetailItem" parameterType="IncJoinInfoVO">
        UPDATE SA_0253T
           SET INC_EXPC_AMT = #{incExpcAmt}
             , REAL_INC_AMT = #{realIncAmt}
             , INC_PRID = #{incPrid}
             , INC_START_DT = #{incStartDt}
             , INC_END_DT = #{incEndDt}
             , INC_AMT = #{incAmt}
             , REMARK = #{remark}
             , REG_USR_ID = #{regUsrId}
             , REG_DT = SYSDATE
             , UPDT_USR_ID = #{regUsrId}
             , UPDT_DT = SYSDATE
         WHERE 1=1
           AND DLR_CD = #{dlrCd}
           AND INC_NO = #{incNo}
           AND INC_TP = #{incTp}
    </update>


    <!-- 보험가입명세 삭제. -->
    <delete id="deleteIncDetailItem" parameterType="IncJoinInfoVO">
        DELETE SA_0253T
         WHERE 1=1
           AND DLR_CD = #{dlrCd}
           AND INC_NO = #{incNo}
           AND INC_TP = #{incTp}
    </delete>



    <!-- 보험가입정보관리 상세  -->
    <select id="selectIncDetail" parameterType="IncJoinInfoSearchVO" resultType="IncJoinInfoVO">
        SELECT SA0216.DLR_CD || SA0216.INC_NO AS INC_PK
             , FN_GET_CARLINE_NM(SA0216.CARLINE_CD) AS CARLINE_NM
             , FN_GET_MODEL_NM(SA0216.MODEL_CD) AS MODEL_NM
             , FN_GET_OCN_NM(SA0121.MODEL_CD,SA0121.OCN_CD) AS OCN_NM
             , (SELECT EXT_COLOR_NM FROM SA_0107T WHERE EXT_COLOR_CD = SA0121.EXT_COLOR_CD) AS EXT_COLOR_NM
             , (SELECT INT_COLOR_NM FROM SA_0108T WHERE INT_COLOR_CD = SA0121.INT_COLOR_CD) AS INT_COLOR_NM
             , SA0216.CUST_TP,CR0101.CUST_NM
             , SA0216.DLR_CD,SA0216.INC_NO,SA0216.CARLINE_CD,SA0216.MODEL_CD,SA0216.VIN_NO,SA0216.ENGIN_SERIAL_NO
             , SA0216.CART_NO,SA0216.CAR_SALE_DT,SA0216.INC_EXPC_TOT_AMT,SA0216.REAL_INC_TOT_AMT
             , SA0216.INC_FEE_TOT_AMT,SA0216.SALE_ID,SA0216.INC_JOIN_DT,SA0216.CUST_NO,SA0216.CUST_TEL_NO
             , SA0216.INC_PROFIT_NM,SA0216.INC_PRSN_ID,SA0216.INC_RCPT_NM,SA0216.CUST_SSN_CRN_NO
             , SA0216.INC_CMP_CD,SA0216.DUTY_INC_NO,SA0216.CMC_INC_NO
             , SA0216.REG_USR_ID,SA0216.REG_DT,SA0216.UPDT_USR_ID,SA0216.UPDT_DT
             , (SELECT CONTRACT_NO FROM SA_0201T WHERE CONTRACT_CUST_NO = SA0216.CUST_NO AND VIN_NO = SA0216.VIN_NO) AS CONTRACT_NO
             , SA0216.CAR_BRAND_CD
             , ( SELECT Z1.CMM_CD_NM
                   FROM (SELECT A.CMM_CD
                              , NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM
                           FROM CM_0303T A
                           LEFT OUTER JOIN CM_0304T B
                             ON A.CMM_GRP_CD = B.CMM_GRP_CD
                            AND A.CMM_CD = B.CMM_CD
                            AND B.LANG_CD = #{sLangCd}
                         WHERE A.CMM_GRP_CD = 'COM019'
                           AND A.USE_YN = 'Y'
                         ) Z1
                  WHERE SA0216.CAR_BRAND_CD = Z1.CMM_CD
               ) AS CAR_BRAND_NM
             , SA0216.USE_CAR_NM
             , SA0216.NCAR_DSTIN_CD
             
          FROM SA_0216T SA0216, CR_0101T CR0101,SA_0121T SA0121
         WHERE 1=1
           AND SA0216.CUST_NO = CR0101.CUST_NO(+)
           AND SA0216.VIN_NO = SA0121.VIN_NO(+)
           AND SA0216.INC_NO = #{sIncNo}
           AND SA0216.DLR_CD = #{sDlrCd}
    </select>


</mapper>