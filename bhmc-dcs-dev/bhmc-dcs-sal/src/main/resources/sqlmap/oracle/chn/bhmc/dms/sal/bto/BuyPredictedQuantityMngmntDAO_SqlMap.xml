<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="chn.bhmc.dms.sal.bto.service.dao.BuyPredictedQuantityMngmntDAO">

    <!-- 주문 예측/완성 수량 Data  -->
    <select id="selectBuyPredictedQuantityMngmntByCondition" parameterType="BuyPredictedQuantityMngmntSearchVO" resultType="BuyPredictedQuantityMngmntVO">
        SELECT AA.DLR_CD AS DLR_CD
             , (SELECT '[' || NVL(A.DLR_CD, '') || ']' || DLR_NM FROM CM_0101T A WHERE A.DLR_CD = AA.DLR_CD) AS DLR_NM
             , #{sYear} AS YY
             , SUM(AA.MONTH_CNT) AS COMPLETE_QUANTITY_01
             , ROUND((SUM(AA.MONTH_CNT_B3) + SUM(AA.MONTH_CNT_B2) + SUM(AA.MONTH_CNT_B1))/3, 0) AS PREDICTION_UNIT_01
             , SUM(AA.MONTH_CNT_A1) AS COMPLETE_QUANTITY_02
             , ROUND((SUM(AA.MONTH_CNT_B2) + SUM(AA.MONTH_CNT_B1) + SUM(AA.MONTH_CNT))/3, 0) AS PREDICTION_UNIT_02
             , SUM(AA.MONTH_CNT_A2) AS COMPLETE_QUANTITY_03
             , ROUND((SUM(AA.MONTH_CNT_B1) + SUM(AA.MONTH_CNT) + SUM(AA.MONTH_CNT_A1))/3, 0) AS PREDICTION_UNIT_03
             , SUM(AA.MONTH_CNT_A3) AS COMPLETE_QUANTITY_04
             , ROUND((SUM(AA.MONTH_CNT) + SUM(AA.MONTH_CNT_A1) + SUM(AA.MONTH_CNT_A2))/3, 0) AS PREDICTION_UNIT_04
             , SUM(AA.MONTH_CNT_A4) AS COMPLETE_QUANTITY_05
             , ROUND((SUM(AA.MONTH_CNT_A1) + SUM(AA.MONTH_CNT_A2) + SUM(AA.MONTH_CNT_A3))/3, 0) AS PREDICTION_UNIT_05
             , SUM(AA.MONTH_CNT_A5) AS COMPLETE_QUANTITY_06
             , ROUND((SUM(AA.MONTH_CNT_A2) + SUM(AA.MONTH_CNT_A3) + SUM(AA.MONTH_CNT_A4))/3, 0) AS PREDICTION_UNIT_06
             , SUM(AA.MONTH_CNT_A6) AS COMPLETE_QUANTITY_07
             , ROUND((SUM(AA.MONTH_CNT_A3) + SUM(AA.MONTH_CNT_A4) + SUM(AA.MONTH_CNT_A5))/3, 0) AS PREDICTION_UNIT_07
             , SUM(AA.MONTH_CNT_A7) AS COMPLETE_QUANTITY_08
             , ROUND((SUM(AA.MONTH_CNT_A4) + SUM(AA.MONTH_CNT_A5) + SUM(AA.MONTH_CNT_A6))/3, 0) AS PREDICTION_UNIT_08
             , SUM(AA.MONTH_CNT_A8) AS COMPLETE_QUANTITY_09
             , ROUND((SUM(AA.MONTH_CNT_A5) + SUM(AA.MONTH_CNT_A6) + SUM(AA.MONTH_CNT_A7))/3, 0) AS PREDICTION_UNIT_09
             , SUM(AA.MONTH_CNT_A9) AS COMPLETE_QUANTITY_10
             , ROUND((SUM(AA.MONTH_CNT_A6) + SUM(AA.MONTH_CNT_A7) + SUM(AA.MONTH_CNT_A8))/3, 0) AS PREDICTION_UNIT_10
             , SUM(AA.MONTH_CNT_A10) AS COMPLETE_QUANTITY_11
             , ROUND((SUM(AA.MONTH_CNT_A7) + SUM(AA.MONTH_CNT_A6) + SUM(AA.MONTH_CNT_A5))/3, 0) AS PREDICTION_UNIT_11
             , SUM(AA.MONTH_CNT_A11) AS COMPLETE_QUANTITY_12
             , ROUND((SUM(AA.MONTH_CNT_A8) + SUM(AA.MONTH_CNT_A9) + SUM(AA.MONTH_CNT_A10))/3, 0) AS PREDICTION_UNIT_12
          FROM (
        SELECT A.DLR_CD
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_B3, A.CNT, 0) AS MONTH_CNT_B3
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_B2, A.CNT, 0) AS MONTH_CNT_B2
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_B1, A.CNT, 0) AS MONTH_CNT_B1
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT, A.CNT, 0) AS MONTH_CNT
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A1, A.CNT, 0) AS MONTH_CNT_A1
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A2, A.CNT, 0) AS MONTH_CNT_A2
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A3, A.CNT, 0) AS MONTH_CNT_A3
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A4, A.CNT, 0) AS MONTH_CNT_A4
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A5, A.CNT, 0) AS MONTH_CNT_A5
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A6, A.CNT, 0) AS MONTH_CNT_A6
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A7, A.CNT, 0) AS MONTH_CNT_A7
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A8, A.CNT, 0) AS MONTH_CNT_A8
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A9, A.CNT, 0) AS MONTH_CNT_A9
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A10, A.CNT, 0) AS MONTH_CNT_A10
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A11, A.CNT, 0) AS MONTH_CNT_A11
          FROM (SELECT DLR_CD
                     , TO_CHAR(REAL_DL_DT, 'YYYY-MM') AS REAL_DL_DT
                     , COUNT(DLR_CD) AS CNT FROM SA_0201T
                 WHERE TO_DATE(TO_CHAR(REAL_DL_DT, 'YYYYMM'), 'YYYYMM') BETWEEN ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), -3) AND ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 11)
                   AND DLR_CD = #{sDlrCd}
                   AND CONTRACT_STAT_CD = '50'
                 GROUP BY DLR_CD, TO_CHAR(REAL_DL_DT, 'YYYY-MM')) A
             , (SELECT #{sDlrCd} AS DLR_CD
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), -3), 'YYYY-MM') AS REAL_DL_DT_B3
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), -2), 'YYYY-MM') AS REAL_DL_DT_B2
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), -1), 'YYYY-MM') AS REAL_DL_DT_B1
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 0), 'YYYY-MM') AS REAL_DL_DT
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 1), 'YYYY-MM') AS REAL_DL_DT_A1
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 2), 'YYYY-MM') AS REAL_DL_DT_A2
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 3), 'YYYY-MM') AS REAL_DL_DT_A3
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 4), 'YYYY-MM') AS REAL_DL_DT_A4
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 5), 'YYYY-MM') AS REAL_DL_DT_A5
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 6), 'YYYY-MM') AS REAL_DL_DT_A6
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 7), 'YYYY-MM') AS REAL_DL_DT_A7
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 8), 'YYYY-MM') AS REAL_DL_DT_A8
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 9), 'YYYY-MM') AS REAL_DL_DT_A9
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 10), 'YYYY-MM') AS REAL_DL_DT_A10
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 11), 'YYYY-MM') AS REAL_DL_DT_A11
                  FROM DUAL) B
         WHERE A.DLR_CD = B.DLR_CD
    UNION ALL
        SELECT A.DLR_CD
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_B3, A.CNT, 0) AS MONTH_CNT_B3
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_B2, A.CNT, 0) AS MONTH_CNT_B2
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_B1, A.CNT, 0) AS MONTH_CNT_B1
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT, A.CNT, 0) AS MONTH_CNT
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A1, A.CNT, 0) AS MONTH_CNT_A1
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A2, A.CNT, 0) AS MONTH_CNT_A2
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A3, A.CNT, 0) AS MONTH_CNT_A3
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A4, A.CNT, 0) AS MONTH_CNT_A4
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A5, A.CNT, 0) AS MONTH_CNT_A5
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A6, A.CNT, 0) AS MONTH_CNT_A6
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A7, A.CNT, 0) AS MONTH_CNT_A7
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A8, A.CNT, 0) AS MONTH_CNT_A8
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A9, A.CNT, 0) AS MONTH_CNT_A9
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A10, A.CNT, 0) AS MONTH_CNT_A10
             , DECODE( A.REAL_DL_DT, B.REAL_DL_DT_A11, A.CNT, 0) AS MONTH_CNT_A11
          FROM (SELECT DLR_CD,
                       TO_CHAR(ORD_DT, 'YYYY-MM') AS REAL_DL_DT,
                       COUNT(DLR_CD) AS CNT
                  FROM SA_0417T
                 WHERE DLR_CD = #{sDlrCd}
                   AND ORD_STAT_CD = '1G'
                   AND TO_DATE(TO_CHAR(ORD_DT, 'YYYYMM'), 'YYYYMM') BETWEEN ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), -4) AND ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 11)
                 GROUP BY DLR_CD, TO_CHAR(ORD_DT, 'YYYY-MM')) A
             , (SELECT #{sDlrCd} AS DLR_CD
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), -3), 'YYYY-MM') AS REAL_DL_DT_B3
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), -2), 'YYYY-MM') AS REAL_DL_DT_B2
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), -1), 'YYYY-MM') AS REAL_DL_DT_B1
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 0), 'YYYY-MM') AS REAL_DL_DT
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 1), 'YYYY-MM') AS REAL_DL_DT_A1
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 2), 'YYYY-MM') AS REAL_DL_DT_A2
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 3), 'YYYY-MM') AS REAL_DL_DT_A3
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 4), 'YYYY-MM') AS REAL_DL_DT_A4
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 5), 'YYYY-MM') AS REAL_DL_DT_A5
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 6), 'YYYY-MM') AS REAL_DL_DT_A6
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 7), 'YYYY-MM') AS REAL_DL_DT_A7
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 8), 'YYYY-MM') AS REAL_DL_DT_A8
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 9), 'YYYY-MM') AS REAL_DL_DT_A9
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 10), 'YYYY-MM') AS REAL_DL_DT_A10
                     , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYear} || '01', 'YYYYMM'), 11), 'YYYY-MM') AS REAL_DL_DT_A11
                  FROM DUAL) B
         WHERE A.DLR_CD = B.DLR_CD
         ) AA
         GROUP BY AA.DLR_CD
    </select>

    <!-- 주문예측수량 상세내역 조회 -->
    <select id="selectBuyPredictedQuantityMngmntDetailByCondition" parameterType="BuyPredictedQuantityMngmntSearchVO" resultType="BuyPredictedQuantityMngmntDetailVO">
        SELECT A.DLR_CD, A.CARLINE_CD, A.MODEL_CD, A.OCN_CD, A.EXT_COLOR_CD, A.INT_COLOR_CD
             , FN_GET_CARLINE_NM(A.CARLINE_CD) AS CARLINE_NM
             , FN_GET_MODEL_NM(A.MODEL_CD) AS MODEL_NM
             , FN_GET_OCN_NM(A.MODEL_CD, A.OCN_CD) AS OCN_NM
             , FN_GET_EXT_COLOR_NM(A.EXT_COLOR_CD) AS EXT_COLOR_NM
             , FN_GET_INT_COLOR_NM(A.INT_COLOR_CD) AS INT_COLOR_NM
             , SUM(MONTH_CONT)     AS MONTH_CONT             -- 당월 판매수량
             , SUM(MONTH_CONT_B1)  AS MONTH_CONT_B1          -- 전원 판매수량
             , SUM(MONTH_CONT_B2)  AS MONTH_CONT_B2          -- 2달전 판매수량
             , SUM(MONTH_CONT_B3)  AS MONTH_CONT_B3          -- 3달전 판매수량
             , SUM(AVERAGE_CONT)   AS AVERAGE_CONT           -- 전3개월 평균 판매수량
             , SUM(NO_ASSIGN)      AS NO_ASSIGN              -- 미배정 주문수량
             , SUM(ASSIGN)         AS ASSIGN                 -- 주문수량
             , SUM(STOCK_CNT)      AS STOCK_CNT              -- 재고수량
             , SUM(POSI_STOCK_CNT) AS POSI_STOCK_CNT         -- 판매가능재고수량
          FROM (
                  SELECT A.DLR_CD, A.CARLINE_CD, A.MODEL_CD, A.OCN_CD, A.EXT_COLOR_CD, A.INT_COLOR_CD
                       , SUM(MONTH_CNT)    AS MONTH_CONT
                       , SUM(MONTH_CNT_B1) AS MONTH_CONT_B1
                       , SUM(MONTH_CNT_B2) AS MONTH_CONT_B2
                       , SUM(MONTH_CNT_B3) AS MONTH_CONT_B3
                       , ROUND( (SUM(MONTH_CNT_B1) + SUM(MONTH_CNT_B2) + SUM(MONTH_CNT_B3)) / 3 ) AS AVERAGE_CONT
                       , 0 AS NO_ASSIGN
                       , 0 AS ASSIGN
                       , 0 AS STOCK_CNT
                       , 0 AS POSI_STOCK_CNT
                    FROM (
                          SELECT A.DLR_CD
                               , A.CARLINE_CD
                               , A.MODEL_CD
                               , A.OCN_CD
                               , A.EXT_COLOR_CD
                               , A.INT_COLOR_CD
                               , DECODE( A.REAL_DL, B.MM_DT,    A.CNT, 0) AS MONTH_CNT          -- 당월
                               , DECODE( A.REAL_DL, B.MM_DT_B1, A.CNT, 0) AS MONTH_CNT_B1       -- 1개월 전
                               , DECODE( A.REAL_DL, B.MM_DT_B2, A.CNT, 0) AS MONTH_CNT_B2       -- 2개월 전
                               , DECODE( A.REAL_DL, B.MM_DT_B3, A.CNT, 0) AS MONTH_CNT_B3       -- 3개월 전
                            FROM (
                                   SELECT CARLINE_CD, MODEL_CD, OCN_CD, EXT_COLOR_CD, INT_COLOR_CD
                                         , TO_CHAR(REAL_DL_DT, 'YYYY-MM') AS REAL_DL
                                         , SUM(1) AS CNT
                                         , MAX(DLR_CD) AS DLR_CD
                                      FROM SA_0201T
                                     WHERE DLR_CD = #{sDlrCd}
                                       AND CONTRACT_STAT_CD = '50'
                                     GROUP BY CARLINE_CD, MODEL_CD, OCN_CD, EXT_COLOR_CD, INT_COLOR_CD, TO_CHAR(REAL_DL_DT, 'YYYY-MM')
                               ) A
                              , (
                                    SELECT #{sDlrCd} AS DLR_CD
                                         , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYyMm}, 'YYYY-MM'), -3), 'YYYY-MM')  AS MM_DT_B3
                                         , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYyMm}, 'YYYY-MM'), -2), 'YYYY-MM')  AS MM_DT_B2
                                         , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYyMm}, 'YYYY-MM'), -1), 'YYYY-MM')  AS MM_DT_B1
                                         , TO_CHAR(ADD_MONTHS(TO_DATE(#{sYyMm}, 'YYYY-MM'), 0), 'YYYY-MM')   AS MM_DT
                                      FROM DUAL
                                 ) B
                            WHERE  A.DLR_CD = B.DLR_CD
                          ) A
                      GROUP BY  A.DLR_CD, A.CARLINE_CD, A.MODEL_CD, A.OCN_CD, A.EXT_COLOR_CD, A.INT_COLOR_CD

                UNION ALL

                  SELECT A.DLR_CD, A.CARLINE_CD, A.MODEL_CD, A.OCN_CD, A.EXT_COLOR_CD, A.INT_COLOR_CD
                       , 0 AS MONTH_CONT
                       , 0 AS MONTH_CONT_B1
                       , 0 AS MONTH_CONT_B2
                       , 0 AS MONTH_CONT_B3
                       , 0 AS AVERAGE_CONT
                       , A.CNT AS NO_ASSIGN                  -- 해당월 미배정 수량
                       , 0 AS ASSIGN
                       , 0 AS STOCK_CNT
                       , 0 AS POSI_STOCK_CNT
                    FROM (
                           SELECT DLR_CD
                                , SUBSTR(ORD_YYMM, 1, 4) ||'-'|| SUBSTR(ORD_YYMM, 5, 6)  AS ORD_YYMM
                                , CARLINE_CD
                                , MODEL_CD
                                , OCN_CD
                                , EXT_COLOR_CD
                                , INT_COLOR_CD
                                , SUM(1) AS CNT
                             FROM SA_0416T
                             WHERE DLR_CD = #{sDlrCd}
                               AND PRTY = 'A'
                              GROUP BY DLR_CD, ORD_YYMM, CARLINE_CD, MODEL_CD, OCN_CD, EXT_COLOR_CD, INT_COLOR_CD
                          ) A
                    WHERE ORD_YYMM = #{sYyMm}

                UNION ALL

                  SELECT A.DLR_CD, A.CARLINE_CD, A.MODEL_CD, A.OCN_CD, A.EXT_COLOR_CD, A.INT_COLOR_CD
                       , 0 AS MONTH_CONT
                       , 0 AS MONTH_CONT_B1
                       , 0 AS MONTH_CONT_B2
                       , 0 AS MONTH_CONT_B3
                       , 0 AS AVERAGE_CONT
                       , 0 AS NO_ASSIGN
                       , A.CNT AS ASSIGN                               -- 해당월 주문수량
                       , 0 AS STOCK_CNT
                       , 0 AS POSI_STOCK_CNT
                    FROM (
                           SELECT MAX(DLR_CD) AS DLR_CD
                                , CARLINE_CD, MODEL_CD, OCN_CD, EXT_COLOR_CD, INT_COLOR_CD
                                , TO_CHAR(ORD_DT, 'YYYY-MM') AS ORD_DT
                                , SUM(1) AS CNT
                             FROM SA_0417T
                            WHERE DLR_CD = #{sDlrCd}
                            GROUP BY CARLINE_CD, MODEL_CD, OCN_CD, EXT_COLOR_CD, INT_COLOR_CD, TO_CHAR(ORD_DT, 'YYYY-MM')
                         ) A
                   WHERE A.ORD_DT = #{sYyMm}

                UNION ALL

                  SELECT MAX(DLR_CD) AS DLR_CD, CARLINE_CD, MODEL_CD, OCN_CD, EXT_COLOR_CD, INT_COLOR_CD
                       , 0 AS MONTH_CONT
                       , 0 AS MONTH_CONT_B1
                       , 0 AS MONTH_CONT_B2
                       , 0 AS MONTH_CONT_B3
                       , 0 AS AVERAGE_CONT
                       , 0 AS NO_ASSIGN
                       , 0 AS ASSIGN
                       , SUM(1) AS STOCK_CNT
                       , 0 AS POSI_STOCK_CNT
                    FROM SA_0121T
                   WHERE DLR_CD = #{sDlrCd}
                     AND CAR_STAT_CD = '60'
                   GROUP BY CARLINE_CD, MODEL_CD, OCN_CD, EXT_COLOR_CD, INT_COLOR_CD

                UNION ALL

                  SELECT MAX(DLR_CD) AS DLR_CD, CARLINE_CD, MODEL_CD, OCN_CD, EXT_COLOR_CD, INT_COLOR_CD
                       , 0 AS MONTH_CONT
                       , 0 AS MONTH_CONT_B1
                       , 0 AS MONTH_CONT_B2
                       , 0 AS MONTH_CONT_B3
                       , 0 AS AVERAGE_CONT
                       , 0 AS NO_ASSIGN
                       , 0 AS ASSIGN
                       , 0 AS STOCK_CNT
                       , SUM(1) AS POSI_STOCK_CNT
                    FROM SA_0121T
                   WHERE DLR_CD = #{sDlrCd}
                     AND CAR_STAT_CD = '60'
                     AND NVL(DAMAGE_CD, '02')  = '02'         /* SAL049 : 02 비손상 */
                     AND NVL(CMP_CAR_YN, 'N') = 'N'           -- 회사차여부
                    GROUP BY CARLINE_CD, MODEL_CD, OCN_CD, EXT_COLOR_CD, INT_COLOR_CD
               ) A
          GROUP BY A.DLR_CD, A.CARLINE_CD, A.MODEL_CD, A.OCN_CD, A.EXT_COLOR_CD, A.INT_COLOR_CD
    </select>


</mapper>