<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : Slv2DlrOrgDAO_SqlMap.xml
    Description : [DMS] 기준정보 > 2급딜러 관리
    author chibeom.song
    since 2017. 2. 20.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 7. 21.   chibeom.song     최초 생성1
-->
<mapper namespace="chn.bhmc.dms.sal.veh.service.dao.Slv2DlrOrgDAO">
    <!-- 기준정보 > 2급딜러 관리 총 갯수를 조회한다. -->
    <select id="selectSaleSlv2DlrOrgMgmtSearchCnt" parameterType="Slv2DlrOrgSearchVO" resultType="int">
    /* [chn.bhmc.dms.sal.veh.service.dao.Slv2DlrOrgDAO.selectSaleSlv2DlrOrgMgmtSearchCnt] */
        SELECT
            COUNT(*) AS VALUE
        FROM (
                SELECT
                     A.SDLR_CD AS sdlrCd
                    ,A.SDLR_TP AS sdldrTp
                    ,A.DLR_CD AS dlrCd
                    ,A.SDLR_NM AS sdlrNm
                    ,A.TAXPAYER_ID_CD AS taxpayerIdCd
                    ,A.OWN_NM AS ownNm
                    ,A.TEL_NO AS telNo
                    ,A.ADDR AS sdlrAddr
                    ,A.USE_YN AS useYn
                    ,A.REG_USR_ID AS regUsrId
                    ,A.REG_DT AS regDt
                    ,A.UPDT_USR_ID AS updtUsrId
                    ,A.UPDT_DT AS upDt
                FROM SA_0504T A
                WHERE A.SDLR_TP = #{sSlv2DlrType}
        <if test='sLv2DlrCd != null and sLv2DlrCd != ""'>
            AND A.SDLR_CD = #{sLv2DlrCd}
        </if>
        <if test='sPayTaxPinNo != null and sPayTaxPinNo != ""'>
            AND A.TAXPAYER_ID_CD = #{sPayTaxPinNo}
        </if>
        )
    </select>

    <!-- 기준정보 > 2급딜러 관리 정보를 조회한다. -->
    <select id="selectSaleSlv2DlrOrgMgmtSearchData" parameterType="Slv2DlrOrgSearchVO" resultType="Slv2DlrOrgVO">
    /* [chn.bhmc.dms.sal.veh.service.dao.Slv2DlrOrgDAO.selectSaleSlv2DlrOrgMgmtSearchData] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                     A.SDLR_CD AS sdlrCd
                    ,A.SDLR_TP AS sdldrTp
                    , ( SELECT Z1.CMM_CD_NM
                           FROM (SELECT A.CMM_CD
                                      , NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM
                                  FROM CM_0303T A
                                  LEFT OUTER JOIN CM_0304T B
                                        ON A.CMM_GRP_CD = B.CMM_GRP_CD
                                       AND A.CMM_CD = B.CMM_CD
                                       AND B.LANG_CD = #{langCd}
                                 WHERE A.CMM_GRP_CD = 'SAL203'
                                   AND A.USE_YN = 'Y'
                                 ) Z1
                         WHERE Z1.CMM_CD = DECODE(A.SDLR_TP, NULL, 'N', A.SDLR_TP)
                       ) AS sdldrTpNm
                    ,A.DLR_CD AS dlrCd
                    ,A.SDLR_NM AS sdlrNm
                    ,A.TAXPAYER_ID_CD AS taxpayerIdCd
                    ,A.OWN_NM AS ownNm
                    ,A.TEL_NO AS telNo
                    ,A.ADDR AS sdlrAddr
                    ,A.USE_YN AS useYn
                    ,A.REG_USR_ID AS regUsrId
                    ,A.REG_DT AS regDt
                    ,A.UPDT_USR_ID AS updtUsrId
                    ,A.UPDT_DT AS upDt
                FROM SA_0504T A
                WHERE A.SDLR_TP = #{sSlv2DlrType}
                <if test='sLv2DlrCd != null and sLv2DlrCd != ""'>
                    AND A.SDLR_CD = #{sLv2DlrCd}
                </if>
                <if test='sPayTaxPinNo != null and sPayTaxPinNo != ""'>
                    AND A.TAXPAYER_ID_CD = #{sPayTaxPinNo}
                </if>
                ORDER BY A.SDLR_CD DESC
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>
    
    <!-- 기준정보 > 2급딜러 관리 정보를 신규 저장한다. -->
    <insert id="insertSaleSlv2DlrOrgMgmtSave" parameterType="Slv2DlrOrgSearchVO">
        /* [chn.bhmc.dms.sal.veh.service.dao.Slv2DlrOrgDAO.insertSaleSlv2DlrOrgMgmtSave] */
        INSERT INTO SA_0504T (
               SDLR_CD
             , SDLR_TP
             , DLR_CD
             , SDLR_NM
             , TAXPAYER_ID_CD
             , OWN_NM
             , TEL_NO
             , ADDR
             , USE_YN
             , REG_USR_ID
             , REG_DT
             , UPDT_USR_ID
             , UPDT_DT
        ) VALUES (
               SEQ_SA_0504T.NEXTVAL
             , #{slv2DlrType}
             , #{dlrCd}
             , #{slv2DlrNm}
             , #{payTaxPinNo}
             , #{ownRgstNm}
             , #{telNo}
             , #{sdlrAddr}
             , 'Y'
             , #{regUsrId}
             , SYSDATE
             , #{updtUsrId}
             , SYSDATE
        )
    </insert>
    
    <!-- 기준정보 > 2급딜러 관리 정보를 상세 조회한다. -->
    <select id="selectSaleSlv2DlrOrgMgmtSaveByKey" parameterType="Slv2DlrOrgSearchVO" resultType="Slv2DlrOrgVO">
        /* [chn.bhmc.dms.sal.veh.service.dao.Slv2DlrOrgDAO.selectSaleSlv2DlrOrgMgmtSaveByKey] */
        SELECT
             A.SDLR_CD AS uSdlrCd
            ,A.SDLR_TP AS uSdldrTp
            , ( SELECT Z1.CMM_CD_NM
                   FROM (SELECT A.CMM_CD
                              , NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM
                          FROM CM_0303T A
                          LEFT OUTER JOIN CM_0304T B
                                ON A.CMM_GRP_CD = B.CMM_GRP_CD
                               AND A.CMM_CD = B.CMM_CD
                               AND B.LANG_CD = #{langCd}
                         WHERE A.CMM_GRP_CD = 'SAL203'
                           AND A.USE_YN = 'Y'
                         ) Z1
                 WHERE Z1.CMM_CD = DECODE(A.SDLR_TP, NULL, 'N', A.SDLR_TP)
               ) AS uSdldrTpNm
            ,A.DLR_CD AS uDlrCd
            ,A.SDLR_NM AS uSdlrNm
            ,A.TAXPAYER_ID_CD AS uTaxpayerIdCd
            ,A.OWN_NM AS uOwnNm
            ,A.TEL_NO AS uTelNo
            ,A.ADDR AS uSdlrAddr
            ,A.USE_YN AS uUseYn
            ,A.REG_USR_ID AS uRegUsrId
            ,A.REG_DT AS uRegDt
            ,A.UPDT_USR_ID AS uUpdtUsrId
            ,A.UPDT_DT AS uUpDt
        FROM SA_0504T A
        WHERE A.SDLR_CD = #{sSdlrCd}
        AND A.SDLR_TP = #{sSdldrTp}
        AND A.DLR_CD = #{sDlrCd}
    </select>
    
    <!-- 기준정보 > 2급딜러 관리 정보를 수정한다. -->
    <update id="updateSaleSlv2DlrOrgMgmtSave" parameterType="Slv2DlrOrgSearchVO">
        /* [chn.bhmc.dms.sal.veh.service.dao.Slv2DlrOrgDAO.updateSaleSlv2DlrOrgMgmtSave] */
        UPDATE SA_0504T SET
             SDLR_TP = #{uslv2DlrType}
            ,SDLR_NM = #{uSlv2DlrNm}
            ,TAXPAYER_ID_CD = #{uPayTaxPinNo}
            ,OWN_NM = #{uOwnRgstNm}
            ,TEL_NO = #{uTelNo}
            ,ADDR = #{uSdlrAddr}
            ,UPDT_USR_ID = #{updtUsrId}
            ,UPDT_DT = SYSDATE
        WHERE SDLR_CD = #{uSdlrCd} 
        AND DLR_CD = #{uDlrCd}
    </update>

</mapper>