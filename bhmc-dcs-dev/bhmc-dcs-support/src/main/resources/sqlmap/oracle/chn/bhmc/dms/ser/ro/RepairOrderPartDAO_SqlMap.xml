<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : RepairOrderPartDAO_SqlMap.xml
    Description : RO부품에 관한 데이터처리
    author KyungMok Kim
    since 2016. 01. 19.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 01. 19.  KyungMok Kim     최초 생성
-->

<mapper namespace="chn.bhmc.dms.ser.ro.service.dao.RepairOrderPartDAO">

    <!-- 예약부품 등록. -->
    <insert id="insertRepairOrderPart" parameterType="RepairOrderPartVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderPartDAO.insertRepairOrderPart] */
        INSERT INTO DMSDB.SE_0310T    --RO부품정보
        (
            DLR_CD                  --딜러코드
            ,RO_DOC_NO               --RO문서번호
            ,LINE_NO                 --라인번호
            ,RO_TP                   --RO유형
            ,ITEM_CD                 --품목코드
            ,ITEM_NM                 --품목명
            ,PKG_ITEM_CD             --패키지품목코드
            ,GI_TP                   --출고유형
            ,ITEM_PRC                --품목단가
            ,ITEM_QTY                --품목수량
            ,ITEM_SALE_PRC           --품목판매단가
            ,ITEM_SALE_AMT           --품목판매금액
            ,CALC_UNIT_CD            --계산단위코드
            ,CALC_UNIT_NM            --계산단위명
            ,REQ_QTY                 --요청수량
            ,GI_QTY                  --출고수량
            ,EXPC_PAR_AMT            --예정부품금액
            ,PAY_CMP_NM              --지불회사명
            ,CR_NO                   --캠페인리콜일련번호
            ,FMS_CUPN_ITEM_CD        --FMS쿠폰품목코드
            ,FMS_ITEM_CD             --FMS품목코드
            ,LOC_CD
            ,SUB_BP_CD               --외주거래처코드
            ,SUB_BP_NM               --외주거래처명
            ,REG_USR_ID              --등록자ID
            ,REG_DT                  --등록일자
            ,REQ_STRGE_CD
            ,GR_STRGE_CD
            ,GI_STRGE_CD
        )
        VALUES
        (
            #{dlrCd}                  --딜러코드
            ,#{roDocNo}                --RO문서번호
            ,#{lineNo}                 --라인번호
            ,#{roTp}                   --RO유형
            ,#{itemCd}                 --품목코드
            ,#{itemNm}                 --품목명
            ,#{pkgItemCd}              --패키지품목코드
            ,#{giTp}                   --출고유형
            ,#{itemPrc}                --품목단가
            ,#{itemQty}                --품목수량
            ,#{itemSalePrc}            --품목판매단가
            ,#{itemSaleAmt}            --품목판매금액
            ,#{calcUnitCd}             --계산단위코드
            ,#{calcUnitNm}             --계산단위명
            ,#{reqQty}                 --요청수량
            ,#{giQty}                  --출고수량
            ,#{expcParAmt}             --예정부품금액
            ,#{payCmpNm}               --지불회사명
            ,#{crNo}                  --캠페인리콜일련번호
            ,#{fmsCupnItemCd}          --FMS쿠폰품목코드
            ,#{fmsItemCd}              --FMS품목코드
            ,#{locCd}
            ,#{subBpCd}                --외주거래처코드
            ,#{subBpNm}                --외주거래처명
            ,#{regUsrId}               --등록자ID
            ,SYSDATE                  --등록일자
            ,#{reqStrgeCd}
            ,#{grStrgeCd}
            ,#{giStrgeCd}
        )
    </insert>

    <!-- 예약부품  수정. -->
    <update id="updateRepairOrderPart" parameterType="RepairOrderPartVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderPartDAO.updateRepairOrderPart] */
        UPDATE SE_0310T SET
            LINE_NO          = #{lineNo}                 --라인번호
            ,RO_TP            = #{roTp}                   --RO유형
            ,ITEM_CD          = #{itemCd}                 --품목코드
            ,ITEM_NM          = #{itemNm}                 --품목명
            ,PKG_ITEM_CD      = #{pkgItemCd}              --패키지품목코드
            ,GI_TP            = #{giTp}                   --출고유형
            ,ITEM_PRC         = #{itemPrc}                --품목단가
            ,ITEM_QTY         = #{itemQty}                --품목수량
            ,ITEM_SALE_PRC    = #{itemSalePrc}            --품목판매단가
            ,ITEM_SALE_AMT    = #{itemSaleAmt}            --품목판매금액
            ,CALC_UNIT_CD     = #{calcUnitCd}             --계산단위코드
            ,CALC_UNIT_NM     = #{calcUnitNm}             --계산단위명
            ,REQ_QTY          = #{reqQty}                 --요청수량
            ,GI_QTY           = #{giQty}                  --출고수량
            ,EXPC_PAR_AMT     = #{expcParAmt}             --예정부품금액
            ,PAY_CMP_NM       = #{payCmpNm}               --지불회사명
            ,CR_NO           = #{crNo}                    --캠페인리콜일련번호
            ,FMS_CUPN_ITEM_CD = #{fmsCupnItemCd}          --FMS쿠폰품목코드
            ,FMS_ITEM_CD      = #{fmsItemCd}              --FMS품목코드
            ,LOC_CD           = #{locCd}
            ,SUB_BP_CD        = #{subBpCd}                --외주거래처코드
            ,SUB_BP_NM        = #{subBpNm}                --외주거래처명
            <if test='regUsrId != null and regUsrId != ""'>
            ,REG_USR_ID       = #{regUsrId}               --등록자ID
            </if>
            <if test='regDt != null'>
            ,REG_DT           = #{regDt}                  --등록일자
            </if>
            ,UPDT_USR_ID      = #{updtUsrId}              --수정자ID
            ,UPDT_DT          = SYSDATE                --수정일자
            ,REQ_STRGE_CD = #{reqStrgeCd}
            ,GR_STRGE_CD = #{grStrgeCd}
            ,GI_STRGE_CD = #{giStrgeCd}
        WHERE RO_DOC_NO = #{roDocNo}           --RO문서번호
        AND LINE_NO = #{lineNo}                --라인번호
        AND DLR_CD = #{dlrCd}                  --딜러코드
    </update>

    <!-- 예약부품 삭제. -->
    <delete id="deleteRepairOrderPart" parameterType="RepairOrderPartVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderPartDAO.deleteRepairOrderPart] */
        DELETE FROM SE_0310T
        WHERE RO_DOC_NO = #{roDocNo}
        <if test='lineNo != null and lineNo != 0'>
            AND LINE_NO = #{lineNo}
        </if>
        <if test='itemCd != null and itemCd != ""'>
            AND ITEM_CD = #{itemCd}
        </if>
    </delete>

    <!-- 예약부품 목록 조회. -->
    <select id="selectRepairOrderPartsByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderPartVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderPartDAO.selectRepairOrderPartsByConditionCnt] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT *
                FROM SE_0310T
                <where>
                    <if test='sRoDocNo != null and sRoDocNo != ""'>
                        AND RO_DOC_NO = #{sRoDocNo}
                    </if>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        AND DLR_CD = #{sDlrCd}
                    </if>
                </where>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 예약부품 목록수를 조회. -->
    <select id="selectRepairOrderPartsByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.res.service.dao.RepairOrderPartDAO.selectRepairOrderPartsByConditionCnt] */
        SELECT COUNT(*) AS VALUE
        FROM SE_0310T
        <where>
            <if test='sRoDocNo != null and sRoDocNo != ""'>
                AND RO_DOC_NO = #{sRoDocNo}
            </if>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND DLR_CD = #{sDlrCd}
            </if>
        </where>
    </select>

</mapper>