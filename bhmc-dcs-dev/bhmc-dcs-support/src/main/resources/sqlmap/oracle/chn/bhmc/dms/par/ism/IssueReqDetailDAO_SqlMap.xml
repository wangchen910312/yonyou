<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : IssueReqDetailDAO_SqlMap.xml
    Description : 구매요청상세 관리.
    author In Bo Shim
    since 2016. 1. 11.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 01. 11.     In Bo Shim     최초 생성
-->

<mapper namespace="chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO">

    <!-- 구매요청상세 정보를 추가한다. -->
    <insert id="insertIssueReqDetail" parameterType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.insertIssueReqDetail] */
        INSERT INTO PT_0502T(
            DLR_CD
            ,PAR_REQ_DOC_NO
            ,PAR_REQ_DOC_LINE_NO
            ,PAR_REQ_STAT_CD
            ,CANC_YN
            ,PAR_GI_TP
            ,RO_DOC_NO
            ,RO_LINE_NO
            ,RESV_DOC_NO
            ,RESV_DOC_LINE_NO
            ,GI_STRGE_CD
            ,GI_LOC_CD
            ,ITEM_CD
            ,REQ_QTY
            ,UNIT_CD
            ,END_QTY
            ,REQ_STRGE_CD
            ,ETC_GI_TP
            ,PKG_ITEM_CD
            ,REG_USR_ID
            ,REG_DT
        ) VALUES (
            #{ dlrCd }
            ,#{ parReqDocNo }
            ,#{ parReqDocLineNo }
            ,#{ parReqStatCd }
            ,#{ cancYn }
            ,#{ parGiTp }
            ,#{ roDocNo }
            ,#{ roLineNo }
            ,#{ resvDocNo }
            ,#{ resvDocLineNo }
            ,#{ giStrgeCd }
            ,#{ giLocCd }
            ,#{ itemCd }
            ,#{ reqQty }
            ,#{ unitCd }
            ,#{ endQty }
            ,#{ reqStrgeCd }
            ,#{ etcGiTp }
            ,#{ pkgItemCd }
            ,#{ regUsrId }
            ,SYSDATE
        )
    </insert>

    <!-- 구매요청상세 정보를 수정한다. -->
    <update id="updateIssueReqDetail" parameterType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.updateIssueReqDetail] */
        UPDATE PT_0502T SET
            UPDT_DT = SYSDATE
            <if test='updtUsrId != null and updtUsrId != ""'>
            ,UPDT_USR_ID = #{ updtUsrId }
            </if>
            <if test='parReqStatCd != null and parReqStatCd != ""'>
            ,PAR_REQ_STAT_CD = #{ parReqStatCd }
            </if>
            <if test='cancYn != null and cancYn != ""'>
            ,CANC_YN = #{ cancYn }
            </if>
            <if test='parGiTp != null and parGiTp != ""'>
            ,PAR_GI_TP = #{ parGiTp }
            </if>
            <if test='giStrgeCd != null and giStrgeCd != ""'>
            ,GI_STRGE_CD = #{ giStrgeCd }
            </if>
            <if test='giLocCd != null and giLocCd != ""'>
            ,GI_LOC_CD = #{ giLocCd }
            </if>
            <if test='reqQty != null and reqQty != 0'>
            ,REQ_QTY = #{ reqQty }
            </if>
            <if test='unitCd != null and unitCd != ""'>
            ,UNIT_CD = #{ unitCd }
            </if>
            <if test='endQty != null and endQty != 0'>
            ,END_QTY = #{ endQty }
            </if>
            <if test='reqStrgeCd != null and reqStrgeCd != ""'>
            ,REQ_STRGE_CD = #{ reqStrgeCd }
            </if>
            <if test='etcGiTp != null and etcGiTp != ""'>
            ,ETC_GI_TP = #{ etcGiTp }
            </if>
            <if test='itemCd != null and itemCd != ""'>
            ,ITEM_CD = #{ itemCd }
            </if>
        WHERE DLR_CD = #{dlrCd}
        AND PAR_REQ_DOC_NO = #{parReqDocNo}
        <if test='roDocNo != null and roDocNo != ""'>
            AND RO_DOC_NO = #{roDocNo}
        </if>
        <if test='roLineNo != null and roLineNo != 0'>
            AND RO_LINE_NO = #{roLineNo}
        </if>
        <if test='resvDocNo != null and resvDocNo != ""'>
            AND RESV_DOC_NO = #{resvDocNo}
        </if>
        <if test='resvDocLineNo != null and resvDocLineNo != 0'>
            AND RESV_DOC_LINE_NO = #{resvDocLineNo}
        </if>
        AND ITEM_CD = #{dbItemCd}

    </update>

    <!-- 구매요청상세 정보를 삭제한다. -->
    <delete id="deleteIssueReqDetail" parameterType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.deleteIssueReqDetail] */
        DELETE FROM PT_0502T
        WHERE DLR_CD = #{dlrCd}
        AND RO_DOC_NO = #{roDocNo}
        <if test='parReqDocNo != null and parReqDocNo != ""'>
            AND PAR_REQ_DOC_NO = #{parReqDocNo}
        </if>
        <if test='roLineNo != null and roLineNo != 0'>
            AND RO_LINE_NO = #{roLineNo}
        </if>
        <if test='resvDocNo != null and resvDocNo != ""'>
            AND RESV_DOC_NO = #{resvDocNo}
        </if>
        <if test='resvDocLineNo != null and resvDocLineNo != 0'>
            AND RESV_DOC_LINE_NO = #{resvDocLineNo}
        </if>
        <if test='itemCd != null and itemCd != ""'>
            AND ITEM_CD = #{itemCd}
        </if>
    </delete>

    <!-- 구매요청상세 정보를 조회한다. -->
    <select id="selectIssueReqDetailByKey" parameterType="map" resultType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqDetailByKey] */
        SELECT * FROM PT_0502T
        WHERE DLR_CD = #{dlrCd}
        AND PAR_REQ_DOC_NO = #{parReqDocNo}
        <if test='roDocNo != null and roDocNo != ""'>
            AND RO_DOC_NO = #{roDocNo}
        </if>
        <if test='roLineNo != null and roLineNo != 0'>
            AND RO_LINE_NO = #{roLineNo}
        </if>
        <if test='resvDocNo != null and resvDocNo != ""'>
            AND RESV_DOC_NO = #{resvDocNo}
        </if>
        <if test='resvDocLineNo != null and resvDocLineNo != 0'>
            AND RESV_DOC_LINE_NO = #{resvDocLineNo}
        </if>
        AND ITEM_CD = #{dbItemCd}
    </select>

    <!-- 구매요청상세 정보 목록을 조회한다. -->
    <select id="selectIssueReqDetailsByCondition" parameterType="IssueReqSearchVO" resultType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqDetailsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                    A.DLR_CD
                    ,A.PAR_REQ_DOC_NO
                    ,A.PAR_REQ_DOC_LINE_NO
                    ,A.PAR_REQ_STAT_CD
                    ,G.PURC_REQ_NO
                    ,A.CANC_YN
                    ,A.PAR_GI_TP
                    ,A.RO_DOC_NO
                    ,A.RO_LINE_NO
                    ,A.RESV_DOC_NO
                    ,A.RESV_DOC_LINE_NO
                    ,B.GR_STRGE_CD
                    ,A.GI_STRGE_CD
                    ,A.GI_LOC_CD
                    ,A.ITEM_CD AS DB_ITEM_CD
                    ,A.ITEM_CD
                    ,NVL((SELECT PURC_PRC FROM PT_0213T AA WHERE AA.DLR_CD = A.DLR_CD AND AA.ITEM_CD = A.ITEM_CD AND AA.PRC_TP = '01' AND AA.BP_CD = (SELECT BP_CD FROM PT_0212T BB WHERE BB.DLR_CD = A.DLR_CD AND BB.ITEM_CD = A.ITEM_CD AND BB.APPLY_YN = 'Y')),0) AS ITEM_PRC
                    ,NVL((SELECT PURC_PRC FROM PT_0213T AA WHERE AA.DLR_CD = A.DLR_CD AND AA.ITEM_CD = A.ITEM_CD AND AA.PRC_TP = '01' AND AA.BP_CD = (SELECT BP_CD FROM PT_0212T BB WHERE BB.DLR_CD = A.DLR_CD AND BB.ITEM_CD = A.ITEM_CD AND BB.APPLY_YN = 'Y')) * A.REQ_QTY,0) AS ITEM_AMT
                    ,NVL((SELECT PURC_PRC FROM PT_0213T AA WHERE AA.DLR_CD = A.DLR_CD AND AA.ITEM_CD = A.ITEM_CD AND AA.PRC_TP = '01' AND AA.BP_CD = (SELECT BP_CD FROM PT_0212T BB WHERE BB.DLR_CD = A.DLR_CD AND BB.ITEM_CD = A.ITEM_CD AND BB.APPLY_YN = 'Y')) * A.REQ_QTY + (SELECT PURC_PRC FROM PT_0213T AA WHERE AA.DLR_CD = A.DLR_CD AND AA.ITEM_CD = A.ITEM_CD AND AA.PRC_TP = '01' AND AA.BP_CD = (SELECT BP_CD FROM PT_0212T BB WHERE BB.DLR_CD = A.DLR_CD AND BB.ITEM_CD = A.ITEM_CD AND BB.APPLY_YN = 'Y')) * A.REQ_QTY * FN_GET_VAT(NULL,'ALL') ,0) AS TAX_DDCT_AMT
                    ,NVL((SELECT PURC_PRC FROM PT_0213T AA WHERE AA.DLR_CD = A.DLR_CD AND AA.ITEM_CD = A.ITEM_CD AND AA.PRC_TP = '01' AND AA.BP_CD = (SELECT BP_CD FROM PT_0212T BB WHERE BB.DLR_CD = A.DLR_CD AND BB.ITEM_CD = A.ITEM_CD AND BB.APPLY_YN = 'Y')) * A.REQ_QTY * FN_GET_VAT(NULL,'ALL') ,0) AS TAX_AMT
                    ,A.REQ_QTY
                    ,B.STOCK_UNIT_CD AS UNIT_CD
                    ,A.END_QTY
                    ,A.REQ_STRGE_CD
                    ,A.REG_DT
                    ,A.REG_USR_ID
                    ,A.UPDT_DT
                    ,A.UPDT_USR_ID
                    ,B.ITEM_NM
                    ,#{sPltCd} AS PLT_CD
                    ,NVL(C.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY
                    ,NVL(C.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY
                    ,NVL(C.CLAM_STOCK_QTY,0) AS CLAM_STOCK_QTY
                    ,NVL(C.GR_SCHE_QTY,0) AS GR_SCHE_QTY
                    ,NVL(C.GI_SCHE_QTY,0) AS GI_SCHE_QTY
                    ,CASE WHEN A.END_QTY = 0 THEN A.REQ_QTY
                    ELSE A.END_QTY
                    END AS RESV_QTY
                    ,A.REG_DT AS PURC_REQ_DT
                    ,NVL(E.GI_DOC_NO,'-') AS GI_DOC_NO
                    ,NVL(E.GI_DOC_TP,'01') AS GI_DOC_TP
                    ,NVL(E.GI_DOC_STAT_CD,'01') AS GI_DOC_STAT_CD
                    ,F.MVT_DOC_YY_MM
                    ,F.MVT_DOC_NO
                    ,F.MVT_DOC_LINE_NO
                    ,H.CUST_CD
                    ,H.CUST_NM
                    ,H.SER_PRSN_ID
                    ,H.VIN_NO
                    ,H.CAR_NO
                    ,'Y' AS DB_YN
                    ,F.GI_STAT_CD
                    ,F.RECEIVE_ID
                    ,F.GI_DT
                    ,F.RECEIVE_DT
                    ,F.RETURN_ID
                    ,F.RETURN_DT
                    ,F.CANC_ID
                    ,F.CANC_DT
                    ,F.GI_CAU_NM
                    ,A.ETC_GI_TP
                    ,A.PKG_ITEM_CD
                    ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN A.END_QTY
                    ELSE 0
                    END AS RETURN_PARTS_QTY
                FROM PT_0502T A
                LEFT JOIN PT_0201T B ON A.DLR_CD = B.DLR_CD AND A.ITEM_CD = B.ITEM_CD
                LEFT JOIN PT_0301T C ON A.DLR_CD = C.DLR_CD AND A.ITEM_CD = C.ITEM_CD AND B.GR_STRGE_CD = C.STRGE_CD AND C.PLT_CD = #{sPltCd}
                LEFT JOIN PT_0302T D ON A.DLR_CD = D.DLR_CD AND A.ITEM_CD = D.ITEM_CD AND B.GR_STRGE_CD = D.STRGE_CD AND A.RESV_DOC_NO = D.RESV_DOC_NO AND A.RESV_DOC_LINE_NO = D.RESV_DOC_LINE_NO AND D.PLT_CD = #{sPltCd}
                LEFT JOIN PT_0511T E ON A.DLR_CD = E.DLR_CD AND A.PAR_REQ_DOC_NO = E.PAR_REQ_DOC_NO
                LEFT JOIN PT_0512T F ON A.DLR_CD = F.DLR_CD AND A.PAR_REQ_DOC_NO = F.PAR_REQ_DOC_NO AND A.RO_DOC_NO = F.RO_DOC_NO AND A.RO_LINE_NO = F.RO_DOC_LINE_NO
                LEFT JOIN PT_0411T G ON A.DLR_CD = G.DLR_CD AND A.RO_DOC_NO = G.REF_DOC_NO AND A.RO_LINE_NO = G.REF_DOC_LINE_NO AND A.ITEM_CD = G.ITEM_CD
                LEFT JOIN PT_0501T H ON A.DLR_CD = H.DLR_CD AND A.PAR_REQ_DOC_NO = H.PAR_REQ_DOC_NO
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sDlrCd,"*")'>
                                <bind name='sDlrCd' value='@org.apache.commons.lang3.StringUtils@replace(sDlrCd, "*", "%")' />
                                 AND A.DLR_CD LIKE #{sDlrCd}
                            </when>
                            <otherwise>
                                 AND A.DLR_CD = #{sDlrCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                        AND A.PAR_REQ_DOC_NO = #{sParReqDocNo}
                    </if>

                    <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                        AND A.PAR_REQ_STAT_CD = #{sParReqStatCd}
                    </if>

                    <if test='sRoDocNo != null and sRoDocNo != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sRoDocNo,"*")'>
                                <bind name='sRoDocNo' value='@org.apache.commons.lang3.StringUtils@replace(sRoDocNo, "*", "%")' />
                                 AND A.RO_DOC_NO LIKE #{sRoDocNo}
                            </when>
                            <otherwise>
                                 AND A.RO_DOC_NO = #{sRoDocNo}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sRoLineNo != null and sRoLineNo != 0'>
                        AND A.RO_LINE_NO = #{sRoLineNo}
                    </if>

                    <if test='sResvDocNo != null and sResvDocNo != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sResvDocNo,"*")'>
                                <bind name='sResvDocNo' value='@org.apache.commons.lang3.StringUtils@replace(sResvDocNo, "*", "%")' />
                                 AND A.RESV_DOC_NO LIKE #{sResvDocNo}
                            </when>
                            <otherwise>
                                 AND A.RESV_DOC_NO = #{sResvDocNo}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sResvDocLineNo != null and sResvDocLineNo != 0'>
                        AND A.RESV_DOC_LINE_NO = #{sResvDocLineNo}
                    </if>

                    <if test='sParGiTp != null and sParGiTp != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"*")'>
                                <bind name='sParGiTp' value='@org.apache.commons.lang3.StringUtils@replace(sParGiTp, "*", "%")' />
                                 AND A.PAR_GI_TP LIKE #{sParGiTp}
                            </when>
                            <otherwise>
                                 AND A.PAR_GI_TP = #{sParGiTp}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sItemCd != null and sItemCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sItemCd,"*")'>
                                <bind name='sItemCd' value='@org.apache.commons.lang3.StringUtils@replace(sItemCd, "*", "%")' />
                                 AND A.ITEM_CD LIKE #{sItemCd}
                            </when>
                            <otherwise>
                                 AND A.ITEM_CD = #{sItemCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sCancYn != null and sCancYn != ""'>
                        AND A.CANC_YN = #{sCancYn}
                    </if>

                    <if test='sEtcGiTp != null and sEtcGiTp != ""'>
                        AND A.ETC_GI_TP = #{sEtcGiTp}
                    </if>

                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "parReqDocNo"'>A.PAR_REQ_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "parReqDocLineNo"'>A.PAR_REQ_DOC_LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "parReqStatCd"'>A.PAR_REQ_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "cancYn"'>A.CANC_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "parGiTp"'>A.PAR_GI_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "resvDocNo"'>A.RESV_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "resvDocLineNo"'>A.RESV_DOC_LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roDocNo"'>A.RO_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roLineNo"'>A.RO_LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "itemCd"'>A.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "itemNm"'>B.ITEM_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "giStrgeCd"'>A.GI_STRGE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "reqQty"'>A.REQ_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "endQty"'>A.END_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "reqStrgeCd"'>A.REQ_STRGE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "unitCd"'>A.UNIT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "custCd"'>A.CUST_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "custNm"'>A.CUST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "vinNo"'>A.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "carNo"'>A.CAR_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "avlbStockQty"'>AVLB_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "resvStockQty"'>RESV_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "clamStockQty"'>CLAM_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "grScheQty"'>GR_SCHE_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "giScheQty"'>GI_SCHE_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "resvQty"'>RESV_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "purcReqDt"'>PURC_REQ_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "giDocNo"'>GI_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "giDocTp"'>GI_DOC_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "giDocStatCd"'>GI_DOC_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                    A.DLR_CD ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        A.DLR_CD, A.PAR_REQ_DOC_NO DESC, A.PAR_REQ_DOC_LINE_NO ASC, A.RO_DOC_NO, A.RO_LINE_NO ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 구매요청상세 정보 카운트를 조회한다. -->
    <select id="selectIssueReqDetailsByConditionCnt" parameterType="IssueReqSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqDetailsByConditionCnt] */
        SELECT count(*) FROM PT_0502T
        <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sDlrCd,"*")'>
                        <bind name='sDlrCd' value='@org.apache.commons.lang3.StringUtils@replace(sDlrCd, "*", "%")' />
                         AND DLR_CD LIKE #{sDlrCd}
                    </when>
                    <otherwise>
                         AND DLR_CD = #{sDlrCd}
                    </otherwise>
                </choose>
            </if>

            <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sParReqDocNo,"*")'>
                        <bind name='sParReqDocNo' value='@org.apache.commons.lang3.StringUtils@replace(sParReqDocNo, "*", "%")' />
                         AND PAR_REQ_DOC_NO LIKE #{sParReqDocNo}
                    </when>
                    <otherwise>
                         AND PAR_REQ_DOC_NO = #{sParReqDocNo}
                    </otherwise>
                </choose>
            </if>

            <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                AND PAR_REQ_STAT_CD = #{sParReqStatCd}
            </if>

            <if test='sRoDocNo != null and sRoDocNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sRoDocNo,"*")'>
                        <bind name='sRoDocNo' value='@org.apache.commons.lang3.StringUtils@replace(sRoDocNo, "*", "%")' />
                         AND RO_DOC_NO LIKE #{sRoDocNo}
                    </when>
                    <otherwise>
                         AND RO_DOC_NO = #{sRoDocNo}
                    </otherwise>
                </choose>
            </if>

            <if test='sRoLineNo != null and sRoLineNo != 0'>
                AND RO_LINE_NO = #{sRoLineNo}
            </if>

            <if test='sResvDocNo != null and sResvDocNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sResvDocNo,"*")'>
                        <bind name='sResvDocNo' value='@org.apache.commons.lang3.StringUtils@replace(sResvDocNo, "*", "%")' />
                         AND RESV_DOC_NO LIKE #{sResvDocNo}
                    </when>
                    <otherwise>
                         AND RESV_DOC_NO = #{sResvDocNo}
                    </otherwise>
                </choose>
            </if>

            <if test='sResvDocLineNo != null and sResvDocLineNo != 0'>
                AND RESV_DOC_LINE_NO = #{sResvDocLineNo}
            </if>

            <if test='sParGiTp != null and sParGiTp != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"*")'>
                        <bind name='sParGiTp' value='@org.apache.commons.lang3.StringUtils@replace(sParGiTp, "*", "%")' />
                         AND PAR_GI_TP LIKE #{sParGiTp}
                    </when>
                    <otherwise>
                         AND PAR_GI_TP = #{sParGiTp}
                    </otherwise>
                </choose>
            </if>

            <if test='sItemCd != null and sItemCd != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sItemCd,"*")'>
                        <bind name='sItemCd' value='@org.apache.commons.lang3.StringUtils@replace(sItemCd, "*", "%")' />
                         AND ITEM_CD LIKE #{sItemCd}
                    </when>
                    <otherwise>
                         AND ITEM_CD = #{sItemCd}
                    </otherwise>
                </choose>
            </if>

            <if test='sCancYn != null and sCancYn != ""'>
                AND CANC_YN = #{sCancYn}
            </if>

            <if test='sEtcGiTp != null and sEtcGiTp != ""'>
                AND ETC_GI_TP = #{sEtcGiTp}
            </if>

        </where>
    </select>

</mapper>