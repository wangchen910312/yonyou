<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : RepairOrderDAO_SqlMap.xml
    Description : RO에 관한 데이터처리
    author KyungMok Kim
    since 2016. 03. 14.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 03. 14.  KyungMok Kim     최초 생성
    2018. 06. 12.  KyungMok Kim     수정
    2018. 06. 21.	Jin JUNG        add query - selectROCntByConditionCnt, selectROCntByCondition
-->

<mapper namespace="chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO">

    <!-- RO접수 등록. -->
    <insert id="insertRepairOrder" parameterType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.insertRepairOrder] */
        INSERT INTO SE_0300T
        (
            DLR_CD                          --딜러코드
            ,RO_DOC_NO                       --RO문서번호
            ,RO_TP                           --RO유형
            ,RESV_DOC_NO                     --예약문서번호
            ,VIN_NO                          --차대번호
            ,CAR_REG_NO                      --차량등록번호
            ,ENGIN_NO                 --엔진시리얼번호
            ,CAR_OWNER_ID                      --차량소유자ID
            ,CAR_OWNER_NM                      --차량소유자명
            ,DRIVER_ID                       --운전자ID
            ,DRIVER_NM                       --운전자명
            ,RESV_TP                         --예약유형
            ,RESV_DT                         --예약일자
            ,BAY_NO                          --베이번호
            ,TEC_ID                          --TecManID
            ,TEC_NM                          --TecMan명
            ,SA_ID                           --SAID
            ,SA_NM                           --SA명
            ,OPER_RESV_DT                    --작업예약일자
            ,SER_RESV_START_DT               --서비스예약일자
            ,SER_RESV_END_DT                 --서비스예약일자
            ,PAR_AMT                         --부품금액
            ,LBR_AMT                         --공임금액
            ,ETC_AMT                         --기타금액
            ,DC_AMT                          --할인금액
            ,SUM_AMT                         --합계금액
            ,VAT_AMT                         --부가가치세금액
            ,TOT_AMT                         --총금액
            ,BAL_AMT                         --예치금액
            ,RESV_STAT_CD                    --예약상태코드
            ,CUST_REMARK                          --비고
            ,CANC_REASON_CD                  --취소사유코드
            ,CANC_REASON_CONT                --취소사유내용
            ,DIST_UNIT_CD                    --거리단위코드
            ,RUN_DIST_VAL                    --주행거리값
            ,DIAG_DOC_NO                      --사전점검번호
            ,BASE_RO_NO                      --원RO번호
            ,INC_REQ_NO                      --보험신청번호
            ,CUST_WAIT_MTH_CD                --고객대기방법코드
            ,ATQ_PROC_TP                     --고품처리유형
            ,CAR_WASH_TP                     --차량세차유형
            ,CAR_DRIVE_REQ_TP                --차량시승요청유형
            ,EXPC_DL_DT                      --예정인도일자
            ,RO_END_YN                       --RO완료여부
            ,ATQ_PROC_YN                     --고품처리여부
            ,CAR_WASH_YN                     --차량세차여부
            ,SER_TAG_YN                      --서비스태그여부
            ,VSIT_CAR_RECEIVE_DT             --방문차량수령일자
            ,VSIT_CAR_RECEIVE_IF_NM          --방문차량수령연계인명
            ,VSIT_CAR_RECEIVE_CINO_NO        --방문차량수령연락처번호
            ,VSIT_CAR_RECEIVE_ADDR_NM        --방문차량수령주소명
            ,CAR_RECEIVE_DT                  --차량수령일자
            ,VSIT_DL_IF_NM                   --방문인도연계인명
            ,VSIT_DL_CINO_NO                 --방문인도연락처번호
            ,VSIT_DL_ADDR_NM                 --방문인도주소명
            ,VSIT_DT                         --방문일자
            ,VSIT_IF_NM                      --방문연계인명
            ,VSIT_CINO_NO                    --방문연락처번호
            ,VSIT_ADDR_NM                    --방문주소명
            ,REG_USR_ID                      --등록자ID
            ,REG_DT                          --등록일자
            ,RO_STAT_CD
            ,RO_DT
            ,CAR_WASH_STAT_CD
            ,PAINT_STAT_CD
            ,QT_TEST_STAT_CD
            ,RO_GRP_NO
            ,RO_REMARK
            ,WRK_ALLOC_YN
            ,QT_TEST_MTH_CD
            ,CHG_EXPC_DL_DT
        )
        VALUES
        (
            #{dlrCd}                          --딜러코드
            ,#{roDocNo}                        --RO문서번호
            ,#{roTp}                           --RO유형
            ,#{resvDocNo}                      --예약문서번호
            ,#{vinNo}                          --차대번호
            ,#{carRegNo}                       --차량등록번호
            ,#{enginNo}                  --엔진시리얼번호
            ,#{carOwnerId}                       --차량소유자ID
            ,#{carOwnerNm}                       --차량소유자명
            ,#{driverId}                       --운전자ID
            ,#{driverNm}                       --운전자명
            ,#{resvTp}                         --예약유형
            ,#{resvDt}                         --예약일자
            ,#{bayNo}                          --베이번호
            ,#{tecId}                          --TecManID
            ,#{tecNm}                          --TecMan명
            ,#{saId}                           --SAID
            ,#{saNm}                           --SA명
            ,SYSDATE                           --작업예약일자
            ,#{serResvStartDt}                 --서비스예약일자
            ,#{serResvEndDt}                   --서비스예약일자
            ,#{parAmt}                         --부품금액
            ,#{lbrAmt}                         --공임금액
            ,#{etcAmt}                         --기타금액
            ,#{dcAmt}                          --할인금액
            ,#{sumAmt}                         --합계금액
            ,#{vatAmt}                         --부가가치세금액
            ,#{totAmt}                         --총금액
            ,#{balAmt}                         --예치금액
            ,#{resvStatCd}                     --예약상태코드
            ,#{custRemark}                         --비고
            ,#{cancReasonCd}                   --취소사유코드
            ,#{cancReasonCont}                 --취소사유내용
            ,#{distUnitCd}                     --거리단위코드
            ,#{runDistVal}                     --주행거리값
            ,#{diagDocNo}                       --사전점검번호
            ,#{baseRoNo}                       --원RO번호
            ,#{incReqNo}                       --보험신청번호
            ,#{custWaitMthCd}                  --고객대기방법코드
            ,#{atqProcTp}                      --고품처리유형
            ,#{carWashTp}                      --차량세차유형
            ,#{carDriveReqTp}                  --차량시승요청유형
            ,#{expcDlDt}                       --예정인도일자
            ,NVL(#{roEndYn}, 'N')            --RO완료여부
            ,NVL(#{atqProcYn}, 'N')               --고품처리여부
            ,NVL(#{carWashYn}, 'N')                --차량세차여부
            ,NVL(#{serTagYn}, 'N')                 --서비스태그여부
            ,#{vsitCarReceiveDt}               --방문차량수령일자
            ,#{vsitCarReceiveIfNm}             --방문차량수령연계인명
            ,#{vsitCarReceiveCinoNo}           --방문차량수령연락처번호
            ,#{vsitCarReceiveAddrNm}           --방문차량수령주소명
            ,#{carReceiveDt}                   --차량수령일자
            ,#{vsitDlIfNm}                     --방문인도연계인명
            ,#{vsitDlCinoNo}                   --방문인도연락처번호
            ,#{vsitDlAddrNm}                   --방문인도주소명
            ,#{vsitDt}                         --방문일자
            ,#{vsitIfNm}                       --방문연계인명
            ,#{vsitCinoNo}                     --방문연락처번호
            ,#{vsitAddrNm}                     --방문주소명
            ,#{regUsrId}                       --등록자ID
            ,SYSDATE
            ,#{roStatCd}
            ,SYSDATE
            ,#{carWashStatCd}
            ,#{paintStatCd}
            ,#{qtTestStatCd}
            ,#{roGrpNo}
            ,#{roRemark}
            ,#{wrkAllocYn}
            ,#{qtTestMthCd}
            ,#{chgExpcDlDt}
        )
    </insert>

    <!-- RO접수  수정. -->
    <update id="updateRepairOrder" parameterType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.updateRepairOrder] */
        UPDATE SE_0300T SET
            UPDT_USR_ID              = #{updtUsrId}                           --수정자ID
            ,UPDT_DT                  = SYSDATE                          --수정일자
            <if test='roTp != null and roTp != ""'>
            ,RO_TP                     = #{roTp}                            --RO유형
            </if>
            <if test='resvDocNo != null and resvDocNo != ""'>
            ,RESV_DOC_NO              = #{resvDocNo}                      --예약문서번호
            </if>
            <if test='vinNo != null and vinNo != ""'>
            ,VIN_NO                   = #{vinNo}                          --차대번호
            </if>
            <if test='carRegNo != null and carRegNo != ""'>
            ,CAR_REG_NO               = #{carRegNo}                       --차량등록번호
            </if>
            <if test='enginNo != null and enginNo != ""'>
            ,ENGIN_NO                 = #{enginNo}                  --엔진시리얼번호
            </if>
            <if test='carOwnerId != null and carOwnerId != ""'>
            ,CAR_OWNER_ID             = #{carOwnerId}                       --차량소유자ID
            </if>
            <if test='carOwnerNm != null and carOwnerNm != ""'>
            ,CAR_OWNER_NM             = #{carOwnerNm}                       --차량소유자명
            </if>
            <if test='driverId != null and driverId != ""'>
            ,DRIVER_ID                = #{driverId}                       --운전자ID
            </if>
            <if test='driverNm != null and driverNm != ""'>
            ,DRIVER_NM                = #{driverNm}                       --운전자명
            </if>
            <if test='resvTp != null and resvTp != ""'>
            ,RESV_TP                  = #{resvTp}                         --예약유형
            </if>
            <if test='resvDt != null'>
            ,RESV_DT                  = #{resvDt}                         --예약일자
            </if>
            <if test='bayNo != null and bayNo != ""'>
            ,BAY_NO                   = #{bayNo}                          --베이번호
            </if>
            <if test='tecId != null and tecId != ""'>
            ,TEC_ID                   = #{tecId}                          --TecManID
            </if>
            <if test='tecNm != null and tecNm != ""'>
            ,TEC_NM                   = #{tecNm}                          --TecMan명
            </if>
            <if test='saId != null and saId != ""'>
            ,SA_ID                    = #{saId}                           --SAID
            </if>
            <if test='saNm != null and saNm != ""'>
            ,SA_NM                    = #{saNm}                           --SA명
            </if>
            <if test='operResvDt != null'>
            ,OPER_RESV_DT             = #{operResvDt}                     --작업예약일자
            </if>
            <if test='serResvStartDt != null'>
            ,SER_RESV_START_DT        = #{serResvStartDt}                      --서비스예약일자
            </if>
            <if test='serResvEndDt != null'>
            ,SER_RESV_END_DT          = #{serResvEndDt}                      --서비스예약일자
            </if>
            <if test='parAmt != null and parAmt != ""'>
            ,PAR_AMT                  = #{parAmt}                         --부품금액
            </if>
            <if test='lbrAmt != null and lbrAmt != ""'>
            ,LBR_AMT                  = #{lbrAmt}                         --공임금액
            </if>
            <if test='etcAmt != null and etcAmt != ""'>
            ,ETC_AMT                  = #{etcAmt}                         --기타금액
            </if>
            <if test='dcAmt != null and dcAmt != ""'>
            ,DC_AMT                   = #{dcAmt}                          --할인금액
            </if>
            <if test='sumAmt != null and sumAmt != ""'>
            ,SUM_AMT                  = #{sumAmt}                         --합계금액
            </if>
            <if test='vatAmt != null and vatAmt != ""'>
            ,VAT_AMT                  = #{vatAmt}                         --부가가치세금액
            </if>
            <if test='totAmt != null and totAmt != ""'>
            ,TOT_AMT                  = #{totAmt}                         --총금액
            </if>
            <if test='balAmt != null and balAmt != ""'>
            ,BAL_AMT                  = #{balAmt}                         --예치금액
            </if>
            <if test='resvStatCd != null and resvStatCd != ""'>
            ,RESV_STAT_CD             = #{resvStatCd}                     --예약상태코드
            </if>
            <if test='custRemark != null and custRemark != ""'>
            ,CUST_REMARK              = #{custRemark}                     --비고
            </if>
            <if test='cancReasonCd != null and cancReasonCd != ""'>
            ,CANC_REASON_CD           = #{cancReasonCd}                   --취소사유코드
            </if>
            <if test='cancReasonCont != null and cancReasonCont != ""'>
            ,CANC_REASON_CONT         = #{cancReasonCont}                 --취소사유내용
            </if>
            <if test='distUnitCd != null and distUnitCd != ""'>
            ,DIST_UNIT_CD             = #{distUnitCd}                     --거리단위코드
            </if>
            <if test='runDistVal != null and runDistVal != ""'>
            ,RUN_DIST_VAL             = #{runDistVal}                     --주행거리값
            </if>
            <if test='diagDocNo != null and diagDocNo != ""'>
            ,DIAG_DOC_NO               = #{diagDocNo}                       --사전점검번호
            </if>
            <if test='baseRoNo != null and baseRoNo != ""'>
            ,BASE_RO_NO               = #{baseRoNo}                       --원RO번호
            </if>
            <if test='incReqNo != null and incReqNo != ""'>
            ,INC_REQ_NO               = #{incReqNo}                       --보험신청번호
            </if>
            <if test='custWaitMthCd != null and custWaitMthCd != ""'>
            ,CUST_WAIT_MTH_CD         = #{custWaitMthCd}                  --고객대기방법코드
            </if>
            <if test='atqProcTp != null and atqProcTp != ""'>
            ,ATQ_PROC_TP              = #{atqProcTp}                      --고품처리유형
            </if>
            <if test='carWashTp != null and carWashTp != ""'>
            ,CAR_WASH_TP              = #{carWashTp}                      --차량세차유형
            </if>
            <if test='carDriveReqTp != null and carDriveReqTp != ""'>
            ,CAR_DRIVE_REQ_TP         = #{carDriveReqTp}                  --차량시승요청유형
            </if>
            <if test='expcDlDt != null'>
            ,EXPC_DL_DT               = #{expcDlDt}                       --예정인도일자
            </if>
            <if test='roEndYn != null and roEndYn != ""'>
            ,RO_END_YN                = #{roEndYn}                        --RO완료여부
            </if>
            <if test='atqProcYn != null and atqProcYn != ""'>
            ,ATQ_PROC_YN              = #{atqProcYn}                      --고품처리여부
            </if>
            <if test='carWashYn != null and carWashYn != ""'>
            ,CAR_WASH_YN              = #{carWashYn}                      --차량세차여부
            </if>
            <if test='serTagYn != null and serTagYn != ""'>
            ,SER_TAG_YN               = #{serTagYn}                       --서비스태그여부
            </if>
            <if test='vsitCarReceiveDt != null'>
            ,VSIT_CAR_RECEIVE_DT      = #{vsitCarReceiveDt}               --방문차량수령일자
            </if>
            <if test='vsitCarReceiveIfNm != null and vsitCarReceiveIfNm != ""'>
            ,VSIT_CAR_RECEIVE_IF_NM   = #{vsitCarReceiveIfNm}             --방문차량수령연계인명
            </if>
            <if test='vsitCarReceiveCinoNo != null and vsitCarReceiveCinoNo != ""'>
            ,VSIT_CAR_RECEIVE_CINO_NO = #{vsitCarReceiveCinoNo}           --방문차량수령연락처번호
            </if>
            <if test='vsitCarReceiveAddrNm != null and vsitCarReceiveAddrNm != ""'>
            ,VSIT_CAR_RECEIVE_ADDR_NM = #{vsitCarReceiveAddrNm}           --방문차량수령주소명
            </if>
            <if test='carReceiveDt != null'>
            ,CAR_RECEIVE_DT           = #{carReceiveDt}                   --차량수령일자
            </if>
            <if test='vsitDlIfNm != null and vsitDlIfNm != ""'>
            ,VSIT_DL_IF_NM            = #{vsitDlIfNm}                     --방문인도연계인명
            </if>
            <if test='vsitDlCinoNo != null and vsitDlCinoNo != ""'>
            ,VSIT_DL_CINO_NO          = #{vsitDlCinoNo}                   --방문인도연락처번호
            </if>
            <if test='vsitDlAddrNm != null and vsitDlAddrNm != ""'>
            ,VSIT_DL_ADDR_NM          = #{vsitDlAddrNm}                   --방문인도주소명
            </if>
            <if test='vsitDt != null'>
            ,VSIT_DT                  = #{vsitDt}                         --방문일자
            </if>
            <if test='vsitIfNm != null and vsitIfNm != ""'>
            ,VSIT_IF_NM               = #{vsitIfNm}                       --방문연계인명
            </if>
            <if test='vsitCinoNo != null and vsitCinoNo != ""'>
            ,VSIT_CINO_NO             = #{vsitCinoNo}                     --방문연락처번호
            </if>
            <if test='vsitAddrNm != null and vsitAddrNm != ""'>
            ,VSIT_ADDR_NM             = #{vsitAddrNm}                     --방문주소명
            </if>
            <if test='roStatCd != null and roStatCd != ""'>
            ,RO_STAT_CD               = #{roStatCd}
            </if>
            <if test='roDt != null'>
            ,RO_DT                    = #{roDt}
            </if>
            <if test='carWashStatCd != null and carWashStatCd != ""'>
            ,CAR_WASH_STAT_CD         = #{carWashStatCd}
            </if>
            <if test='paintStatCd != null and paintStatCd != ""'>
            ,PAINT_STAT_CD            = #{paintStatCd}
            </if>
            <if test='qtTestStatCd != null and qtTestStatCd != ""'>
            ,QT_TEST_STAT_CD          = #{qtTestStatCd}
            </if>
            <if test='roGrpNo != null and roGrpNo != ""'>
            ,RO_GRP_NO          = #{roGrpNo}
            </if>
            <if test='roStartDt != null'>
            ,RO_START_DT         = #{roStartDt}
            </if>
             <if test='roEndDt != null'>
            ,RO_END_DT              = #{roEndDt}
            </if>
            <if test='paintQty != null and paintQty != ""'>
            ,PAINT_QTY          = #{paintQty}
            </if>
            <if test='paintColorCd != null and paintColorCd != ""'>
            ,PAINT_COLOR_CD          = #{paintColorCd}
            </if>
            <if test='carColorCd != null and carColorCd != ""'>
            ,CAR_COLOR_CD          = #{carColorCd}
            </if>
            <if test='paintTp != null and paintTp != ""'>
            ,PAINT_TP          = #{paintTp}
            </if>
            <if test='roRemark != null and roRemark != ""'>
            ,RO_REMARK          = #{roRemark}
            </if>
            <if test='wrkAllocYn != null and wrkAllocYn != ""'>
            ,WRK_ALLOC_YN          = #{wrkAllocYn}
            </if>
            <if test='qtTestMthCd != null and qtTestMthCd != ""'>
            ,QT_TEST_MTH_CD          = #{qtTestMthCd}
            </if>
            <if test='chgExpcDlDt != null'>
            ,CHG_EXPC_DL_DT          = #{chgExpcDlDt}
            </if>
            WHERE RO_GRP_NO = #{roGrpNo}
            <if test='roDocNo != null and roDocNo != ""'>
                AND RO_DOC_NO = #{roDocNo}
            </if>
    </update>

    <delete id="deleteRepairOrder" parameterType="String">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.deleteRepairOrder] */
        DELETE FROM SE_0100T WHERE RESV_DOC_NO = #{resvDocNo}
    </delete>

    <!-- RO접수 목록 조회. -->
    <select id="selectRepairOrderByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT A.*
                FROM SE_0300T A
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        AND A.DLR_CD = #{sDlrCd}
                    </if>
                    <if test='sRoDocNo != null and sRoDocNo != ""'>
                        AND A.RO_DOC_NO like '%'|| #{sRoDocNo}|| '%'
                    </if>
                    <if test='sVinNo != null and sVinNo != ""'>
                    <choose>
                        <when test='@org.apache.commons.lang3.StringUtils@contains(sVinNo,"*")'>
                            <bind name='sVinNo' value='@org.apache.commons.lang3.StringUtils@replace(sVinNo, "*", "%")' />
                            AND A.VIN_NO LIKE #{sVinNo}
                        </when>
                        <otherwise>
                            AND A.VIN_NO = #{sVinNo}
                        </otherwise>
                    </choose>
                    </if>
                    <if test='sTecNm != null and sTecNm != ""'>
                    <choose>
                        <when test='@org.apache.commons.lang3.StringUtils@contains(sTecNm,"*")'>
                            <bind name='sTecNm' value='@org.apache.commons.lang3.StringUtils@replace(sTecNm, "*", "%")' />
                            AND A.TEC_NM LIKE #{sTecNm}
                        </when>
                        <otherwise>
                            AND A.TEC_NM = #{sTecNm}
                        </otherwise>
                    </choose>
                    </if>
                    <if test='sSaNm != null and sSaNm != ""'>
                    <choose>
                        <when test='@org.apache.commons.lang3.StringUtils@contains(sSaNm,"*")'>
                            <bind name='sSaNm' value='@org.apache.commons.lang3.StringUtils@replace(sSaNm, "*", "%")' />
                            AND A.SA_NM LIKE #{sSaNm}
                        </when>
                        <otherwise>
                            AND A.SA_NM = #{sSaNm}
                        </otherwise>
                    </choose>
                    </if>
                    <if test='sDriverNm != null and sDriverNm != ""'>
                    <choose>
                        <when test='@org.apache.commons.lang3.StringUtils@contains(sDriverNm,"*")'>
                            <bind name='sDriverNm' value='@org.apache.commons.lang3.StringUtils@replace(sDriverNm, "*", "%")' />
                            AND A.DRIVER_NM LIKE #{sDriverNm}
                        </when>
                        <otherwise>
                            AND A.DRIVER_NM = #{sDriverNm}
                        </otherwise>
                    </choose>
                    </if>
                    <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                    <choose>
                        <when test='@org.apache.commons.lang3.StringUtils@contains(sCarOwnerNm,"*")'>
                            <bind name='sCarOwnerNm' value='@org.apache.commons.lang3.StringUtils@replace(sCarOwnerNm, "*", "%")' />
                            AND A.CAR_OWNER_NM LIKE #{sCarOwnerNm}
                        </when>
                        <otherwise>
                            AND A.CAR_OWNER_NM = #{sCarOwnerNm}
                        </otherwise>
                    </choose>
                    </if>
                    <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                        AND A.CAR_OWNER_ID = #{sCarOwnerId}
                    </if>
                    <if test='sCarRegNo != null and sCarRegNo != ""'>
                    <choose>
                        <when test='@org.apache.commons.lang3.StringUtils@contains(sCarRegNo,"*")'>
                            <bind name='sCarRegNo' value='@org.apache.commons.lang3.StringUtils@replace(sCarRegNo, "*", "%")' />
                            AND A.CAR_REG_NO LIKE #{sCarRegNo}
                        </when>
                        <otherwise>
                            AND A.CAR_REG_NO = #{sCarRegNo}
                        </otherwise>
                    </choose>
                    </if>
                    <if test='sBayNo != null and sBayNo != ""'>
                        AND A.BAY_NO = #{sBayNo}
                    </if>
                    <if test='sRoStatCd != null and sRoStatCd != ""'>
                        AND A.RO_STAT_CD = #{sRoStatCd}
                    </if>
                    <if test='sPaintStatCd != null and sPaintStatCd != ""'>
                        AND A.PAINT_STAT_CD = #{sPaintStatCd}
                    </if>
                    <if test='sQtTestStatCd != null and sQtTestStatCd != ""'>
                        AND A.QT_TEST_STAT_CD = #{sQtTestStatCd}
                    </if>
                    <if test='sCarWashStatCd != null and sCarWashStatCd != ""'>
                        AND A.CAR_WASH_STAT_CD = #{sCarWashStatCd}
                    </if>
                    <if test='sResvDocNo != null and sResvDocNo != ""'>
                        AND A.RESV_DOC_NO = #{sResvDocNo}
                    </if>
                    <if test='sRoTp != null and sRoTp != ""'>
                        AND A.RO_TP = #{sRoTp}
                    </if>
                    <if test='sRoFromDt != null'>
                        AND A.RO_DT <![CDATA[>=]]> #{sRoFromDt}
                    </if>
                    <if test='sRoToDt != null'>
                        AND A.RO_DT <![CDATA[<]]> #{sRoToDt} + 1
                    </if>
                    <if test='sExpcDlFromDt != null'>
                        AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
                    </if>
                    <if test='sExpcDlToDt != null'>
                        AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
                    </if>
                    <if test='sRoStartDt != null'>
                        AND A.RO_START_DT <![CDATA[>=]]> #{sRoStartDt}
                    </if>
                    <if test='sRoEndDt != null'>
                        AND A.RO_END_DT <![CDATA[<]]> #{sRoEndDt} + 1
                    </if>
                    <if test='sRoTp1 != null and sRoTp1 != ""'>
                        AND A.RO_STAT_CD != '01'
                        AND A.RO_STAT_CD != '02'
                    </if>
                    <if test='sRoTp1 == "Q"'>
                        AND A.RO_STAT_CD != '01'
                        AND A.RO_STAT_CD != '02'
                        AND A.RO_STAT_CD != '03'
                    </if>
                </where>
                ORDER BY
                <choose>
                <when test='sort != null'>
                <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                <choose>
                    <when test='item.field == "dlrCd"'>A.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                    <when test='item.field == "roDocNo"'>A.RO_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                    <when test='item.field == "roTp"'>A.RO_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                    <when test='item.field == "resvDocNo"'>A.RESV_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                    <when test='item.field == "vinNo"'>A.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                    <when test='item.field == "carRegNo"'>A.CAR_REG_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                    <when test='item.field == "enginNo"'>A.ENGIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                    <when test='item.field == "carOwnerId"'>A.CAR_OWNER_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                    <when test='item.field == "carOwnerNm"'>A.CAR_OWNER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                    <when test='item.field == "driverNm"'>A.DRIVER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                    <when test='item.field == "runDistVal"'>A.RUN_DIST_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                    <when test='item.field == "giRunDistVal"'>A.GI_RUN_DIST_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                    <when test='item.field == "roDt"'>A.RO_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <otherwise>
                A.RO_DT DESC
                ,A.DLR_CD ASC
                ,A.RO_TP ASC
                </otherwise>
                </choose>
                </foreach>
                </when>
                <otherwise>
                A.RO_DT DESC
                ,A.DLR_CD ASC
                ,A.RO_TP ASC
                </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- RO접수 목록수를 조회. -->
    <select id="selectRepairOrderByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderByConditionCnt] */
        SELECT COUNT(*) AS VALUE
        FROM SE_0300T A
        <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND A.DLR_CD = #{sDlrCd}
            </if>
            <if test='sRoDocNo != null and sRoDocNo != ""'>
                AND A.RO_DOC_NO like '%'|| #{sRoDocNo}|| '%'
            </if>
            <if test='sVinNo != null and sVinNo != ""'>
            <choose>
                <when test='@org.apache.commons.lang3.StringUtils@contains(sVinNo,"*")'>
                    <bind name='sVinNo' value='@org.apache.commons.lang3.StringUtils@replace(sVinNo, "*", "%")' />
                    AND A.VIN_NO LIKE #{sVinNo}
                </when>
                <otherwise>
                    AND A.VIN_NO = #{sVinNo}
                </otherwise>
            </choose>
            </if>
            <if test='sTecNm != null and sTecNm != ""'>
            <choose>
                <when test='@org.apache.commons.lang3.StringUtils@contains(sTecNm,"*")'>
                    <bind name='sTecNm' value='@org.apache.commons.lang3.StringUtils@replace(sTecNm, "*", "%")' />
                    AND A.TEC_NM LIKE #{sTecNm}
                </when>
                <otherwise>
                    AND A.TEC_NM = #{sTecNm}
                </otherwise>
            </choose>
            </if>
            <if test='sSaNm != null and sSaNm != ""'>
            <choose>
                <when test='@org.apache.commons.lang3.StringUtils@contains(sSaNm,"*")'>
                    <bind name='sSaNm' value='@org.apache.commons.lang3.StringUtils@replace(sSaNm, "*", "%")' />
                    AND A.SA_NM LIKE #{sSaNm}
                </when>
                <otherwise>
                    AND A.SA_NM = #{sSaNm}
                </otherwise>
            </choose>
            </if>
            <if test='sDriverNm != null and sDriverNm != ""'>
            <choose>
                <when test='@org.apache.commons.lang3.StringUtils@contains(sDriverNm,"*")'>
                    <bind name='sDriverNm' value='@org.apache.commons.lang3.StringUtils@replace(sDriverNm, "*", "%")' />
                    AND A.DRIVER_NM LIKE #{sDriverNm}
                </when>
                <otherwise>
                    AND A.DRIVER_NM = #{sDriverNm}
                </otherwise>
            </choose>
            </if>
            <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
            <choose>
                <when test='@org.apache.commons.lang3.StringUtils@contains(sCarOwnerNm,"*")'>
                    <bind name='sCarOwnerNm' value='@org.apache.commons.lang3.StringUtils@replace(sCarOwnerNm, "*", "%")' />
                    AND A.CAR_OWNER_NM LIKE #{sCarOwnerNm}
                </when>
                <otherwise>
                    AND A.CAR_OWNER_NM = #{sCarOwnerNm}
                </otherwise>
            </choose>
            </if>
            <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                AND A.CAR_OWNER_ID = #{sCarOwnerId}
            </if>
            <if test='sCarRegNo != null and sCarRegNo != ""'>
            <choose>
                <when test='@org.apache.commons.lang3.StringUtils@contains(sCarRegNo,"*")'>
                    <bind name='sCarRegNo' value='@org.apache.commons.lang3.StringUtils@replace(sCarRegNo, "*", "%")' />
                    AND A.CAR_REG_NO LIKE #{sCarRegNo}
                </when>
                <otherwise>
                    AND A.CAR_REG_NO = #{sCarRegNo}
                </otherwise>
            </choose>
            </if>
            <if test='sBayNo != null and sBayNo != ""'>
                AND A.BAY_NO = #{sBayNo}
            </if>
            <if test='sRoStatCd != null and sRoStatCd != ""'>
                AND A.RO_STAT_CD = #{sRoStatCd}
            </if>
            <if test='sPaintStatCd != null and sPaintStatCd != ""'>
                AND A.PAINT_STAT_CD = #{sPaintStatCd}
            </if>
            <if test='sQtTestStatCd != null and sQtTestStatCd != ""'>
                AND A.QT_TEST_STAT_CD = #{sQtTestStatCd}
            </if>
            <if test='sCarWashStatCd != null and sCarWashStatCd != ""'>
                AND A.CAR_WASH_STAT_CD = #{sCarWashStatCd}
            </if>
            <if test='sResvDocNo != null and sResvDocNo != ""'>
                AND A.RESV_DOC_NO = #{sResvDocNo}
            </if>
            <if test='sRoTp != null and sRoTp != ""'>
                AND A.RO_TP = #{sRoTp}
            </if>
            <if test='sRoFromDt != null'>
                AND A.RO_DT <![CDATA[>=]]> #{sRoFromDt}
            </if>
            <if test='sRoToDt != null'>
                AND A.RO_DT <![CDATA[<]]> #{sRoToDt} + 1
            </if>
            <if test='sExpcDlFromDt != null'>
                AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
            </if>
            <if test='sExpcDlToDt != null'>
                AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
            </if>
            <if test='sRoStartDt != null'>
                AND A.RO_START_DT <![CDATA[>=]]> #{sRoStartDt}
            </if>
            <if test='sRoEndDt != null'>
                AND A.RO_END_DT <![CDATA[<]]> #{sRoEndDt} + 1
            </if>
            <if test='sRoTp1 != null and sRoTp1 != ""'>
                AND A.RO_STAT_CD != '01'
                AND A.RO_STAT_CD != '02'
            </if>
        </where>
    </select>

    <!-- RO접수 상세 조회. -->
    <select id="selectRepairOrderByKey" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderByKey] */
        SELECT A.*, B.DIAG_DOC_NO, B.PRE_CHK_DT
        FROM SE_0300T A
        LEFT JOIN SE_0200T B
        ON A.RESV_DOC_NO = B.RESV_DOC_NO
        <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND A.DLR_CD = #{sDlrCd}
            </if>
            <if test='sRoDocNo != null and sRoDocNo != ""'>
                AND A.RO_DOC_NO = #{sRoDocNo}
            </if>
            <if test='sResvDocNo != null and sResvDocNo != ""'>
                AND A.RESV_DOC_NO = #{sResvDocNo}
            </if>
        </where>
    </select>

    <!-- 출고취소시 RO 접수확인 -->
    <select id="selectRepairOrderCheckByKey" parameterType="RepairOrderSearchVO" resultType="string">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderCheckByKey] */
         SELECT CASE WHEN NVL(RO_CNT,0) = 0 THEN 'Y' ELSE 'N' END RESULT_YN
           FROM(
             SELECT COUNT(RO_DOC_NO) AS RO_CNT
               FROM SE_0300T
              WHERE VIN_NO = #{sVinNo}
                AND RO_STAT_CD != '06'
           )DUAL
    </select>

    <!-- 이전RO 조회 팝업 -->
    <select id="selectPreRepairOrderByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectPreRepairOrderByCondition] */

          SELECT ROWNUM RNUM
                ,A.RO_DOC_NO
                ,A.RO_DT
                ,A.RUN_DIST_VAL
            FROM SE_0300T A, SE_0310T B
          WHERE A.DLR_CD = #{sDlrCd}
            AND A.VIN_NO = #{sVinNo}
            AND B.DLR_CD = A.DLR_CD
            AND B.RO_DOC_NO = A.RO_DOC_NO
            AND B.ITEM_CD = #{sItemCd}
            AND A.RO_DOC_NO <![CDATA[<]]> #{sRoDocNo}
        ORDER BY RO_DOC_NO ASC
    </select>

    <!-- RO접수현황 목록 조회. -->
    <select id="selectRepairOrderListByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderListByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM
                   ,T2.* FROM (
                SELECT T1.*
                  FROM (
                     SELECT B.*
                           ,FN_CMM_CD_NM('COM020',B.PAID_YN,#{sLangCd},'N') AS PAID_YN_NM
                           ,FN_CMM_CD_NM('COM020',B.RESV_YN,#{sLangCd},'N') AS RESV_YN_NM
                           ,B.LBR_DC + B.PAR_DC AS DC_AMT               -- 할인금액
                           ,B.PAR_AMT + B.LBR_AMT + B.ETC_AMT AS SUM_AMT --합계금액
                           ,CASE WHEN B.RO_STAT_CD ='06' THEN B.UPDT_USR_NM ELSE NULL END AS RO_CANC_NM --RO 취소자
                           ,C.CALC_DOC_NO
                           ,C.CALC_DT
                           ,B.PAR_AMT AS CALC_PAR_AMT --부품금액
                           ,B.LBR_AMT AS CALC_LBR_AMT  --공임금액
                           ,B.ETC_AMT AS CALC_ETC_AMT  --기타금액
                           ,B.PAR_DC + B.LBR_DC AS CALC_DC_AMT --할인금액
                           ,NVL(C.LBR_ETC_DC_AMT ,0 )+ NVL(C.PAR_ETC_DC_AMT,0 ) AS CALC_ETC_DC_AMT
                           ,NVL(C.LAST_CALC_TOT_AMT, 0) AS CALC_SUM_AMT
                           ,NVL(C.BM_POINT_TOT_AMT,0) AS BM_POINT_USE_AMT
                           ,NVL(C.BM_CUPN_TOT_AMT,0) AS BM_CUPN_USE_AMT
                           ,NVL(C.POINT_TOT_AMT,0) AS POINT_USE_AMT
                           ,NVL(C.LBR_DC_AMT,0) AS LBR_DC_AMT
                           ,NVL(C.PAR_DC_AMT,0) AS PAR_DC_AMT
                           ,(SELECT USR_NM FROM CM_0801T WHERE DLR_CD = C.DLR_CD AND USR_ID = C.REG_USR_ID) AS CALC_PRSN_NM
                           ,C.REG_DT AS CALC_REG_DT
                           ,E.WON_UNIT_CUT_AMT
                           ,E.DEMIC_POINT_CUT_AMT
                           ,F.PAYM_AMT
                           ,F.RCV_AMT
                           ,F.NPAY_AMT
                           ,(SELECT MAX(RCV_CPLT_DT) FROM SE_0570T WHERE RCV_DOC_NO = D.RCV_DOC_NO) AS PAY_END_DT --지불완료시간
                           ,(SELECT ORD_DLR_CD FROM SA_0121T WHERE VIN_NO = B.VIN_NO AND ROWNUM = 1) AS ORD_DLR_CD --판매딜러
                           ,(SELECT BLUE_MEMBERSHIP_NO FROM CR_0101T WHERE DLR_CD = B.DLR_CD AND CUST_NO = B.CAR_OWNER_ID) AS BLUE_MEMBERSHIP_NO --BM회원번호
                           ,CASE WHEN (SELECT MEMBERSHIP_POLICY FROM CM_0101T WHERE DLR_CD = B.DLR_CD) = 'V'
                                 THEN (SELECT MEMBERSHIP_NO FROM CR_0801T WHERE DLR_CD = B.DLR_CD AND VIN_NO = B.VIN_NO)
                                 ELSE (SELECT MEMBERSHIP_NO FROM CR_0801T WHERE DLR_CD = B.DLR_CD AND CUST_NO = B.CAR_OWNER_ID)
                            END AS MEMBERSHIP_NO --딜러회원번호
                       FROM(
                             SELECT DLR_CD                          --딜러코드
                                   ,RO_DOC_NO                       --RO문서번호
                                   ,RO_TP                           --RO유형
                                   ,FN_CMM_CD_NM('SER031',A.RO_TP,#{sLangCd},'N') AS RO_TP_NM
                                   ,RESV_DOC_NO                     --예약문서번호
                                   ,VIN_NO                          --차대번호
                                   ,CAR_REG_NO                      --차량등록번호
                                   ,ENGIN_NO                        --엔진번호
                                   ,CAR_OWNER_ID                    --차량소유자ID
                                   ,CAR_OWNER_NM                    --차량소유자명
                                   ,DRIVER_ID                       --운전자ID
                                   ,DRIVER_NM                       --운전자명
                                   ,RESV_TP                         --예약유형
                                   ,RESV_DT                         --예약일자
                                   ,BAY_NO                          --베이번호
                                   ,TEC_ID                          --TechManID
                                   ,TEC_NM                          --TechMan명
                                   ,SA_ID                           --SAID
                                   ,SA_NM                           --SA명
                                   ,OPER_RESV_DT                    --작업예약일자
                                   ,SER_RESV_START_DT               --서비스예약시작일자
                                   ,(
                                      SELECT NVL(SUM(ITEM_TOT_AMT),0)
                                        FROM SE_0160T
                                       WHERE DLR_CD = A.DLR_CD
                                         AND DOC_NO = A.RO_DOC_NO
                                         AND PREFIX_ID = 'RO'
                                     )AS PAR_AMT --부품금액
                                    ,(
                                      SELECT NVL(SUM(LBR_TOT_AMT),0)
                                        FROM SE_0170T
                                       WHERE DLR_CD = A.DLR_CD
                                         AND DOC_NO = A.RO_DOC_NO
                                         AND PREFIX_ID = 'RO'
                                     ) AS LBR_AMT  --공임금액
                                    ,(
                                      SELECT NVL(SUM(ETC_REQ_PRC),0)
                                        FROM SE_0140T
                                       WHERE DLR_CD = A.DLR_CD
                                         AND JOB_NO = A.RO_DOC_NO
                                         AND PREFIX_ID = 'RO'
                                     ) AS ETC_AMT  --기타금액
                                     ,(
                                      SELECT NVL(SUM(DC_AMT),0)
                                        FROM SE_0160T
                                       WHERE DLR_CD = A.DLR_CD
                                         AND DOC_NO = A.RO_DOC_NO
                                         AND PREFIX_ID = 'RO'
                                     )AS PAR_DC --부품할인금액
                                     ,(
                                      SELECT NVL(SUM(DC_AMT),0)
                                        FROM SE_0170T
                                       WHERE DLR_CD = A.DLR_CD
                                         AND DOC_NO = A.RO_DOC_NO
                                         AND PREFIX_ID = 'RO'
                                     )AS LBR_DC  --공임할인금액
                                   ,NVL(BAL_AMT ,0 ) BAL_AMT                         --예치금액
                                   ,CANC_REASON_CD                  --취소사유코드
                                   ,FN_CMM_CD_NM('SER014',A.CANC_REASON_CD,#{sLangCd},'N') AS CANC_REASON_NM
                                   ,CANC_REASON_CONT                --취소사유내용
                                   ,CASE WHEN RO_STAT_CD ='06' THEN UPDT_DT ELSE NULL END AS RO_CANC_DT --RO 취소시간
                                   ,DIST_UNIT_CD                    --거리단위코드
                                   ,RUN_DIST_VAL                    --주행거리값
                                   ,DIAG_DOC_NO                     --진단문서번호
                                   ,BASE_RO_NO                      --원RO번호
                                   ,INC_REQ_NO                      --보험신청번호
                                   ,CUST_WAIT_MTH_CD                --고객대기방법코드
                                   ,FN_CMM_CD_NM('SER032',A.CUST_WAIT_MTH_CD,#{sLangCd},'N') AS CUST_WAIT_MTH_NM
                                   ,ATQ_PROC_TP                     --고품처리유형
                                   ,FN_CMM_CD_NM('SER033',A.ATQ_PROC_TP,#{sLangCd},'N') AS ATQ_PROC_TP_NM
                                   ,CAR_WASH_TP                     --차량세차유형
                                   ,FN_CMM_CD_NM('SER034',A.CAR_WASH_TP,#{sLangCd},'N') AS CAR_WASH_TP_NM
                                   ,CAR_DRIVE_REQ_TP                --차량시승요청유형
                                   ,FN_CMM_CD_NM('SER035',A.CAR_DRIVE_REQ_TP,#{sLangCd},'N') AS CAR_DRIVE_REQ_TP_NM
                                   ,EXPC_DL_DT                      --예정인도일자
                                   ,ATQ_PROC_YN                     --고품처리여부
                                   ,CAR_WASH_YN                     --차량세차여부
                                   ,VSIT_CAR_RECEIVE_DT             --방문차량수령일자
                                   ,VSIT_CAR_RECEIVE_IF_NM          --방문차량수령연계인명
                                   ,VSIT_CAR_RECEIVE_CINO_NO        --방문차량수령연락처번호
                                   ,VSIT_CAR_RECEIVE_ADDR_NM        --방문차량수령주소명
                                   ,CAR_RECEIVE_DT                  --차량수령일자
                                   ,VSIT_DL_IF_NM                   --방문인도연계인명
                                   ,VSIT_DL_CINO_NO                 --방문인도연락처번호
                                   ,VSIT_DL_ADDR_NM                 --방문인도주소명
                                   ,VSIT_DT                         --방문일자
                                   ,VSIT_IF_NM                      --방문연계인명
                                   ,VSIT_CINO_NO                    --방문연락처번호
                                   ,VSIT_ADDR_NM                    --방문주소명
                                   ,REG_USR_ID                      --등록자ID
                                   ,UPDT_USR_ID                     --수정자ID
                                   ,UPDT_DT
                                   ,ALLOC_EMP_ID                    --배정자ID
                                   ,SER_RESV_END_DT                 --서비스예약종료일자
                                   ,INC_REQ_DT                      --보험신청일자
                                   ,RO_STAT_CD                      --RO상태코드
                                   ,FN_CMM_CD_NM('SER030',A.RO_STAT_CD,#{sLangCd},'N') AS RO_STAT_NM
                                   ,RO_DT                           --RO일자
                                   ,CAR_WASH_STAT_CD                --세차상태코드
                                   ,PAINT_STAT_CD                   --페인트상태코드
                                   ,QT_TEST_STAT_CD                 --품질검사상태코드
                                   ,RO_GRP_NO                       --RO그룹번호
                                   ,PAINT_QTY                       --페인트수량
                                   ,PAINT_COLOR_CD                  --페인트색상코드
                                   ,CAR_COLOR_CD                    --차량색상코드
                                   ,PAINT_TP                        --페인트유형
                                   ,RO_START_DT                     --RO시작일자
                                   ,RO_END_DT                       --RO종료일자
                                   ,RO_REMARK                       --RO비고
                                   ,QT_TEST_MTH_CD                  --품질검사방법코드
                                   ,FN_CMM_CD_NM('SER040',A.QT_TEST_MTH_CD,#{sLangCd},'N') AS QT_TEST_MTH_NM
                                   ,CHG_EXPC_DL_DT                  --변경예정인도일자
                                   ,CAU_CD1                         --원인코드1
                                   ,CAU_NM1                         --원인명1
                                   ,PHEN_CD1                        --현상코드1
                                   ,PHEN_NM1                        --현상명1
                                   ,CAU_CD2                         --원인코드2
                                   ,CAU_NM2                         --원인명2
                                   ,PHEN_CD2                        --현상코드2
                                   ,PHEN_NM2                        --현상명2
                                   ,QT_TEST_START_DT                --품질검사시작일자
                                   ,QT_TEST_END_DT                  --품질검사종료일자
                                   ,QT_TEST_PRSN_CD                 --품질검사담당자코드
                                   ,QT_TEST_PRSN_NM                 --품질검사담당자명
                                   ,CAR_WASH_START_DT               --차량세차시작일자
                                   ,CAR_WASH_END_DT                 --차량세차종료일자
                                   ,CAR_WASH_PRSN_CD                --차량세차담당자코드
                                   ,CAR_WASH_PRSN_NM                --차량세차담당자명
                                   ,ROAD_TEST_CD                    --도로검사코드
                                   ,PRE_AMT                         --선수금액
                                   ,RWRK_CD                         --리워크코드
                                   ,RWRK_REMARK                     --리워크비고
                                   ,RO_END_CHK_YN                   --RO종료확인여부
                                   ,ATQ_PROC_CHK_YN                 --고품처리확인여부
                                   ,QT_CHK_YN                       --품질확인여부
                                   ,CAR_WASH_CHK_YN                 --차량세차확인여부
                                   ,SER_TAG_CHK_YN                  --서비스태그확인여부
                                   ,GI_RUN_DIST_VAL                 --주행거리값
                                   ,CASE WHEN TO_CHAR(GI_RUN_DIST_VAL) = '0' THEN '' ELSE TO_CHAR(GI_RUN_DIST_VAL) END AS GI_RUN_DIST_VAL_TEXT
                                   ,DL_CHK_PRSN_CD                  --인도확인자코드
                                   ,DL_CHK_PRSN_NM                  --인도확인자명
                                   ,CAR_WASH_CANC_DT                --차량세차취소일자
                                   ,ALLOC_STAT_CD                   --배정상태코드
                                   ,WRK_STAT_CD                     --작업상태코드
                                   ,FN_CMM_CD_NM('SER050',A.WRK_STAT_CD,#{sLangCd},'N') AS WRK_STAT_NM
                                   ,DL_STAT_CD                      --인도상태코드
                                   ,NVL(GOODWILL_YN,'N') AS GOODWILL_YN --GOODWILL여부
                                   ,FN_CMM_CD_NM('COM020',GOODWILL_YN,#{sLangCd},'N') AS GOODWILL_YN_NM
                                   ,NVL(GOODWILL_STAT_CD,'O') AS GOODWILL_STAT_CD --GOODWILL 사용여부
                                   ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1 ) AS LAST_RUN_DIST_VAL
                                   ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO  AND ROWNUM = 1) AS CARLINE_NM
                                   ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                                   ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                                   ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) AS UPDT_USR_NM
                                   ,EXPC_DL_DT - 30/(24*60) AS EXPC_DL_START_DT  -- 예정인도시간
                                   ,RO_PRINT_DT
                                   ,DLR_RO_TP
                                   ,FN_CMM_CD_NM('SER044',A.DLR_RO_TP,#{sLangCd},'N') AS DLR_RO_TP_NM
                                   ,CASE WHEN RO_STAT_CD = '05' THEN 'Y' ELSE 'N' END AS PAID_YN
                                   ,CASE WHEN RESV_DOC_NO IS NOT NULL THEN 'Y' ELSE 'N' END AS RESV_YN
                                   ,(SELECT CUST_SALE_DT FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CUST_SALE_DT --차량판매일
                            FROM SE_0300T A
                            <where>
                                <if test='sDlrCd != null and sDlrCd != ""'>
                                    AND A.DLR_CD = #{sDlrCd}
                                </if>
                                <if test='sRoDocNo != null and sRoDocNo != ""'>
                                    AND A.RO_DOC_NO like '%'||#{sRoDocNo}||'%'
                                </if>
                                <if test='sVinNo != null and sVinNo != ""'>
                                    AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                                </if>
                                <if test='sDriverId != null and sDriverId != ""'>
                                    AND DRIVER_ID = #{sDriverId}
                                </if>
                                <if test='sDriverNm != null and sDriverNm != ""'>
                                    AND DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                                </if>
                                <if test='sCarRegNo != null and sCarRegNo != ""'>
                                    AND CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                                </if>
                                <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                                    AND CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                                </if>
                                <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                                    AND A.CAR_OWNER_ID = #{sCarOwnerId}
                                </if>
                                <if test='sBayNo != null and sBayNo != ""'>
                                    AND A.BAY_NO = #{sBayNo}
                                </if>
                                <if test='sRoTp != null and sRoTp != ""'>
                                    AND A.RO_TP = #{sRoTp}
                                </if>
                                <if test='sRoTpList != null and !sRoTpList.isEmpty'> AND A.RO_TP IN
                                   <foreach item="item" index="index" collection="sRoTpList" open="(" separator="," close=")">
                                       #{item}
                                   </foreach>
                                </if>
                                <if test='sRoStatCd != null and sRoStatCd != ""'>
                                    AND A.RO_STAT_CD = #{sRoStatCd}
                                </if>
                                <if test='sRoFromDt != null'>
                                    AND TO_CHAR(A.RO_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                                </if>
                                <if test='sRoToDt != null'>
                                    AND TO_CHAR(A.RO_DT, 'YYYYMMDD') <![CDATA[<]]> TO_CHAR(#{sRoToDt} + 1, 'YYYYMMDD')
                                </if>
                                <if test='sExpcDlFromDt != null'>
                                    AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
                                </if>
                                <if test='sExpcDlToDt != null'>
                                    AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
                                </if>
                                <if test='sRoStartDt != null'>
                                    AND A.RO_START_DT <![CDATA[>=]]> #{sRoStartDt}
                                </if>
                                <if test='sRoEndDt != null'>
                                    AND A.RO_END_DT <![CDATA[<]]> #{sRoEndDt} + 1
                                </if>
                                <if test='sDlrRoTp != null and sDlrRoTp != ""'>
                                    AND A.DLR_RO_TP = #{sDlrRoTp}
                                </if>
                            </where>
                      )B LEFT OUTER JOIN SE_0500T C
                        ON B.RO_DOC_NO    = C.RO_DOC_NO
                       AND B.DLR_CD       = C.DLR_CD
                       AND B.RO_TP        = C.RO_TP
                       AND C.CALC_CANC_YN = 'N'
                      LEFT OUTER JOIN SE_0550T D
                        ON B.RO_DOC_NO    = D.RO_DOC_NO
                       AND B.DLR_CD       = D.DLR_CD
                       AND B.RO_TP        = D.RO_TP
                       AND C.CALC_DOC_NO  = D.CALC_DOC_NO
                      LEFT OUTER JOIN (
                        SELECT DLR_CD, CALC_DOC_NO
                               ,NVL(SUM(WON_UNIT_CUT_AMT), 0) AS WON_UNIT_CUT_AMT
                               ,NVL(SUM(DEMIC_POINT_CUT_AMT), 0) AS DEMIC_POINT_CUT_AMT
                        FROM SE_0530T
                        GROUP BY DLR_CD, CALC_DOC_NO
                      ) E
                      ON C.DLR_CD = E.DLR_CD
                      AND C.CALC_DOC_NO = E.CALC_DOC_NO
                      LEFT OUTER JOIN (
                        SELECT DLR_CD, RCV_DOC_NO
                               ,NVL(SUM(PAYM_AMT), 0) AS PAYM_AMT
                               ,NVL(SUM(RCV_AMT), 0) AS RCV_AMT
                               ,NVL(SUM(NPAY_AMT), NVL(SUM(PAYM_AMT), 0) - NVL(SUM(RCV_AMT), 0)) AS NPAY_AMT
                        FROM SE_0560T
                        GROUP BY DLR_CD, RCV_DOC_NO
                      ) F
                      ON D.DLR_CD = F.DLR_CD
                      AND D.RCV_DOC_NO = F.RCV_DOC_NO
                ) T1
                <where>
                    <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                        AND T1.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
                    </if>
                    <if test='sCalcPrsnNm != null and sCalcPrsnNm != ""'>
                        AND T1.CALC_PRSN_NM LIKE '%'||#{sCalcPrsnNm}||'%'
                    </if>
                    <if test='sCalcDocNo != null and sCalcDocNo != ""'>
                        AND T1.CALC_DOC_NO LIKE '%'||#{sCalcDocNo}||'%'
                    </if>
                    <if test='sOrdDlrCd != null and sOrdDlrCd != ""'>
                        AND T1.ORD_DLR_CD LIKE '%'||#{sOrdDlrCd}||'%'
                    </if>
                    <if test='sBlueMembershipNo != null and sBlueMembershipNo != ""'>
                        AND T1.BLUE_MEMBERSHIP_NO LIKE '%'||#{sBlueMembershipNo}||'%'
                    </if>
                    <if test='sCustSaleFromDt != null'>
                        AND T1.CUST_SALE_DT <![CDATA[>=]]> #{sCustSaleFromDt}
                    </if>
                    <if test='sCustSaleToDt != null'>
                        AND T1.CUST_SALE_DT <![CDATA[<]]> #{sCustSaleToDt} + 1
                    </if>
                    <if test='sPayEndFromDt != null'>
                        AND T1.PAY_END_DT <![CDATA[>=]]> #{sPayEndFromDt}
                    </if>
                    <if test='sPayEndToDt != null'>
                        AND T1.PAY_END_DT <![CDATA[<]]> #{sPayEndToDt} + 1
                    </if>
                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                    <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                        <choose>
                            <when test='item.field == "carRegNo"'>          T1.CAR_REG_NO           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "vinNo"'>             T1.VIN_NO               <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carOwnerNm"'>        T1.CAR_OWNER_NM         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "driverNm"'>          T1.DRIVER_NM            <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carlineNm"'>         T1.CARLINE_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "modelNm"'>           T1.MODEL_NM             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "runDistVal"'>        T1.RUN_DIST_VAL         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "giRunDistVal"'>      T1.GI_RUN_DIST_VAL      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roStatNm"'>          T1.RO_STAT_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roDocNo"'>           T1.RO_DOC_NO            <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roTpNm"'>            T1.RO_TP_NM             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roDtFormat"'>        T1.RO_DT                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "regUsrNm"'>          T1.REG_USR_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roPrintDtFormat"'>   T1.RO_PRINT_DT          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "updtDtFormat"'>      T1.UPDT_DT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "updtUsrNm"'>         T1.UPDT_USR_NM          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roCancDtFormat"'>    T1.RO_CANC_DT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roCancNm"'>          T1.RO_CANC_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "cancReasonNm"'>      T1.CANC_REASON_NM       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "lbrAmt"'>            T1.LBR_AMT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "parAmt"'>            T1.PAR_AMT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "etcAmt"'>            T1.ETC_AMT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "sumAmt"'>            T1.SUM_AMT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "expcDlDtFormat"'>    T1.EXPC_DL_DT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "wrkStatNm"'>         T1.WRK_STAT_NM          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "atqProcTpNm"'>       T1.ATQ_PROC_TP_NM       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carWashTpNm"'>       T1.CAR_WASH_TP_NM       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "custWaitMthNm"'>     T1.CUST_WAIT_MTH_NM     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "qtTestMthNm"'>       T1.QT_TEST_MTH_NM       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "goodwillYnNm"'>      T1.GOODWILL_YN_NM       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carDriveReqTpNm"'>   T1.CAR_DRIVE_REQ_TP_NM  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roRemark"'>          T1.RO_REMARK           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "dlrRoTpNm"'>         T1.DLR_RO_TP_NM         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "diagDocNo"'>         T1.DIAG_DOC_NO          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "incReqNo"'>          T1.INC_REQ_NO           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "baseRoNo"'>          T1.BASE_RO_NO           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcDocNo"'>         T1.CALC_DOC_NO          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcRegDtFormat"'>   T1.CALC_REG_DT          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcPrsnNm"'>        T1.CALC_PRSN_NM         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcDtFormat"'>      T1.CALC_DT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcLbrAmt"'>        T1.CALC_LBR_AMT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcParAmt"'>        T1.CALC_PAR_AMT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcEtcAmt"'>        T1.CALC_ETC_AMT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "lbrDcAmt"'>          T1.LBR_DC_AMT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "parDcAmt"'>          T1.PAR_DC_AMT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "pointUseAmt"'>       T1.POINT_USE_AMT        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "bmPointUseAmt"'>     T1.BM_POINT_USE_AMT     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "bmCupnUseAmt"'>      T1.BM_CUPN_USE_AMT      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcEtcDcAmt"'>      T1.CALC_ETC_DC_AMT      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcSumAmt"'>        T1.CALC_SUM_AMT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "paidYnNm"'>          T1.PAID_YN_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "wonUnitCutAmt"'>     T1.WON_UNIT_CUT_AMT     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "demicPointCutAmt"'>  T1.DEMIC_POINT_CUT_AMT  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "paymAmt"'>           T1.PAYM_AMT             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "rcvAmt"'>            T1.RCV_AMT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "npayAmt"'>           T1.NPAY_AMT             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "resvYnNm"'>          T1.RESV_YN_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "custSaleDt"'>        T1.CUST_SALE_DT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "ordDlrCd"'>          T1.ORD_DLR_CD           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "blueMembershipNo"'>  T1.BLUE_MEMBERSHIP_NO   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "payEndDtFormat"'>    T1.PAY_END_DT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "membershipNo"'>      T1.MEMBERSHIP_NO        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <otherwise>
                             T1.DLR_CD ASC
                            ,T1.RO_DT DESC
                            ,T1.RO_TP ASC
                            </otherwise>
                        </choose>
                    </foreach>
                    </when>
                    <otherwise>
                     T1.DLR_CD ASC
                    ,T1.RO_DT DESC
                    ,T1.RO_TP ASC
                    </otherwise>
                </choose>
            ) T2
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- RO접수현황 목록수를 조회. -->
    <select id="selectRepairOrderListByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderListByConditionCnt] */
         SELECT COUNT(RO_DOC_NO) AS VALUE FROM (
              SELECT T1.*
                FROM(
                      SELECT B.*
                            ,C.CALC_DOC_NO
                            ,(SELECT USR_NM FROM CM_0801T WHERE DLR_CD = C.DLR_CD AND USR_ID = C.REG_USR_ID) AS CALC_PRSN_NM
                            ,(SELECT MAX(RCV_CPLT_DT) FROM SE_0570T WHERE RCV_DOC_NO = D.RCV_DOC_NO) AS PAY_END_DT --지불완료시간
                            ,(SELECT ORD_DLR_CD FROM SA_0121T WHERE VIN_NO = B.VIN_NO AND ROWNUM = 1) AS ORD_DLR_CD --판매딜러
                            ,(SELECT BLUE_MEMBERSHIP_NO FROM CR_0101T WHERE DLR_CD = B.DLR_CD AND CUST_NO = B.CAR_OWNER_ID) AS BLUE_MEMBERSHIP_NO --BM회원번호
                        FROM(
                              SELECT A.DLR_CD
                                    ,A.RO_DOC_NO
                                    ,A.RO_TP
                                    ,A.VIN_NO
                                    ,A.CAR_OWNER_ID
                                    ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                                    ,(SELECT CUST_SALE_DT FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CUST_SALE_DT --차량판매일
                                FROM SE_0300T A
                                <where>
                                    <if test='sDlrCd != null and sDlrCd != ""'>
                                        AND A.DLR_CD = #{sDlrCd}
                                    </if>
                                    <if test='sRoDocNo != null and sRoDocNo != ""'>
                                        AND A.RO_DOC_NO like '%'||#{sRoDocNo}||'%'
                                    </if>
                                    <if test='sVinNo != null and sVinNo != ""'>
                                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                                    </if>
                                    <if test='sDriverId != null and sDriverId != ""'>
                                        AND DRIVER_ID = #{sDriverId}
                                    </if>
                                    <if test='sDriverNm != null and sDriverNm != ""'>
                                        AND DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                                    </if>
                                    <if test='sCarRegNo != null and sCarRegNo != ""'>
                                        AND CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                                    </if>
                                    <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                                        AND CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                                    </if>
                                    <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                                        AND A.CAR_OWNER_ID = #{sCarOwnerId}
                                    </if>
                                    <if test='sBayNo != null and sBayNo != ""'>
                                        AND A.BAY_NO = #{sBayNo}
                                    </if>
                                    <if test='sRoTp != null and sRoTp != ""'>
                                        AND A.RO_TP = #{sRoTp}
                                    </if>
                                    <if test='sRoTpList != null and !sRoTpList.isEmpty'> AND A.RO_TP IN
                                       <foreach item="item" index="index" collection="sRoTpList" open="(" separator="," close=")">
                                           #{item}
                                       </foreach>
                                    </if>
                                    <if test='sRoStatCd != null and sRoStatCd != ""'>
                                        AND A.RO_STAT_CD = #{sRoStatCd}
                                    </if>
                                    <if test='sRoFromDt != null'>
                                        AND TO_CHAR(A.RO_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                                    </if>
                                    <if test='sRoToDt != null'>
                                        AND TO_CHAR(A.RO_DT, 'YYYYMMDD') <![CDATA[<]]> TO_CHAR(#{sRoToDt} + 1, 'YYYYMMDD')
                                    </if>
                                    <if test='sRoStartDt != null'>
                                        AND A.RO_START_DT <![CDATA[>=]]> #{sRoStartDt}
                                    </if>
                                    <if test='sRoEndDt != null'>
                                        AND A.RO_END_DT <![CDATA[<]]> #{sRoEndDt} + 1
                                    </if>
                                    <if test='sExpcDlFromDt != null'>
                                        AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
                                    </if>
                                    <if test='sExpcDlToDt != null'>
                                        AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
                                    </if>
                                    <if test='sDlrRoTp != null and sDlrRoTp != ""'>
                                        AND A.DLR_RO_TP = #{sDlrRoTp}
                                    </if>
                                </where>
                            )B LEFT OUTER JOIN SE_0500T C
                                ON B.RO_DOC_NO    = C.RO_DOC_NO
                               AND B.DLR_CD       = C.DLR_CD
                               AND B.RO_TP        = C.RO_TP
                               AND C.CALC_CANC_YN = 'N'
                               LEFT OUTER JOIN SE_0550T D
                                ON B.RO_DOC_NO    = D.RO_DOC_NO
                               AND B.DLR_CD       = D.DLR_CD
                               AND B.RO_TP        = D.RO_TP
                               AND C.CALC_DOC_NO  = D.CALC_DOC_NO
                  )T1
                  <where>
                      <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                          AND T1.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
                      </if>
                      <if test='sCalcPrsnNm != null and sCalcPrsnNm != ""'>
                          AND T1.CALC_PRSN_NM LIKE '%'||#{sCalcPrsnNm}||'%'
                      </if>
                      <if test='sCalcDocNo != null and sCalcDocNo != ""'>
                          AND T1.CALC_DOC_NO LIKE '%'||#{sCalcDocNo}||'%'
                      </if>
                      <if test='sCustSaleFromDt != null'>
                          AND T1.CUST_SALE_DT <![CDATA[>=]]> #{sCustSaleFromDt}
                      </if>
                      <if test='sCustSaleToDt != null'>
                          AND T1.CUST_SALE_DT <![CDATA[<]]> #{sCustSaleToDt} + 1
                      </if>
                      </where>
              )T2
              <where>
                  <if test='sOrdDlrCd != null and sOrdDlrCd != ""'>
                      AND T2.ORD_DLR_CD LIKE '%'||#{sOrdDlrCd}||'%'
                  </if>
                  <if test='sBlueMembershipNo != null and sBlueMembershipNo != ""'>
                      AND T2.BLUE_MEMBERSHIP_NO LIKE '%'||#{sBlueMembershipNo}||'%'
                  </if>
                  <if test='sPayEndFromDt != null'>
                      AND T2.PAY_END_DT <![CDATA[>=]]> #{sPayEndFromDt}
                  </if>
                  <if test='sPayEndToDt != null'>
                      AND T2.PAY_END_DT <![CDATA[<]]> #{sPayEndToDt} + 1
                  </if>
          </where>
    </select>

    <!-- 공임 이력 조회 목록수 -->
    <select id="selectLbrHistListByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectLbrHistListByConditionCnt] */

              SELECT COUNT(1) AS VALUE
                 FROM (
                    SELECT B.LBR_NM
                           ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                           ,C.REAL_TEC_NM AS TEC_NM
                           ,(SELECT MAX(RCV_CPLT_DT) FROM SE_0570T WHERE RCV_DOC_NO = E.RCV_DOC_NO) AS PAY_END_DT
                      FROM SE_0300T A
                      LEFT OUTER JOIN SE_0170T B ON A.DLR_CD = B.DLR_CD AND A.RO_DOC_NO = B.DOC_NO
                      LEFT OUTER JOIN SE_0330T C ON B.DLR_CD = C.DLR_CD AND B.DOC_NO = C.RO_DOC_NO AND B.LBR_CD = C.RPIR_CD AND TO_CHAR(B.UPDT_DT, 'YYYYMMDD') = TO_CHAR(C.UPDT_DT, 'YYYYMMDD')
                      LEFT OUTER JOIN SE_0500T D ON A.DLR_CD = D.DLR_CD AND A.RO_DOC_NO = D.RO_DOC_NO AND D.CALC_CANC_YN = 'N'
                      LEFT OUTER JOIN SE_0550T E ON A.DLR_CD = E.DLR_CD AND A.RO_DOC_NO = E.RO_DOC_NO AND D.CALC_DOC_NO = E.CALC_DOC_NO
                      WHERE A.DLR_CD = #{sDlrCd}
                      AND B.PREFIX_ID = 'RO'
                      AND A.RO_STAT_CD != '06'
                      <if test=' sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                      </if>
                      <if test=' sRoStatCd != null and sRoStatCd != ""'>
                        AND A.RO_STAT_CD = #{sRoStatCd}
                      </if>
                      <if test='sRoFromDt != null'>
                        AND TO_CHAR(A.RO_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                      </if>
                      <if test='sRoToDt!= null'>
                        AND TO_CHAR(A.RO_DT, 'YYYYMMDD') <![CDATA[<]]> TO_CHAR(#{sRoToDt} + 1, 'YYYYMMDD')
                      </if>
                      <if test=' sRoTp != null and sRoTp != ""'>
                        AND A.RO_TP  = #{sRoTp}
                      </if>
                      <if test=' sLbrTp != null and sLbrTp != ""'>
                        AND B.LBR_TP  = #{sLbrTp}
                      </if>
                      <if test=' sCarRegNo != null and sCarRegNo != ""'>
                        AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                      </if>
                      <if test=' sRoDocNo != null and sRoDocNo != ""'>
                        AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                      </if>
                      <if test=' sLbrCd != null and sLbrCd != ""'>
                        AND B.LBR_CD LIKE '%'||#{sLbrCd}||'%'
                      </if>
                      <if test=' sCarOwnerNm != null and sCarOwnerNm != ""'>
                        AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                      </if>
                      <if test='sCalcFromDt != null'>
                        AND TO_CHAR(D.CALC_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sCalcFromDt}, 'YYYYMMDD')
                      </if>
                      <if test='sCalcToDt != null'>
                        AND TO_CHAR(D.CALC_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sCalcToDt}, 'YYYYMMDD')
                      </if>
                      <if test=' sCrNm != null and sCrNm != ""'>
                        AND B.CR_NM LIKE '%'||#{sCrNm}||'%'
                      </if>
                      <if test=' sCrTp != null and sCrTp != "" '>
                        AND B.CR_TP = #{sCrTp}
                      </if>
                )T1
                <where>
                    <if test=' sLbrNm != null and sLbrNm != "" '>
                        AND T1.LBR_NM LIKE '%'|| #{sLbrNm} ||'%'
                    </if>
                    <if test=' sRegUsrNm != null and sRegUsrNm != "" '>
                        AND T1.REG_USR_NM LIKE '%'|| #{sRegUsrNm} ||'%'
                    </if>
                    <if test=' sTecNm != null and sTecNm != ""'>
                        AND T1.TEC_NM LIKE '%'||#{sTecNm}||'%'
                    </if>
                    <if test='sPayFromDt != null'>
                        AND TO_CHAR(T1.PAY_END_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sPayFromDt}, 'YYYYMMDD')
                    </if>
                    <if test='sPayToDt != null'>
                        AND TO_CHAR(T1.PAY_END_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sPayToDt}, 'YYYYMMDD')
                    </if>
                </where>
    </select>

    <!-- 공임 이력 조회  -->
    <select id="selectLbrHistListByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectLbrHistListByCondition] */

          SELECT * FROM (
              SELECT ROWNUM AS RNUM , T1.*
                 FROM (
                    SELECT A.DLR_CD
                          ,A.VIN_NO
                          ,A.CAR_OWNER_NM
                          ,A.DRIVER_NM
                          ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                          ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                          ,A.CAR_REG_NO
                          ,(SELECT RUN_DIST_VAL
                              FROM SE_0200T
                              WHERE DLR_CD = A.DLR_CD
                                AND VIN_NO = A.VIN_NO
                                AND DIAG_DOC_NO = A.DIAG_DOC_NO
                                AND ROWNUM = 1 ) AS RUN_DIST_VAL
                          ,A.RUN_DIST_VAL  AS LAST_RUN_DIST_VAL
                          ,FN_CMM_CD_NM('SER030', A.RO_STAT_CD, #{sLangCd}, 'N') AS RO_STAT_NM
                          ,D.CALC_DT
                          ,A.RO_DOC_NO
                          ,A.RO_TP
                          ,FN_CMM_CD_NM('SER031', A.RO_TP , #{sLangCd}, 'N') AS RO_TP_NM
                          ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                          ,A.RO_DT
                          ,FN_CMM_CD_NM('SER036', B.LBR_TP , #{sLangCd}, 'N') AS LBR_TP_NM
                          ,B.PKG_ITEM_CD
                          ,B.LBR_CD
                          ,B.LBR_NM
                          ,NVL(B.LBR_HM,0) AS LBR_HM
                          ,NVL(C.ALLOC_HM, NVL(B.DSTB_HM,0)) AS DSTB_HM  --배정공임
                          ,B.LBR_PRC  --공임단가
                          ,B.LBR_PRC * B.LBR_QTY * B.LBR_HM AS LBR_AMT  --공임금액
                          ,B.DC_RATE AS LBR_DC_RATE  --공임할인율
                          ,B.DC_AMT AS LBR_DC_AMT  --공임할인금액
                          ,B.LBR_TOT_AMT  --공임할인후 금액
                          ,C.REAL_TEC_ID AS TEC_ID
                          ,C.REAL_TEC_NM AS TEC_NM
                          ,C.WKGRP_NO
                          ,C.WKGRP_NM
                          ,C.BAY_NO
                          ,(SELECT BAY_NM FROM SE_1012T WHERE DLR_CD = A.DLR_CD AND BAY_NO = C.BAY_NO) AS BAY_NM
                          ,C.SHT_CNT
                          ,C.SHT_CNT AS SER_CNT
                          ,C.PAINT_CNT
                          ,C.LBR_CNT
                          ,C.DIFF_VAL
                          ,B.SUB_BP_CD               --점검코드
                          ,B.SUB_BP_NM               --의견번호
                          ,A.RO_PRINT_DT
                          ,A.UPDT_DT
                          ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) AS UPDT_USR_NM
                          ,FN_CMM_CD_NM('SER043', NVL(C.ALLOC_STAT_CD, '01') , #{sLangCd}, 'N') AS ALLOC_STAT_NM  --정비배정상태
                          ,(SELECT SA_NM FROM SE_0300T WHERE DLR_CD = C.DLR_CD AND RO_DOC_NO = C.RO_DOC_NO) AS SA_NM
                          ,(SELECT MIN(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO) AS ALLOC_START_DT         --배정시작시간
                          ,(SELECT MAX(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO) AS ALLOC_END_DT         --배정완료시간
                          ,C.ALLOC_START_DT AS EXPT_START_DT  --예정시작시간
                          ,C.ALLOC_END_DT AS EXPT_END_DT  --예정완료시간
                          ,C.ALLOC_REMARK --배정비고
                          ,FN_CMM_CD_NM('SER050', NVL(C.WRK_STAT_CD, '01') , #{sLangCd}, 'N') AS WRK_STAT_NM  --정비진도상태
                          ,FN_CMM_CD_NM('SER053', NVL(C.PAINT_STAT_CD, '') , #{sLangCd}, 'N') AS PAINT_STAT_NM  --판금페인트상태
                          ,C.WRK_START_DT  --작업시작시간
                          ,C.WRK_END_DT  --작업종료시간
                          ,C.PAUSE_CAU_CD --정비중단원인
                          ,C.PAUSE_CAU_RMK --정비중단비고
                          ,FN_CMM_CD_NM('SER052', NVL(C.QT_TEST_STAT_CD, 'Q5') , #{sLangCd}, 'N') AS QT_TEST_STAT_NM  --품질검사상태
                          ,C.QT_TEST_START_DT  --품질검사시작시간
                          ,C.QT_TEST_END_DT  --품질검사종료시간
                          ,B.CR_NO  --캠페인번호
                          ,B.CR_TP  --켐페인유형 코드
                          ,FN_CMM_CD_NM('SER930', B.CR_TP, #{sLangCd}, 'N') AS CR_TP_NM --캠페인유형 명칭
                          ,B.CR_NM  --캠페인명칭
                          ,NVL(ROUND(((SELECT MIN(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO) - A.RO_DT)*24,2),0) AS ALLOC_READY_TIME      --배정대기사용시간
                          ,NVL(ROUND(((SELECT MAX(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO) - (SELECT MIN(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO))*24,2),0) AS ALLOC_USE_TIME        --배정사용시간
                          ,NVL(ROUND((C.WRK_START_DT - (SELECT MAX(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO))*24,2),0) AS RPIR_READY_TIME       --정비서비스사용시간
                          ,NVL(ROUND((C.WRK_END_DT - C.WRK_START_DT)*24,2),0) AS RPIR_TIME             --정비조작사용시간
                          ,NVL(ROUND((C.QT_TEST_START_DT - C.WRK_END_DT)*24,2),0) AS QT_TEST_READY_TIME    --품질점검대기사용시간
                          ,NVL(ROUND((C.QT_TEST_END_DT - C.QT_TEST_START_DT)*24,2),0) AS QT_TEST_TIME          --품질점검사용시간
                          ,(CASE WHEN C.WRK_START_DT <![CDATA[<=]]> C.ALLOC_START_DT THEN 'Y' ELSE 'N' END) AS ON_TIME_START_YN  --On time 작업시작
                          ,(CASE WHEN C.WRK_END_DT   <![CDATA[<=]]> C.ALLOC_END_DT   THEN 'Y' ELSE 'N' END) AS ON_TIME_END_YN    --On time 작업완료
                          ,(CASE WHEN C.WRK_START_DT <![CDATA[>]]>  C.ALLOC_START_DT THEN 'Y' ELSE 'N' END) AS DELAY_START_YN    --지연 작업시작
                          ,(CASE WHEN C.WRK_END_DT   <![CDATA[>]]>  C.ALLOC_END_DT   THEN 'Y' ELSE 'N' END) AS DELAY_END_YN      --지연 작업완료
                          ,(SELECT MAX(RCV_CPLT_DT) FROM SE_0560T WHERE RCV_DOC_NO = E.RCV_DOC_NO) AS RCV_CPLT_DT --수납완료일자
                          ,(SELECT MAX(RCV_CPLT_DT) FROM SE_0570T WHERE RCV_DOC_NO = E.RCV_DOC_NO) AS PAY_END_DT --지불완료시간
                      FROM SE_0300T A
                      LEFT OUTER JOIN SE_0170T B ON A.DLR_CD = B.DLR_CD AND A.RO_DOC_NO = B.DOC_NO
                      LEFT OUTER JOIN SE_0330T C ON B.DLR_CD = C.DLR_CD AND B.DOC_NO = C.RO_DOC_NO AND B.LBR_CD = C.RPIR_CD AND TO_CHAR(B.UPDT_DT, 'YYYYMMDD') = TO_CHAR(C.UPDT_DT, 'YYYYMMDD')
                      LEFT OUTER JOIN SE_0500T D ON A.DLR_CD = D.DLR_CD AND A.RO_DOC_NO = D.RO_DOC_NO AND D.CALC_CANC_YN = 'N'
                      LEFT OUTER JOIN SE_0550T E ON A.DLR_CD = E.DLR_CD AND A.RO_DOC_NO = E.RO_DOC_NO AND D.CALC_DOC_NO = E.CALC_DOC_NO
                    WHERE A.DLR_CD = #{sDlrCd}
                      AND B.PREFIX_ID = 'RO'
                      AND A.RO_STAT_CD != '06'
                      <if test='sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                      </if>
                      <if test='sRoStatCd != null and sRoStatCd != ""'>
                        AND A.RO_STAT_CD = #{sRoStatCd}
                      </if>
                      <if test='sRoFromDt != null'>
                        AND TO_CHAR(A.RO_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                      </if>
                      <if test='sRoToDt!= null'>
                        AND TO_CHAR(A.RO_DT, 'YYYYMMDD') <![CDATA[<]]> TO_CHAR(#{sRoToDt} + 1, 'YYYYMMDD')
                      </if>
                      <if test='sRoTp != null and sRoTp != ""'>
                        AND A.RO_TP  = #{sRoTp}
                      </if>
                      <if test='sLbrTp != null and sLbrTp != ""'>
                        AND B.LBR_TP  = #{sLbrTp}
                      </if>
                      <if test='sCarRegNo != null and sCarRegNo != ""'>
                        AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                      </if>
                      <if test='sRoDocNo != null and sRoDocNo != ""'>
                        AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                      </if>
                      <if test='sLbrCd != null and sLbrCd != ""'>
                        AND B.LBR_CD LIKE '%'||#{sLbrCd}||'%'
                      </if>
                      <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                        AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                      </if>
                      <if test='sCalcFromDt != null'>
                        AND TO_CHAR(D.CALC_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sCalcFromDt}, 'YYYYMMDD')
                      </if>
                      <if test='sCalcToDt != null'>
                        AND TO_CHAR(D.CALC_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sCalcToDt}, 'YYYYMMDD')
                      </if>
                      <if test='sCrNm != null and sCrNm != ""'>
                        AND B.CR_NM LIKE '%'||#{sCrNm}||'%'
                      </if>
                      <if test='sCrTp != null and sCrTp != "" '>
                        AND B.CR_TP = #{sCrTp}
                      </if>
                      ORDER BY
                      <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                    <when test='item.field == "carRegNo"'>              CAR_REG_NO                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "vinNo"'>                 VIN_NO                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carOwnerNm"'>            CAR_OWNER_NM                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "driverNm"'>              DRIVER_NM                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carlineNm"'>             CARLINE_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "modelNm"'>               MODEL_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "runDistVal"'>            RUN_DIST_VAL                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lastRunDistVal"'>        LAST_RUN_DIST_VAL             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roStatNm"'>              RO_STAT_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roDocNo"'>               RO_DOC_NO                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roTpNm"'>                RO_TP_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roDtFormat"'>            RO_DT                         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regUsrNm"'>              REG_USR_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roPrintDtFormat"'>       RO_PRINT_DT                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "updtDtFormat"'>          UPDT_DT                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "updtUsrNm"'>             UPDT_USR_NM                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "calcDtFormat"'>          CALC_DT                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "pkgItemCd"'>             PKG_ITEM_CD                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrCd"'>                 LBR_CD                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrNm"'>                 LBR_NM                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrTpNm"'>               LBR_TP_NM                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "subBpNm"'>               SUB_BP_NM                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "subBpCd"'>               SUB_BP_CD                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrHm"'>                 LBR_HM                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrPrc"'>                LBR_PRC                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrAmt"'>                LBR_AMT                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrDcRate"'>             LBR_DC_RATE                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrDcAmt"'>              LBR_DC_AMT                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrTotAmt"'>             LBR_TOT_AMT                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "tecNm"'>                 TEC_NM                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "tecId"'>                 TEC_ID                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "wkgrpNm"'>               WKGRP_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "wkgrpNo"'>               WKGRP_NO                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "bayNm"'>                 BAY_NM                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "bayNo"'>                 BAY_NO                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "serCnt"'>                SER_CNT                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "diffVal"'>               DIFF_VAL                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocStatNm"'>           ALLOC_STAT_NM                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "dstbHm"'>                DSTB_HM                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "saNm"'>                  SA_NM                         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocStartDtFormat"'>    ALLOC_START_DT                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocEndDtFormat"'>      ALLOC_END_DT                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "exptStartDtFormat"'>     EXPT_START_DT                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "exptEndDtFormat"'>       EXPT_END_DT                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocRemark"'>           ALLOC_REMARK                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "wrkStatNm"'>             WRK_STAT_NM                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "paintStatNm"'>           PAINT_STAT_NM                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "wrkStartDtFormat"'>      WRK_START_DT                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "wrkEndDtFormat"'>        WRK_END_DT                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "pauseCauCd"'>            PAUSE_CAU_CD                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "pauseCauRmk"'>           PAUSE_CAU_RMK                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "qtTestStatNm"'>          QT_TEST_STAT_NM               <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "qtTestStartDtFormat"'>   QT_TEST_START_DT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "qtTestEndDtFormat"'>     QT_TEST_END_DT                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "crNo"'>                  CR_NO                         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "crTpNm"'>                CR_TP_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "crNm"'>                  CR_NM                         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocReadyTime"'>        ALLOC_READY_TIME              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocUseTime"'>          ALLOC_USE_TIME                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "rpirSerTime"'>           RPIR_SER_TIME                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "rpirReadyTime"'>         RPIR_READY_TIME               <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "rpirTime"'>              RPIR_TIME                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "qtTestReadyTime"'>       QT_TEST_READY_TIME            <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "qtTestTime"'>            QT_TEST_TIME                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "onTimeStartYn"'>         ON_TIME_START_YN              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "onTimeEndYn"'>           ON_TIME_END_YN                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "delayStartYn"'>          DELAY_START_YN                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "delayEndYn"'>            DELAY_END_YN                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "rcvCpltDtFormat"'>       RCV_CPLT_DT                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "payEndDtFormat"'>        PAY_END_DT                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <otherwise>
                                        RO_DT DESC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            RO_DT DESC
                        </otherwise>
                    </choose>
                )T1
                <where>
                    <if test='sLbrNm != null and sLbrNm != "" '>
                        AND T1.LBR_NM LIKE '%'|| #{sLbrNm} ||'%'
                    </if>
                    <if test='sRegUsrNm != null and sRegUsrNm != "" '>
                        AND T1.REG_USR_NM LIKE '%'|| #{sRegUsrNm} ||'%'
                    </if>
                    <if test='sTecNm != null and sTecNm != ""'>
                        AND T1.TEC_NM LIKE '%'||#{sTecNm}||'%'
                    </if>
                    <if test='sPayFromDt != null'>
                        AND TO_CHAR(T1.PAY_END_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sPayFromDt}, 'YYYYMMDD')
                    </if>
                    <if test='sPayToDt != null'>
                        AND TO_CHAR(T1.PAY_END_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sPayToDt}, 'YYYYMMDD')
                    </if>
                    <if test='firstIndex != -1 and lastIndex != -1'>
                        AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                    </if>
                </where>

        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 딜러별 RO count 이력 갯수 -->
    <select id="selectROCntByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectROCntByConditionCnt] */

        SELECT COUNT(1) AS VALUE
        FROM (
            SELECT *
            FROM (
                SELECT IF_DATE, DLR_CD, DLR_NM, COUNT(IF_DATE) AS RO_CNT
                FROM (
                    SELECT B.DLR_CD, B.DLR_NM, TO_CHAR(TO_DATE(A.CREATEDATE, 'YYYYMMDDHH24MISS'), 'YYYYMMDD') AS IF_DATE
                    FROM SE_0300IR A RIGHT OUTER JOIN CM_0101T B
                        ON (A.DLR_CD = B.DLR_CD
        <choose>
            <when test='sRoDt != null'>
                            AND TO_CHAR(TO_DATE(A.CREATEDATE, 'YYYYMMDDHH24MISS'), 'YYYYMMDD') = TO_CHAR(#{sRoDt}, 'YYYYMMDD')
            </when>
            <otherwise>
                            AND TO_CHAR(TO_DATE(A.CREATEDATE, 'YYYYMMDDHH24MISS'), 'YYYYMMDD') = TO_CHAR(SYSDATE-1, 'YYYYMMDD')
            </otherwise>
        </choose>
                            )
                    WHERE B.DMS_USE_YN = 'Y'
        <if test='sDlrCd != null and sDlrCd != ""'>
                    AND B.DLR_CD = #{sDlrCd}
        </if>
                )
                WHERE 1=1
                GROUP BY DLR_CD, DLR_NM, IF_DATE
            )
        <if test='sSearchGubun != null and sSearchGubun != "" and sSearchGubun == "0"' >
            WHERE RO_CNT = #{sSearchGubun}
        </if>
        <if test='sSearchGubun != null and sSearchGubun != "" and sSearchGubun == "OK"' >
            WHERE RO_CNT > 0
        </if>
        )T1
    </select>

    <!-- 딜러별 RO count 이력  -->
    <select id="selectROCntByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderStatusVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectROCntByCondition] */

        SELECT * FROM (
            SELECT ROWNUM AS RNUM , T1.*
            FROM (
                SELECT *
                FROM (
                    SELECT IF_DATE, DLR_CD, DLR_NM, COUNT(IF_DATE2) AS RO_CNT
                    FROM (
                        SELECT B.DLR_CD, B.DLR_NM,
                               NVL2( A.CREATEDATE,
                                     TO_CHAR(TO_DATE(A.CREATEDATE, 'YYYYMMDDHH24MISS'), 'YYYYMMDD'),
        <choose>
            <when test='sRoDt != null'>
                                     TO_CHAR(#{sRoDt}, 'YYYYMMDD')
            </when>
            <otherwise>
                                     TO_CHAR(SYSDATE-1, 'YYYYMMDD')
            </otherwise>
        </choose>
                                ) AS IF_DATE,
                                TO_CHAR(TO_DATE(A.CREATEDATE, 'YYYYMMDDHH24MISS'), 'YYYYMMDD') AS IF_DATE2
                        FROM SE_0300IR A RIGHT OUTER JOIN CM_0101T B
                            ON (A.DLR_CD = B.DLR_CD
        <choose>
            <when test='sRoDt != null'>
                                AND TO_CHAR(TO_DATE(A.CREATEDATE, 'YYYYMMDDHH24MISS'), 'YYYYMMDD') = TO_CHAR(#{sRoDt}, 'YYYYMMDD')
            </when>
            <otherwise>
                                AND TO_CHAR(TO_DATE(A.CREATEDATE, 'YYYYMMDDHH24MISS'), 'YYYYMMDD') = TO_CHAR(SYSDATE-1, 'YYYYMMDD')
            </otherwise>
        </choose>
                              )
                        WHERE B.DMS_USE_YN = 'Y'
        <if test='sDlrCd != null and sDlrCd != ""'>
                        AND B.DLR_CD = #{sDlrCd}
        </if>
                    )
                    WHERE 1=1
                    GROUP BY DLR_CD, DLR_NM, IF_DATE
                )
        <if test='sSearchGubun != null and sSearchGubun != "" and sSearchGubun == "0"' >
                WHERE RO_CNT = #{sSearchGubun}
        </if>
        <if test='sSearchGubun != null and sSearchGubun != "" and sSearchGubun == "OK"' >
                WHERE RO_CNT > 0
        </if>
                ORDER BY DLR_CD, IF_DATE
            )T1
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                ROWNUM <![CDATA[<=]]>
                #{lastIndex}
            </if>
        </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>


</mapper>