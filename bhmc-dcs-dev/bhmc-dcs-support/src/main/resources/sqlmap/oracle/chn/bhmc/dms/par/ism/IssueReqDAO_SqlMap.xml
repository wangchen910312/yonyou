<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : IssueReqDAO_SqlMap.xml
    Description : 구매요청 관리.
    author In Bo Shim
    since 2016. 1. 11.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 01. 11.     In Bo Shim     최초 생성
-->

<mapper namespace="chn.bhmc.dms.par.ism.service.dao.IssueReqDAO">

    <!-- 구매요청 정보를 추가한다. -->
    <insert id="insertIssueReq" parameterType="IssueReqVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDAO.insertIssueReq] */
        INSERT INTO PT_0501T(
            DLR_CD
            , PAR_REQ_DOC_NO
            , PAR_GI_TP
            , PAR_REQ_STAT_CD
            , CANC_YN
            , RO_DOC_NO
            , RESV_DOC_NO
            , PLT_CD
            , SER_PRSN_ID
            , CUST_CD
            , CUST_NM
            , VIN_NO
            , CAR_NO
            , REG_USR_ID
            , REG_DT
        ) VALUES (
            #{ dlrCd }
            , #{ parReqDocNo }
            , #{ parGiTp }
            , #{ parReqStatCd }
            , #{ cancYn }
            , #{ roDocNo }
            , #{ resvDocNo }
            , #{ pltCd }
            , #{ serPrsnId }
            , #{ custCd }
            , #{ custNm }
            , #{ vinNo }
            , #{ carNo }
            , #{ regUsrId }
            , SYSDATE
        )
    </insert>

    <!-- 구매요청 정보를 수정한다. -->
    <update id="updateIssueReq" parameterType="IssueReqVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDAO.updateIssueReq] */
        UPDATE PT_0501T SET
            UPDT_DT = SYSDATE
            <if test='updtUsrId != null and updtUsrId != ""'>
            ,UPDT_USR_ID = #{ updtUsrId }
            </if>
            <if test='parReqStatCd != null and parReqStatCd != ""'>
            ,PAR_REQ_STAT_CD = #{ parReqStatCd }
            </if>
            <if test='cancYn != null and cancYn != ""'>
            ,CANC_YN = #{ cancYn }
            </if>
            <if test='roDocNo != null and roDocNo != ""'>
            ,RO_DOC_NO = #{ roDocNo }
            </if>
            <if test='resvDocNo != null and resvDocNo != ""'>
            ,RESV_DOC_NO = #{ resvDocNo }
            </if>
            <if test='pltCd != null and pltCd != ""'>
            , PLT_CD = #{ pltCd }
            </if>
            <if test='serPrsnId != null and serPrsnId != ""'>
            , SER_PRSN_ID = #{ serPrsnId }
            </if>
            <if test='custCd != null and custCd != ""'>
            , CUST_CD = #{ custCd }
            </if>
            <if test='custNm != null and custNm != ""'>
            , CUST_NM = #{ custNm }
            </if>
            <if test='vinNo != null and vinNo != ""'>
            , VIN_NO = #{ vinNo }
            </if>
            <if test='carNo != null and carNo != ""'>
            , CAR_NO = #{ carNo }
            </if>
        WHERE DLR_CD = #{dlrCd}
        AND PAR_REQ_DOC_NO = #{parReqDocNo}
    </update>

    <!-- 구매요청 정보를 삭제한다. -->
    <delete id="deleteIssueReq" parameterType="IssueReqVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDAO.deleteIssueReq] */
        DELETE FROM PT_0501T
        WHERE DLR_CD = #{dlrCd}
        AND PAR_REQ_DOC_NO = #{parReqDocNo}
    </delete>

    <!-- 구매요청 정보를 조회한다. -->
    <select id="selectIssueReqByKey" parameterType="map" resultType="IssueReqVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDAO.selectIssueReqByKey] */
        SELECT * FROM PT_0501T
        WHERE DLR_CD = #{dlrCd}
        <if test='parReqDocNo != null and parReqDocNo != ""'>
            AND PAR_REQ_DOC_NO = #{parReqDocNo}
        </if>
        <if test='roDocNo != null and roDocNo != ""'>
            AND RO_DOC_NO = #{roDocNo}
        </if>
        <if test='parGiTp != null and parGiTp != ""'>
            AND PAR_GI_TP = #{parGiTp}
        </if>
    </select>

    <!-- 구매요청 정보 목록을 조회한다. -->
    <select id="selectIssueReqsByCondition" parameterType="IssueReqSearchVO" resultType="IssueReqVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDAO.selectIssueReqsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                    TT.*
                FROM
                (
                    SELECT
                    A.*
                    ,FN_PAR_GET_CARLINE_NM(A.VIN_NO) AS CARLINE_CD
                    ,'' AS REMARK
                    ,B.GI_DOC_NO
                    ,B.GI_DOC_TP
                    ,B.GI_DOC_STAT_CD
                    ,(SELECT MAX(AA.ETC_GI_TP) FROM PT_0502T AA WHERE AA.DLR_CD = A.DLR_CD AND AA.PAR_REQ_DOC_NO = A.PAR_REQ_DOC_NO ) AS ETC_GI_TP
                FROM PT_0501T A
                LEFT JOIN PT_0511T B ON A.DLR_CD = B.DLR_CD AND A.PAR_REQ_DOC_NO = B.PAR_REQ_DOC_NO
                )TT
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sDlrCd,"*")'>
                                <bind name='sDlrCd' value='@org.apache.commons.lang3.StringUtils@replace(sDlrCd, "*", "%")' />
                                 AND TT.DLR_CD LIKE #{sDlrCd}
                            </when>
                            <otherwise>
                                 AND TT.DLR_CD = #{sDlrCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParReqDocNo,"*")'>
                                <bind name='sParReqDocNo' value='@org.apache.commons.lang3.StringUtils@replace(sParReqDocNo, "*", "%")' />
                                 AND TT.PAR_REQ_DOC_NO LIKE #{sParReqDocNo}
                            </when>
                            <otherwise>
                                 AND TT.PAR_REQ_DOC_NO = #{sParReqDocNo}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sParGiTp != null and sParGiTp != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"*")'>
                                <bind name='sParGiTp' value='@org.apache.commons.lang3.StringUtils@replace(sParGiTp, "*", "%")' />
                                 AND TT.PAR_GI_TP LIKE #{sParGiTp}
                            </when>
                            <otherwise>
                                 AND TT.PAR_GI_TP = #{sParGiTp}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParReqStatCd,"*")'>
                                <bind name='sParReqStatCd' value='@org.apache.commons.lang3.StringUtils@replace(sParReqStatCd, "*", "%")' />
                                 AND TT.PAR_REQ_STAT_CD LIKE #{sParReqStatCd}
                            </when>
                            <otherwise>
                                 AND TT.PAR_REQ_STAT_CD = #{sParReqStatCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sSerPrsnId != null and sSerPrsnId != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sSerPrsnId,"*")'>
                                <bind name='sSerPrsnId' value='@org.apache.commons.lang3.StringUtils@replace(sSerPrsnId, "*", "%")' />
                                 AND TT.SER_PRSN_ID LIKE #{sSerPrsnId}
                            </when>
                            <otherwise>
                                 AND TT.SER_PRSN_ID = #{sSerPrsnId}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sCustCd != null and sCustCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sCustCd,"*")'>
                                <bind name='sCustCd' value='@org.apache.commons.lang3.StringUtils@replace(sCustCd, "*", "%")' />
                                 AND TT.CUST_CD LIKE #{sCustCd}
                            </when>
                            <otherwise>
                                 AND TT.CUST_CD = #{sCustCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sCustNm != null and sCustNm != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sCustNm,"*")'>
                                <bind name='sCustNm' value='@org.apache.commons.lang3.StringUtils@replace(sCustNm, "*", "%")' />
                                 AND TT.CUST_NM LIKE #{sCustNm}
                            </when>
                            <otherwise>
                                 AND TT.CUST_NM = #{sCustNm}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sVinNo != null and sVinNo != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sVinNo,"*")'>
                                <bind name='sVinNo' value='@org.apache.commons.lang3.StringUtils@replace(sVinNo, "*", "%")' />
                                 AND TT.VIN_NO LIKE #{sVinNo}
                            </when>
                            <otherwise>
                                 AND TT.VIN_NO = #{sVinNo}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sCarNo != null and sCarNo != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sCarNo,"*")'>
                                <bind name='sCarNo' value='@org.apache.commons.lang3.StringUtils@replace(sCarNo, "*", "%")' />
                                 AND TT.CAR_NO LIKE #{sCarNo}
                            </when>
                            <otherwise>
                                 AND TT.CAR_NO = #{sCarNo}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sGiDocNo != null and sGiDocNo != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sGiDocNo,"*")'>
                                <bind name='sGiDocNo' value='@org.apache.commons.lang3.StringUtils@replace(sGiDocNo, "*", "%")' />
                                 AND TT.GI_DOC_NO LIKE #{sGiDocNo}
                            </when>
                            <otherwise>
                                 AND TT.GI_DOC_NO = #{sGiDocNo}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sGiDocTp != null and sGiDocTp != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sGiDocTp,"*")'>
                                <bind name='sGiDocTp' value='@org.apache.commons.lang3.StringUtils@replace(sGiDocTp, "*", "%")' />
                                 AND TT.GI_DOC_TP LIKE #{sGiDocTp}
                            </when>
                            <otherwise>
                                 AND TT.GI_DOC_TP = #{sGiDocTp}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sGiDocStatCd != null and sGiDocStatCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sGiDocStatCd,"*")'>
                                <bind name='sGiDocStatCd' value='@org.apache.commons.lang3.StringUtils@replace(sGiDocStatCd, "*", "%")' />
                                 AND TT.GI_DOC_STAT_CD LIKE #{sGiDocStatCd}
                            </when>
                            <otherwise>
                                 AND TT.GI_DOC_STAT_CD = #{sGiDocStatCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sRoDocNo != null and sRoDocNo != ""'>
                        AND TT.RO_DOC_NO = #{sRoDocNo}
                    </if>

                    <if test='sEtcGiTp != null and sEtcGiTp != ""'>
                        AND TT.ETC_GI_TP = #{sEtcGiTp}
                    </if>

                    <if test='sReqStartDt != null'>
                        <choose>
                            <otherwise>
                                 AND TT.REG_DT <![CDATA[>=]]> #{sReqStartDt}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReqEndDt != null'>
                        <choose>
                            <otherwise>
                                 AND TT.REG_DT <![CDATA[<=]]> #{sReqEndDt} + 1
                            </otherwise>
                        </choose>
                    </if>

                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "regDt"'>TT.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "parReqDocNo"'>TT.PAR_REQ_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "parGiTp"'>TT.PAR_GI_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "parReqStatCd"'>TT.PAR_REQ_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roDocNo"'>TT.RO_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "resvDocNo"'>TT.RESV_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "serPrsnId"'>TT.SER_PRSN_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "custCd"'>TT.CUST_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "custNm"'>TT.CUST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "vinNo"'>TT.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "carNo"'>TT.CAR_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "carlineCd"'>TT.CARLINE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                    TT.DLR_CD ASC, TT.PAR_REQ_DOC_NO DESC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        TT.DLR_CD ASC, TT.PAR_REQ_DOC_NO DESC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 구매요청 정보 카운트를 조회한다. -->
    <select id="selectIssueReqsByConditionCnt" parameterType="IssueReqSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDAO.selectIssueReqsByConditionCnt] */
        SELECT
            count(0)
        FROM
        (
            SELECT
                A.*
                ,FN_PAR_GET_CARLINE_NM(A.VIN_NO) AS CARLINE_CD
                ,'' AS REMARK
                ,B.GI_DOC_NO
                ,B.GI_DOC_TP
                ,B.GI_DOC_STAT_CD
                ,(SELECT MAX(AA.ETC_GI_TP) FROM PT_0502T AA WHERE AA.DLR_CD = A.DLR_CD AND AA.PAR_REQ_DOC_NO = A.PAR_REQ_DOC_NO ) AS ETC_GI_TP
            FROM PT_0501T A
            LEFT JOIN PT_0511T B ON A.DLR_CD = B.DLR_CD AND A.PAR_REQ_DOC_NO = B.PAR_REQ_DOC_NO
        )TT
        <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sDlrCd,"*")'>
                        <bind name='sDlrCd' value='@org.apache.commons.lang3.StringUtils@replace(sDlrCd, "*", "%")' />
                         AND TT.DLR_CD LIKE #{sDlrCd}
                    </when>
                    <otherwise>
                         AND TT.DLR_CD = #{sDlrCd}
                    </otherwise>
                </choose>
            </if>

            <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sParReqDocNo,"*")'>
                        <bind name='sParReqDocNo' value='@org.apache.commons.lang3.StringUtils@replace(sParReqDocNo, "*", "%")' />
                         AND TT.PAR_REQ_DOC_NO LIKE #{sParReqDocNo}
                    </when>
                    <otherwise>
                         AND TT.PAR_REQ_DOC_NO = #{sParReqDocNo}
                    </otherwise>
                </choose>
            </if>

            <if test='sParGiTp != null and sParGiTp != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"*")'>
                        <bind name='sParGiTp' value='@org.apache.commons.lang3.StringUtils@replace(sParGiTp, "*", "%")' />
                         AND TT.PAR_GI_TP LIKE #{sParGiTp}
                    </when>
                    <otherwise>
                         AND TT.PAR_GI_TP = #{sParGiTp}
                    </otherwise>
                </choose>
            </if>

            <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sParReqStatCd,"*")'>
                        <bind name='sParReqStatCd' value='@org.apache.commons.lang3.StringUtils@replace(sParReqStatCd, "*", "%")' />
                         AND TT.PAR_REQ_STAT_CD LIKE #{sParReqStatCd}
                    </when>
                    <otherwise>
                         AND TT.PAR_REQ_STAT_CD = #{sParReqStatCd}
                    </otherwise>
                </choose>
            </if>

            <if test='sSerPrsnId != null and sSerPrsnId != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sSerPrsnId,"*")'>
                        <bind name='sSerPrsnId' value='@org.apache.commons.lang3.StringUtils@replace(sSerPrsnId, "*", "%")' />
                         AND TT.SER_PRSN_ID LIKE #{sSerPrsnId}
                    </when>
                    <otherwise>
                         AND TT.SER_PRSN_ID = #{sSerPrsnId}
                    </otherwise>
                </choose>
            </if>

            <if test='sCustCd != null and sCustCd != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sCustCd,"*")'>
                        <bind name='sCustCd' value='@org.apache.commons.lang3.StringUtils@replace(sCustCd, "*", "%")' />
                         AND TT.CUST_CD LIKE #{sCustCd}
                    </when>
                    <otherwise>
                         AND TT.CUST_CD = #{sCustCd}
                    </otherwise>
                </choose>
            </if>

            <if test='sCustNm != null and sCustNm != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sCustNm,"*")'>
                        <bind name='sCustNm' value='@org.apache.commons.lang3.StringUtils@replace(sCustNm, "*", "%")' />
                         AND TT.CUST_NM LIKE #{sCustNm}
                    </when>
                    <otherwise>
                         AND TT.CUST_NM = #{sCustNm}
                    </otherwise>
                </choose>
            </if>

            <if test='sVinNo != null and sVinNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sVinNo,"*")'>
                        <bind name='sVinNo' value='@org.apache.commons.lang3.StringUtils@replace(sVinNo, "*", "%")' />
                         AND TT.VIN_NO LIKE #{sVinNo}
                    </when>
                    <otherwise>
                         AND TT.VIN_NO = #{sVinNo}
                    </otherwise>
                </choose>
            </if>

            <if test='sCarNo != null and sCarNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sCarNo,"*")'>
                        <bind name='sCarNo' value='@org.apache.commons.lang3.StringUtils@replace(sCarNo, "*", "%")' />
                         AND TT.CAR_NO LIKE #{sCarNo}
                    </when>
                    <otherwise>
                         AND TT.CAR_NO = #{sCarNo}
                    </otherwise>
                </choose>
            </if>

            <if test='sGiDocNo != null and sGiDocNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sGiDocNo,"*")'>
                        <bind name='sGiDocNo' value='@org.apache.commons.lang3.StringUtils@replace(sGiDocNo, "*", "%")' />
                         AND TT.GI_DOC_NO LIKE #{sGiDocNo}
                    </when>
                    <otherwise>
                         AND TT.GI_DOC_NO = #{sGiDocNo}
                    </otherwise>
                </choose>
            </if>

            <if test='sGiDocTp != null and sGiDocTp != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sGiDocTp,"*")'>
                        <bind name='sGiDocTp' value='@org.apache.commons.lang3.StringUtils@replace(sGiDocTp, "*", "%")' />
                         AND TT.GI_DOC_TP LIKE #{sGiDocTp}
                    </when>
                    <otherwise>
                         AND TT.GI_DOC_TP = #{sGiDocTp}
                    </otherwise>
                </choose>
            </if>

            <if test='sGiDocStatCd != null and sGiDocStatCd != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sGiDocStatCd,"*")'>
                        <bind name='sGiDocStatCd' value='@org.apache.commons.lang3.StringUtils@replace(sGiDocStatCd, "*", "%")' />
                         AND TT.GI_DOC_STAT_CD LIKE #{sGiDocStatCd}
                    </when>
                    <otherwise>
                         AND TT.GI_DOC_STAT_CD = #{sGiDocStatCd}
                    </otherwise>
                </choose>
            </if>

            <if test='sRoDocNo != null and sRoDocNo != ""'>
                AND TT.RO_DOC_NO = #{sRoDocNo}
            </if>

            <if test='sEtcGiTp != null and sEtcGiTp != ""'>
                AND TT.ETC_GI_TP = #{sEtcGiTp}
            </if>

            <if test='sReqStartDt != null'>
                <choose>
                    <otherwise>
                         AND TT.REG_DT <![CDATA[>=]]> #{sReqStartDt}
                    </otherwise>
                </choose>
            </if>

            <if test='sReqEndDt != null'>
                <choose>
                    <otherwise>
                         AND TT.REG_DT <![CDATA[<=]]> #{sReqEndDt} + 1
                    </otherwise>
                </choose>
            </if>

        </where>
    </select>

    <!-- 구매요청현황 정보 목록을 조회한다. -->
    <select id="selectIssueReqStatuesByCondition" parameterType="IssueReqSearchVO" resultType="IssueReqStatusVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDAO.selectIssueReqStatuesByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                    A.DLR_CD
                    ,A.PAR_REQ_DOC_NO
                    ,A.PAR_REQ_DOC_LINE_NO
                    ,A.PAR_REQ_STAT_CD
                    ,G.PURC_REQ_NO
                    ,A.CANC_YN
                    ,A.PAR_GI_TP
                    ,A.RO_DOC_NO
                    ,A.RO_LINE_NO
                    ,A.RESV_DOC_NO
                    ,A.RESV_DOC_LINE_NO
                    ,B.GR_STRGE_CD
                    ,A.GI_STRGE_CD
                    ,A.GI_LOC_CD
                    ,A.ITEM_CD AS DB_ITEM_CD
                    ,A.ITEM_CD
                    ,NVL((SELECT PURC_PRC FROM PT_0213T AA WHERE AA.DLR_CD = A.DLR_CD AND AA.ITEM_CD = A.ITEM_CD AND AA.PRC_TP = '01' AND AA.BP_CD = (SELECT BP_CD FROM PT_0212T BB WHERE BB.DLR_CD = A.DLR_CD AND BB.ITEM_CD = A.ITEM_CD AND BB.APPLY_YN = 'Y')),0) AS ITEM_PRC
                    ,NVL((SELECT PURC_PRC FROM PT_0213T AA WHERE AA.DLR_CD = A.DLR_CD AND AA.ITEM_CD = A.ITEM_CD AND AA.PRC_TP = '01' AND AA.BP_CD = (SELECT BP_CD FROM PT_0212T BB WHERE BB.DLR_CD = A.DLR_CD AND BB.ITEM_CD = A.ITEM_CD AND BB.APPLY_YN = 'Y')) * A.REQ_QTY,0) AS ITEM_AMT
                    ,NVL((SELECT PURC_PRC FROM PT_0213T AA WHERE AA.DLR_CD = A.DLR_CD AND AA.ITEM_CD = A.ITEM_CD AND AA.PRC_TP = '01' AND AA.BP_CD = (SELECT BP_CD FROM PT_0212T BB WHERE BB.DLR_CD = A.DLR_CD AND BB.ITEM_CD = A.ITEM_CD AND BB.APPLY_YN = 'Y')) * A.REQ_QTY + (SELECT PURC_PRC FROM PT_0213T AA WHERE AA.DLR_CD = A.DLR_CD AND AA.ITEM_CD = A.ITEM_CD AND AA.PRC_TP = '01' AND AA.BP_CD = (SELECT BP_CD FROM PT_0212T BB WHERE BB.DLR_CD = A.DLR_CD AND BB.ITEM_CD = A.ITEM_CD AND BB.APPLY_YN = 'Y')) * A.REQ_QTY * FN_GET_VAT(NULL,'ALL') ,0) AS TAX_DDCT_AMT
                    ,NVL((SELECT PURC_PRC FROM PT_0213T AA WHERE AA.DLR_CD = A.DLR_CD AND AA.ITEM_CD = A.ITEM_CD AND AA.PRC_TP = '01' AND AA.BP_CD = (SELECT BP_CD FROM PT_0212T BB WHERE BB.DLR_CD = A.DLR_CD AND BB.ITEM_CD = A.ITEM_CD AND BB.APPLY_YN = 'Y')) * A.REQ_QTY * FN_GET_VAT(NULL,'ALL') ,0) AS TAX_AMT
                    ,A.REQ_QTY
                    ,B.STOCK_UNIT_CD AS UNIT_CD
                    ,A.END_QTY
                    ,A.REQ_STRGE_CD
                    ,A.REG_DT
                    ,A.REG_USR_ID
                    ,A.UPDT_DT
                    ,A.UPDT_USR_ID
                    ,B.ITEM_NM
                    ,#{sPltCd} AS PLT_CD
                    ,NVL(C.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY
                    ,NVL(C.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY
                    ,NVL(C.CLAM_STOCK_QTY,0) AS CLAM_STOCK_QTY
                    ,NVL(C.GR_SCHE_QTY,0) AS GR_SCHE_QTY
                    ,NVL(C.GI_SCHE_QTY,0) AS GI_SCHE_QTY
                    ,CASE WHEN A.END_QTY = 0 THEN A.REQ_QTY
                    ELSE A.END_QTY
                    END AS RESV_QTY
                    ,A.REG_DT AS PURC_REQ_DT
                    ,NVL(E.GI_DOC_NO,'-') AS GI_DOC_NO
                    ,NVL(E.GI_DOC_TP,'01') AS GI_DOC_TP
                    ,NVL(E.GI_DOC_STAT_CD,'01') AS GI_DOC_STAT_CD
                    ,F.MVT_DOC_YY_MM
                    ,F.MVT_DOC_NO
                    ,F.MVT_DOC_LINE_NO
                    ,H.CUST_CD
                    ,H.CUST_NM
                    ,H.SER_PRSN_ID
                    ,H.VIN_NO
                    ,H.CAR_NO
                    ,FN_PAR_GET_CARLINE_NM(H.VIN_NO) AS CARLINE_NM
                    ,B.ABC_IND
                    ,B.CARLINE_CD
                    ,'Y' AS DB_YN
                    ,F.GI_STAT_CD
                    ,F.RECEIVE_ID
                    ,F.GI_DT
                    ,F.RECEIVE_DT
                    ,F.RETURN_ID
                    ,F.RETURN_DT
                    ,F.CANC_ID
                    ,F.CANC_DT
                    ,F.GI_CAU_NM
                    ,A.ETC_GI_TP
                    ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN A.END_QTY
                    ELSE 0
                    END AS RETURN_PARTS_QTY
                FROM PT_0502T A
                LEFT JOIN PT_0201T B ON A.DLR_CD = B.DLR_CD AND A.ITEM_CD = B.ITEM_CD
                LEFT JOIN PT_0301T C ON A.DLR_CD = C.DLR_CD AND A.ITEM_CD = C.ITEM_CD AND B.GR_STRGE_CD = C.STRGE_CD AND C.PLT_CD = #{sPltCd}
                LEFT JOIN PT_0302T D ON A.DLR_CD = D.DLR_CD AND A.ITEM_CD = D.ITEM_CD AND B.GR_STRGE_CD = D.STRGE_CD AND A.RESV_DOC_NO = D.RESV_DOC_NO AND A.RESV_DOC_LINE_NO = D.RESV_DOC_LINE_NO AND D.PLT_CD = #{sPltCd}
                LEFT JOIN PT_0511T E ON A.DLR_CD = E.DLR_CD AND A.PAR_REQ_DOC_NO = E.PAR_REQ_DOC_NO
                LEFT JOIN PT_0512T F ON A.DLR_CD = F.DLR_CD AND A.PAR_REQ_DOC_NO = F.PAR_REQ_DOC_NO AND A.RO_DOC_NO = F.RO_DOC_NO AND A.RO_LINE_NO = F.RO_DOC_LINE_NO
                LEFT JOIN PT_0411T G ON A.DLR_CD = G.DLR_CD AND A.RO_DOC_NO = G.REF_DOC_NO AND A.RO_LINE_NO = G.REF_DOC_LINE_NO AND A.ITEM_CD = G.ITEM_CD
                LEFT JOIN PT_0501T H ON A.DLR_CD = H.DLR_CD AND A.PAR_REQ_DOC_NO = H.PAR_REQ_DOC_NO
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sDlrCd,"*")'>
                                <bind name='sDlrCd' value='@org.apache.commons.lang3.StringUtils@replace(sDlrCd, "*", "%")' />
                                 AND A.DLR_CD LIKE #{sDlrCd}
                            </when>
                            <otherwise>
                                 AND A.DLR_CD = #{sDlrCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParReqDocNo,"*")'>
                                <bind name='sParReqDocNo' value='@org.apache.commons.lang3.StringUtils@replace(sParReqDocNo, "*", "%")' />
                                 AND A.PAR_REQ_DOC_NO LIKE #{sParReqDocNo}
                            </when>
                            <otherwise>
                                 AND A.PAR_REQ_DOC_NO = #{sParReqDocNo}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sRoDocNo != null and sRoDocNo != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sRoDocNo,"*")'>
                                <bind name='sRoDocNo' value='@org.apache.commons.lang3.StringUtils@replace(sRoDocNo, "*", "%")' />
                                 AND A.RO_DOC_NO LIKE #{sRoDocNo}
                            </when>
                            <otherwise>
                                 AND A.RO_DOC_NO = #{sRoDocNo}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sParGiTp != null and sParGiTp != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"*")'>
                                <bind name='sParGiTp' value='@org.apache.commons.lang3.StringUtils@replace(sParGiTp, "*", "%")' />
                                 AND A.PAR_GI_TP LIKE #{sParGiTp}
                            </when>
                            <otherwise>
                                 AND A.PAR_GI_TP = #{sParGiTp}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParReqStatCd,"*")'>
                                <bind name='sParReqStatCd' value='@org.apache.commons.lang3.StringUtils@replace(sParReqStatCd, "*", "%")' />
                                 AND A.PAR_REQ_STAT_CD LIKE #{sParReqStatCd}
                            </when>
                            <otherwise>
                                 AND A.PAR_REQ_STAT_CD = #{sParReqStatCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sSerPrsnId != null and sSerPrsnId != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sSerPrsnId,"*")'>
                                <bind name='sSerPrsnId' value='@org.apache.commons.lang3.StringUtils@replace(sSerPrsnId, "*", "%")' />
                                 AND H.SER_PRSN_ID LIKE #{sSerPrsnId}
                            </when>
                            <otherwise>
                                 AND H.SER_PRSN_ID = #{sSerPrsnId}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sCustCd != null and sCustCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sCustCd,"*")'>
                                <bind name='sCustCd' value='@org.apache.commons.lang3.StringUtils@replace(sCustCd, "*", "%")' />
                                 AND H.CUST_CD LIKE #{sCustCd}
                            </when>
                            <otherwise>
                                 AND H.CUST_CD = #{sCustCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sCustNm != null and sCustNm != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sCustNm,"*")'>
                                <bind name='sCustNm' value='@org.apache.commons.lang3.StringUtils@replace(sCustNm, "*", "%")' />
                                 AND H.CUST_NM LIKE #{sCustNm}
                            </when>
                            <otherwise>
                                 AND H.CUST_NM = #{sCustNm}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sVinNo != null and sVinNo != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sVinNo,"*")'>
                                <bind name='sVinNo' value='@org.apache.commons.lang3.StringUtils@replace(sVinNo, "*", "%")' />
                                 AND H.VIN_NO LIKE #{sVinNo}
                            </when>
                            <otherwise>
                                 AND H.VIN_NO = #{sVinNo}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sCarNo != null and sCarNo != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sCarNo,"*")'>
                                <bind name='sCarNo' value='@org.apache.commons.lang3.StringUtils@replace(sCarNo, "*", "%")' />
                                 AND H.CAR_NO LIKE #{sCarNo}
                            </when>
                            <otherwise>
                                 AND H.CAR_NO = #{sCarNo}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReqStartDt != null'>
                        <choose>
                            <otherwise>
                                 AND A.REG_DT <![CDATA[>=]]> #{sReqStartDt}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReqEndDt != null'>
                        <choose>
                            <otherwise>
                                 AND A.REG_DT <![CDATA[<=]]> #{sReqEndDt} + 1
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sAbcInd != null and sAbcInd != ""'>
                        <choose>
                            <otherwise>
                                 AND B.ABC_IND = #{sAbcInd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sItemCd != null and sItemCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sItemCd,"*")'>
                                <bind name='sItemCd' value='@org.apache.commons.lang3.StringUtils@replace(sItemCd, "*", "%")' />
                                 AND B.ITEM_CD LIKE #{sItemCd}
                            </when>
                            <otherwise>
                                 AND B.ITEM_CD = #{sItemCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sItemNm != null and sItemNm != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sItemNm,"*")'>
                                <bind name='sItemNm' value='@org.apache.commons.lang3.StringUtils@replace(sItemNm, "*", "%")' />
                                 AND B.ITEM_NM LIKE #{sItemNm}
                            </when>
                            <otherwise>
                                 AND B.ITEM_NM = #{sItemNm}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sCarLineCd != null and sCarLineCd != ""'>
                       AND B.CARLINE_CD = #{sCarLineCd}
                    </if>

                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "custCd"'>H.CUST_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "custNm"'>H.CUST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "vinNo"'>H.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "carNo"'>H.CAR_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "parReqDocNo"'>A.PAR_REQ_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "itemCd"'>B.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "itemNm"'>B.ITEM_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "abcInd"'>B.ABC_IND <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "reqQty"'>A.REQ_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "unitCd"'>A.UNIT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "endQty"'>A.END_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "parReqStatCd"'>A.PAR_REQ_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "parTiTp"'>A.PAR_GI_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "serPrsnId"'>H.SER_PRSN_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "regDt"'>A.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                    A.PAR_REQ_DOC_NO DESC, A.PAR_REQ_DOC_LINE_NO ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        A.PAR_REQ_DOC_NO DESC, A.PAR_REQ_DOC_LINE_NO ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 구매요청현황 정보 카운트를 조회한다. -->
    <select id="selectIssueReqStatuesByConditionCnt" parameterType="IssueReqSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDAO.selectIssueReqStatuesByConditionCnt] */
        SELECT
            count(0)
        FROM PT_0502T A
        LEFT JOIN PT_0201T B ON A.DLR_CD = B.DLR_CD AND A.ITEM_CD = B.ITEM_CD
        LEFT JOIN PT_0301T C ON A.DLR_CD = C.DLR_CD AND A.ITEM_CD = C.ITEM_CD AND B.GR_STRGE_CD = C.STRGE_CD AND C.PLT_CD = #{sPltCd}
        LEFT JOIN PT_0302T D ON A.DLR_CD = D.DLR_CD AND A.ITEM_CD = D.ITEM_CD AND B.GR_STRGE_CD = D.STRGE_CD AND A.RESV_DOC_NO = D.RESV_DOC_NO AND A.RESV_DOC_LINE_NO = D.RESV_DOC_LINE_NO AND D.PLT_CD = #{sPltCd}
        LEFT JOIN PT_0511T E ON A.DLR_CD = E.DLR_CD AND A.PAR_REQ_DOC_NO = E.PAR_REQ_DOC_NO
        LEFT JOIN PT_0512T F ON A.DLR_CD = F.DLR_CD AND A.PAR_REQ_DOC_NO = F.PAR_REQ_DOC_NO AND A.RO_DOC_NO = F.RO_DOC_NO AND A.RO_LINE_NO = F.RO_DOC_LINE_NO
        LEFT JOIN PT_0411T G ON A.DLR_CD = G.DLR_CD AND A.RO_DOC_NO = G.REF_DOC_NO AND A.RO_LINE_NO = G.REF_DOC_LINE_NO AND A.ITEM_CD = G.ITEM_CD
        LEFT JOIN PT_0501T H ON A.DLR_CD = H.DLR_CD AND A.PAR_REQ_DOC_NO = H.PAR_REQ_DOC_NO
        <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sDlrCd,"*")'>
                        <bind name='sDlrCd' value='@org.apache.commons.lang3.StringUtils@replace(sDlrCd, "*", "%")' />
                         AND A.DLR_CD LIKE #{sDlrCd}
                    </when>
                    <otherwise>
                         AND A.DLR_CD = #{sDlrCd}
                    </otherwise>
                </choose>
            </if>

            <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sParReqDocNo,"*")'>
                        <bind name='sParReqDocNo' value='@org.apache.commons.lang3.StringUtils@replace(sParReqDocNo, "*", "%")' />
                         AND A.PAR_REQ_DOC_NO LIKE #{sParReqDocNo}
                    </when>
                    <otherwise>
                         AND A.PAR_REQ_DOC_NO = #{sParReqDocNo}
                    </otherwise>
                </choose>
            </if>

            <if test='sRoDocNo != null and sRoDocNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sRoDocNo,"*")'>
                        <bind name='sRoDocNo' value='@org.apache.commons.lang3.StringUtils@replace(sRoDocNo, "*", "%")' />
                         AND A.RO_DOC_NO LIKE #{sRoDocNo}
                    </when>
                    <otherwise>
                         AND A.RO_DOC_NO = #{sRoDocNo}
                    </otherwise>
                </choose>
            </if>

            <if test='sParGiTp != null and sParGiTp != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"*")'>
                        <bind name='sParGiTp' value='@org.apache.commons.lang3.StringUtils@replace(sParGiTp, "*", "%")' />
                         AND A.PAR_GI_TP LIKE #{sParGiTp}
                    </when>
                    <otherwise>
                         AND A.PAR_GI_TP = #{sParGiTp}
                    </otherwise>
                </choose>
            </if>

            <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sParReqStatCd,"*")'>
                        <bind name='sParReqStatCd' value='@org.apache.commons.lang3.StringUtils@replace(sParReqStatCd, "*", "%")' />
                         AND A.PAR_REQ_STAT_CD LIKE #{sParReqStatCd}
                    </when>
                    <otherwise>
                         AND A.PAR_REQ_STAT_CD = #{sParReqStatCd}
                    </otherwise>
                </choose>
            </if>

            <if test='sSerPrsnId != null and sSerPrsnId != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sSerPrsnId,"*")'>
                        <bind name='sSerPrsnId' value='@org.apache.commons.lang3.StringUtils@replace(sSerPrsnId, "*", "%")' />
                         AND H.SER_PRSN_ID LIKE #{sSerPrsnId}
                    </when>
                    <otherwise>
                         AND H.SER_PRSN_ID = #{sSerPrsnId}
                    </otherwise>
                </choose>
            </if>

            <if test='sCustCd != null and sCustCd != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sCustCd,"*")'>
                        <bind name='sCustCd' value='@org.apache.commons.lang3.StringUtils@replace(sCustCd, "*", "%")' />
                         AND H.CUST_CD LIKE #{sCustCd}
                    </when>
                    <otherwise>
                         AND H.CUST_CD = #{sCustCd}
                    </otherwise>
                </choose>
            </if>

            <if test='sCustNm != null and sCustNm != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sCustNm,"*")'>
                        <bind name='sCustNm' value='@org.apache.commons.lang3.StringUtils@replace(sCustNm, "*", "%")' />
                         AND H.CUST_NM LIKE #{sCustNm}
                    </when>
                    <otherwise>
                         AND H.CUST_NM = #{sCustNm}
                    </otherwise>
                </choose>
            </if>

            <if test='sVinNo != null and sVinNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sVinNo,"*")'>
                        <bind name='sVinNo' value='@org.apache.commons.lang3.StringUtils@replace(sVinNo, "*", "%")' />
                         AND H.VIN_NO LIKE #{sVinNo}
                    </when>
                    <otherwise>
                         AND H.VIN_NO = #{sVinNo}
                    </otherwise>
                </choose>
            </if>

            <if test='sCarNo != null and sCarNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sCarNo,"*")'>
                        <bind name='sCarNo' value='@org.apache.commons.lang3.StringUtils@replace(sCarNo, "*", "%")' />
                         AND H.CAR_NO LIKE #{sCarNo}
                    </when>
                    <otherwise>
                         AND H.CAR_NO = #{sCarNo}
                    </otherwise>
                </choose>
            </if>

            <if test='sReqStartDt != null'>
                <choose>
                    <otherwise>
                         AND A.REG_DT <![CDATA[>=]]> #{sReqStartDt}
                    </otherwise>
                </choose>
            </if>

            <if test='sReqEndDt != null'>
                <choose>
                    <otherwise>
                         AND A.REG_DT <![CDATA[<=]]> #{sReqEndDt} + 1
                    </otherwise>
                </choose>
            </if>

            <if test='sAbcInd != null and sAbcInd != ""'>
                <choose>
                    <otherwise>
                         AND B.ABC_IND = #{sAbcInd}
                    </otherwise>
                </choose>
            </if>

            <if test='sItemCd != null and sItemCd != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sItemCd,"*")'>
                        <bind name='sItemCd' value='@org.apache.commons.lang3.StringUtils@replace(sItemCd, "*", "%")' />
                         AND B.ITEM_CD LIKE #{sItemCd}
                    </when>
                    <otherwise>
                         AND B.ITEM_CD = #{sItemCd}
                    </otherwise>
                </choose>
            </if>

            <if test='sItemNm != null and sItemNm != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sItemNm,"*")'>
                        <bind name='sItemNm' value='@org.apache.commons.lang3.StringUtils@replace(sItemNm, "*", "%")' />
                         AND B.ITEM_NM LIKE #{sItemNm}
                    </when>
                    <otherwise>
                         AND B.ITEM_NM = #{sItemNm}
                    </otherwise>
                </choose>
            </if>

            <if test='sCarLineCd != null and sCarLineCd != ""'>
               AND B.CARLINE_CD = #{sCarLineCd}
            </if>
        </where>
    </select>

</mapper>