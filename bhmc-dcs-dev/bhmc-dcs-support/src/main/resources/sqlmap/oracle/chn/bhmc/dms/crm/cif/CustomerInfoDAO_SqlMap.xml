<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : CustomerInfoDAO_SqlMap.xml
    Description : 고객그룹 관한 데이터처리
    author Kyo Jin Lee
    since 2015. 12. 30.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 01. 05.     Kyo Jin Lee     최초 생성
-->

<mapper namespace="chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO">

    <!-- 고객 조회 검색조건 -->
    <sql id="searchCustomerInfoWhere">

        LEFT OUTER JOIN CM_0801T SCT ON T1.MNG_SC_ID = SCT.USR_ID
        LEFT OUTER JOIN CM_0801T TEC ON T1.MNG_TEC_ID = TEC.USR_ID
        LEFT OUTER JOIN CM_0801T USRT ON T1.REG_USR_ID = USRT.USR_ID
        LEFT OUTER JOIN CR_0116T ADDR ON T1.CUST_NO = ADDR.REF_KEY_NM AND T1.DLR_CD = ADDR.DLR_CD AND ADDR.REF_TABLE_NM = 'CR_0101T' AND FLAG_YN = 'Y'
        <if test='sCommand != null and sCommand == "TAGSEARCH"'>
        INNER JOIN CR_0115T TAG ON T1.CUST_NO = TAG.CUST_NO AND TAG.GRP_TP = '002'
            AND TAG.GRP_SEQ IN
            <foreach collection="tagDS" item="tagItem" open="(" close=")" separator=",">
                #{tagItem}
            </foreach>
        </if>

        <where>
           T1.DEL_YN = 'N'
           <if test='sMergeYn != null and sMergeYn != ""'>
                AND T1.MERGE_YN = #{sMergeYn}
           </if>
           <if test='sDlrCd != null and sDlrCd != ""'>
                AND T1.DLR_CD = #{sDlrCd}
           </if>
           <if test='sCustNo != null and sCustNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sCustNo,"*")'>
                        <bind name='sCustNo' value='@org.apache.commons.lang3.StringUtils@replace(sCustNo, "*", "%")' />
                         AND T1.CUST_NO LIKE #{sCustNo}
                    </when>
                    <otherwise>
                         AND T1.CUST_NO = #{sCustNo}
                    </otherwise>
                </choose>
           </if>
           <if test='sMngScId != null and sMngScId != ""'>
                AND T1.MNG_SC_ID = #{sMngScId}
           </if>
           <if test='sCustNm != null and sCustNm != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sCustNm,"*")'>
                        <bind name='sCustNm' value='@org.apache.commons.lang3.StringUtils@replace(sCustNm, "*", "%")' />
                         AND T1.CUST_NM LIKE #{sCustNm}
                    </when>
                    <otherwise>
                         AND T1.CUST_NM = #{sCustNm}
                    </otherwise>
                </choose>
           </if>
           <if test='sCustTp != null and sCustTp != ""'>
                AND T1.CUST_TP = #{sCustTp}
           </if>
           <if test='sCustCd != null and sCustCd != ""'>
                AND T1.CUST_CD = #{sCustCd}
           </if>
           <if test='sHpNo != null and sHpNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sHpNo,"*")'>
                        <bind name='sHpNo' value='@org.apache.commons.lang3.StringUtils@replace(sHpNo, "*", "%")' />
                         AND T1.HP_NO LIKE #{sHpNo}
                    </when>
                    <otherwise>
                         AND T1.HP_NO = #{sHpNo}
                    </otherwise>
                </choose>
           </if>
           <if test='sSexCd != null and sSexCd != ""'>
                AND T1.SEX_CD = #{sSexCd}
           </if>
           <if test='sTelNo != null and sTelNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sTelNo,"*")'>
                        <bind name='sTelNo' value='@org.apache.commons.lang3.StringUtils@replace(sTelNo, "*", "%")' />
                         AND T1.TEL_NO LIKE #{sTelNo}
                    </when>
                    <otherwise>
                         AND T1.TEL_NO = #{sTelNo}
                    </otherwise>
                </choose>
           </if>
           <if test='sOfficeTelNo != null and sOfficeTelNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sOfficeTelNo,"*")'>
                        <bind name='sOfficeTelNo' value='@org.apache.commons.lang3.StringUtils@replace(sOfficeTelNo, "*", "%")' />
                         AND T1.OFFICE_TEL_NO LIKE #{sOfficeTelNo}
                    </when>
                    <otherwise>
                         AND T1.OFFICE_TEL_NO = #{sOfficeTelNo}
                    </otherwise>
                </choose>
           </if>
           <if test='sEmailNm != null and sEmailNm != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sEmailNm,"*")'>
                        <bind name='sEmailNm' value='@org.apache.commons.lang3.StringUtils@replace(sEmailNm, "*", "%")' />
                         AND T1.EMAIL_NM LIKE #{sEmailNm}
                    </when>
                    <otherwise>
                         AND T1.EMAIL_NM = #{sEmailNm}
                    </otherwise>
                </choose>
           </if>
           <if test='sBhmcYn != null and sBhmcYn != ""'>
                AND T1.BHMC_YN = #{sBhmcYn}
           </if>
            <if test='sRegDtFrom != null'>
                <![CDATA[
                    AND T1.REG_DT >= #{sRegDtFrom}   -- 등록일
                ]]>
            </if>
            <if test='sRegDtTo != null'>
                <![CDATA[
                    AND T1.REG_DT < #{sRegDtTo}       -- 등록일
                ]]>
            </if>

            <if test='sAssignYn != null and sAssignYn != ""'>
                <if test='sAssignYn == "Y"'>
                     AND T1.MNG_SC_ID IS NOT NULL           -- SC 배정
                </if >
                <if test='sAssignYn == "N"'>
                     AND T1.MNG_SC_ID IS NULL               -- SC 미배정
                </if>
            </if>

        </where>
    </sql>

    <!-- 고객 수를 조회한다. 판매사원용 -->
    <select id="selectCustomerInfoByConditionCnt" parameterType="CustomerInfoSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectCustomerInfoByConditionCnt] */
        SELECT COUNT(*) AS VALUE
          FROM CR_0101T T1
          <include refid="searchCustomerInfoWhere" />
    </select>

    <!-- 고객를 조회한다. 판매사원용-->
    <select id="selectCustomerInfoByCondition" parameterType="CustomerInfoSearchVO" resultType="CustomerInfoVO">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectCustomerInfoByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                    T1.DLR_CD
                    , T1.CUST_NO
                    , T1.CUST_NM
                    , T1.CUST_CD
                    , T1.SSN_CRN_NO
                    , T1.CUST_TP
                    , T1.MNG_SC_ID
                    , T1.SALE_SC_ID
                    , T1.MNG_TEC_ID
                    , T1.EMAIL_NM
                    , T1.WECHAT_ID
                    , T1.QQ_ID
                    , T1.FACEBOOK_ID
                    , T1.TWITTER_ID
                    , T1.PREF_COMM_MTH_CD
                    , T1.PREF_COMM_NO
                    , T1.PREF_CONTACT_MTH_CD
                    , T1.PREF_CONTACT_TIME_CD
                    , T1.TEL_NO
                    , T1.HP_NO
                    , T1.HP_NO_INVLD_YN
                    , T1.HP_NO_ADD_IMPOS_YN
                    , T1.JOB_CD
                    , T1.DUTY_CD
                    , T1.OFFICE_NM
                    , T1.DEPT_NM
                    , T1.OFFICE_TEL_NO
                    , T1.OFFICE_FAX_NO
                    , T1.OWN_RGST_NM
                    , T1.CMP_TP
                    , T1.CMP_SCALE_CONT
                    , T1.MATH_DOC_TP
                    , T1.OFFICE_NO
                    , T1.DM_PLACE_CD
                    , T1.DM_NM
                    , T1.SMS_RECEIVE_YN
                    , T1.TEL_RECEIVE_YN
                    , T1.DM_RECEIVE_YN
                    , T1.EMAIL_RECEIVE_YN
                    , T1.FAX_RECEIVE_YN
                    , T1.DM_RETURN_YN
                    , T1.EMAIL_RETURN_YN
                    , T1.DISUSE_YN
                    , T1.VIP_YN
                    , T1.CHG_BUY_YN
                    , T1.DISUSE_CD
                    , T1.BUY_CNT
                    , T1.CUST_HOLD_TP
                    , T1.CUST_HOLD_TP_DTL
                    , T1.SEX_CD
                    , T1.BIRTH_DT
                    , T1.MARRY_DT
                    , T1.MARRY_CD
                    , T1.BEF_MNG_SC_ID
                    , T1.PER_INFO_AGREE_YN
                    , T1.PER_INFO_USE_YN
                    , T1.AC_CAREER_CD
                    , T1.INCOME_LVL_CD
                    , T1.AGE_DTL
                    , T1.CHINA_ZODIAC_SIGN_CD
                    , T1.ZODIAC_SIGN_CD
                    , T1.CHILDREN_CNT
                    , T1.BLOOD_TP
                    , T1.AGE_CD
                    , T1.PURC_CAR_BRAND_CD
                    , T1.PURC_CAR_MODEL_NM
                    , T1.MERGE_YN
                    , T1.DEL_YN
                    , T1.BHMC_YN
                    , T1.SIEBEL_ROW_ID
                    , T1.REG_USR_ID
                    , T1.REG_DT
                    , T1.UPDT_USR_ID
                    , T1.UPDT_DT
                    , T1.DOC_ID
                    , T1.BIZCOND_CD
                    , T1.BLUE_MEMBERSHIP_NO
                    , T1.BLUE_MEMBERSHIP_JOIN_DT
                    , T1.BLUE_MEMBERSHIP_JOIN_DLR_CD
                    , T1.BAT_YN
                    , SCT.USR_NM AS MNG_SC_NM                        --MNG_SC_NM
                    , TEC.USR_NM AS MNG_TEC_NM                        --MNG_TEC_NM
                    , USRT.USR_NM AS REG_USR_NM            --등록자이름
                    , (SELECT MAX(B.RESV_DT ) KEEP (DENSE_RANK FIRST ORDER BY B.RESV_DT DESC , B.RESV_DT DESC ) FROM CR_0206T B WHERE B.CUST_NO = T1.CUST_NO AND B.VSIT_STAT_CD != '02' ) AS PRE_VSIT_DT
                    , (SELECT MAX(B.RESV_DT ) KEEP (DENSE_RANK FIRST ORDER BY B.RESV_DT DESC , B.RESV_DT DESC ) FROM CR_0401T B WHERE B.CUST_NO = T1.CUST_NO AND B.TDRV_STAT_CD != '02' ) AS PRE_TDRV_DT
                    , (SELECT MAX(B.SALE_OPPT_STEP_CD ) KEEP (DENSE_RANK FIRST ORDER BY B.SALE_OPPT_NO DESC , B.SALE_OPPT_NO DESC ) FROM CR_0201T B WHERE B.CUST_NO = T1.CUST_NO ) AS SALE_OPPT_STEP_CD
                    , ADDR.ZIP_CD
                    , ADDR.SUNG_CD
                    , ADDR.CITY_CD
                    , ADDR.DIST_CD
                    , ADDR.ADDR_DETL_CONT
                    , ADDR.SUNG_NM
                    , ADDR.CITY_NM
                    , ADDR.DIST_NM
                    , ADDR.SUNG_NM || ' ' || ADDR.CITY_NM || ' ' || ADDR.DIST_NM || ' ' || ADDR.ADDR_DETL_CONT AS ADDR_FULL
                FROM CR_0101T T1
                <include refid="searchCustomerInfoWhere" />
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "custNo"'>T1.CUST_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "custTp"'>T1.CUST_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "custNm"'>T1.CUST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "custCd"'>T1.CUST_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "hpNo"'>T1.HP_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "emailNm"'>T1.EMAIL_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "regDt"'>T1.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "mngScId"'>T1.MNG_SC_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "officeTelNo"'>T1.OFFICE_TEL_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "regDt"'>T1.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "regUsrId"'>T1.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                    T1.REG_DT DESC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        T1.REG_DT DESC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 고객 수를 조회한다. 판매사원용 -->
    <select id="selectCustomerInfoHistoryByConditionCnt" parameterType="CustomerInfoSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectCustomerInfoHistoryByConditionCnt] */
        SELECT COUNT(*) AS VALUE
          FROM CR_0101HT T1
          <include refid="searchCustomerInfoWhere" />
    </select>

    <!-- 고객를 조회한다. 판매사원용-->
    <select id="selectCustomerInfoHistoryByCondition" parameterType="CustomerInfoSearchVO" resultType="CustomerInfoVO">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectCustomerInfoHistoryByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                    T1.DLR_CD
                    , T1.CUST_NO
                    , T1.CUST_NM
                    , T1.CUST_CD
                    , T1.SSN_CRN_NO
                    , T1.CUST_TP
                    , T1.MNG_SC_ID
                    , T1.SALE_SC_ID
                    , T1.MNG_TEC_ID
                    , T1.EMAIL_NM
                    , T1.WECHAT_ID
                    , T1.QQ_ID
                    , T1.FACEBOOK_ID
                    , T1.TWITTER_ID
                    , T1.PREF_COMM_MTH_CD
                    , T1.PREF_COMM_NO
                    , T1.PREF_CONTACT_MTH_CD
                    , T1.PREF_CONTACT_TIME_CD
                    , T1.TEL_NO
                    , T1.HP_NO
                    , T1.HP_NO_INVLD_YN
                    , T1.HP_NO_ADD_IMPOS_YN
                    , T1.JOB_CD
                    , T1.DUTY_CD
                    , T1.OFFICE_NM
                    , T1.DEPT_NM
                    , T1.OFFICE_TEL_NO
                    , T1.OFFICE_FAX_NO
                    , T1.OWN_RGST_NM
                    , T1.CMP_TP
                    , T1.CMP_SCALE_CONT
                    , T1.MATH_DOC_TP
                    , T1.OFFICE_NO
                    , T1.DM_PLACE_CD
                    , T1.DM_NM
                    , T1.SMS_RECEIVE_YN
                    , T1.TEL_RECEIVE_YN
                    , T1.DM_RECEIVE_YN
                    , T1.EMAIL_RECEIVE_YN
                    , T1.FAX_RECEIVE_YN
                    , T1.DM_RETURN_YN
                    , T1.EMAIL_RETURN_YN
                    , T1.DISUSE_YN
                    , T1.VIP_YN
                    , T1.CHG_BUY_YN
                    , T1.DISUSE_CD
                    , T1.BUY_CNT
                    , T1.CUST_HOLD_TP
                    , T1.CUST_HOLD_TP_DTL
                    , T1.SEX_CD
                    , T1.BIRTH_DT
                    , T1.MARRY_DT
                    , T1.MARRY_CD
                    , T1.BEF_MNG_SC_ID
                    , T1.PER_INFO_AGREE_YN
                    , T1.PER_INFO_USE_YN
                    , T1.AC_CAREER_CD
                    , T1.INCOME_LVL_CD
                    , T1.AGE_DTL
                    , T1.CHINA_ZODIAC_SIGN_CD
                    , T1.ZODIAC_SIGN_CD
                    , T1.CHILDREN_CNT
                    , T1.BLOOD_TP
                    , T1.AGE_CD
                    , T1.PURC_CAR_BRAND_CD
                    , T1.PURC_CAR_MODEL_NM
                    , T1.MERGE_YN
                    , T1.DEL_YN
                    , T1.BHMC_YN
                    , T1.SIEBEL_ROW_ID
                    , T1.REG_USR_ID
                    , T1.REG_DT
                    , T1.UPDT_USR_ID
                    , T1.UPDT_DT
                    , T1.DOC_ID
                    , T1.BIZCOND_CD
                    , T1.BLUE_MEMBERSHIP_NO
                    , T1.BLUE_MEMBERSHIP_JOIN_DT
                    , T1.BLUE_MEMBERSHIP_JOIN_DLR_CD
                    , T1.BAT_YN
                    , SCT.USR_NM AS MNG_SC_NM                        --MNG_SC_NM
                    , TEC.USR_NM AS MNG_TEC_NM                        --MNG_TEC_NM
                    , USRT.USR_NM AS REG_USR_NM            --등록자이름
                    , (SELECT MAX(B.RESV_DT ) KEEP (DENSE_RANK FIRST ORDER BY B.RESV_DT DESC , B.RESV_DT DESC ) FROM CR_0206T B WHERE B.CUST_NO = T1.CUST_NO AND B.VSIT_STAT_CD != '02' ) AS PRE_VSIT_DT
                    , (SELECT MAX(B.RESV_DT ) KEEP (DENSE_RANK FIRST ORDER BY B.RESV_DT DESC , B.RESV_DT DESC ) FROM CR_0401T B WHERE B.CUST_NO = T1.CUST_NO AND B.TDRV_STAT_CD != '02' ) AS PRE_TDRV_DT
                    , (SELECT MAX(B.SALE_OPPT_STEP_CD ) KEEP (DENSE_RANK FIRST ORDER BY B.SALE_OPPT_NO DESC , B.SALE_OPPT_NO DESC ) FROM CR_0201T B WHERE B.CUST_NO = T1.CUST_NO ) AS SALE_OPPT_STEP_CD
                    , ADDR.ZIP_CD
                    , ADDR.SUNG_CD
                    , ADDR.CITY_CD
                    , ADDR.DIST_CD
                    , ADDR.ADDR_DETL_CONT
                    , ADDR.SUNG_NM
                    , ADDR.CITY_NM
                    , ADDR.DIST_NM
                    , ADDR.SUNG_NM || ' ' || ADDR.CITY_NM || ' ' || ADDR.DIST_NM || ' ' || ADDR.ADDR_DETL_CONT AS ADDR_FULL
                FROM CR_0101HT T1
                <include refid="searchCustomerInfoWhere" />
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "custNo"'>T1.CUST_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "custTp"'>T1.CUST_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "custNm"'>T1.CUST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "custCd"'>T1.CUST_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "hpNo"'>T1.HP_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "emailNm"'>T1.EMAIL_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "regDt"'>T1.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                    T1.REG_DT DESC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        T1.REG_DT DESC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 마스터 고객 수를 조회한다. 판매사원용 -->
    <select id="selectMasterCustomerInfoByConditionCnt" parameterType="CustomerInfoSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectMasterCustomerInfoByConditionCnt] */
        SELECT COUNT(*) AS VALUE
          FROM CR_0117T
          <include refid="searchCustomerInfoWhere" />
    </select>

    <!-- 마스터고객를 조회한다. 판매사원용-->
    <select id="selectMasterCustomerInfoByCondition" parameterType="CustomerInfoSearchVO" resultType="CustomerInfoVO">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectMasterCustomerInfoByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                    T1.*
                    , (SELECT MAX(B.RESV_DT ) KEEP (DENSE_RANK FIRST ORDER BY B.RESV_DT DESC , B.RESV_DT DESC ) FROM CR_0206T B WHERE B.CUST_NO = T1.CUST_NO AND B.VSIT_STAT_CD != '02' ) AS PRE_VSIT_DT
                    , (SELECT MAX(B.RESV_DT ) KEEP (DENSE_RANK FIRST ORDER BY B.RESV_DT DESC , B.RESV_DT DESC ) FROM CR_0401T B WHERE B.CUST_NO = T1.CUST_NO AND B.TDRV_STAT_CD != '02' ) AS PRE_TDRV_DT
                    , (SELECT MAX(B.SALE_OPPT_STEP_CD ) KEEP (DENSE_RANK FIRST ORDER BY B.SALE_OPPT_SEQ DESC , B.SALE_OPPT_SEQ DESC ) FROM CR_0201T B WHERE B.CUST_NO = T1.CUST_NO ) AS SALE_OPPT_STEP_CD
                FROM CR_0117T T1
                <include refid="searchCustomerInfoWhere" />

            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!--  고객정보를 등록한다. -->
    <insert id="insertCustomer" parameterType="CustomerInfoVO">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.insertCustomer] */
        INSERT INTO CR_0101T
        (
          DLR_CD                -- 딜러코드
         , CUST_NO              -- 고객번호
         , CUST_NM              -- 고객명
         , CUST_CD
         , SSN_CRN_NO
         , CUST_TP
         , MNG_SC_ID
         , SALE_SC_ID
         , MNG_TEC_ID
         , EMAIL_NM
         , WECHAT_ID
         , QQ_ID
         , FACEBOOK_ID
         , TWITTER_ID
         , PREF_COMM_MTH_CD
         , PREF_COMM_NO
         , PREF_CONTACT_MTH_CD
         , PREF_CONTACT_TIME_CD
         , TEL_NO
         , HP_NO
         , JOB_CD
         , OFFICE_NM
         , DEPT_NM
         , OFFICE_TEL_NO
         , OFFICE_FAX_NO
         , BIZCOND_CD
         , OWN_RGST_NM
         , CMP_TP
         , CMP_SCALE_CONT
         , MATH_DOC_TP
         , DM_PLACE_CD
         , DM_NM
         , SMS_RECEIVE_YN
         , TEL_RECEIVE_YN
         , DM_RECEIVE_YN
         , EMAIL_RECEIVE_YN
         , FAX_RECEIVE_YN
         , DM_RETURN_YN
         , EMAIL_RETURN_YN
         , DISUSE_YN
         , VIP_YN
         , DISUSE_CD
         , CUST_HOLD_TP
         , CUST_HOLD_TP_DTL
         , SEX_CD
         , BIRTH_DT
         , MARRY_DT
         , MARRY_CD
         , BEF_MNG_SC_ID
         , PER_INFO_AGREE_YN
         , PER_INFO_USE_YN
         , AC_CAREER_CD
         , INCOME_LVL_CD
         , AGE_CD
         , MERGE_YN
         , DEL_YN
         , BHMC_YN
         , SIEBEL_ROW_ID
         , HP_NO_INVLD_YN
         , HP_NO_ADD_IMPOS_YN
         , BUY_CNT
         , CHG_BUY_YN
         , PURC_CAR_BRAND_CD
         , PURC_CAR_MODEL_NM
         , AGE_DTL
         , CHINA_ZODIAC_SIGN_CD
         , ZODIAC_SIGN_CD
         , BLOOD_TP
         , CHILDREN_CNT
         , DUTY_CD
         , DOC_ID
         , REG_USR_ID
         , REG_DT
         , BAT_YN
        )VALUES(
         #{dlrCd}
         , #{custNo}
         , #{custNm}
         , #{custCd}
         , #{ssnCrnNo}
         , #{custTp}
         , #{mngScId}
         , #{saleScId}
         , #{mngTecId}
         , #{emailNm}
         , #{wechatId}
         , #{qqId}
         , #{facebookId}
         , #{twitterId}
         , #{prefCommMthCd}
         , #{prefCommNo}
         , #{prefContactMthCd}
         , #{prefContactTimeCd}
         , #{telNo}
         , #{hpNo}
         , #{jobCd}
         , #{officeNm}
         , #{deptNm}
         , #{officeTelNo}
         , #{officeFaxNo}
         , #{bizcondCd}
         , #{ownRgstNm}
         , #{cmpTp}
         , #{cmpScaleCont}
         , #{mathDocTp}
         , #{dmPlaceCd}
         , #{dmNm}
         , #{smsReceiveYn}
         , #{telReceiveYn}
         , #{dmReceiveYn}
         , #{emailReceiveYn}
         , #{faxReceiveYn}
         , #{dmReturnYn}
         , #{emailReturnYn}
         , #{disuseYn}
         , #{vipYn}
         , #{disuseCd}
         , #{custHoldTp}
         , #{custHoldTpDtl}
         , #{sexCd}
         , #{birthDt}
         , #{marryDt}
         , #{marryCd}
         , #{befMngScId}
         , #{perInfoAgreeYn}
         , #{perInfoUseYn}
         , #{acCareerCd}
         , #{incomeLvlCd}
         , #{ageCd}
         , #{mergeYn}
         , #{delYn}
         , #{bhmcYn}
         , #{siebelRowId}
         , #{hpNoInvldYn}
         , #{hpNoAddImposYn}
         , #{buyCnt}
         , #{chgBuyYn}
         , #{purcCarBrandCd}
         , #{purcCarModelNm}
         , #{ageDtl}
         , #{chinaZodiacSignCd}
         , #{zodiacSignCd}
         , #{bloodTp}
         , #{childrenCnt}
         , #{dutyCd}
         , #{docId}
         , #{regUsrId}
         , SYSDATE
         , 'Y'
        )
    </insert>

    <!--  마스터 고객정보를 등록한다. -->
    <insert id="insertMasterCustomer" parameterType="CustomerInfoVO">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.insertMasterCustomer] */
        INSERT INTO CR_0117T
        (
          DLR_CD                -- 딜러코드
         , CUST_NO              -- 고객번호
         , CUST_NM              -- 고객명
         , CUST_CD
         , SSN_CRN_NO
         , CUST_TP
         , MNG_SC_ID
         , SALE_SC_ID
         , MNG_TEC_ID
         , EMAIL_NM
         , WECHAT_ID
         , QQ_ID
         , FACEBOOK_ID
         , TWITTER_ID
         , PREF_COMM_MTH_CD
         , PREF_COMM_NO
         , PREF_CONTACT_MTH_CD
         , PREF_CONTACT_TIME_CD
         , TEL_NO
         , HP_NO
         , JOB_CD
         , OFFICE_NM
         , DEPT_NM
         , OFFICE_TEL_NO
         , OFFICE_FAX_NO
         , BIZCOND_CD
         , OWN_RGST_NM
         , CMP_TP
         , CMP_SCALE_CONT
         , MATH_DOC_TP
         , DM_PLACE_CD
         , DM_NM
         , SMS_RECEIVE_YN
         , TEL_RECEIVE_YN
         , DM_RECEIVE_YN
         , EMAIL_RECEIVE_YN
         , FAX_RECEIVE_YN
         , DM_RETURN_YN
         , EMAIL_RETURN_YN
         , DISUSE_YN
         , VIP_YN
         , DISUSE_CD
         , CUST_HOLD_TP
         , CUST_HOLD_TP_DTL
         , SEX_CD
         , BIRTH_DT
         , MARRY_DT
         , MARRY_CD
         , BEF_MNG_SC_ID
         , PER_INFO_AGREE_YN
         , PER_INFO_USE_YN
         , AC_CAREER_CD
         , INCOME_LVL_CD
         , AGE_CD
         , MERGE_YN
         , DEL_YN
         , BHMC_YN
         , SIEBEL_ROW_ID
         , REG_USR_ID
         , REG_DT
        )VALUES(
         #{dlrCd}
         , #{custNo}
         , #{custNm}
         , #{custCd}
         , #{ssnCrnNo}
         , #{custTp}
         , #{mngScId}
         , #{saleScId}
         , #{mngTecId}
         , #{emailNm}
         , #{wechatId}
         , #{qqId}
         , #{facebookId}
         , #{twitterId}
         , #{prefCommMthCd}
         , #{prefCommNo}
         , #{prefContactMthCd}
         , #{prefContactTimeCd}
         , #{telNo}
         , #{hpNo}
         , #{jobCd}
         , #{officeNm}
         , #{deptNm}
         , #{officeTelNo}
         , #{officeFaxNo}
         , #{bizcondCd}
         , #{ownRgstNm}
         , #{cmpTp}
         , #{cmpScaleCont}
         , #{mathDocTp}
         , #{dmPlaceCd}
         , #{dmNm}
         , #{smsReceiveYn}
         , #{telReceiveYn}
         , #{dmReceiveYn}
         , #{emailReceiveYn}
         , #{faxReceiveYn}
         , #{dmReturnYn}
         , #{emailReturnYn}
         , #{disuseYn}
         , #{vipYn}
         , #{disuseCd}
         , #{custHoldTp}
         , #{custHoldTpDtl}
         , #{sexCd}
         , #{birthDt}
         , #{marryDt}
         , #{marryCd}
         , #{befMngScId}
         , #{perInfoAgreeYn}
         , #{perInfoUseYn}
         , #{acCareerCd}
         , #{incomeLvlCd}
         , #{ageCd}
         , #{mergeYn}
         , #{delYn}
         , #{bhmcYn}
         , #{siebelRowId}
         , #{regUsrId}
         , SYSDATE
        )
    </insert>

    <!-- 고객정보를 업데이트 한다. -->
    <update id="updateCustomer" parameterType="CustomerInfoVO">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.updateCustomer] */
        UPDATE CR_0101T    --고객마스터
          SET
                    CUST_NO                  = #{custNo}                       --고객번호
                    <if test='custNm != null '>
                         , CUST_NM                = #{custNm}                       --고객명
                    </if>
                    <if test='custCd != null'>
                         , CUST_CD                = #{custCd}                       --고객코드
                    </if>
                    <if test='ssnCrnNo != null'>
                         , SSN_CRN_NO             = #{ssnCrnNo}                     --주민사업자등록번호
                    </if>
                    <if test='custTp != null'>
                         , CUST_TP                = #{custTp}                       --고객유형
                    </if>
                    <if test='mngScId != null'>
                         , MNG_SC_ID              = #{mngScId}                      --관리SCID
                    </if>
                    <if test='saleScId != null'>
                         , SALE_SC_ID             = #{saleScId}                     --판매SCID
                    </if>
                    <if test='mngTecId != null'>
                         , MNG_TEC_ID             = #{mngTecId}                     --관리TechManID
                    </if>
                    <if test='emailNm != null'>
                         , EMAIL_NM               = #{emailNm}                      --이메일명
                    </if>
                    <if test='wechatId != null'>
                         , WECHAT_ID              = #{wechatId}                     --위쳇ID
                    </if>
                    <if test='qqId != null'>
                         , QQ_ID                  = #{qqId}                         --QQ ID
                    </if>
                    <if test='facebookId != null'>
                         , FACEBOOK_ID            = #{facebookId}                   --페이스북ID
                    </if>
                    <if test='twitterId != null'>
                         , TWITTER_ID             = #{twitterId}                    --트위터ID
                    </if>
                    <if test='prefCommMthCd != null'>
                         , PREF_COMM_MTH_CD       = #{prefCommMthCd}                --선호연락방법코드
                    </if>
                    <if test='prefCommNo != null'>
                         , PREF_COMM_NO           = #{prefCommNo}                   --선호연락번호
                    </if>
                    <if test='prefContactMthCd != null'>
                         , PREF_CONTACT_MTH_CD    = #{prefContactMthCd}             --우선연락방법
                    </if>
                    <if test='prefContactTimeCd != null'>
                         , PREF_CONTACT_TIME_CD   = #{prefContactTimeCd}            --우선연락시간
                    </if>
                    <if test='telNo != null'>
                         , TEL_NO                 = #{telNo}                        --전화번호
                    </if>
                    <if test='hpNo != null'>
                         , HP_NO                  = #{hpNo}                         --휴대폰번호
                    </if>
                    <if test='jobCd != null'>
                         , JOB_CD                 = #{jobCd}                        --직업코드
                    </if>
                    <if test='officeNm != null'>
                         , OFFICE_NM              = #{officeNm}                     --직장명
                    </if>
                    <if test='deptNm != null'>
                         , DEPT_NM                = #{deptNm}                       --부서명
                    </if>
                    <if test='officeTelNo != null'>
                         , OFFICE_TEL_NO          = #{officeTelNo}                  --직장전화번호
                    </if>
                    <if test='officeFaxNo != null'>
                         , OFFICE_FAX_NO          = #{officeFaxNo}                  --직장팩스번호
                    </if>
                    <if test='bizcondCd != null'>
                         , BIZCOND_CD             = #{bizcondCd}                    --업종코드
                    </if>
                    <if test='ownRgstNm != null'>
                         , OWN_RGST_NM            = #{ownRgstNm}                    --대표자명
                    </if>
                    <if test='cmpTp != null'>
                         , CMP_TP                 = #{cmpTp}                        --회사유형
                    </if>
                    <if test='cmpScaleCont != null'>
                         , CMP_SCALE_CONT         = #{cmpScaleCont}                 --회사규모내용
                    </if>
                    <if test='mathDocTp != null'>
                         , MATH_DOC_TP            = #{mathDocTp}                    --주요인증문서유형
                    </if>
                    <if test='dmPlaceCd != null'>
                         , DM_PLACE_CD            = #{dmPlaceCd}                    --DM장소코드
                    </if>
                    <if test='dmNm != null'>
                         , DM_NM                  = #{dmNm}                         --DM명
                    </if>
                    <if test='smsReceiveYn != null'>
                         , SMS_RECEIVE_YN         = #{smsReceiveYn}                 --SMS수신여부
                    </if>
                    <if test='telReceiveYn != null'>
                         , TEL_RECEIVE_YN         = #{telReceiveYn}                 --전화수신여부
                    </if>
                    <if test='dmReceiveYn != null'>
                         , DM_RECEIVE_YN          = #{dmReceiveYn}                  --DM수신여부
                    </if>
                    <if test='emailReceiveYn != null'>
                         , EMAIL_RECEIVE_YN       = #{emailReceiveYn}               --이메일수신여부
                    </if>
                    <if test='faxReceiveYn != null'>
                         , FAX_RECEIVE_YN         = #{faxReceiveYn}                 --FAX수신여부
                    </if>
                    <if test='dmReturnYn != null'>
                         , DM_RETURN_YN           = #{dmReturnYn}                   --DM반송여부
                    </if>
                    <if test='emailReturnYn != null'>
                         , EMAIL_RETURN_YN        = #{emailReturnYn}                --이메일반송여부
                    </if>
                    <if test='disuseYn != null'>
                         , DISUSE_YN              = #{disuseYn}                     --폐기여부
                    </if>
                    <if test='vipYn != null'>
                         , VIP_YN                 = #{vipYn}                        --VIP 여부
                    </if>
                    <if test='disuseCd != null'>
                         , DISUSE_CD              = #{disuseCd}                     --폐기코드
                    </if>
                    <if test='custHoldTp != null'>
                         , CUST_HOLD_TP           = #{custHoldTp}                   --고객확보유형
                    </if>
                    <if test='custHoldTpDtl != null'>
                         , CUST_HOLD_TP_DTL           = #{custHoldTpDtl}                   --고객확보유형
                    </if>
                    <if test='sexCd != null'>
                         , SEX_CD                 = #{sexCd}                        --성별코드
                    </if>
                    <if test='birthDt != null'>
                         , BIRTH_DT               = #{birthDt}                      --BIRTH_DT
                    </if>
                    <if test='marryDt != null'>
                         , MARRY_DT               = #{marryDt}                      --결혼일자
                    </if>
                    <if test='marryCd != null'>
                         , MARRY_CD               = #{marryCd}                      --결혼코드
                    </if>
                    <if test='befMngScId != null'>
                         , BEF_MNG_SC_ID          = #{befMngScId}                   --이전관리SCID
                    </if>
                    <if test='perInfoAgreeYn != null'>
                         , PER_INFO_AGREE_YN      = #{perInfoAgreeYn}               --개인정보동의여부
                    </if>
                    <if test='perInfoUseYn != null'>
                         , PER_INFO_USE_YN        = #{perInfoUseYn}                 --개인정보사용여부
                    </if>
                    <if test='acCareerCd != null'>
                         , AC_CAREER_CD           = #{acCareerCd}                   --학력코드
                    </if>
                    <if test='incomeLvlCd != null'>
                         , INCOME_LVL_CD          = #{incomeLvlCd}                  --소득레벨코드
                    </if>
                    <if test='ageCd != null'>
                         , AGE_CD                 = #{ageCd}                        --나이코드
                    </if>
                    <if test='mergeYn != null'>
                         , MERGE_YN               = #{mergeYn}                      --병합여부
                    </if>
                    <if test='delYn != null'>
                         , DEL_YN                 = #{delYn}                        --삭제여부
                    </if>
                    <if test='bhmcYn != null'>
                         , BHMC_YN                = #{bhmcYn}                       --BHMC여부
                    </if>
                    <if test='siebelRowId != null'>
                         , SIEBEL_ROW_ID          = #{siebelRowId}                  --SIEBEL ROW ID
                    </if>
                    <if test='hpNoInvldYn != null'>
                        , HP_NO_INVLD_YN = #{hpNoInvldYn}
                    </if>
                    <if test='hpNoAddImposYn != null'>
                        , HP_NO_ADD_IMPOS_YN = #{hpNoAddImposYn}
                    </if>
                    <if test='buyCnt != null'>
                        , BUY_CNT = #{buyCnt}
                    </if>
                    <if test='chgBuyYn != null'>
                        , CHG_BUY_YN = #{chgBuyYn}
                    </if>
                    <if test='purcCarBrandCd != null'>
                        , PURC_CAR_BRAND_CD = #{purcCarBrandCd}
                    </if>
                    <if test='purcCarModelNm != null'>
                        , PURC_CAR_MODEL_NM = #{purcCarModelNm}
                    </if>
                    <if test='ageDtl != null'>
                        , AGE_DTL = #{ageDtl}
                    </if>
                    <if test='chinaZodiacSignCd != null'>
                        , CHINA_ZODIAC_SIGN_CD = #{chinaZodiacSignCd}
                    </if>
                    <if test='zodiacSignCd != null'>
                        , ZODIAC_SIGN_CD = #{zodiacSignCd}
                    </if>
                    <if test='bloodTp != null'>
                        , BLOOD_TP = #{bloodTp}
                    </if>
                    <if test='childrenCnt != null'>
                        , CHILDREN_CNT = #{childrenCnt}
                    </if>
                    <if test='dutyCd != null'>
                        , DUTY_CD = #{dutyCd}
                    </if>
                    <if test='docId != null'>
                        , DOC_ID = #{docId}
                    </if>
                    <if test='blueMembershipJoinDlrCd != null'>
                    , BLUE_MEMBERSHIP_JOIN_DLR_CD = #{blueMembershipJoinDlrCd}
                    </if>
                    <if test='blueMembershipJoinDt != null'>
                    , BLUE_MEMBERSHIP_JOIN_DT = #{blueMembershipJoinDt}
                    </if>
                    <if test='blueMembershipNo != null'>
                    , BLUE_MEMBERSHIP_NO = #{blueMembershipNo}
                    </if>
                   , UPDT_USR_ID            = #{updtUsrId}                    --수정자ID
                   , UPDT_DT                = SYSDATE
                   , BAT_YN = 'Y'
         WHERE 1 = 1
           AND DLR_CD                 = #{dlrCd}                        --딜러코드
           AND CUST_NO                = #{custNo}                       --고객번호
    </update>

    <!-- 고객 마스터 정보를 업데이트 한다. -->
    <update id="updateMasterCustomer" parameterType="CustomerInfoVO">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.updateMasterCustomer] */
        UPDATE CR_0117T    --고객마스터
          SET
                    CUST_NO                  = #{custNo}                       --고객번호
                    <if test='custNm != null '>
                         , CUST_NM                = #{custNm}                       --고객명
                    </if>
                    <if test='custCd != null'>
                         , CUST_CD                = #{custCd}                       --고객코드
                    </if>
                    <if test='ssnCrnNo != null'>
                         , SSN_CRN_NO             = #{ssnCrnNo}                     --주민사업자등록번호
                    </if>
                    <if test='custTp != null'>
                         , CUST_TP                = #{custTp}                       --고객유형
                    </if>
                    <if test='mngScId != null'>
                         , MNG_SC_ID              = #{mngScId}                      --관리SCID
                    </if>
                    <if test='saleScId != null'>
                         , SALE_SC_ID             = #{saleScId}                     --판매SCID
                    </if>
                    <if test='mngTecId != null'>
                         , MNG_TEC_ID             = #{mngTecId}                     --관리TechManID
                    </if>
                    <if test='emailNm != null'>
                         , EMAIL_NM               = #{emailNm}                      --이메일명
                    </if>
                    <if test='wechatId != null'>
                         , WECHAT_ID              = #{wechatId}                     --위쳇ID
                    </if>
                    <if test='qqId != null'>
                         , QQ_ID                  = #{qqId}                         --QQ ID
                    </if>
                    <if test='facebookId != null'>
                         , FACEBOOK_ID            = #{facebookId}                   --페이스북ID
                    </if>
                    <if test='twitterId != null'>
                         , TWITTER_ID             = #{twitterId}                    --트위터ID
                    </if>
                    <if test='prefCommMthCd != null'>
                         , PREF_COMM_MTH_CD       = #{prefCommMthCd}                --선호연락방법코드
                    </if>
                    <if test='prefCommNo != null'>
                         , PREF_COMM_NO           = #{prefCommNo}                   --선호연락번호
                    </if>
                    <if test='prefContactMthCd != null'>
                         , PREF_CONTACT_MTH_CD    = #{prefContactMthCd}             --우선연락방법
                    </if>
                    <if test='prefContactTimeCd != null'>
                         , PREF_CONTACT_TIME_CD   = #{prefContactTimeCd}            --우선연락시간
                    </if>
                    <if test='telNo != null'>
                         , TEL_NO                 = #{telNo}                        --전화번호
                    </if>
                    <if test='hpNo != null'>
                         , HP_NO                  = #{hpNo}                         --휴대폰번호
                    </if>
                    <if test='jobCd != null'>
                         , JOB_CD                 = #{jobCd}                        --직업코드
                    </if>
                    <if test='officeNm != null'>
                         , OFFICE_NM              = #{officeNm}                     --직장명
                    </if>
                    <if test='deptNm != null'>
                         , DEPT_NM                = #{deptNm}                       --부서명
                    </if>
                    <if test='officeTelNo != null'>
                         , OFFICE_TEL_NO          = #{officeTelNo}                  --직장전화번호
                    </if>
                    <if test='officeFaxNo != null'>
                         , OFFICE_FAX_NO          = #{officeFaxNo}                  --직장팩스번호
                    </if>
                    <if test='bizcondCd != null'>
                         , BIZCOND_CD             = #{bizcondCd}                    --업종코드
                    </if>
                    <if test='ownRgstNm != null'>
                         , OWN_RGST_NM            = #{ownRgstNm}                    --대표자명
                    </if>
                    <if test='cmpTp != null'>
                         , CMP_TP                 = #{cmpTp}                        --회사유형
                    </if>
                    <if test='cmpScaleCont != null'>
                         , CMP_SCALE_CONT         = #{cmpScaleCont}                 --회사규모내용
                    </if>
                    <if test='mathDocTp != null'>
                         , MATH_DOC_TP            = #{mathDocTp}                    --주요인증문서유형
                    </if>
                    <if test='dmPlaceCd != null'>
                         , DM_PLACE_CD            = #{dmPlaceCd}                    --DM장소코드
                    </if>
                    <if test='dmNm != null'>
                         , DM_NM                  = #{dmNm}                         --DM명
                    </if>
                    <if test='smsReceiveYn != null'>
                         , SMS_RECEIVE_YN         = #{smsReceiveYn}                 --SMS수신여부
                    </if>
                    <if test='telReceiveYn != null'>
                         , TEL_RECEIVE_YN         = #{telReceiveYn}                 --전화수신여부
                    </if>
                    <if test='dmReceiveYn != null'>
                         , DM_RECEIVE_YN          = #{dmReceiveYn}                  --DM수신여부
                    </if>
                    <if test='emailReceiveYn != null'>
                         , EMAIL_RECEIVE_YN       = #{emailReceiveYn}               --이메일수신여부
                    </if>
                    <if test='faxReceiveYn != null'>
                         , FAX_RECEIVE_YN         = #{faxReceiveYn}                 --FAX수신여부
                    </if>
                    <if test='dmReturnYn != null'>
                         , DM_RETURN_YN           = #{dmReturnYn}                   --DM반송여부
                    </if>
                    <if test='emailReturnYn != null'>
                         , EMAIL_RETURN_YN        = #{emailReturnYn}                --이메일반송여부
                    </if>
                    <if test='disuseYn != null'>
                         , DISUSE_YN              = #{disuseYn}                     --폐기여부
                    </if>
                    <if test='vipYn != null'>
                         , VIP_YN                 = #{vipYn}                        --VIP 여부
                    </if>
                    <if test='disuseCd != null'>
                         , DISUSE_CD              = #{disuseCd}                     --폐기코드
                    </if>
                    <if test='custHoldTp != null'>
                         , CUST_HOLD_TP           = #{custHoldTp}                   --고객확보유형
                    </if>
                    <if test='custHoldTpDtl != null'>
                         , CUST_HOLD_TP_DTL           = #{custHoldTpDtl}                   --고객확보유형
                    </if>
                    <if test='sexCd != null'>
                         , SEX_CD                 = #{sexCd}                        --성별코드
                    </if>
                    <if test='birthDt != null'>
                         , BIRTH_DT               = #{birthDt}                      --BIRTH_DT
                    </if>
                    <if test='marryDt != null'>
                         , MARRY_DT               = #{marryDt}                      --결혼일자
                    </if>
                    <if test='marryCd != null'>
                         , MARRY_CD               = #{marryCd}                      --결혼코드
                    </if>
                    <if test='befMngScId != null'>
                         , BEF_MNG_SC_ID          = #{befMngScId}                   --이전관리SCID
                    </if>
                    <if test='perInfoAgreeYn != null'>
                         , PER_INFO_AGREE_YN      = #{perInfoAgreeYn}               --개인정보동의여부
                    </if>
                    <if test='perInfoUseYn != null'>
                         , PER_INFO_USE_YN        = #{perInfoUseYn}                 --개인정보사용여부
                    </if>
                    <if test='acCareerCd != null'>
                         , AC_CAREER_CD           = #{acCareerCd}                   --학력코드
                    </if>
                    <if test='incomeLvlCd != null'>
                         , INCOME_LVL_CD          = #{incomeLvlCd}                  --소득레벨코드
                    </if>
                    <if test='ageCd != null'>
                         , AGE_CD                 = #{ageCd}                        --나이코드
                    </if>
                    <if test='mergeYn != null'>
                         , MERGE_YN               = #{mergeYn}                      --병합여부
                    </if>
                    <if test='delYn != null'>
                         , DEL_YN                 = #{delYn}                        --삭제여부
                    </if>
                    <if test='bhmcYn != null'>
                         , BHMC_YN                = #{bhmcYn}                       --BHMC여부
                    </if>
                    <if test='siebelRowId != null'>
                         , SIEBEL_ROW_ID          = #{siebelRowId}                  --SIEBEL ROW ID
                    </if>
                   , UPDT_USR_ID            = #{updtUsrId}                    --수정자ID
                   , UPDT_DT                = SYSDATE
         WHERE 1 = 1
           AND DLR_CD                 = #{dlrCd}                        --딜러코드
           AND CUST_NO                = #{custNo}                       --고객번호
    </update>

    <!-- 고객번호를 채번한다. -->
    <select id="selectNextCustNo" resultType="string">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectNextCustNo] */
        SELECT FU_GET_CUST_NO() AS CUST_NO
        FROM   DUAL
    </select>

    <!-- 고객 정보를 조회 한다. (중복 확인) 고객명 + 연락처번호 -->
    <select id="selectCustDupByKey" parameterType="CustomerInfoSearchVO" resultType="CustomerInfoVO">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectCustDupByKey] */
        SELECT *
        FROM    CR_0101T T1
        WHERE   T1.DLR_CD   = #{sDlrCd}
        AND     T1.CUST_TP  = #{sCustTp}
        <choose>
            <when test='sCustTp == "01"'>
                AND     T1.HP_NO    = #{sHpNo}
            </when>
            <otherwise>
                AND     T1.OFFICE_TEL_NO    = #{sOfficeTelNo}
            </otherwise>
        </choose>
        AND     T1.DEL_YN = 'N'
    </select>

    <!-- 고객 정보를 조회 한다. (중복 확인) 고객명 + 연락처번호 -->
    <select id="selectCustDupByKey2" parameterType="CustomerInfoSearchVO" resultType="CustomerInfoVO">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectCustDupByKey] */
        SELECT *
        FROM    CR_0101T T1
        WHERE   T1.DLR_CD   = #{sDlrCd}
        AND     T1.CUST_NM  = #{sCustNm}
        AND     T1.CUST_TP  = #{sCustTp}
        <choose>
            <when test='sCustTp == "01"'>
                AND     T1.HP_NO    = #{sHpNo}
            </when>
            <otherwise>
                AND     T1.OFFICE_TEL_NO    = #{sOfficeTelNo}
            </otherwise>
        </choose>
        AND     T1.DEL_YN = 'N'
    </select>

    <!-- 고객 정보를 조회 한다. (중복 확인) 신분증유형 + 신분증 번호-->
    <select id="selectCustMathDocDupByKey" parameterType="CustomerInfoSearchVO" resultType="CustomerInfoVO">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectCustMathDocDupByKey] */
        SELECT *
        FROM    CR_0101T T1
        WHERE   T1.DLR_CD   = #{sDlrCd}
        AND     T1.MATH_DOC_TP  = #{sMathDocTp}
        AND     T1.SSN_CRN_NO = #{sSsnCrnNo}
        AND     T1.DEL_YN = 'N'
    </select>

    <!-- 고객 정보를 카운트를 조회 한다. 엑셀 업로드시 중복 확인용 -->
    <select id="selectCustDupCntByKey" parameterType="map" resultType="int">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectCustDupCntByKey] */
        SELECT  COUNT(*)
        FROM    CR_0101T T1
        WHERE   T1.DLR_CD   = #{dlrCd}
        AND     T1.CUST_NM  = #{custNm}
        AND     T1.HP_NO    = #{hpNo}
        AND     T1.DEL_YN = 'N'
    </select>

    <!-- 마스터 고객 정보를 조회 한다. (중복 확인) 판매사원용-->
    <select id="selectMasterCustDupByKey" parameterType="map" resultType="CustomerInfoVO">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectMasterCustDupByKey] */
        SELECT *
        FROM    CR_0117T T1
        WHERE   T1.DLR_CD   = #{dlrCd}
        AND     T1.CUST_NM  = #{custNm}
        AND     T1.HP_NO    = #{hpNo}
    </select>
</mapper>