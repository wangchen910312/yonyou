<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : BayManageDAO_SqlMap.xml
    Description : BAY 관리에 관한 데이터처리
    author KyungMok Kim
    since 2016. 01. 19.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 01. 19.  KyungMok Kim     최초 생성
-->

<mapper namespace="chn.bhmc.dms.ser.svi.service.dao.BayManageDAO">

	<!-- Bay 마스터 등록. -->
	<insert id="insertBayMaster" parameterType="BayMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.BayMasterDAO.insertBayMaster] */
        INSERT INTO SE_1012T(DLR_CD, BAY_NO, BAY_NM, RPIR_TP, BAY_TP, USE_YN, STRGE_CD, STRGE_NM, BAY_LOC_CD, BAY_LOC_NM, ADM_SA_ID, ADM_SA_NM, VR_YN, REG_DT, REG_USR_ID, EQM_CD, EQM_NM)
        VALUES(#{dlrCd}, #{bayNo}, #{bayNm}, #{rpirTp}, #{bayTp}, #{useYn}, #{strgeCd}, #{strgeNm}, #{bayLocCd}, #{bayLocNm}, #{admSaId}, #{admSaNm}, #{vrYn}, SYSDATE, #{regUsrId}, #{eqmCd}, #{eqmNm})
	</insert>

	<!-- Bay 마스터  수정. -->
	<update id="updateBayMaster" parameterType="BayMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.BayMasterDAO.updateBayMaster] */
		UPDATE SE_1012T SET
			BAY_NM = #{bayNm},
			RPIR_TP = #{rpirTp},
			BAY_TP = #{bayTp},
			USE_YN = #{useYn},
			STRGE_CD = #{strgeCd},
			STRGE_NM = #{strgeNm},
			BAY_LOC_CD = #{bayLocCd},
			BAY_LOC_NM = #{bayLocNm},
			ADM_SA_ID = #{admSaId},
			ADM_SA_NM = #{admSaNm},
			VR_YN = #{vrYn},
            EQM_CD = #{eqmCd},
            EQM_NM = #{eqmNm},
            UPDT_DT = SYSDATE,
            UPDT_USR_ID = #{updtUsrId}
		WHERE BAY_NO = #{bayNo}
        <if test="dlrCd != null and dlrCd != ''">
            AND DLR_CD = #{dlrCd}
        </if>
	</update>

	<!-- Bay 마스터 삭제. -->
	<delete id="deleteBayMaster" parameterType="BayMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.BayMasterDAO.deleteBayMaster] */
		DELETE FROM SE_1012T WHERE BAY_NO = #{bayNo} AND DLR_CD = #{dlrCd}
	</delete>

	<!-- Bay 마스터 조회1. -->
	<select id="selectBayMasterByKey" parameterType="BayManageSearchVO" resultType="BayMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.BayMasterDAO.selectBayMasterByKey] */
		SELECT
            DLR_CD,
			BAY_NO,
       		BAY_NM,
       		RPIR_TP,
       		BAY_TP,
       		USE_YN,
       		STRGE_CD,
       		STRGE_NM,
            ADM_SA_ID,
            ADM_SA_NM,
            VR_YN,
       		REG_DT,
       		REG_USR_ID,
       		UPDT_DT,
       		UPDT_USR_ID,
            EQM_CD,
            EQM_NM
  		FROM SE_1012T
		WHERE BAY_NO = #{sBayNo}
        <if test="sDlrCd != null and sDlrCd != ''">
            AND DLR_CD = #{sDlrCd}
        </if>
	</select>

    <!-- Bay 마스터 조회1. -->
    <select id="selectBayMasterByKeyCnt" parameterType="BayMasterVO" resultType="int">
        /* [chn.bhmc.dms.ser.svi.service.dao.BayMasterDAO.selectBayMasterByKey] */
        SELECT
            DLR_CD,
            BAY_NO,
            BAY_NM,
            RPIR_TP,
            BAY_TP,
            USE_YN,
            STRGE_CD,
            STRGE_NM,
            ADM_SA_ID,
            ADM_SA_NM,
            VR_YN,
            REG_DT,
            REG_USR_ID,
            UPDT_DT,
            UPDT_USR_ID,
            EQM_CD,
            EQM_NM
        FROM SE_1012T
        WHERE BAY_NO = #{sBayNo}
        <if test="sDlrCd != null and sDlrCd != ''">
            AND DLR_CD = #{sDlrCd}
        </if>
    </select>

	<!-- Bay 마스터 목록 조회. -->
	<select id="selectBayMastersByCondition" parameterType="BayManageSearchVO" resultType="BayMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.BayMasterDAO.selectBayMastersByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
        		SELECT
        			A.DLR_CD,
                    A.BAY_NO AS BAY_NO,
               		A.BAY_NM,
               		A.RPIR_TP,
               		A.BAY_TP,
               		A.USE_YN,
               		A.STRGE_CD,
               		A.STRGE_NM,
                    A.ADM_SA_ID,
                    A.ADM_SA_NM,
                    A.VR_YN,
               		A.REG_DT,
               		A.REG_USR_ID,
               		A.UPDT_DT,
               		A.UPDT_USR_ID,
                    EQM_CD,
                    EQM_NM
          		FROM SE_1012T A
                <where>
                    <if test="sDlrCd != null and sDlrCd != ''">
            	       A.DLR_CD = #{sDlrCd}
                    </if>
                    <if test='sBayNo != null and sBayNo != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBayNo,"*")'>
                                <bind name='sBayNo' value='@org.apache.commons.lang3.StringUtils@replace(sBayNo, "*", "%")' />
                                AND A.BAY_NO LIKE #{sBayNo}
                            </when>
                            <otherwise>
                                 AND A.BAY_NO = #{sBayNo}
                            </otherwise>
                        </choose>
                    </if>
                    <if test='sAdmSaNm != null and sAdmSaNm != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sAdmSaNm,"*")'>
                                <bind name='sAdmSaNm' value='@org.apache.commons.lang3.StringUtils@replace(sAdmSaNm, "*", "%")' />
                                AND A.ADM_SA_NM LIKE #{sAdmSaNm}
                            </when>
                            <otherwise>
                                 AND A.ADM_SA_NM = #{sAdmSaNm}
                            </otherwise>
                        </choose>
                    </if>
                </where>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
	</select>

	<!-- Bay 마스터 목록수를 조회. -->
	<select id="selectBayMastersByConditionCnt" parameterType="BayMasterVO" resultType="int">
        /* [chn.bhmc.dms.ser.svi.service.dao.BayMasterDAO.selectBayMastersByConditionCnt] */
		SELECT
			COUNT(*) AS VALUE
		FROM SE_1012T A
        <where>
            <if test="sDlrCd != null and sDlrCd != ''">
                A.DLR_CD = #{sDlrCd}
            </if>
            <if test='sBayNo != null and sBayNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sBayNo,"*")'>
                        <bind name='sBayNo' value='@org.apache.commons.lang3.StringUtils@replace(sBayNo, "*", "%")' />
                        AND A.BAY_NO LIKE #{sBayNo}
                    </when>
                    <otherwise>
                         AND A.BAY_NO = #{sBayNo}
                    </otherwise>
                </choose>
            </if>
            <if test='sAdmSaNm != null and sAdmSaNm != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sAdmSaNm,"*")'>
                        <bind name='sAdmSaNm' value='@org.apache.commons.lang3.StringUtils@replace(sAdmSaNm, "*", "%")' />
                        AND A.ADM_SA_NM LIKE #{sAdmSaNm}
                    </when>
                    <otherwise>
                         AND A.ADM_SA_NM = #{sAdmSaNm}
                    </otherwise>
                </choose>
            </if>
        </where>
	</select>

    <!-- Bay 상세 등록. -->
    <insert id="insertBayDetail" parameterType="BayDetailVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.BayDetailDAO.insertBayDetail] */
        INSERT INTO SE_1013T( DLR_CD, BAY_GRP_TP, BAY_NO, LINE_NO, TEC_ID, TEC_NM, REG_USR_ID )
        VALUES ( #{dlrCd}, #{bayGrpTp}, #{bayNo}, #{lineNo}, #{tecId}, #{tecNm}, #{regUsrId} )
    </insert>

    <!-- Bay 상세  수정. -->
    <update id="updateBayDetail" parameterType="BayDetailVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.BayDetailDAO.updateBayDetail] */
        UPDATE SE_1013T SET
            BAY_GRP_TP = #{bayGrpTp}
            ,LINE_NO = #{lineNo}
            ,TEC_ID = #{tecId}
            ,TEC_NM = #{tecNm}
            ,UPDT_USR_ID = #{regUsrId}
        WHERE BAY_NO = #{bayNo}
        AND DLR_CD = #{dlrCd}
        AND LINE_NO = #{lineNo}
    </update>

    <!-- Bay 상세 삭제. -->
    <delete id="deleteBayDetail" parameterType="BayDetailVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.BayDetailDAO.deleteBayDetail] */
        DELETE FROM SE_1013T
        WHERE BAY_NO = #{bayNo}
        AND DLR_CD = #{dlrCd}
        <if test="lineNo != null and lineNo != ''">
            AND LINE_NO = #{lineNo}
        </if>
    </delete>

    <!-- Bay 상세 목록 조회. -->
    <select id="selectBayDetailsByCondition" parameterType="BayManageSearchVO" resultType="BayDetailVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.BayDetailDAO.selectBayDetailsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                    DLR_CD
                    ,BAY_GRP_TP
                    ,BAY_NO
                    ,LINE_NO
                    ,TEC_ID
                    ,TEC_NM
                FROM SE_1013T
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        DLR_CD = #{sDlrCd}
                    </if>
                    <if test='sBayNo != null and sBayNo != ""'>
                        AND BAY_NO = #{sBayNo}
                    </if>
                </where>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- Bay 상세 목록 조회. -->
    <select id="selectBayDetailsByConditionCnt" parameterType="BayManageSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.svi.service.dao.BayDetailDAO.selectBayDetailsByConditionCnt] */
        SELECT COUNT(*)
        FROM SE_1013T
        <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                DLR_CD = #{sDlrCd}
            </if>
            <if test='sBayNo != null and sBayNo != ""'>
                AND BAY_NO = #{sBayNo}
            </if>
        </where>
    </select>

</mapper>