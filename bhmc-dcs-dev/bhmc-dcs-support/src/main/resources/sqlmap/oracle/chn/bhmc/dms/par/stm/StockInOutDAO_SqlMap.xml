<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : StockInOutDAO_SqlMap.xml
    Description : 재고 관리.
    author Ju Won Lee
    since 2018. 2. 08.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2018. 2. 08.     Ju Won Lee     최초 생성
-->

<mapper namespace="chn.bhmc.dms.par.stm.service.dao.StockInOutDAO">

    <!-- 재고분석현황 조회 정보 Count를 조회한다. -->
    <select id="selectStockAnalysisByConditionCnt" resultType="int" parameterType="StockInOutSearchVO">
    /* [chn.bhmc.dms.par.stm.service.dao.StockInOutDAO.selectStockAnalysisByConditionCnt] */
          SELECT COUNT(*)
            FROM PT_0320I A
                 INNER JOIN CM_0101T B ON A.IAN_DLR_CD = B.DLR_CD
           WHERE 1=1
            <if test='sDlrCd != null and sDlrCd != ""'>
               AND A.IAN_DLR_CD = #{sDlrCd}
            </if>
            <if test='sDlrNm != null and sDlrNm != ""'>
                AND B.DLR_NM LIKE '%'||#{sDlrNm}||'%'
            </if>
            <if test='sYyMm != null and sYyMm != ""'>
                AND A.IAN_YYMM = #{sYyMm}
            </if>
            <if test='sStockQtyFr != null and sStockQtyFr != ""'>
                AND A.IAN_STOCK_QTY <![CDATA[>=]]> #{sStockQtyFr}
            </if>
            <if test='sStockQtyTo != null and sStockQtyTo != ""'>
                AND A.IAN_STOCK_QTY <![CDATA[<]]> #{sStockQtyTo}
            </if>
    </select>

       <!-- 재고분석 조회 정보를 조회한다. -->
    <select id="selectStockAnalysisByCondition" resultType="StockInOutVO" parameterType="StockInOutSearchVO">
    /* [chn.bhmc.dms.par.stm.service.dao.StockInOutDAO.selectStockAnalysisByCondition] */
      SELECT A.*
        FROM
            (
            SELECT   ROWNUM AS RNUM
                   , T1.*
              FROM (
                      SELECT A.IAN_DLR_CD
                            ,B.DLR_NM
                            ,to_char(to_date(A.IAN_YYMM,'yyyy-mm'),'yyyy-mm') AS IAN_YYMM
                            ,A.IAN_AVLB_STOCK_QTY
                            ,A.IAN_RESV_STOCK_QTY
                            ,A.IAN_BORROW_QTY
                            ,A.IAN_RENT_QTY
                            ,A.IAN_STOCK_QTY
                            ,A.IAN_STOCK_AMT
                            ,A.IAN_GI_QTY
                            ,A.IAN_GI_AMT
                            ,A.IAN_PRE_STOCK_QTY
                            ,A.IAN_PRE_STOCK_AMT
                            ,A.IAN_STOCK_TOT_QTY
                            ,A.IAN_STOCK_TOT_AMT
                            ,A.IAN_STOCK_AMT_RATE
                            ,A.IAN_MOS
                            ,A.IAN_INVENTORY_TURNOVER_RATIO
                    FROM PT_0320I A
                         INNER JOIN CM_0101T B ON A.IAN_DLR_CD = B.DLR_CD
                   WHERE 1=1
                    <if test='sDlrCd != null and sDlrCd != ""'>
                       AND A.IAN_DLR_CD = #{sDlrCd}
                    </if>
                    <if test='sDlrNm != null and sDlrNm != ""'>
                        AND B.DLR_NM LIKE '%'||#{sDlrNm}||'%'
                    </if>
                    <if test='sYyMm != null and sYyMm != ""'>
                        AND A.IAN_YYMM = #{sYyMm}
                    </if>
                    <if test='sStockQtyFr != null and sStockQtyFr != ""'>
                        AND A.IAN_STOCK_QTY <![CDATA[>=]]> #{sStockQtyFr}
                    </if>
                    <if test='sStockQtyTo != null and sStockQtyTo != ""'>
                        AND A.IAN_STOCK_QTY <![CDATA[<]]> #{sStockQtyTo}
                    </if>
                     ORDER BY
                          A.IAN_DLR_CD ASC
                         ,A.IAN_YYMM DESC
             ) T1
           ) A
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
            </where>
    </select>
</mapper>