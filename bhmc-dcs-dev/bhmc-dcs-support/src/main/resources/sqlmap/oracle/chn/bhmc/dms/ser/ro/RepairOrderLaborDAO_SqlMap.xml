<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : RepairOrderLaborDAO_SqlMap.xml
    Description : RO정비에 관한 데이터처리
    author KyungMok Kim
    since 2016. 01. 19.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 01. 19.  KyungMok Kim     최초 생성
-->

<mapper namespace="chn.bhmc.dms.ser.ro.service.dao.RepairOrderLaborDAO">

    <!-- 예약정비 등록. -->
    <insert id="insertRepairOrderLabor" parameterType="RepairOrderLaborVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderLaborDAO.insertRepairOrderLabor] */
        INSERT INTO SE_0320T
        (
            DLR_CD                  --딜러코드
            ,RO_DOC_NO               --RO문서번호
            ,LINE_NO                 --라인번호
            ,RO_TP                   --RO유형
            ,LBR_CD                  --공임코드
            ,LBR_NM                  --공임명
            ,PKG_ITEM_CD             --패키지품목코드
            ,LBR_TP                  --공임유형
            ,LBR_PRC                 --공임단가
            ,LBR_HM                  --공임시간
            ,DSTB_HM                 --배분시간
            ,DC_AMT                  --할인금액
            ,EXPC_LBR_AMT            --예정공임금액
            ,CR_NO                   --캠페인리콜일련번호
            ,SER_CUPN_ITEM_CD        --FMS쿠폰품목코드
            ,SER_ITEM_CD             --FMS품목코드
            ,SUB_BP_CD               --외주거래처코드
            ,SUB_BP_NM               --외주거래처명
            ,REG_USR_ID              --등록자ID
            ,REG_DT                  --등록일자
        )
        VALUES
        (
            #{dlrCd}                  --딜러코드
            ,#{roDocNo}                --RO문서번호
            ,#{lineNo}                 --라인번호
            ,#{roTp}                   --RO유형
            ,#{lbrCd}                  --공임코드
            ,#{lbrNm}                  --공임명
            ,#{pkgItemCd}              --패키지품목코드
            ,#{lbrTp}                  --공임유형
            ,#{lbrPrc}                 --공임단가
            ,#{lbrHm}                  --공임시간
            ,#{dstbHm}                 --배분시간
            ,#{dcAmt}                  --할인금액
            ,#{expcLbrAmt}             --예정공임금액
            ,#{crNo}                   --캠페인리콜일련번호
            ,#{serCupnItemCd}          --FMS쿠폰품목코드
            ,#{serItemCd}              --FMS품목코드
            ,#{subBpCd}                --외주거래처코드
            ,#{subBpNm}                --외주거래처명
            ,#{regUsrId}               --등록자ID
            ,SYSDATE
        )
    </insert>

    <!-- 예약정비  수정. -->
    <update id="updateRepairOrderLabor" parameterType="RepairOrderLaborVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderLaborDAO.updateRepairOrderLabor] */
        UPDATE SE_0320T SET
            LINE_NO          = #{lineNo}                 --라인번호
            ,RO_TP            = #{roTp}                   --RO유형
            ,LBR_CD           = #{lbrCd}                  --공임코드
            ,LBR_NM           = #{lbrNm}                  --공임명
            ,PKG_ITEM_CD      = #{pkgItemCd}              --패키지품목코드
            ,LBR_TP           = #{lbrTp}                  --공임유형
            ,LBR_PRC          = #{lbrPrc}                 --공임단가
            ,LBR_HM           = #{lbrHm}                  --공임시간
            ,DSTB_HM          = #{dstbHm}                 --배분시간
            ,DC_AMT           = #{dcAmt}                  --할인금액
            ,EXPC_LBR_AMT     = #{expcLbrAmt}             --예정공임금액
            ,CR_NO           = #{crNo}                    --캠페인리콜일련번호
            ,SER_CUPN_ITEM_CD = #{serCupnItemCd}          --FMS쿠폰품목코드
            ,SER_ITEM_CD      = #{serItemCd}              --FMS품목코드
            ,SUB_BP_CD        = #{subBpCd}                --외주거래처코드
            ,SUB_BP_NM        = #{subBpNm}                --외주거래처명
            ,REG_USR_ID       = #{regUsrId}               --등록자ID
            ,REG_DT           = #{regDt}                  --등록일자
            ,UPDT_USR_ID      = #{updtUsrId}              --수정자ID
            ,UPDT_DT          = SYSDATE                 --수정일자
            WHERE RO_DOC_NO = #{roDocNo} --RO문서번호
            AND LINE_NO = #{lineNo} --라인번호
            AND DLR_CD = #{dlrCd}   --딜러코드
    </update>

    <!-- 예약정비 삭제. -->
    <delete id="deleteRepairOrderLabor" parameterType="RepairOrderLaborVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderLaborDAO.deleteRepairOrderLabor] */
        DELETE FROM SE_0320T
        WHERE RO_DOC_NO = #{roDocNo}
        <if test='lineNo != null and lineNo != ""'>
            AND LINE_NO = #{lineNo}
        </if>
    </delete>

    <!-- 예약부품 목록 조회. -->
    <select id="selectRepairOrderLaborsByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderLaborVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderLaborDAO.selectRepairOrderLaborsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT * FROM SE_0320T
                    <where>
                        <if test='sRoDocNo != null and sRoDocNo != ""'>
                            AND RO_DOC_NO = #{sRoDocNo}
                        </if>
                        <if test='sDlrCd != null and sDlrCd != ""'>
                            AND DLR_CD = #{sDlrCd}
                        </if>
                    </where>
                    ORDER BY LINE_NO
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- RO부품 목록수를 조회. -->
    <select id="selectRepairOrderLaborsByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderLaborDAO.selectRepairOrderLaborsByConditionCnt] */
        SELECT COUNT(*) AS VALUE
        FROM SE_0320T
        <where>
            <if test='sRoDocNo != null and sRoDocNo != ""'>
                AND RO_DOC_NO = #{sRoDocNo}
            </if>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND DLR_CD = #{sDlrCd}
            </if>
        </where>
    </select>
</mapper>