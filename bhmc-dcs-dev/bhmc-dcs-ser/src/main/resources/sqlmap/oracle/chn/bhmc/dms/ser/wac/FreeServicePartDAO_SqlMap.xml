<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : FreeServicePartDAO_SqlMap.xml
    Description : 클레임 요청 에 관한 데이터처리
    author Kwon Ki Hyun
    since 2016. 02. 29.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 05. 17.  Kwon Ki Hyun     최초 생성
-->

<mapper namespace="chn.bhmc.dms.ser.wac.service.dao.FreeServicePartDAO">

    <!-- 면비부품 등록 -->
    <insert id="insertFreeServicePart" parameterType="FreeServicePartVO">
      /* [chn.bhmc.dms.ser.wac.service.dao.FreeServicePartDAO.insertFreeServicePart] */

            INSERT INTO DMSDB.SE_0950T    --면비부품신청
            (
              DLR_CD                            --딜러코드
             ,FREE_ITEM_DOC_NO                  --면비부품문서번호
             ,VIN_NO                            --차대번호
             ,FREE_ITEM_STAT_CD                 --면비부품상태
             ,ITEM_TP                           --부품유형
             ,ITEM_CD                           --부품번호
             ,ITEM_NM                           --부품명
             ,FREE_ITEM_REQ_DT                  --면비부품요청일
             ,SPYR_JUDG_DT                      --공급상 판정일
             ,SPYR_JUDG_ID                      --공급상 판정ID
             ,SPYR_JUDG_NM                      --공급상 판정명
             ,SPYR_PROC_CONT                    --공급상 처리의견
             ,FREE_ITEM_APPROVE_NO              --면비부품승인번호
             ,LTS_MODEL_CD                      --LTS MODEL CD
             ,WART_DT                           --보증적용일
             ,SALE_DT                           --판매일
             ,CRE_DT                            --생산일
             ,DRIVE_MONTH                       --운행월
             ,RUN_DIST_VAL                      --주행거리
             ,REQ_USR_NM                        --신청인명
             ,REQ_USR_TEL_NO                    --신청인 전화번호
             ,CAR_OWNER_ID                      --소유자ID
             ,CAR_OWNER_NM                      --소유자명
             ,CAR_OWNER_TEL_NO                  --고객전화
             ,ITEM_CMP                          --부품업체
             ,WRTR_DT                           --작성일자
             ,CAU_CD                            --원인코드
             ,CAU_NM                            --원인코드명
             ,PHEN_CD                           --현상코드
             ,PHEN_NM                           --현상코드명
             ,ERR_CAU_CONT                      --고장현상설명
             ,REMARK                            --비고
             ,FILE_KEY_NM                       --파일키
             ,SPYR_FREE_ITEM_SEND_DT            --공금상면비부품발송일
             ,DLR_FREE_ITEM_ACPT_DT             --딜러면비부품접수일
             ,DLR_OLD_ITEM_RTN_INVC_NO          --딜러고품반납송장번호
             ,SPYR_FREE_ITEM_RTN_INVC_NO        --공금상면비부품송장번호
             ,DLR_OLD_ITEM_RTN_DT               --딜러고품반납일
             ,FREE_ITEM_EXPS_CMP_NM             --면비부품발송택배회사명
             ,OLD_ITEM_EXPS_CMP_NM              --고품반납택배회사명
             ,REG_USR_ID                        --등록자ID
             ,REG_DT                            --등록일자
             ,SPYR_NM                           --공급상명
            )
            VALUES
            (
              #{dlrCd}                            --딜러코드
             ,#{freeItemDocNo}                    --면비부품문서번호
             ,#{vinNo}                            --차대번호
             ,#{freeItemStatCd}                   --면비부품상태
             ,#{itemTp}                           --부품유형
             ,#{itemCd}                           --부품번호
             ,#{itemNm}                           --부품명
             ,#{freeItemReqDt}                    --면비부품요청일
             ,#{spyrJudgDt}                       --공급상 판정일
             ,#{spyrJudgId}                       --공급상 판정ID
             ,#{spyrJudgNm}                       --공급상 판정명
             ,#{spyrProcCont}                     --공급상 처리의견
             ,#{freeItemApproveNo}                --면비부품승인번호
             ,#{ltsModelCd}                       --LTS MODEL CD
             ,#{wartDt}                           --보증적용일
             ,#{saleDt}                           --판매일
             ,#{creDt}                            --생산일
             ,#{driveMonth}                       --운행월
             ,#{runDistVal}                       --주행거리
             ,#{reqUsrNm}                         --신청인명
             ,#{reqUsrTelNo}                      --신청인 전화번호
             ,#{carOwnerId}                       --소유자ID
             ,#{carOwnerNm}                       --소유자명
             ,#{carOwnerTelNo}                    --고객전화
             ,#{itemCmp}                          --부품업체
             ,#{wrtrDt}                           --작성일자
             ,#{cauCd}                            --원인코드
             ,#{cauNm}                            --원인코드명
             ,#{phenCd}                           --현상코드
             ,#{phenNm}                           --현상코드명
             ,#{errCauCont}                       --고장현상설명
             ,#{remark}                           --비고
             ,#{fileKeyNm}                        --파일키
             ,#{spyrFreeItemSendDt}               --공금상면비부품발송일
             ,#{dlrFreeItemAcptDt}                --딜러면비부품접수일
             ,#{dlrOldItemRtnInvcNo}                --딜러고품반납송장번호
             ,#{spyrFreeItemRtnInvcNo}              --공금상면비부품송장번호
             ,#{dlrOldItemRtnDt}                  --딜러고품반납일
             ,#{freeItemExpsCmpNm}                --면비부품발송택배회사명
             ,#{oldItemExpsCmpNm}                 --고품반납택배회사명
             ,#{regUsrId}                         --등록자ID
             ,sysdate                            --등록일자
             ,#{spyrNm}                           --공급상명
            )
    </insert>


    <!-- 면비부품 정보  수정 -->
    <update id="updateFreeServicePart" parameterType="FreeServicePartVO">
      /* [chn.bhmc.dms.ser.wac.service.dao.FreeServicePartDAO.updateFreeServicePart] */

       UPDATE SE_0950T    --면비부품신청
          SET FREE_ITEM_STAT_CD          = #{freeItemStatCd},         --면비부품상태
              <if test='freeItemStatCd == "HA" '>
              BHMC_CONFIRM_DT            = #{bhmcConfirmDt},          --BHMC 판정일
              FREE_ITEM_APPROVE_NO       = #{freeItemApproveNo},      --면비부품승인번호
              BHMC_JUDG_ID               = #{bhmcJudgId},             --BHMC 판정ID
              BHMC_JUDG_NM               = #{bhmcJudgNm},             --BHMC 판정명
              BHMC_JUDG_PROC_CONT        = #{bhmcJudgProcCont},       --BHMC 처리의견
             </if>
             <if test='freeItemStatCd == "HR" '>
              BHMC_CONFIRM_DT            = '',                        --BHMC 판정일
              FREE_ITEM_APPROVE_NO       = NULL,                      --면비부품승인번호
              </if>
              <if test='freeItemStatCd == "ZA" '>
              SPYR_NM                    = #{spyrNm},                 --공급상
              SPYR_JUDG_DT               = #{spyrJudgDt},             --공급상 판정일
              SPYR_JUDG_ID               = #{spyrJudgId},             --공급상 판정ID
              SPYR_JUDG_NM               = #{spyrJudgNm},             --공급상 판정명
              SPYR_PROC_CONT             = #{spyrProcCont},           --공금상 처리의견
              SPYR_FREE_ITEM_SEND_DT     = #{spyrFreeItemSendDt},     --공금상면비부품발송일
              SPYR_FREE_ITEM_RTN_INVC_NO = #{spyrFreeItemRtnInvcNo},  --공금상면비부품송장번호
              FREE_ITEM_EXPS_CMP_NM      = #{freeItemExpsCmpNm},      --면비부품발송택배회사명
             </if>
              <if test='freeItemStatCd == "ZR" '>
              SPYR_JUDG_DT               = NULL,                      --공급상 판정일
              SPYR_JUDG_ID               = '',                        --공급상 판정ID
              SPYR_JUDG_NM               = '',                        --공급상 판정명
             </if>
              UPDT_USR_ID                = #{updtUsrId},              --수정자ID
              UPDT_DT                    = #{updtDt}                  --수정일자
         WHERE 1 = 1
           AND FREE_ITEM_DOC_NO           = #{freeItemDocNo}          --면비부품문서번호
           AND VIN_NO                     = #{vinNo}                  --차대번호
           AND DLR_CD                     = #{dlrCd}                  --딜러코드

    </update>

    <!-- 면비 부품 삭제 -->
    <delete id="deleteFreeServicePart" parameterType="FreeServicePartVO">
    /* [chn.bhmc.dms.ser.wac.service.dao.FreeServicePartDAO.deleteFreeServicePart] */

        DELETE FROM SE_0950T
        WHERE 1 = 1
           AND FREE_ITEM_DOC_NO           = #{freeItemDocNo}                    --면비부품문서번호
           AND VIN_NO                     = #{vinNo}                            --차대번호
           AND DLR_CD                     = #{dlrCd}                            --딜러코드

    </delete>

    <!-- 면비 부품 인터페이스 삭제 -->
    <delete id="deleteFreeServicePartIf" parameterType="FreeServicePartVO">
    /* [chn.bhmc.dms.ser.wac.service.dao.FreeServicePartDAO.deleteFreeServicePartIf] */

        DELETE FROM SE_0950I
         WHERE 1 = 1
           AND FREE_ITEM_DOC_NO           = #{freeItemDocNo}                    --면비부품문서번호
           AND VIN_NO                     = #{vinNo}                            --차대번호
           AND DLR_CD                     = #{dlrCd}                            --딜러코드

    </delete>

    <!-- 면비부품  요청 인터페이스 정보  조회 -->
    <select id="selectFreeServicePartIfByConditionCnt" parameterType="FreeServicePartVO" resultType="int">
     /* [chn.bhmc.dms.ser.wac.service.dao.FreeServicePartDAO.selectFreeServicePartIfByConditionCnt] */

            SELECT COUNT(FREE_ITEM_DOC_NO) AS VALUE
              FROM DMSDB.SE_0950I    --면비부품신청
             WHERE FREE_ITEM_DOC_NO           = #{freeItemDocNo}                    --면비부품문서번호
               AND VIN_NO                     = #{vinNo}                            --차대번호
               AND DLR_CD                     = #{dlrCd}                            --딜러코드
               <if test ='ifResltYn != null and ifResltYn != ""'>
               AND IFRESULT = #{ifResltYn}
              </if>

    </select>

    <!-- 면비부품  요청목록 조회 -->
    <select id="selectFreeServicePartByConditionCnt" parameterType="FreeServicePartSearchVO" resultType="int">
     /* [chn.bhmc.dms.ser.wac.service.dao.FreeServicePartDAO.selectFreeServicePartByConditionCnt] */

                SELECT COUNT(FREE_ITEM_DOC_NO) AS VALUE
                  FROM DMSDB.SE_0950T    --면비부품신청
                 <where>
                   <if test='sDlrCd != null and sDlrCd != ""'>
                   AND DLR_CD = #{sDlrCd}  --딜러코드
                   </if>
                   <if test='sFreeItemDocNo != null and sFreeItemDocNo != ""'>
                   AND FREE_ITEM_DOC_NO = #{sFreeItemDocNo} --면비부품문서번호
                   </if>
                   <if test='sVinNo != null and sVinNo != ""'>
                   AND VIN_NO LIKE '%' || #{sVinNo} || '%' --차대번호
                   </if>
                   <if test='sFreeItemStatCd != null and sFreeItemStatCd != ""'>
                   AND FREE_ITEM_STAT_CD = #{sFreeItemStatCd} --면비부품상태
                   </if>
                   <if test='sItemTp != null and sItemTp != ""'>
                   AND ITEM_TP = #{sItemTp}  --부품유형
                   </if>
                   <if test='sItemCd != null and sItemCd  != ""'>
                   AND ITEM_CD LIKE '%' || #{sItemCd} || '%' --부품번호
                   </if>
                   <choose>
                       <when test='sPreFixId != null and sPreFixId  != ""'>
                           <if test='sPreFixId == "BHMC" '>
                               <if test='sFromDt !=null'>
                               AND FREE_ITEM_REQ_DT <![CDATA[>=]]> #{sFromDt}
                               </if>
                               <if test='sToDt !=null'>
                               AND FREE_ITEM_REQ_DT <![CDATA[<=]]> #{sToDt}+1
                               </if>
                           </if>
                           <if test='sPreFixId == "SPY" '>
                               <if test='sFromDt !=null'>
                               AND FREE_ITEM_REQ_DT <![CDATA[>=]]> #{sFromDt}
                               </if>
                               <if test='sToDt !=null'>
                               AND FREE_ITEM_REQ_DT <![CDATA[<=]]> #{sToDt}+1
                               </if>
                               AND FREE_ITEM_STAT_CD IN ('ZS','ZA','ZR','HA')
                           </if>
                        </when>
                        <otherwise>
                           <if test='sFromDt !=null'>
                           AND WRTR_DT <![CDATA[>=]]> #{sFromDt}
                           </if>
                           <if test='sToDt !=null'>
                           AND WRTR_DT <![CDATA[<=]]> #{sToDt}+1
                           </if>
                        </otherwise>
                   </choose>
                 </where>

    </select>

    <!-- 면비부품  목록 조회 -->
    <select id="selectFreeServicePartByCondition" parameterType="FreeServicePartSearchVO" resultType="FreeServicePartVO">
     /* [chn.bhmc.dms.ser.wac.service.dao.FreeServicePartDAO.selectFreeServicePartByCondition] */

          SELECT *
            FROM (
              SELECT ROWNUM AS RNUM ,T1.*
               FROM (
                  SELECT
                        DLR_CD                            --딜러코드
                       ,FREE_ITEM_DOC_NO                  --면비부품문서번호
                       ,VIN_NO                            --차대번호
                       ,FREE_ITEM_STAT_CD                 --면비부품상태
                       ,FN_CMM_CD_NM('SER112',FREE_ITEM_STAT_CD, #{sLangCd}, 'N') AS FREE_ITEM_STAT_NM  --状态名称
                       ,ITEM_TP                           --부품유형
                       ,FN_CMM_CD_NM('SER113',ITEM_TP, #{sLangCd}, 'N') AS ITEM_TP_NM -- 配件类型名称
                       ,ITEM_CD                           --부품번호
                       ,ITEM_NM                           --부품명
                       ,FREE_ITEM_REQ_DT                  --면비부품요청일
                       ,BHMC_CONFIRM_DT                   --BHMC 판정일
                       ,BHMC_JUDG_ID                      --BHMC 판정ID
                       ,BHMC_JUDG_NM                      --BHMC 판정명
                       ,BHMC_JUDG_PROC_CONT               --BHMC 처리의견
                       ,SPYR_JUDG_DT                      --공급상 판정일
                       ,SPYR_JUDG_ID                      --공급상 판정ID
                       ,SPYR_JUDG_NM                      --공급상 판정명
                       ,SPYR_NM                           --공급상
                       ,SPYR_PROC_CONT                    --공금상 처리의견
                       ,FREE_ITEM_APPROVE_NO              --면비부품승인번호
                       ,LTS_MODEL_CD                      --LTS MODEL CD
                       ,FN_SER_LTS_MODEL_NM(LTS_MODEL_CD, #{sLangCd}) AS LTS_MODEL_NM --모델명
                       ,WART_DT                           --보증적용일
                       ,SALE_DT                           --판매일
                       ,CRE_DT                            --생산일
                       ,DRIVE_MONTH                       --운행월
                       ,RUN_DIST_VAL                      --주행거리
                       ,REQ_USR_NM                        --신청인
                       ,REQ_USR_TEL_NO                    --제작자 전화번호
                       ,CAR_OWNER_ID                      --소유자ID
                       ,CAR_OWNER_NM                      --소유자명
                       ,CAR_OWNER_TEL_NO                  --고객전화
                       ,BEF_REQ_DLR_CD                    --이전신청딜러
                       ,BEF_REQ_ITEM_CD                   --이전신청부품
                       ,ITEM_CMP                          --부품업체
                       ,WRTR_DT                           --작성일자
                       ,CAU_CD                            --원인코드
                       ,CAU_NM                            --원인코드명
                       ,PHEN_CD                           --현상코드
                       ,PHEN_NM                           --현상코드명
                       ,ERR_CAU_CONT                      --고장현상설명
                       ,REMARK                            --비고
                       ,FILE_KEY_NM                       --파일키
                       ,SPYR_FREE_ITEM_SEND_DT            --공금상면비부품발송일
                       ,DLR_FREE_ITEM_ACPT_DT             --딜러면비부품접수일
                       ,DLR_OLD_ITEM_RTN_INVC_NO          --딜러고품반납송장번호
                       ,SPYR_FREE_ITEM_RTN_INVC_NO        --공금상면비부품송장번호
                       ,DLR_OLD_ITEM_RTN_DT               --딜러고품반납일
                       ,FREE_ITEM_EXPS_CMP_NM             --면비부품발송택배회사명
                       ,OLD_ITEM_EXPS_CMP_NM              --고품반납택배회사명
                       ,REG_USR_ID                        --등록자ID
                       ,REG_DT                            --등록일자
                       ,UPDT_USR_ID                       --수정자ID
                       ,UPDT_DT                           --수정일자
                  FROM SE_0950T    --면비부품신청
                 <where>
                   <if test='sDlrCd != null and sDlrCd != ""'>
                   AND DLR_CD = #{sDlrCd}  --딜러코드
                   </if>
                   <if test='sFreeItemDocNo != null and sFreeItemDocNo != ""'>
                   AND FREE_ITEM_DOC_NO = #{sFreeItemDocNo} --면비부품문서번호
                   </if>
                   <if test='sVinNo != null and sVinNo != ""'>
                   AND VIN_NO LIKE '%' || #{sVinNo} || '%' --차대번호
                   </if>
                   <if test='sFreeItemStatCd != null and sFreeItemStatCd != ""'>
                   AND FREE_ITEM_STAT_CD = #{sFreeItemStatCd} --면비부품상태
                   </if>

                   <if test='sItemTp != null and sItemTp != ""'>
                   AND ITEM_TP = #{sItemTp}  --부품유형
                   </if>
                   <if test='sItemCd != null and sItemCd  != ""'>
                   AND ITEM_CD LIKE '%' || #{sItemCd} || '%' --부품번호
                   </if>
                   <choose>
                       <when test='sPreFixId != null and sPreFixId  != ""'>
                           <if test='sPreFixId == "BHMC" '>
                               <if test='sFromDt !=null'>
                               AND FREE_ITEM_REQ_DT <![CDATA[>=]]> #{sFromDt}
                               </if>
                               <if test='sToDt !=null'>
                               AND FREE_ITEM_REQ_DT <![CDATA[<=]]> #{sToDt}+1
                               </if>
                           </if>
                           <if test='sPreFixId == "SPY" '>
                               <if test='sFromDt !=null'>
                               AND FREE_ITEM_REQ_DT <![CDATA[>=]]> #{sFromDt}
                               </if>
                               <if test='sToDt !=null'>
                               AND FREE_ITEM_REQ_DT <![CDATA[<=]]> #{sToDt}+1
                               </if>
                               AND FREE_ITEM_STAT_CD != 'O'
                               AND FREE_ITEM_STAT_CD IN ('ZS','ZA','ZR','HA')
                           </if>
                        </when>
                        <otherwise>
                           <if test='sFromDt !=null'>
                           AND WRTR_DT <![CDATA[>=]]> #{sFromDt}
                           </if>
                           <if test='sToDt !=null'>
                           AND WRTR_DT <![CDATA[<=]]> #{sToDt}+1
                           </if>
                        </otherwise>
                   </choose>
                 </where>
                 ORDER BY
                 <choose>
                     <when test='sort != null'>
                         <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                             <choose>
                                 <when test='item.field == "dlrCd"'>                     DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                    </when>
                                 <when test='item.field == "freeItemDocNo"'>             FREE_ITEM_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                 <when test='item.field == "vinNo"'>                     VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                    </when>
                                 <when test='item.field == "freeItemStatCd"'>            FREE_ITEM_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                 <when test='item.field == "itemTp"'>                    ITEM_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                   </when>
                                 <when test='item.field == "itemCd"'>                    ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                   </when>
                                 <when test='item.field == "itemNm"'>                    ITEM_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                   </when>
                                 <when test='item.field == "freeItemReqDt"'>             FREE_ITEM_REQ_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                 <when test='item.field == "bhmcConfirmDt"'>             BHMC_CONFIRM_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                 <when test='item.field == "bhmcJudgId"'>                BHMC_JUDG_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                 <when test='item.field == "bhmcJudgNm"'>                BHMC_JUDG_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                 <when test='item.field == "bhmcJudgProcCont"'>          BHMC_JUDG_PROC_CONT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                 <when test='item.field == "spyrJudgDt"'>                SPYR_JUDG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                 <when test='item.field == "spyrJudgId"'>                SPYR_JUDG_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                 <when test='item.field == "spyrJudgNm"'>                SPYR_JUDG_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                 <when test='item.field == "spyrProcCont"'>              SPYR_PROC_CONT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                 <when test='item.field == "freeItemApproveNo"'>         FREE_ITEM_APPROVE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                 <when test='item.field == "ltsModelCd"'>                LTS_MODEL_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                 <when test='item.field == "wartDt"'>                    WART_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                   </when>
                                 <when test='item.field == "saleDt"'>                    SALE_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                   </when>
                                 <when test='item.field == "creDt"'>                     CRE_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                    </when>
                                 <when test='item.field == "driveMonth"'>                DRIVE_MONTH <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                 <when test='item.field == "runDistVal"'>                RUN_DIST_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                 <when test='item.field == "reqUsrNm"'>                  REQ_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                </when>
                                 <when test='item.field == "reqUsrTelNo"'>                REQ_USR_TEL_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                 <when test='item.field == "carOwnerId"'>                CAR_OWNER_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                 <when test='item.field == "carOwnerNm"'>                CAR_OWNER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                 <when test='item.field == "carOwnerTelNo"'>             CAR_OWNER_TEL_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                 <when test='item.field == "befReqDlrCd"'>               BEF_REQ_DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                 <when test='item.field == "befReqItemCd"'>              BEF_REQ_ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                 <when test='item.field == "itemCmp"'>                   ITEM_CMP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                  </when>
                                 <when test='item.field == "wrtrDt"'>                    WRTR_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                   </when>
                                 <when test='item.field == "cauCd"'>                     CAU_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                    </when>
                                 <when test='item.field == "cauNm"'>                     CAU_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                    </when>
                                 <when test='item.field == "phenCd"'>                    PHEN_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                   </when>
                                 <when test='item.field == "phenNm"'>                    PHEN_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                   </when>
                                 <when test='item.field == "errCauCont"'>                ERR_CAU_CONT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                 <when test='item.field == "remark"'>                    REMARK <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                    </when>
                                 <when test='item.field == "fileKeyNm"'>                 FILE_KEY_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                 <when test='item.field == "spyrFreeItemSendDt"'>        SPYR_FREE_ITEM_SEND_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                 <when test='item.field == "dlrFreeItemAcptDt"'>         DLR_FREE_ITEM_ACPT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                 <when test='item.field == "dlrOldItemRtnInvcNo"'>         DLR_OLD_ITEM_RTN_INVC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                                 <when test='item.field == "spyrFreeItemRtnInvcNo"'>       SPYR_FREE_ITEM_RTN_INVC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                 <when test='item.field == "dlrOldItemRtnDt"'>           DLR_OLD_ITEM_RTN_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                 <when test='item.field == "freeItemExpsCmpNm"'>         FREE_ITEM_EXPS_CMP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                 <when test='item.field == "oldItemExpsCmpNm"'>          OLD_ITEM_EXPS_CMP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                 <otherwise>
                                   DLR_CD ASC
                                 ,FREE_ITEM_DOC_NO ASC
                                 ,VIN_NO ASC
                                 </otherwise>
                             </choose>
                         </foreach>
                     </when>
                     <otherwise>
                       DLR_CD ASC
                     ,FREE_ITEM_DOC_NO ASC
                     ,VIN_NO ASC
                     </otherwise>
                 </choose>
                ) T1
                   <where>
                      <if test='firstIndex != -1 and lastIndex != -1'>
                       AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                      </if>
                 </where>
           )
           <where>
               <if test='firstIndex != -1 and lastIndex != -1'>
                 RNUM > #{firstIndex}
               </if>
           </where>


    </select>


    <!-- 면비부품  상세 정보 조회 -->
    <select id="selectFreeServicePartByKey" parameterType="FreeServicePartSearchVO" resultType="FreeServicePartVO">
     /* [chn.bhmc.dms.ser.wac.service.dao.FreeServicePartDAO.selectFreeServicePartByKey] */

          SELECT
                DLR_CD                            --딜러코드
               ,FREE_ITEM_DOC_NO                  --면비부품문서번호
               ,VIN_NO                            --차대번호
               ,FREE_ITEM_STAT_CD                 --면비부품상태
               ,ITEM_TP                           --부품유형
               ,ITEM_CD                           --부품번호
               ,ITEM_NM                           --부품명
               ,FREE_ITEM_REQ_DT                  --면비부품요청일
               ,BHMC_CONFIRM_DT                   --BHMC 판정일
               ,BHMC_JUDG_ID                      --BHMC 판정ID
               ,BHMC_JUDG_NM                      --BHMC 판정명
               ,BHMC_JUDG_PROC_CONT               --BHMC 처리의견
               ,SPYR_JUDG_DT                      --공급상 판정일
               ,SPYR_JUDG_ID                      --공급상 판정ID
               ,SPYR_NM                           --공급상
               ,SPYR_JUDG_NM                      --공급상 판정명
               ,SPYR_PROC_CONT                    --공금상 처리의견
               ,FREE_ITEM_APPROVE_NO              --면비부품승인번호
               ,LTS_MODEL_CD                      --LTS MODEL CD
               ,FN_SER_LTS_MODEL_NM(LTS_MODEL_CD, #{sLangCd}) AS LTS_MODEL_NM --모델명
               ,WART_DT                           --보증적용일
               ,SALE_DT                           --판매일
               ,CRE_DT                            --생산일
               ,DRIVE_MONTH                       --운행월
               ,RUN_DIST_VAL                      --주행거리
               ,(
                  SELECT CAR_RUN_DIST_VAL
                    FROM SA_0121T
                   WHERE VIN_NO = A.VIN_NO
                     AND DEL_YN ='N') LAST_RUN_DIST_VAL --최종 주행거리
               ,REQ_USR_NM                        --신청인
               ,REQ_USR_TEL_NO                    --제작자 전화번호
               ,CAR_OWNER_ID                      --소유자ID
               ,CAR_OWNER_NM                      --소유자명
               ,CAR_OWNER_TEL_NO                  --고객전화
               ,ITEM_CMP                          --부품업체
               ,WRTR_DT                           --작성일자
               ,CAU_CD                            --원인코드
               ,CAU_NM                            --원인코드명
               ,PHEN_CD                           --현상코드
               ,PHEN_NM                           --현상코드명
               ,ERR_CAU_CONT                      --고장현상설명
               ,REMARK                            --비고
               ,FILE_KEY_NM                       --파일키
               ,SPYR_FREE_ITEM_SEND_DT            --공금상면비부품발송일
               ,DLR_FREE_ITEM_ACPT_DT             --딜러면비부품접수일
               ,DLR_OLD_ITEM_RTN_INVC_NO          --딜러고품반납송장번호
               ,SPYR_FREE_ITEM_RTN_INVC_NO        --공금상면비부품송장번호
               ,DLR_OLD_ITEM_RTN_DT               --딜러고품반납일
               ,FREE_ITEM_EXPS_CMP_NM             --면비부품발송택배회사명
               ,OLD_ITEM_EXPS_CMP_NM              --고품반납택배회사명
          FROM SE_0950T A   --면비부품신청
         <where>
           <if test='sDlrCd != null and sDlrCd != ""'>
           AND DLR_CD = #{sDlrCd}  --딜러코드
           </if>
           <if test='sFreeItemDocNo != null and sFreeItemDocNo != ""'>
           AND FREE_ITEM_DOC_NO = #{sFreeItemDocNo} --면비부품문서번호
           </if>
           <if test='sVinNo != null and sVinNo != ""'>
           AND VIN_NO =  #{sVinNo}  --차대번호
           </if>
           </where>

    </select>

    <!-- 면비부품 요청 상태 정보 -->
    <select id="selectFreeItemRequestStatChkByKey" parameterType="FreeServicePartVO" resultType="string" >
        /* [chn.bhmc.dms.ser.wac.service.dao.FreeServicePartDAO.selectFreeItemRequestStatChkByKey] */

        SELECT FREE_ITEM_STAT_CD
          FROM SE_0950T
         WHERE DLR_CD = #{dlrCd}
           <if test='freeItemDocNo != null and freeItemDocNo != ""'>
           AND FREE_ITEM_DOC_NO = #{freeItemDocNo} --면비부품문서번호
           </if>
           <if test='vinNo != null and vinNo != ""'>
           AND VIN_NO =  #{vinNo}  --차대번호
           </if>

    </select>

    <!-- FREE ITEM 데이타 TEMP로 전송. : 프로시져  -->
    <insert id="insertFreeItemToIf" parameterType="FreeServicePartVO" statementType="CALLABLE">
        {CALL SP_SER_FREEITEM_REQ(
              #{dlrCd, mode=IN, jdbcType=VARCHAR}
            , #{freeItemDocNo, mode=IN, jdbcType=VARCHAR}
            , #{vinNo, mode=IN, jdbcType=VARCHAR}
        )}
    </insert>


</mapper>