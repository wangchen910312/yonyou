<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : DcMasterDAO_SqlMap.xml
    Description : 할인관리 마스터에 관한 데이터처리
    author Yin Xueyuan
    since 2016. 2. 16.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 2. 16.  Yin Xueyuan      최초 생성
-->

<mapper namespace="chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO">

	<!-- 할인관리 등록-->
	<insert id="insertDcMaster" parameterType="DcMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.insertDcMaster] */
	    INSERT INTO SE_1015T    --할인정보
            (
              DLR_CD                   --딜러코드
             ,DC_CD                    --할인코드
             ,DC_TP                    --할인유형
             ,DC_NM                    --할인명
             ,LBR_DC_RATE              --공임할인율
             ,LBR_DC_AMT               --공임할인금액
             ,PAR_DC_RATE              --부품할인율
             ,PAR_DC_AMT               --부품할인금액
             ,SUB_DC_RATE              --외주할인율
             ,SUB_DC_AMT               --외주할인금액
             ,TOT_DC_RATE              --총할인율
             ,TOT_DC_AMT               --총할인금액
             ,DC_APPLY_START_DT        --할인적용시작일자
             ,DC_APPLY_END_DT          --할인적용종료일자
             ,DC_SCORE_VAL             --할인순위값
             ,DC_USE_YN                --할인사용여부
             ,REG_USR_ID               --등록자ID
             ,REG_DT                   --등록일자
             ,UPDT_USR_ID              --수정자ID
             ,UPDT_DT                  --수정일자
            )
            VALUES
            (
              #{dlrCd}                   --딜러코드
             ,#{dcCd}                    --할인코드
             ,#{dcTp}                    --할인유형
             ,#{dcNm}                    --할인명
             ,#{lbrDcRate}               --공임할인율
             ,#{lbrDcAmt}                --공임할인금액
             ,#{parDcRate}               --부품할인율
             ,#{parDcAmt}                --부품할인금액
             ,#{subDcRate}               --외주할인율
             ,#{subDcAmt}                --외주할인금액
             ,#{totDcRate}               --총할인율
             ,#{totDcAmt}                --총할인금액
             ,#{dcApplyStartDt}          --할인적용시작일자
             ,#{dcApplyEndDt}            --할인적용종료일자
             ,#{dcScoreVal}              --할인순위값
             ,#{dcUseYn}                 --할인사용여부
             ,#{regUsrId}                --등록자ID
             ,SYSDATE                   --등록일자
             ,#{updtUsrId}               --수정자ID
             ,SYSDATE                  --수정일자
            )
    </insert>

	<!-- 할인관리 수정 -->
	<update id="updateDcMaster" parameterType="DcMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.updateDcMaster] */
		UPDATE SE_1015T    --할인정보
          SET
               DC_TP             = #{dcTp}                    --할인유형
              ,DC_NM             = #{dcNm}                    --할인명
              ,LBR_DC_RATE       = #{lbrDcRate}               --공임할인율
              ,LBR_DC_AMT        = #{lbrDcAmt}                --공임할인금액
              ,PAR_DC_RATE       = #{parDcRate}               --부품할인율
              ,PAR_DC_AMT        = #{parDcAmt}                --부품할인금액
              ,SUB_DC_RATE       = #{subDcRate}               --외주할인율
              ,SUB_DC_AMT        = #{subDcAmt}                --외주할인금액
              ,TOT_DC_RATE       = #{totDcRate}               --총할인율
              ,TOT_DC_AMT        = #{totDcAmt}                --총할인금액
              ,DC_APPLY_START_DT = #{dcApplyStartDt}          --할인적용시작일자
              ,DC_APPLY_END_DT   = #{dcApplyEndDt}            --할인적용종료일자
              ,DC_SCORE_VAL      = #{dcScoreVal}              --할인순위값
              ,DC_USE_YN         = #{dcUseYn}                 --할인사용여부
              ,UPDT_USR_ID       = #{updtUsrId}               --수정자ID
              ,UPDT_DT           = SYSDATE                  --수정일자
             WHERE 1 = 1
               AND DC_CD             = #{dcCd}                    --할인코드
               AND DLR_CD            = #{dlrCd}                   --딜러코드
	</update>

    <!-- 할인관리 삭제 -->
    <delete id="deleteDcMaster" parameterType="DcMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.deleteDcMaster] */
        DELETE FROM SE_1015T
        WHERE 1 = 1
            AND DC_CD   = #{dcCd}    --할인코드
            AND DLR_CD  = #{dlrCd}   --딜러코드
    </delete>

    <!-- 할인관리 리스트 -->
    <select id="selectDcMasterByCondition" parameterType="DcMasterSearchVO" resultType="DcMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.selectDcMasterByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT * FROM  SE_1015T T1
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        AND DLR_CD = #{sDlrCd}
                    </if>

                    <if test='sDcTp != null and sDcTp != ""'>
                        AND DC_TP = #{sDcTp}
                    </if>

                     <if test='sDcCd != null and sDcCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sDcCd,"*")'>
                                <bind name='sDcCd' value='@org.apache.commons.lang3.StringUtils@replace(sDcCd, "*", "%")' />
                                 AND DC_CD LIKE #{sDcCd}
                            </when>
                            <otherwise>
                                 AND DC_CD = #{sDcCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sDcNm != null and sDcNm != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sDcNm,"*")'>
                                <bind name='sDcNm' value='@org.apache.commons.lang3.StringUtils@replace(sDcNm, "*", "%")' />
                                 AND DC_NM LIKE #{sDcNm}
                            </when>
                            <otherwise>
                                 AND DC_NM = #{sDcNm}
                            </otherwise>
                        </choose>
                    </if>
                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                 <when test='item.field == "dlrCd"'>            T1.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                 <when test='item.field == "dcCd"'>             T1.DC_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                 <when test='item.field == "dcTp"'>             T1.DC_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                 <when test='item.field == "dcNm"'>             T1.DC_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                 <when test='item.field == "lbrDcRate"'>        T1.LBR_DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                 <when test='item.field == "lbrDcAmt"'>         T1.LBR_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                 <when test='item.field == "parDcRate"'>        T1.PAR_DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                 <when test='item.field == "parDcAmt"'>         T1.PAR_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                 <when test='item.field == "subDcRate"'>        T1.SUB_DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                 <when test='item.field == "subDcAmt"'>         T1.SUB_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                 <when test='item.field == "totDcRate"'>        T1.TOT_DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                 <when test='item.field == "totDcAmt"'>         T1.TOT_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                 <when test='item.field == "dcApplyStartDt"'>   T1.DC_APPLY_START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                 <when test='item.field == "dcApplyEndDt"'>     T1.DC_APPLY_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                                 <when test='item.field == "dcScoreVal"'>       T1.DC_SCORE_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                 <when test='item.field == "dcUseYn"'>          T1.DC_USE_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                 <when test='item.field == "regUsrId"'>         T1.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                 <when test='item.field == "regDt"'>            T1.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                 <when test='item.field == "updtUsrId"'>        T1.UPDT_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                 <when test='item.field == "updtDt"'>           T1.UPDT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                 <otherwise>
                                   T1.DLR_CD ASC
                                  ,T1.DC_CD ASC
                                 </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        T1.DLR_CD ASC
                       ,T1.DC_CD ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 할인관리 목록수 -->
    <select id="selectDcMasterByConditionCnt" parameterType="DcMasterSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.selectDcMasterByConditionCnt] */
        SELECT
            COUNT(*) AS VALUE
        FROM SE_1015T
        <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND DLR_CD = #{sDlrCd}
            </if>

            <if test='sDcTp != null and sDcTp != ""'>
                AND DC_TP = #{sDcTp}
            </if>

             <if test='sDcCd != null and sDcCd != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sDcCd,"*")'>
                        <bind name='sDcCd' value='@org.apache.commons.lang3.StringUtils@replace(sDcCd, "*", "%")' />
                         AND DC_CD LIKE #{sDcCd}
                    </when>
                    <otherwise>
                         AND DC_CD = #{sDcCd}
                    </otherwise>
                </choose>
            </if>

            <if test='sDcNm != null and sDcNm != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sDcNm,"*")'>
                        <bind name='sDcNm' value='@org.apache.commons.lang3.StringUtils@replace(sDcNm, "*", "%")' />
                         AND DC_NM LIKE #{sDcNm}
                    </when>
                    <otherwise>
                         AND DC_NM = #{sDcNm}
                    </otherwise>
                </choose>
            </if>
        </where>
    </select>

</mapper>