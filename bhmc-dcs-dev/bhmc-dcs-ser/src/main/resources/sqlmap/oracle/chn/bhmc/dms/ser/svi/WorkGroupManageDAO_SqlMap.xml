<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : WorkGroupManageDAO_SqlMap.xml
    Description : 소조 관리에 관한 데이터처리
    author KyungMok Kim
    since 2016. 02. 23.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 02. 23.  KyungMok Kim     최초 생성
-->

<mapper namespace="chn.bhmc.dms.ser.svi.service.dao.WorkGroupManageDAO">

	<!-- 소조 마스터 등록. -->
	<insert id="insertWorkGroupMaster" parameterType="WorkGroupMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.WorkGroupMasterDAO.insertWorkGroupMaster] */
        INSERT INTO SE_1041T(DLR_CD, WKGRP_NO, WKGRP_NM, MNG_SA_ID, MNG_SA_NM, REG_DT, REG_USR_ID)
        VALUES(#{dlrCd}, #{wkgrpNo}, #{wkgrpNm}, #{mngSaId}, #{mngSaNm}, SYSDATE, #{regUsrId})
	</insert>

	<!-- 소조 마스터  수정. -->
	<update id="updateWorkGroupMaster" parameterType="WorkGroupMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.WorkGroupMasterDAO.updateWorkGroupMaster] */
		UPDATE SE_1041T SET
			WKGRP_NM = #{wkgrpNm}
			,USE_YN = #{useYn}
			,MNG_SA_ID = #{mngSaId}
			,MNG_SA_NM = #{mngSaNm}
            ,UPDT_DT = SYSDATE
            ,UPDT_USR_ID = #{updtUsrId}
		WHERE WKGRP_NO = #{wkgrpNo}
        <if test="dlrCd != null and dlrCd != ''">
            AND DLR_CD = #{dlrCd}
        </if>
	</update>

	<!-- 소조 마스터 삭제. -->
	<delete id="deleteWorkGroupMaster" parameterType="WorkGroupMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.WorkGroupMasterDAO.deleteWorkGroupMaster] */
		DELETE FROM SE_1041T WHERE WKGRP_NO = #{wkgrpNo} AND DLR_CD = #{dlrCd}
	</delete>

	<!-- 소조 마스터 조회1. -->
	<select id="selectWorkGroupMasterByKey" parameterType="WorkGroupManageSearchVO" resultType="WorkGroupMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.WorkGroupMasterDAO.selectWorkGroupMasterByKey] */
		SELECT
            DLR_CD
			,WKGRP_NO
       		,WKGRP_NM
       		,USE_YN
            ,MNG_SA_ID
            ,MNG_SA_NM
       		,REG_DT
       		,REG_USR_ID
            ,UPDT_DT
       		,UPDT_USR_ID
  		FROM SE_1041T
		WHERE WKGRP_NO = #{sWkgrpNo}
        <if test="sDlrCd != null and sDlrCd != ''">
            AND DLR_CD = #{sDlrCd}
        </if>
	</select>

	<!-- 소조 마스터 목록 조회. -->
	<select id="selectWorkGroupMastersByCondition" parameterType="WorkGroupManageSearchVO" resultType="WorkGroupMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.WorkGroupMasterDAO.selectWorkGroupMastersByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
        		SELECT
        			A.DLR_CD
                    ,A.WKGRP_NO
               		,A.WKGRP_NM
               		,A.USE_YN
                    ,A.MNG_SA_ID
                    ,A.MNG_SA_NM
                    ,'02' AS BAY_GRP_TP
               		,A.REG_DT
               		,A.REG_USR_ID
               		,A.UPDT_DT
               		,A.UPDT_USR_ID
          		FROM SE_1041T A
                <where>
                    <if test='sWkgrpNo != null and sWkgrpNo != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sWkgrpNo,"*")'>
                                <bind name='sWkgrpNo' value='@org.apache.commons.lang3.StringUtils@replace(sWkgrpNo, "*", "%")' />
                                AND A.WKGRP_NO LIKE #{sWkgrpNo}
                            </when>
                            <otherwise>
                                 AND A.WKGRP_NO = #{sWkgrpNo}
                            </otherwise>
                        </choose>
                    </if>
                    <if test='sMngSaNm != null and sMngSaNm != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sMngSaNm,"*")'>
                                <bind name='sMngSaNm' value='@org.apache.commons.lang3.StringUtils@replace(sMngSaNm, "*", "%")' />
                                AND A.MNG_SA_NM LIKE #{sMngSaNm}
                            </when>
                            <otherwise>
                                 AND A.MNG_SA_NM = #{sMngSaNm}
                            </otherwise>
                        </choose>
                    </if>
                </where>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
	</select>

	<!-- 소조 마스터 목록수를 조회. -->
	<select id="selectWorkGroupMastersByConditionCnt" parameterType="WorkGroupMasterVO" resultType="int">
        /* [chn.bhmc.dms.ser.svi.service.dao.WorkGroupMasterDAO.selectWorkGroupMastersByConditionCnt] */
		SELECT
			COUNT(*) AS VALUE
		FROM SE_1041T A
        <where>
            <if test='sWkgrpNo != null and sWkgrpNo != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sWkgrpNo,"*")'>
                        <bind name='sWkgrpNo' value='@org.apache.commons.lang3.StringUtils@replace(sWkgrpNo, "*", "%")' />
                        AND WKGRP_NO LIKE #{sWkgrpNo}
                    </when>
                    <otherwise>
                         AND WKGRP_NO = #{sWkgrpNo}
                    </otherwise>
                </choose>
            </if>
            <if test='sMngSaNm != null and sMngSaNm != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sMngSaNm,"*")'>
                        <bind name='sMngSaNm' value='@org.apache.commons.lang3.StringUtils@replace(sMngSaNm, "*", "%")' />
                        AND A.MNG_SA_NM LIKE #{sMngSaNm}
                    </when>
                    <otherwise>
                         AND A.MNG_SA_NM = #{sMngSaNm}
                    </otherwise>
                </choose>
            </if>
        </where>
	</select>

    <!-- 소조 상세 등록. -->
    <insert id="insertWorkGroupDetail" parameterType="WorkGroupDetailVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.WorkGroupDetailDAO.insertWorkGroupDetail] */
        INSERT INTO SE_1042T( DLR_CD, WKGRP_NO, LINE_NO, TEC_ID, TEC_NM, REG_USR_ID, REG_DT )
        VALUES ( #{dlrCd}, #{wkgrpNo}, #{lineNo}, #{tecId}, #{tecNm}, #{regUsrId}, SYSDATE )
    </insert>

    <!-- 소조 상세  수정. -->
    <update id="updateWorkGroupDetail" parameterType="WorkGroupDetailVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.WorkGroupDetailDAO.updateWorkGroupDetail] */
        UPDATE SE_1042T SET
            LINE_NO = #{lineNo}
            ,TEC_ID = #{tecId}
            ,TEC_NM = #{tecNm}
            ,UPDT_USR_ID = #{regUsrId}
        WHERE WKGRP_NO = #{wkgrpNo}
        AND DLR_CD = #{dlrCd}
        AND LINE_NO = #{lineNo}
    </update>

    <!-- 소조 상세 삭제. -->
    <delete id="deleteWorkGroupDetail" parameterType="WorkGroupDetailVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.WorkGroupDetailDAO.deleteWorkGroupDetail] */
        DELETE FROM SE_1042T
        WHERE WKGRP_NO = #{wkgrpNo}
        AND DLR_CD = #{dlrCd}
        AND LINE_NO = #{lineNo}
    </delete>

    <!-- 소조 상세 목록 조회. -->
    <select id="selectWorkGroupDetailsByCondition" parameterType="WorkGroupManageSearchVO" resultType="WorkGroupDetailVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.WorkGroupDetailDAO.selectWorkGroupDetailsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                    DLR_CD,
                    WKGRP_NO,
                    LINE_NO,
                    TEC_ID,
                    TEC_NM
                FROM SE_1042T
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        DLR_CD = #{sDlrCd}
                    </if>
                    <if test='sWkgrpNo != null and sWkgrpNo != ""'>
                        AND WKGRP_NO = #{sWkgrpNo}
                    </if>
                </where>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 소조 상세 목록 조회. -->
    <select id="selectWorkGroupDetailsByConditionCnt" parameterType="WorkGroupManageSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.svi.service.dao.WorkGroupDetailDAO.selectWorkGroupDetailsByConditionCnt] */
        SELECT COUNT(*)
        FROM SE_1042T
        <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                DLR_CD = #{sDlrCd}
            </if>
            <if test='sWkgrpNo != null and sWkgrpNo != ""'>
                AND WKGRP_NO = #{sWkgrpNo}
            </if>
        </where>
    </select>

</mapper>