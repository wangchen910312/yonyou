<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : ClaimPioItemManageDAO_SqlMap.xml
    Description : PIO 부품 마스터에 관한 데이터처리
    author Yin Xueyuan
    since 2016. 5. 6.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 5. 6.  Yin Xueyuan      최초 생성
-->

<mapper namespace="chn.bhmc.dms.ser.svi.service.dao.ClaimPioItemManageDAO">

    <!-- PIO 부품 등록-->
    <insert id="insertClaimPioItemManage" parameterType="ClaimPioItemVO">
     /* [chn.bhmc.dms.ser.svi.service.dao.ClaimPioItemManageDAO.insertClaimPioItemManage] */

         INSERT INTO SE_0714T
            (
              LINE_NO            --라인번호
             ,ITEM_CD            --품목코드
             ,ITEM_NM            --품목명
             ,USE_YN             --사용여부
             ,REG_USR_ID         --등록자ID
             ,REG_DT             --등록일
            )
            VALUES
            (
              (SELECT NVL(MAX(LINE_NO),0) +1
                 FROM SE_0714T
               )            --라인번호
             ,#{itemCd}            --품목코드
             ,#{itemNm}            --품목명
             ,#{useYn}             --사용여부
             ,#{regUsrId}          --등록자ID
             ,sysdate              --등록일
            )
    </insert>

    <!-- PIO 부품  수정 -->
    <update id="updateClaimPioItemManage" parameterType="ClaimPioItemVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.ClaimPioItemManageDAO.updateClaimOldItemManage] */

       UPDATE SE_0714T    --PIO 부품 마스터 테이블
          SET
               ITEM_NM     = #{itemNm}            --품목명
              ,ITEM_CD     = #{itemCd}            --품목코드
              ,USE_YN      = #{useYn}             --사용여부
              ,UPDT_USR_ID = #{updtUsrId}         --수정자ID
              ,UPDT_DT     = sysdate            --수정일자
         WHERE 1 = 1
           AND LINE_NO     = #{lineNo}            --라인번호

    </update>

    <!-- PIO 부품  삭제 -->
    <delete id="deleteClaimPioItemManage" parameterType="ClaimPioItemVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.ClaimPioItemManageDAO.deleteClaimPioItemManage] */

       DELETE FROM  SE_0714T    --PIO 부품 마스터 테이블
        WHERE 1 = 1
          AND LINE_NO     = #{lineNo}            --라인번호

    </delete>

    <!-- PIO 부품  리스트  수-->
    <select id="selectClaimPioItemManageByConditionCnt" parameterType="ClaimPioItemSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.svi.service.dao.ClaimPioItemManageDAO.selectClaimPioItemManageByConditionCnt] */


            SELECT COUNT(LINE_NO) AS VALUE
              FROM SE_0714T    --PIO 부품 마스터 테이블
             <where>
               <if test='sItemCd != null and sItemCd != ""'>
               AND ITEM_CD    LIKE '%' || #{sItemCd} || '%'                --품목코드
               </if>
               <if test='sItemNm != null and sItemNm != ""'>
                  AND ITEM_NM LIKE '%' || #{sItemNm} || '%' --품목명
               </if>
               <if test='sUseYn != null and sUseYn != ""'>
               AND USE_YN      = #{sUseYn}                 --사용여부
               </if>
             </where>

    </select>

    <!-- PIO 부품  리스트 -->
    <select id="selectClaimPioItemManageByCondition" parameterType="ClaimPioItemSearchVO" resultType="ClaimPioItemVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.ClaimPioItemManageDAO.selectClaimPioItemManageByCondition] */

        SELECT * FROM (
             SELECT ROWNUM AS RNUM, T1.*
               FROM (
                      SELECT
                            LINE_NO            --라인번호
                           ,ITEM_CD            --품목코드
                           ,ITEM_NM            --품목명
                           ,USE_YN             --사용여부
                           ,UPDT_DT
                           ,UPDT_USR_ID
                      FROM SE_0714T    --PIO 부품 마스터 테이블
                     <where>
                       <if test='sItemCd != null and sItemCd != ""'>
                       AND ITEM_CD     = #{sItemCd}                --품목코드
                       </if>
                       <if test='sItemNm != null and sItemNm != ""'>
                          AND ITEM_NM LIKE '%' || #{sItemNm} || '%' --품목명
                       </if>
                       <if test='sUseYn != null and sUseYn != ""'>
                       AND USE_YN      = #{sUseYn}                 --사용여부
                       </if>
                     </where>
                     ORDER BY
                     <choose>
                         <when test='sort != null'>
                             <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                 <choose>
                                     <when test='item.field == "lineNo"'>     LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                     <when test='item.field == "itemCd"'>     ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                     <when test='item.field == "itemNm"'>     ITEM_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                     <when test='item.field == "useYn"'>      USE_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                     <otherwise>
                                       LINE_NO ASC
                                     </otherwise>
                                 </choose>
                             </foreach>
                         </when>
                         <otherwise>
                           LINE_NO ASC
                         </otherwise>
                     </choose>
                     ) T1
                <where>
                    <if test='firstIndex != -1 and lastIndex != -1'>
                        ROWNUM <![CDATA[<=]]> #{lastIndex}
                    </if>
                </where>
            )
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM > #{firstIndex}
                </if>
            </where>
    </select>


     <!-- 고품 데이타 TEMP로 전송. : 프로시져  -->
    <insert id="insertClaimToTemp" parameterType="ClaimOldItemManageVO" statementType="CALLABLE">
        {CALL SP_SER_CLAIM_OLDITEM_REQ(
               #{dlrCd, mode=IN, jdbcType=VARCHAR}
              ,#{vinNo, mode=IN, jdbcType=VARCHAR}
              ,#{claimDocNo, mode=IN, jdbcType=VARCHAR}
              ,#{atqReqNo, mode=IN, jdbcType=VARCHAR}
              ,#{seq, mode=IN, jdbcType=VARCHAR}
              ,#{itemCd, mode=IN, jdbcType=VARCHAR}
        )}
    </insert>


</mapper>