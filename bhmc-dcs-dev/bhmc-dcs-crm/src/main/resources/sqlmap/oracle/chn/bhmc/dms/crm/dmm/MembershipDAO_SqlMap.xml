<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : MembershipDAO_SqlMap.xml
    Description : 멤버십
    author Hyun Ho Kim
    since 2016. 03. 22.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 03. 22.    Hyun Ho Kim    최초 생성
-->

<mapper namespace="chn.bhmc.dms.crm.dmm.service.dao.MembershipDAO">

    <sql id="searchMembership">
        <where>
            AND     CR_0801T.DLR_CD = #{sDlrCd}
            <if test='sCustNo != null and sCustNo != ""'>
                AND     CR_0801T.CUST_NO = #{sCustNo}
            </if>
            <if test='sVinNo != null and sVinNo != ""'>
                <bind name='sVinNo' value='@org.apache.commons.lang3.StringUtils@replace(sVinNo, "*", "%")' />
                AND     CR_0801T.VIN_NO LIKE #{sVinNo}
            </if>
            <choose>

                <when test='(sStartDt != null) and (sEndDt != null)'>
                    <!-- AND     (TO_CHAR(CR_0801T.REG_DT,'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sStartDt},'YYYYMMDD') AND TO_CHAR(CR_0801T.REG_DT,'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sEndDt},'YYYYMMDD')) -->
                    AND     (CR_0801T.REG_DT <![CDATA[>=]]> #{sStartDt} AND CR_0801T.REG_DT <![CDATA[<=]]> #{sEndDt})
                </when>
                <when test='(sStartDt != null) and (sEndDt == null)'>
                    <!-- AND     TO_CHAR(CR_0801T.REG_DT,'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sStartDt},'YYYYMMDD') -->
                    AND     CR_0801T.REG_DT <![CDATA[>=]]> #{sStartDt}
                </when>

                <when test='(sStartDt == null) and (sEndDt != null)'>
                    <!-- AND     TO_CHAR(CR_0801T.REG_DT,'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sEndDt},'YYYYMMDD') -->
                    AND     CR_0801T.REG_DT <![CDATA[<=]]> #{sEndDt}
                </when>
                <otherwise>
                </otherwise>
            </choose>
        </where>
    </sql>

    <sql id="searchMembershipPopup">
        <where>
            <choose>
                <when test='sMembershipNo != null and sMembershipNo != ""'>
                    AND     T2.MEMBERSHIP_NO = #{sMembershipNo}
                </when>
                <when test='sCustNm != null and sCustNm != ""'>
                    <choose>
                        <when test='@org.apache.commons.lang3.StringUtils@contains(sCustNm,"*")'>
                            <bind name='sCustNm' value='@org.apache.commons.lang3.StringUtils@replace(sCustNm, "*", "%")' />
                            AND     T3.CUST_NM LIKE #{sCustNm}
                        </when>
                        <otherwise>
                            AND     T3.CUST_NM = #{sCustNm}
                        </otherwise>
                    </choose>
                </when>
                <when test='sVinNo != null and sVinNo != ""'>

                    <choose>
                        <when test='@org.apache.commons.lang3.StringUtils@contains(sVinNo,"*")'>
                            <bind name='sVinNo' value='@org.apache.commons.lang3.StringUtils@replace(sVinNo, "*", "%")' />
                            AND     T2.VIN_NO LIKE #{sVinNo}
                        </when>
                        <otherwise>
                            AND     T2.VIN_NO = #{sVinNo}
                        </otherwise>
                    </choose>
                </when>
                <otherwise>
                </otherwise>
            </choose>
        </where>
    </sql>

    <insert id="insertMembership"  parameterType="MembershipVO">
    /* [chn.bhmc.dms.crm.cmm.service.dao.MembershipDAO.insertMembership] */
        INSERT INTO CR_0801T    --멤버십 마스터
        (
            DLR_CD             --딜러코드
            ,MEMBERSHIP_NO                --일련번호
            ,CUST_NO            --고객번호
            ,VIN_NO             --차대번호
            ,GRADE_CD           --멤버십 회원등급
            ,FILE_DOC_NO        --첨부문서번호
            ,POINT_YN           --포인트식 가입여부
            ,RECHARGE_YN        --충전식 가입여부
            ,RECHARGE_CD        --상품선택코드
            ,REG_USR_ID         --등록자ID
            ,REG_DT             --등록일자
        )
        VALUES
        (
            #{dlrCd}             --딜러코드
            ,#{membershipNo}      --일련번호
            ,#{custNo}            --고객번호
            ,#{vinNo}             --차대번호
            ,#{gradeCd}           --멤버십 회원등급
            ,#{fileDocNo}         --첨부문서번호
            ,#{pointYn}           --포인트식 가입여부
            ,#{rechargeYn}        --충전식 가입여부
            ,#{rechargeCd}        --상품선택코드
            ,#{regUsrId}          --등록자ID
            ,SYSDATE             --등록일자
        )
    </insert>

    <insert id="updateMembership"  parameterType="MembershipVO">
    /* [chn.bhmc.dms.crm.cmm.service.dao.MembershipDAO.updateMembership] */
        UPDATE  CR_0801T    --멤버십 마스터
        SET     GRADE_CD = #{gradeCd}
                ,FILE_DOC_NO = #{fileDocNo}
                ,UPDT_USR_ID = #{updtUsrId}
                ,UPDT_DT = SYSDATE
        WHERE   DLR_CD = #{dlrCd}
        AND     MEMBERSHIP_NO = #{membershipNo}
    </insert>

    <!-- 멤버십 관리 목록수를 조회한다. -->
    <select id="selectMembershipsByConditionCnt" parameterType="MembershipSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.cmm.service.dao.MembershipDAO.selectMembershipsByConditionCnt] */
        SELECT  COUNT(*) AS VALUE
        FROM    CR_0801T CR_0801T INNER JOIN CR_0101T CR_0101T
                ON CR_0801T.DLR_CD = CR_0101T.DLR_CD
                AND CR_0801T.CUST_NO = CR_0101T.CUST_NO
                LEFT OUTER JOIN CR_0813T CR_0813T
                ON CR_0801T.DLR_CD = CR_0813T.DLR_CD
                AND CR_0801T.MEMBERSHIP_NO = CR_0813T.MEMBERSHIP_NO
                AND CR_0813T.USE_YN = 'Y'
                AND CR_0813T.CARD_TP_CD = '01'
                LEFT OUTER JOIN (
                    SELECT SA_0201T.DLR_CD
                        ,SA_0201T.CONTRACT_CUST_NO
                        ,SA_0121T.VIN_NO
                        ,SA_0121T.NCAR_DSTIN_CD --신차량구분코드
                        ,SA_0201T.CARLINE_CD--차종코드
                        ,FN_GET_CARLINE_NM(SA_0201T.CARLINE_CD) AS CARLINE_NM --차종코드명
                        ,FN_GET_CARLINE_NM_NC(SA_0201T.CARLINE_CD) AS CARLINE_NM_NC --차종코드명
                        ,SA_0201T.MODEL_CD -- 모델코드
                        ,FN_GET_MODEL_NM(SA_0201T.MODEL_CD) AS MODEL_NM --모델코드명
                        ,FN_GET_MODEL_NM_NC(SA_0201T.MODEL_CD) AS MODEL_NM_NC --모델코드명
                        ,SA_0121T.CAR_NM -- 차량명
                        ,SA_0121T.CAR_REG_NO -- 차량등록번호
                    FROM  SA_0121T SA_0121T INNER JOIN SA_0201T SA_0201T
                        ON SA_0121T.CONTRACT_NO = SA_0201T.CONTRACT_NO
                        AND SA_0121T.DEL_YN = 'N'
                    WHERE 1=1
                    <if test='sCustNo != null and sCustNo != ""'>
                      AND SA_0201T.CONTRACT_CUST_NO = #{sCustNo}
                    </if>
                    <if test='sVinNo != null and sVinNo != ""'>
                      <choose>
                          <when test='@org.apache.commons.lang3.StringUtils@contains(sVinNo,"*")'>
                              <bind name='sVinNo' value='@org.apache.commons.lang3.StringUtils@replace(sVinNo, "*", "%")' />
                              AND     SA_0121T.VIN_NO LIKE #{sVinNo}
                          </when>
                          <otherwise>
                              AND     SA_0121T.VIN_NO = #{sVinNo}
                          </otherwise>
                      </choose>
                    </if>
                ) CAR_INFO
                ON CR_0801T.DLR_CD = CAR_INFO.DLR_CD
                AND CR_0801T.CUST_NO = CAR_INFO.CONTRACT_CUST_NO
        <include refid="searchMembership" />
    </select>

    <!-- 멤버십 관리 정보 목록을 조회한다. -->
    <select id="selectMembershipsByCondition" parameterType="MembershipSearchVO" resultType="MembershipVO">
        /* [chn.bhmc.dms.crm.cmm.service.dao.MembershipDAO.selectMembershipsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                    SELECT CR_0801T.DLR_CD
                          ,CR_0801T.MEMBERSHIP_NO
                          ,CR_0813T.CARD_TP_CD
                          ,CR_0813T.CARD_NO
                          ,CR_0801T.CUST_NO
                          ,CR_0801T.VIN_NO
                          ,CR_0801T.GRADE_CD
                          ,CR_0801T.FILE_DOC_NO
                          ,CR_0801T.POINT_YN
                          ,CR_0801T.RECHARGE_YN
                          ,CR_0801T.REG_DT
                          ,CR_0801T.LAST_POINT_VAL
                          ,CR_0101T.CUST_NM
                          ,CR_0101T.CUST_CD
                          ,CR_0101T.CUST_TP
                          ,CR_0101T.SSN_CRN_NO
                          ,CR_0101T.EMAIL_NM
                          ,CR_0101T.PREF_COMM_MTH_CD
                          ,CR_0101T.PREF_COMM_NO
                          ,CR_0101T.PREF_CONTACT_MTH_CD
                          ,CR_0101T.PREF_CONTACT_TIME_CD
                          ,CR_0101T.HP_NO
                          ,CR_0101T.TEL_NO
                          ,CR_0101T.MATH_DOC_TP
                          ,CR_0101T.OFFICE_NO
                          --,CAR_INFO.VIN_NO
                          ,CAR_INFO.NCAR_DSTIN_CD
                          ,CAR_INFO.CARLINE_CD
                          ,CAR_INFO.CARLINE_NM
                          ,CAR_INFO.CARLINE_NM_NC
                          ,CAR_INFO.MODEL_CD
                          ,CAR_INFO.MODEL_NM
                          ,CAR_INFO.MODEL_NM_NC
                          ,CAR_INFO.CAR_NM
                          ,CAR_INFO.CAR_REG_NO
                    FROM  CR_0801T CR_0801T INNER JOIN CR_0101T CR_0101T
                          ON CR_0801T.DLR_CD = CR_0101T.DLR_CD
                          AND CR_0801T.CUST_NO = CR_0101T.CUST_NO
                          LEFT OUTER JOIN CR_0813T CR_0813T
                          ON CR_0801T.DLR_CD = CR_0813T.DLR_CD
                          AND CR_0801T.MEMBERSHIP_NO = CR_0813T.MEMBERSHIP_NO
                          AND CR_0813T.USE_YN = 'Y'
                          AND CR_0813T.CARD_TP_CD = '01'
                          LEFT OUTER JOIN (
                            SELECT SA_0201T.DLR_CD
                                  ,SA_0201T.CONTRACT_CUST_NO
                                  ,SA_0121T.VIN_NO
                                  ,SA_0121T.NCAR_DSTIN_CD --신차량구분코드
                                  ,SA_0201T.CARLINE_CD--차종코드
                                  ,FN_GET_CARLINE_NM(SA_0201T.CARLINE_CD) AS CARLINE_NM --차종코드명
                                  ,FN_GET_CARLINE_NM_NC(SA_0201T.CARLINE_CD) AS CARLINE_NM_NC --차종코드명
                                  ,SA_0201T.MODEL_CD -- 모델코드
                                  ,FN_GET_MODEL_NM(SA_0201T.MODEL_CD) AS MODEL_NM --모델코드명
                                  ,FN_GET_MODEL_NM_NC(SA_0201T.MODEL_CD) AS MODEL_NM_NC --모델코드명
                                  ,SA_0121T.CAR_NM -- 차량명
                                  ,SA_0121T.CAR_REG_NO -- 차량등록번호
                            FROM  SA_0121T SA_0121T INNER JOIN SA_0201T SA_0201T
                                  ON SA_0121T.CONTRACT_NO = SA_0201T.CONTRACT_NO
                                  AND SA_0121T.DEL_YN = 'N'
                            WHERE 1=1
                            <if test='sCustNo != null and sCustNo != ""'>
                                AND SA_0201T.CONTRACT_CUST_NO = #{sCustNo}
                            </if>
                            <if test='sVinNo != null and sVinNo != ""'>
                                <choose>
                                    <when test='@org.apache.commons.lang3.StringUtils@contains(sVinNo,"*")'>
                                        <bind name='sVinNo' value='@org.apache.commons.lang3.StringUtils@replace(sVinNo, "*", "%")' />
                                        AND     SA_0121T.VIN_NO LIKE #{sVinNo}
                                    </when>
                                    <otherwise>
                                        AND     SA_0121T.VIN_NO = #{sVinNo}
                                    </otherwise>
                                </choose>
                            </if>
                          ) CAR_INFO
                          ON CR_0801T.DLR_CD = CAR_INFO.DLR_CD
                          AND CR_0801T.CUST_NO = CAR_INFO.CONTRACT_CUST_NO
                          AND CR_0801T.VIN_NO = CAR_INFO.VIN_NO
                    <include refid="searchMembership" />
                    ORDER BY
                    <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                    <when test='item.field == "custNm"'>CR_0101T.CUST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "gradeCd"'>CR_0801T.GRADE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "vinNo"'>CR_0801T.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custCd"'>CR_0101T.CUST_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custTp"'>CR_0101T.CUST_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "hpNo"'>CR_0101T.HP_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "telNo"'>CR_0101T.TEL_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regDt"'>CR_0101T.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <otherwise>
                                        MEMBERSHIP_NO ASC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            MEMBERSHIP_NO ASC
                        </otherwise>
                    </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 멤버십 관리 목록수를 조회한다. -->
    <select id="selectMembershipsPopupByConditionCnt" parameterType="MembershipSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.cmm.service.dao.MembershipDAO.selectMembershipsPopupByConditionCnt] */
        SELECT  COUNT(*) AS VALUE
        FROM  CR_0801T T2 LEFT OUTER JOIN CR_0101T T3
              ON    T2.DLR_CD = T3.DLR_CD
              AND   T2.CUST_NO = T3.CUST_NO
              LEFT OUTER JOIN (
                    SELECT T4.DLR_CD
                          ,T5.CONTRACT_CUST_NO
                          ,T4.VIN_NO
                          ,T4.NCAR_DSTIN_CD --신차량구분코드
                          ,T5.CARLINE_CD--차종코드
                          ,FN_GET_CARLINE_NM(T5.CARLINE_CD) AS CARLINE_NM --차종코드명
                          ,FN_GET_CARLINE_NM_NC(T5.CARLINE_CD) AS CARLINE_NM_NC --차종코드명
                          ,T5.MODEL_CD -- 모델코드
                          ,FN_GET_MODEL_NM(T5.MODEL_CD) AS MODEL_NM --모델코드명
                          ,FN_GET_MODEL_NM_NC(T5.MODEL_CD) AS MODEL_NM_NC --모델코드명
                          ,T4.CAR_NM -- 차량명
                          ,T4.CAR_REG_NO -- 차량등록번호
                    FROM  SA_0121T T4 INNER JOIN SA_0201T T5
                          ON T4.CONTRACT_NO = T5.CONTRACT_NO
                          AND T4.DEL_YN = 'N'
              ) CAR_INFO
        ON T2.DLR_CD = CAR_INFO.DLR_CD
        AND T2.CUST_NO = CAR_INFO.CONTRACT_CUST_NO
        <include refid="searchMembershipPopup" />
    </select>

    <!-- 멤버십 관리 정보 목록을 조회한다. -->
    <select id="selectMembershipsPopupByCondition" parameterType="MembershipSearchVO" resultType="MembershipVO">
        /* [chn.bhmc.dms.crm.cmm.service.dao.MembershipDAO.selectMembershipsPopupByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                    SELECT T2.DLR_CD
                          ,T2.MEMBERSHIP_NO
                          ,T2.CUST_NO
                          ,T2.VIN_NO
                          ,T2.GRADE_CD
                          ,T2.FILE_DOC_NO
                          ,T2.POINT_YN
                          ,T2.RECHARGE_YN
                          ,T2.REG_DT
                          ,NVL(T2.LAST_POINT_VAL,0) AS LAST_POINT_VAL
                          ,T3.CUST_NM
                          ,T3.CUST_CD
                          ,T3.CUST_TP
                          ,T3.SSN_CRN_NO
                          ,T3.EMAIL_NM
                          ,T3.PREF_COMM_MTH_CD
                          ,T3.PREF_COMM_NO
                          ,T3.PREF_CONTACT_MTH_CD
                          ,T3.PREF_CONTACT_TIME_CD
                          ,T3.HP_NO
                          ,T3.TEL_NO
                          ,T3.MATH_DOC_TP
                          ,T3.OFFICE_NO
                          ,CAR_INFO.NCAR_DSTIN_CD
                          ,CAR_INFO.CARLINE_CD
                          ,CAR_INFO.CARLINE_NM
                          ,CAR_INFO.CARLINE_NM_NC
                          ,CAR_INFO.MODEL_CD
                          ,CAR_INFO.MODEL_NM
                          ,CAR_INFO.MODEL_NM_NC
                          ,CAR_INFO.CAR_NM
                          ,CAR_INFO.CAR_REG_NO
                    FROM  CR_0801T T2 LEFT OUTER JOIN CR_0101T T3
                          ON    T2.DLR_CD = T3.DLR_CD
                          AND   T2.CUST_NO = T3.CUST_NO
                          LEFT OUTER JOIN (
                                SELECT T4.DLR_CD
                                      ,T5.CONTRACT_CUST_NO
                                      ,T4.VIN_NO
                                      ,T4.NCAR_DSTIN_CD --신차량구분코드
                                      ,T5.CARLINE_CD--차종코드
                                      ,FN_GET_CARLINE_NM(T5.CARLINE_CD) AS CARLINE_NM --차종코드명
                                      ,FN_GET_CARLINE_NM_NC(T5.CARLINE_CD) AS CARLINE_NM_NC --차종코드명
                                      ,T5.MODEL_CD -- 모델코드
                                      ,FN_GET_MODEL_NM(T5.MODEL_CD) AS MODEL_NM --모델코드명
                                      ,FN_GET_MODEL_NM_NC(T5.MODEL_CD) AS MODEL_NM_NC --모델코드명
                                      ,T4.CAR_NM -- 차량명
                                      ,T4.CAR_REG_NO -- 차량등록번호
                                FROM  SA_0121T T4 INNER JOIN SA_0201T T5
                                      ON T4.CONTRACT_NO = T5.CONTRACT_NO
                                      AND T4.DEL_YN = 'N'
                          ) CAR_INFO
                    ON T2.DLR_CD = CAR_INFO.DLR_CD
                    AND T2.CUST_NO = CAR_INFO.CONTRACT_CUST_NO
                    AND T2.VIN_NO = CAR_INFO.VIN_NO
                    <include refid="searchMembershipPopup" />
                    ORDER BY
                    <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                    <when test='item.field == "custNm"'>T3.CUST_NM ${item.custNm}</when>
                                    <when test='item.field == "gradeCd"'>T2.GRADE_CD ${item.gradeCd}</when>
                                    <when test='item.field == "vinNo"'>T2.VIN_NO ${item.vinNo}</when>
                                    <when test='item.field == "custCd"'>T3.CUST_CD ${item.custCd}</when>
                                    <when test='item.field == "custTp"'>T3.CUST_TP ${item.custTp}</when>
                                    <when test='item.field == "hpNo"'>T3.HP_NO ${item.hpNo}</when>
                                    <when test='item.field == "telNo"'>T3.TEL_NO ${item.telNo}</when>
                                    <when test='item.field == "regDt"'>T3.REG_DT ${item.regDt}</when>
                                    <otherwise>
                                        MEMBERSHIP_NO ASC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            MEMBERSHIP_NO ASC
                        </otherwise>
                    </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <select id="selectMembershipJoinUserCnt" parameterType="MembershipSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.cmm.service.dao.MembershipDAO.selectMembershipJoinUserCnt] */
        SELECT  COUNT(*) AS VALUE
        FROM    CR_0801T
        WHERE   DLR_CD = #{sDlrCd}
        <if test='sStan == "01"'>
        AND     CUST_NO = #{sCustNo}
        </if>
        <if test='sStan == "02"'>
        AND     VIN_NO = #{sVinNo}
        </if>
    </select>

    <update id="updateMembershipGradeChg"  parameterType="MembershipGradeChgVO">
        UPDATE  CR_0801T
        SET     GRADE_CD = #{aftGradeCd}
                ,UPDT_USR_ID = #{updtUsrId}
                ,UPDT_DT = SYSDATE
        WHERE   DLR_CD = #{dlrCd}
        AND     MEMBERSHIP_NO = #{membershipNo}
    </update>

    <select id="selectMembershipInfoByKey" parameterType="MembershipSearchVO" resultType="MembershipVO">
        SELECT  A.DLR_CD
                ,A.MEMBERSHIP_NO
                ,B.CARD_TP_CD
                ,B.CARD_NO
                ,A.CUST_NO
                ,A.VIN_NO
                ,A.GRADE_CD
                ,A.FILE_DOC_NO
                ,A.POINT_YN
                ,A.RECHARGE_YN
                ,A.RECHARGE_CD
        FROM    CR_0801T A LEFT OUTER JOIN CR_0813T B
                ON A.DLR_CD = B.DLR_CD
                AND A.MEMBERSHIP_NO = B.MEMBERSHIP_NO
        WHERE   A.DLR_CD = #{sDlrCd}
        AND     B.CARD_TP_CD = '01'
        <if test='sMembershipNo != null and sMembershipNo != ""'>
            AND A.MEMBERSHIP_NO = #{sMembershipNo}
        </if>
        <if test='sCustNo != null and sCustNo != ""'>
            AND A.CUST_NO = #{sCustNo}
        </if>
        <if test='sVinNo != null and sVinNo != ""'>
            AND A.VIN_NO = #{sVinNo}
        </if>

    </select>

</mapper>