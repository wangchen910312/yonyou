<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : MarketingCampaignDAO_SqlMap.xml
    Description : 마케팅 캠페인에 관한 데이터처리
    author hyoung jun an
    since 2016. 03. 04.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016.03.04     hyoung jun an    최초 생성
-->

<mapper namespace="chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO">

    <!-- 마케팅 캠페인 정보를 등록한다. -->
    <insert id="insertMarketingCampaign" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.insertMarketingCampaign] */
        INSERT INTO CR_1101T    --마케팅캠페인마스터
        (
         DLR_CD                    --딜러코드
        ,MAK_CD                    --마케팅코드
        ,MAK_NM                    --마케팅명
        ,HOST_CD                   --주최코드
        ,HOST_TEAM_CD              --주최팀코드
        ,MAK_TP_CD                 --마케팅유형코드
        ,MAK_SUB_TP_CD             --마케팅서브유형코드
        ,RCPE_NM                   --대상자명
        ,START_DT                  --시작일자
        ,END_DT                    --종료일자
        ,PRID                      --기간
        ,PLACE_NM                  --장소명
        ,RCPE_AUTO_YN              --대상자자동추출여부
        ,AAP_CMP_NM                --대행업체명
        ,BUDGET_AMT                --예산금액
        ,STAT_CD                   --상태코드
        ,TARG_CUST_CNT             --목표고객수
        ,PGSS_RATE                 --진도율
        ,ACTIVE_NM                 --활동명
        ,ACTIVE_CONT               --활동내용
        ,AD_INVT_HM                --광고투자시간
        ,AD_MEDIA_CD               --광고매체코드
        ,AD_COST_AMT               --광고비용금액
        ,AD_START_DT               --광고시작일자
        ,AD_END_DT                 --광고종료일자
        ,DEL_YN                    --삭제여부
        ,MAK_CONT                  --마케팅내용
        ,CRE_START_DT              --생산시작일자
        ,CRE_END_DT                --생산종료일자
        ,SALE_START_DT             --판매시작일자
        ,SALE_END_DT               --판매종료일자
        ,CR_END_TP                 --캠페인리콜종료여부
        ,PC_DSTIN_CD               --승상용구분코드
        ,CR_ISA_NM                 --캠페인리콜시행처명
        ,REG_USR_ID                --등록자ID
        ,REG_DT                    --등록일자
        )
        VALUES
        (
         #{dlrCd}                    --딜러코드
        ,#{makCd}                    --마케팅코드
        ,#{makNm}                    --마케팅명
        ,#{hostCd}                   --주최코드
        ,#{hostTeamCd}               --주최팀코드
        ,#{makTpCd}                  --마케팅유형코드
        ,#{makSubTpCd}               --마케팅서브유형코드
        ,#{rcpeNm}                   --대상자명
        ,#{startDt}                  --시작일자
        ,#{endDt}                    --종료일자
        ,#{prid}                     --기간
        ,#{placeNm}                  --장소명
        ,#{rcpeAutoYn}               --대상자자동추출여부
        ,#{aapCmpNm}                 --대행업체명
        ,#{budgetAmt}                --예산금액
        ,'01'                        --상태코드
        ,#{targCustCnt}              --목표고객수
        ,#{pgssRate}                 --진도율
        ,#{activeNm}                 --활동명
        ,#{activeCont}               --활동내용
        ,#{adInvtHm}                 --광고투자시간
        ,#{adMediaCd}                --광고매체코드
        ,#{adCostAmt}                --광고비용금액
        ,#{adStartDt}                --광고시작일자
        ,#{adEndDt}                  --광고종료일자
        ,#{delYn}                    --삭제여부
        ,#{makCont}                  --마케팅내용
        ,#{creStartDt}               --생산시작일자
        ,#{creEndDt}                 --생산종료일자
        ,#{saleStartDt}              --판매시작일자
        ,#{saleEndDt}                --판매종료일자
        ,#{crEndTp}                  --캠페인리콜종료여부
        ,#{pcDstinCd}                --승상용구분코드
        ,#{crIsaNm}                  --캠페인리콜시행처명
        ,#{regUsrId}                 --등록자ID
        ,SYSDATE                     --등록일자
        )
    </insert>


    <!-- 마케팅 캠페인 신규저장시 기본목표를 등록한다. -->
    <insert id="insertDefaultGoal" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.insertDefaultTarget] */
        INSERT INTO CR_1111T    --마케팅캠페인목표
        (
         DLR_CD               --딜러코드
        ,MAK_CD               --마케팅코드
        ,SEQ                  --일련번호
        ,TARG_CD              --목표코드
        ,TARG_NM              --목표명
        ,TARG_CNT_VAL         --목표수치값
        ,TARG_RSLT_VAL        --목표결과값
        ,REG_USR_ID           --등록자ID
        ,REG_DT               --등록일자
        ,UPDT_USR_ID          --수정자ID
        ,UPDT_DT              --수정일자
        )
        SELECT  #{dlrCd}             --딜러코드
               ,#{makCd}             --마케팅코드
               ,SEQ_CR_1111T.NEXTVAL --순번
               ,CMM_CD               --기본목표코드
               ,CMM_CD_NM            --기본목표명
               ,0                    --목표수치값
               ,0                    --목표결과값
               ,#{regUsrId}          --등록자ID
               ,SYSDATE              --등록일자
               ,#{updtUsrId}         --수정자ID
               ,SYSDATE              --수정일자
          FROM (
                SELECT A.CMM_CD,
                       NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM
                  FROM CM_0303T A, CM_0304T B
                WHERE A.CMM_GRP_CD = B.CMM_GRP_CD
                  AND A.CMM_CD = B.CMM_CD
                  AND B.LANG_CD = 'zh'
                  AND A.CMM_GRP_CD = 'CRM712'
                  AND A.USE_YN = 'Y'
            <choose>
                <when test='makTpCd eq "01"'>
                    AND A.REMARK1 LIKE '%BR%'
                </when>
                <when test='makTpCd eq "02"'>
                    AND A.REMARK1 LIKE '%SA%'
                </when>
                <when test='makTpCd eq "03"'>
                    AND A.REMARK1 LIKE '%SE%'
                </when>
            </choose>

                ORDER BY A.SORT_ORDER
               )
    </insert>

    <!-- 마케팅 캠페인 신규저장시 기본목표를 등록한다. -->
    <delete id="deleteDefaultGoal" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.insertDefaultTarget] */
        DELETE FROM CR_1111T    --마케팅캠페인목표
        WHERE DLR_CD = #{dlrCd}             --딜러코드
        AND MAK_CD = #{makCd}             --마케팅코드
    </delete>


    <!-- 마케팅 캠페인 정보를 수정한다. -->
    <update id="updateMarketingCampaign" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.updateMarketingCampaign] */
        UPDATE CR_1101T    --마케팅캠페인마스터
        SET
        UPDT_DT            = SYSDATE                     --수정일자
        <if test='makNm != null and makNm != ""'>
        ,MAK_NM             = #{makNm}                    --마케팅명
        </if>
        <if test='hostCd != null and hostCd != ""'>
        ,HOST_CD            = #{hostCd}                   --주최코드
        </if>
        <if test='hostTeamCd != null and hostTeamCd != ""'>
        ,HOST_TEAM_CD       = #{hostTeamCd}               --주최팀코드
        </if>
        <if test='makTpCd != null and makTpCd != ""'>
        ,MAK_TP_CD          = #{makTpCd}                  --마케팅유형코드
        </if>
        <if test='makSubTpCd != null and makSubTpCd != ""'>
        ,MAK_SUB_TP_CD      = #{makSubTpCd}               --마케팅서브유형코드
        </if>
        <if test='rcpeNm != null and rcpeNm != ""'>
        ,RCPE_NM            = #{rcpeNm}                   --대상자명
        </if>
        <if test='startDt != null'>
        ,START_DT           = #{startDt}                  --시작일자
        </if>
        <if test='endDt != null'>
        ,END_DT             = #{endDt}                    --종료일자
        </if>
        <if test='prid != null and prid != ""'>
        ,PRID               = #{prid}                     --기간
        </if>
        <if test='placeNm != null and placeNm != ""'>
        ,PLACE_NM           = #{placeNm}                  --장소명
        </if>
        <if test='rcpeAutoYn != null and rcpeAutoYn != ""'>
        ,RCPE_AUTO_YN       = #{rcpeAutoYn}               --대상자자동추출여부
        </if>
        <if test='aapCmpNm != null and aapCmpNm != ""'>
        ,AAP_CMP_NM         = #{aapCmpNm}                 --대행업체명
        </if>
        <if test='budgetAmt != null and budgetAmt != ""'>
        ,BUDGET_AMT         = #{budgetAmt}                --예산금액
        </if>
        <if test='targCustCnt != null and targCustCnt != ""'>
        ,TARG_CUST_CNT      = #{targCustCnt}              --목표고객수
        </if>
        <if test='makCont != null and makCont != ""'>
        ,MAK_CONT           = #{makCont}                  --캠페인내용
        </if>
        <if test='creStartDt != null'>
        ,CRE_START_DT       = #{creStartDt}               --생산시작일자
        </if>
        <if test='creEndDt != null'>
        ,CRE_END_DT         = #{creEndDt}                 --생산종료일자
        </if>
        <if test='saleStartDt != null'>
        ,SALE_START_DT      = #{saleStartDt}              --판매시작일자
        </if>
        <if test='saleEndDt != null'>
        ,SALE_END_DT        = #{saleEndDt}                --판매종료일자
        </if>
        <if test='crEndTp != null and crEndTp != ""'>
        ,CR_END_TP          = #{crEndTp}                  --캠페인리콜종료여부
        </if>
        <if test='pcDstinCd != null and pcDstinCd != ""'>
        ,PC_DSTIN_CD        = #{pcDstinCd}                --승상용구분코드
        </if>
        <if test='crIsaNm != null and crIsaNm != ""'>
        ,CR_ISA_NM          = #{crIsaNm}                  --캠페인리콜시행처명
        </if>
        <if test='actTotAmt != null and actTotAmt != ""'>
        ,ACT_TOT_AMT        = #{actTotAmt}                --활동총비용
        </if>
        ,UPDT_USR_ID        = #{updtUsrId}                --수정자ID
        WHERE 1 = 1
        AND DLR_CD          = #{dlrCd}                    --딜러코드
        AND MAK_CD          = #{makCd}                    --마케팅코드
    </update>

    <!-- 마케팅 캠페인 정보를 삭제한다. -->
    <update id="deleteMarketingCampaign" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.deleteMarketingCampaign] */
        DELETE FROM CR_1101T    --마케팅캠페인마스터
        WHERE 1 = 1
        AND DLR_CD          = #{dlrCd}                    --딜러코드
        AND MAK_CD          = #{makCd}                    --마케팅코드
    </update>

    <sql id="searchMarketingCampaigns">

        LEFT OUTER JOIN CM_0304T HOST_NM ON HOST_NM.CMM_GRP_CD = 'CRM708' AND HOST_NM.LANG_CD = #{langCd} AND HOST_NM.CMM_CD = CR_1101T.HOST_CD
        LEFT OUTER JOIN CM_0304T MAK_TP_NM ON MAK_TP_NM.CMM_GRP_CD = 'CRM702' AND MAK_TP_NM.LANG_CD = #{langCd} AND MAK_TP_NM.CMM_CD = CR_1101T.MAK_TP_CD
        LEFT OUTER JOIN (SELECT B.CMM_GRP_CD, B.CMM_CD, B.CMM_CD_TXT, B.LANG_CD, A.REMARK1
                         FROM CM_0303T A
                              INNER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                      ) MAK_TP_SUB_TP_NM ON MAK_TP_SUB_TP_NM.CMM_GRP_CD IN ('CRM703','CRM704','CRM705')
                                        AND MAK_TP_SUB_TP_NM.LANG_CD = #{langCd}
                                        AND MAK_TP_SUB_TP_NM.CMM_CD = CR_1101T.MAK_SUB_TP_CD
                                        AND MAK_TP_SUB_TP_NM.REMARK1 = CR_1101T.MAK_TP_CD
        LEFT OUTER JOIN CM_0304T STAT_NM ON STAT_NM.CMM_GRP_CD = 'CRM701' AND STAT_NM.LANG_CD = #{langCd} AND STAT_NM.CMM_CD = CR_1101T.STAT_CD

        <where>
            AND CR_1101T.DEL_YN = 'N'
            AND CR_1101T.DLR_CD = #{sDlrCd}

            <if test='sMakNm != null and sMakNm != ""'>
                AND CR_1101T.MAK_NM LIKE '%' || #{sMakNm} || '%'
            </if>

            <if test='sMakCd != null and sMakCd != ""'>
                AND CR_1101T.MAK_CD LIKE '%' || #{sMakCd} || '%'
            </if>

            <if test='sHostCd != null and sHostCd != ""'>
                AND CR_1101T.HOST_CD = #{sHostCd}
            </if>

            <if test='sHostTeamCd != null and sHostTeamCd != ""'>
                AND CR_1101T.HOST_TEAM_CD = #{sHostTeamCd}
            </if>

            <if test='sMakTpCd != null and sMakTpCd != ""'>
                AND CR_1101T.MAK_TP_CD = #{sMakTpCd}
            </if>

            <if test='sMakSubTpCd != null and sMakSubTpCd != ""'>
                AND CR_1101T.MAK_SUB_TP_CD = #{sMakSubTpCd}
            </if>

            <choose>
                <when test='sStatCd != null and sStatCd != "" and sStatCd !="06"'>
                    AND CR_1101T.STAT_CD = #{sStatCd}
                    AND CR_1101T.END_DT <![CDATA[>]]> SYSDATE
                </when>
                <when test='sStatCd != null and sStatCd != "" and sStatCd =="06"'>
                    AND CR_1101T.END_DT <![CDATA[<]]> SYSDATE
                </when>
                <otherwise>
                    AND CR_1101T.STAT_CD != '05'
                </otherwise>
            </choose>

            <if test='sStartDt != null and sEndDt != null'>
               AND CR_1101T.END_DT <![CDATA[>=]]> #{sStartDt}
               AND CR_1101T.START_DT <![CDATA[<=]]> #{sEndDt}
            </if>

        </where>

    </sql>

    <!-- 마케팅 캠페인 정보 목록수를 조회한다. -->
    <select id="selectMarketingCampaignsByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectMarketingCampaignsByConditionCnt] */
        SELECT COUNT(*) AS VALUE
        FROM CR_1101T CR_1101T
        <include refid="searchMarketingCampaigns" />
    </select>


    <!-- 마케팅 캠페인 정보 목록을 조회한다. -->
    <select id="selectMarketingCampaignsByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectMarketingCampaignsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT F.*
                    ,(SELECT CMM_CD_TXT FROM CM_0304T WHERE CMM_GRP_CD = 'CRM701' AND LANG_CD = #{langCd} AND CMM_CD = F.STAT_CD) AS STAT_NM
                  FROM (
                    SELECT
                          CR_1101T.DLR_CD                    --딜러코드
                         ,CR_1101T.MAK_CD                    --마케팅코드
                         ,CR_1101T.MAK_NM                    --마케팅명
                         ,CR_1101T.HOST_CD                   --주최코드
                         ,HOST_NM.CMM_CD_TXT AS HOST_NM      --주최명
                         ,CR_1101T.HOST_TEAM_CD              --주최팀코드
                         ,CR_1101T.MAK_TP_CD                 --마케팅유형코드
                         ,CR_1101T.MAK_SUB_TP_CD             --마케팅서브유형코드
                         ,MAK_TP_NM.CMM_CD_TXT || '/' || MAK_TP_SUB_TP_NM.CMM_CD_TXT AS MAK_TP_SUB_TP_NM --마케팅유형/마케팅서브유형명
                         ,CR_1101T.RCPE_NM                   --대상자명
                         ,CR_1101T.START_DT                  --시작일자
                         ,CR_1101T.END_DT                    --종료일자
                         ,CR_1101T.PRID                      --기간
                         ,CR_1101T.PLACE_NM                  --장소명
                         ,CR_1101T.RCPE_AUTO_YN              --대상자자동추출여부
                         ,CR_1101T.AAP_CMP_NM                --대행업체명
                         ,(SELECT nvl(sum(BUDGET_AMT), 0) FROM CR_1105T
                            WHERE DLR_CD = #{sDlrCd}
                              AND MAK_CD = CR_1101T.MAK_CD) AS BUDGET_AMT --예산금액
                         ,(CASE WHEN CR_1101T.STAT_CD = '03' AND TO_CHAR(CR_1101T.END_DT,'YYYYMMDD') <![CDATA[<]]> TO_CHAR(SYSDATE,'YYYYMMDD') THEN '06' ELSE CR_1101T.STAT_CD END) AS STAT_CD    --상태코드
                         ,CR_1101T.TARG_CUST_CNT             --목표고객수
                         ,(SELECT COUNT(*)
                             FROM CR_1110T
                            WHERE DLR_CD = CR_1101T.DLR_CD
                              AND MAK_CD = CR_1101T.MAK_CD)
                          AS REAL_CUST_CNT
                         ,CR_1101T.PGSS_RATE                 --진도율
                         ,CR_1101T.ACTIVE_NM                 --활동명
                         ,CR_1101T.ACTIVE_CONT               --활동내용
                         ,CR_1101T.ACTIVE_FILE_DOC_NO        --활동첨부문서번호[CM_0901T]
                         ,CR_1101T.AD_INVT_HM                --광고투자시간
                         ,CR_1101T.AD_MEDIA_CD               --광고매체코드
                         ,CR_1101T.AD_COST_AMT               --광고비용금액
                         ,CR_1101T.AD_START_DT               --광고시작일자
                         ,CR_1101T.AD_END_DT                 --광고종료일자
                         ,CR_1101T.APPR_DOC_NO               --결재문서번호[CM_1001T]
                         ,'CRM-0003' AS SIGN_DOC_ID        --결재양식ID
                         ,CR_1101T.DEL_YN                    --삭제여부
                         ,CR_1101T.TALK_PLAN                 --화술방안
                         ,CR_1101T.MAK_CONT                  --캠페인내용
                         ,CR_1101T.CRE_START_DT              --생산시작일자
                         ,CR_1101T.CRE_END_DT                --생산종료일자
                         ,CR_1101T.SALE_START_DT             --판매시작일자
                         ,CR_1101T.SALE_END_DT               --판매종료일자
                         ,CR_1101T.CR_END_TP                 --캠페인리콜종료여부
                         ,CR_1101T.PC_DSTIN_CD               --승상용구분코드
                         ,CR_1101T.CR_ISA_NM                 --캠페인리콜시행처명
                         ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = CR_1101T.REG_USR_ID) AS REG_USR_ID --등록자ID
                         ,CR_1101T.REG_DT                    --등록일자
                         ,CR_1101T.UPDT_USR_ID               --수정자ID
                         ,CR_1101T.UPDT_DT                   --수정일자
                    FROM CR_1101T CR_1101T
                    <include refid="searchMarketingCampaigns" />
               ) F
               ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "startDt"'>           F.START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "endDt"'>             F.END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "makCd"'>             F.MAK_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "makNm"'>             F.MAK_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "regDtFormat"'>       F.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "hostCd"'>            F.HOST_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                <when test='item.field == "hostNm"'>            F.HOST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                    </when>
                                <when test='item.field == "hostTeamCd"'>        F.HOST_TEAM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                <when test='item.field == "makTpCd"'>           F.MAK_TP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                <when test='item.field == "makSubTpCd"'>        F.MAK_SUB_TP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                <when test='item.field == "makTpSubTpNm"'>      F.MAK_TP_SUB_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                <when test='item.field == "rcpeNm"'>            F.RCPE_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                <when test='item.field == "startDtFormat"'>     F.START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                <when test='item.field == "endDtFormat"'>       F.END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "prid"'>              F.PRID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                <when test='item.field == "placeNm"'>           F.PLACE_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                <when test='item.field == "aapCmpNm"'>          F.AAP_CMP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                <when test='item.field == "budgetAmt"'>         Nvl(F.BUDGET_AMT,0) <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                <when test='item.field == "statCd"'>            F.STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                <when test='item.field == "statNm"'>            F.STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                    </when>
                                <when test='item.field == "targCustCnt"'>       Nvl(F.TARG_CUST_CNT, 0) <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                                <when test='item.field == "realCustCnt"'>       Nvl(F.REAL_CUST_CNT, 0) <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                <when test='item.field == "pgssRate"'>          F.PGSS_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                <when test='item.field == "activeNm"'>          F.ACTIVE_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                <when test='item.field == "activeCont"'>        F.ACTIVE_CONT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "activeFileDocNo"'>   F.ACTIVE_FILE_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "adInvtHm"'>          F.AD_INVT_HM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                <when test='item.field == "adMediaCd"'>         F.AD_MEDIA_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "adCostAmt"'>         F.AD_COST_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "adStartDt"'>         F.AD_START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "adEndDt"'>           F.AD_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                <when test='item.field == "apprDocNo"'>         F.APPR_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "delYn"'>             F.DEL_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "regUsrId"'>          F.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                 </when>
                                <when test='item.field == "creStartDtFormat"'>  F.CRE_START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                <when test='item.field == "creEndDtFormat"'>    F.CRE_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                <when test='item.field == "saleStartDtFormat"'> F.SALE_START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                <when test='item.field == "saleEndDtFormat"'>   F.SALE_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "crEndTp"'>           F.CR_END_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                <otherwise>
                                   F.REG_DT DESC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        F.REG_DT DESC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM <![CDATA[>]]> #{firstIndex}
            </if>
        </where>
    </select>


    <!-- 마케팅 캠페인 상세조회. -->
    <select id="selectMarketingCampaignByKey" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">

        SELECT
              CR_1101T.DLR_CD                    --딜러코드
             ,CR_1101T.MAK_CD                    --마케팅코드
             ,CR_1101T.MAK_NM                    --마케팅명
             ,CR_1101T.HOST_CD                   --주최코드
             ,CR_1101T.HOST_TEAM_CD              --주최팀코드
             ,CR_1101T.MAK_TP_CD                 --마케팅유형코드
             ,CR_1101T.MAK_SUB_TP_CD             --마케팅서브유형코드
             ,CR_1101T.RCPE_NM                   --대상자명
             ,CR_1101T.START_DT                  --시작일자
             ,CR_1101T.END_DT                    --종료일자
             ,CR_1101T.PRID                      --기간
             ,CR_1101T.PLACE_NM                  --장소명
             ,CR_1101T.RCPE_AUTO_YN              --대상자자동추출여부
             ,CR_1101T.AAP_CMP_NM                --대행업체명
             ,CR_1101T.BUDGET_AMT                --예산금액
             ,(CASE WHEN CR_1101T.STAT_CD = '03' AND TO_CHAR(CR_1101T.END_DT,'YYYYMMDD') <![CDATA[<]]> TO_CHAR(SYSDATE,'YYYYMMDD') THEN '06' ELSE CR_1101T.STAT_CD END) AS STAT_CD    --상태코드
             ,CR_1101T.TARG_CUST_CNT             --목표고객수
             ,CR_1101T.PGSS_RATE                 --진도율
             ,CR_1101T.ACTIVE_NM                 --활동명
             ,CR_1101T.ACTIVE_CONT               --활동내용
             ,CR_1101T.ACTIVE_FILE_DOC_NO        --활동첨부문서번호[CM_0901T]
             ,CR_1101T.AD_INVT_HM                --광고투자시간
             ,CR_1101T.AD_MEDIA_CD               --광고매체코드
             ,CR_1101T.AD_COST_AMT               --광고비용금액
             ,CR_1101T.AD_START_DT               --광고시작일자
             ,CR_1101T.AD_END_DT                 --광고종료일자
             ,CR_1101T.APPR_DOC_NO               --결재문서번호[CM_1001T]
             ,CR_1101T.DEL_YN                    --삭제여부
             ,CR_1101T.TALK_PLAN                 --화술방안
             ,CR_1101T.MAK_CONT                  --캠페인내용
             ,CR_1101T.CRE_START_DT              --생산시작일자
             ,CR_1101T.CRE_END_DT                --생산종료일자
             ,CR_1101T.SALE_START_DT             --판매시작일자
             ,CR_1101T.SALE_END_DT               --판매종료일자
             ,CR_1101T.CR_END_TP                 --캠페인리콜종료여부
             ,CR_1101T.PC_DSTIN_CD               --승상용구분코드
             ,CR_1101T.CR_ISA_NM                 --캠페인리콜시행처명
             ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = CR_1101T.REG_USR_ID) AS REG_USR_ID --등록자ID
             ,'CRM-0003' AS SIGN_DOC_ID        --결재양식ID
             ,CR_1101T.REG_DT                    --등록일자
             ,CR_1101T.UPDT_USR_ID               --수정자ID
             ,CR_1101T.UPDT_DT                   --수정일자
        FROM CR_1101T CR_1101T                   --마케팅캠페인마스터
    <if test='sRefKeyNm != null and sRefKeyNm != ""'>
        INNER JOIN CR_1110T CR_1110T ON CR_1101T.DLR_CD = CR_1110T.DLR_CD AND CR_1101T.MAK_CD = CR_1110T.MAK_CD WHERE CR_1110T.TARG_CUST_SEQ = #{sRefKeyNm}
    </if>
        <where>
    <if test='sMakCd != null and sMakCd != ""'>
            AND CR_1101T.DLR_CD = #{sDlrCd}               --딜러코드
            AND CR_1101T.MAK_CD = #{sMakCd}
    </if>
        </where>

    </select>

    <!-- 유형 Sub 데이터를 조회한다. 공통으로 DropdownList에서 쓰기위함. (중복 모델 display 방지)  -->
    <select id="selectMakTpCdListByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        SELECT A.CMM_CD,
               NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM
          FROM CM_0303T A, CM_0304T B
         WHERE A.CMM_GRP_CD = B.CMM_GRP_CD
           AND A.CMM_CD = B.CMM_CD
           AND B.LANG_CD = #{langCd}
           AND A.CMM_GRP_CD IN ('CRM703','CRM704','CRM705')
           AND A.USE_YN = 'Y'
           AND A.REMARK1 = #{cmmCd}
    </select>




    <!-- 마케팅 캠페인(활동방안) 정보 목록을 조회한다. -->
    <select id="selectActivesByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectActivesByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                        CR_1102T.DLR_CD                  --딜러코드
                       ,CR_1102T.MAK_CD                  --마케팅코드
                       ,CR_1102T.ACTIVE_MTH_SEQ          --활동방안일련번호
                       ,CR_1102T.ACTIVE_MTH_TP_CD        --활동방안유형코드
                       ,CR_1102T.CARLINE_CD              --차종코드
                       ,FN_GET_CARLINE_NM(CR_1102T.CARLINE_CD) AS CARLINE_NM
                       ,CR_1102T.MODEL_CD                --모델코드
                       ,FN_GET_MODEL_NM(CR_1102T.MODEL_CD) AS MODEL_NM
                       ,CR_1102T.REG_USR_ID              --등록자ID
                       ,CR_1102T.REG_DT                  --등록일자
                       ,CR_1102T.UPDT_USR_ID             --수정자ID
                       ,CR_1102T.UPDT_DT                 --수정일자
                  FROM CR_1102T CR_1102T    --마케팅캠페인활동방안
                <where>
                    AND CR_1102T.DLR_CD = #{sDlrCd}               --딜러코드
                    AND CR_1102T.MAK_CD = #{sMakCd}
                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "carlineCd"'>       CR_1102T.CARLINE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                <when test='item.field == "modelCd"'>         CR_1102T.MODEL_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                <otherwise>
                                    CR_1102T.MAK_CD ASC
                                    ,CR_1102T.ACTIVE_MTH_SEQ ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        CR_1102T.MAK_CD ASC
                        ,CR_1102T.ACTIVE_MTH_SEQ ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM <![CDATA[>]]> #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 마케팅 캠페인(활동방안) 정보 목록수를 조회한다. -->
    <select id="selectActivesByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectActivesByConditionCnt] */
        SELECT COUNT(*) AS VALUE
        FROM CR_1102T CR_1102T    --마케팅캠페인활동방안
        <where>
            AND CR_1102T.DLR_CD = #{sDlrCd}               --딜러코드
            AND CR_1102T.MAK_CD = #{sMakCd}
        </where>
    </select>

    <!-- 마케팅 캠페인 정보를 수정한다.(활동방안 탭) -->
    <update id="updateMarketingCampaignActive" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.updateMarketingCampaignActive] */
        UPDATE CR_1101T    --마케팅캠페인마스터
        SET
         ACTIVE_NM          = #{activeNm}                 --활동명
        ,ACTIVE_CONT        = #{activeCont}               --활동내용
        ,TALK_PLAN          = #{talkPlan}                 --화술방안
        ,ACTIVE_FILE_DOC_NO = #{activeFileDocNo}          --활동첨부문서번호[CM_0901T]
        ,AD_INVT_HM         = #{adInvtHm}                 --광고투자시간
        ,AD_MEDIA_CD        = #{adMediaCd}                --광고매체코드
        ,AD_COST_AMT        = #{adCostAmt}                --광고비용금액
        ,AD_START_DT        = #{adStartDt}                --광고시작일자
        ,AD_END_DT          = #{adEndDt}                  --광고종료일자
        ,UPDT_USR_ID        = #{updtUsrId}                --수정자ID
        ,UPDT_DT            = SYSDATE                     --수정일자
        WHERE 1 = 1
        AND DLR_CD          = #{hDlrCd}                   --딜러코드
        AND MAK_CD          = #{hMakCd}                   --마케팅코드

    </update>

    <!-- 마케팅 캠페인(활동방안) 정보를 등록한다. -->
    <insert id="insertActive" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.insertActive] */
        INSERT INTO CR_1102T    --마케팅캠페인활동방안
        (
         DLR_CD                  --딜러코드
        ,MAK_CD                  --마케팅코드
        ,ACTIVE_MTH_SEQ          --활동방안일련번호
        ,ACTIVE_MTH_TP_CD        --활동방안유형코드
        ,CARLINE_CD              --차종코드
        ,MODEL_CD                --모델코드
        ,REG_USR_ID              --등록자ID
        ,REG_DT                  --등록일자
        ,UPDT_USR_ID             --수정자ID
        ,UPDT_DT                 --수정일자
        )
        VALUES
        (
         #{dlrCd}                  --딜러코드
        ,#{makCd}                  --마케팅코드
        ,(SELECT LPAD(NVL(TO_CHAR(MAX(ACTIVE_MTH_SEQ) + 1), '1'), 10, '0')
            FROM CR_1102T
           WHERE MAK_CD = #{makCd})--활동방안일련번호
        ,#{activeMthTpCd}          --활동방안유형코드
        ,#{carlineCd}              --차종코드
        ,#{modelCd}                --모델코드
        ,#{regUsrId}               --등록자ID
        ,SYSDATE                   --등록일자
        ,#{updtUsrId}              --수정자ID
        ,SYSDATE                   --수정일자
        )
    </insert>

    <!-- 마케팅 캠페인(활동방안) 정보를 수정한다. -->
    <update id="updateActive" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.updateActive] */
        UPDATE CR_1102T    --마케팅캠페인활동방안
            SET
             ACTIVE_MTH_TP_CD = #{activeMthTpCd}          --활동방안유형코드
            ,CARLINE_CD       = #{carlineCd}              --차종코드
            ,MODEL_CD         = #{modelCd}                --모델코드
            ,UPDT_USR_ID      = #{updtUsrId}              --수정자ID
            ,UPDT_DT          = SYSDATE                   --수정일자
        WHERE 1 = 1
          AND DLR_CD          = #{dlrCd}               --딜러코드
          AND MAK_CD          = #{makCd}               --마케팅코드
          AND ACTIVE_MTH_SEQ  = #{activeMthSeq}        --활동방안일련번호
    </update>

    <!-- 마케팅 캠페인(활동방안) 정보를 삭제한다. -->
    <update id="deleteActive" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.deleteActive] */
        DELETE FROM CR_1102T    --마케팅캠페인마스터
        WHERE 1 = 1
        AND DLR_CD          = #{dlrCd}               --딜러코드
        AND MAK_CD          = #{makCd}               --마케팅코드
        AND ACTIVE_MTH_SEQ  = #{activeMthSeq}        --활동방안일련번호
    </update>

    <!-- 마케팅 캠페인 화술방안 목록을 조회한다. -->
    <select id="selectTalkPlansByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectTalkPlansByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                      CR_1101T.DLR_CD                    --딜러코드
                     ,CR_1101T.MAK_CD                    --마케팅코드
                     ,CR_1101T.MAK_NM                    --마케팅명
                     ,CR_1101T.TALK_PLAN                 --화술방안
                FROM CR_1101T CR_1101T
                <where>
                    AND CR_1101T.DEL_YN = 'N'
                    AND CR_1101T.DLR_CD = #{sDlrCd}               --딜러코드
                    AND CR_1101T.TALK_PLAN IS NOT NULL
                    <if test='sMakNm != null and sMakNm != ""'>
                        AND CR_1101T.MAK_NM LIKE '%' || #{sMakNm} || '%'
                    </if>
                    <if test='sTalkPlan != null and sTalkPlan != ""'>
                        AND CR_1101T.TALK_PLAN LIKE '%' || #{sTalkPlan} || '%'
                    </if>
                </where>
               ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "makCd"'>             CR_1101T.MAK_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "makNm"'>             CR_1101T.MAK_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "talkPlan"'>          CR_1101T.TALK_PLAN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                <otherwise>
                                    CR_1101T.MAK_CD ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        CR_1101T.MAK_CD ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM <![CDATA[>]]> #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 마케팅 캠페인 화술방안 목록수를 조회한다. -->
    <select id="selectTalkPlansByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectTalkPlansByConditionCnt] */
        SELECT COUNT(*) AS VALUE
        FROM CR_1101T CR_1101T
        <where>
            AND CR_1101T.DEL_YN = 'N'
            AND CR_1101T.DLR_CD = #{sDlrCd}               --딜러코드
            AND CR_1101T.TALK_PLAN IS NOT NULL
            <if test='sMakNm != null and sMakNm != ""'>
                AND CR_1101T.MAK_NM LIKE '%' || #{sMakNm} || '%'
            </if>
            <if test='sTalkPlan != null and sTalkPlan != ""'>
                AND CR_1101T.TALK_PLAN LIKE '%' || #{sTalkPlan} || '%'
            </if>
        </where>
    </select>





    <!-- 마케팅 캠페인(목표) 정보 목록을 조회한다. -->
    <select id="selectGoalsByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectGoalsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                       CR_1111T.DLR_CD               --딜러코드
                      ,CR_1111T.MAK_CD               --마케팅코드
                      ,CR_1111T.SEQ                  --일련번호
                      ,CR_1111T.TARG_CD              --목표코드
                      ,CR_1111T.TARG_NM              --목표명
                      ,CR_1111T.TARG_CNT_VAL         --목표수치값
                      ,CR_1111T.TARG_RSLT_VAL        --목표결과값
                      ,CR_1111T.REG_USR_ID           --등록자ID
                      ,CR_1111T.REG_DT               --등록일자
                      ,CR_1111T.UPDT_USR_ID          --수정자ID
                      ,CR_1111T.UPDT_DT              --수정일자
                 FROM CR_1111T CR_1111T    --마케팅캠페인목표
                <where>
                    AND CR_1111T.DLR_CD = #{sDlrCd}    --딜러코드
                    AND CR_1111T.MAK_CD = #{sMakCd}
                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "dlrCd"'>        CR_1111T.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "makCd"'>        CR_1111T.MAK_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "seq"'>          CR_1111T.SEQ <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                <when test='item.field == "targCd"'>       CR_1111T.TARG_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                <when test='item.field == "targNm"'>       CR_1111T.TARG_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                <when test='item.field == "targCntVal"'>   CR_1111T.TARG_CNT_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                <when test='item.field == "targRsltVal"'>  CR_1111T.TARG_RSLT_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "regUsrId"'>     CR_1111T.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>   </when>
                                <when test='item.field == "regDt"'>        CR_1111T.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "updtUsrId"'>    CR_1111T.UPDT_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                                <when test='item.field == "updtDt"'>       CR_1111T.UPDT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                <otherwise>
                                    CR_1111T.SEQ ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        CR_1111T.SEQ ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM <![CDATA[>]]> #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 마케팅 캠페인(목표) 정보 목록수를 조회한다. -->
    <select id="selectGoalsByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectGoalsByConditionCnt] */
        SELECT COUNT(*) AS VALUE
        FROM CR_1111T CR_1111T                      --마케팅캠페인목표
        <where>
            AND CR_1111T.DLR_CD = #{sDlrCd}               --딜러코드
            AND CR_1111T.MAK_CD = #{sMakCd}
        </where>
    </select>

    <!-- 마케팅 캠페인(목표) 정보를 등록한다. -->
    <insert id="insertGoal" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.insertGoal] */
        INSERT INTO CR_1111T    --마케팅캠페인목표
        (
         DLR_CD               --딜러코드
        ,MAK_CD               --마케팅코드
        ,SEQ                  --일련번호
        ,TARG_CD              --목표코드
        ,TARG_NM              --목표명
        ,TARG_CNT_VAL         --목표수치값
        ,TARG_RSLT_VAL        --목표결과값
        ,REG_USR_ID           --등록자ID
        ,REG_DT               --등록일자
        ,UPDT_USR_ID          --수정자ID
        ,UPDT_DT              --수정일자
        )
        VALUES
        (
         #{dlrCd}               --딜러코드
        ,#{makCd}               --마케팅코드
        ,SEQ_CR_1111T.NEXTVAL   --일련번호
        ,#{targCd}              --목표코드
        ,#{targNm}              --목표명
        ,#{targCntVal}          --목표수치값
        ,#{targRsltVal}         --목표결과값
        ,#{regUsrId}            --등록자ID
        ,SYSDATE                --등록일자
        ,#{updtUsrId}           --수정자ID
        ,SYSDATE                --수정일자
        )
    </insert>

    <!-- 마케팅 캠페인(목표) 정보를 수정한다. -->
    <update id="updateGoal" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.updateGoal] */
        UPDATE CR_1111T                   --마케팅캠페인목표
           SET
               TARG_CD       = #{targCd}              --목표코드
              ,TARG_NM       = #{targNm}              --목표명
              ,TARG_CNT_VAL  = #{targCntVal}          --목표수치값
              ,UPDT_USR_ID   = #{updtUsrId}           --수정자ID
              ,UPDT_DT       = SYSDATE                --수정일자
         WHERE 1 = 1
           AND DLR_CD        = #{dlrCd}               --딜러코드
           AND MAK_CD        = #{makCd}               --마케팅코드
           AND SEQ           = #{seq}                 --일련번호
    </update>

    <!-- 마케팅 캠페인(목표) 정보를 삭제한다. -->
    <update id="deleteGoal" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.deleteGoal] */
        DELETE FROM CR_1111T                    --마케팅캠페인목표
        WHERE 1 = 1
        AND DLR_CD           = #{dlrCd}               --딜러코드
        AND MAK_CD           = #{makCd}               --마케팅코드
        AND SEQ              = #{seq}                 --일련번호
    </update>





    <!-- 마케팅 캠페인(대상자) 정보 목록을 조회한다. -->
    <select id="selectTargetsByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectTargetsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                         CR_1103T.DLR_CD                      --딜러코드
                        ,CR_1103T.MAK_CD                      --마케팅코드
                        ,CR_1103T.EXTR_DGRE_CNT               --추출차수
                        ,CR_1103T.CUST_EXTR_TERM_NO           --고객추출조건번호
                        ,CR_1103T.CUST_EXTR_TITLE_NM          --고객추출제목명
                        ,CR_1103T.EXTR_STAT_CD                --추출상태코드
                        ,(SELECT COUNT(*)
                            FROM CR_1110T
                           WHERE DLR_CD = CR_1103T.DLR_CD
                             AND MAK_CD = CR_1103T.MAK_CD
                             AND EXTR_DGRE_CNT = CR_1103T.EXTR_DGRE_CNT) AS REAL_TARGET_CNT  --대상고객 수
                        ,CR_1103T.EXTR_DT                     --추출일자
                        ,CR_1103T.USE_YN                      --사용여부
                        ,CR_1103T.REG_USR_ID                  --등록자ID
                        ,CR_1103T.REG_DT                      --등록일자
                        ,CR_1103T.UPDT_USR_ID                 --수정자ID
                        ,CR_1103T.UPDT_DT                     --수정일자
                        ,CR_1103T.CUST_EXTR_AUTO_YN           --고객추출자동여부
                        ,CR_1103T.CUST_EXTR_CYCLE_CONT        --고객추출주기내용
                        ,CR_1103T.CUST_EXTR_CYCLE_TP          --고객추출주기유형
                        ,CR_1103T.DUP_YN                      --중복여부
                  FROM CR_1103T CR_1103T    --마케팅캠페인대상고객
                <where>
                    AND CR_1103T.DLR_CD = #{sDlrCd}    --딜러코드
                    AND CR_1103T.MAK_CD = #{sMakCd}
                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "dlrCd"'>               CR_1103T.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                <when test='item.field == "makCd"'>               CR_1103T.MAK_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                <when test='item.field == "extrDgreCnt"'>         CR_1103T.EXTR_DGRE_CNT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "custExtrTermNo"'>      CR_1103T.CUST_EXTR_TERM_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>   </when>
                                <when test='item.field == "custExtrTitleNm"'>     CR_1103T.CUST_EXTR_TITLE_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                                <when test='item.field == "extrStatCd"'>          CR_1103T.EXTR_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                <when test='item.field == "realCustCnt"'>         REAL_CUST_CNT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                </when>
                                <when test='item.field == "extrDt"'>              CR_1103T.EXTR_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>             </when>
                                <when test='item.field == "useYn"'>               CR_1103T.USE_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                <when test='item.field == "regUsrId"'>            CR_1103T.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                <when test='item.field == "regDt"'>               CR_1103T.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                <when test='item.field == "updtUsrId"'>           CR_1103T.UPDT_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                <when test='item.field == "updtDt"'>              CR_1103T.UPDT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>             </when>
                                <when test='item.field == "custExtrAutoYn"'>      CR_1103T.CUST_EXTR_AUTO_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>   </when>
                                <when test='item.field == "custExtrCycleCont"'>   CR_1103T.CUST_EXTR_CYCLE_CONT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "custExtrCycleTp"'>     CR_1103T.CUST_EXTR_CYCLE_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                                <when test='item.field == "dupYn"'>               CR_1103T.DUP_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                <otherwise>
                                CR_1103T.DLR_CD ASC
                                ,CR_1103T.MAK_CD ASC
                                ,CR_1103T.EXTR_DGRE_CNT ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                    CR_1103T.DLR_CD ASC
                    ,CR_1103T.MAK_CD ASC
                    ,CR_1103T.EXTR_DGRE_CNT ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM <![CDATA[>]]> #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 마케팅 캠페인(대상자) 정보 목록수를 조회한다. -->
    <select id="selectTargetsByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectTargetsByConditionCnt] */
        SELECT COUNT(*) AS VALUE
        FROM CR_1103T CR_1103T                      --마케팅캠페인 대상자
        <where>
            AND CR_1103T.DLR_CD = #{sDlrCd}               --딜러코드
            AND CR_1103T.MAK_CD = #{sMakCd}
        </where>
    </select>

    <!-- 마케팅 캠페인(대상자) 정보를 등록한다. -->
    <insert id="insertTarget" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.insertTarget] */
        INSERT INTO CR_1103T    --마케팅캠페인대상고객
        (
        DLR_CD                      --딜러코드
        ,MAK_CD                      --마케팅코드
        ,EXTR_DGRE_CNT               --추출차수
        ,CUST_EXTR_TERM_NO           --고객추출조건번호
        ,CUST_EXTR_TITLE_NM          --고객추출제목명
        ,EXTR_STAT_CD                --추출상태코드
        ,USE_YN                      --사용여부
        ,REG_USR_ID                  --등록자ID
        ,REG_DT                      --등록일자
        ,CUST_EXTR_AUTO_YN           --고객추출자동여부
        ,CUST_EXTR_CYCLE_CONT        --고객추출주기내용
        ,CUST_EXTR_CYCLE_TP          --고객추출주기유형
        ,DUP_YN                      --중복여부
        )
        VALUES
        (
        #{dlrCd}                      --딜러코드
        ,#{makCd}                      --마케팅코드
        ,SEQ_CR_1103T.NEXTVAL          --추출차수
        ,#{custExtrTermNo}             --고객추출조건번호
        ,#{custExtrTitleNm}            --고객추출제목명
        ,'N'                           --추출상태코드
        ,'Y'                           --사용여부
        ,#{regUsrId}                   --등록자ID
        ,SYSDATE                       --등록일자
        ,#{custExtrAutoYn}             --고객추출자동여부
        ,#{custExtrCycleCont}          --고객추출주기내용
        ,#{custExtrCycleTp}            --고객추출주기유형
        ,#{dupYn}                      --중복여부
        )
        <selectKey resultType="int" keyProperty="extrDgreCnt" order="AFTER">
            SELECT SEQ_CR_1103T.CURRVAL AS extrDgreCnt FROM DUAL
        </selectKey>
    </insert>

    <!-- 마케팅 캠페인(대상자) 정보를 수정한다. -->
    <update id="updateTarget" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.updateTarget] */
        UPDATE CR_1103T    --마케팅캠페인대상고객
        SET
         CUST_EXTR_TERM_NO    = #{custExtrTermNo}             --고객추출조건번호
        ,CUST_EXTR_TITLE_NM   = #{custExtrTitleNm}            --고객추출제목명
        ,UPDT_USR_ID          = #{updtUsrId}                  --수정자ID
        ,UPDT_DT              = SYSDATE                       --수정일자
        ,CUST_EXTR_AUTO_YN    = #{custExtrAutoYn}             --고객추출자동여부
        ,CUST_EXTR_CYCLE_CONT = #{custExtrCycleCont}          --고객추출주기내용
        ,CUST_EXTR_CYCLE_TP   = #{custExtrCycleTp}            --고객추출주기유형
        ,DUP_YN               = #{dupYn}                      --중복여부
        WHERE 1 = 1
        AND DLR_CD            = #{dlrCd}                      --딜러코드
        AND MAK_CD            = #{makCd}                      --마케팅코드
        AND EXTR_DGRE_CNT     = #{extrDgreCnt}                --추출차수
    </update>

    <!-- 마케팅 캠페인(대상자) 정보를 삭제한다. -->
    <update id="deleteTarget" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.deleteTarget] */
        DELETE FROM CR_1103T    --마케팅캠페인대상고객
        WHERE 1 = 1
        AND DLR_CD           = #{dlrCd}                      --딜러코드
        AND MAK_CD           = #{makCd}                      --마케팅코드
        AND EXTR_DGRE_CNT    = #{extrDgreCnt}                --추출차수
    </update>

    <!-- 마케팅 캠페인(대상자 마스터 - CR_1103T) 정보를 등록한다.(엑셀 업로드를 통한 데이터 저장시에만 사용) -->
    <insert id="insertTargetExcelMaster" parameterType="MarketingCampaignSaveExVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.insertTargetExcelMaster] */
        INSERT INTO CR_1103T    --마케팅캠페인대상고객
        (
        DLR_CD                      --딜러코드
        ,MAK_CD                      --마케팅코드
        ,EXTR_DGRE_CNT               --추출차수
        ,CUST_EXTR_TERM_NO           --고객추출조건번호
        ,CUST_EXTR_TITLE_NM          --고객추출제목명
        ,EXTR_STAT_CD                --추출상태코드
        ,EXTR_DT                     --추출일자
        ,USE_YN                      --사용여부
        ,REG_USR_ID                  --등록자ID
        ,REG_DT                      --등록일자
        ,CUST_EXTR_AUTO_YN           --고객추출자동여부
        ,CUST_EXTR_CYCLE_CONT        --고객추출주기내용
        ,CUST_EXTR_CYCLE_TP          --고객추출주기유형
        ,DUP_YN                      --중복여부
        )
        VALUES
        (
        #{tDlrCd}                      --딜러코드
        ,#{tMakCd}                     --마케팅코드
        ,SEQ_CR_1103T.NEXTVAL          --추출차수
        ,'EXCELUPLOAD'                 --고객추출조건번호
        ,'EXCEL UPLOAD'                --고객추출제목명
        ,'Y'                           --추출상태코드
        ,SYSDATE                       --추출일자
        ,'Y'                           --사용여부
        ,#{regUsrId}                   --등록자ID
        ,SYSDATE                       --등록일자
        ,'N'                           --고객추출자동여부
        ,NULL                          --고객추출주기내용
        ,NULL                          --고객추출주기유형
        ,'Y'                           --중복여부
        )
        <selectKey resultType="int" keyProperty="tExtrDgreCnt" order="AFTER">
            SELECT SEQ_CR_1103T.CURRVAL AS tExtrDgreCnt FROM DUAL
        </selectKey>
    </insert>

    <!-- 마케팅 캠페인(대상자 디테일 - CR_1110T) 정보를 등록한다.(엑셀 업로드를 통한 데이터 저장시에만 사용) -->
    <insert id="insertTargetExcelDetail" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.insertTargetExcelDetail] */
        INSERT INTO CR_1110T    --캠페인추출고객
        (
        DLR_CD                    --딜러코드
        ,MAK_CD                    --마케팅코드
        ,EXTR_DGRE_CNT             --추출차수
        ,TARG_CUST_SEQ             --대상고객일련번호
        ,CUST_NO                   --고객번호
        ,CUST_EXTR_TERM_NO         --고객추출조건번호
        ,TEL_NO                    --전화번호
        ,HP_NO                     --휴대폰번호
        ,WECHAT_ID                 --위챗ID
        ,EMAIL_NM                  --이메일명
        ,SUNG_NM                   --성명
        ,CITY_NM                   --도시명
        ,DIST_NM                   --지역명
        ,ZIP_CD                    --우편번호
        ,EXT_ZIP_CD                --확장우편번호
        ,ADDR_NM                   --주소명
        ,ADDR_DETL_CONT            --주소상세내용
        ,SMS_SEND_DT               --SMS발송일자
        ,SMS_SEND_RSLT_CONT        --SMS발송결과내용
        ,CALL_CEN_SEND_DT          --콜센터전송일자
        ,CALL_CEN_RSLT_CONT        --콜센터결과내용
        ,SALE_SEND_DT              --판매전송일자
        ,SALE_KEY_NM               --판매키명
        ,SALE_RSLT_CONT            --판매결과내용
        ,SER_SEND_DT               --정비전송일자
        ,SER_KEY_NM                --정비키명
        ,SER_RSLT_CONT             --정비결과내용
        ,REG_USR_ID                --등록자ID
        ,REG_DT                    --등록일자
        ,CONTACT_NO                --접촉번호
        ,CALL_SEQ                  --콜일련번호
        ,CUST_NM                   --고객명
        ,BLUE_MEMBERSHIP_YN
        ,MEMBERSHIP_YN
        ,CAR_REG_NO
        ,CARLINE_CD
        ,MODEL_CD
        )
        VALUES
        (
        #{dlrCd}                    --딜러코드
        ,#{makCd}                    --마케팅코드
        ,#{extrDgreCnt}              --추출차수
        ,SEQ_CR_1110T.NEXTVAL        --대상고객일련번호
        ,#{custNo}                   --고객번호
        ,'EXCELUPLOAD'               --고객추출조건번호
        ,#{telNo}                    --전화번호
        ,#{hpNo}                     --휴대폰번호
        ,#{wechatId}                 --위챗ID
        ,#{emailNm}                  --이메일명
        ,#{sungNm}                   --성명
        ,#{cityNm}                   --도시명
        ,#{distNm}                   --지역명
        ,#{zipCd}                    --우편번호
        ,#{extZipCd}                 --확장우편번호
        ,#{addrNm}                   --주소명
        ,#{addrDetlCont}             --주소상세내용
        ,#{smsSendDt}                --SMS발송일자
        ,#{smsSendRsltCont}          --SMS발송결과내용
        ,#{callCenSendDt}            --콜센터전송일자
        ,#{callCenRsltCont}          --콜센터결과내용
        ,#{saleSendDt}               --판매전송일자
        ,#{saleKeyNm}                --판매키명
        ,#{saleRsltCont}             --판매결과내용
        ,#{serSendDt}                --정비전송일자
        ,#{serKeyNm}                 --정비키명
        ,#{serRsltCont}              --정비결과내용
        ,#{regUsrId}                 --등록자ID
        ,SYSDATE                     --등록일자
        ,#{contactNo}                --접촉번호
        ,#{callSeq}                  --콜일련번호
        ,#{custNm}                   --고객명
        ,#{blueMembershipYn}
        ,#{membershipYn}
        ,#{carRegNo}
        ,#{carlineCd}
        ,#{modelCd}
        )
    </insert>

    <!-- 마케팅 캠페인(대상자 디테일 - CR_1110T) 정보를 삭제한다. -->
    <update id="deleteTargetDetail" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.deleteTargetDetail] */
        DELETE FROM CR_1110T    --마케팅캠페인대상고객
        WHERE 1 = 1
        AND DLR_CD           = #{dlrCd}                      --딜러코드
        AND MAK_CD           = #{makCd}                      --마케팅코드
        AND EXTR_DGRE_CNT    = #{extrDgreCnt}                --추출차수
        AND CUST_NO          = #{custNo}                     --고객번호
    </update>

    <!-- 마케팅 캠페인(대상자 디테일 - CR_1110T) 정보를 등록한다.(수동으로 대상자 추출버튼을 통해 생성) -->
    <insert id="insertTargetExtractSave" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.insertTargetExtractSave] */
        INSERT INTO CR_1110T    --캠페인추출고객
        (
        DLR_CD                    --딜러코드
        ,MAK_CD                    --마케팅코드
        ,EXTR_DGRE_CNT             --추출차수
        ,TARG_CUST_SEQ             --대상고객일련번호
        ,CUST_NO                   --고객번호
        ,CUST_NM                   --고객명
        ,CUST_EXTR_TERM_NO         --고객추출조건번호
        ,TEL_NO                    --전화번호
        ,HP_NO                     --휴대폰번호
        ,WECHAT_ID                 --위챗ID
        ,EMAIL_NM                  --이메일명
        ,SUNG_NM                   --성명
        ,CITY_NM                   --도시명
        ,DIST_NM                   --지역명
        ,ZIP_CD                    --우편번호
        ,EXT_ZIP_CD                --확장우편번호
        ,ADDR_NM                   --주소명
        ,ADDR_DETL_CONT            --주소상세내용
        ,REG_USR_ID                --등록자ID
        ,REG_DT                    --등록일자
        ,BLUE_MEMBERSHIP_YN
        ,MEMBERSHIP_YN
        ,CAR_REG_NO
        ,CARLINE_CD
        ,MODEL_CD
        ,CUST_DLR_CD
        )
        SELECT #{dlrCd}              --딜러코드
               ,#{makCd}             --마케팅코드
               ,#{extrDgreCnt}       --추출차수
               ,SEQ_CR_1110T.NEXTVAL --대상고객일련번호
               ,T1.CUST_NO
               ,T2.CUST_NM
               ,#{custExtrTermNo}    --추출조건번호
               ,T2.TEL_NO
               ,T2.HP_NO
               ,T2.WECHAT_ID
               ,T2.EMAIL_NM
               ,T3.SUNG_NM
               ,T3.CITY_NM
               ,T3.DIST_NM
               ,T3.ZIP_CD
               ,T3.EXT_ZIP_CD
               ,T3.ADDR_NM
               ,T3.ADDR_DETL_CONT
               ,#{regUsrId}
               ,SYSDATE
               ,DECODE(T2.BLUE_MEMBERSHIP_NO, NULL, 'N','Y')
               ,DECODE(T4.MEMBERSHIP_NO, NULL, 'N','Y')
               ,(SELECT MAX(SA_0121T.CAR_REG_NO) KEEP (DENSE_RANK FIRST ORDER BY SA_0121T.MANUFACT_YY_MM_DT DESC) FROM SA_0121T SA_0121T WHERE SA_0121T.MANUFACT_YY_MM_DT IS NOT NULL AND SA_0121T.CAR_ID = T5.CAR_ID)
               ,(SELECT MAX(SA_0121T.CARLINE_CD) KEEP (DENSE_RANK FIRST ORDER BY SA_0121T.MANUFACT_YY_MM_DT DESC) FROM SA_0121T SA_0121T WHERE SA_0121T.MANUFACT_YY_MM_DT IS NOT NULL AND SA_0121T.CAR_ID = T5.CAR_ID)
               ,(SELECT MAX(SA_0121T.MODEL_CD) KEEP (DENSE_RANK FIRST ORDER BY SA_0121T.MANUFACT_YY_MM_DT DESC) FROM SA_0121T SA_0121T WHERE SA_0121T.MANUFACT_YY_MM_DT IS NOT NULL AND SA_0121T.CAR_ID = T5.CAR_ID)
               ,T1.CUST_DLR_CD
          FROM CR_1003T T1,
               CR_0101T T2,
               (SELECT * FROM (SELECT RANK( ) OVER (PARTITION BY AR.REF_KEY_NM ORDER BY AR.SEQ DESC ) AS RM
                      , AR.*
                  FROM CR_0116T AR
                 WHERE AR.REF_TABLE_NM = 'CR_0101T'
                   AND AR.FLAG_YN = 'Y'
                   ) ADDR WHERE RM=1
               ) T3,
               CR_0801T T4,
               (SELECT * FROM SA_0123T WHERE USE_YN = 'Y') T5
         WHERE T1.CUST_DLR_CD  = T2.DLR_CD
           AND T2.DLR_CD  = T3.DLR_CD(+)
           AND T1.CUST_NO = T2.CUST_NO
           AND T2.CUST_NO = T3.REF_KEY_NM(+)
           AND T2.DEL_YN  = 'N'
           AND T1.DLR_CD  = #{dlrCd}
           AND T1.SEQ     = #{extractSeq}
           AND T1.DLR_CD  = T4.DLR_CD(+)
           AND T1.CUST_NO = T4.CUST_NO(+)
           AND T1.CUST_NO = T5.BP_CD(+)
        <if test='dupYn == "N"'>
           AND T1.CUST_NO NOT IN (SELECT CUST_NO
                                    FROM CR_1110T
                                   WHERE DLR_CD = #{dlrCd}
                                     AND MAK_CD = #{makCd}
                                 )
        </if>

    </insert>

    <!-- 마케팅 캠페인(대상자) 정보를 수정한다.(대상자 추출버튼을 통한 대상자 마스터 업데이트) -->
    <update id="updateTargetExtractMaster" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.updateTargetExtractMaster] */
        UPDATE CR_1103T    --마케팅캠페인대상고객
        SET
         EXTR_STAT_CD         = 'Y'                           --추출상태코드
        ,EXTR_DT              = SYSDATE                       --추출일자
        ,UPDT_USR_ID          = #{updtUsrId}                  --수정자ID
        ,UPDT_DT              = SYSDATE                       --수정일자
        WHERE 1 = 1
        AND DLR_CD            = #{dlrCd}                      --딜러코드
        AND MAK_CD            = #{makCd}                      --마케팅코드
        AND EXTR_DGRE_CNT     = #{extrDgreCnt}                --추출차수
    </update>

    <!-- 마케팅 캠페인(대상자 디테일 - CR_1110T) 정보를 삭제한다.(추출조건차수을 삭제할때 추출조건차수에 대상자가 존재하면 같이 삭제.) -->
    <update id="deleteTargetDetailEx" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.deleteTargetDetailEx] */
        DELETE FROM CR_1110T    --마케팅캠페인대상고객
        WHERE 1 = 1
        AND DLR_CD           = #{dlrCd}                      --딜러코드
        AND MAK_CD           = #{makCd}                      --마케팅코드
        AND EXTR_DGRE_CNT    = #{extrDgreCnt}                --추출차수
    </update>





    <!-- 마케팅 캠페인(예산) 정보 목록을 조회한다. -->
    <select id="selectBudgetsByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectBudgetsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                         CR_1105T.DLR_CD                  --딜러코드
                        ,CR_1105T.MAK_CD                  --마케팅코드
                        ,CR_1105T.BUDGET_CD               --예산코드
                        ,BUDGET_NM.CMM_CD_TXT AS BUDGET_NM--예산코드명
                        ,CR_1105T.BUDGET_DETL_CONT        --예산상세내용
                        ,CR_1105T.BUDGET_AMT              --예산금액
                        ,CR_1105T.CORP_BUDN_RATE          --자사부담율
                        ,CR_1105T.IMS_SUPT_AMT            --제조사지원금액
                        ,CR_1105T.REG_USR_ID              --등록자ID
                        ,CR_1105T.REG_DT                  --등록일자
                        ,CR_1105T.UPDT_USR_ID             --수정자ID
                        ,CR_1105T.UPDT_DT                 --수정일자
                  FROM CR_1105T CR_1105T    --마케팅캠페인예산
                       LEFT OUTER JOIN CM_0304T BUDGET_NM ON BUDGET_NM.CMM_GRP_CD = 'CRM707' AND BUDGET_NM.LANG_CD = #{langCd} AND BUDGET_NM.CMM_CD = CR_1105T.BUDGET_CD
                <where>
                    AND CR_1105T.DLR_CD = #{sDlrCd}               --딜러코드
                    AND CR_1105T.MAK_CD = #{sMakCd}
                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "makCd"'>           CR_1105T.MAK_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                <when test='item.field == "budgetCd"'>        BUDGET_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                </when>
                                <when test='item.field == "budgetNm"'>        BUDGET_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                </when>
                                <when test='item.field == "budgetDetlCont"'>  CR_1105T.BUDGET_DETL_CONT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "budgetAmt"'>       CR_1105T.BUDGET_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                <when test='item.field == "corpBudnRate"'>    CR_1105T.CORP_BUDN_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                                <when test='item.field == "imsSuptAmt"'>      CR_1105T.IMS_SUPT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                <otherwise>
                                     CR_1105T.MAK_CD ASC
                                    ,CR_1105T.BUDGET_CD ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                         CR_1105T.MAK_CD ASC
                        ,CR_1105T.BUDGET_CD ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM <![CDATA[>]]> #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 마케팅 캠페인(예산) 정보 목록수를 조회한다. -->
    <select id="selectBudgetsByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectBudgetsByConditionCnt] */
        SELECT COUNT(*) AS VALUE
        FROM CR_1105T CR_1105T
        <where>
            AND CR_1105T.DLR_CD = #{sDlrCd}               --딜러코드
            AND CR_1105T.MAK_CD = #{sMakCd}
        </where>
    </select>

    <!-- 마케팅 캠페인(예산) 상세조회. -->
    <select id="selectBudgetByKey" parameterType="MarketingCampaignVO" resultType="MarketingCampaignVO">
        SELECT
             CR_1105T.DLR_CD                  --딜러코드
            ,CR_1105T.MAK_CD                  --마케팅코드
            ,CR_1105T.BUDGET_CD               --예산코드
            ,CR_1105T.BUDGET_DETL_CONT        --예산상세내용
            ,CR_1105T.BUDGET_AMT              --예산금액
            ,CR_1105T.CORP_BUDN_RATE          --자사부담율
            ,CR_1105T.IMS_SUPT_AMT            --제조사지원금액
            ,CR_1105T.REG_USR_ID              --등록자ID
            ,CR_1105T.REG_DT                  --등록일자
            ,CR_1105T.UPDT_USR_ID             --수정자ID
            ,CR_1105T.UPDT_DT                 --수정일자
        FROM CR_1105T CR_1105T                --마케팅캠페인예산
        <where>
            AND CR_1105T.DLR_CD = #{dlrCd}               --딜러코드
            AND CR_1105T.MAK_CD = #{makCd}
            AND CR_1105T.BUDGET_CD = #{budgetCd}
        </where>
    </select>

    <!-- 마케팅 캠페인(예산) 정보를 등록한다. -->
    <insert id="insertBudget" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.insertBudget] */
        INSERT INTO CR_1105T    --마케팅캠페인예산
        (
         DLR_CD                  --딜러코드
        ,MAK_CD                  --마케팅코드
        ,BUDGET_CD               --예산코드
        ,BUDGET_DETL_CONT        --예산상세내용
        ,BUDGET_AMT              --예산금액
        ,CORP_BUDN_RATE          --자사부담율
        ,IMS_SUPT_AMT            --제조사지원금액
        ,REG_USR_ID              --등록자ID
        ,REG_DT                  --등록일자
        ,UPDT_USR_ID             --수정자ID
        ,UPDT_DT                 --수정일자
        )
        VALUES
        (
         #{dlrCd}                  --딜러코드
        ,#{makCd}                  --마케팅코드
        ,#{budgetCd}               --예산코드
        ,#{budgetDetlCont}         --예산상세내용
        ,#{budgetAmt}              --예산금액
        ,#{corpBudnRate}           --자사부담율
        ,#{imsSuptAmt}             --제조사지원금액
        ,#{regUsrId}               --등록자ID
        ,SYSDATE                   --등록일자
        ,#{updtUsrId}              --수정자ID
        ,SYSDATE                   --수정일자
        )
    </insert>

    <!-- 마케팅 캠페인(예산) 정보를 수정한다. -->
    <update id="updateBudget" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.updateMarketingCampaign] */
        UPDATE CR_1105T    --마케팅캠페인예산
           SET
             BUDGET_DETL_CONT = #{budgetDetlCont}         --예산상세내용
            ,BUDGET_AMT       = #{budgetAmt}              --예산금액
            ,CORP_BUDN_RATE   = #{corpBudnRate}           --자사부담율
            ,IMS_SUPT_AMT     = #{imsSuptAmt}             --제조사지원금액
            ,UPDT_USR_ID      = #{updtUsrId}              --수정자ID
            ,UPDT_DT          = SYSDATE                   --수정일자
        WHERE 1 = 1
          AND DLR_CD          = #{dlrCd}               --딜러코드
          AND MAK_CD          = #{makCd}
          AND BUDGET_CD       = #{budgetCd}
    </update>

    <!-- 마케팅 캠페인(예산) 정보를 삭제한다. -->
    <update id="deleteBudget" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.deleteBudget] */
        DELETE FROM CR_1105T    --마케팅캠페인마스터
        WHERE 1 = 1
        AND DLR_CD           = #{dlrCd}               --딜러코드
        AND MAK_CD           = #{makCd}
        AND BUDGET_CD        = #{budgetCd}
    </update>





    <!-- 마케팅 캠페인(대상자) 정보 목록수를 조회한다.(심사진도 탭에서 심사요청 시 대상자 추출조건이 있는지 체크) -->
    <select id="selectTargetExsByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectTargetExsByConditionCnt] */
        SELECT COUNT(*) AS VALUE
        FROM CR_1103T CR_1103T                      --마케팅캠페인 대상자
        <where>
            AND CR_1103T.DLR_CD = #{sDlrCd}               --딜러코드
            AND CR_1103T.MAK_CD = #{sMakCd}
        </where>
    </select>

    <!-- 마케팅 캠페인(작업정보 및 부품정보) 목록수를 조회한다.(공임코드별로 부품이 등록되어 있으면 원인부품코드도 등록되어야 하는데 등록되어 있는지 체크) -->
    <select id="selectWorkItemsByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectWorkItemsByConditionCnt] */
        SELECT COUNT(*) AS VALUE
          FROM CR_1106T A, CR_1107T B
         WHERE A.CR_NO  = B.CR_NO
           AND A.LBR_CD = B.LBR_CD
           AND A.DLR_CD = #{sDlrCd}
           AND A.CR_NO  = #{sMakCd}
           AND A.ITEM_CD IS NOT NULL
           AND B.CAU_ITEM_CD IS NULL
    </select>

    <!-- 마케팅 캠페인에 결재문서번호를 수정한다.(심사진도 탭 - 마케팅캠페인 진행상태를 '심사중'으로 변경) -->
    <update id="updateApprDocNo" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.updateApprDocNo] */
        UPDATE CR_1101T    --마케팅캠페인마스터
        SET
         APPR_DOC_NO        = #{apprDocNo}                --결재문서번호
        ,STAT_CD            = '02'
        ,UPDT_USR_ID        = #{updtUsrId}                --수정자ID
        ,UPDT_DT            = SYSDATE                     --수정일자
        WHERE 1 = 1
        AND DLR_CD          = #{dlrCd}                    --딜러코드
        AND MAK_CD          = #{makCd}                    --마케팅코드
    </update>

    <!-- 결재정보를 조회한다.(결재상태 조회) -->
    <select id="selectSignExByKey" parameterType="SignSearchVO" resultType="SignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectSignExByKey] */
        SELECT * FROM CM_1001T
        <where>
                AND SIGN_DOC_NO   = #{sSignDocNo}
        </where>
    </select>

    <!-- 마케팅캠페인코드를 조회한다.(결재상태 조회) -->
    <select id="selectMakCdByKey" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectMakCdByKey] */
        SELECT MAK_CD FROM CR_1101T
        WHERE 1 = 1
        AND APPR_DOC_NO = #{sApprDocNo} --결재코드
    </select>

    <!-- 마케팅캠페인 진행상태를 변경한다. -->
    <update id="updateStatCd" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.updateStatCd] */
        UPDATE CR_1101T    --마케팅캠페인마스터
        SET
         STAT_CD            = #{statCd}
        ,UPDT_USR_ID        = #{updtUsrId}                --수정자ID
        ,UPDT_DT            = SYSDATE                     --수정일자
        WHERE 1 = 1
        AND DLR_CD          = #{dlrCd}                    --딜러코드
        AND MAK_CD          = #{makCd}                    --마케팅코드
    </update>





    <!-- 마케팅 캠페인(결과-목표) 정보 목록을 조회한다. -->
    <select id="selectResultGoalsByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectResultGoalsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                       CR_1111T.DLR_CD               --딜러코드
                      ,CR_1111T.MAK_CD               --마케팅코드
                      ,CR_1111T.SEQ                  --일련번호
                      ,CR_1111T.TARG_CD              --목표코드
                      ,CR_1111T.TARG_NM              --목표명
                      ,CR_1111T.TARG_CNT_VAL         --목표수치값
                      ,CR_1111T.TARG_RSLT_VAL        --목표결과값
                      ,CR_1111T.REG_USR_ID           --등록자ID
                      ,CR_1111T.REG_DT               --등록일자
                      ,CR_1111T.UPDT_USR_ID          --수정자ID
                      ,CR_1111T.UPDT_DT              --수정일자
                 FROM CR_1111T CR_1111T    --마케팅캠페인목표
                <where>
                    AND CR_1111T.DLR_CD = #{sDlrCd}    --딜러코드
                    AND CR_1111T.MAK_CD = #{sMakCd}
                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "dlrCd"'>        CR_1111T.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "makCd"'>        CR_1111T.MAK_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "seq"'>          CR_1111T.SEQ <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                <when test='item.field == "targCd"'>       CR_1111T.TARG_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                <when test='item.field == "targNm"'>       CR_1111T.TARG_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                <when test='item.field == "targCntVal"'>   CR_1111T.TARG_CNT_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                <when test='item.field == "targRsltVal"'>  CR_1111T.TARG_RSLT_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "regUsrId"'>     CR_1111T.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>   </when>
                                <when test='item.field == "regDt"'>        CR_1111T.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "updtUsrId"'>    CR_1111T.UPDT_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                                <when test='item.field == "updtDt"'>       CR_1111T.UPDT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                <otherwise>
                                    CR_1111T.SEQ ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        CR_1111T.SEQ ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM <![CDATA[>]]> #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 마케팅 캠페인(결과-업체평가) 정보 목록을 조회한다. -->
    <select id="selectResultCorpsByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectResultCorpsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                       CR_1112T.DLR_CD                    --딜러코드
                      ,CR_1112T.MAK_CD                    --마케팅코드
                      ,CR_1112T.SEQ                       --일련번호
                      ,CR_1112T.IVST_TP                   --조사유형
                      ,CR_1112T.PRSN_OPN_CONT             --담당자의견내용
                      ,CR_1112T.STSF_IVST_RSLT_SEQ        --만족도조사결과일련번호
                      ,CR_1112T.EMP_ID                    --사원ID
                      ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = CR_1112T.EMP_ID) AS EMP_NM
                      ,CR_0905T.STSF_IVST_DT              --설문일자
                      ,CR_0905T.STSF_IVST_SCORE_VAL       --설문점수
                      ,CR_0905T.STSF_IVST_SEQ             --만족도조사일련번호
                      ,CR_0905T.SUBY_TMPL_SEQ             --설문템플릿일련번호
                      ,CR_0905T.STSF_IVST_YN              --만족여부
                  FROM CR_1112T CR_1112T,    --마케팅캠페인결과설문
                       CR_0905T CR_0905T     --설문결과
                <where>
                   AND CR_1112T.STSF_IVST_RSLT_SEQ = CR_0905T.STSF_IVST_RSLT_SEQ
                   AND CR_1112T.EMP_ID = CR_0905T.EMP_ID
                   AND CR_1112T.DLR_CD = #{sDlrCd}
                   AND CR_1112T.MAK_CD = #{sMakCd}
                   AND CR_1112T.IVST_TP = '01'
                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                            <when test='item.field == "dlrCd"'>             CR_1112T.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                            <when test='item.field == "makCd"'>             CR_1112T.MAK_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                            <when test='item.field == "seq"'>               CR_1112T.SEQ <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                            <when test='item.field == "ivstTp"'>            CR_1112T.IVST_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                            <when test='item.field == "prsnOpnCont"'>       CR_1112T.PRSN_OPN_CONT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                            <when test='item.field == "stsfIvstRsltSeq"'>   CR_1112T.STSF_IVST_RSLT_SEQ <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "empId"'>             CR_1112T.EMP_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                            <when test='item.field == "empNm"'>             EMP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                     </when>
                            <when test='item.field == "regUsrId"'>          CR_1112T.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                            <when test='item.field == "regDt"'>             CR_1112T.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                            <when test='item.field == "updtUsrId"'>         CR_1112T.UPDT_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                            <when test='item.field == "updtDt"'>            CR_1112T.UPDT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                            <otherwise>
                             CR_1112T.DLR_CD ASC
                            ,CR_1112T.MAK_CD ASC
                            ,CR_1112T.SEQ ASC
                            </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                     CR_1112T.DLR_CD ASC
                    ,CR_1112T.MAK_CD ASC
                    ,CR_1112T.SEQ ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM <![CDATA[>]]> #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 마케팅 캠페인(결과-캠페인직원평가) 정보 목록을 조회한다. -->
    <select id="selectResultPersonsByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectResultPersonsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                       CR_1112T.DLR_CD                    --딜러코드
                      ,CR_1112T.MAK_CD                    --마케팅코드
                      ,CR_1112T.SEQ                       --일련번호
                      ,CR_1112T.IVST_TP                   --조사유형
                      ,CR_1112T.PRSN_OPN_CONT             --담당자의견내용
                      ,CR_1112T.STSF_IVST_RSLT_SEQ        --만족도조사결과일련번호
                      ,CR_1112T.EMP_ID                    --사원ID
                      ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = CR_1112T.EMP_ID) AS EMP_NM
                      ,CR_0905T.STSF_IVST_DT              --설문일자
                      ,CR_0905T.STSF_IVST_SCORE_VAL       --설문점수
                      ,CR_0905T.STSF_IVST_SEQ             --만족도조사일련번호
                      ,CR_0905T.SUBY_TMPL_SEQ             --설문템플릿일련번호
                  FROM CR_1112T CR_1112T,    --마케팅캠페인결과설문
                       CR_0905T CR_0905T     --설문결과
                <where>
                   AND CR_1112T.STSF_IVST_RSLT_SEQ = CR_0905T.STSF_IVST_RSLT_SEQ
                   AND CR_1112T.EMP_ID = CR_0905T.EMP_ID
                   AND CR_1112T.DLR_CD = #{sDlrCd}
                   AND CR_1112T.MAK_CD = #{sMakCd}
                   AND CR_1112T.IVST_TP = '02'
                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                            <when test='item.field == "dlrCd"'>             CR_1112T.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                            <when test='item.field == "makCd"'>             CR_1112T.MAK_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                            <when test='item.field == "seq"'>               CR_1112T.SEQ <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                            <when test='item.field == "ivstTp"'>            CR_1112T.IVST_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                            <when test='item.field == "prsnOpnCont"'>       CR_1112T.PRSN_OPN_CONT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                            <when test='item.field == "stsfIvstRsltSeq"'>   CR_1112T.STSF_IVST_RSLT_SEQ <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "empId"'>             CR_1112T.EMP_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                            <when test='item.field == "empNm"'>             EMP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                     </when>
                            <when test='item.field == "regUsrId"'>          CR_1112T.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                            <when test='item.field == "regDt"'>             CR_1112T.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                            <when test='item.field == "updtUsrId"'>         CR_1112T.UPDT_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                            <when test='item.field == "updtDt"'>            CR_1112T.UPDT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                            <otherwise>
                             CR_1112T.DLR_CD ASC
                            ,CR_1112T.MAK_CD ASC
                            ,CR_1112T.SEQ ASC
                            </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                     CR_1112T.DLR_CD ASC
                    ,CR_1112T.MAK_CD ASC
                    ,CR_1112T.SEQ ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM <![CDATA[>]]> #{firstIndex}
            </if>
        </where>
    </select>




    <!-- 캠페인 대상자 정보 목록을 조회한다. -->
    <select id="selectCrmTargExtractPopupsByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectCrmTargExtractPopupsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                        CR_1110T.DLR_CD             --딜러코드
                       ,CR_1110T.MAK_CD             --마케팅코드
                       ,CR_1110T.EXTR_DGRE_CNT      --추출차수
                       ,CR_1110T.CUST_DLR_CD        --고객딜러코드
                       ,CR_1110T.CUST_NO            --고객번호
                       ,CR_1110T.CUST_NM            --고객명
                       ,CR_1110T.CUST_EXTR_TERM_NO  --고객추출조건번호
                       ,CR_1110T.TEL_NO             --전화번호
                       ,CR_1110T.HP_NO              --휴대폰번호
                       ,CR_1110T.WECHAT_ID          --위챗ID
                       ,CR_1110T.EMAIL_NM           --이메일명
                       ,CR_1110T.SUNG_NM            --성명
                       ,CR_1110T.CITY_NM            --도시명
                       ,CR_1110T.DIST_NM            --지역명
                       ,CR_1110T.ZIP_CD             --우편번호
                       ,CR_1110T.EXT_ZIP_CD         --확장우편번호
                       ,CR_1110T.ADDR_NM            --주소명
                       ,CR_1110T.ADDR_DETL_CONT     --주소상세내용
                       ,CR_1110T.SMS_SEND_DT        --SMS발송일자
                       ,CR_1110T.SMS_SEND_RSLT_CONT --SMS발송결과내용
                       ,CR_1110T.CALL_CEN_SEND_DT   --콜센터전송일자
                       ,CR_1110T.CALL_CEN_RSLT_CONT --콜센터결과내용
                       ,CR_1110T.SALE_SEND_DT       --판매전송일자
                       ,CR_1110T.SALE_KEY_NM        --판매키명
                       ,CR_1110T.SALE_RSLT_CONT     --판매결과내용
                       ,CR_1110T.SER_SEND_DT        --정비전송일자
                       ,CR_1110T.SER_KEY_NM         --정비키명
                       ,CR_1110T.SER_RSLT_CONT      --정비결과내용
                       ,CR_1110T.REG_USR_ID         --등록자ID
                       ,CR_1110T.REG_DT             --등록일자
                       ,CR_1110T.UPDT_USR_ID        --수정자ID
                       ,CR_1110T.UPDT_DT            --수정일자
                       ,CR_1110T.CONTACT_NO         --접촉번호
                       ,CR_1110T.CALL_SEQ           --콜일련번호
                       ,CR_1110T.BLUE_MEMBERSHIP_YN
                       ,CR_1110T.MEMBERSHIP_YN
                       ,CR_1110T.CAR_REG_NO
                       ,FN_GET_CARLINE_NM(CR_1110T.CARLINE_CD) AS CARLINE_NM
                       ,FN_GET_MODEL_NM(CR_1110T.MODEL_CD) AS MODEL_NM
                 FROM CR_1110T CR_1110T    --캠페인실행 대상자
                <where>
                    AND CR_1110T.DLR_CD = #{sDlrCd}    --딜러코드
                    AND CR_1110T.MAK_CD = #{sMakCd}
                    <if test='sExtrDgreCnt != null and sExtrDgreCnt != ""'> AND CR_1110T.EXTR_DGRE_CNT = #{sExtrDgreCnt} </if>
                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "dlrCd"'>             CR_1110T.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "makCd"'>             CR_1110T.MAK_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "extrDgreCnt"'>       CR_1110T.EXTR_DGRE_CNT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                <when test='item.field == "custDlrCd"'>         CR_1110T.CUST_DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "custNo"'>            CR_1110T.CUST_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                <when test='item.field == "custExtrTermNo"'>    CR_1110T.CUST_EXTR_TERM_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                <when test='item.field == "telNo"'>             CR_1110T.TEL_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "hpNo"'>              CR_1110T.HP_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>             </when>
                                <when test='item.field == "wechatId"'>          CR_1110T.WECHAT_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                <when test='item.field == "emailNm"'>           CR_1110T.EMAIL_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                <when test='item.field == "sungNm"'>            CR_1110T.SUNG_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                <when test='item.field == "cityNm"'>            CR_1110T.CITY_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                <when test='item.field == "distNm"'>            CR_1110T.DIST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                <when test='item.field == "zipCd"'>             CR_1110T.ZIP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "extZipCd"'>          CR_1110T.EXT_ZIP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                <when test='item.field == "addrNm"'>            CR_1110T.ADDR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                <when test='item.field == "addrDetlCont"'>      CR_1110T.ADDR_DETL_CONT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                <when test='item.field == "smsSendDt"'>         CR_1110T.SMS_SEND_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "smsSendRsltCont"'>   CR_1110T.SMS_SEND_RSLT_CONT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "callCenSendDt"'>     CR_1110T.CALL_CEN_SEND_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                                <when test='item.field == "callCenRsltCont"'>   CR_1110T.CALL_CEN_RSLT_CONT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "saleSendDt"'>        CR_1110T.SALE_SEND_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                <when test='item.field == "saleKeyNm"'>         CR_1110T.SALE_KEY_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "saleRsltCont"'>      CR_1110T.SALE_RSLT_CONT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                <when test='item.field == "serSendDt"'>         CR_1110T.SER_SEND_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "serKeyNm"'>          CR_1110T.SER_KEY_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                <when test='item.field == "serRsltCont"'>       CR_1110T.SER_RSLT_CONT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                <when test='item.field == "regUsrId"'>          CR_1110T.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                <when test='item.field == "regDt"'>             CR_1110T.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "updtUsrId"'>         CR_1110T.UPDT_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                <when test='item.field == "updtDt"'>            CR_1110T.UPDT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                <when test='item.field == "contactNo"'>         CR_1110T.CONTACT_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                <when test='item.field == "callSeq"'>           CR_1110T.CALL_SEQ <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                <otherwise>
                                     CR_1110T.DLR_CD ASC
                                    ,CR_1110T.MAK_CD ASC
                                    ,CR_1110T.EXTR_DGRE_CNT ASC
                                    ,CR_1110T.CUST_NO ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                         CR_1110T.DLR_CD ASC
                        ,CR_1110T.MAK_CD ASC
                        ,CR_1110T.EXTR_DGRE_CNT ASC
                        ,CR_1110T.CUST_NO ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM <![CDATA[>]]> #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 캠페인 대상자 정보 목록수를 조회한다. -->
    <select id="selectCrmTargExtractPopupsByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectCrmTargExtractPopupsByConditionCnt] */
        SELECT COUNT(*) AS VALUE
        FROM CR_1110T CR_1110T                      --마케팅캠페인목표
        <where>
            AND CR_1110T.DLR_CD = #{sDlrCd}               --딜러코드
            AND CR_1110T.MAK_CD = #{sMakCd}
            <if test='sExtrDgreCnt != null and sExtrDgreCnt != ""'> AND CR_1110T.EXTR_DGRE_CNT = #{sExtrDgreCnt} </if>
        </where>
    </select>





    <!-- 캠페인 대상 작업정보 목록수를 조회한다.(정비 캠페인) -->
    <select id="selectWorkByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectWorkByConditionCnt] */

             SELECT COUNT(A.MAK_CD) VALUE
               FROM CR_1101T A , CR_1107T B
              WHERE B.CR_NO     = A.MAK_CD
                AND A.DLR_CD    = B.DLR_CD
                AND A.MAK_CD    = #{sCrNo}
                AND A.DLR_CD    = #{sDlrCd}
                AND A.HOST_CD   = #{sHostCd}

    </select>

    <!-- 캠페인 대상 작업정보 목록을 조회한다.(정비 캠페인 - 공임) -->
    <select id="selectWorkByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectWorkByCondition] */

            SELECT *
              FROM (
                SELECT ROWNUM AS RNUM , T1.*
                  FROM(
                    SELECT B.DLR_CD
                          ,B.CR_NO
                          ,A.PC_DSTIN_CD
                          ,B.LBR_CD
                          ,B.LBR_NM
                          ,B.LBR_PRC
                          ,B.LBR_QTY
                          ,B.CAU_ITEM_CD
                          ,B.CAU_ITEM_NM
                          ,B.CAU_CD
                          ,B.CAU_NM
                          ,B.PHEN_CD
                          ,B.PHEN_NM
                          ,B.LBR_HM
                          ,B.LBR_AMT
                          ,B.USE_YN
                          <!-- ,NVL(B.DS_AMT ,0) AS DS_AMT
                          ,NVL(B.DS_RATE,0) AS DS_RATE
                          ,NVL(B.LBR_TOT_AMT ,0 ) AS LBR_TOT_AMT
                          ,B.LBR_TP -->
                      FROM CR_1101T A , CR_1107T B
                     WHERE B.CR_NO     = A.MAK_CD
                       AND A.DLR_CD    = B.DLR_CD
                       AND A.MAK_CD    = #{sCrNo}
                       AND A.DLR_CD    = #{sDlrCd}
                       AND A.HOST_CD   = #{sHostCd}
                     ORDER BY
                     <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                    <when test='item.field == "crNo"'>B.CR_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "pcDstinCd"'>A.PC_DSTIN_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrCd"'>B.LBR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrNm"'>B.LBR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrQty"'>B.LBR_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "cauItemCd"'>B.CAU_ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "cauItemNm"'>B.CAU_ITEM_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "cauCd"'>B.CAU_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "cauNm"'>B.CAU_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "phenCd"'>B.PHEN_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "phenNm"'>B.PHEN_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrHm"'>B.LBR_HM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrAmt"'>B.LBR_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "useYn"'>B.USE_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <otherwise>
                                        B.CR_NO ASC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            B.CR_NO ASC
                        </otherwise>
                    </choose>
                )T1
                <where>
                  <if test='firstIndex != -1 and lastIndex != -1'>
                   AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                  </if>
               </where>
             )
             <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM > #{firstIndex}
                </if>
            </where>
    </select>

    <!-- 마케팅 캠페인(작업정보) 정보를 등록한다.(정비 캠페인) -->
    <insert id="insertWork" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.insertWork] */

        INSERT INTO CR_1107T    --CR공임정보
        (
         CR_NO                --캠페인리콜번호
        ,LBR_CD              --공임코드
        ,CR_TP               --캠페인리콜유형
        ,LBR_NM              --공임명
        ,LBR_QTY             --공임수량
        ,CAU_ITEM_CD         --원인품목코드
        ,CAU_ITEM_NM         --원인품목명
        ,CAU_CD              --원인코드
        ,CAU_NM              --원인명
        ,PHEN_CD             --현상코드
        ,PHEN_NM             --현상명
        ,LTS_MODEL_CD        --LTS모델코드
        ,LBR_HM              --공임시간
        ,LBR_PRC             --공임단가
        ,LBR_AMT             --공임금액
        ,USE_YN              --사용여부
        ,REG_USR_ID          --등록자ID
        ,REG_DT              --등록일자
        ,DLR_CD              --딜러코드
        )
        VALUES
        (
         #{crNo}               --캠페인리콜번호
        ,#{lbrCd}              --공임코드
        ,#{crTp}               --캠페인리콜유형
        ,#{lbrNm}              --공임명
        ,#{lbrQty}             --공임수량
        ,#{cauItemCd}          --원인품목코드
        ,#{cauItemNm}          --원인품목명
        ,#{cauCd}              --원인코드
        ,#{cauNm}              --원인명
        ,#{phenCd}             --현상코드
        ,#{phenNm}             --현상명
        ,#{ltsModelCd}         --LTS모델코드
        ,#{lbrHm}              --공임시간
        ,#{lbrPrc}             --공임단가
        ,#{lbrAmt}             --공임금액
        ,'Y'                   --사용여부
        ,#{regUsrId}           --등록자ID
        ,SYSDATE               --등록일자
        ,#{dlrCd}              --딜러코드
        )
    </insert>

    <!-- 마케팅 캠페인(작업정보) 정보를 수정한다.(정비 캠페인) -->
    <update id="updateWork" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.updateWork] */
        UPDATE CR_1107T                           --CR공임정보
          SET
             CAU_ITEM_CD  = #{cauItemCd}          --원인품목코드
            ,CAU_ITEM_NM  = #{cauItemNm}          --원인품목명
            ,CAU_CD       = #{cauCd}              --원인코드
            ,CAU_NM       = #{cauNm}              --원인명
            ,PHEN_CD      = #{phenCd}             --현상코드
            ,PHEN_NM      = #{phenNm}             --현상명
            ,UPDT_USR_ID  = #{updtUsrId}          --수정자ID
            ,UPDT_DT      = SYSDATE               --수정일자
        WHERE 1 = 1
          AND CR_NO     = #{crNo}               --캠페인리콜번호
          AND LBR_CD    = #{lbrCd}              --공임코드
    </update>

    <!-- 마케팅 캠페인(작업정보) 정보를 삭제한다.(정비 캠페인) -->
    <update id="deleteWork" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.deleteWork] */

        DELETE FROM CR_1107T            --CR공임정보
         WHERE 1 = 1
           AND CR_NO     = #{crNo}               --캠페인리콜번호
           AND LBR_CD    = #{lbrCd}              --공임코드

    </update>


    <!-- 캠페인 VIN 정보 갯수(정비 캠페인) -->
    <select id="selectVinByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectVinByConditionCnt] */

        SELECT COUNT(CR_NO) AS VALUE
         FROM (
          SELECT B.CR_NO
                ,B.VIN_NO
                ,'' LTS_MODEL_CD
                ,'' LTS_MODEL_NM
                ,B.USE_YN
                ,B.DLR_CD
                ,B.USE_DT
            FROM CR_1108T B
           WHERE B.CR_NO = #{sCrNo}
             AND B.DLR_CD = #{sDlrCd}
           UNION
          SELECT A.CR_NO , '' VIN_NO , A.LTS_MODEL_CD ,
                (SELECT
                       <choose>
                            <when test='langCd == "ko"'> LTS_EN_NM </when>
                            <when test='langCd == "zh"'> LTS_CHN_NM </when>
                            <otherwise>LTS_EN_NM</otherwise>
                        </choose>
                   FROM SE_1064T
                  WHERE LTS_MODEL_CD = A.LTS_MODEL_CD) AS LTS_MODEL_NM
               , '' AS USE_YN , #{sDlrCd} AS DLR_CD , NULL AS USE_DT
           FROM CR_1109T A
          WHERE A.CR_NO = #{sCrNo}
        )
    </select>

    <!-- 캠페인 VIN 정보(정비 캠페인) -->
    <select id="selectVinByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectVinByCondition] */

          SELECT *
            FROM (
             SELECT ROWNUM AS RNUM , T1.*
              FROM (
                  SELECT VIN.CR_NO
                        ,VIN.VIN_NO
                        ,VIN.LTS_MODEL_CD
                        ,VIN.LTS_MODEL_NM
                        ,VIN.USE_YN
                        ,VIN.DLR_CD
                        ,VIN.USE_DT
                    FROM (
                          SELECT A.CR_NO
                                ,A.VIN_NO
                                ,'' LTS_MODEL_CD
                                ,'' LTS_MODEL_NM
                                ,A.USE_YN
                                ,A.DLR_CD
                                ,A.USE_DT
                            FROM CR_1108T A
                           WHERE A.CR_NO = #{sCrNo}
                             AND A.DLR_CD = #{sDlrCd}
                           UNION
                          SELECT A.CR_NO
                                ,'' VIN_NO
                                ,A.LTS_MODEL_CD
                                ,(SELECT
                                    <choose>
                                        <when test='langCd == "ko"'> LTS_EN_NM </when>
                                        <when test='langCd == "zh"'> LTS_CHN_NM </when>
                                        <otherwise>LTS_CHN_NM</otherwise>
                                    </choose>
                                   FROM SE_1064T
                                  WHERE LTS_MODEL_CD = A.LTS_MODEL_CD) AS LTS_MODEL_NM
                                ,'' AS USE_YN
                                ,#{sDlrCd} AS DLR_CD
                                ,NULL AS USE_DT
                           FROM CR_1109T A
                          WHERE A.CR_NO = #{sCrNo}
                         ) VIN
                  ORDER BY
                     <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                    <when test='item.field == "crNo"'> VIN.CR_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "vinVo"'>VIN.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "ltsModelCd"'>VIN.LTS_MODEL_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "ltsModelNm"'>VIN.LTS_MODEL_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <otherwise>
                                        VIN.CR_NO ASC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            VIN.CR_NO ASC
                        </otherwise>
                    </choose>
               )T1
            <where>
                  <if test='firstIndex != -1 and lastIndex != -1'>
                   AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                  </if>
               </where>
          )
             <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM > #{firstIndex}
                </if>
            </where>
    </select>


    <!-- 캠페인 VIN TMP 정보 갯수(정비 캠페인) -->
    <select id="selectVinTmpByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectVinTmpByConditionCnt] */
          SELECT COUNT(VIN_NO) AS VALUE
            FROM CR_1108T_TMP
           WHERE CR_NO  = #{sCrNo}
             AND DLR_CD = #{sDlrCd}

    </select>

    <!-- 캠페인 VIN TMP 정보  (정비 캠페인) -->
    <select id="selectVinTmpByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectVinTmpByCondition] */

          SELECT *
            FROM (
             SELECT ROWNUM AS RNUM , T1.*
              FROM (
                  SELECT A.VIN_NO
                    FROM CR_1108T_TMP A
                   WHERE A.CR_NO = #{sCrNo}
                     AND A.DLR_CD = #{sDlrCd}
                  ORDER BY VIN_NO
               )T1
            <where>
                  <if test='firstIndex != -1 and lastIndex != -1'>
                   AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                  </if>
               </where>
          )
             <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM > #{firstIndex}
                </if>
            </where>
    </select>


    <!-- 캠페인 VIN 정보(정비 캠페인)를 등록한다.(엑셀업로드를 통한 등록) -->
    <insert id="insertVinExcelData" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.insertVinExcelData] */
        INSERT INTO CR_1108T (
                 CR_NO               --캠페인리콜번호
                ,VIN_NO             --차대번호
                ,USE_YN             --사용여부
                ,DLR_CD             --딜러코드
                ,REG_USR_ID         --등록자ID
                ,REG_DT             --등록일자
          )
          SELECT CR_NO              --캠페인리콜번호
                ,VIN_NO             --차대번호
                ,USE_YN             --사용여부
                ,DLR_CD             --딜러코드
                ,REG_USR_ID         --등록자ID
                ,REG_DT             --등록일자
            FROM CR_1108T_TMP A
            WHERE DLR_CD = #{dlrCd}
              AND CR_NO  = #{makCd}
              AND NOT EXISTS(
                    SELECT *
                     FROM CR_1108T B
                    WHERE B.DLR_CD = A.DLR_CD
                      AND B.CR_NO  = A.CR_NO
                      AND B.VIN_NO = A.VIN_NO
            )

    </insert>

    <!-- 캠페인 VIN 정보(정비 캠페인)를 등록한다.(엑셀업로드를 통한 등록) -->
    <insert id="insertVinTmpExcelData" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.insertVinTmpExcelData] */

        INSERT INTO CR_1108T_TMP    --CR대상차량정보
        (
             CR_NO               --캠페인리콜번호
            ,VIN_NO             --차대번호
            ,USE_YN             --사용여부
            ,DLR_CD             --딜러코드
            ,REG_USR_ID         --등록자ID
            ,REG_DT             --등록일자
        )
        VALUES
        (
            #{makCd}              --캠페인리콜번호
            ,#{vinNo}             --차대번호
            ,'Y'                  --사용여부
            ,#{dlrCd}             --딜러코드
            ,#{regUsrId}          --등록자ID
            ,SYSDATE              --등록일자
        )
    </insert>

    <!-- 캠페인 VIN 정보(정비 캠페인)를 삭제한다.(엑셀업로드를 통한 등록) -->
    <delete id="deleteVinTmpExcelData" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.deleteVinTmpExcelData] */

        DELETE FROM CR_1108T_TMP
         WHERE CR_NO = #{makCd}
           AND DLR_CD = #{dlrCd}

    </delete>

    <!-- 캠페인 LTS 정보(정비 캠페인)를 등록한다.(엑셀업로드를 통한 등록) -->
    <insert id="insertLtsModelExcelData" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.insertLtsModelExcelData] */

        MERGE INTO CR_1109T A
         USING(
          SELECT
                 #{dlrCd} AS DLR_CD             --딜러코드
                ,#{makCd} AS CR_NO              --캠페인리콜번호
                ,#{ltsModelCd} AS LTS_MODEL_CD  --차대번호
                ,#{regUsrId} AS REG_USR_ID      --등록자ID
                ,SYSDATE AS REG_DT              --등록일자
          FROM DUAL
         ) B
         ON(
               A.DLR_CD       = B.DLR_CD
           AND A.CR_NO        = B.CR_NO
           AND A.LTS_MODEL_CD = B.LTS_MODEL_CD
         )WHEN NOT MATCHED THEN
           INSERT(
             A.DLR_CD             --딜러코드
            ,A.CR_NO              --캠페인리콜번호
            ,A.LTS_MODEL_CD       --차대번호
            ,A.REG_USR_ID         --등록자ID
            ,A.REG_DT             --등록일자
           )VALUES(
             B.DLR_CD             --딜러코드
            ,B.CR_NO              --캠페인리콜번호
            ,B.LTS_MODEL_CD       --차대번호
            ,B.REG_USR_ID         --등록자ID
            ,B.REG_DT             --등록일자
           )
    </insert>


   <!-- 캠페인 공임 정보 갯수(정비 캠페인) -->
    <select id="selectLaborByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectLaborByConditionCnt] */

            SELECT COUNT(A.MAK_CD) AS VALUE
               FROM CR_1101T A , CR_1107T B
              WHERE A.MAK_CD = #{sCrNo}
                AND B.CR_NO = A.MAK_CD
                AND A.DLR_CD = #{sDlrCd}
                AND A.DLR_CD = B.DLR_CD
     </select>

   <!-- 캠페인 공임 정보(정비 캠페인) -->
    <select id="selectLaborByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectLaborByCondition] */

           SELECT *
              FROM (
                SELECT ROWNUM AS RNUM , T1.*
                 FROM (
                    SELECT B.DLR_CD
                          ,B.CR_NO
                          ,A.PC_DSTIN_CD
                          ,B.LBR_CD
                          ,B.LBR_NM
                          ,B.LBR_QTY
                          ,B.LBR_PRC
                          ,B.CAU_ITEM_CD
                          ,B.CAU_ITEM_NM
                          ,B.CAU_CD
                          ,B.CAU_NM
                          ,B.PHEN_CD
                          ,B.PHEN_NM
                          ,B.LBR_HM
                          ,B.LBR_AMT
                          ,B.USE_YN
                       FROM CR_1101T A , CR_1107T B
                      WHERE A.MAK_CD = #{sCrNo}
                        AND B.CR_NO = A.MAK_CD
                        AND A.DLR_CD = #{sDlrCd}
                        AND A.DLR_CD = B.DLR_CD
                        ORDER BY
                     <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                    <when test='item.field == "crNo"'>B.CR_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "pcDstinCd"'>A.PC_DSTIN_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrCd"'>B.LBR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrNm"'>B.LBR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrQty"'>B.LBR_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "cauItemCd"'>B.CAU_ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "cauItemNm"'>B.CAU_ITEM_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "cauCd"'>B.CAU_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "cauNm"'>B.CAU_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "phenCd"'>B.PHEN_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "phenNm"'>B.PHEN_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrHm"'>B.LBR_HM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrAmt"'>B.LBR_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "useYn"'>B.USE_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <otherwise>
                                        B.CR_NO ASC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            B.CR_NO ASC
                        </otherwise>
                    </choose>
                    ) T1
                  <where>
                  <if test='firstIndex != -1 and lastIndex != -1'>
                   AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                  </if>
               </where>
             )
             <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM > #{firstIndex}
                </if>
            </where>

    </select>

    <!-- 마케팅 캠페인(공임정보) 정보를 수정한다.(정비 캠페인) -->
    <update id="updateLabor" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.updateLabor] */
        UPDATE CR_1107T                 --CR공임정보
        SET
         LBR_QTY      = #{lbrQty}             --공임수량
        ,LBR_HM       = #{lbrHm}              --공임시간
        ,LBR_AMT      = #{lbrAmt}             --공임금액
        ,UPDT_USR_ID  = #{updtUsrId}          --수정자ID
        ,UPDT_DT      = SYSDATE               --수정일자
        WHERE 1 = 1
        AND CR_NO     = #{crNo}               --캠페인리콜번호
        AND LBR_CD    = #{lbrCd}              --공임코드
    </update>

    <!-- 캠페인 부품 정보 갯수(제조사 정비 캠페인 부품) -->
    <select id="selectItemsByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectItemsByConditionCnt] */

          SELECT COUNT(B.CR_NO) AS VALUE
            FROM CR_1101T A , CR_1107T B , CR_1106T C
           WHERE A.MAK_CD    = B.CR_NO
             AND A.DLR_CD    = B.DLR_CD
             AND B.DLR_CD    = C.DLR_CD
             AND B.CR_NO     = C.CR_NO
             AND B.LBR_CD    = C.LBR_CD
             AND C.CR_NO     = #{sCrNo}
             AND C.DLR_CD    = #{sDlrCd}
             AND A.HOST_CD   = #{sHostCd}

    </select>

    <!-- 캠페인 부품 정보(제조사 정비 캠페인 부품) -->
    <select id="selectItemsByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectItemsByCondition] */

       SELECT *
         FROM(
         SELECT ROWNUM AS RNUM , T1.*
           FROM (
          SELECT  ITEM.DLR_CD
                 ,ITEM.CR_NO
                 ,ITEM.LBR_CD
                 ,ITEM.LTS_MODEL_CD
                 ,ITEM.LTS_MODEL_NM
                 ,ITEM.CAU_ITEM_CD
                 ,ITEM.CAU_ITEM_NM
                 ,ITEM.ITEM_QTY
                 ,ITEM.CRE_START_DT
                 ,ITEM.CRE_END_DT
            FROM  (
                  SELECT C.DLR_CD
                        ,C.CR_NO
                        ,C.LBR_CD
                        ,C.LTS_MODEL_CD,
                         (SELECT <choose>
                                     <when test='sLangCd == "ko"' >LTS_EN_NM </when>
                                     <otherwise> LTS_CHN_NM</otherwise>
                                 </choose>
                            FROM SE_1064T
                           WHERE LTS_MODEL_CD = C.LTS_MODEL_CD
                             AND ROWNUM = 1 ) AS LTS_MODEL_NM
                         ,C.ITEM_CD AS CAU_ITEM_CD
                         ,C.ITEM_NM AS CAU_ITEM_NM
                         ,C.ITEM_QTY
                         ,A.CRE_START_DT
                         ,A.CRE_END_DT
                    FROM CR_1101T A , CR_1107T B , CR_1106T C
                   WHERE A.MAK_CD    = B.CR_NO
                     AND A.DLR_CD    = B.DLR_CD
                     AND B.DLR_CD    = C.DLR_CD
                     AND B.CR_NO     = C.CR_NO
                     AND B.LBR_CD    = C.LBR_CD
                     AND C.CR_NO     = #{sCrNo}
                     AND C.DLR_CD    = #{sDlrCd}
                     AND A.HOST_CD   = #{sHostCd}
                  ) ITEM
              ORDER BY
                 <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "crNo"'>ITEM.CR_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "lbrCd"'>ITEM.LBR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "cauItemCd"'>ITEM.CAU_ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "cauItemNm"'>ITEM.CAU_ITEM_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "ltsModelCd"'>ITEM.LTS_MODEL_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "ltsModelNm"'>ITEM.LTS_MODEL_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "itemQty"'>ITEM.ITEM_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                    ITEM.CR_NO ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        ITEM.CR_NO ASC
                    </otherwise>
                </choose>
              )T1
          <where>
              <if test='firstIndex != -1 and lastIndex != -1'>
               AND ROWNUM <![CDATA[<=]]> #{lastIndex}
              </if>
           </where>
         )
         <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>


    <!-- 캠페인 부품 정보 갯수(딜러 정비 캠페인 부품) -->
    <select id="selectDlrItemsByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectDlrItemsByConditionCnt] */

            SELECT COUNT(CR_NO) AS VALUE
              FROM CR_1106T A
             WHERE CR_NO   = #{sCrNo}
               AND DLR_CD  = #{sDlrCd}
    </select>

    <!-- 캠페인 부품 정보(딜러  정비 캠페인 부품) -->
    <select id="selectDlrItemsByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectDlrItemsByCondition] */

       SELECT *
         FROM(
         SELECT ROWNUM AS RNUM , T1.*
           FROM (
                SELECT CR_NO
                      ,DLR_CD
                      ,LBR_CD
                      ,ITEM_CD
                      ,ITEM_NM
                      ,LTS_MODEL_CD
                      ,NVL(ITEM_QTY , 0) AS ITEM_QTY
                      ,NVL(ITEM_UNIT_CD,'EA') AS ITEM_UNIT_CD
                      ,NVL(ITEM_PRC,0) AS ITEM_PRC
                      ,NVL(ITEM_AMT,0) AS ITEM_AMT
                      ,NVL(ITEM_TOT_AMT,0) AS ITEM_TOT_AMT
                      ,NVL(DS_AMT,0) AS DS_AMT
                      ,NVL(DS_RATE,0) AS DS_RATE
                 FROM CR_1106T A
                 WHERE CR_NO   = #{sCrNo}
                   AND DLR_CD  = #{sDlrCd}
              ORDER BY
                 <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "crNo"'>A.CR_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "lbrCd"'>A.LBR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "cauItemCd"'>A.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "cauItemNm"'>A.ITEM_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "ltsModelCd"'>A.LTS_MODEL_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "itemQty"'>A.ITEM_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                    A.CR_NO ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        A.CR_NO ASC
                    </otherwise>
                </choose>
              )T1
          <where>
              <if test='firstIndex != -1 and lastIndex != -1'>
               AND ROWNUM <![CDATA[<=]]> #{lastIndex}
              </if>
           </where>
         )
         <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>


    <!-- 공임코드 데이터를 조회한다. 공통으로 DropdownList에서 쓰기위함. (중복 모델 display 방지)  -->
    <select id="selectLbrCdListByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        SELECT LBR_CD,
               LBR_NM
          FROM CR_1107T
         WHERE DLR_CD = #{sDlrCd}
           AND CR_NO = #{sMakCd}
    </select>

    <!-- 마케팅 캠페인(부품정보) 정보를 등록한다.(정비 캠페인) -->
    <insert id="insertItems" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.insertItems] */
        <!-- 삭제 ITEM_TOT_AMT, DS_AMT, DS_RATE -->

        INSERT INTO CR_1106T    --CR부품정보
        (
         CR_NO               --캠페인리콜번호
        ,LBR_CD              --공임코드
        ,ITEM_CD             --품목코드
        ,LTS_MODEL_CD        --LTS모델코드
        ,ITEM_NM             --품목명
        ,ITEM_QTY            --품목수량
        ,ITEM_UNIT_CD        --품목단위코드
        ,ITEM_PRC            --품목단가
        ,ITEM_AMT            --품목금액
        ,USE_YN              --사용여부
        ,REG_USR_ID          --등록자ID
        ,REG_DT              --등록일자
        ,DLR_CD              --딜러코드
        )
        VALUES
        (
         #{crNo}               --캠페인리콜번호
        ,' '                   --공임코드
        ,#{itemCd}             --품목코드
        ,' '                   --LTS모델코드
        ,#{itemNm}             --품목명
        ,#{itemQty}            --품목수량
        ,#{itemUnitCd}         --품목단위코드
        ,#{itemPrc}            --품목단가
        ,#{itemAmt}            --품목금액
        ,'Y'                   --사용여부
        ,#{regUsrId}           --등록자ID
        ,SYSDATE               --등록일자
        ,#{dlrCd}              --딜러코드
        )
    </insert>

    <!-- 마케팅 캠페인(부품정보) 정보를 삭제한다.(정비 캠페인) -->
    <update id="updateItems" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.updateItems] */
      UPDATE CR_1106T
         SET ITEM_QTY       = #{itemQty}     --품목수량
            ,ITEM_PRC       = #{itemPrc}     --품목단가
            ,ITEM_AMT       = #{itemAmt}     --품목금액
         WHERE 1 = 1
           AND CR_NO        = #{crNo}               --캠페인리콜번호
           AND ITEM_CD      = #{itemCd}          --품목코드
    </update>

    <!-- 마케팅 캠페인(부품정보) 정보를 삭제한다.(정비 캠페인) -->
    <delete id="deleteItems" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.deleteWork] */

        DELETE FROM CR_1106T            --CR부품정보
         WHERE 1 = 1
           AND CR_NO        = #{crNo}               --캠페인리콜번호
           <if test=' lbrCd != null and lbrCd != "" '>
           AND LBR_CD       = #{lbrCd}              --공임코드
           </if>
           AND ITEM_CD      = #{itemCd}          --품목코드
           AND LTS_MODEL_CD = ' '                   --LTS모델코드
    </delete>

    <!-- 전체 딜러 정보 목록을 조회한다. -->
    <select id="selectDealersByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectDealersByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT CM_0101T.DLR_CD
                       ,CM_0101T.DLR_NM
                FROM CM_0101T CM_0101T
                WHERE CM_0101T.DMS_USE_YN='Y'
                AND CM_0101T.DLR_CD NOT IN (
                    SELECT CR_1102T.TARG_DLR_CD
                    FROM CR_1102T CR_1102T
                    WHERE CR_1102T.DLR_CD = #{sDlrCd} AND CR_1102T.MAK_CD = #{sMakCd}
                )
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "dlrCd"'> DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                </when>
                                <when test='item.field == "dlrNm"'> DLR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                </when>
                                <otherwise>
                                    CM_0101T.DLR_CD ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        CM_0101T.DLR_CD ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM <![CDATA[>]]> #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 전체 딜러 정보 목록수를 조회한다. -->
    <select id="selectDealersByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectDealersByConditionCnt] */
        SELECT COUNT(*) AS VALUE
        FROM CM_0101T
        WHERE DMS_USE_YN='Y'
    </select>

    <!-- 대상 딜러 정보 목록을 조회한다. -->
    <select id="selectDlrsByCondition" parameterType="MarketingCampaignSearchVO" resultType="MarketingCampaignVO">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectDlrsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT CR_1102T.DLR_CD
                       ,CR_1102T.MAK_CD
                       ,CM_0101T.DLR_CD AS TARG_DLR_CD
                       ,CM_0101T.DLR_NM AS TARG_DLR_NM
                       ,DECODE(CR_1102T.MAK_CD,NULL,'N','Y') AS TARG_YN
                       ,'N' AS FLAG_YN
                FROM CM_0101T CM_0101T
                INNER JOIN CR_1102T CR_1102T ON CR_1102T.TARG_DLR_CD = CM_0101T.DLR_CD
            <where>
                AND CR_1102T.DLR_CD = #{sDlrCd} AND CR_1102T.MAK_CD = #{sMakCd}
            </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "targDlrCd"'> TARG_DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                </when>
                                <when test='item.field == "targDlrNm"'> TARG_DLR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                </when>
                                <when test='item.field == "targYn"'> TARG_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                    </when>
                                <otherwise>
                                    CR_1102T.TARG_DLR_CD ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        CR_1102T.TARG_DLR_CD ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM <![CDATA[>]]> #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 대상 딜러 정보 목록수를 조회한다. -->
    <select id="selectDlrsByConditionCnt" parameterType="MarketingCampaignSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.selectDlrsByConditionCnt] */
        SELECT COUNT(*) AS VALUE
            FROM CM_0101T CM_0101T
            INNER JOIN CR_1102T CR_1102T ON CR_1102T.TARG_DLR_CD = CM_0101T.DLR_CD
        <where>
            AND CR_1102T.DLR_CD = #{sDlrCd} AND CR_1102T.MAK_CD = #{sMakCd}
        </where>
    </select>

    <!-- 마케팅 캠페인(대상 딜러) 정보를 등록한다. -->
    <insert id="insertDlr" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.insertDlr] */
        INSERT INTO CR_1102T    --BHMC 마케팅 캠페인 대상 딜러(DCS)
        (
        DLR_CD             --딜러코드
        ,MAK_CD             --마케팅코드
        ,TARG_DLR_CD        --대상딜러코드
        ,REG_USR_ID         --등록자ID
        ,REG_DT             --등록일자
        )
        VALUES
        (
        #{dlrCd}             --딜러코드
        ,#{makCd}             --마케팅코드
        ,#{targDlrCd}         --대상딜러코드
        ,#{regUsrId}          --등록자ID
        ,SYSDATE              --등록일자
        )
    </insert>

    <!-- 마케팅 캠페인(활동방안) 정보를 삭제한다. -->
    <update id="deleteDlr" parameterType="MarketingCampaignVO" >
        /* [chn.bhmc.dms.crm.mcm.service.dao.MarketingCampaignDAO.deleteDlr] */
        DELETE FROM CR_1102T    --마케팅캠페인마스터
        WHERE 1 = 1
        AND DLR_CD          = #{dlrCd}               --딜러코드
        AND MAK_CD          = #{makCd}               --마케팅코드
    </update>

</mapper>