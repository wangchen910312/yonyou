<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : CommonCodeIfDAO_SqlMap.xml
    Description : 메세지소스에 인터페이스
    author Kang Seok Han
    since 2015. 1. 18.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 01. 18.  Kang Seok Han    최초 생성
    2017. 07. 17.  Kang Seok Han    인터페이스 테이블반영시 머지 쿼리로 변경
-->

<mapper namespace="chn.bhmc.dms.cmm.sci.service.dao.CommonCodeIfDAO">
    <!-- 공통코드그룹 정보를 인터페이스 테이블에 반영한다. -->
    <update id="mergeCommonCodeGroup" parameterType="CommonCodeGroupVO">
        /* [chn.bhmc.dms.cmm.sci.service.dao.CommonCodeIfDAO.mergeCommonCodeGroup] */
        MERGE INTO CM_0301IS T1
        USING (
            SELECT
                 CMM_GRP_CD
                ,CMM_GRP_CD_NM
                ,REMARK
                ,REMARK_TITLE_NM
                ,SYS_CD_YN
                ,USE_YN
                ,REG_USR_ID
                ,REG_DT
                ,UPDT_USR_ID
                ,UPDT_DT
            FROM CM_0301T
            WHERE CMM_GRP_CD = #{cmmGrpCd}
        ) T2 ON (
            T1.CMM_GRP_CD = T2.CMM_GRP_CD
        )
        WHEN MATCHED THEN
            UPDATE SET
                 T1.CMM_GRP_CD_NM = T2.CMM_GRP_CD_NM
                ,T1.REMARK = T2.REMARK
                ,T1.REMARK_TITLE_NM = T2.REMARK_TITLE_NM
                ,T1.SYS_CD_YN = T2.SYS_CD_YN
                ,T1.USE_YN = T2.USE_YN
                ,T1.UPDT_USR_ID = T2.UPDT_USR_ID
                ,T1.UPDT_DT = T2.UPDT_DT
                ,T1.IFRESULT = 'N'
        WHEN NOT MATCHED THEN
            INSERT(
                 T1.CMM_GRP_CD
                ,T1.CMM_GRP_CD_NM
                ,T1.REMARK
                ,T1.REMARK_TITLE_NM
                ,T1.SYS_CD_YN
                ,T1.USE_YN
                ,T1.REG_USR_ID
                ,T1.REG_DT
                ,T1.UPDT_USR_ID
                ,T1.UPDT_DT
                ,T1.IFRESULT
            )VALUES(
                 T2.CMM_GRP_CD
                ,T2.CMM_GRP_CD_NM
                ,T2.REMARK
                ,T2.REMARK_TITLE_NM
                ,T2.SYS_CD_YN
                ,T2.USE_YN
                ,T2.REG_USR_ID
                ,T2.REG_DT
                ,T2.UPDT_USR_ID
                ,T2.UPDT_DT
                ,'N'
            )
    </update>

    <!-- 공통코드그룹 정보를 인터페이스 테이블에서 사용여부를 'N'으로 변경한다. -->
    <update id="deleteCommonCodeGroup" parameterType="CommonCodeGroupVO">
        /* [chn.bhmc.dms.cmm.sci.service.dao.CommonCodeIfDAO.deleteCommonCodeGroup] */
        UPDATE CM_0301IS SET
             USE_YN = 'N'
            ,UPDT_USR_ID = #{updtUsrId}
            ,UPDT_DT = SYSDATE
            ,IFRESULT = 'N'
        WHERE CMM_GRP_CD = #{cmmGrpCd}
    </update>

    <!-- 공통코드그룹  텍스트 정보를 인터페이스 테이블에 반영한다. -->
    <update id="mergeCommonCodeGroupTxt" parameterType="CommonCodeGroupTxtVO">
        /* [chn.bhmc.dms.cmm.sci.service.dao.CommonCodeIfDAO.mergeCommonCodeGroupTxt] */
        MERGE INTO CM_0302IS T1
        USING (
            SELECT
                 CMM_GRP_CD
                ,LANG_CD
                ,CMM_GRP_CD_TXT
                ,REMARK_TITLE_NM
                ,REG_USR_ID
                ,REG_DT
                ,UPDT_USR_ID
                ,UPDT_DT
            FROM CM_0302T
            WHERE
                CMM_GRP_CD = #{cmmGrpCd}
                AND LANG_CD = #{langCd}
        ) T2 ON (
            T1.CMM_GRP_CD = T2.CMM_GRP_CD
            AND T1.LANG_CD = T2.LANG_CD
        )
        WHEN MATCHED THEN
            UPDATE SET
                 T1.CMM_GRP_CD_TXT = T2.CMM_GRP_CD_TXT
                ,T1.REMARK_TITLE_NM = T2.REMARK_TITLE_NM
                ,T1.UPDT_USR_ID = T2.UPDT_USR_ID
                ,T1.UPDT_DT = T2.UPDT_DT
                ,T1.IFRESULT = 'N'
        WHEN NOT MATCHED THEN
            INSERT(
                 T1.CMM_GRP_CD
                ,T1.LANG_CD
                ,T1.CMM_GRP_CD_TXT
                ,T1.REMARK_TITLE_NM
                ,T1.REG_USR_ID
                ,T1.REG_DT
                ,T1.UPDT_USR_ID
                ,T1.UPDT_DT
                ,T1.IFRESULT
            )VALUES(
                 T2.CMM_GRP_CD
                ,T2.LANG_CD
                ,T2.CMM_GRP_CD_TXT
                ,T2.REMARK_TITLE_NM
                ,T2.REG_USR_ID
                ,T2.REG_DT
                ,T2.UPDT_USR_ID
                ,T2.UPDT_DT
                ,'N'
            )
    </update>

    <!-- 공통코드그룹 텍스트 정보를 인터페이스 테이블에서 삭제한다. -->
    <delete id="deleteCommonCodeGroupTxt" parameterType="CommonCodeGroupTxtVO">
        /* [chn.bhmc.dms.cmm.sci.service.dao.CommonCodeIfDAO.deleteCommonCodeGroupTxt] */
        DELETE FROM CM_0302IS
        WHERE
            CMM_GRP_CD = #{cmmGrpCd}
            AND LANG_CD = #{langCd}
    </delete>

    <!-- 공통코드 정보를 인터페이스 테이블에 반영한다. -->
    <update id="mergeCommonCode" parameterType="CommonCodeVO">
        /* [chn.bhmc.dms.cmm.sci.service.dao.CommonCodeIfDAO.mergeCommonCode] */
        MERGE INTO CM_0303IS T1
        USING (
            SELECT
                 CMM_CD
                ,CMM_CD_NM
                ,CMM_GRP_CD
                ,SORT_ORDER
                ,REMARK1
                ,REMARK2
                ,REMARK3
                ,REMARK4
                ,REMARK5
                ,REMARK6
                ,REMARK7
                ,REMARK8
                ,REMARK9
                ,REMARK10
                ,USE_YN
                ,REG_USR_ID
                ,REG_DT
                ,UPDT_USR_ID
                ,UPDT_DT
            FROM CM_0303T
            WHERE
                CMM_CD = #{cmmCd}
                AND CMM_GRP_CD = #{cmmGrpCd}
        ) T2 ON (
            T1.CMM_CD = T2.CMM_CD
            AND T1.CMM_GRP_CD = T2.CMM_GRP_CD
        )
        WHEN MATCHED THEN
            UPDATE SET
                 T1.CMM_CD_NM = T2.CMM_CD_NM
                ,T1.SORT_ORDER = T2.SORT_ORDER
                ,T1.REMARK1 = T2.REMARK1
                ,T1.REMARK2 = T2.REMARK2
                ,T1.REMARK3 = T2.REMARK3
                ,T1.REMARK4 = T2.REMARK4
                ,T1.REMARK5 = T2.REMARK5
                ,T1.REMARK6 = T2.REMARK6
                ,T1.REMARK7 = T2.REMARK7
                ,T1.REMARK8 = T2.REMARK8
                ,T1.REMARK9 = T2.REMARK9
                ,T1.REMARK10 = T2.REMARK10
                ,T1.USE_YN = T2.USE_YN
                ,T1.UPDT_USR_ID = T2.UPDT_USR_ID
                ,T1.UPDT_DT = T2.UPDT_DT
                ,T1.IFRESULT = 'N'
        WHEN NOT MATCHED THEN
            INSERT(
                 T1.CMM_CD
                ,T1.CMM_CD_NM
                ,T1.CMM_GRP_CD
                ,T1.SORT_ORDER
                ,T1.REMARK1
                ,T1.REMARK2
                ,T1.REMARK3
                ,T1.REMARK4
                ,T1.REMARK5
                ,T1.REMARK6
                ,T1.REMARK7
                ,T1.REMARK8
                ,T1.REMARK9
                ,T1.REMARK10
                ,T1.USE_YN
                ,T1.REG_USR_ID
                ,T1.REG_DT
                ,T1.UPDT_USR_ID
                ,T1.UPDT_DT
                ,T1.IFRESULT
            )VALUES(
                 T2.CMM_CD
                ,T2.CMM_CD_NM
                ,T2.CMM_GRP_CD
                ,T2.SORT_ORDER
                ,T2.REMARK1
                ,T2.REMARK2
                ,T2.REMARK3
                ,T2.REMARK4
                ,T2.REMARK5
                ,T2.REMARK6
                ,T2.REMARK7
                ,T2.REMARK8
                ,T2.REMARK9
                ,T2.REMARK10
                ,T2.USE_YN
                ,T2.REG_USR_ID
                ,T2.REG_DT
                ,T2.UPDT_USR_ID
                ,T2.UPDT_DT
                ,'N'
            )
    </update>

    <!-- 공통코드 정보를 인터페이스 테이블에 반영한다. -->
    <update id="deleteCommonCode" parameterType="CommonCodeVO">
        /* [chn.bhmc.dms.cmm.sci.service.dao.CommonCodeIfDAO.deleteCommonCode] */
        UPDATE CM_0303IS SET
             USE_YN = 'N'
            ,UPDT_USR_ID = #{updtUsrId}
            ,UPDT_DT = SYSDATE
            ,IFRESULT = 'N'
        WHERE
            CMM_CD = #{cmmCd}
            AND CMM_GRP_CD = #{cmmGrpCd}
    </update>

    <!-- 공통코드그룹  텍스트 정보를 인터페이스 테이블에 반영한다. -->
    <update id="mergeCommonCodeTxt" parameterType="CommonCodeTxtVO">
        /* [chn.bhmc.dms.cmm.sci.service.dao.CommonCodeIfDAO.mergeCommonCodeTxt] */
        MERGE INTO CM_0304IS T1
        USING (
            SELECT
                 CMM_GRP_CD
                ,CMM_CD
                ,LANG_CD
                ,CMM_CD_TXT
                ,REG_USR_ID
                ,REG_DT
                ,UPDT_USR_ID
                ,UPDT_DT
            FROM CM_0304T
            WHERE
                CMM_CD = #{cmmCd}
                AND LANG_CD = #{langCd}
                AND CMM_GRP_CD = #{cmmGrpCd}
        ) T2 ON (
            T1.CMM_CD = T2.CMM_CD
            AND T1.LANG_CD = T2.LANG_CD
            AND T1.CMM_GRP_CD = T2.CMM_GRP_CD
        )
        WHEN MATCHED THEN
            UPDATE SET
                 T1.CMM_CD_TXT = T2.CMM_CD_TXT
                ,T1.UPDT_USR_ID = T2.UPDT_USR_ID
                ,T1.UPDT_DT = T2.UPDT_DT
                ,T1.IFRESULT = 'N'
        WHEN NOT MATCHED THEN
            INSERT(
                 T1.CMM_GRP_CD
                ,T1.CMM_CD
                ,T1.LANG_CD
                ,T1.CMM_CD_TXT
                ,T1.REG_USR_ID
                ,T1.REG_DT
                ,T1.UPDT_USR_ID
                ,T1.UPDT_DT
                ,T1.IFRESULT
            )VALUES(
                 T2.CMM_GRP_CD
                ,T2.CMM_CD
                ,T2.LANG_CD
                ,T2.CMM_CD_TXT
                ,T2.REG_USR_ID
                ,T2.REG_DT
                ,T2.UPDT_USR_ID
                ,T2.UPDT_DT
                ,'N'
            )
    </update>

    <!-- 공통코드 텍스트 정보를 삭제한다. -->
    <delete id="deleteCommonCodeTxt" parameterType="CommonCodeTxtVO">
        /* [chn.bhmc.dms.cmm.sci.service.dao.CommonCodeIfDAO.deleteCommonCodeTxt] */
        DELETE FROM CM_0304IS
        WHERE
            CMM_CD = #{cmmCd}
            AND LANG_CD = #{langCd}
            AND CMM_GRP_CD = #{cmmGrpCd}
    </delete>
</mapper>