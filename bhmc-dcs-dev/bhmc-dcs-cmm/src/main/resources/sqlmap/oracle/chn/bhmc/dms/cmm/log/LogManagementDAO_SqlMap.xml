<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : LogManagementDAO_SqlMap.xml
    Description : 日志管理xml
    author chen shengan
    since 2021. 4. 28.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2021. 4. 28.      chen shengan        日志管理xml
-->
<mapper namespace="chn.bhmc.dms.cmm.log.service.dao.LogManagementDAO">

	<!-- 查询接收接口日志信息 -->
	<select id="selectReceiveInterfaceLog" parameterType="chn.bhmc.dms.cmm.log.vo.ReceiveInterfaceLogSearchVO" resultType="chn.bhmc.dms.cmm.log.vo.SelectAllReceiveInterfaceLogVO">
		SELECT *
          FROM (
              SELECT ROWNUM AS RNUM ,T1.*
                FROM (
					SELECT 
						RECEIVE_INTERFACE_LOG_ID,
						INTERFACE_CODE,
						INTERFACE_NAME,
						RESULT_STATUS,
						RECEIVE_TIME
					FROM TI_RECEIVE_INTERFACE_LOG
					WHERE 1 = 1
					<if test='interfaceCode != null and interfaceCode != ""'>
			            AND INTERFACE_CODE LIKE '%' || #{interfaceCode} || '%'
			        </if>
			        <if test='interfaceName != null and interfaceName != ""'>
			            AND INTERFACE_NAME LIKE '%' || #{interfaceName} || '%'
			        </if>
			        <if test="receiveTimeStart != null and receiveTimeStart != '' ">
						AND RECEIVE_TIME <![CDATA[ >= ]]> TO_DATE(#{receiveTimeStart}, 'yyyy-mm-dd')
					</if>
					<if test="receiveTimeEnd != null and receiveTimeEnd != '' ">
						AND RECEIVE_TIME <![CDATA[ < ]]> TO_DATE(#{receiveTimeEnd}, 'yyyy-mm-dd')+1
					</if>
					ORDER BY RECEIVE_INTERFACE_LOG_ID
					) T1
              <where>
                  <if test='firstIndex != -1 and lastIndex != -1'>
                   AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                  </if>
             </where>
             )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
	</select>
	
	<!-- 查询接收接口日志信息数量 -->
	<select id="selectReceiveInterfaceLogCnt" parameterType="chn.bhmc.dms.cmm.log.vo.ReceiveInterfaceLogSearchVO" resultType="int">
		SELECT 
			COUNT(*) AS VALUE
		FROM TI_RECEIVE_INTERFACE_LOG
		WHERE 1 = 1
		<if test='interfaceCode != null and interfaceCode != ""'>
            AND INTERFACE_CODE LIKE '%' || #{interfaceCode} || '%'
        </if>
        <if test='interfaceName != null and interfaceName != ""'>
            AND INTERFACE_NAME LIKE '%' || #{interfaceName} || '%'
        </if>
        <if test="receiveTimeStart != null and receiveTimeStart != '' ">
			AND RECEIVE_TIME <![CDATA[ >= ]]> TO_DATE(#{receiveTimeStart}, 'yyyy-mm-dd')
		</if>
		<if test="receiveTimeEnd != null and receiveTimeEnd != '' ">
			AND RECEIVE_TIME <![CDATA[ < ]]> TO_DATE(#{receiveTimeEnd}, 'yyyy-mm-dd')+1
		</if>
		ORDER BY RECEIVE_INTERFACE_LOG_ID
	</select>
	
	<!-- 根据接收接口日志id查询日志详细信息 -->
	<select id="selectReceiveInterfaceLogById" parameterType="chn.bhmc.dms.cmm.log.vo.ReceiveInterfaceLogSearchVO" resultType="chn.bhmc.dms.cmm.log.vo.SelectAllReceiveInterfaceLogVO">
		SELECT 
			RECEIVE_INTERFACE_LOG_ID,
			INTERFACE_CODE,
			INTERFACE_NAME,
			RECEIVE_MESSAGE,
			RESULT_MESSAGE,
			RESULT_STATUS,
			RECEIVE_TIME
		FROM TI_RECEIVE_INTERFACE_LOG
		WHERE RECEIVE_INTERFACE_LOG_ID = #{receiveInterfaceLogId}
	</select>
	
	<!-- 查询发送接口日志信息 -->
	<select id="selectSendInterfaceLog" parameterType="chn.bhmc.dms.cmm.log.vo.ReceiveInterfaceLogSearchVO" resultType="chn.bhmc.dms.cmm.log.vo.SelectAllSendInterfaceLogVO">
		SELECT *
          FROM (
              SELECT ROWNUM AS RNUM ,T1.*
                FROM (
					SELECT 
						SEND_INTERFACE_ID,
						INTERFACE_CODE,
						INTERFACE_NAME,
						RESULT_STATUS,
						RESEND_COUNT,
						SEND_TIME,
						RETURN_RESULT_TIME
					FROM TI_SEND_INTERFACE_LOG
					WHERE 1 = 1
					<if test='interfaceCode != null and interfaceCode != ""'>
			            AND INTERFACE_CODE LIKE '%' || #{interfaceCode} || '%'
			        </if>
			        <if test='interfaceName != null and interfaceName != ""'>
			            AND INTERFACE_NAME LIKE '%' || #{interfaceName} || '%'
			        </if>
			        <if test="receiveTimeStart != null and receiveTimeStart != '' ">
						AND SEND_TIME <![CDATA[ >= ]]> TO_DATE(#{receiveTimeStart}, 'yyyy-mm-dd')
					</if>
					<if test="receiveTimeEnd != null and receiveTimeEnd != '' ">
						AND SEND_TIME <![CDATA[ < ]]> TO_DATE(#{receiveTimeEnd}, 'yyyy-mm-dd')+1
					</if>
					ORDER BY SEND_INTERFACE_ID
					) T1
              <where>
                  <if test='firstIndex != -1 and lastIndex != -1'>
                   AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                  </if>
             </where>
             )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
	</select>
	
	<!-- 查询发送接口日志信息数量 -->
	<select id="selectSendInterfaceLogCnt" parameterType="chn.bhmc.dms.cmm.log.vo.ReceiveInterfaceLogSearchVO" resultType="int">
		SELECT 
			COUNT(*) AS VALUE
		FROM TI_SEND_INTERFACE_LOG
		WHERE 1 = 1
		<if test='interfaceCode != null and interfaceCode != ""'>
            AND INTERFACE_CODE LIKE '%' || #{interfaceCode} || '%'
        </if>
        <if test='interfaceName != null and interfaceName != ""'>
            AND INTERFACE_NAME LIKE '%' || #{interfaceName} || '%'
        </if>
        <if test="receiveTimeStart != null and receiveTimeStart != '' ">
			AND SEND_TIME <![CDATA[ >= ]]> TO_DATE(#{receiveTimeStart}, 'yyyy-mm-dd')
		</if>
		<if test="receiveTimeEnd != null and receiveTimeEnd != '' ">
			AND SEND_TIME <![CDATA[ < ]]> TO_DATE(#{receiveTimeEnd}, 'yyyy-mm-dd')+1
		</if>
		ORDER BY SEND_INTERFACE_ID
	</select>
	
	<!-- 根据发送接口日志id查询日志详细信息 -->
	<select id="selectSendInterfaceLogById" parameterType="chn.bhmc.dms.cmm.log.vo.ReceiveInterfaceLogSearchVO" resultType="chn.bhmc.dms.cmm.log.vo.SelectAllSendInterfaceLogVO">
		SELECT 
			SEND_INTERFACE_ID,
			INTERFACE_CODE,
			INTERFACE_NAME,
			REQUEST_MESSAGE,
			RESULT_MESSAGE,
			RESULT_STATUS,
			RESEND_COUNT,
			SEND_TIME,
			RETURN_RESULT_TIME
		FROM TI_SEND_INTERFACE_LOG
		WHERE SEND_INTERFACE_ID = #{sendInterfaceId}
	</select>

</mapper>