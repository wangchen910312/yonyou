<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="chn.bhmc.dms.bat.sal.rcp.service.dao.BatchInvImgInfoDAO">

    <select id="selectBatchInvBlobInfo" resultType="chn.bhmc.dms.bat.sal.rcp.vo.BatchInvImgInfoVo">
    /* [chn.bhmc.dms.sal.rcp.service.dao.BatchInvImgInfoDAO.BatchInvBlobInfo] */
	SELECT T2.* FROM (
		SELECT ROWNUM AS RUM,T1.* FROM (
			  	SELECT 
			  	RECEIPT_IMG,
				DLR_CD,
				VIN_NO,
				RECEIPT_NO,
				DEL_IMG,
				REG_DT,
				TO_CHAR(REG_DT,'YYYY') AS REG_YEAR,
				TO_CHAR(REG_DT,'MM') AS REG_MONTH,
				TO_CHAR(REG_DT,'DD') AS REG_DAY
				FROM SA_0501T
				ORDER BY REG_DT DESC
				)T1 
		WHERE 1=1
		AND DEL_IMG IS NULL
		AND RECEIPT_IMG IS NOT NULL
	)T2 WHERE  RUM <![CDATA[<=]]> 100
    </select>
    
    
    <update id="updateBatchInvBlobInfo" parameterType="chn.bhmc.dms.bat.sal.rcp.vo.BatchInvImgOutInfoVo">
    /* [chn.bhmc.dms.sal.rcp.service.dao.BatchInvImgInfoDAO.updateBatchInvBlobInfo] */
    UPDATE SA_0501T
    SET DEL_IMG = #{delImg},
    RECEIPT_IMG = '',
    IMG_PATH = #{imgPath}
    WHERE DLR_CD = #{dlrCd}
    AND VIN_NO = #{vinNo}
    AND RECEIPT_NO= #{receiptNo}
    </update>
</mapper>