<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : BatDmsDataInDAO_SqlMap.xml
    Description :
    author Hyoung Jun An
    since 2016. 07. 20.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 07. 20.  Hyoung Jun An     최초 생성
-->
<mapper namespace="chn.bhmc.dms.bat.crm.cmm.service.dao.BatDmsDataInDAO">

    <select id="selectDmsDataTableColumn" parameterType="string" resultType="Map">
        SELECT obj.object_name as tableNm
             , DECODE(atc.data_type, 'DATE', atc.column_name||'#DT', atc.column_name) as columnNm
             , atc.data_type as columnTp
        FROM all_tab_columns atc,
            (SELECT *
               FROM all_objects
             WHERE object_name = #{value}
               AND owner = 'DMSDB'
               AND object_type in ('TABLE','VIEW')
            ) obj
        WHERE atc.owner = obj.owner
          and atc.table_name = obj.object_name
        ORDER BY obj.object_name, atc.column_name
    </select>

   <insert id="exceMergeList" parameterType="map">
    /* [chn.bhmc.dms.bat.crm.cmm.service.dao.BatDmsDataInDAO.exceMergeList] */
        MERGE INTO ${tableNm} T1
        USING (
            <foreach item="dataMap" collection="dataList" open="" separator="UNION" close="">
            SELECT
                <!-- <foreach item="data" index="columnNm" collection="dataMap" open="" separator="," close="">
                    #{data} as ${columnNm}
                </foreach> -->
                <foreach item="column" collection="columnList" open="" separator="," close="">
                    <!-- <bind name="columnNm" value="column.get('COLUMNNM')"/> -->
                    <choose>
                        <when test='dataMap.containsKey(column.COLUMNNM) == true'>
                            <!-- <bind name="sValue" value="dataMap.get(columnNm)+''"/> -->
                            <!-- <bind name="sValue" value="${dataMap[column.COLUMNNM]}"/> -->
                            <!-- ${sValue}||${columnNm}||${dataMap[columnNm]}||#{dataMap[columnNm]}|| -->
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(column.COLUMNNM,"#DT")'>
                                    <bind name='sKey' value='@org.apache.commons.lang3.StringUtils@substringBeforeLast(column.COLUMNNM, "#DT")' />
                                    to_date('${dataMap[column.COLUMNNM]}','yyyymmddhh24miss') as ${sKey}
                                </when>
                                <otherwise>
                                    '${dataMap[column.COLUMNNM]}' AS ${column.COLUMNNM}
                                </otherwise>
                            </choose>
                        </when>
                        <otherwise>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(column.COLUMNNM,"#DT")'>
                                    <bind name='sKey' value='@org.apache.commons.lang3.StringUtils@substringBeforeLast(column.COLUMNNM, "#DT")' />
                                    null as ${sKey}
                                </when>
                                <otherwise>
                                    null AS ${column.COLUMNNM}
                                </otherwise>
                            </choose>
                        </otherwise>
                    </choose>
                    <!-- <if test='dataMap.containsKey(columnNm) == false'>
                        <bind name="sValue" value=""/>
                    </if> -->
                    <!-- #{sValue} as ${columnNm} -->
                    <!-- ${sValue, jdbcType=VARCHAR} -->
                    <!-- #{custNo} as ${column.COLUMNNM} -->
                    <!-- #{dataMap.get(column.get('COLUMNNM'))} AS ${column['COLUMNNM']} -->
                    <!-- ${sValue, jdbcType=VARCHAR} AS ${column['COLUMNNM']} -->
                    <!-- <choose>
                        <when test='@org.apache.commons.lang3.StringUtils@contains(columnNm,"#DT")'>
                            <bind name='sKey' value='@org.apache.commons.lang3.StringUtils@substringBeforeLast(columnNm, "#DT")' />
                            <choose>
                                <when test='sValue != null and sValue !=""'>
                                    to_date(#{sValue},'yyyymmddhh24miss') as ${sKey}
                                </when>
                                <otherwise>
                                    null as ${sKey}
                                </otherwise>
                            </choose>
                        </when>
                        <otherwise>
                            #{sValue} AS ${columnNm}
                        </otherwise>
                    </choose> -->
                </foreach>
            FROM DUAL
            </foreach>
        )T2 ON (
            T1.DLR_CD = T2.DLR_CD
            <choose>
                <when test='tableNm == "CR_0101T" or tableNm == "CR_0807T"
                         or talbeNm == "CR_0827T" '>
                    AND T1.CUST_NO = T2.CUST_NO
                </when>
                <when test='tableNm == "CR_0103T"
                         or tableNm == "CR_0111T" or tableNm == "CR_0116T"
                         or tableNm == "CR_0211T" or tableNm == "CR_0213T"
                         or tableNm == "CR_0214T" or tableNm == "CR_0906T"
                         or tableNm == "CR_0816T" or tableNm == "CR_0901T"
                         or tableNm == "CR_0822T" or tableNm == "CR_0826T"
                         or tableNm == "CR_0216T" '>
                    AND T1.SEQ = T2.SEQ
                </when>
                <when test='tableNm == "CR_0114T" '>
                    AND T1.GRP_SEQ = T2.GRP_SEQ
                </when>
                <when test='tableNm == "CR_0115T" '>
                    AND T1.GRP_SEQ = T2.GRP_SEQ
                    AND T1.CUST_NO = T2.CUST_NO
                    AND T1.GRP_TP = T2.GRP_TP
                </when>
                <when test='tableNm == "CR_0215T" '>
                    AND T1.HOLD_SEQ = T2.HOLD_SEQ
                </when>
                <!-- <when test='tableNm == "CR_0216T" '>
                    AND T1.ONDUTY_DT = T2.ONDUTY_DT
                    AND T1.ONDUTY_USR_ID = T2.ONDUTY_USR_ID
                    AND T1.ONDUTY_TP = T2.ONDUTY_TP
                </when> -->
                <when test='tableNm == "CR_0217T" '>
                    AND T1.USR_ID = T2.USR_ID
                </when>
                <when test='tableNm == "CR_0218T" '>
                    AND T1.DUP_SEQ = T2.DUP_SEQ
                </when>
                <when test='tableNm == "CR_0221T" '>
                    AND T1.TRACE_GRADE_CD = T2.TRACE_GRADE_CD
                </when>
                <when test='tableNm == "CR_0222T" '>
                    AND T1.STATS_DT = T2.STATS_DT
                </when>
                <when test='tableNm == "CR_0223T" '>
                    AND T1.C_SEQ = T2.C_SEQ
                </when>
                <when test='tableNm == "CR_0306T" '>
                    AND T1.CONTACT_NO = T2.CONTACT_NO
                </when>
                <when test='tableNm == "CR_0401T" '>
                    AND T1.PLT_CD = T2.PLT_CD
                    AND T1.TDRV_SEQ = T2.TDRV_SEQ
                </when>
                <when test='tableNm == "CR_0402T" '>
                    AND T1.PLT_CD = T2.PLT_CD
                    AND T1.TDRV_VIN_NO = T2.TDRV_VIN_NO
                </when>
                <when test='tableNm == "CR_0403T" '>
                    AND T1.PLT_CD = T2.PLT_CD
                    AND T1.CLINE_SEQ = T2.CLINE_SEQ
                </when>
                <when test='tableNm == "CR_0501T" '>
                    AND T1.CUST_CARE_SEQ = T2.CUST_CARE_SEQ
                </when>
                <when test='tableNm == "CR_0502T" '>
                    AND T1.TARG_CUST_SEQ = T2.TARG_CUST_SEQ
                </when>
                <when test='tableNm == "CR_0601T" '>
                    AND T1.VOC_NO = T2.VOC_NO
                </when>
                <when test='tableNm == "CR_0602T" '>
                    AND T1.VOC_NO = T2.VOC_NO
                    AND T1.VOC_ACTIVE_NO = T2.VOC_ACTIVE_NO
                </when>
                <when test='tableNm == "CR_0606T" '>
                    AND T1.CALL_SEQ = T2.CALL_SEQ
                </when>
                <when test='tableNm == "CR_0607T" '>
                    AND T1.CALL_HIS_SEQ = T2.CALL_HIS_SEQ
                </when>
                <when test='tableNm == "CR_0701T" '>
                    AND T1.MAK_CD = T2.MAK_CD
                </when>
                <when test='tableNm == "CR_0703T" '>
                    AND T1.MAK_CD = T2.MAK_CD
                    AND T1.EXTR_DGRE_CNT = T2.EXTR_DGRE_CNT
                </when>
                <when test='tableNm == "CR_0705T" '>
                    AND T1.MAK_CD = T2.MAK_CD
                    AND T1.BUDGET_CD = T2.BUDGET_CD
                </when>
                <when test='tableNm == "CR_0710T" '>
                    AND T1.MAK_CD = T2.MAK_CD
                    AND T1.TARG_CUST_SEQ = T2.TARG_CUST_SEQ
                </when>
                <when test='tableNm == "CR_0711T" or tableNm == "CR_0712T"'>
                    AND T1.MAK_CD = T2.MAK_CD
                    AND T1.SEQ = T2.SEQ
                </when>
                <when test='tableNm == "CR_0801T" '>
                    AND T1.MEMBERSHIP_NO = T2.MEMBERSHIP_NO
                </when>
                <when test='tableNm == "CR_0803T" '>
                    AND T1.MEMBERSHIP_NO = T2.MEMBERSHIP_NO
                    AND T1.POINT_HIS_SEQ = T2.POINT_HIS_SEQ
                </when>
                <when test='tableNm == "CR_0804T" '>
                    AND T1.MEMBERSHIP_NO = T2.MEMBERSHIP_NO
                    AND T1.GRADE_CHG_HIS_SEQ = T2.GRADE_CHG_HIS_SEQ
                </when>
                <when test='tableNm == "CR_0805T" '>
                    AND T1.GRADE_SEQ = T2.GRADE_SEQ
                </when>
                <when test='tableNm == "CR_0806T" '>
                    AND T1.TRSF_RECEIVE_SEQ = T2.TRSF_RECEIVE_SEQ
                </when>
                <when test='tableNm == "CR_0808T" '>
                    AND T1.POINT_HIS_SEQ = T2.POINT_HIS_SEQ
                </when>
                <when test='tableNm == "CR_0809T" '>
                    AND T1.MEMBERSHIP_GRADE_CHG_SEQ = T2.MEMBERSHIP_GRADE_CHG_SEQ
                </when>
                <when test='tableNm == "CR_0810T" '>
                    AND T1.MEMBERSHIP_GRADE_CHG_SEQ = T2.MEMBERSHIP_GRADE_CHG_SEQ
                    AND T1.MEMBERSHIP_NO = T2.MEMBERSHIP_NO
                </when>
                <when test='tableNm == "CR_0812T" '>
                    AND T1.EXTC_SEQ = T2.EXTC_SEQ
                </when>
                <when test='tableNm == "CR_0813T" '>
                    AND T1.MEMBERSHIP_NO = T2.MEMBERSHIP_NO
                    AND T1.CARD_TP_CD = T2.CARD_TP_CD
                    AND T1.CARD_NO = T2.CARD_NO
                </when>
                <when test='tableNm == "CR_0814T" '>
                    AND T1.PKG_SEQ = T2.PKG_SEQ
                </when>
                <when test='tableNm == "CR_0815T" '>
                    AND T1.PKG_SEQ = T2.PKG_SEQ
                    AND T1.CUPN_SEQ = T2.CUPN_SEQ
                </when>
                <when test='tableNm == "CR_0817T" '>
                    AND T1.TRSF_RECEIVE_SEQ = T2.TRSF_RECEIVE_SEQ
                    AND T1.TRSF_RECEIVE_DETL_SEQ = T2.TRSF_RECEIVE_DETL_SEQ
                </when>
                <when test='tableNm == "CR_0818T" '>
                    AND T1.CUPN_PREN_SEQ = T2.CUPN_PREN_SEQ
                </when>
                <when test='tableNm == "CR_0819T" '>
                    AND T1.SEQ = T2.SEQ
                    AND T1.MEMBERSHIP_NO = T2.MEMBERSHIP_NO
                </when>
                <when test='tableNm == "CR_0820T" '>
                    AND T1.CUPN_HIS_SEQ = T2.CUPN_HIS_SEQ
                </when>
                <when test='tableNm == "CR_0821T" '>
                    AND T1.CALC_SEQ = T2.CALC_SEQ
                </when>
                <when test='tableNm == "CR_0823T" '>
                    AND T1.CUPN_SEQ = T2.CUPN_SEQ
                </when>
                <when test='tableNm == "CR_0824T" '>
                    AND T1.PKG_SEQ = T2.PKG_SEQ
                </when>
                <when test='tableNm == "CR_0825T" '>
                    AND T1.PUBLI_NO = T2.PUBLI_NO
                </when>
                <when test='tableNm == "CR_0828T" '>
                    AND T1.CUST_NO = T2.CUST_NO
                    AND T1.CHR_SEQ = T2.CHR_SEQ
                </when>
                <when test='tableNm == "CR_0902T" '>
                    AND T1.SUBY_TMPL_SEQ = T2.SUBY_TMPL_SEQ
                </when>
                <when test='tableNm == "CR_0903T" '>
                    AND T1.SUBY_TMPL_SEQ = T2.SUBY_TMPL_SEQ
                    AND T1.SUBY_TMPL_QEST_SEQ = T2.SUBY_TMPL_QEST_SEQ
                </when>
                <when test='tableNm == "CR_0904T" '>
                    AND T1.SUBY_TMPL_SEQ = T2.SUBY_TMPL_SEQ
                    AND T1.SUBY_TMPL_QEST_SEQ = T2.SUBY_TMPL_QEST_SEQ
                    AND T1.ITEM_SEQ = T2.ITEM_SEQ
                </when>
                <when test='tableNm == "CR_0905T" '>
                    AND T1.STSF_IVST_RSLT_SEQ = T2.STSF_IVST_RSLT_SEQ
                </when>
                <when test='tableNm == "CR_1001T" '>
                    AND T1.CUST_EXTR_TERM_NO = T2.CUST_EXTR_TERM_NO
                </when>
                <when test='tableNm == "CR_1002T" '>
                    AND T1.CUST_EXTR_TERM_NO = T2.CUST_EXTR_TERM_NO
                    AND T1.DETL_EXTR_TERM_CD = T2.DETL_EXTR_TERM_CD
                </when>
                <otherwise></otherwise>
            </choose>
        )WHEN MATCHED THEN
           UPDATE SET
            <!-- <foreach item="column" index="key" collection="columnMap" open="" separator="," close=""> -->
            <foreach item="column" collection="columnList" open="" separator="," close="">
                <if test='column.COLUMNNM != "DLR_CD"'>
                    <choose>
                        <when test='(tableNm == "CR_0101T" or tableNm == "CR_0807T"
                                  or talbeNm == "CR_0827T" ) and (column.COLUMNNM == "CUST_NO")'></when>
                        <when test='(tableNm == "CR_0103T"
                                  or tableNm == "CR_0111T" or tableNm == "CR_0116T"
                                  or tableNm == "CR_0211T" or tableNm == "CR_0213T"
                                  or tableNm == "CR_0214T" or tableNm == "CR_0906T"
                                  or tableNm == "CR_0816T" or tableNm == "CR_0901T"
                                  or tableNm == "CR_0822T" or tableNm == "CR_0826T"
                                  or tableNm == "CR_0216T" ) and (column.COLUMNNM == "SEQ")'></when>
                        <when test='tableNm == "CR_0114T" and (column.COLUMNNM == "GRP_SEQ") ' ></when>
                        <when test='tableNm == "CR_0115T" and (column.COLUMNNM == "GRP_SEQ" or column.COLUMNNM == "CUST_NO" or column.COLUMNNM == "GRP_TP")'></when>
                        <when test='tableNm == "CR_0215T" and (column.COLUMNNM == "HOLD_SEQ") '></when>
                        <!-- <when test='tableNm == "CR_0216T" and (column.COLUMNNM == "ONDUTY_DT#DT" or column.COLUMNNM == "ONDUTY_USR_ID" or column.COLUMNNM == "ONDUTY_TP")'></when> -->
                        <when test='tableNm == "CR_0217T" and (column.COLUMNNM == "USR_ID") '></when>
                        <when test='tableNm == "CR_0218T" and (column.COLUMNNM == "DUP_SEQ") '></when>
                        <when test='tableNm == "CR_0221T" and (column.COLUMNNM == "TRACE_GRADE_CD") '></when>
                        <when test='tableNm == "CR_0222T" and (column.COLUMNNM == "STATS_DT") '></when>
                        <when test='tableNm == "CR_0223T" and (column.COLUMNNM == "C_SEQ") '></when>
                        <when test='tableNm == "CR_0306T" and (column.COLUMNNM == "CONTACT_NO") '></when>
                        <when test='tableNm == "CR_0401T" and (column.COLUMNNM == "PLT_CD" or column.COLUMNNM == "TDRV_SEQ" )'></when>
                        <when test='tableNm == "CR_0402T" and (column.COLUMNNM == "PLT_CD" or column.COLUMNNM == "TDRV_VIN_NO" )'></when>
                        <when test='tableNm == "CR_0403T" and (column.COLUMNNM == "PLT_CD" or column.COLUMNNM == "CLINE_SEQ" )'></when>
                        <when test='tableNm == "CR_0501T" and (column.COLUMNNM == "CUST_CARE_SEQ" )'></when>
                        <when test='tableNm == "CR_0502T" and (column.COLUMNNM == "TARG_CUST_SEQ" )'></when>
                        <when test='tableNm == "CR_0601T" and (column.COLUMNNM == "VOC_NO" )'> </when>
                        <when test='tableNm == "CR_0602T" and (column.COLUMNNM == "VOC_NO" or column.COLUMNNM == "VOC_ACTIVE_NO" )'></when>
                        <when test='tableNm == "CR_0606T" and (column.COLUMNNM == "CALL_SEQ" )'></when>
                        <when test='tableNm == "CR_0607T" and (column.COLUMNNM == "CALL_HIS_SEQ" )'></when>
                        <when test='tableNm == "CR_0701T" and (column.COLUMNNM == "MAK_CD" )'></when>
                        <when test='tableNm == "CR_0703T" and (column.COLUMNNM == "MAK_CD" or column.COLUMNNM == "EXTR_DGRE_CNT" )'></when>
                        <when test='tableNm == "CR_0705T" and (column.COLUMNNM == "MAK_CD" or column.COLUMNNM == "BUDGET_CD" )'></when>
                        <when test='tableNm == "CR_0710T" and (column.COLUMNNM == "MAK_CD" or column.COLUMNNM == "TARG_CUST_SEQ" )'></when>
                        <when test='(tableNm == "CR_0711T" or tableNm == "CR_0712T") and (column.COLUMNNM == "MAK_CD" or column.COLUMNNM == "SEQ" )'></when>
                        <when test='tableNm == "CR_0801T" and (column.COLUMNNM == "MEMBERSHIP_NO" )'></when>
                        <when test='tableNm == "CR_0803T" and (column.COLUMNNM == "MEMBERSHIP_NO" or column.COLUMNNM == "POINT_HIS_SEQ" )'></when>
                        <when test='tableNm == "CR_0804T" and (column.COLUMNNM == "MEMBERSHIP_NO" or column.COLUMNNM == "GRADE_CHG_HIS_SEQ" )'></when>
                        <when test='tableNm == "CR_0805T" and (column.COLUMNNM == "GRADE_SEQ" )'></when>
                        <when test='tableNm == "CR_0806T" and (column.COLUMNNM == "TRSF_RECEIVE_SEQ" )'></when>
                        <when test='tableNm == "CR_0808T" and (column.COLUMNNM == "POINT_HIS_SEQ" )'></when>
                        <when test='tableNm == "CR_0809T" and (column.COLUMNNM == "MEMBERSHIP_GRADE_CHG_SEQ" )'></when>
                        <when test='tableNm == "CR_0810T" and (column.COLUMNNM == "MEMBERSHIP_GRADE_CHG_SEQ" or column.COLUMNNM == "MEMBERSHIP_NO" )'></when>
                        <when test='tableNm == "CR_0812T" and (column.COLUMNNM == "EXTC_SEQ" ) '></when>
                        <when test='tableNm == "CR_0813T" and (column.COLUMNNM == "MEMBERSHIP_NO" or column.COLUMNNM == "CARD_TP_CD" or column.COLUMNNM == "CARD_NO")'></when>
                        <when test='tableNm == "CR_0814T" and (column.COLUMNNM == "PKG_SEQ" )'></when>
                        <when test='tableNm == "CR_0815T" and (column.COLUMNNM == "PKG_SEQ" or column.COLUMNNM == "CUPN_SEQ" )'></when>
                        <when test='tableNm == "CR_0817T" and (column.COLUMNNM == "TRSF_RECEIVE_SEQ" or column.COLUMNNM == "TRSF_RECEIVE_DETL_SEQ" )'></when>
                        <when test='tableNm == "CR_0818T" and (column.COLUMNNM == "CUPN_PREN_SEQ" )'></when>
                        <when test='tableNm == "CR_0819T" and (column.COLUMNNM == "SEQ" or column.COLUMNNM == "MEMBERSHIP_NO" )'></when>
                        <when test='tableNm == "CR_0820T" and (column.COLUMNNM == "CUPN_HIS_SEQ" )'></when>
                        <when test='tableNm == "CR_0821T" and (column.COLUMNNM == "CALC_SEQ" )'></when>
                        <when test='tableNm == "CR_0823T" and (column.COLUMNNM == "CUPN_SEQ" )'></when>
                        <when test='tableNm == "CR_0824T" and (column.COLUMNNM == "PKG_SEQ" )'></when>
                        <when test='tableNm == "CR_0825T" and (column.COLUMNNM == "PUBLI_NO" )'></when>
                        <when test='tableNm == "CR_0828T" and (column.COLUMNNM == "CUST_NO" or column.COLUMNNM == "CHR_SEQ" )'></when>
                        <when test='tableNm == "CR_0902T" and (column.COLUMNNM == "SUBY_TMPL_SEQ" )'></when>
                        <when test='tableNm == "CR_0903T" and (column.COLUMNNM == "SUBY_TMPL_SEQ" or column.COLUMNNM == "SUBY_TMPL_QEST_SEQ" )'></when>
                        <when test='tableNm == "CR_0904T" and (column.COLUMNNM == "SUBY_TMPL_SEQ" or column.COLUMNNM == "SUBY_TMPL_QEST_SEQ" or column.COLUMNNM == "ITEM_SEQ" )'></when>
                        <when test='tableNm == "CR_0905T" and (column.COLUMNNM == "STSF_IVST_RSLT_SEQ" )'></when>
                        <when test='tableNm == "CR_1001T" and (column.COLUMNNM == "CUST_EXTR_TERM_NO" )'></when>
                        <when test='tableNm == "CR_1002T" and (column.COLUMNNM == "CUST_EXTR_TERM_NO" or column.COLUMNNM == "DETL_EXTR_TERM_CD" )'></when>
                        <otherwise>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(column.COLUMNNM,"#DT")'>
                                    <bind name='sKey' value='@org.apache.commons.lang3.StringUtils@substringBeforeLast(column.COLUMNNM, "#DT")' />
                                      T1.${sKey} = T2.${sKey}
                                </when>
                                <otherwise>
                                      T1.${column.COLUMNNM} = T2.${column.COLUMNNM}
                                </otherwise>
                            </choose>
                        </otherwise>
                    </choose>
                </if>
            </foreach>
        WHEN NOT MATCHED THEN
           INSERT(
           <foreach item="column" collection="columnList" open="" separator="," close="">
           <!-- <foreach item="column" index="key" collection="columnMap" open="" separator="," close=""> -->
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(column.COLUMNNM,"#DT")'>
                        <bind name='sKey' value='@org.apache.commons.lang3.StringUtils@substringBeforeLast(column.COLUMNNM, "#DT")' />
                        T1.${sKey}
                    </when>
                    <otherwise>
                        T1.${column.COLUMNNM}
                    </otherwise>
                </choose>
           </foreach>
           ) VALUES (
           <foreach item="column" collection="columnList" open="" separator="," close="">
           <!-- <foreach item="column" index="key" collection="columnMap" open="" separator="," close=""> -->
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(column.COLUMNNM,"#DT")'>
                        <bind name='sKey' value='@org.apache.commons.lang3.StringUtils@substringBeforeLast(column.COLUMNNM, "#DT")' />
                        T2.${sKey}
                    </when>
                    <otherwise>
                        T2.${column.COLUMNNM}
                    </otherwise>
                </choose>
           </foreach>
           )
    </insert>

   <insert id="exceMerge" parameterType="map">
    /* [chn.bhmc.dms.bat.crm.cmm.service.dao.BatDmsDataInDAO.exceMerge] */
        MERGE INTO ${tableNm} T1
        USING (
            SELECT
                <foreach item="column" index="key" collection="columnMap" open="" separator="," close="">
                    <choose>
                        <when test='@org.apache.commons.lang3.StringUtils@contains(key,"#DT")'>
                            <bind name='sKey' value='@org.apache.commons.lang3.StringUtils@substringBeforeLast(key, "#DT")' />
                              to_date(#{column},'yyyymmddhh24miss') as ${sKey}
                        </when>
                        <otherwise>
                              #{column} as ${key}
                        </otherwise>
                    </choose>
                </foreach>
            FROM DUAL
        )T2 ON (
            T1.DLR_CD = T2.DLR_CD
            <choose>
                <when test='tableNm == "CR_0101T" or tableNm == "CR_0807T"
                         or talbeNm == "CR_0827T" '>
                    AND T1.CUST_NO = T2.CUST_NO
                </when>
                <when test='tableNm == "CR_0103T"
                         or tableNm == "CR_0111T" or tableNm == "CR_0116T"
                         or tableNm == "CR_0211T" or tableNm == "CR_0213T"
                         or tableNm == "CR_0214T" or tableNm == "CR_0906T"
                         or tableNm == "CR_0816T" or tableNm == "CR_0901T"
                         or tableNm == "CR_0822T" or tableNm == "CR_0826T"
                         or tableNm == "CR_0216T"  '>
                    AND T1.SEQ = T2.SEQ
                </when>
                <when test='tableNm == "CR_0114T" '>
                    AND T1.GRP_SEQ = T2.GRP_SEQ
                </when>
                <when test='tableNm == "CR_0115T" '>
                    AND T1.GRP_SEQ = T2.GRP_SEQ
                    AND T1.CUST_NO = T2.CUST_NO
                    AND T1.GRP_TP = T2.GRP_TP
                </when>
                <when test='tableNm == "CR_0215T" '>
                    AND T1.HOLD_SEQ = T2.HOLD_SEQ
                </when>
                <!-- <when test='tableNm == "CR_0216T" '>
                    AND T1.ONDUTY_DT = T2.ONDUTY_DT
                    AND T1.ONDUTY_USR_ID = T2.ONDUTY_USR_ID
                    AND T1.ONDUTY_TP = T2.ONDUTY_TP
                </when> -->
                <when test='tableNm == "CR_0217T" '>
                    AND T1.USR_ID = T2.USR_ID
                </when>
                <when test='tableNm == "CR_0218T" '>
                    AND T1.DUP_SEQ = T2.DUP_SEQ
                </when>
                <when test='tableNm == "CR_0221T" '>
                    AND T1.TRACE_GRADE_CD = T2.TRACE_GRADE_CD
                </when>
                <when test='tableNm == "CR_0222T" '>
                    AND T1.STATS_DT = T2.STATS_DT
                </when>
                <when test='tableNm == "CR_0223T" '>
                    AND T1.C_SEQ = T2.C_SEQ
                </when>
                <when test='tableNm == "CR_0306T" '>
                    AND T1.CONTACT_NO = T2.CONTACT_NO
                </when>
                <when test='tableNm == "CR_0401T" '>
                    AND T1.PLT_CD = T2.PLT_CD
                    AND T1.TDRV_SEQ = T2.TDRV_SEQ
                </when>
                <when test='tableNm == "CR_0402T" '>
                    AND T1.PLT_CD = T2.PLT_CD
                    AND T1.TDRV_VIN_NO = T2.TDRV_VIN_NO
                </when>
                <when test='tableNm == "CR_0403T" '>
                    AND T1.PLT_CD = T2.PLT_CD
                    AND T1.CLINE_SEQ = T2.CLINE_SEQ
                </when>
                <when test='tableNm == "CR_0501T" '>
                    AND T1.CUST_CARE_SEQ = T2.CUST_CARE_SEQ
                </when>
                <when test='tableNm == "CR_0502T" '>
                    AND T1.TARG_CUST_SEQ = T2.TARG_CUST_SEQ
                </when>
                <when test='tableNm == "CR_0601T" '>
                    AND T1.VOC_NO = T2.VOC_NO
                </when>
                <when test='tableNm == "CR_0602T" '>
                    AND T1.VOC_NO = T2.VOC_NO
                    AND T1.VOC_ACTIVE_NO = T2.VOC_ACTIVE_NO
                </when>
                <when test='tableNm == "CR_0606T" '>
                    AND T1.CALL_SEQ = T2.CALL_SEQ
                </when>
                <when test='tableNm == "CR_0607T" '>
                    AND T1.CALL_HIS_SEQ = T2.CALL_HIS_SEQ
                </when>
                <when test='tableNm == "CR_0701T" '>
                    AND T1.MAK_CD = T2.MAK_CD
                </when>
                <when test='tableNm == "CR_0703T" '>
                    AND T1.MAK_CD = T2.MAK_CD
                    AND T1.EXTR_DGRE_CNT = T2.EXTR_DGRE_CNT
                </when>
                <when test='tableNm == "CR_0705T" '>
                    AND T1.MAK_CD = T2.MAK_CD
                    AND T1.BUDGET_CD = T2.BUDGET_CD
                </when>
                <when test='tableNm == "CR_0710T" '>
                    AND T1.MAK_CD = T2.MAK_CD
                    AND T1.TARG_CUST_SEQ = T2.TARG_CUST_SEQ
                </when>
                <when test='tableNm == "CR_0711T" or tableNm == "CR_0712T"'>
                    AND T1.MAK_CD = T2.MAK_CD
                    AND T1.SEQ = T2.SEQ
                </when>
                <when test='tableNm == "CR_0801T" '>
                    AND T1.MEMBERSHIP_NO = T2.MEMBERSHIP_NO
                </when>
                <when test='tableNm == "CR_0803T" '>
                    AND T1.MEMBERSHIP_NO = T2.MEMBERSHIP_NO
                    AND T1.POINT_HIS_SEQ = T2.POINT_HIS_SEQ
                </when>
                <when test='tableNm == "CR_0804T" '>
                    AND T1.MEMBERSHIP_NO = T2.MEMBERSHIP_NO
                    AND T1.GRADE_CHG_HIS_SEQ = T2.GRADE_CHG_HIS_SEQ
                </when>
                <when test='tableNm == "CR_0805T" '>
                    AND T1.GRADE_SEQ = T2.GRADE_SEQ
                </when>
                <when test='tableNm == "CR_0806T" '>
                    AND T1.TRSF_RECEIVE_SEQ = T2.TRSF_RECEIVE_SEQ
                </when>
                <when test='tableNm == "CR_0808T" '>
                    AND T1.POINT_HIS_SEQ = T2.POINT_HIS_SEQ
                </when>
                <when test='tableNm == "CR_0809T" '>
                    AND T1.MEMBERSHIP_GRADE_CHG_SEQ = T2.MEMBERSHIP_GRADE_CHG_SEQ
                </when>
                <when test='tableNm == "CR_0810T" '>
                    AND T1.MEMBERSHIP_GRADE_CHG_SEQ = T2.MEMBERSHIP_GRADE_CHG_SEQ
                    AND T1.MEMBERSHIP_NO = T2.MEMBERSHIP_NO
                </when>
                <when test='tableNm == "CR_0812T" '>
                    AND T1.EXTC_SEQ = T2.EXTC_SEQ
                </when>
                <when test='tableNm == "CR_0813T" '>
                    AND T1.MEMBERSHIP_NO = T2.MEMBERSHIP_NO
                    AND T1.CARD_TP_CD = T2.CARD_TP_CD
                    AND T1.CARD_NO = T2.CARD_NO
                </when>
                <when test='tableNm == "CR_0814T" '>
                    AND T1.PKG_SEQ = T2.PKG_SEQ
                </when>
                <when test='tableNm == "CR_0815T" '>
                    AND T1.PKG_SEQ = T2.PKG_SEQ
                    AND T1.CUPN_SEQ = T2.CUPN_SEQ
                </when>
                <when test='tableNm == "CR_0817T" '>
                    AND T1.TRSF_RECEIVE_SEQ = T2.TRSF_RECEIVE_SEQ
                    AND T1.TRSF_RECEIVE_DETL_SEQ = T2.TRSF_RECEIVE_DETL_SEQ
                </when>
                <when test='tableNm == "CR_0818T" '>
                    AND T1.CUPN_PREN_SEQ = T2.CUPN_PREN_SEQ
                </when>
                <when test='tableNm == "CR_0819T" '>
                    AND T1.SEQ = T2.SEQ
                    AND T1.MEMBERSHIP_NO = T2.MEMBERSHIP_NO
                </when>
                <when test='tableNm == "CR_0820T" '>
                    AND T1.CUPN_HIS_SEQ = T2.CUPN_HIS_SEQ
                </when>
                <when test='tableNm == "CR_0821T" '>
                    AND T1.CALC_SEQ = T2.CALC_SEQ
                </when>
                <when test='tableNm == "CR_0823T" '>
                    AND T1.CUPN_SEQ = T2.CUPN_SEQ
                </when>
                <when test='tableNm == "CR_0824T" '>
                    AND T1.PKG_SEQ = T2.PKG_SEQ
                </when>
                <when test='tableNm == "CR_0825T" '>
                    AND T1.PUBLI_NO = T2.PUBLI_NO
                </when>
                <when test='tableNm == "CR_0828T" '>
                    AND T1.CUST_NO = T2.CUST_NO
                    AND T1.CHR_SEQ = T2.CHR_SEQ
                </when>
                <when test='tableNm == "CR_0902T" '>
                    AND T1.SUBY_TMPL_SEQ = T2.SUBY_TMPL_SEQ
                </when>
                <when test='tableNm == "CR_0903T" '>
                    AND T1.SUBY_TMPL_SEQ = T2.SUBY_TMPL_SEQ
                    AND T1.SUBY_TMPL_QEST_SEQ = T2.SUBY_TMPL_QEST_SEQ
                </when>
                <when test='tableNm == "CR_0904T" '>
                    AND T1.SUBY_TMPL_SEQ = T2.SUBY_TMPL_SEQ
                    AND T1.SUBY_TMPL_QEST_SEQ = T2.SUBY_TMPL_QEST_SEQ
                    AND T1.ITEM_SEQ = T2.ITEM_SEQ
                </when>
                <when test='tableNm == "CR_0905T" '>
                    AND T1.STSF_IVST_RSLT_SEQ = T2.STSF_IVST_RSLT_SEQ
                </when>
                <when test='tableNm == "CR_1001T" '>
                    AND T1.CUST_EXTR_TERM_NO = T2.CUST_EXTR_TERM_NO
                </when>
                <when test='tableNm == "CR_1002T" '>
                    AND T1.CUST_EXTR_TERM_NO = T2.CUST_EXTR_TERM_NO
                    AND T1.DETL_EXTR_TERM_CD = T2.DETL_EXTR_TERM_CD
                </when>
                <otherwise></otherwise>
            </choose>
        )WHEN MATCHED THEN
           UPDATE SET
            <foreach item="column" index="key" collection="columnMap" open="" separator="," close="">
                <if test='key != "DLR_CD"'>
                    <choose>
                        <when test='(tableNm == "CR_0101T" or tableNm == "CR_0807T"
                                  or talbeNm == "CR_0827T" ) and (key == "CUST_NO")'></when>
                        <when test='(tableNm == "CR_0103T"
                                  or tableNm == "CR_0111T" or tableNm == "CR_0116T"
                                  or tableNm == "CR_0211T" or tableNm == "CR_0213T"
                                  or tableNm == "CR_0214T" or tableNm == "CR_0906T"
                                  or tableNm == "CR_0816T" or tableNm == "CR_0901T"
                                  or tableNm == "CR_0822T" or tableNm == "CR_0826T"
                                  or tableNm == "CR_0216T" ) and (key == "SEQ")'></when>
                        <when test='tableNm == "CR_0114T" and (key == "GRP_SEQ") ' ></when>
                        <when test='tableNm == "CR_0115T" and (key == "GRP_SEQ" or key == "CUST_NO" or key == "GRP_TP")'></when>
                        <when test='tableNm == "CR_0215T" and (key == "HOLD_SEQ") '></when>
                        <!-- <when test='tableNm == "CR_0216T" and (key == "SEQ")'></when> -->
                        <when test='tableNm == "CR_0217T" and (key == "USR_ID") '></when>
                        <when test='tableNm == "CR_0218T" and (key == "DUP_SEQ") '></when>
                        <when test='tableNm == "CR_0221T" and (key == "TRACE_GRADE_CD") '></when>
                        <when test='tableNm == "CR_0222T" and (key == "STATS_DT") '></when>
                        <when test='tableNm == "CR_0223T" and (key == "C_SEQ") '></when>
                        <when test='tableNm == "CR_0306T" and (key == "CONTACT_NO") '></when>
                        <when test='tableNm == "CR_0401T" and (key == "PLT_CD" or key == "TDRV_SEQ" )'></when>
                        <when test='tableNm == "CR_0402T" and (key == "PLT_CD" or key == "TDRV_VIN_NO" )'></when>
                        <when test='tableNm == "CR_0403T" and (key == "PLT_CD" or key == "CLINE_SEQ" )'></when>
                        <when test='tableNm == "CR_0501T" and (key == "CUST_CARE_SEQ" )'></when>
                        <when test='tableNm == "CR_0502T" and (key == "TARG_CUST_SEQ" )'></when>
                        <when test='tableNm == "CR_0601T" and (key == "VOC_NO" )'> </when>
                        <when test='tableNm == "CR_0602T" and (key == "VOC_NO" or key == "VOC_ACTIVE_NO" )'></when>
                        <when test='tableNm == "CR_0606T" and (key == "CALL_SEQ" )'></when>
                        <when test='tableNm == "CR_0607T" and (key == "CALL_HIS_SEQ" )'></when>
                        <when test='tableNm == "CR_0701T" and (key == "MAK_CD" )'></when>
                        <when test='tableNm == "CR_0703T" and (key == "MAK_CD" or key == "EXTR_DGRE_CNT" )'></when>
                        <when test='tableNm == "CR_0705T" and (key == "MAK_CD" or key == "BUDGET_CD" )'></when>
                        <when test='tableNm == "CR_0710T" and (key == "MAK_CD" or key == "TARG_CUST_SEQ" )'></when>
                        <when test='(tableNm == "CR_0711T" or tableNm == "CR_0712T") and (key == "MAK_CD" or key == "SEQ" )'></when>
                        <when test='tableNm == "CR_0801T" and (key == "MEMBERSHIP_NO" )'></when>
                        <when test='tableNm == "CR_0803T" and (key == "MEMBERSHIP_NO" or key == "POINT_HIS_SEQ" )'></when>
                        <when test='tableNm == "CR_0804T" and (key == "MEMBERSHIP_NO" or key == "GRADE_CHG_HIS_SEQ" )'></when>
                        <when test='tableNm == "CR_0805T" and (key == "GRADE_SEQ" )'></when>
                        <when test='tableNm == "CR_0806T" and (key == "TRSF_RECEIVE_SEQ" )'></when>
                        <when test='tableNm == "CR_0808T" and (key == "POINT_HIS_SEQ" )'></when>
                        <when test='tableNm == "CR_0809T" and (key == "MEMBERSHIP_GRADE_CHG_SEQ" )'></when>
                        <when test='tableNm == "CR_0810T" and (key == "MEMBERSHIP_GRADE_CHG_SEQ" or key == "MEMBERSHIP_NO" )'></when>
                        <when test='tableNm == "CR_0812T" and (key == "EXTC_SEQ" ) '></when>
                        <when test='tableNm == "CR_0813T" and (key == "MEMBERSHIP_NO" or key == "CARD_TP_CD" or key == "CARD_NO")'></when>
                        <when test='tableNm == "CR_0814T" and (key == "PKG_SEQ" )'></when>
                        <when test='tableNm == "CR_0815T" and (key == "PKG_SEQ" or key == "CUPN_SEQ" )'></when>
                        <when test='tableNm == "CR_0817T" and (key == "TRSF_RECEIVE_SEQ" or key == "TRSF_RECEIVE_DETL_SEQ" )'></when>
                        <when test='tableNm == "CR_0818T" and (key == "CUPN_PREN_SEQ" )'></when>
                        <when test='tableNm == "CR_0819T" and (key == "SEQ" or key == "MEMBERSHIP_NO" )'></when>
                        <when test='tableNm == "CR_0820T" and (key == "CUPN_HIS_SEQ" )'></when>
                        <when test='tableNm == "CR_0821T" and (key == "CALC_SEQ" )'></when>
                        <when test='tableNm == "CR_0823T" and (key == "CUPN_SEQ" )'></when>
                        <when test='tableNm == "CR_0824T" and (key == "PKG_SEQ" )'></when>
                        <when test='tableNm == "CR_0825T" and (key == "PUBLI_NO" )'></when>
                        <when test='tableNm == "CR_0828T" and (key == "CUST_NO" or key == "CHR_SEQ" )'></when>
                        <when test='tableNm == "CR_0902T" and (key == "SUBY_TMPL_SEQ" )'></when>
                        <when test='tableNm == "CR_0903T" and (key == "SUBY_TMPL_SEQ" or key == "SUBY_TMPL_QEST_SEQ" )'></when>
                        <when test='tableNm == "CR_0904T" and (key == "SUBY_TMPL_SEQ" or key == "SUBY_TMPL_QEST_SEQ" or key == "ITEM_SEQ" )'></when>
                        <when test='tableNm == "CR_0905T" and (key == "STSF_IVST_RSLT_SEQ" )'></when>
                        <when test='tableNm == "CR_1001T" and (key == "CUST_EXTR_TERM_NO" )'></when>
                        <when test='tableNm == "CR_1002T" and (key == "CUST_EXTR_TERM_NO" or key == "DETL_EXTR_TERM_CD" )'></when>
                        <otherwise>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(key,"#DT")'>
                                    <bind name='sKey' value='@org.apache.commons.lang3.StringUtils@substringBeforeLast(key, "#DT")' />
                                      T1.${sKey} = T2.${sKey}
                                </when>
                                <otherwise>
                                      T1.${key} = T2.${key}
                                </otherwise>
                            </choose>
                        </otherwise>
                    </choose>
                </if>
            </foreach>
        WHEN NOT MATCHED THEN
           INSERT(
           <foreach item="column" index="key" collection="columnMap" open="" separator="," close="">
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(key,"#DT")'>
                        <bind name='sKey' value='@org.apache.commons.lang3.StringUtils@substringBeforeLast(key, "#DT")' />
                        T1.${sKey}
                    </when>
                    <otherwise>
                        T1.${key}
                    </otherwise>
                </choose>
           </foreach>
           ) VALUES (
           <foreach item="column" index="key" collection="columnMap" open="" separator="," close="">
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(key,"#DT")'>
                        <bind name='sKey' value='@org.apache.commons.lang3.StringUtils@substringBeforeLast(key, "#DT")' />
                        T2.${sKey}
                    </when>
                    <otherwise>
                        T2.${key}
                    </otherwise>
                </choose>
           </foreach>
           )
    </insert>

    <insert id="exceInsert" parameterType="map">
        INSERT INTO ${tableNm}(
           <foreach item="column" index="key" collection="columnMap" open="" separator="," close="">
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(key,"#DT")'>
                        <bind name='sKey' value='@org.apache.commons.lang3.StringUtils@substringBeforeLast(key, "#DT")' />
                        ${sKey}
                    </when>
                    <otherwise>
                        ${key}
                    </otherwise>
                </choose>
           </foreach>
             )
        VALUES(
           <foreach item="column" index="key" collection="columnMap" open="" separator="," close="">
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(key,"#DT")'>
                        to_date(#{column},'yyyymmddhh24miss')
                    </when>
                    <otherwise>
                        #{column}
                    </otherwise>
                </choose>
           </foreach>
           )
    </insert>

    <delete id="deleteData" parameterType="map">
        DELETE FROM ${tableNm} WHERE DLR_CD = #{dlrCd}
    </delete>

    <!-- BM 고객정보 I/F 및 고객정보 UPDATE 프로시져를 호출한다. -->
    <select id="procedureBM" statementType="CALLABLE" parameterType="java.lang.String">
        { call SP_CRM_BM_DCS_BMCUSTINFO_DLR (
            #{dlrCd, mode=IN, jdbcType=VARCHAR}
         ) }
    </select>

    <insert id="insertDataInHistory" parameterType="map">
        INSERT INTO CR_1302T (DLR_CD, FILE_NM, ALL_YN, DMS_DATA_UP_DT, REG_DT, REG_USR_ID)
        VALUES (#{dlrCd}, #{fileNm}, #{allYn}, #{dmsDataUpDt}, SYSDATE, 'SYSTEM')
    </insert>

    <update id="updateDataInLastData" parameterType="map">
      MERGE INTO CR_1301T T1
      USING (
            SELECT #{dlrCd} AS DLR_CD
                 , #{dmsDataUpDt} AS DMS_DATA_UP_DT
                 , #{allYn} AS DMS_DATA_ALL_YN
              FROM DUAL
      ) T2 ON (
              T1.DLR_CD = T2.DLR_CD
      )
      WHEN MATCHED THEN
        UPDATE
           SET T1.DMS_DATA_UP_DT = T2.DMS_DATA_UP_DT
             , T1.DMS_DATA_ALL_YN = DECODE(T2.DMS_DATA_ALL_YN,'N',T1.DMS_DATA_ALL_YN)
      WHEN NOT MATCHED THEN
        INSERT(  T1.DLR_CD
               , T1.DMS_DATA_UP_DT
               , T1.DMS_DATA_ALL_YN )
        VALUES(  T2.DLR_CD
               , T2.DMS_DATA_UP_DT
               , T2.DMS_DATA_ALL_YN )
    </update>

    <!-- 딜러 I/F 처리 현황 조회 -->
    <sql id="searchDmsIF">
       <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                 and dlr_cd like '%'||#{sDlrCd}||'%'
            </if>
            <if test='sDlrCdListIn != null and sDlrCdListIn.size != 0'>
                and dlr_cd in
                <foreach item="dlrCd" index="idx" collection="sDlrCdListIn" open="(" separator="," close=")">
                    #{dlrCd}
                </foreach>
            </if>
            <if test='sDlrCdListNotIn != null and sDlrCdListNotIn.size != 0'>
                and dlr_cd not in
                <foreach item="dlrCd" index="idx" collection="sDlrCdListNotIn" open="(" separator="," close=")">
                    #{dlrCd}
                </foreach>
            </if>
            <if test='sIfresult != null and sIfresult != ""'>
                 and IFRESULT = #{sIfresult}
            </if>
            <if test='sIfresult == null and sIfresult = ""'>
                 and IFRESULT IN ('P', 'E')
            </if>
       </where>
    </sql>

    <select id="selectDmsIFByConditionCnt" parameterType="Map" resultType="int">
        SELECT COUNT(*) AS VALUE
          FROM (
                select 'CR_0101IR' as if_tp, dlr_cd, to_number(if_seq) as if_seq, updatedate, createdate, ifresult, iffailmsg
                  from CR_0101IR
                <include refid="searchDmsIF" />
                union
                select 'CR_0601IR' as if_tp, dlr_cd, to_number(if_seq) as if_seq, updatedate , createdate, ifresult, iffailmsg
                  from CR_0601IR
                <include refid="searchDmsIF" />
                union
                select 'CR_0602IR' as if_tp, dlr_cd, to_number(if_seq) as if_seq, updatedate , createdate, ifresult, iffailmsg
                  from CR_0602IR
                <include refid="searchDmsIF" />
                union
                select 'CR_0211IR' as if_tp, dlr_cd, to_number(if_seq) as if_seq, updatedate , createdate, ifresult, iffailmsg
                  from CR_0211IR
                <include refid="searchDmsIF" />
                <if test='sBmYn == "Y"'>
                union
                select 'CR_0101IS_BM' as if_tp, dlr_cd, to_number(if_seq) as if_seq, updatedate , createdate, ifresult, iffailmsg
                  from CR_0101IS_BM
                <include refid="searchDmsIF" />
                </if>
             )T1
        INNER JOIN CM_0101T T2 ON T1.DLR_CD = T2.DLR_CD
        LEFT OUTER JOIN CR_1301T T3 ON T1.DLR_CD = T3.DLR_CD
        <where>
            <if test='sOpenStartDt != null and sOpenStartDt != ""'>
                AND T2.OPEN_DT <![CDATA[>=]]> #{sOpenStartDt}
            </if>
            <if test='sOpenEndDt != null and sOpenEndDt != ""'>
                AND T2.OPEN_DT <![CDATA[<=]]> #{sOpenEndDt}
            </if>
            <if test='sIfSuccessStartDt != null and sIfSuccessStartDt != ""'>
                AND T3.IF_SUCCESS_DT <![CDATA[>=]]> #{sIfSuccessStartDt}
            </if>
            <if test='sIfSuccessEndDt != null and sIfSuccessEndDt != ""'>
                AND T3.IF_SUCCESS_DT <![CDATA[<=]]> #{sIfSuccessEndDt}
            </if>
        </where>
    </select>

    <select id="selectDmsIFByCondition" parameterType="Map" resultType="hMap">
        SELECT * FROM (
            SELECT  ROWNUM AS RNUM, T.* FROM (
                SELECT T1.* FROM (
                        SELECT 'CR_0101IR' AS IF_TP, DLR_CD, TO_NUMBER(IF_SEQ) AS IF_SEQ, UPDATEDATE, CREATEDATE, IFRESULT, IFFAILMSG
                          FROM CR_0101IR
                        <include refid="searchDmsIF" />
                        UNION
                        SELECT 'CR_0601IR' AS IF_TP, DLR_CD, TO_NUMBER(IF_SEQ) AS IF_SEQ, UPDATEDATE , CREATEDATE, IFRESULT, IFFAILMSG
                          FROM CR_0601IR
                        <include refid="searchDmsIF" />
                        UNION
                        SELECT 'CR_0602IR' AS IF_TP, DLR_CD, TO_NUMBER(IF_SEQ) AS IF_SEQ, UPDATEDATE , CREATEDATE, IFRESULT, IFFAILMSG
                          FROM CR_0602IR
                        <include refid="searchDmsIF" />
                        UNION
                        SELECT 'CR_0211IR' AS IF_TP, DLR_CD, TO_NUMBER(IF_SEQ) AS IF_SEQ, UPDATEDATE , CREATEDATE, IFRESULT, IFFAILMSG
                          FROM CR_0211IR
                        <include refid="searchDmsIF" />
                        <if test='sBmYn == "Y"'>
                        UNION
                        SELECT 'CR_0101IS_BM' AS IF_TP, DLR_CD, TO_NUMBER(IF_SEQ) AS IF_SEQ, UPDATEDATE , CREATEDATE, IFRESULT, IFFAILMSG
                          FROM CR_0101IS_BM
                        <include refid="searchDmsIF" />
                        </if>
                    ) T1
                INNER JOIN CM_0101T T2 ON T1.DLR_CD = T2.DLR_CD
                LEFT OUTER JOIN CR_1301T T3 ON T1.DLR_CD = T3.DLR_CD
                <where>
                    <if test='sOpenStartDt != null and sOpenStartDt != ""'>
                        AND T2.OPEN_DT <![CDATA[>=]]> #{sOpenStartDt}
                    </if>
                    <if test='sOpenEndDt != null and sOpenEndDt != ""'>
                        AND T2.OPEN_DT <![CDATA[<=]]> #{sOpenEndDt}
                    </if>
                    <if test='sIfSuccessStartDt != null and sIfSuccessStartDt != ""'>
                        AND T3.IF_SUCCESS_DT <![CDATA[>=]]> #{sIfSuccessStartDt}
                    </if>
                    <if test='sIfSuccessEndDt != null and sIfSuccessEndDt != ""'>
                        AND T3.IF_SUCCESS_DT <![CDATA[<=]]> #{sIfSuccessEndDt}
                    </if>
                    <if test='sDmsUseYn != null and sDmsUseYn != ""'>
                        AND T2.DMS_USE_YN = #{sDmsUseYn}
                    </if>
                    <if test='sAliveYn != null and sAliveYn != ""'>
                        AND T2.ALIVE_YN = #{sAliveYn}
                    </if>
               </where>
                ORDER BY T1.DLR_CD
                ) T
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM <![CDATA[>]]> #{firstIndex}
            </if>
        </where>
    </select>

    <select id="selectDmsIFCountByCondition" parameterType="Map" resultType="hMap">
        SELECT * FROM (
            SELECT  ROWNUM AS RNUM, T.* FROM (
                SELECT T1.DLR_CD, MAX(T2.OPEN_DT) AS OPEN_DT, MAX(T2.DMS_IP_NM) AS DMS_IP_NM, COUNT(T1.IF_SEQ) AS CNT, MIN(T1.UPDATEDATE) AS MIN_UPDATEDATE, MAX(T3.IF_SUCCESS_DT) AS IF_SUCCESS_DT FROM (
                        SELECT 'CR_0101IR' AS IF_TP, DLR_CD, TO_NUMBER(IF_SEQ) AS IF_SEQ, UPDATEDATE, CREATEDATE, IFRESULT, IFFAILMSG
                          FROM CR_0101IR
                        <include refid="searchDmsIF" />
                        UNION
                        SELECT 'CR_0601IR' AS IF_TP, DLR_CD, TO_NUMBER(IF_SEQ) AS IF_SEQ, UPDATEDATE , CREATEDATE, IFRESULT, IFFAILMSG
                          FROM CR_0601IR
                        <include refid="searchDmsIF" />
                        UNION
                        SELECT 'CR_0602IR' AS IF_TP, DLR_CD, TO_NUMBER(IF_SEQ) AS IF_SEQ, UPDATEDATE , CREATEDATE, IFRESULT, IFFAILMSG
                          FROM CR_0602IR
                        <include refid="searchDmsIF" />
                        UNION
                        SELECT 'CR_0211IR' AS IF_TP, DLR_CD, TO_NUMBER(IF_SEQ) AS IF_SEQ, UPDATEDATE , CREATEDATE, IFRESULT, IFFAILMSG
                          FROM CR_0211IR
                        <include refid="searchDmsIF" />
                        <if test='sBmYn == "Y"'>
                        UNION
                        SELECT 'CR_0101IS_BM' AS IF_TP, DLR_CD, TO_NUMBER(IF_SEQ) AS IF_SEQ, UPDATEDATE , CREATEDATE, IFRESULT, IFFAILMSG
                          FROM CR_0101IS_BM
                        <include refid="searchDmsIF" />
                        </if>
                    ) T1
                INNER JOIN CM_0101T T2 ON T1.DLR_CD = T2.DLR_CD
                LEFT OUTER JOIN CR_1301T T3 ON T1.DLR_CD = T3.DLR_CD
                <where>
                    <if test='sOpenStartDt != null and sOpenStartDt != ""'>
                        AND T2.OPEN_DT <![CDATA[>=]]> #{sOpenStartDt}
                    </if>
                    <if test='sOpenEndDt != null and sOpenEndDt != ""'>
                        AND T2.OPEN_DT <![CDATA[<=]]> #{sOpenEndDt}
                    </if>
                    <if test='sIfSuccessStartDt != null and sIfSuccessStartDt != ""'>
                        AND T3.IF_SUCCESS_DT <![CDATA[>=]]> #{sIfSuccessStartDt}
                    </if>
                    <if test='sIfSuccessEndDt != null and sIfSuccessEndDt != ""'>
                        AND T3.IF_SUCCESS_DT <![CDATA[<=]]> #{sIfSuccessEndDt}
                    </if>
                    <if test='sDmsUseYn != null and sDmsUseYn != ""'>
                        AND T2.DMS_USE_YN = #{sDmsUseYn}
                    </if>
                    <if test='sAliveYn != null and sAliveYn != ""'>
                        AND T2.ALIVE_YN = #{sAliveYn}
                    </if>
               </where>
                GROUP BY T1.DLR_CD
                ORDER BY T1.DLR_CD
                ) T
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM <![CDATA[>]]> #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 딜러 Batch 처리 현황 조회 -->
    <sql id="searchDmsBat">
       <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND DLR_CD = #{sDlrCd}
            </if>
            <if test='sBatOperId != null and sBatOperId != ""'>
                AND BAT_OPER_ID = #{sBatOperId}
            </if>
            <if test='sBatStartTm != null and sBatStartTm != ""'>
                AND BAT_START_TM <![CDATA[>=]]> TO_DATE(#{sBatStartTm},'YYYYMMDD')
                AND BAT_START_TM <![CDATA[<]]>  TO_DATE(#{sBatStartTm},'YYYYMMDD')+1
            </if>
       </where>
    </sql>

    <select id="selectDmsBatByConditionCnt" parameterType="Map" resultType="int">
        SELECT COUNT(*) AS VALUE
          FROM CR_1011HT
        <include refid="searchDmsIF" />
    </select>

    <select id="selectDmsBatByCondition" parameterType="Map" resultType="hMap">
        SELECT * FROM (
            SELECT  ROWNUM AS RNUM, T1.* FROM (
                SELECT *
                  FROM CR_1011HT
                <include refid="searchDmsIF" />
                 ORDER BY DLR_CD, REG_DT
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM <![CDATA[>]]> #{firstIndex}
            </if>
        </where>
    </select>

    <select id="selectDealersByCondition" parameterType="DealerSearchVO" resultType="java.lang.String">
        SELECT DLR_CD
          FROM CM_0101T
        <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND DLR_CD = #{sDlrCd}
            </if>
            <if test='sDlrNm != null and sDlrNm != ""'>
                AND DLR_NM LIKE '%'||#{sDlrNm}||'%'
            </if>
            <if test='sDlrCdList != null and sDlrCdList.size != 0'>
                AND DLR_CD NOT IN
                <foreach item="dlrCd" index="idx" collection="sDlrCdList" open="(" separator="," close=")">
                    #{dlrCd}
                </foreach>
            </if>
            <if test='sDelYn != null and sDelYn != ""'>
                AND DEL_YN = #{sDelYn}
            </if>
            <if test='sOpenDt != null and sOpenDt != ""'>
                AND OPEN_DT <![CDATA[<=]]> #{sOpenDt}
            </if>
        </where>
    </select>

    <sql id="searchDmsList">
       <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND T1.DLR_CD LIKE '%'||#{sDlrCd}||'%'
            </if>
            <if test='sStartDt != null and sStartDt != ""'>
                AND T1.OPEN_DT <![CDATA[>=]]> #{sStartDt}
            </if>
            <if test='sEndDt != null and sEndDt != ""'>
                AND T1.OPEN_DT <![CDATA[<=]]> #{sEndDt}
            </if>
            <if test='sDmsIpNm != null and sDmsIpNm != ""'>
                AND T1.DMS_IP_NM = #{sDmsIpNm}
            </if>
            <if test='sAliveYn != null and sAliveYn != ""'>
                AND T1.ALIVE_YN = #{sAliveYn}
            </if>
            AND T1.OPEN_DT IS NOT NULL
       </where>
    </sql>

    <select id="selectDmsListByConditionCnt" parameterType="Map" resultType="int">
        SELECT COUNT(*) AS VALUE
          FROM CM_0101T T1
          LEFT OUTER JOIN CR_1301T T2 ON T1.DLR_CD = T2.DLR_CD
        <include refid="searchDmsList" />
    </select>

    <select id="selectDmsListByCondition" parameterType="Map" resultType="hMap">
        SELECT ROWNUM AS RNUM, DLR_CD, DLR_NM, OPEN_DT, DMS_IP_NM, DMS_USE_YN, ALIVE_YN, IF_SUCCESS_DT
          FROM (
            SELECT T1.DLR_CD, T1.DLR_NM, T1.OPEN_DT, T1.DMS_IP_NM, T1.DMS_USE_YN, T1.ALIVE_YN, T2.IF_SUCCESS_DT
              FROM CM_0101T T1
              LEFT OUTER JOIN CR_1301T T2 ON T1.DLR_CD = T2.DLR_CD
            <include refid="searchDmsList" />
             ORDER BY T1.DLR_CD, T1.OPEN_DT
         )
    </select>
</mapper>
