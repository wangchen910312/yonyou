<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="chn.bhmc.dms.bat.sal.rcp.service.dao.PullDownVehicleReceiptDAO">

	<!-- 查询所有“是否绑定车辆”字段为'N'的发票信息 -->
	<select id="selectVehicleReceipt" resultType="chn.bhmc.dms.bat.sal.rcp.vo.BatchVehicleReceiptVO">
		SELECT 
			CAR_ID, 
			VIN_NO, 
			RECEIPT_NO, 
			RECEIPT_CD, 
			RECEIPT_ISS_DT, 
			SUM_AMT, 
			RECEIPT_RESOURCE, 
			RECEIPT_IN_RESOURCE, 
			RECEIPT_STATUS, 
			CERT_FST,
			BINDING_CAR_YN
		FROM SA_0501T
		WHERE BINDING_CAR_YN = 'N'
	</select>
	
	<!-- 根据CAR_ID修改发票“是否绑定车辆”字段改为'Y' -->
	<update id="updateVehicleReceiptBindingCarYn">
		UPDATE SA_0501T 
		SET BINDING_CAR_YN = 'Y'
		WHERE CAR_ID IN 
		<foreach item="item" index="index" collection="list" open="(" separator="," close=")">
            #{item.carId}
        </foreach>
	</update>
	
	<!-- 查询所有从DCS拉取到的车辆信息 -->
	<select id="selectVehicle" resultType="chn.bhmc.dms.bat.sal.rcp.vo.BatchVehicleReceiptVO" >
		SELECT * FROM SA_0121T
		WHERE CAR_ID IN 
		<foreach item="item" index="index" collection="list" open="(" separator="," close=")">
            #{item.carId}
        </foreach>
	</select>
	
	<!-- 根据CAR_ID修改车辆信息表“绑定发票标识”字段为'02' -->
	<update id="updateVehicleBindingReceiptFlag">
		UPDATE SA_0121T
		SET BINDING_RECEIPT_FLAG = '01'
		WHERE CAR_ID IN 
		<foreach item="item" index="index" collection="list" open="(" separator="," close=")">
            #{item.carId}
        </foreach>
	</update>
	
	<!-- 根据CAR_ID修改车辆信息表“保修日期”字段为发票开票日期 -->
	<update id="updateVehicleGrteStartDt">
        <foreach item="item" index="index" collection="list" open="begin" separator=";" close=";end;">
	        UPDATE SA_0121T A 
			SET A.GRTE_START_DT = (SELECT MAX(RECEIPT_ISS_DT) FROM SA_0501T WHERE CAR_ID = #{item.carId})
			WHERE A.CAR_ID = #{item.carId}
		</foreach>
	</update>
	
	<insert id="addVehicle">
		INSERT INTO SA_0121T (
			CAR_ID,
			VIN_NO,
			VIN_NO1,
			VIN_NO2,
			CARLINE_CD,
			MODEL_CD,
			OCN_CD,
			EXT_COLOR_CD,
			INT_COLOR_CD,
			CAR_STAT_CD,
			OWN_STAT_CD,
			STOCK_TP,
			CAR_DSTIN_CD,
			STRGE_CD,
			LOC_CD,
			DLR_CD,
			SALE_TP,
			CONTRACT_NO,
			NCAR_DSTIN_CD,
			GREY_YN,
			GR_DT,
			CAR_REG_NO,
			MANUFACT_YY_MM_DT,
			GRTE_START_DT,
			GRTE_END_DT,
			DISUSE_DT,
			GRTE_STD_CD,
			DEL_YN,
			CAR_REG_DT,
			CORP_CAR_DSTIN_CD,
			MCAR_CD,
			MAKER_CD,
			ENGIN_MODEL_CD,
			ENGIN_SERIAL_NO,
			KEY_NO,
			TRIM_DT,
			SIGNOFF_DT,
			DLR_ORD_REQ_DT,
			CAR_VIN_ALLOC_DT,
			CAR_DUMP_CD,
			ORD_NO,
			ORD_DLR_CD,
			ORD_DLR_YY_MM_DT,
			ORD_MM_DT,
			ORD_SEQ,
			CERT_NO,
			TRSF_DLR_CD,
			TRSF_CMP_CD,
			TRSF_CMP_TRUCK_NO,
			ORD_TP,
			PLT_GI_DT,
			CERT_SECU_CD,
			ERP_ORD_NO,
			CMP_CD,
			DIST_CD,
			GRADE_CD,
			DIV_CD,
			ENGIN_NO,
			CAR_ALLOC_CANC_DT,
			INVC_PUBL_DT,
			CUST_SALE_DT,
			CUST_SALE_CANC_DT,
			DLR_GR_DT,
			VINM_ETC2,
			GR_RETURN_REASON_CD,
			VINM_ETC5,
			VINM_ETC6,
			ALLOC_DLR_CD,
			GR_RETURN_DT,
			VINM_CMIV,
			VINM_BKCD,
			VINM_BKTX,
			VINM_WARC,
			STAT_CD,
			VINM_CPGM,
			VINM_UPGM,
			RFID_NO,
			VINM_F20007,
			VINM_F20008,
			VINM_F20009,
			VINM_F20010,
			RETL_TP_CD,
			RETL_CANC_REASON_CD,
			CAR_NM,
			CAR_DISP_QTY,
			OPEN_YN,
			REMARK,
			LV2_DLR_ORG_CD,
			LV2_DLR_STOCK_YN,
			LV2_DLR_STOCK_GR_DT,
			CMP_CAR_YN,
			CMP_CAR_DSTIN_CD,
			CAR_RUN_DIST_VAL,
			TEC_ID,
			CAR_BRAND_CD,
			TEMP1,
			TEMP2,
			TEMP3,
			TEMP4,
			TEMP5,
			TEMP6,
			TEMP7,
			TEMP8,
			TEMP9,
			TEMP10,
			REG_USR_ID,
			REG_DT,
			UPDT_USR_ID,
			UPDT_DT,
			PRE_GI_YN,
			MM_CNT,
			DD_CNT,
			RETL_PRC,
			WHSL_PRC,
			DDCT_RATE,
			BLOCK_SALE_ADV_NO,
			TM_NO1,
			TM_NO2,
			CERT_SECU2_CD,
			JEONGPAN_NO,
			SALE_EMP_NO,
			EXPC_CHK_DT,
			EXPC_CHK_RUN_DIST_VAL,
			DAMAGE_CD,
			BLOCK_YN,
			STR_NO,
			STR_YN,
			VINM_BKWB,
			VINM_BKCM,
			VINM_WDATE,
			VINM_ZFBDT,
			ZFNEWEN,
			ZFNEWSUB,
			REL_DT,
			REL_STATUS,
			BINDING_RECEIPT_FLAG )
		<foreach collection="list" item="item" index="index" separator="union">
            SELECT 
                #{item.carId},
				#{item.vinNo},
				#{item.vinNo1},
				#{item.vinNo2},
				#{item.carlineCd},
				#{item.modelCd},
				#{item.ocnCd},
				#{item.extColorCd},
				#{item.intColorCd},
				#{item.carStatCd},
				#{item.ownStatCd},
				#{item.stockTp},
				#{item.carDstinCd},
				#{item.strgeCd},
				#{item.locCd},
				#{item.dlrCd},
				#{item.saleTp},
				#{item.contractNo},
				#{item.ncarDstinCd},
				#{item.greyYn},
				#{item.grDt},
				#{item.carRegNo},
				#{item.manufactYyMmDt},
				#{item.grteStartDt},
				#{item.grteEndDt},
				#{item.disuseDt},
				#{item.grteStdCd},
				#{item.delYn},
				#{item.carRegDt},
				#{item.corpCarDstinCd},
				#{item.mcarCd},
				#{item.makerCd},
				#{item.enginModelCd},
				#{item.enginSerialNo},
				#{item.keyNo},
				#{item.trimDt},
				#{item.signoffDt},
				#{item.dlrOrdReqDt},
				#{item.carVinAllocDt}, 
				#{item.carDumpCd},
				#{item.ordNo},
				#{item.ordDlrCd},
				#{item.ordDlrYyMmDt},
				#{item.ordMmDt},
				#{item.ordSeq},
				#{item.certNo},
				#{item.trsfDlrCd},
				#{item.trsfCmpCd},
				#{item.trsfCmpTruckNo},
				#{item.ordTp},
				#{item.pltGiDt},
				#{item.certSecuCd},
				#{item.erpOrdNo},
				#{item.cmpCd},
				#{item.distCd},
				#{item.gradeCd},
				#{item.divCd},
				#{item.enginNo},
				#{item.carAllocCancDt},
				#{item.invcPublDt},
				#{item.custSaleDt},
				#{item.custSaleCancDt},
				#{item.dlrGrDt},
				#{item.vinmEtc2},
				#{item.grReturnReasonCd},
				#{item.vinmEtc5},
				#{item.vinmEtc6},
				#{item.allocDlrCd},
				#{item.grReturnDt},
				#{item.vinmCmiv},
				#{item.vinmBkcd},
				#{item.vinmBktx},
				#{item.vinmWarc},
				#{item.statCd},
				#{item.vinmCpgm},
				#{item.vinmUpgm},
				#{item.rfidNo},
				#{item.vinmF20007},
				#{item.vinmF20008},
				#{item.vinmF20009},
				#{item.vinmF20010},
				#{item.retlTpCd},
				#{item.retlCancReasonCd},
				#{item.carNm},
				#{item.carDispQty},
				#{item.openYn},
				#{item.remark},
				#{item.lv2DlrOrgCd},
				#{item.lv2DlrStockYn},
				#{item.lv2DlrStockGrDt},
				#{item.cmpCarYn},
				#{item.cmpCarDstinCd},
				#{item.carRunDistVal},
				#{item.tecId},
				#{item.carBrandCd},
				#{item.temp1},
				#{item.temp2},
				#{item.temp3},
				#{item.temp4},
				#{item.temp5},
				#{item.temp6},
				#{item.temp7},
				#{item.temp8},
				#{item.temp9},
				#{item.temp10},
				#{item.regUsrId},
				#{item.regDt},
				#{item.updtUsrId},
				#{item.updtDt},
				#{item.preGiYn},
				#{item.mmCnt},
				#{item.ddCnt},
				#{item.retlPrc},
				#{item.whslPrc},
				#{item.ddctRate},
				#{item.blockSaleAdvNo},
				#{item.tmNo1},
				#{item.tmNo2},
				#{item.certSecu2Cd},
				#{item.jeongpanNo},
				#{item.saleEmpNo},
				#{item.expcChkDt},
				#{item.expcChkRunDistVal},
				#{item.damageCd},
				#{item.blockYn},
				#{item.strNo},
				#{item.strYn},
				#{item.vinmBkwb},
				#{item.vinmBkcm},
				#{item.vinmWdate},
				#{item.expcChkDt},
				#{item.zfnewen},
				#{item.zfnewsub},
				#{item.regDt},
				#{item.relStatus},
				#{item.bindingReceiptFlag}
            FROM DUAL
        </foreach>
	</insert>

</mapper>