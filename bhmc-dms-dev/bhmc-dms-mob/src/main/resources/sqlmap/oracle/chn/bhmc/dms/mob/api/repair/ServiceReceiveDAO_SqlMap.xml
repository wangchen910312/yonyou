<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : ServiceReceiveDAO_SqlMap.xml
    Description : 수납관리 마스터에 관한 데이터처리
    author Yin Xueyuan
    since 2016. 4. 20.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 4. 20.  Yin Xueyuan      최초 생성
-->

<mapper namespace="chn.bhmc.dms.mob.api.repair.dao.RepairServiceReceiveDAO">

    <select id="selectServiceReceiveByCondition" parameterType="ServiceReceiveSearchVO" resultType="chn.bhmc.dms.mob.api.repair.vo.ServiceReceiveVO">
        /* [chn.bhmc.dms.ser.rcv.service.dao.ServiceReceiveDAO.selectServiceReceiveByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM
                   ,T1.*
                   ,FN_CMM_CD_NM('COM020',T1.PAYM_YN,#{sLangCd},'N') AS PAYM_YN_NM
                   ,FN_CMM_CD_NM('SER070',T1.RCV_STAT_CD,#{sLangCd},'N') AS RCV_STAT_NM
                   ,FN_CMM_CD_NM('SER060',T1.PAYM_TP,#{sLangCd},'N') AS PAYM_TP_NM
                   ,FN_CMM_CD_NM('SER061',T1.PAYM_MTH_CD,#{sLangCd},'N') AS PAYM_MTH_NM
                   ,FN_CMM_CD_NM('SER062',T1.PAYM_PRID,#{sLangCd},'N') AS PAYM_PRID_NM
                   ,FN_CMM_CD_NM('SER072',T1.RCPT_TP,#{sLangCd},'N') AS RCPT_TP_NM
                   ,T1.PAYM_MTH_CD AS RCV_HIS_PAYM_MTH_CD
                   ,FN_CMM_CD_NM('SER061',T1.PAYM_MTH_CD,#{sLangCd},'N') AS RCV_HIS_PAYM_MTH_CD_NM
                   ,T1.RCPT_TP AS RCV_HIS_RCPT_TP
                   ,FN_CMM_CD_NM('SER072',T1.RCPT_TP,#{sLangCd},'N') AS RCV_HIS_RCPT_TP_NM
                   ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = T1.RO_REG_USR_ID AND DLR_CD = T1.DLR_CD) AS RO_REG_USR_NM
              FROM (
                     SELECT A.DLR_CD                               --딜러코드
                           ,A.RCV_DOC_NO                           --수납문서번호
                           ,A.RO_TP                                --RO유형
                           ,FN_CMM_CD_NM('SER031',A.RO_TP,#{sLangCd},'N') AS RO_TP_NM
                           ,A.RO_DOC_NO                            --RO문서번호
                           ,A.RO_GRP_NO                            --RO그룹번호
                           ,A.RESV_DOC_NO                          --예약문서번호
                           ,A.DIAG_DOC_NO                          --사전점검번호
                           ,A.PRE_CHK_DT                           --사전점검일자
                           ,A.BASE_RO_NO                           --원RO번호
                           ,A.INC_REQ_NO                           --보험신청번호
                           ,A.CUST_REMARK                          --고객비고
                           ,A.VIN_NO                               --차대번호
                           ,A.CAR_REG_NO                           --차량등록번호
                           ,A.ENGIN_NO                             --엔진시리얼번호
                           ,A.CAR_OWNER_ID                         --차량소유자ID
                           ,A.CAR_OWNER_NM                         --차량소유자명
                           ,A.DRIVER_ID                            --운전자ID
                           ,A.DRIVER_NM                            --운전자명
                           ,A.RESV_DT                              --예약일자
                           ,A.RUN_DIST_VAL                         --주행거리값
                           ,A.LBR_CALC_AMT                         --공임정산금액
                           ,A.LBR_DC_RATE                          --공임할인율
                           ,A.LBR_DC_AMT                           --공임할인금액
                           ,A.LBR_BM_POINT_USE_AMT                 --공임BM포인트사용금액
                           ,A.LBR_POINT_USE_AMT                    --공임포인트사용금액
                           ,A.LBR_ETC_DC_AMT                       --공임기타할인금액
                           ,A.LBR_CALC_SUM_AMT                     --공임정산합계금액
                           ,A.PAR_CALC_AMT                         --부품정산금액
                           ,A.PAR_DC_RATE                          --부품할인율
                           ,A.PAR_DC_AMT                           --부품할인금액
                           ,A.PAR_BM_POINT_USE_AMT                 --부품BM포인트사용금액
                           ,A.PAR_POINT_USE_AMT                    --부품포인트사용금액
                           ,A.PAR_ETC_DC_AMT                       --부품기타할인금액
                           ,A.PAR_CALC_SUM_AMT                     --부품정산합계금액
                           ,A.ETC_CALC_AMT                         --기타정산금액
                           ,A.ETC_DC_RATE                          --기타할인율
                           ,A.ETC_DC_AMT                           --기타할인금액
                           ,A.ETC_BM_POINT_USE_AMT                 --기타BM포인트사용금액
                           ,A.ETC_POINT_USE_AMT                    --기타포인트사용금액
                           ,A.ETC_OTHER_DC_AMT                     --기타다른할인금액
                           ,A.ETC_CALC_SUM_AMT                     --기타정산합계금액
                           ,A.CALC_TOT_AMT                         --정산총금액
                           ,A.DC_TOT_RATE                          --할인총율
                           ,A.DC_TOT_AMT                           --할인총금액
                           ,A.BM_POINT_TOT_AMT                     --BM포인트총금액
                           ,A.POINT_TOT_AMT                        --포인트총금액
                           ,A.ETC_TOT_AMT                          --기타총금액
                           ,A.LAST_CALC_TOT_AMT                    --최종정산총금액
                           ,A.CALC_DT                              --정산일자
                           ,A.CALC_STAT_CD                         --정산상태코드
                           ,A.CALC_DOC_NO                          --정산번호
                           ,A.CALC_PRSN_ID                         --정산번호
                           ,A.CALC_PRSN_NM                         --정산번호
                           ,B.RCV_SUB_DOC_NO                       --수납문서번호
                           ,B.PAYM_TP
                           ,B.PAYM_PRID
                           ,B.PAYM_MTH_CD
                           ,NVL(B.PAYM_AMT,0) AS PAYM_AMT          --수납금액
                           ,NVL(B.NPAY_AMT, NVL(B.PAYM_AMT,0) - NVL(B.RCV_AMT,0)) AS NPAY_AMT  --미수금액
                           ,B.PAYM_REMARK
                           ,B.PAYM_USR_NM
                           ,NVL(B.CALC_AMT,0)  AS CALC_AMT         --정산금액
                           ,NVL(B.RCV_AMT,0)   AS RCV_AMT          --실수금액
                           ,B.RCV_CPLT_DT                          --수납완성일자
                           ,B.NPAY_CHK_DT                          --미수확인일자
                           ,B.RCPT_TP                              --영수증유형
                           ,B.RCPT_NO                              --영수증번호
                           ,B.RCPT_DT                              --영수증일자
                           ,B.RCV_REMARK                           --수납비고
                           ,NVL(B.RCV_STAT_CD, 'O') RCV_STAT_CD    --수납상태
                           ,B.RCV_CANC_YN                          --수납취소여부
                           ,B.RCV_CANC_DT                          --수납취소일자
                           ,B.RCV_CANC_ID                          --수납취소ID
                           ,B.PAYM_CD
                           ,NVL(B.PAR_AMT,0)  AS PAR_AMT
                           ,NVL(B.LBR_AMT,0)  AS LBR_AMT
                           ,NVL(B.ETC_AMT,0)  AS ETC_AMT
                           ,NVL(B.WON_UNIT_CUT_AMT,0) AS WON_UNIT_CUT_AMT       --정산절사
                           ,NVL(B.DEMIC_POINT_CUT_AMT,0) AS DEMIC_POINT_CUT_AMT    --정산제로
                           ,B.DC_PERM_CD
                           ,NVL(B.DC_RATE,0)  AS DC_RATE
                           ,NVL(B.BAL_AMT,0)  AS BAL_AMT
                           ,NVL(B.PRE_AMT,0)  AS PRE_AMT
                           ,B.CUPN_NO
                           ,NVL(B.CUPN_AMT,0) AS CUPN_AMT
                           ,NVL(B.REFD_AMT,0) AS REFD_AMT
                           ,B.REFD_DT
                           ,B.REFD_PRSN_NM
                           ,B.REFD_REMARK
                           ,CASE WHEN NVL(B.RCV_AMT,0) = NVL(B.PAYM_AMT,0) AND B.RCV_STAT_CD = 'F' THEN 'Y' ELSE 'N' END AS PAYM_YN
                           ,(SELECT RO_DT
                               FROM SE_0300T
                              WHERE DLR_CD    = A.DLR_CD
                                AND RO_DOC_NO = A.RO_DOC_NO
                                AND RO_TP     = A.RO_TP
                            )AS RO_DT
                           ,(SELECT REG_USR_ID
                               FROM SE_0300T
                              WHERE DLR_CD    = A.DLR_CD
                                AND RO_DOC_NO = A.RO_DOC_NO
                                AND RO_TP     = A.RO_TP
                            )AS RO_REG_USR_ID
                            ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CAR_RUN_DIST_VAL
                            ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                            ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                       FROM SE_0550T A, SE_0560T B
                      WHERE B.DLR_CD     = A.DLR_CD
                        AND B.RCV_DOC_NO = A.RCV_DOC_NO
                        AND A.DLR_CD     = #{sDlrCd}
                        <if test='sSerParDstinCd != null and sSerParDstinCd != ""'>
                        AND A.SER_PAR_DSTIN_CD = #{sSerParDstinCd}
                        </if>
                        <if test='sCalcFromDt != null'>
                        AND A.CALC_DT <![CDATA[>=]]> #{sCalcFromDt}
                        </if>
                        <if test='sCalcToDt != null'>
                        AND A.CALC_DT <![CDATA[<]]> #{sCalcToDt} + 1
                        </if>
                        <if test='sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE  '%'||  #{sVinNo} ||'%'         -- VIN NO
                        </if>
                        <if test='sRoDocNo != null and sRoDocNo != ""'>
                        AND A.RO_DOC_NO LIKE  '%'|| #{sRoDocNo} ||'%'     --RO NO
                        </if>
                        <if test='sPaymUsrNm != null and sPaymUsrNm != ""'>
                        AND B.PAYM_USR_NM LIKE  '%'|| #{sPaymUsrNm} ||'%' --지불자
                        </if>
                        <if test='sCarRegNo != null and sCarRegNo != ""'>
                        AND A.CAR_REG_NO LIKE '%'|| #{sCarRegNo} ||'%'    --차량번호
                        </if>
                        <if test='sDriverNm != null and sDriverNm != ""'>
                        AND A.DRIVER_NM LIKE '%'|| #{sDriverNm} ||'%'     --수리의뢰자
                        </if>
                        <if test='sRcvDocNo != null and sRcvDocNo != ""'>
                        AND A.RCV_DOC_NO LIKE '%'|| #{sRcvDocNo} ||'%'    --결제문서번호
                        </if>
                        <if test='sPaymTp != null and sPaymTp != ""'>
                        AND B.PAYM_TP = #{sPaymTp}                        --지불유형
                        </if>
                        <if test='sCalcPrsnNm != null and sCalcPrsnNm != ""'>
                        AND A.CALC_PRSN_NM LIKE '%'|| #{sCalcPrsnNm} ||'%' --정비정산자
                        </if>
                        <if test='sRoTp != null and sRoTp != ""'>
                        AND A.RO_TP = #{sRoTp}                            -- RO유형
                        </if>
                        <if test='sPaymPrid != null and sPaymPrid != ""'>
                        AND B.PAYM_PRID = #{sPaymPrid}                    -- 지불기한
                        </if>
                        <if test='sCalcStatCd != null and sCalcStatCd != ""'>
                        AND A.CALC_STAT_CD = #{sCalcStatCd}                    -- 정산상태
                        </if>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                 <when test='item.field == "dlrCd"'>               A.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                 <when test='item.field == "rcvDocNo"'>            A.RCV_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                 <when test='item.field == "roTp"'>                A.RO_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                 <when test='item.field == "roDocNo"'>             A.RO_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                 <when test='item.field == "roGrpNo"'>             A.RO_GRP_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                 <when test='item.field == "resvDocNo"'>           A.RESV_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                 <when test='item.field == "vinNo"'>               A.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                 <when test='item.field == "carRegNo"'>            A.CAR_REG_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                 <when test='item.field == "carOwnerId"'>          A.CAR_OWNER_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                 <when test='item.field == "carOwnerNm"'>          A.CAR_OWNER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                 <when test='item.field == "driverId"'>            A.DRIVER_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                 <when test='item.field == "driverNm"'>            A.DRIVER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                 <when test='item.field == "resvDt"'>              A.RESV_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>             </when>
                                 <when test='item.field == "runDistVal"'>          A.RUN_DIST_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                 <when test='item.field == "lbrCalcAmt"'>          A.LBR_CALC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                 <when test='item.field == "lbrDcRate"'>           A.LBR_DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                 <when test='item.field == "lbrDcAmt"'>            A.LBR_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                 <when test='item.field == "lbrBmPointUseAmt"'>    A.LBR_BM_POINT_USE_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                 <when test='item.field == "lbrPointUseAmt"'>      A.LBR_POINT_USE_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>   </when>
                                 <when test='item.field == "lbrEtcDcAmt"'>         A.LBR_ETC_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                 <when test='item.field == "lbrCalcSumAmt"'>       A.LBR_CALC_SUM_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                 <when test='item.field == "parCalcAmt"'>          A.PAR_CALC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                 <when test='item.field == "parDcRate"'>           A.PAR_DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                 <when test='item.field == "parDcAmt"'>            A.PAR_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                 <when test='item.field == "parBmPointUseAmt"'>    A.PAR_BM_POINT_USE_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                 <when test='item.field == "parPointUseAmt"'>      A.PAR_POINT_USE_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>   </when>
                                 <when test='item.field == "parEtcDcAmt"'>         A.PAR_ETC_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                 <when test='item.field == "parCalcSumAmt"'>       A.PAR_CALC_SUM_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                 <when test='item.field == "etcCalcAmt"'>          A.ETC_CALC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                 <when test='item.field == "etcDcRate"'>           A.ETC_DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                 <when test='item.field == "etcDcAmt"'>            A.ETC_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                 <when test='item.field == "etcBmPointUseAmt"'>    A.ETC_BM_POINT_USE_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                 <when test='item.field == "etcPointUseAmt"'>      A.ETC_POINT_USE_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>   </when>
                                 <when test='item.field == "etcOtherDcAmt"'>       A.ETC_OTHER_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                 <when test='item.field == "etcCalcSumAmt"'>       A.ETC_CALC_SUM_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                 <when test='item.field == "calcTotAmt"'>          A.CALC_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                 <when test='item.field == "dcTotRate"'>           A.DC_TOT_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                 <when test='item.field == "dcTotAmt"'>            A.DC_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                 <when test='item.field == "bmPointTotAmt"'>       A.BM_POINT_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                 <when test='item.field == "pointTotAmt"'>         A.POINT_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                 <when test='item.field == "etcTotAmt"'>           A.ETC_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                 <when test='item.field == "lastCalcTotAmt"'>      A.LAST_CALC_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>   </when>
                                 <when test='item.field == "calcDt"'>              A.CALC_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>             </when>
                                 <when test='item.field == "calcStatCd"'>          A.CALC_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                 <when test='item.field == "calcDocNo"'>           A.CALC_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                 <when test='item.field == "rcvStatCd"'>           A.RCV_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                <otherwise>
                                    A.CALC_DOC_NO DESC ,A.RCV_DOC_NO DESC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        A.CALC_DOC_NO DESC ,A.RCV_DOC_NO DESC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
                <if test='sRcvStatCd != null and sRcvStatCd != ""'>
                AND T1.RCV_STAT_CD = #{sRcvStatCd}              --수납상세 상태코드
                </if>
                <if test='sPaymYn != null and sPaymYn != ""'>
                AND T1.PAYM_YN = #{sPaymYn}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>
	
    <select id="selectServiceReceiveStatusByCondition" parameterType="ServiceReceiveSearchVO" resultType="chn.bhmc.dms.mob.api.repair.vo.ServiceReceiveVO">
        /* [chn.bhmc.dms.mob.api.repair.dao.ServiceReceiveAppDAO.selectServiceReceiveStatusByCondition] */

        SELECT * FROM (
            SELECT T6.* FROM (
                SELECT ROWNUM AS RNUM
                      ,T5.*
                      ,FN_CMM_CD_NM('COM020',T5.PAYM_YN ,#{sLangCd},'N') AS PAYM_YN_NM
                      ,CASE WHEN PAYM_YN = 'Y' THEN PAYM_YN_DT END PAYM_YN_DT
                  FROM (
                     SELECT T2.*
                           ,T3.PAYM_TP                                                                        --결제유형
                           ,NVL(T4.RCV_STAT_CD,'O')                                        AS RCV_HIST_STAT_CD  --수납상태
                           ,FN_CMM_CD_NM('SER070',NVL(T2.RCV_STAT_CD,'O') ,#{sLangCd},'N') AS RCV_STAT_NM
                           ,FN_CMM_CD_NM('SER060',T4.PAYM_TP ,#{sLangCd},'N') AS PAYM_TP_NM
                           ,T3.PAYM_USR_NM                                                                    --결재사용자명
                           ,T3.PAYM_CD
                           ,T3.PAYM_REMARK
                           ,T3.PAYM_PRID
                           ,FN_CMM_CD_NM('SER062',T3.PAYM_PRID,#{sLangCd},'N') AS PAYM_PRID_NM
                           ,T3.RCV_SUB_DOC_NO
                           ,NVL(T3.RCV_AMT ,0) AS RCV_AMT
                           ,NVL(T3.CALC_AMT,0) AS CALC_AMT                                                    --발생금액
                           ,T3.RCV_CPLT_DT
                           ,CASE WHEN T2.RO_TP = '02' THEN 0 ELSE NVL(T3.PAYM_AMT , 0) END AS PAYM_AMT
                           ,NVL(T3.NPAY_AMT, NVL(T3.PAYM_AMT,0) - NVL(T3.RCV_AMT,0))  AS NPAY_AMT
                           ,CASE WHEN T2.RO_TP = '02' THEN 0 ELSE NVL(T3.WON_UNIT_CUT_AMT,0 ) END AS WON_UNIT_CUT_AMT
                           ,CASE WHEN T2.RO_TP = '02' THEN 0 ELSE NVL(T3.DEMIC_POINT_CUT_AMT,0) END AS DEMIC_POINT_CUT_AMT    --정산제로
                           ,FN_CMM_CD_NM('SER071',CASE WHEN NVL(T4.RCV_STAT_CD, 'O') = 'R'
                                                       THEN T4.RCV_STAT_CD
                                                       ELSE (CASE WHEN T4.RCV_STAT_CD = '02'
                                                                  THEN 'F'
                                                                  ELSE T4.RCV_STAT_CD END) END ,#{sLangCd},'N')  AS RCV_HIST_STAT_NM
                           ,T3.PAYM_MTH_CD
                           ,FN_CMM_CD_NM('SER061',T3.PAYM_MTH_CD,#{sLangCd},'N') AS PAYM_MTH_CD_NM
                           ,T4.PAYM_MTH_CD AS RCV_HIS_PAYM_MTH_CD
                           ,FN_CMM_CD_NM('SER061',T4.PAYM_MTH_CD,#{sLangCd},'N') AS RCV_HIS_PAYM_MTH_CD_NM
                           ,CASE WHEN T4.RCV_STAT_CD = 'R'
                                  THEN -1 * NVL(T4.RCV_AMT,0)
                                  ELSE NVL(T4.RCV_AMT,0) END AS RCV_HIST_AMT     --수납금액
                           ,T4.RCV_CPLT_DT AS RCV_CPLT_HIST_DT
                           ,T4.REG_USR_ID
                           ,T4.REG_DT AS RCV_HIST_REG_DT                             --수납일자
                           ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = T4.REG_USR_ID AND DLR_CD = T4.DLR_CD)      AS REG_USR_NM
                           ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = T2.RO_REG_USR_ID AND DLR_CD = T4.DLR_CD)   AS RO_REG_USR_NM
                           ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = T2.CALC_REG_USR_ID AND DLR_CD = T4.DLR_CD) AS CALC_REG_USR_NM
                           ,T3.RCPT_TP
                           ,T4.RCPT_TP AS RCV_HIS_RCPT_TP                       --영수증유형
                           ,FN_CMM_CD_NM('SER072',T3.RCPT_TP,#{sLangCd},'N') AS RCPT_TP_NM
                           ,FN_CMM_CD_NM('SER072',T4.RCPT_TP,#{sLangCd},'N') AS RCV_HIS_RCPT_TP_NM
                           ,T4.RCPT_NO                       --영수증번호
                           ,T4.RCPT_DT
                           ,T4.RCV_REMARK
                           ,CASE WHEN NVL(T3.RCV_AMT,0) = NVL(T3.PAYM_AMT,0) AND T3.RCV_STAT_CD = 'F' THEN 'Y' ELSE 'N' END AS PAYM_YN --지불완료여부
                           ,T3.REG_DT AS PAYM_YN_DT
                           ,FN_CMM_CD_NM('SER044',T2.DLR_RO_TP,#{sLangCd},'N') AS DLR_RO_TP_NM --자체정의RO유형
                       FROM (
                             SELECT T1.DLR_CD                      --딜러코드
                                   ,T1.RCV_DOC_NO                  --수납문서번호
                                   ,T1.RO_TP                       --RO유형
                                   ,FN_CMM_CD_NM('SER031',T1.RO_TP,#{sLangCd},'N') AS RO_TP_NM
                                   ,T1.RO_DOC_NO                   --RO문서번호
                                   ,T1.RO_GRP_NO                   --RO그룹번호
                                   ,T1.RESV_DOC_NO                 --예약문서번호
                                   ,T1.DIAG_DOC_NO                 --사전점검번호
                                   ,T1.PRE_CHK_DT                  --사전점검일자
                                   ,T1.BASE_RO_NO                  --원RO번호
                                   ,T1.INC_REQ_NO                  --보험신청번호
                                   ,T1.CUST_REMARK                 --고객비고
                                   ,T1.VIN_NO                      --차대번호
                                   ,T1.CAR_REG_NO                  --차량등록번호
                                   ,T1.ENGIN_NO                    --엔진시리얼번호
                                   ,T1.CAR_OWNER_ID                --차량소유자ID
                                   ,T1.CAR_OWNER_NM                --차량소유자명
                                   ,T1.DRIVER_ID                   --운전자ID
                                   ,T1.DRIVER_NM                   --운전자명
                                   ,T1.RESV_DT                     --예약일자
                                   ,T1.REG_DT AS RCV_REG_DT        --수납 등록일자
                                   ,T1.RUN_DIST_VAL                --주행거리값
                                   ,T1.CALC_DOC_NO                 --정산번호
                                   ,T1.CALC_DT
                                   ,T1.LAST_CALC_TOT_AMT           --최종 정산금액
                                   ,T1.CALC_PRSN_NM                         --정산번호
                                   ,T1.RCV_STAT_CD
                                   ,(SELECT RO_DT
                                       FROM SE_0300T
                                      WHERE DLR_CD    = T1.DLR_CD
                                        AND RO_DOC_NO = T1.RO_DOC_NO
                                        AND RO_TP     = T1.RO_TP
                                    )AS RO_DT
                                   ,(SELECT REG_USR_ID
                                       FROM SE_0300T
                                      WHERE DLR_CD    = T1.DLR_CD
                                        AND RO_DOC_NO = T1.RO_DOC_NO
                                        AND RO_TP     = T1.RO_TP
                                    )AS RO_REG_USR_ID
                                   ,(SELECT REG_USR_ID
                                       FROM SE_0500T
                                      WHERE DLR_CD      = T1.DLR_CD
                                        AND RO_DOC_NO   = T1.RO_DOC_NO
                                        AND CALC_DOC_NO = T1.CALC_DOC_NO
                                    )AS CALC_REG_USR_ID
                                    ,(SELECT CALC_COMP_USR_NM
                                       FROM SE_0500T
                                      WHERE DLR_CD      = T1.DLR_CD
                                        AND RO_DOC_NO   = T1.RO_DOC_NO
                                        AND CALC_DOC_NO = T1.CALC_DOC_NO
                                    )AS CALC_COMP_USR_NM
                                   ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = T1.VIN_NO AND ROWNUM = 1) AS CAR_RUN_DIST_VAL
                                   ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = T1.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                                   ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = T1.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                                   ,(SELECT GI_RUN_DIST_VAL FROM SE_0300T WHERE DLR_CD = T1.DLR_CD AND RO_DOC_NO = T1.RO_DOC_NO) AS GI_RUN_DIST_VAL
                                   ,(SELECT DLR_RO_TP FROM SE_0300T WHERE DLR_CD = T1.DLR_CD AND RO_DOC_NO = T1.RO_DOC_NO) AS DLR_RO_TP --자체정의RO유형
                                   ,(SELECT MAX(RCV_CPLT_DT) FROM SE_0570T WHERE RCV_DOC_NO = T1.RCV_DOC_NO) AS PAY_END_DT --지불완료시간
                               FROM SE_0550T T1
                              WHERE T1.DLR_CD     = #{sDlrCd}
                                AND T1.RCV_STAT_CD != 'C'
                                <if test='sRoTp != null and sRoTp != ""'>
                                AND T1.RO_TP = #{sRoTp}
                                </if>
                                <if test='sRoDocNo != null and sRoDocNo != ""'>
                                AND T1.RO_DOC_NO = #{sRoDocNo}
                                </if>
                                <if test='sRcvDocNo != null and sRcvDocNo != ""'>
                                AND T1.RCV_DOC_NO = #{sRcvDocNo}
                                </if>
                                <if test='sCalcDocNo != null and sCalcDocNo != ""'>
                                AND T1.CALC_DOC_NO = #{sCalcDocNo}
                                </if>
                                <if test='sRcvFromDt != null'>
                                AND T1.CALC_DT <![CDATA[>=]]> #{sRcvFromDt}
                                </if>
                                <if test='sRcvToDt != null'>
                                AND T1.CALC_DT <![CDATA[<]]> #{sRcvToDt} + 1
                                </if>
                                <if test='sVinNo != null and sVinNo != ""'>
                                AND T1.VIN_NO LIKE '%'|| #{sVinNo} ||'%'
                                </if>
                                <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                                AND T1.CAR_OWNER_NM LIKE '%'|| #{sCarOwnerNm} ||'%'
                                </if>
                                <if test='sDriverNm != null and sDriverNm != ""'>
                                AND T1.DRIVER_NM LIKE '%'|| #{sDriverNm} ||'%'
                                </if>
                                <if test='sCarRegNo != null and sCarRegNo != ""'>
                                AND T1.CAR_REG_NO LIKE '%'|| #{sCarRegNo} ||'%'
                                </if>
                                <if test='sSerParDstinCd != null and sSerParDstinCd != ""'>
                                AND T1.SER_PAR_DSTIN_CD = #{sSerParDstinCd}
                                </if>
                                <if test='sRcvStatCd != null and sRcvStatCd != ""'>
                                AND T1.RCV_STAT_CD = #{sRcvStatCd}
                                </if>
                          ) T2 LEFT OUTER JOIN SE_0560T T3
                           ON T2.DLR_CD     = T3.DLR_CD
                          AND T2.RCV_DOC_NO = T3.RCV_DOC_NO
                         LEFT OUTER JOIN SE_0570T T4
                           ON T3.DLR_CD         = T4.DLR_CD
                          AND T3.RCV_DOC_NO     = T4.RCV_DOC_NO
                          AND T3.RCV_SUB_DOC_NO = T4.RCV_SUB_DOC_NO
                          <where>
                              <if test='sRcvCpltFromDt != null'>
                              AND T4.RCV_CPLT_DT <![CDATA[>=]]> #{sRcvCpltFromDt}
                              </if>
                              <if test='sRcvCpltToDt != null'>
                              AND T4.RCV_CPLT_DT <![CDATA[<]]> #{sRcvCpltToDt} + 1
                              </if>
                              <if test='sPaymUsrNm != null and sPaymUsrNm != "" '>
                              AND T3.PAYM_USR_NM =  #{sPaymUsrNm}
                              </if>
                              <if test='sPaymPrid != null and sPaymPrid != "" '>
                              AND T3.PAYM_PRID =  #{sPaymPrid}
                              </if>
                          </where>
                   )T5
                   <where>
                    <if test='sPaymTp != null and sPaymTp != ""'>
                        AND T5.PAYM_TP = #{sPaymTp}
                    </if>
                    <if test='sRcvHistStatCd != null and sRcvHistStatCd != ""'>
                        AND T5.RCV_HIST_STAT_CD = #{sRcvHistStatCd}
                    </if>
                    <if test='sPaymYn != null and sPaymYn != ""'>
                        AND T5.PAYM_YN = #{sPaymYn}
                    </if>
                    <if test='sPaymMthTp != null and sPaymMthTp != "" '>
                        AND T5.RCV_HIS_PAYM_MTH_CD =  #{sPaymMthTp}
                    </if>
                </where>
                ORDER BY
                    <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                     <when test='item.field == "carRegNo"'>            T5.CAR_REG_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                     <when test='item.field == "vinNo"'>               T5.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                     <when test='item.field == "carOwnerNm"'>          T5.CAR_OWNER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                     <when test='item.field == "driverNm"'>            T5.DRIVER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                     <when test='item.field == "carlineNm"'>           T5.CARLINE_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                     <when test='item.field == "modelNm"'>             T5.MODEL_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                     <when test='item.field == "runDistVal"'>          T5.RUN_DIST_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                     <when test='item.field == "giRunDistVal"'>        T5.GI_RUN_DIST_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                     <when test='item.field == "rcvStatNm"'>           T5.RCV_STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                     <when test='item.field == "roDocNo"'>             T5.RO_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                     <when test='item.field == "roTpNm"'>              T5.RO_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                     <when test='item.field == "roDtFormat"'>          T5.RO_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                     <when test='item.field == "roRegUsrNm"'>          T5.RO_REG_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                     <when test='item.field == "calcDocNo"'>           T5.CALC_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                     <when test='item.field == "calcDtFormat"'>        T5.CALC_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>             </when>
                                     <when test='item.field == "calcCompUsrNm"'>       T5.CALC_COMP_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                     <when test='item.field == "paymTpNm"'>            T5.PAYM_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                     <when test='item.field == "paymCd"'>              T5.PAYM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>             </when>
                                     <when test='item.field == "paymUsrNm"'>           T5.PAYM_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                     <when test='item.field == "paymPridNm"'>          T5.PAYM_PRID_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                     <when test='item.field == "calcAmt"'>             T5.CALC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                     <when test='item.field == "wonUnitCutAmt"'>       T5.WON_UNIT_CUT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                     <when test='item.field == "demicPointCutAmt"'>    T5.DEMIC_POINT_CUT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "paymAmt"'>             T5.PAYM_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                     <when test='item.field == "rcvAmt"'>              T5.RCV_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>             </when>
                                     <when test='item.field == "npayAmt"'>             T5.NPAY_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                     <when test='item.field == "paymRemark"'>          T5.PAYM_REMARK <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                     <when test='item.field == "paymMthCdNm"'>         T5.PAYM_MTH_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                     <when test='item.field == "rcptTpNm"'>            T5.RCPT_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                     <when test='item.field == "rcvDocNo"'>            T5.RCV_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                     <when test='item.field == "paymYnNm"'>            PAYM_YN_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>             </when>
                                     <when test='item.field == "carRunDistVal"'>       T5.CAR_RUN_DIST_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                     <when test='item.field == "rcvHistStatNm"'>       T5.RCV_HIST_STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                     <when test='item.field == "rcvCpltHistDtFormat"'> T5.RCV_CPLT_HIST_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                     <when test='item.field == "regUsrNm"'>            T5.REG_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                     <when test='item.field == "rcvHisPaymMthCdNm"'>   T5.RCV_HIS_PAYM_MTH_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                     <when test='item.field == "rcvHistAmt"'>          T5.RCV_HIST_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                     <when test='item.field == "rcvHisRcptTpNm"'>      T5.RCV_HIS_RCPT_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                     <when test='item.field == "rcptNo"'>              T5.RCPT_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                     <when test='item.field == "rcptDtFormat"'>        T5.RCPT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                     <when test='item.field == "rcvRemark"'>           T5.RCV_REMARK <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                     <when test='item.field == "dlrRoTpNm"'>           T5.DLR_RO_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>             </when>
                                     <when test='item.field == "payEndDtFormat"'>      T5.PAY_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                    <otherwise>
                                        T5.DLR_CD, T5.RCV_DOC_NO DESC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            T5.DLR_CD, T5.RCV_DOC_NO DESC
                        </otherwise>
                    </choose>
            ) T6
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>

    </select>
    
    <!-- 维修-结算收款-服务收款实收金额总金额 -->
    <select id="selectServiceReceiveAmouts" parameterType="ServiceReceiveSearchVO" resultType="String">
        /* [chn.bhmc.dms.mob.api.repair.dao.ServiceReceiveAppDAO.selectServiceReceiveAmouts] */

        SELECT * FROM (
            SELECT T6.* FROM (
                SELECT SUM(T5.RCV_AMT)
                  FROM (
                     SELECT T2.*
                           ,T3.PAYM_TP                                                                        --결제유형
                           ,NVL(T4.RCV_STAT_CD,'O')                                        AS RCV_HIST_STAT_CD  --수납상태
                           ,FN_CMM_CD_NM('SER070',NVL(T2.RCV_STAT_CD,'O') ,#{sLangCd},'N') AS RCV_STAT_NM
                           ,FN_CMM_CD_NM('SER060',T4.PAYM_TP ,#{sLangCd},'N') AS PAYM_TP_NM
                           ,T3.PAYM_USR_NM                                                                    --결재사용자명
                           ,T3.PAYM_CD
                           ,T3.PAYM_REMARK
                           ,T3.PAYM_PRID
                           ,FN_CMM_CD_NM('SER062',T3.PAYM_PRID,#{sLangCd},'N') AS PAYM_PRID_NM
                           ,T3.RCV_SUB_DOC_NO
                           ,NVL(T3.RCV_AMT ,0) AS RCV_AMT
                           ,NVL(T3.CALC_AMT,0) AS CALC_AMT                                                    --발생금액
                           ,T3.RCV_CPLT_DT
                           ,CASE WHEN T2.RO_TP = '02' THEN 0 ELSE NVL(T3.PAYM_AMT , 0) END AS PAYM_AMT
                           ,NVL(T3.NPAY_AMT, NVL(T3.PAYM_AMT,0) - NVL(T3.RCV_AMT,0))  AS NPAY_AMT
                           ,CASE WHEN T2.RO_TP = '02' THEN 0 ELSE NVL(T3.WON_UNIT_CUT_AMT,0 ) END AS WON_UNIT_CUT_AMT
                           ,CASE WHEN T2.RO_TP = '02' THEN 0 ELSE NVL(T3.DEMIC_POINT_CUT_AMT,0) END AS DEMIC_POINT_CUT_AMT    --정산제로
                           ,FN_CMM_CD_NM('SER071',CASE WHEN NVL(T4.RCV_STAT_CD, 'O') = 'R'
                                                       THEN T4.RCV_STAT_CD
                                                       ELSE (CASE WHEN T4.RCV_STAT_CD = '02'
                                                                  THEN 'F'
                                                                  ELSE T4.RCV_STAT_CD END) END ,#{sLangCd},'N')  AS RCV_HIST_STAT_NM
                           ,T3.PAYM_MTH_CD
                           ,FN_CMM_CD_NM('SER061',T3.PAYM_MTH_CD,#{sLangCd},'N') AS PAYM_MTH_CD_NM
                           ,T4.PAYM_MTH_CD AS RCV_HIS_PAYM_MTH_CD
                           ,FN_CMM_CD_NM('SER061',T4.PAYM_MTH_CD,#{sLangCd},'N') AS RCV_HIS_PAYM_MTH_CD_NM
                           ,CASE WHEN T4.RCV_STAT_CD = 'R'
                                  THEN -1 * NVL(T4.RCV_AMT,0)
                                  ELSE NVL(T4.RCV_AMT,0) END AS RCV_HIST_AMT     --수납금액
                           ,T4.RCV_CPLT_DT AS RCV_CPLT_HIST_DT
                           ,T4.REG_USR_ID
                           ,T4.REG_DT AS RCV_HIST_REG_DT                             --수납일자
                           ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = T4.REG_USR_ID AND DLR_CD = T4.DLR_CD)      AS REG_USR_NM
                           ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = T2.RO_REG_USR_ID AND DLR_CD = T4.DLR_CD)   AS RO_REG_USR_NM
                           ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = T2.CALC_REG_USR_ID AND DLR_CD = T4.DLR_CD) AS CALC_REG_USR_NM
                           ,T3.RCPT_TP
                           ,T4.RCPT_TP AS RCV_HIS_RCPT_TP                       --영수증유형
                           ,FN_CMM_CD_NM('SER072',T3.RCPT_TP,#{sLangCd},'N') AS RCPT_TP_NM
                           ,FN_CMM_CD_NM('SER072',T4.RCPT_TP,#{sLangCd},'N') AS RCV_HIS_RCPT_TP_NM
                           ,T4.RCPT_NO                       --영수증번호
                           ,T4.RCPT_DT
                           ,T4.RCV_REMARK
                           ,CASE WHEN NVL(T3.RCV_AMT,0) = NVL(T3.PAYM_AMT,0) AND T3.RCV_STAT_CD = 'F' THEN 'Y' ELSE 'N' END AS PAYM_YN --지불완료여부
                           ,T3.REG_DT AS PAYM_YN_DT
                           ,FN_CMM_CD_NM('SER044',T2.DLR_RO_TP,#{sLangCd},'N') AS DLR_RO_TP_NM --자체정의RO유형
                       FROM (
                             SELECT T1.DLR_CD                      --딜러코드
                                   ,T1.RCV_DOC_NO                  --수납문서번호
                                   ,T1.RO_TP                       --RO유형
                                   ,FN_CMM_CD_NM('SER031',T1.RO_TP,#{sLangCd},'N') AS RO_TP_NM
                                   ,T1.RO_DOC_NO                   --RO문서번호
                                   ,T1.RO_GRP_NO                   --RO그룹번호
                                   ,T1.RESV_DOC_NO                 --예약문서번호
                                   ,T1.DIAG_DOC_NO                 --사전점검번호
                                   ,T1.PRE_CHK_DT                  --사전점검일자
                                   ,T1.BASE_RO_NO                  --원RO번호
                                   ,T1.INC_REQ_NO                  --보험신청번호
                                   ,T1.CUST_REMARK                 --고객비고
                                   ,T1.VIN_NO                      --차대번호
                                   ,T1.CAR_REG_NO                  --차량등록번호
                                   ,T1.ENGIN_NO                    --엔진시리얼번호
                                   ,T1.CAR_OWNER_ID                --차량소유자ID
                                   ,T1.CAR_OWNER_NM                --차량소유자명
                                   ,T1.DRIVER_ID                   --운전자ID
                                   ,T1.DRIVER_NM                   --운전자명
                                   ,T1.RESV_DT                     --예약일자
                                   ,T1.REG_DT AS RCV_REG_DT        --수납 등록일자
                                   ,T1.RUN_DIST_VAL                --주행거리값
                                   ,T1.CALC_DOC_NO                 --정산번호
                                   ,T1.CALC_DT
                                   ,T1.LAST_CALC_TOT_AMT           --최종 정산금액
                                   ,T1.CALC_PRSN_NM                         --정산번호
                                   ,T1.RCV_STAT_CD
                                   ,(SELECT RO_DT
                                       FROM SE_0300T
                                      WHERE DLR_CD    = T1.DLR_CD
                                        AND RO_DOC_NO = T1.RO_DOC_NO
                                        AND RO_TP     = T1.RO_TP
                                    )AS RO_DT
                                   ,(SELECT REG_USR_ID
                                       FROM SE_0300T
                                      WHERE DLR_CD    = T1.DLR_CD
                                        AND RO_DOC_NO = T1.RO_DOC_NO
                                        AND RO_TP     = T1.RO_TP
                                    )AS RO_REG_USR_ID
                                   ,(SELECT REG_USR_ID
                                       FROM SE_0500T
                                      WHERE DLR_CD      = T1.DLR_CD
                                        AND RO_DOC_NO   = T1.RO_DOC_NO
                                        AND CALC_DOC_NO = T1.CALC_DOC_NO
                                    )AS CALC_REG_USR_ID
                                    ,(SELECT CALC_COMP_USR_NM
                                       FROM SE_0500T
                                      WHERE DLR_CD      = T1.DLR_CD
                                        AND RO_DOC_NO   = T1.RO_DOC_NO
                                        AND CALC_DOC_NO = T1.CALC_DOC_NO
                                    )AS CALC_COMP_USR_NM
                                   ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = T1.VIN_NO AND ROWNUM = 1) AS CAR_RUN_DIST_VAL
                                   ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = T1.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                                   ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = T1.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                                   ,(SELECT GI_RUN_DIST_VAL FROM SE_0300T WHERE DLR_CD = T1.DLR_CD AND RO_DOC_NO = T1.RO_DOC_NO) AS GI_RUN_DIST_VAL
                                   ,(SELECT DLR_RO_TP FROM SE_0300T WHERE DLR_CD = T1.DLR_CD AND RO_DOC_NO = T1.RO_DOC_NO) AS DLR_RO_TP --자체정의RO유형
                                   ,(SELECT MAX(RCV_CPLT_DT) FROM SE_0570T WHERE RCV_DOC_NO = T1.RCV_DOC_NO) AS PAY_END_DT --지불완료시간
                               FROM SE_0550T T1
                              WHERE T1.DLR_CD     = #{sDlrCd}
                                AND T1.RCV_STAT_CD != 'C'
                                <if test='sRoTp != null and sRoTp != ""'>
                                AND T1.RO_TP = #{sRoTp}
                                </if>
                                <if test='sRoDocNo != null and sRoDocNo != ""'>
                                AND T1.RO_DOC_NO = #{sRoDocNo}
                                </if>
                                <if test='sRcvDocNo != null and sRcvDocNo != ""'>
                                AND T1.RCV_DOC_NO = #{sRcvDocNo}
                                </if>
                                <if test='sCalcDocNo != null and sCalcDocNo != ""'>
                                AND T1.CALC_DOC_NO = #{sCalcDocNo}
                                </if>
                                <if test='sRcvFromDt != null'>
                                AND T1.CALC_DT <![CDATA[>=]]> #{sRcvFromDt}
                                </if>
                                <if test='sRcvToDt != null'>
                                AND T1.CALC_DT <![CDATA[<]]> #{sRcvToDt} + 1
                                </if>
                                <if test='sVinNo != null and sVinNo != ""'>
                                AND T1.VIN_NO LIKE '%'|| #{sVinNo} ||'%'
                                </if>
                                <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                                AND T1.CAR_OWNER_NM LIKE '%'|| #{sCarOwnerNm} ||'%'
                                </if>
                                <if test='sDriverNm != null and sDriverNm != ""'>
                                AND T1.DRIVER_NM LIKE '%'|| #{sDriverNm} ||'%'
                                </if>
                                <if test='sCarRegNo != null and sCarRegNo != ""'>
                                AND T1.CAR_REG_NO LIKE '%'|| #{sCarRegNo} ||'%'
                                </if>
                                <if test='sSerParDstinCd != null and sSerParDstinCd != ""'>
                                AND T1.SER_PAR_DSTIN_CD = #{sSerParDstinCd}
                                </if>
                                <if test='sRcvStatCd != null and sRcvStatCd != ""'>
                                AND T1.RCV_STAT_CD = #{sRcvStatCd}
                                </if>
                          ) T2 LEFT OUTER JOIN SE_0560T T3
                           ON T2.DLR_CD     = T3.DLR_CD
                          AND T2.RCV_DOC_NO = T3.RCV_DOC_NO
                         LEFT OUTER JOIN SE_0570T T4
                           ON T3.DLR_CD         = T4.DLR_CD
                          AND T3.RCV_DOC_NO     = T4.RCV_DOC_NO
                          AND T3.RCV_SUB_DOC_NO = T4.RCV_SUB_DOC_NO
                          <where>
                              <if test='sRcvCpltFromDt != null'>
                              AND T4.RCV_CPLT_DT <![CDATA[>=]]> #{sRcvCpltFromDt}
                              </if>
                              <if test='sRcvCpltToDt != null'>
                              AND T4.RCV_CPLT_DT <![CDATA[<]]> #{sRcvCpltToDt} + 1
                              </if>
                              <if test='sPaymUsrNm != null and sPaymUsrNm != "" '>
                              AND T3.PAYM_USR_NM =  #{sPaymUsrNm}
                              </if>
                              <if test='sPaymPrid != null and sPaymPrid != "" '>
                              AND T3.PAYM_PRID =  #{sPaymPrid}
                              </if>
                          </where>
                   )T5
                   <where>
                    <if test='sPaymTp != null and sPaymTp != ""'>
                        AND T5.PAYM_TP = #{sPaymTp}
                    </if>
                    <if test='sRcvHistStatCd != null and sRcvHistStatCd != ""'>
                        AND T5.RCV_HIST_STAT_CD = #{sRcvHistStatCd}
                    </if>
                    <if test='sPaymYn != null and sPaymYn != ""'>
                        AND T5.PAYM_YN = #{sPaymYn}
                    </if>
                    <if test='sPaymMthTp != null and sPaymMthTp != "" '>
                        AND T5.RCV_HIS_PAYM_MTH_CD =  #{sPaymMthTp}
                    </if>
                </where>
                ORDER BY
                    <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                     <when test='item.field == "carRegNo"'>            T5.CAR_REG_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                     <when test='item.field == "vinNo"'>               T5.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                     <when test='item.field == "carOwnerNm"'>          T5.CAR_OWNER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                     <when test='item.field == "driverNm"'>            T5.DRIVER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                     <when test='item.field == "carlineNm"'>           T5.CARLINE_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                     <when test='item.field == "modelNm"'>             T5.MODEL_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                     <when test='item.field == "runDistVal"'>          T5.RUN_DIST_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                     <when test='item.field == "giRunDistVal"'>        T5.GI_RUN_DIST_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                     <when test='item.field == "rcvStatNm"'>           T5.RCV_STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                     <when test='item.field == "roDocNo"'>             T5.RO_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                     <when test='item.field == "roTpNm"'>              T5.RO_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                     <when test='item.field == "roDtFormat"'>          T5.RO_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                     <when test='item.field == "roRegUsrNm"'>          T5.RO_REG_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                     <when test='item.field == "calcDocNo"'>           T5.CALC_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                     <when test='item.field == "calcDtFormat"'>        T5.CALC_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>             </when>
                                     <when test='item.field == "calcCompUsrNm"'>       T5.CALC_COMP_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                     <when test='item.field == "paymTpNm"'>            T5.PAYM_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                     <when test='item.field == "paymCd"'>              T5.PAYM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>             </when>
                                     <when test='item.field == "paymUsrNm"'>           T5.PAYM_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                     <when test='item.field == "paymPridNm"'>          T5.PAYM_PRID_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                     <when test='item.field == "calcAmt"'>             T5.CALC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                     <when test='item.field == "wonUnitCutAmt"'>       T5.WON_UNIT_CUT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                     <when test='item.field == "demicPointCutAmt"'>    T5.DEMIC_POINT_CUT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "paymAmt"'>             T5.PAYM_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                     <when test='item.field == "rcvAmt"'>              T5.RCV_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>             </when>
                                     <when test='item.field == "npayAmt"'>             T5.NPAY_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                     <when test='item.field == "paymRemark"'>          T5.PAYM_REMARK <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                     <when test='item.field == "paymMthCdNm"'>         T5.PAYM_MTH_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                     <when test='item.field == "rcptTpNm"'>            T5.RCPT_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                     <when test='item.field == "rcvDocNo"'>            T5.RCV_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                     <when test='item.field == "paymYnNm"'>            PAYM_YN_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>             </when>
                                     <when test='item.field == "carRunDistVal"'>       T5.CAR_RUN_DIST_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                     <when test='item.field == "rcvHistStatNm"'>       T5.RCV_HIST_STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                     <when test='item.field == "rcvCpltHistDtFormat"'> T5.RCV_CPLT_HIST_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                     <when test='item.field == "regUsrNm"'>            T5.REG_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                     <when test='item.field == "rcvHisPaymMthCdNm"'>   T5.RCV_HIS_PAYM_MTH_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                     <when test='item.field == "rcvHistAmt"'>          T5.RCV_HIST_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                     <when test='item.field == "rcvHisRcptTpNm"'>      T5.RCV_HIS_RCPT_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                     <when test='item.field == "rcptNo"'>              T5.RCPT_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                     <when test='item.field == "rcptDtFormat"'>        T5.RCPT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                     <when test='item.field == "rcvRemark"'>           T5.RCV_REMARK <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                     <when test='item.field == "dlrRoTpNm"'>           T5.DLR_RO_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>             </when>
                                     <when test='item.field == "payEndDtFormat"'>      T5.PAY_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                    <otherwise>
                                        T5.DLR_CD, T5.RCV_DOC_NO DESC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            T5.DLR_CD, T5.RCV_DOC_NO DESC
                        </otherwise>
                    </choose>
            ) T6
        )

    </select>

    <select id="selectServiceReceiveStatusByConditionCnt" parameterType="ServiceReceiveSearchVO" resultType="int">
        /* [chn.bhmc.dms.mob.api.repair.dao.ServiceReceiveAppDAO.selectServiceReceiveStatusByConditionCnt] */

        SELECT COUNT(*) FROM (
            SELECT T5.*
                  ,FN_CMM_CD_NM('COM020',T5.PAYM_YN ,#{sLangCd},'N') AS PAYM_YN_NM
                  ,CASE WHEN PAYM_YN = 'Y' THEN PAYM_YN_DT END PAYM_YN_DT
              FROM (
                 SELECT T2.*
                       ,T3.PAYM_TP                                                                        --결제유형
                       ,NVL(T4.RCV_STAT_CD,'O')                                        AS RCV_HIST_STAT_CD  --수납상태
                       ,FN_CMM_CD_NM('SER070',NVL(T4.RCV_STAT_CD,'O') ,#{sLangCd},'N') AS RCV_STAT_NM
                       ,FN_CMM_CD_NM('SER060',T4.PAYM_TP ,#{sLangCd},'N') AS PAYM_TP_NM
                       ,T3.PAYM_USR_NM                                                                    --결재사용자명
                       ,T3.PAYM_CD
                       ,T3.PAYM_PRID
                       ,FN_CMM_CD_NM('SER062',T3.PAYM_PRID,#{sLangCd},'N') AS PAYM_PRID_NM
                       ,T3.RCV_SUB_DOC_NO
                       ,NVL(T3.RCV_AMT ,0) AS RCV_AMT
                       ,NVL(T3.CALC_AMT,0) AS CALC_AMT                                                    --발생금액
                       ,T3.RCV_CPLT_DT
                       ,CASE WHEN T2.RO_TP = '02' THEN 0 ELSE NVL(T3.PAYM_AMT , 0) END AS PAYM_AMT
                       ,NVL(T3.NPAY_AMT ,0)  AS NPAY_AMT
                       ,CASE WHEN T2.RO_TP = '02' THEN 0 ELSE NVL(T3.WON_UNIT_CUT_AMT,0 ) END AS WON_UNIT_CUT_AMT
                       ,CASE WHEN T2.RO_TP = '02' THEN 0 ELSE NVL(T3.DEMIC_POINT_CUT_AMT,0) END AS DEMIC_POINT_CUT_AMT    --정산제로
                       ,FN_CMM_CD_NM('SER071',CASE WHEN NVL(T4.RCV_STAT_CD, 'O') = 'R'
                                                   THEN T4.RCV_STAT_CD
                                                   ELSE (CASE WHEN T4.RCV_STAT_CD = '02'
                                                              THEN 'F'
                                                              ELSE T4.RCV_STAT_CD END) END ,#{sLangCd},'N')  AS RCV_HIST_STAT_NM
                       ,T3.PAYM_MTH_CD
                       ,FN_CMM_CD_NM('SER061',T3.PAYM_MTH_CD,#{sLangCd},'N') AS PAYM_MTH_CD_NM
                       ,T4.PAYM_MTH_CD AS RCV_HIS_PAYM_MTH_CD
                       ,FN_CMM_CD_NM('SER061',T4.PAYM_MTH_CD,#{sLangCd},'N') AS RCV_HIS_PAYM_MTH_CD_NM
                       ,CASE WHEN T4.RCV_STAT_CD = 'R'
                              THEN TO_NUMBER( '-'||TO_CHAR( NVL(T4.RCV_AMT,0) ))
                              ELSE NVL(T4.RCV_AMT,0) END AS RCV_HIST_AMT     --수납금액
                       ,T4.RCV_CPLT_DT AS RCV_CPLT_HIST_DT
                       ,T4.REG_USR_ID
                       ,T4.REG_DT AS RCV_HIST_REG_DT                             --수납일자
                       ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = T4.REG_USR_ID AND DLR_CD = T4.DLR_CD)      AS REG_USR_NM
                       ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = T2.RO_REG_USR_ID AND DLR_CD = T4.DLR_CD)   AS RO_REG_USR_NM
                       ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = T2.CALC_REG_USR_ID AND DLR_CD = T4.DLR_CD) AS CALC_REG_USR_NM
                       ,T3.RCPT_TP
                       ,T4.RCPT_TP AS RCV_HIS_RCPT_TP                       --영수증유형
                       ,FN_CMM_CD_NM('SER072',T3.RCPT_TP,#{sLangCd},'N') AS RCPT_TP_NM
                       ,FN_CMM_CD_NM('SER072',T4.RCPT_TP,#{sLangCd},'N') AS RCV_HIS_RCPT_TP_NM
                       ,T4.RCPT_NO                       --영수증번호
                       ,T4.RCPT_DT
                       ,T4.RCV_REMARK
                       ,CASE WHEN NVL(T3.RCV_AMT,0) = NVL(T3.PAYM_AMT,0) THEN 'Y' ELSE 'N' END AS PAYM_YN --지불완료여부
                       ,T3.REG_DT AS PAYM_YN_DT
                   FROM (
                         SELECT T1.DLR_CD                      --딜러코드
                               ,T1.RCV_DOC_NO                  --수납문서번호
                               ,T1.RO_TP                       --RO유형
                               ,FN_CMM_CD_NM('SER031',T1.RO_TP,#{sLangCd},'N') AS RO_TP_NM
                               ,T1.RO_DOC_NO                   --RO문서번호
                               ,T1.RO_GRP_NO                   --RO그룹번호
                               ,T1.RESV_DOC_NO                 --예약문서번호
                               ,T1.DIAG_DOC_NO                 --사전점검번호
                               ,T1.PRE_CHK_DT                  --사전점검일자
                               ,T1.BASE_RO_NO                  --원RO번호
                               ,T1.INC_REQ_NO                  --보험신청번호
                               ,T1.CUST_REMARK                 --고객비고
                               ,T1.VIN_NO                      --차대번호
                               ,T1.CAR_REG_NO                  --차량등록번호
                               ,T1.ENGIN_NO                    --엔진시리얼번호
                               ,T1.CAR_OWNER_ID                --차량소유자ID
                               ,T1.CAR_OWNER_NM                --차량소유자명
                               ,T1.DRIVER_ID                   --운전자ID
                               ,T1.DRIVER_NM                   --운전자명
                               ,T1.RESV_DT                     --예약일자
                               ,T1.REG_DT AS RCV_REG_DT        --수납 등록일자
                               ,T1.RUN_DIST_VAL                --주행거리값
                               ,T1.CALC_DOC_NO                 --정산번호
                               ,T1.CALC_DT
                               ,T1.LAST_CALC_TOT_AMT           --최종 정산금액
                               ,T1.CALC_PRSN_NM                         --정산번호
                               ,(SELECT RO_DT
                                   FROM SE_0300T
                                  WHERE DLR_CD    = T1.DLR_CD
                                    AND RO_DOC_NO = T1.RO_DOC_NO
                                    AND RO_TP     = T1.RO_TP
                                )AS RO_DT
                               ,(SELECT REG_USR_ID
                                   FROM SE_0300T
                                  WHERE DLR_CD    = T1.DLR_CD
                                    AND RO_DOC_NO = T1.RO_DOC_NO
                                    AND RO_TP     = T1.RO_TP
                                )AS RO_REG_USR_ID
                               ,(SELECT REG_USR_ID
                                   FROM SE_0500T
                                  WHERE DLR_CD      = T1.DLR_CD
                                    AND RO_DOC_NO   = T1.RO_DOC_NO
                                    AND CALC_DOC_NO = T1.CALC_DOC_NO
                                )AS CALC_REG_USR_ID
                                ,(SELECT CALC_COMP_USR_NM
                                   FROM SE_0500T
                                  WHERE DLR_CD      = T1.DLR_CD
                                    AND RO_DOC_NO   = T1.RO_DOC_NO
                                    AND CALC_DOC_NO = T1.CALC_DOC_NO
                                )AS CALC_COMP_USR_NM
                               ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = T1.VIN_NO AND ROWNUM = 1) AS CAR_RUN_DIST_VAL
                               ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = T1.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                               ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = T1.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                           FROM SE_0550T T1
                          WHERE T1.DLR_CD     = #{sDlrCd}
                            AND T1.RCV_STAT_CD != 'C'
                            <if test='sRoTp != null and sRoTp != ""'>
                            AND T1.RO_TP = #{sRoTp}
                            </if>
                            <if test='sRoDocNo != null and sRoDocNo != ""'>
                            AND T1.RO_DOC_NO = #{sRoDocNo}
                            </if>
                            <if test='sRcvDocNo != null and sRcvDocNo != ""'>
                            AND T1.RCV_DOC_NO = #{sRcvDocNo}
                            </if>
                            <if test='sCalcDocNo != null and sCalcDocNo != ""'>
                            AND T1.CALC_DOC_NO = #{sCalcDocNo}
                            </if>
                            <if test='sRcvFromDt != null'>
                            AND T1.CALC_DT <![CDATA[>=]]> #{sRcvFromDt}
                            </if>
                            <if test='sRcvToDt != null'>
                            AND T1.CALC_DT <![CDATA[<]]> #{sRcvToDt} + 1
                            </if>
                            <if test='sVinNo != null and sVinNo != ""'>
                            AND T1.VIN_NO LIKE '%'|| #{sVinNo} ||'%'
                            </if>
                            <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                            AND T1.CAR_OWNER_NM LIKE '%'|| #{sCarOwnerNm} ||'%'
                            </if>
                            <if test='sDriverNm != null and sDriverNm != ""'>
                            AND T1.DRIVER_NM LIKE '%'|| #{sDriverNm} ||'%'
                            </if>
                            <if test='sCarRegNo != null and sCarRegNo != ""'>
                            AND T1.CAR_REG_NO LIKE '%'|| #{sCarRegNo} ||'%'
                            </if>
                            <if test='sSerParDstinCd != null and sSerParDstinCd != ""'>
                            AND T1.SER_PAR_DSTIN_CD = #{sSerParDstinCd}
                            </if>
                            <if test='sRcvStatCd != null and sRcvStatCd != ""'>
                            AND T1.RCV_STAT_CD = #{sRcvStatCd}
                            </if>
                      ) T2 LEFT OUTER JOIN SE_0560T T3
                       ON T2.DLR_CD     = T3.DLR_CD
                      AND T2.RCV_DOC_NO = T3.RCV_DOC_NO
                     LEFT OUTER JOIN SE_0570T T4
                       ON T3.DLR_CD         = T4.DLR_CD
                      AND T3.RCV_DOC_NO     = T4.RCV_DOC_NO
                      AND T3.RCV_SUB_DOC_NO = T4.RCV_SUB_DOC_NO
                      <where>
                          <if test='sRcvCpltFromDt != null'>
                          AND T4.RCV_CPLT_DT <![CDATA[>=]]> #{sRcvCpltFromDt}
                          </if>
                          <if test='sRcvCpltToDt != null'>
                          AND T4.RCV_CPLT_DT <![CDATA[<]]> #{sRcvCpltToDt} + 1
                          </if>
                          <if test='sPaymUsrNm != null and sPaymUsrNm != "" '>
                          AND T3.PAYM_USR_NM =  #{sPaymUsrNm}
                          </if>
                          <if test='sPaymPrid != null and sPaymPrid != "" '>
                          AND T3.PAYM_PRID =  #{sPaymPrid}
                          </if>
                      </where>
                )T5
                <where>
                    <if test='sPaymTp != null and sPaymTp != ""'>
                        AND T5.PAYM_TP = #{sPaymTp}
                    </if>
                    <if test='sRcvHistStatCd != null and sRcvHistStatCd != ""'>
                        AND T5.RCV_HIST_STAT_CD = #{sRcvHistStatCd}
                    </if>
                    <if test='sPaymYn != null and sPaymYn != ""'>
                        AND T5.PAYM_YN = #{sPaymYn}
                    </if>
                    <if test='sPaymMthTp != null and sPaymMthTp != "" '>
                        AND T5.RCV_HIS_PAYM_MTH_CD =  #{sPaymMthTp}
                    </if>
                </where>
        )
    </select>

</mapper>