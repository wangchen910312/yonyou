<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : CustomerInfoDAO_SqlMap.xml
    Description : 고객그룹 관한 데이터처리
    author Kyo Jin Lee
    since 2015. 12. 30.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 01. 05.     Kyo Jin Lee     최초 생성
    2017. 08. 10.     kyo jin lee   id="searchCustomerListWhere"  rank() ==> row_number() 수정
-->

<mapper namespace="chn.bhmc.dms.mob.api.crm.dao.CrmCustomerInfoDAO">


	<!-- 고객조회 팝업 > 차량정보 기준 고객검색 조건 -->
    <sql id="searchCustomerAndCarInfo">
            INNER JOIN ( SELECT
                VO.DLR_CD,
                V.VIN_NO,
                VO.BP_CD,
                V.CAR_BRAND_CD,
                V.CARLINE_CD,
                V.MODEL_CD,
                V.OCN_CD,
                V.CAR_RUN_DIST_VAL,
                V.CAR_REG_NO,
                V.NCAR_DSTIN_CD,
                V.CUST_SALE_DT,
                V.EXT_COLOR_CD,
                V.INT_COLOR_CD
               FROM SA_0121T V,
                SA_0123T VO
              WHERE V.CAR_ID = VO.CAR_ID
                AND VO.DLR_CD = #{sDlrCd}
                AND VO.USE_YN = 'Y') VINFO ON CINFO.DLR_CD = VINFO.DLR_CD AND CINFO.CUST_NO = VINFO.BP_CD
    <if test='sMembershipStan != null and sMembershipStan != ""'>
        <choose>
        <when test='sMembershipStan == "C"'>
            LEFT OUTER JOIN CR_0801T MB ON MB.DLR_CD = CINFO.DLR_CD AND MB.CUST_NO = CINFO.CUST_NO -- 멤버십이 고객기준
        </when>
        <otherwise>
            LEFT OUTER JOIN CR_0801T MB ON MB.DLR_CD = CINFO.DLR_CD AND MB.VIN_NO = VINFO.VIN_NO -- 멤버십 차량기준
        </otherwise>
        </choose>
    </if>
            WHERE 1 = 1
            AND CINFO.DLR_CD =  #{sDlrCd}
            <if test='sCustNm != null and sCustNm != ""'>
                AND (CINFO.CUST_NM LIKE '%'||#{sCustNm}||'%'
                     OR CINFO.HP_NO LIKE '%'||#{sCustNm}||'%'
                    )
            </if>
            <if test='sTelNo != null and sTelNo != ""'>
                AND CINFO.TEL_NO LIKE '%'||#{sTelNo}||'%'
            </if>
            <if test='sHpNo != null and sHpNo != ""'>
                AND CINFO.HP_NO LIKE '%'||#{sHpNo}||'%'
            </if>
            <choose>
                <when test='sDlrMbrYn == "Y" '>
                    AND MB.MEMBERSHIP_NO IS NOT NULL
                </when>
                <when test='sDlrMbrYn == "N" '>
                    AND MB.MEMBERSHIP_NO IS NULL
                </when>
                <otherwise>
                </otherwise>
            </choose>
            <if test='sCustCd != null and sCustCd != ""'>
                AND CINFO.CUST_CD = #{sCustCd} -- 01: 잠재, 02:보유, 03:타사보유
            </if>
            <if test='sCustTp != null and sCustTp != ""'>
                AND CINFO.CUST_TP = #{sCustTp} -- 01: 개인, 02:법인
            </if>
            <choose>
                <when test='sBlueMembershipJoinYn == "Y" '>
                    AND CINFO.BLUE_MEMBERSHIP_NO IS NOT NULL
                </when>
                <when test='sBlueMembershipJoinYn == "N" '>
                    AND CINFO.BLUE_MEMBERSHIP_NO IS NULL
                </when>
                <otherwise>
                </otherwise>
            </choose>
            <if test='sVinNo != null and sVinNo != ""'>
                AND VINFO.VIN_NO LIKE '%'||#{sVinNo}||'%'
            </if>
            <if test='sCarRegNo != null and sCarRegNo != ""'>
                AND VINFO.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
            </if>
            <if test='sHyundaiYn != null and sHyundaiYn != ""'>
                <choose>
                <when test='sHyundaiYn == "Y" '>
                    AND VINFO.NCAR_DSTIN_CD != 'O' -- O:타사차량, N:신차
                </when>
                <otherwise>
                    AND VINFO.NCAR_DSTIN_CD = 'O' -- O:타사차량, N:신차
                </otherwise>
                </choose>
            </if>
            <if test='sMathDocTp != null and sMathDocTp != ""'>
                AND CINFO.MATH_DOC_TP = #{sMathDocTp}
            </if>
            <if test='sMngScId != null and sMngScId != ""'>
                AND CINFO.MNG_SC_ID = #{sMngScId}
            </if>
            <choose>
                <when test='(sSaleStartDt != null) and (sSaleEndDt != null)'>
                    AND (VINFO.CUST_SALE_DT <![CDATA[>=]]> trunc(#{sSaleStartDt},'DD') AND VINFO.CUST_SALE_DT <![CDATA[<]]> trunc(#{sSaleEndDt},'DD')+1)
                </when>
                <when test='(sSaleStartDt != null) and (sSaleEndDt == null)'>
                    AND VINFO.CUST_SALE_DT <![CDATA[>=]]> trunc(#{sSaleStartDt},'DD')
                </when>
                <when test='(sSaleStartDt == null) and (sSaleEndDt != null)'>
                    AND VINFO.CUST_SALE_DT <![CDATA[<]]> trunc(#{sSaleEndDt},'DD')+1
                </when>
                <otherwise>
                </otherwise>
            </choose>
    </sql>
    
	 <!-- 고객 조회 검색조건 -->
    <sql id="searchCustomerInfoWhere">

        LEFT OUTER JOIN CR_0211T LEADOPPT ON T1.CUST_NO = LEADOPPT.CUST_NO
        LEFT OUTER JOIN CM_0801T SCT ON T1.MNG_SC_ID = SCT.USR_ID
        LEFT OUTER JOIN CM_0801T TEC ON T1.MNG_TEC_ID = TEC.USR_ID
        LEFT OUTER JOIN CM_0801T USRT ON T1.REG_USR_ID = USRT.USR_ID
        LEFT OUTER JOIN (
            SELECT
                 ROW_NUMBER() OVER(PARTITION BY  DLR_CD, REF_TABLE_NM, REF_KEY_NM  ORDER BY NVL(UPDT_DT, REG_DT) DESC ) AS ADDR_NUM
                ,DLR_CD
                ,SEQ
                ,REF_TABLE_NM
                ,REF_KEY_NM
                ,ADDR_TP
                ,SUNG_CD
                ,CITY_CD
                ,DIST_CD
                ,ZIP_CD
                ,SUNG_NM
                ,CITY_NM
                ,DIST_NM
                ,ADDR_DETL_CONT
            FROM CR_0116T
            WHERE DLR_CD = #{sDlrCd}
            AND USE_YN = 'Y'
            AND REF_TABLE_NM = 'CR_0101T'
        <choose>
            <when test='sAddrTp == "02"'>
                AND ADDR_TP = '02'
            </when>
            <otherwise>
                AND FLAG_YN = 'Y'
                <if test='sAddrTp != null and sAddrTp != ""'>
                    AND ADDR_TP = #{sAddrTp}
                </if>
            </otherwise>
        </choose>
        ) ADDR ON T1.DLR_CD = ADDR.DLR_CD AND T1.CUST_NO = ADDR.REF_KEY_NM AND ADDR_NUM = 1

        <if test='sCommand != null and sCommand == "TAGSEARCH"'>
        INNER JOIN CR_0115T TAG ON T1.CUST_NO = TAG.CUST_NO AND TAG.GRP_TP = '002'
            AND TAG.GRP_SEQ IN
            <foreach collection="tagDS" item="tagItem" open="(" close=")" separator=",">
                #{tagItem}
            </foreach>
        </if>

        <where>
           T1.DEL_YN = 'N'
            <!-- 고객정보 like 검색 -->
            <if test='sCust != null and sCust != ""'>
                AND ( T1.CUST_NM LIKE '%'||#{sCust}||'%'
                    OR T1.HP_NO LIKE '%'||#{sCust}||'%'
                    OR T1.TEL_NO LIKE '%'||#{sCust}||'%'
                    )
            </if>
           <if test='sMergeYn != null and sMergeYn != ""'>
                AND T1.MERGE_YN = #{sMergeYn}
           </if>
           <if test='sDlrCd != null and sDlrCd != ""'>
                AND T1.DLR_CD = #{sDlrCd}
           </if>
           <if test='sCustNo != null and sCustNo != ""'>
                AND T1.CUST_NO LIKE '%'||#{sCustNo}||'%'
           </if>
           <if test='sSsnCrnNo != null and sSsnCrnNo != ""'>
                AND T1.SSN_CRN_NO LIKE '%'||UPPER(#{sSsnCrnNo})||'%'
           </if>
           <if test='sMngScId != null and sMngScId != ""'>
                AND T1.MNG_SC_ID = #{sMngScId}
           </if>
           <if test='sCustNm != null and sCustNm != ""'>
                AND T1.CUST_NM LIKE '%'||#{sCustNm}||'%'
           </if>
           <if test='sCustTp != null and sCustTp != ""'>
                AND T1.CUST_TP = #{sCustTp}
           </if>
           <if test='sCustCd != null and sCustCd != ""'>
                AND T1.CUST_CD = #{sCustCd}
           </if>
           <if test='sHpNo != null and sHpNo != ""'>
                AND T1.HP_NO LIKE '%'||#{sHpNo}||'%'
           </if>
           <if test='sSexCd != null and sSexCd != ""'>
                AND T1.SEX_CD = #{sSexCd}
           </if>
           <if test='sTelNo != null and sTelNo != ""'>
                AND T1.TEL_NO LIKE '%'||#{sTelNo}||'%'
           </if>
           <if test='sOfficeTelNo != null and sOfficeTelNo != ""'>
                AND T1.OFFICE_TEL_NO LIKE '%'||#{sOfficeTelNo}||'%'
           </if>
           <if test='sEmailNm != null and sEmailNm != ""'>
                AND T1.EMAIL_NM LIKE '%'||#{sEmailNm}||'%'
           </if>
           <if test='sBhmcYn != null and sBhmcYn != ""'>
                AND T1.BHMC_YN = #{sBhmcYn}
           </if>
            <if test='sRegDtFrom != null'>
                <![CDATA[
                    AND T1.REG_DT >= #{sRegDtFrom}   -- 등록일
                ]]>
            </if>
            <if test='sRegDtTo != null'>
                <![CDATA[
                    AND T1.REG_DT < #{sRegDtTo}       -- 등록일
                ]]>
            </if>

            <if test='sAssignYn != null and sAssignYn != ""'>
                <if test='sAssignYn == "Y"'>
                     AND T1.MNG_SC_ID IS NOT NULL           -- SC 배정
                </if >
                <if test='sAssignYn == "N"'>
                     AND T1.MNG_SC_ID IS NULL               -- SC 미배정
                </if>
            </if>
            <if test='sVinNo != null and sVinNo != ""'>
                AND T1.CUST_NO IN (
                    SELECT OWNER.BP_CD
                      FROM SA_0121T CAR, SA_0123T OWNER
                     WHERE CAR.CAR_ID = OWNER.CAR_ID
                       AND OWNER.DLR_CD = #{sDlrCd}
                       AND OWNER.USE_YN = 'Y'
                       AND CAR.VIN_NO LIKE '%'||#{sVinNo}||'%'
                )
            </if>
            <if test='sCarRegNo != null and sCarRegNo != ""'>
                AND T1.CUST_NO IN (
                    SELECT OWNER.BP_CD
                      FROM SA_0121T CAR, SA_0123T OWNER
                     WHERE CAR.CAR_ID = OWNER.CAR_ID
                       AND OWNER.DLR_CD = #{sDlrCd}
                       AND OWNER.USE_YN = 'Y'
                       AND CAR.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                )
            </if>
        </where>
    </sql>
	
	<sql id="searchCustomerListWhere">

         <!-- 20170707 수정 - 판매일자를 SA_0201T.REAL_DL_DT 에서 SA_0121T.CUST_SALE_DT 으로 변경. 판매일자 검색조건에  따라서 INNER JOIN / LEFT OUTER JOIN 처리 -->
         <choose>
           <when test='sSaleDtFrom != null or sSaleDtTo != null'>
             INNER JOIN
           </when>
           <otherwise>
             LEFT OUTER JOIN
           </otherwise>
         </choose>
                            (  SELECT *
                               FROM ( SELECT ROW_NUMBER() OVER (PARTITION BY CAR.BP_CD ORDER BY CMST.CUST_SALE_DT DESC, CMST.CAR_ID DESC ) RM,
                                             CAR.BP_CD,
                                             CMST.CAR_ID,
                                             CMST.CUST_SALE_DT,
                                             CMST.VIN_NO,
                                             CMST.CARLINE_CD,
                                             NVL(CMST.CAR_REG_NO, '-') AS CAR_REG_NO,
                                             NVL(CMST.CAR_RUN_DIST_VAL, 0) AS CAR_RUN_DIST_VAL
                                        FROM SA_0123T CAR
                                       INNER JOIN SA_0121T CMST ON CAR.CAR_ID = CMST.CAR_ID
                                       WHERE CAR.DLR_CD = #{sDlrCd}
                                         AND CAR.USE_YN = 'Y'
                                     <if test='sSaleDtFrom != null or sSaleDtTo != null'>
                                       <if test='sSaleDtFrom != null'>
                                         AND CMST.CUST_SALE_DT <![CDATA[>=]]> trunc(#{sSaleDtFrom},'DD')
                                       </if>
                                       <if test='sSaleDtTo != null'>
                                         AND CMST.CUST_SALE_DT <![CDATA[<]]> trunc(#{sSaleDtTo},'DD') + 1
                                           </if>
                                         </if>
                                             )
                                  WHERE RM = 1
                            ) CARINFO ON CARINFO.BP_CD = CUST.CUST_NO
         <choose>
           <when test='sRoDtFrom != null or sRoDtTo != null'>
             INNER JOIN
           </when>
           <otherwise>
             LEFT OUTER JOIN
           </otherwise>
         </choose>
                            (  SELECT *
                                FROM
                                (
                                    SELECT ROW_NUMBER() OVER (PARTITION BY RO.CAR_OWNER_ID ORDER BY RO.RO_DT DESC) RM
                                    , RO.CAR_OWNER_ID
                                    , RO.RO_DT
                                    FROM SE_0300T RO
                                    WHERE 1=1
                                    AND RO.DLR_CD = #{sDlrCd}
                                    AND RO.CAR_OWNER_ID IS NOT NULL
                                    AND RO.RO_STAT_CD IN ('00', '05')
                                    <if test='sRoDtFrom != null or sRoDtFrom != null'>
                                        <if test='sRoDtFrom != null'>
                                        AND RO.RO_DT <![CDATA[>=]]> trunc(#{sRoDtFrom},'DD')
                                        </if>
                                        <if test='sRoDtTo != null'>
                                        AND RO.RO_DT <![CDATA[<]]> trunc(#{sRoDtTo},'DD') + 1
                                        </if>
                                    </if>
                                ) WHERE RM = 1
                            ) SERINFO ON SERINFO.CAR_OWNER_ID = CUST.CUST_NO

         <if test='sMembershipStan != null and sMembershipStan != ""'>
            <choose>
                <when test='sMembershipStan == "C"'>
                LEFT OUTER JOIN CR_0801T DMB ON DMB.DLR_CD = #{sDlrCd} AND DMB.CUST_NO = CUST.CUST_NO
                </when>
                <otherwise>
                LEFT OUTER JOIN (SELECT *
                                   FROM ( SELECT BP_CD AS CUST_NO,
                                                 MB.MEMBERSHIP_NO,
                                                 MB.GRADE_CD,
                                                 LAST_POINT_VAL,
                                                 DENSE_RANK( ) OVER (PARTITION BY CAR.BP_CD ORDER BY MB.REG_DT DESC ) AS RN
                                            FROM CR_0801T MB
                                           INNER JOIN SA_0123T CAR ON MB.DLR_CD = CAR.DLR_CD AND MB.VIN_NO = CAR.VIN_NO
                                           WHERE MB.DLR_CD = #{sDlrCd}
                                             AND CAR.USE_YN = 'Y' )
                                  WHERE RN = 1 ) DMB ON DMB.CUST_NO = CUST.CUST_NO
                </otherwise>
            </choose>
         </if>

         <if test='sCommand != null and sCommand == "TAGSEARCH"'>
         INNER JOIN ( SELECT DLR_CD,
                         CUST_NO
                    FROM CR_0115T
                   WHERE DLR_CD = #{sDlrCd}
                     AND GRP_TP = '002'
                     AND GRP_SEQ IN
            <foreach collection="tagDS" item="tagItem" open="(" close=")" separator=",">
                #{tagItem}
            </foreach>
                   GROUP BY DLR_CD, CUST_NO) TAG ON CUST.DLR_CD = TAG.DLR_CD AND CUST.CUST_NO = TAG.CUST_NO
         </if>
         WHERE CUST.DLR_CD = #{sDlrCd}
           <if test='sCustNo != null and sCustNo != ""'>
           AND CUST.CUST_NO LIKE '%'||#{sCustNo}||'%'
           </if>
           AND CUST.DEL_YN = 'N'
           <if test='sCust != null and sCust != ""'>
           AND ( CUST.CUST_NM LIKE '%'||#{sCust}||'%' OR CUST.HP_NO LIKE '%'||#{sCust}||'%')
           </if>
           <if test='sCustNm != null and sCustNm != ""'>
           AND CUST.CUST_NM LIKE '%'||#{sCustNm}||'%'
           </if>
           <if test='sCustTp != null and sCustTp != ""'>
           AND CUST.CUST_TP = #{sCustTp}
           </if>
           <if test='sCustCd != null and sCustCd != ""'>
           AND CUST.CUST_CD = #{sCustCd}
           </if>
           <if test='sHpNo != null and sHpNo != ""'>
           AND CUST.HP_NO LIKE '%'||#{sHpNo}||'%'
           </if>
           <if test='sTelNo != null and sTelNo != ""'>
           AND (CUST.TEL_NO LIKE '%'||#{sTelNo}||'%' OR OFFICE_NO LIKE '%'||#{sTelNo}||'%')
           </if>
           <if test='sSexCd != null and sSexCd != ""'>
           AND CUST.SEX_CD = #{sSexCd}
           </if>
           <if test='sSsnCrnNo != null and sSsnCrnNo != ""'>
           AND CUST.SSN_CRN_NO LIKE '%'||UPPER(#{sSsnCrnNo})||'%'
           </if>
           <if test='sMngScId != null and sMngScId != ""'>
           AND CUST.MNG_SC_ID = #{sMngScId}
           </if>
           <if test='sCustCollSrcCd != null and sCustCollSrcCd != ""'>
           AND CUST.CUST_COLL_SRC_CD = #{sCustCollSrcCd}
           </if>
           <if test='sRegDtFrom != null or sRegDtTo != null'>
               <if test='sRegDtFrom != null'>
                AND CUST.REG_DT <![CDATA[>=]]> #{sRegDtFrom}
               </if>
               <if test='sRegDtTo != null'>
               AND CUST.REG_DT <![CDATA[<]]> #{sRegDtTo} + 1
               </if>
           </if>
           <if test='sVinNo != null and sVinNo != ""'>
            AND CUST.CUST_NO IN (
                SELECT OWNER.BP_CD
                  FROM SA_0121T CAR, SA_0123T OWNER
                 WHERE CAR.CAR_ID = OWNER.CAR_ID
                   AND OWNER.DLR_CD = #{sDlrCd}
                   AND OWNER.USE_YN = 'Y'
                   AND CAR.VIN_NO LIKE '%'||#{sVinNo}||'%'
            )
            </if>
            <if test='sCarRegNo != null and sCarRegNo != ""'>
            AND CUST.CUST_NO IN (
                SELECT OWNER.BP_CD
                  FROM SA_0121T CAR, SA_0123T OWNER
                 WHERE CAR.CAR_ID = OWNER.CAR_ID
                   AND OWNER.DLR_CD = #{sDlrCd}
                   AND OWNER.USE_YN = 'Y'
                   AND CAR.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
            )
            </if>
            <if test='sBlueMembershipJoinYn == "Y" '>
            AND CUST.BLUE_MEMBERSHIP_NO IS NOT NULL
            </if>
            <if test='sDlrMbrYn != null and sDlrMbrYn != ""'>
                <if test='sDlrMbrYn == "Y"'>
                    AND DMB.MEMBERSHIP_NO IS NOT NULL
                </if>
                <if test='sDlrMbrYn == "N"'>
                    AND DMB.MEMBERSHIP_NO IS NULL
                </if>
            </if>
    </sql>
    
    <sql id="searchCustomerWhere">

        LEFT OUTER JOIN CR_0211T LEADOPPT ON T1.CUST_NO = LEADOPPT.CUST_NO
        LEFT OUTER JOIN CM_0801T SCT ON T1.MNG_SC_ID = SCT.USR_ID
        LEFT OUTER JOIN CM_0801T TEC ON T1.MNG_TEC_ID = TEC.USR_ID
        LEFT OUTER JOIN CM_0801T USRT ON T1.REG_USR_ID = USRT.USR_ID
        <if test='sCommand != null and sCommand == "TAGSEARCH"'>
        INNER JOIN CR_0115T TAG ON T1.CUST_NO = TAG.CUST_NO AND TAG.GRP_TP = '002'
            AND TAG.GRP_SEQ IN
            <foreach collection="tagDS" item="tagItem" open="(" close=")" separator=",">
                #{tagItem}
            </foreach>
        </if>

        <where>
           T1.DEL_YN = 'N'
            <!-- 고객정보 like 검색 -->
            <if test='sCust != null and sCust != ""'>
                AND ( T1.CUST_NM LIKE '%'||#{sCust}||'%'
                    OR T1.HP_NO LIKE '%'||#{sCust}||'%'
                    OR T1.TEL_NO LIKE '%'||#{sCust}||'%'
                    )
            </if>
           <if test='sMergeYn != null and sMergeYn != ""'>
                AND T1.MERGE_YN = #{sMergeYn}
           </if>
           <if test='sDlrCd != null and sDlrCd != ""'>
                AND T1.DLR_CD = #{sDlrCd}
           </if>
           <if test='sCustNo != null and sCustNo != ""'>
                AND T1.CUST_NO LIKE '%'||#{sCustNo}||'%'
           </if>
           <if test='sSsnCrnNo != null and sSsnCrnNo != ""'>
                AND T1.SSN_CRN_NO LIKE '%'||UPPER(#{sSsnCrnNo})||'%'
           </if>
           <if test='sMngScId != null and sMngScId != ""'>
                AND T1.MNG_SC_ID = #{sMngScId}
           </if>
           <if test='sCustNm != null and sCustNm != ""'>
                AND T1.CUST_NM LIKE '%'||#{sCustNm}||'%'
           </if>
           <if test='sCustTp != null and sCustTp != ""'>
                AND T1.CUST_TP = #{sCustTp}
           </if>
           <if test='sCustCd != null and sCustCd != ""'>
                AND T1.CUST_CD = #{sCustCd}
           </if>
           <if test='sHpNo != null and sHpNo != ""'>
                AND T1.HP_NO LIKE '%'||#{sHpNo}||'%'
           </if>
           <if test='sSexCd != null and sSexCd != ""'>
                AND T1.SEX_CD = #{sSexCd}
           </if>
           <if test='sTelNo != null and sTelNo != ""'>
                AND T1.TEL_NO LIKE '%'||#{sTelNo}||'%'
           </if>
           <if test='sOfficeTelNo != null and sOfficeTelNo != ""'>
                AND T1.OFFICE_TEL_NO LIKE '%'||#{sOfficeTelNo}||'%'
           </if>
           <if test='sEmailNm != null and sEmailNm != ""'>
                AND T1.EMAIL_NM LIKE '%'||#{sEmailNm}||'%'
           </if>
           <if test='sBhmcYn != null and sBhmcYn != ""'>
                AND T1.BHMC_YN = #{sBhmcYn}
           </if>
            <if test='sRegDtFrom != null'>
                <![CDATA[
                    AND T1.REG_DT >= #{sRegDtFrom}   -- 등록일
                ]]>
            </if>
            <if test='sRegDtTo != null'>
                <![CDATA[
                    AND T1.REG_DT < #{sRegDtTo}       -- 등록일
                ]]>
            </if>

            <if test='sAssignYn != null and sAssignYn != ""'>
                <if test='sAssignYn == "Y"'>
                     AND T1.MNG_SC_ID IS NOT NULL           -- SC 배정
                </if >
                <if test='sAssignYn == "N"'>
                     AND T1.MNG_SC_ID IS NULL               -- SC 미배정
                </if>
            </if>
            <if test='sVinNo != null and sVinNo != ""'>
                AND T1.CUST_NO IN (
                    SELECT OWNER.BP_CD
                      FROM SA_0121T CAR, SA_0123T OWNER
                     WHERE CAR.CAR_ID = OWNER.CAR_ID
                       AND OWNER.DLR_CD = #{sDlrCd}
                       AND OWNER.USE_YN = 'Y'
                       AND CAR.VIN_NO LIKE '%'||#{sVinNo}||'%'
                )
            </if>
            <if test='sCarRegNo != null and sCarRegNo != ""'>
                AND T1.CUST_NO IN (
                    SELECT OWNER.BP_CD
                      FROM SA_0121T CAR, SA_0123T OWNER
                     WHERE CAR.CAR_ID = OWNER.CAR_ID
                       AND OWNER.DLR_CD = #{sDlrCd}
                       AND OWNER.USE_YN = 'Y'
                       AND CAR.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                )
            </if>
        </where>
    </sql>
	
    <!-- 고객 수를 조회한다 (고객관리 page) -->
    <select id="selectCustomerListByConditionCnt" parameterType="CustomerInfoSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectCustomerListByConditionCnt] */
          SELECT COUNT(CUST.CUST_NO) AS VALUE
           FROM CR_0101T CUST
          <include refid="searchCustomerListWhere" />
    </select>
    
    <!-- 고객조회 팝업 > 차량정보 기준 고객검색 -->
    <select id="selectCustomerAndCarInfoByConditionCnt" parameterType="CustomerInfoSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectCustomerAndCarInfoByConditionCnt] */
             SELECT COUNT(*)
               FROM CR_0101T CINFO
               <include refid="searchCustomerAndCarInfo" />
    </select>
    
    <!-- 고객조회 팝업 > 차량정보 기준 고객검색 -->
    <select id="selectCustomerAndCarInfoByCondition" parameterType="CustomerInfoSearchVO" resultType="chn.bhmc.dms.mob.api.crm.vo.CustomerInfoVO">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectCustomerAndCarInfoByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T3.* FROM (
                SELECT T2.*
                FROM (
                     SELECT CINFO.CUST_NO
                          , CINFO.CUST_NM
                          , CINFO.CUST_TP  -- 개인/법인
                          , CINFO.HP_NO
                          , CINFO.TEL_NO
                          , CINFO.OFFICE_NO
                          , CINFO.MATH_DOC_TP
                          , CINFO.SSN_CRN_NO
                          , VINFO.VIN_NO
                          , VINFO.CAR_REG_NO
                          , VINFO.CARLINE_CD
                          , VINFO.MODEL_CD
                          , VINFO.CUST_SALE_DT AS SALE_DT
                          , VINFO.EXT_COLOR_CD
                          , VINFO.INT_COLOR_CD
                          , CASE WHEN VINFO.NCAR_DSTIN_CD = 'O' THEN '' ELSE FN_GET_CARLINE_NM(VINFO.CARLINE_CD) END AS CARLINE_NM
                          , CASE WHEN VINFO.NCAR_DSTIN_CD = 'O' THEN '' ELSE FN_GET_MODEL_NM(VINFO.MODEL_CD) END AS MODEL_NM
                          , MB.MEMBERSHIP_NO
                          , CINFO.BLUE_MEMBERSHIP_NO
                          , CINFO.REG_DT
                          , VINFO.OCN_CD
                          , FN_GET_OCN_NM(VINFO.MODEL_CD,VINFO.OCN_CD) AS OCN_NM
                          , VINFO.CAR_RUN_DIST_VAL
                          , CINFO.MNG_SC_ID
                          , CINFO.BLUE_LOGIN_ID
                       FROM CR_0101T CINFO
                       <include refid="searchCustomerAndCarInfo" />
                ) T2
                    ORDER BY
                    <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                    <when test='item.field == "custNo"'>T2.CUST_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custNm"'>T2.CUST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custTp"'>T2.CUST_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "hpNo"'>T2.HP_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "telNo"'>T2.TEL_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "officeNo"'>T2.OFFICE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "ssnCrnNo"'>T2.SSN_CRN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "vinNo"'>T2.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carRegNo"'>T2.CAR_REG_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carlineCd"'>T2.CARLINE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "modelCd"'>T2.MODEL_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "saleDt"'>T2.SALE_DT <choose><when test='item.dir == "asc"'>ASC NULLS FIRST</when><otherwise>DESC NULLS LAST</otherwise></choose></when>
                                    <when test='item.field == "saleDtFormat"'>T2.SALE_DT <choose><when test='item.dir == "asc"'>ASC NULLS FIRST</when><otherwise>DESC NULLS LAST</otherwise></choose></when>
                                    <when test='item.field == "carlineNm"'>T2.CARLINE_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "modelNm"'>T2.MODEL_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "membershipNo"'>T2.MEMBERSHIP_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "blueMembershipNo"'>T2.BLUE_MEMBERSHIP_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regDt"'>T2.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regDtFormat"'>T2.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <otherwise>
                                        T2.REG_DT DESC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            T2.REG_DT DESC
                        </otherwise>
                    </choose>
            ) T3
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

  <!-- 고객 정보를 조회한다 (고객관리 page)  -->
    <select id="selectCustomerListByCondition" parameterType="CustomerInfoSearchVO" resultType="chn.bhmc.dms.mob.api.crm.vo.CustomerInfoVO">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectCustomerListByCondition] */
        SELECT T4.*
             , ADDR.ZIP_CD
             , ADDR.SUNG_NM
             , ADDR.CITY_NM
             , ADDR.DIST_NM
             , ADDR.ADDR_DETL_CONT
             , ADDR.SEQ AS ADDR_SEQ
             , ADDR.ADDR_TP
             , FN_GET_USER_NM(T4.MNG_SC_ID) AS MNG_SC_NM
             , LEADOPPT.LEAD_STAT_CD
             , FN_GET_TAG_NM(T4.DLR_CD, T4.CUST_NO, '002') AS TAG_TXT
          FROM (
            SELECT *
               FROM ( SELECT ROWNUM AS RNUM,
                             T3.*
                        FROM ( SELECT CUST.DLR_CD
                                     , CUST.CUST_NO
                                     , CUST.CUST_NM
                                     , CUST.CUST_TP
                                     , CUST.CUST_CD
                                     , CUST.SEX_CD
                                     , CUST.BIRTH_DT
                                     , CUST.HP_NO
                                     , DECODE(CUST.CUST_TP, '01', CUST.TEL_NO, CUST.OFFICE_TEL_NO) AS TEL_NO
                                     , CUST.MATH_DOC_TP
                                     , CUST.SSN_CRN_NO
                                     , CUST.HP_NO_INVLD_YN
                                     , CUST.HP_NO_ADD_IMPOS_YN
                                     , CUST.PURC_MNG_NM
                                     , CUST.MNG_SC_ID
                                     , CUST.BLUE_MEMBERSHIP_NO
                                     , CUST.AGE_DTL
                                     , CUST.CHINA_ZODIAC_SIGN_CD
                                     , DMB.CUST_NO AS DLR_MBR_YN
                                     , DMB.MEMBERSHIP_NO
                                     , CUST.TAXPAYER_NO
                                     , CUST.CUST_COLL_SRC_CD
                                     , CUST.REG_DT
                                     , CARINFO.CARLINE_CD
                                     , CARINFO.CAR_REG_NO
                                     , CARINFO.CAR_RUN_DIST_VAL
                                     , CARINFO.CUST_SALE_DT AS SALE_DT
                                     , CUST.BLUE_LOGIN_ID
                                     , SERINFO.RO_DT
                                  FROM CR_0101T CUST
                                  <include refid="searchCustomerListWhere" />
                            ORDER BY
                            <choose>
                                <when test='sort != null'>
                                    <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                        <choose>
                                            <when test='item.field == "custNo"'>CUST.CUST_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                            <when test='item.field == "custNm"'>CUST.CUST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                            <when test='item.field == "sexCd"' > CUST.SEX_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                            <when test='item.field == "birthDt"' > CUST.BIRTH_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                            <when test='item.field == "hpNo"'>CUST.HP_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                            <when test='item.field == "sexCd"'>CUST.SEX_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                            <when test='item.field == "telNo"'>DECODE(CUST.CUST_TP,'01',CUST.TEL_NO, CUST.OFFICE_NO) <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                            <when test='item.field == "mathDocTp"'>CUST.MATH_DOC_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                            <when test='item.field == "ssnCrnNo"'>CUST.SSN_CRN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                            <when test='item.field == "hpNoInvldYn"'>CUST.HP_NO_INVLD_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                            <when test='item.field == "hpNoAddImposYn"'>CUST.HP_NO_ADD_IMPOS_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                            <when test='item.field == "mngScId"'>CUST.MNG_SC_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                            <when test='item.field == "blueMembershipNo"'>DECODE(CUST.BLUE_MEMBERSHIP_NO, null ,'N', 'Y') <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                            <when test='item.field == "regDt"'>CUST.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                            <otherwise>
                                                CUST.REG_DT DESC
                                            </otherwise>
                                        </choose>
                                    </foreach>
                                </when>
                                <otherwise>
                                    CUST.REG_DT DESC
                                </otherwise>
                            </choose> ) T3
                <where>
                    <if test='firstIndex != -1 and lastIndex != -1'>
                        AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                    </if>
                </where>
                )
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM > #{firstIndex}
                </if>
            </where>
             ) T4
             LEFT OUTER JOIN CR_0211T LEADOPPT ON T4.DLR_CD = LEADOPPT.DLR_CD AND T4.CUST_NO = LEADOPPT.CUST_NO
             LEFT OUTER JOIN (
                 SELECT
                      ROW_NUMBER() OVER(PARTITION BY  DLR_CD, REF_TABLE_NM, REF_KEY_NM  ORDER BY NVL(UPDT_DT, REG_DT) DESC ) AS ADDR_NUM
                     ,DLR_CD
                     ,SEQ
                     ,REF_TABLE_NM
                     ,REF_KEY_NM
                     ,ADDR_TP
                     ,SUNG_CD
                     ,CITY_CD
                     ,DIST_CD
                     ,ZIP_CD
                     ,SUNG_NM
                     ,CITY_NM
                     ,DIST_NM
                     ,ADDR_DETL_CONT
                 FROM CR_0116T
                 WHERE DLR_CD = #{sDlrCd}
                 AND USE_YN = 'Y'
                 AND REF_TABLE_NM = 'CR_0101T'
             <choose>
                 <when test='sAddrTp == "02"'>
                     AND ADDR_TP = '02'
                 </when>
                 <otherwise>
                     AND FLAG_YN = 'Y'
                     <if test='sAddrTp != null and sAddrTp != ""'>
                         AND ADDR_TP = #{sAddrTp}
                     </if>
                 </otherwise>
             </choose>
             ) ADDR ON T4.DLR_CD = ADDR.DLR_CD AND T4.CUST_NO = ADDR.REF_KEY_NM AND ADDR_NUM = 1
             ORDER BY RNUM
    </select>

    <!-- 고객 수를 조회한다. 판매사원용 -->
    <select id="selectCustomerInfoByConditionCnt" parameterType="CustomerInfoSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectCustomerInfoByConditionCnt] */
        SELECT COUNT(T3.CUST_NO) AS VALUE
        FROM (
          SELECT T2.* FROM (
          SELECT
            T1.CUST_NO
            , (
                SELECT MAX(A.REAL_DL_DT)
                  FROM SA_0201T A
                 WHERE     CONTRACT_CUST_NO = T1.CUST_NO
                       AND CONTRACT_STAT_CD = '50'
                       AND REAL_DL_DT IS NOT NULL
            ) AS FIRST_SALE_DT
            , (SELECT CUST_NO FROM (SELECT CUST_NO FROM CR_0801T WHERE DLR_CD = #{sDlrCd} GROUP BY CUST_NO) WHERE CUST_NO = T1.CUST_NO) AS DLR_MBR_YN
          FROM CR_0101T T1
          <include refid="searchCustomerInfoWhere" />
          ) T2
            <where>
                <if test='sSaleDtFrom != null'>
                    AND T2.FIRST_SALE_DT <![CDATA[>=]]> trunc(#{sSaleDtFrom},'DD')
                </if>
                <if test='sSaleDtTo != null'>
                    AND T2.FIRST_SALE_DT <![CDATA[<]]> trunc(#{sSaleDtTo},'DD')+1
                </if>
                <if test='sDlrMbrYn != null and sDlrMbrYn != ""'>
                    AND T2.DLR_MBR_YN IS NULL
                </if>
            </where>
        ) T3
    </select>

    <!-- 고객를 조회한다. 판매사원용-->
    <select id="selectCustomerInfoByCondition" parameterType="CustomerInfoSearchVO" resultType="chn.bhmc.dms.mob.api.crm.vo.CustomerInfoVO">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectCustomerInfoByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T3.* FROM (
                SELECT T2.*
                FROM (
                    SELECT
                        T1.DLR_CD
                        , T1.CUST_NO
                        , T1.CUST_NM
                        , T1.CUST_CD
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'CRM023'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.CUST_CD = Z1.CMM_CD
                          ) AS CUST_CD_NM
                        , NVL(T1.SSN_CRN_NO,' ') AS SSN_CRN_NO
                        , T1.CUST_TP
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'CRM001'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.CUST_TP = Z1.CMM_CD
                          ) AS CUST_TP_NM
                        , T1.MNG_SC_ID
                        , T1.SALE_SC_ID
                        , T1.MNG_TEC_ID
                        , T1.EMAIL_NM
                        , T1.WECHAT_ID
                        , T1.QQ_ID
                        , T1.FACEBOOK_ID
                        , T1.TWITTER_ID
                        , T1.PREF_COMM_MTH_CD
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'CRM022'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.PREF_COMM_MTH_CD = Z1.CMM_CD
                          ) AS PREF_COMM_MTH_CD_NM
                        , T1.PREF_COMM_NO
                        , T1.PREF_CONTACT_MTH_CD
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'CRM038'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.PREF_CONTACT_MTH_CD = Z1.CMM_CD
                          ) AS PREF_CONTACT_MTH_CD_NM
                        , T1.PREF_CONTACT_TIME_CD
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'CRM027'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.PREF_CONTACT_TIME_CD = Z1.CMM_CD
                          ) AS PREF_CONTACT_TIME_CD_NM
                        , T1.TEL_NO
                        , NVL(T1.HP_NO,' ') AS HP_NO
                        , T1.HP_NO_INVLD_YN
                        , T1.HP_NO_ADD_IMPOS_YN
                        , T1.JOB_CD
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'CRM002'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.JOB_CD = Z1.CMM_CD
                          ) AS JOB_CD_NM
                        , T1.DUTY_CD
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'CRM037'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.DUTY_CD = Z1.CMM_CD
                          ) AS DUTY_CD_NM
                        , T1.OFFICE_NM
                        , T1.DEPT_NM
                        , NVL(T1.OFFICE_TEL_NO,' ') AS OFFICE_TEL_NO
                        , T1.OFFICE_FAX_NO
                        , T1.OWN_RGST_NM
                        , T1.CMP_TP
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'CRM032'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.CMP_TP = Z1.CMM_CD
                          ) AS CMP_TP_NM
                        , T1.CMP_SCALE_CONT
                        , NVL(T1.MATH_DOC_TP,' ') AS MATH_DOC_TP
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'CRM024'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.MATH_DOC_TP = Z1.CMM_CD
                        ) AS MATH_DOC_TP_NM
                        , T1.OFFICE_NO
                        , T1.DM_PLACE_CD
                        , T1.DM_NM
                        , T1.SMS_RECEIVE_YN
                        , T1.TEL_RECEIVE_YN
                        , T1.DM_RECEIVE_YN
                        , T1.EMAIL_RECEIVE_YN
                        , T1.FAX_RECEIVE_YN
                        , T1.DM_RETURN_YN
                        , T1.EMAIL_RETURN_YN
                        , T1.DISUSE_YN
                        , T1.VIP_YN
                        , T1.CHG_BUY_YN
                        , T1.DISUSE_CD
                        , T1.BUY_CNT
                        , T1.CUST_HOLD_TP
                        , T1.CUST_HOLD_TP_DTL
                        , T1.SEX_CD
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'COM017'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.SEX_CD = Z1.CMM_CD
                          ) AS SEX_CD_NM
                        , T1.BIRTH_DT
                        , T1.MARRY_DT
                        , T1.MARRY_CD
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'CRM028'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.MARRY_CD = Z1.CMM_CD
                          ) AS MARRY_CD_NM
                        , T1.BEF_MNG_SC_ID
                        , T1.PER_INFO_AGREE_YN
                        , T1.PER_INFO_USE_YN
                        , T1.AC_CAREER_CD
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'CRM012'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.AC_CAREER_CD = Z1.CMM_CD
                          ) AS AC_CAREER_CD_NM
                        , T1.INCOME_LVL_CD
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'CRM013'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.INCOME_LVL_CD = Z1.CMM_CD
                          ) AS INCOME_LVL_CD_NM
                        , T1.AGE_DTL
                        , T1.CHINA_ZODIAC_SIGN_CD
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'CRM034'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.CHINA_ZODIAC_SIGN_CD = Z1.CMM_CD
                          ) AS CHINA_ZODIAC_SIGN_CD_NM
                        , T1.ZODIAC_SIGN_CD
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'CRM035'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.ZODIAC_SIGN_CD = Z1.CMM_CD
                          ) AS ZODIAC_SIGN_CD_NM
                        , T1.CHILDREN_CNT
                        , T1.BLOOD_TP
                        , T1.AGE_CD
                        , T1.PURC_CAR_BRAND_CD
                        , T1.PURC_CAR_MODEL_NM
                        , T1.MERGE_YN
                        , T1.DEL_YN
                        , T1.BHMC_YN
                        , T1.SIEBEL_ROW_ID
                        , T1.REG_USR_ID
                        , T1.REG_DT
                        , T1.UPDT_USR_ID
                        , T1.UPDT_DT
                        , T1.DOC_ID
                        , T1.BIZCOND_CD
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'CRM031'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.BIZCOND_CD = Z1.CMM_CD
                          ) AS BIZCOND_CD_NM
                        , T1.BLUE_MEMBERSHIP_NO
                        , T1.BLUE_MEMBERSHIP_JOIN_DT
                        , T1.BLUE_MEMBERSHIP_JOIN_DLR_CD
                        , T1.BAT_YN
                        , T1.HP_NO_RECEIVE_YN
                        , T1.BLUE_GRADE_CHG_DT
                        , T1.BLUE_GRADE_NM
                        , T1.BLUE_AVLB_POINT_VAL
                        , T1.TAXPAYER_NO
                        , T1.CUST_COLL_SRC_CD
                        , ( SELECT Z1.CMM_CD_NM FROM (SELECT A.CMM_CD, NVL(B.CMM_CD_TXT, A.CMM_CD_NM) AS CMM_CD_NM FROM CM_0303T A LEFT OUTER JOIN CM_0304T B ON A.CMM_GRP_CD = B.CMM_GRP_CD AND A.CMM_CD = B.CMM_CD
                                                    AND B.LANG_CD = #{sLangCd}
                                                    WHERE A.CMM_GRP_CD = 'CRM042'
                                                    AND A.USE_YN = 'Y') Z1
                            WHERE T1.CUST_COLL_SRC_CD = Z1.CMM_CD
                          ) AS CUST_COLL_SRC_CD_NM
                        , SCT.USR_NM AS MNG_SC_NM                        --MNG_SC_NM
                        , TEC.USR_NM AS MNG_TEC_NM                        --MNG_TEC_NM
                        , USRT.USR_NM AS REG_USR_NM            --등록자이름
                        , (SELECT MAX(B.RESV_DT ) KEEP (DENSE_RANK FIRST ORDER BY B.RESV_DT DESC , B.RESV_DT DESC ) FROM CR_0206T B WHERE B.CUST_NO = T1.CUST_NO AND B.VSIT_STAT_CD != '02' ) AS PRE_VSIT_DT
                        , (SELECT MAX(B.RESV_DT ) KEEP (DENSE_RANK FIRST ORDER BY B.RESV_DT DESC , B.RESV_DT DESC ) FROM CR_0401T B WHERE B.CUST_NO = T1.CUST_NO AND B.TDRV_STAT_CD != '02' ) AS PRE_TDRV_DT
                        , (SELECT MAX(B.SALE_OPPT_STEP_CD ) KEEP (DENSE_RANK FIRST ORDER BY B.SALE_OPPT_NO DESC , B.SALE_OPPT_NO DESC ) FROM CR_0201T B WHERE B.CUST_NO = T1.CUST_NO ) AS SALE_OPPT_STEP_CD
                        , (SELECT SEQ FROM CR_0211T WHERE CUST_NO = T1.CUST_NO) AS SALES_OPPT_SEQ
                        , (
                            SELECT MAX(B.CUST_SALE_DT)
                              FROM SA_0123T A
                             INNER JOIN SA_0121T B
                                ON A.CAR_ID = B.CAR_ID
                             WHERE A.USE_YN = 'Y'
                               AND A.DLR_CD = #{sDlrCd}
                               AND A.BP_CD = T1.CUST_NO
                        ) AS SALE_DT
                        , (
                            SELECT MIN(A.REAL_DL_DT)
                              FROM SA_0201T A
                             WHERE     CONTRACT_CUST_NO = T1.CUST_NO
                                   AND CONTRACT_STAT_CD = '50'
                                   AND REAL_DL_DT IS NOT NULL
                        ) AS FIRST_SALE_DT
                        , ADDR.SEQ AS ADDR_SEQ
                        , ADDR.ZIP_CD
                        , ADDR.SUNG_CD
                        , ADDR.CITY_CD
                        , ADDR.DIST_CD
                        , ADDR.ADDR_DETL_CONT
                        , ADDR.SUNG_NM
                        , ADDR.CITY_NM
                        , ADDR.DIST_NM
                        , ADDR.SUNG_NM || ' ' || ADDR.CITY_NM || ' ' || ADDR.DIST_NM || ' ' || ADDR.ADDR_DETL_CONT AS ADDR_FULL
                        , ADDR.ADDR_TP
                        , T1.PURC_MNG_NM
                        , FN_CHK_ALBE_SSNCRNNO(T1.DLR_CD, T1.CUST_NO) AS ABLE_SSNCRNNO
                        , (SELECT
                            MEMBERSHIP_NO
                           FROM CR_0801T WHERE DLR_CD = #{sDlrCd}
                           AND CUST_NO = T1.CUST_NO
                <if test='sMembershipStan != null and sMembershipStan != ""'>
                    <choose>
                        <when test='sMembershipStan == "V"'>
                            AND VIN_NO = #{sVinNo}
                        </when>
                    </choose>
                </if>
                            AND ROWNUM = 1
                           ) AS DLR_MBR_YN
                        , T1.BLUE_LOGIN_ID
                    FROM CR_0101T T1
                    <include refid="searchCustomerInfoWhere" />
                ) T2
                <where>
                    <if test='sSaleDtFrom != null'>
                        AND T2.FIRST_SALE_DT <![CDATA[>=]]> trunc(#{sSaleDtFrom},'DD')
                    </if>
                    <if test='sSaleDtTo != null'>
                        AND T2.FIRST_SALE_DT <![CDATA[<]]> trunc(#{sSaleDtTo},'DD')+1
                    </if>
                    <if test='sDlrMbrYn != null and sDlrMbrYn != ""'>
                        AND T2.DLR_MBR_YN IS NULL
                    </if>
                </where>
                    ORDER BY
                    <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                    <when test='item.field == "custNo"'>T2.CUST_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custTp"'>T2.CUST_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custNm"'>T2.CUST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custCd"'>T2.CUST_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "hpNo"'>T2.HP_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "emailNm"'>T2.EMAIL_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regDt"'>T2.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "mngScId"'>T2.MNG_SC_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "officeTelNo"'>T2.OFFICE_TEL_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custCdNm"' > T2.CUST_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custTpNm"' > T2.CUST_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "prefCommMthCdNm"' > T2.PREF_COMM_MTH_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "prefContactMthCdNm"' > T2.PREF_CONTACT_MTH_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "prefContactTimeCdNm"' > T2.PREF_CONTACT_TIME_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "jobCdNm"' > T2.JOB_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "dutyCdNm"' > T2.DUTY_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "cmpTpNm"'> T2.CMP_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "sexCdNm"' > T2.SEX_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "marryCdNm"' > T2.MARRY_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "acCareerCdNm"' > T2.AC_CAREER_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "incomeLvlCdNm"' > T2.INCOME_LVL_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "chinaZodiacSignCdNm"' > T2.CHINA_ZODIAC_SIGN_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "zodiacSignCdNm"' > T2.ZODIAC_SIGN_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "bizcondCdNm"' > T2.BIZCOND_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regDt"'>T2.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regDtFormat"'>T2.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regUsrId"'>T2.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <otherwise>
                                        T2.REG_DT DESC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            T2.REG_DT DESC
                        </otherwise>
                    </choose>
            ) T3
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>
    
    <!-- 고객 수를 조회한다. 판매사원용 -->
    <select id="selectCustomerByConditionCnt" parameterType="CustomerInfoSearchVO" resultType="int">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectCustomerInfoByConditionCnt] */
        SELECT COUNT(T3.CUST_NO) AS VALUE
        FROM (
          SELECT T2.* FROM (
          SELECT
            T1.CUST_NO
            , (
                SELECT MAX(A.REAL_DL_DT)
                  FROM SA_0201T A
                 WHERE     CONTRACT_CUST_NO = T1.CUST_NO
                       AND CONTRACT_STAT_CD = '50'
                       AND REAL_DL_DT IS NOT NULL
            ) AS FIRST_SALE_DT
            , (SELECT CUST_NO FROM (SELECT CUST_NO FROM CR_0801T WHERE DLR_CD = #{sDlrCd} GROUP BY CUST_NO) WHERE CUST_NO = T1.CUST_NO) AS DLR_MBR_YN
          FROM CR_0101T T1
          <include refid="searchCustomerInfoWhere" />
          ) T2
            <where>
                <if test='sSaleDtFrom != null'>
                    AND T2.FIRST_SALE_DT <![CDATA[>=]]> trunc(#{sSaleDtFrom},'DD')
                </if>
                <if test='sSaleDtTo != null'>
                    AND T2.FIRST_SALE_DT <![CDATA[<]]> trunc(#{sSaleDtTo},'DD')+1
                </if>
                <if test='sDlrMbrYn != null and sDlrMbrYn != ""'>
                    AND T2.DLR_MBR_YN IS NULL
                </if>
            </where>
        ) T3
    </select>

    <!-- 고객를 조회한다. 판매사원용-->
    <select id="selectCustomerByCondition" parameterType="CustomerInfoSearchVO" resultType="chn.bhmc.dms.mob.api.crm.vo.CustomerInfoVO">
        /* [chn.bhmc.dms.crm.cif.service.dao.CustomerInfoDAO.selectCustomerInfoByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T3.* FROM (
                SELECT T2.*
                FROM (
                    SELECT
                        T1.DLR_CD
                        , T1.CUST_NO
                        , T1.CUST_NM
                        , T1.CUST_CD
                        , T1.CUST_TP
                        , NVL(T1.HP_NO,' ') AS HP_NO
                        , T1.SEX_CD
                        , T1.MNG_SC_ID
                        , T1.MNG_TEC_ID
                        , T1.REG_USR_ID
                        , T1.DEL_YN
                        , T1.REG_DT
                    FROM CR_0101T T1
                    <include refid="searchCustomerWhere" />
                ) T2
                <where>
                    <if test='sSaleDtFrom != null'>
                        AND T2.FIRST_SALE_DT <![CDATA[>=]]> trunc(#{sSaleDtFrom},'DD')
                    </if>
                    <if test='sSaleDtTo != null'>
                        AND T2.FIRST_SALE_DT <![CDATA[<]]> trunc(#{sSaleDtTo},'DD')+1
                    </if>
                    <if test='sDlrMbrYn != null and sDlrMbrYn != ""'>
                        AND T2.DLR_MBR_YN IS NULL
                    </if>
                </where>
                    ORDER BY
                    <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                    <when test='item.field == "custNo"'>T2.CUST_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custTp"'>T2.CUST_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custNm"'>T2.CUST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custCd"'>T2.CUST_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "hpNo"'>T2.HP_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "emailNm"'>T2.EMAIL_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regDt"'>T2.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "mngScId"'>T2.MNG_SC_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "officeTelNo"'>T2.OFFICE_TEL_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custCdNm"' > T2.CUST_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custTpNm"' > T2.CUST_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "prefCommMthCdNm"' > T2.PREF_COMM_MTH_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "prefContactMthCdNm"' > T2.PREF_CONTACT_MTH_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "prefContactTimeCdNm"' > T2.PREF_CONTACT_TIME_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "jobCdNm"' > T2.JOB_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "dutyCdNm"' > T2.DUTY_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "cmpTpNm"'> T2.CMP_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "sexCdNm"' > T2.SEX_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "marryCdNm"' > T2.MARRY_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "acCareerCdNm"' > T2.AC_CAREER_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "incomeLvlCdNm"' > T2.INCOME_LVL_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "chinaZodiacSignCdNm"' > T2.CHINA_ZODIAC_SIGN_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "zodiacSignCdNm"' > T2.ZODIAC_SIGN_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "bizcondCdNm"' > T2.BIZCOND_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regDt"'>T2.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regDtFormat"'>T2.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regUsrId"'>T2.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <otherwise>
                                        T2.REG_DT DESC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            T2.REG_DT DESC
                        </otherwise>
                    </choose>
            ) T3
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

</mapper>