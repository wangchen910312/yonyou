<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : SalesInvoiceScanDAO_SqlMap.xml
    Description : APP扫描发票信息
    author jiaMing
    since 2021. 4. 13.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2021. 4. 13.     jiaMing            APP扫描发票信息
-->

<mapper namespace="chn.bhmc.dms.mob.api.sales.dao.SalesInvoiceScanDAO">

    <!-- 查询发票信息 -->
    <select id="selectInvoiceInfoCnt" parameterType="chn.bhmc.dms.mob.api.sales.vo.SalesInvoiceVO" resultType="int">
     
       SELECT COUNT(*)
           FROM SA_0510T A           
         WHERE 1 = 1
	        <if test='receiptNo != null  and receiptNo  != ""'>
	           AND A.RECEIPT_NO = #{receiptNo}
	        </if>
	        <if test='receiptCd != null  and receiptCd  != ""'>
               AND A.RECEIPT_CD = #{receiptCd}
            </if>
           
     </select>
     
    <!-- 查询发票信息 -->
    <select id="selectInvoiceInfo" parameterType="chn.bhmc.dms.mob.api.sales.vo.SalesInvoiceVO" resultType="chn.bhmc.dms.mob.api.sales.vo.SalesInvoiceVO">
      
        SELECT *
           FROM SA_0510T A           
         WHERE 1 = 1
	        <if test='receiptNo != null  and receiptNo  != ""'>
	           AND A.RECEIPT_NO = #{receiptNo}
	        </if>
	        <if test='receiptCd != null  and receiptCd  != ""'>
               AND A.RECEIPT_CD = #{receiptCd}
            </if>
    </select>
    
    <!-- 写入扫描发票信息 -->
    <insert id="insertInvoiceInfo" parameterType="chn.bhmc.dms.mob.api.sales.vo.SalesInvoiceVO">
           
           INSERT INTO SA_0510T
                (
                         APP_RECEIPT_ID
						,RECEIPT_NO
						,RECEIPT_CD
						,RECEIPT_ISS_DT
						,SUM_AMT
						,CERT_FST
						,RECEIPT_RESOURCE
						,RECEIPT_IN_RESOURCE
						,RECEIPT_STATUS
						,SCAN_DT
						,REG_USR_ID
						,REG_DT
				) VALUES (
				       SEQ_SA0510T.NEXTVAL
				      ,#{receiptNo}
				      ,#{receiptCd}
				      ,#{receiptIssDt}
				      ,#{sumAmt}
				      ,#{certFst}
				      ,#{receiptResource}
				      ,#{receiptInResource}
				      ,#{receiptStatus}
				      ,#{scanDt}
				      ,#{regUsrId}
				      ,SYSDATE
				)
    </insert>
   
   <!-- 更新扫描发票信息 -->
   <update id="updateInvoiceInfo"  parameterType="chn.bhmc.dms.mob.api.sales.vo.SalesInvoiceVO">
        UPDATE  SA_0510T SET
                RECEIPT_ISS_DT = #{receiptIssDt}
                ,SUM_AMT        = #{sumAmt}
                ,CERT_FST       = #{certFst}
                ,RECEIPT_RESOURCE = #{receiptResource}
                ,RECEIPT_IN_RESOURCE = #{receiptInResource}
                ,RECEIPT_STATUS = #{receiptStatus}
                ,SCAN_DT   = #{scanDt}
            WHERE   1 = 1
             AND  RECEIPT_CD = #{receiptCd}
             AND  RECEIPT_NO  = #{receiptNo}
    </update>
    
    <!-- 车辆主信息保修开始日期修改 -->
    <update id="updateVehicleMasterMain" parameterType="VehicleMasterVO">
       UPDATE SA_0121T
        SET    UPDT_USR_ID = #{updtUsrId}
             , UPDT_DT = SYSDATE
             , GRTE_START_DT = #{grteStartDt}
             , TEMP4 = 'I'
             , BINDING_RECEIPT_FLAG = '机动车发票'
         WHERE CAR_ID = #{carId}
    </update>
    
    <!-- 若车辆不存在，SA_0501T表的BINDING_CAR_YN字段为N  -->
     <update id="updateBindingCarYn" parameterType="java.util.Map">
        UPDATE SA_0501T 
           SET BINDING_CAR_YN = #{bindingCarYn}
        WHERE CAR_ID = #{carId}       
    </update>
</mapper>