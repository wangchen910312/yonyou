<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : RepairOrderDAO_SqlMap.xml
    Description : RO에 관한 데이터처리
    author KyungMok Kim
    since 2016. 03. 14.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 03. 14.  KyungMok Kim     최초 생성
-->

<mapper namespace="chn.bhmc.dms.mob.api.repair.dao.RepairRepairOrderDAO">
	
	<!-- 정비진도현황 목록수를 조회. -->
    <select id="selectRepairOrderInfoListByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.mob.api.repair.dao.RepairOrderAppDAO.selectRepairOrderInfoListByCondition] */
         SELECT COUNT(RO_DOC_NO) AS VALUE FROM (
              SELECT B.* FROM(
                    SELECT A.DLR_CD
                          ,A.RO_DOC_NO
                          ,A.RO_TP
                          ,A.QT_TEST_END_DT                                                              --품질검사종료일자
                          ,A.DL_CHK_DT                                                                   --인도확인일자
                          ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                          ,( SELECT MAX(WRK_END_DT)
                               FROM SE_0330T
                              WHERE DLR_CD = A.DLR_CD
                                AND RO_DOC_NO = A.RO_DOC_NO
                             ) AS WRK_END_DT                                                          --작업 완료시간
                          ,( SELECT MAX(REG_DT)
                               FROM SE_0330T
                              WHERE DLR_CD = A.DLR_CD
                                AND RO_DOC_NO = A.RO_DOC_NO
                             ) AS ALLOC_END_DT                                                        --배정 완료시간
                      FROM SE_0300T A
                    <where>
                        <if test='sDlrCd != null and sDlrCd != ""'>
                            AND A.DLR_CD = #{sDlrCd}
                        </if>
                        <if test='sRoDocNo != null and sRoDocNo != ""'>
                            AND A.RO_DOC_NO like '%'||#{sRoDocNo}||'%'
                        </if>
                        <if test='sVinNo != null and sVinNo != ""'>
                            AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                        </if>
                        <if test='sDriverId != null and sDriverId != ""'>
                            AND A.DRIVER_ID = #{sDriverId}
                        </if>
                        <if test='sDriverNm != null and sDriverNm != ""'>
                            AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                        </if>
                        <if test='sCarRegNo != null and sCarRegNo != ""'>
                            AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                        </if>
                        <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                            AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                        </if>
                        <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                            AND A.CAR_OWNER_ID = #{sCarOwnerId}
                        </if>
                        <if test='sBayNo != null and sBayNo != ""'>
                            AND A.BAY_NO = #{sBayNo}
                        </if>
                        <if test='sRoTp != null and sRoTp != ""'>
                            AND A.RO_TP = #{sRoTp}
                        </if>
                        <if test='sRoStatCd != null and sRoStatCd != ""'>
                            AND A.RO_STAT_CD = #{sRoStatCd}
                        </if>
                        <if test='sRoFromDt != null'>
                            AND A.RO_DT <![CDATA[>=]]> #{sRoFromDt}
                        </if>
                        <if test='sRoToDt != null'>
                            AND A.RO_DT <![CDATA[<]]> #{sRoToDt} + 1
                        </if>
                        <if test='sRoStartDt != null'>
                            AND A.RO_START_DT <![CDATA[>=]]> #{sRoStartDt}
                        </if>
                        <if test='sRoEndDt != null'>
                            AND A.RO_END_DT <![CDATA[<]]> #{sRoEndDt} + 1
                        </if>
                        <if test='sExpcDlFromDt != null'>
                            AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
                        </if>
                        <if test='sExpcDlToDt != null'>
                            AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
                        </if>
                    </where>
                )B
          )T1
          <where>
          <if test='sRegUsrNm != null and sRegUsrNm != ""'>
             T1.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
          </if>
          <if test='sAssignFromDt != null'>
              AND T1.ALLOC_END_DT <![CDATA[>=]]> #{sAssignFromDt}
          </if>
          <if test='sAssignToDt != null'>
              AND T1.ALLOC_END_DT <![CDATA[<]]> #{sAssignToDt} + 1
          </if>
          <if test='sWorkFromDt != null'>
              AND T1.WRK_END_DT <![CDATA[>=]]> #{sWorkFromDt}
          </if>
          <if test='sWorkToDt != null'>
              AND T1.WRK_END_DT <![CDATA[<]]> #{sWorkToDt} + 1
          </if>
          <if test='sQtTestFromDt != null'>
              AND T1.QT_TEST_END_DT <![CDATA[>=]]> #{sQtTestFromDt}
          </if>
          <if test='sQtTestToDt != null'>
              AND T1.QT_TEST_END_DT <![CDATA[<]]> #{sQtTestToDt} + 1
          </if>
          <if test='sDlChkFromDt != null'>
              AND T1.DL_CHK_DT <![CDATA[>=]]> #{sDlChkFromDt}
          </if>
          <if test='sDlChkToDt != null'>
              AND T1.DL_CHK_DT <![CDATA[<]]> #{sDlChkToDt} + 1
          </if>
          </where>
    </select>
	
	<!-- RO접수현황 목록수를 조회. -->
    <select id="selectRepairOrderListByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.mob.api.repair.dao.RepairOrderAppDAO.selectRepairOrderListByConditionCnt] */
         SELECT COUNT(RO_DOC_NO) AS VALUE FROM (
              SELECT T1.*
                FROM(
                      SELECT B.*
                            ,C.CALC_DOC_NO
                            ,(SELECT USR_NM FROM CM_0801T WHERE DLR_CD = C.DLR_CD AND USR_ID = C.REG_USR_ID) AS CALC_PRSN_NM
                            ,(SELECT MAX(RCV_CPLT_DT) FROM SE_0570T WHERE RCV_DOC_NO = D.RCV_DOC_NO) AS PAY_END_DT --지불완료시간
                            ,(SELECT ORD_DLR_CD FROM SA_0121T WHERE VIN_NO = B.VIN_NO AND ROWNUM = 1) AS ORD_DLR_CD --판매딜러
                            ,(SELECT BLUE_MEMBERSHIP_NO FROM CR_0101T WHERE DLR_CD = B.DLR_CD AND CUST_NO = B.CAR_OWNER_ID) AS BLUE_MEMBERSHIP_NO --BM회원번호
                        FROM(
                              SELECT A.DLR_CD
                                    ,A.RO_DOC_NO
                                    ,A.RO_TP
                                    ,A.VIN_NO
                                    ,A.CAR_OWNER_ID
                                    ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                                    ,(SELECT CUST_SALE_DT FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CUST_SALE_DT --차량판매일
                                FROM SE_0300T A
                                <where>
                                    <if test='sDlrCd != null and sDlrCd != ""'>
                                        AND A.DLR_CD = #{sDlrCd}
                                    </if>
                                    <if test='sRoDocNo != null and sRoDocNo != ""'>
                                        AND A.RO_DOC_NO like '%'||#{sRoDocNo}||'%'
                                    </if>
                                    <if test='sVinNo != null and sVinNo != ""'>
                                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                                    </if>
                                    <if test='sDriverId != null and sDriverId != ""'>
                                        AND DRIVER_ID = #{sDriverId}
                                    </if>
                                    <if test='sDriverNm != null and sDriverNm != ""'>
                                        AND DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                                    </if>
                                    <if test='sCarRegNo != null and sCarRegNo != ""'>
                                        AND CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                                    </if>
                                    <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                                        AND CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                                    </if>
                                    <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                                        AND A.CAR_OWNER_ID = #{sCarOwnerId}
                                    </if>
                                    <if test='sBayNo != null and sBayNo != ""'>
                                        AND A.BAY_NO = #{sBayNo}
                                    </if>
                                    <if test='sRoTp != null and sRoTp != ""'>
                                        AND A.RO_TP = #{sRoTp}
                                    </if>
                                    <if test='sRoTpList != null and !sRoTpList.isEmpty'> AND A.RO_TP IN
                                       <foreach item="item" index="index" collection="sRoTpList" open="(" separator="," close=")">
                                           #{item}
                                       </foreach>
                                    </if>
                                    <if test='sRoStatCd != null and sRoStatCd != ""'>
                                        AND A.RO_STAT_CD = #{sRoStatCd}
                                    </if>
                                    <if test='sRoFromDt != null'>
                                        AND A.RO_DT <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                                    </if>
                                    <if test='sRoToDt != null'>
                                        AND A.RO_DT <![CDATA[<]]> TO_CHAR(#{sRoToDt} + 1, 'YYYYMMDD')
                                    </if>
                                    <if test='sRoStartDt != null'>
                                        AND A.RO_START_DT <![CDATA[>=]]> #{sRoStartDt}
                                    </if>
                                    <if test='sRoEndDt != null'>
                                        AND A.RO_END_DT <![CDATA[<]]> #{sRoEndDt} + 1
                                    </if>
                                    <if test='sExpcDlFromDt != null'>
                                        AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
                                    </if>
                                    <if test='sExpcDlToDt != null'>
                                        AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
                                    </if>
                                    <if test='sDlrRoTp != null and sDlrRoTp != ""'>
                                        AND A.DLR_RO_TP = #{sDlrRoTp}
                                    </if>
                                </where>
                            )B LEFT OUTER JOIN SE_0500T C
                                ON B.RO_DOC_NO  = C.RO_DOC_NO
                               AND B.DLR_CD     = C.DLR_CD
                               AND B.RO_TP      = C.RO_TP
                               AND C.CALC_CANC_YN = 'N'
                               LEFT OUTER JOIN SE_0550T D
                                ON B.RO_DOC_NO  = D.RO_DOC_NO
                               AND B.DLR_CD     = D.DLR_CD
                               AND B.RO_TP      = D.RO_TP
                  )T1
                  <where>
                      <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                          AND T1.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
                      </if>
                      <if test='sCalcPrsnNm != null and sCalcPrsnNm != ""'>
                          AND T1.CALC_PRSN_NM LIKE '%'||#{sCalcPrsnNm}||'%'
                      </if>
                      <if test='sCalcDocNo != null and sCalcDocNo != ""'>
                          AND T1.CALC_DOC_NO LIKE '%'||#{sCalcDocNo}||'%'
                      </if>
                      <if test='sCustSaleFromDt != null'>
                          AND T1.CUST_SALE_DT <![CDATA[>=]]> #{sCustSaleFromDt}
                      </if>
                      <if test='sCustSaleToDt != null'>
                          AND T1.CUST_SALE_DT <![CDATA[<]]> #{sCustSaleToDt} + 1
                      </if>
                      </where>
              )T2
              <where>
                  <if test='sOrdDlrCd != null and sOrdDlrCd != ""'>
                      AND T2.ORD_DLR_CD LIKE '%'||#{sOrdDlrCd}||'%'
                  </if>
                  <if test='sBlueMembershipNo != null and sBlueMembershipNo != ""'>
                      AND T2.BLUE_MEMBERSHIP_NO LIKE '%'||#{sBlueMembershipNo}||'%'
                  </if>
                  <if test='sPayEndFromDt != null'>
                      AND T2.PAY_END_DT <![CDATA[>=]]> #{sPayEndFromDt}
                  </if>
                  <if test='sPayEndToDt != null'>
                      AND T2.PAY_END_DT <![CDATA[<]]> #{sPayEndToDt} + 1
                  </if>
          </where>
    </select>
	
	<!-- RO접수 목록수를 조회. -->
    <select id="selectRepairOrderByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.mob.api.repair.dao.RepairOrderAppDAO.selectRepairOrderByConditionCnt] */
         SELECT COUNT(F.RO_DOC_NO) AS VALUE FROM (
            SELECT B.DLR_CD
                   ,B.RO_DOC_NO
                   ,B.RO_TP
                   ,B.REG_USR_NM FROM (
                SELECT A.DLR_CD
                      ,A.RO_DOC_NO
                      ,A.RO_TP
                      ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                  FROM SE_0300T A
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        AND A.DLR_CD = #{sDlrCd}
                    </if>
                    <if test='sRoDocNo != null and sRoDocNo != ""'>
                        AND A.RO_DOC_NO like '%'||#{sRoDocNo}||'%'
                    </if>
                    <if test='sRoGrpNo != null and sRoGrpNo != ""'>
                        AND A.RO_GRP_NO = #{sRoGrpNo}
                    </if>
                    <if test='sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>
                    <if test='sTecNm != null and sTecNm != ""'>
                        AND A.TEC_NM LIKE '%'||#{sTecNm}||'%'
                    </if>
                    <if test='sSaNm != null and sSaNm != ""'>
                        AND A.SA_NM LIKE '%'||#{sSaNm}||'%'
                    </if>
                    <if test='sSaId != null and sSaId != ""'>
                        AND A.SA_ID = #{sSaId}
                    </if>
                    <if test='sDriverNm != null and sDriverNm != ""'>
                        AND DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                    </if>
                    <if test='sCarRegNo != null and sCarRegNo != ""'>
                        AND CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                    </if>
                    <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                        AND CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                    </if>
                    <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                        AND A.CAR_OWNER_ID = #{sCarOwnerId}
                    </if>
                    <if test='sBayNo != null and sBayNo != ""'>
                        AND A.BAY_NO = #{sBayNo}
                    </if>
                    <if test='sRoStatCd != null and sRoStatCd != ""'>
                        AND A.RO_STAT_CD = #{sRoStatCd}
                    </if>
                    <if test='sAtqProcTp != null and sAtqProcTp != ""'>
                        AND A.ATQ_PROC_TP = #{sAtqProcTp}
                    </if>
                    <if test='sPaintStatCd != null and sPaintStatCd != ""'>
                        AND A.PAINT_STAT_CD = #{sPaintStatCd}
                    </if>
                    <if test='sQtTestStatCd != null and sQtTestStatCd != ""'>
                        AND A.QT_TEST_STAT_CD = #{sQtTestStatCd}
                    </if>
                    <if test='sCarWashStatCd != null and sCarWashStatCd != ""'>
                        AND A.CAR_WASH_STAT_CD = #{sCarWashStatCd}
                    </if>
                    <if test='sResvDocNo != null and sResvDocNo != ""'>
                        AND A.RESV_DOC_NO = #{sResvDocNo}
                    </if>
                    <if test='sRoTp != null and sRoTp != ""'>
                        AND A.RO_TP = #{sRoTp}
                    </if>
                    <if test='sRoFromDt != null'>
                        AND TO_CHAR(A.RO_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                    </if>
                    <if test='sRoToDt != null'>
                        AND TO_CHAR(A.RO_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sRoToDt}, 'YYYYMMDD')
                    </if>
                    <if test='sExpcDlFromDt != null'>
                        AND TO_CHAR(A.EXPC_DL_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sExpcDlFromDt}, 'YYYYMMDD')
                    </if>
                    <if test='sExpcDlToDt != null'>
                        AND TO_CHAR(A.EXPC_DL_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sExpcDlToDt}, 'YYYYMMDD')
                    </if>
                    <if test='sRoStartDt != null'>
                        AND TO_CHAR(A.RO_START_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sRoStartDt}, 'YYYYMMDD')
                    </if>
                    <if test='sRoEndDt != null'>
                        AND TO_CHAR(A.RO_END_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sRoEndDt}, 'YYYYMMDD')
                    </if>
                    <if test='sListType != null and sListType != ""'>
                        <choose>
                            <when test='sListType == "AL"'>
                                AND RO_STAT_CD IN ('01', '02')
                                AND ALLOC_STAT_CD IN ('01', '02', '03')
                                AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                            </when>
                            <when test='sListType == "WRK"'>
                                AND RO_STAT_CD = '02'
                                AND ALLOC_STAT_CD != '01'
                                AND (DL_STAT_CD = '01' OR DL_STAT_CD IS NULL)
                                AND WRK_STAT_CD IN ('01', '02', '03', '04', '05')
                                AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                            </when>
                            <when test='sListType == "QT"'>
                                AND RO_STAT_CD = '02'
                                AND WRK_STAT_CD = '05'
                                AND QT_TEST_STAT_CD IN ('Q1', 'Q2', 'Q3', 'Q5')
                                AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                            </when>
                            <when test='sListType == "CWA"'>
                                AND RO_STAT_CD = '02'
                                AND WRK_STAT_CD = '05'
                                AND CAR_WASH_TP IN ('01', '02', '03')
                                AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                            </when>
                            <when test='sListType == "DL"'>
                                AND RO_STAT_CD IN ('02', '03')
                                AND WRK_STAT_CD = '05'
                                AND DL_STAT_CD IN ('01', '02')
                                AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                            </when>
                            <when test='sListType == "CA"'>
                                AND ((RO_STAT_CD IN ('03', '04') AND WRK_STAT_CD = '05' ) OR GOODWILL_YN = 'Y' )
                            </when>
                            <otherwise>
                                  AND A.RO_STAT_CD != '06'
                                  AND A.PDI_YN != 'Y'
                            </otherwise>
                        </choose>
                    </if>
                    <if test='sRunDistFromVal != null and sRunDistFromVal !=""'>
                        AND A.RUN_DIST_VAL <![CDATA[>=]]> #{sRunDistFromVal}
                    </if>
                    <if test='sRunDistToVal != null and sRunDistFromVal !=""'>
                        AND A.RUN_DIST_VAL <![CDATA[<=]]> #{sRunDistToVal}
                    </if>
                    <if test='sCarWashYn != null and sCarWashYn !=""'>
                        AND ( A.CAR_WASH_TP != '04' OR A.CAR_WASH_TP IS NULL)
                    </if>
                    <if test='sQtTestYn != null and sQtTestYn !=""'>
                        AND A.QT_TEST_MTH_CD = '01'
                    </if>
                    <if test='sAllocStatCd != null and sAllocStatCd !=""'>
                        AND A.ALLOC_STAT_CD = #{sAllocStatCd}
                    </if>
                    <if test='sWrkStatCd != null and sWrkStatCd !=""'>
                        AND A.WRK_STAT_CD = #{sWrkStatCd}
                    </if>
                    <if test='sQtTestPrsnNm != null and sQtTestPrsnNm !=""'>
                        AND A.QT_TEST_PRSN_NM LIKE '%'||#{sQtTestPrsnNm}||'%'
                    </if>
                    <if test='sDlStatCd != null and sDlStatCd !=""'>
                        AND A.DL_STAT_CD = #{sDlStatCd}
                    </if>
                    <if test='sPdiYn != null and sPdiYn != ""'>
                        AND A.PDI_YN = #{sPdiYn}
                    </if>
                </where>
                )B LEFT OUTER JOIN SE_0500T C
                    ON B.RO_DOC_NO  = C.RO_DOC_NO
                   AND B.DLR_CD     = C.DLR_CD
                   AND B.RO_TP      = C.RO_TP
                   AND C.CALC_CANC_YN = 'N'
           )F
           <where>
               <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                   AND F.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
               </if>
           </where>
    </select>
	
	<!-- RO접수 목록 조회. -->
    <select id="selectRepairOrderByCondition" parameterType="RepairOrderSearchVO" resultType="chn.bhmc.dms.mob.api.repair.vo.RepairOrderVO">
        /* [chn.bhmc.dms.mob.api.repair.dao.RepairOrderAppDAO.selectRepairOrderByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT F.* FROM (
                     SELECT B.*
                           ,FN_GET_CARLINE_NM_NC(B.CARLINE_CD) AS CARLINE_NM
                           ,FN_GET_MODEL_NM(B.MODEL_CD) AS MODEL_NM
                           ,C.CALC_DOC_NO
                           ,C.LAST_CALC_TOT_AMT
                       FROM(
                            SELECT A.*
                                 ,(SELECT CMM_CD_TXT
                                     FROM CM_0304T
                                    WHERE LANG_CD    = NVL( #{sLangCd} ,'zh')
                                      AND CMM_GRP_CD = 'SER031'
                                      AND CMM_CD     = A.RO_TP ) AS RO_TP_NM
                                 ,(SELECT CMM_CD_TXT
                                     FROM CM_0304T
                                    WHERE LANG_CD    = NVL( #{sLangCd} ,'zh')
                                      AND CMM_GRP_CD = 'SER030'
                                      AND CMM_CD     = A.RO_STAT_CD ) AS RO_STAT_NM
                                 ,(SELECT CMM_CD_TXT
                                     FROM CM_0304T
                                    WHERE LANG_CD    = NVL( #{sLangCd} ,'zh')
                                      AND CMM_GRP_CD = 'SER057'
                                      AND CMM_CD     = A.DL_STAT_CD ) AS DL_STAT_NM
                                  ,(SELECT CARLINE_CD FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CARLINE_CD
                                  ,(SELECT MODEL_CD FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_CD
                                  ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS LAST_RUN_DIST_VAL
                                  ,EXPC_DL_DT - 30/(24*60) AS EXPC_DL_START_DT
                                  ,(SELECT CAR_ID
                                     FROM SA_0121T
                                    WHERE VIN_NO = A.VIN_NO
                                      AND ROWNUM = 1 ) AS CAR_ID
                                  ,FN_SER_LTS_MODEL_CD(A.VIN_NO) AS LTS_MODEL_CD
                                  ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                                  ,WRK_STAT_CD
                                  ,FN_CMM_CD_NM('SER050',WRK_STAT_CD,#{sLangCd},'N') AS WRK_STAT_NM
                            FROM SE_0300T A
                            <where>
                                <if test='sDlrCd != null and sDlrCd != ""'>
                                    AND A.DLR_CD = #{sDlrCd}
                                </if>
                                <if test='sRoDocNo != null and sRoDocNo != ""'>
                                    AND A.RO_DOC_NO like '%'||#{sRoDocNo}||'%'
                                </if>
                                <if test='sRoGrpNo != null and sRoGrpNo != ""'>
                                    AND A.RO_GRP_NO = #{sRoGrpNo}
                                </if>
                                <if test='sVinNo != null and sVinNo != ""'>
                                    AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                                </if>
                                <if test='sTecNm != null and sTecNm != ""'>
                                    AND A.TEC_NM LIKE '%'||#{sTecNm}||'%'
                                </if>
                                <if test='sSaNm != null and sSaNm != ""'>
                                    AND A.SA_NM LIKE '%'||#{sSaNm}||'%'
                                </if>
                                <if test='sSaId != null and sSaId != ""'>
                                    AND A.SA_ID = #{sSaId}
                                </if>
                                <if test='sDriverId != null and sDriverId != ""'>
                                    AND DRIVER_ID = #{sDriverId}
                                </if>
                                <if test='sDriverNm != null and sDriverNm != ""'>
                                    AND DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                                </if>
                                <if test='sCarRegNo != null and sCarRegNo != ""'>
                                    AND CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                                </if>
                                <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                                    AND CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                                </if>
                                <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                                    AND A.CAR_OWNER_ID = #{sCarOwnerId}
                                </if>
                                <if test='sBayNo != null and sBayNo != ""'>
                                    AND A.BAY_NO = #{sBayNo}
                                </if>
                                <if test='sRoStatCd != null and sRoStatCd != ""'>
                                    AND A.RO_STAT_CD = #{sRoStatCd}
                                </if>
                                <if test='sAtqProcTp != null and sAtqProcTp != ""'>
                                    AND A.ATQ_PROC_TP = #{sAtqProcTp}
                                </if>
                                <if test='sPaintStatCd != null and sPaintStatCd != ""'>
                                    AND A.PAINT_STAT_CD = #{sPaintStatCd}
                                </if>
                                <if test='sQtTestStatCd != null and sQtTestStatCd != ""'>
                                    AND A.QT_TEST_STAT_CD = #{sQtTestStatCd}
                                </if>
                                <if test='sCarWashStatCd != null and sCarWashStatCd != ""'>
                                    AND A.CAR_WASH_STAT_CD = #{sCarWashStatCd}
                                </if>
                                <if test='sResvDocNo != null and sResvDocNo != ""'>
                                    AND A.RESV_DOC_NO = #{sResvDocNo}
                                </if>
                                <if test='sRoTp != null and sRoTp != ""'>
                                    AND A.RO_TP = #{sRoTp}
                                </if>
                                <if test='sRoFromDt != null'>
                                    AND TO_CHAR(A.RO_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                                </if>
                                <if test='sRoToDt != null'>
                                    AND TO_CHAR(A.RO_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sRoToDt}, 'YYYYMMDD')
                                </if>
                                <if test='sExpcDlFromDt != null'>
                                    AND TO_CHAR(A.EXPC_DL_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sExpcDlFromDt}, 'YYYYMMDD')
                                </if>
                                <if test='sExpcDlToDt != null'>
                                    AND TO_CHAR(A.EXPC_DL_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sExpcDlToDt}, 'YYYYMMDD')
                                </if>
                                <if test='sRoStartDt != null'>
                                    AND TO_CHAR(A.RO_START_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sRoStartDt}, 'YYYYMMDD')
                                </if>
                                <if test='sRoEndDt != null'>
                                    AND TO_CHAR(A.RO_END_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sRoEndDt}, 'YYYYMMDD')
                                </if>
                                <if test='sListType != null and sListType != ""'>
                                    <choose>
                                        <when test='sListType == "AL"'>
                                            AND RO_STAT_CD IN ('01', '02')
                                            AND ALLOC_STAT_CD IN ('01', '02', '03')
                                            AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                                        </when>
                                        <when test='sListType == "WRK"'>
                                            AND RO_STAT_CD = '02'
                                            AND ALLOC_STAT_CD != '01'
                                            AND (DL_STAT_CD = '01' OR DL_STAT_CD IS NULL)
                                            AND WRK_STAT_CD IN ('01', '02', '03', '04', '05')
                                            AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                                        </when>
                                        <when test='sListType == "QT"'>
                                            AND RO_STAT_CD = '02'
                                            AND WRK_STAT_CD = '05'
                                            AND QT_TEST_STAT_CD IN ('Q1', 'Q2', 'Q3', 'Q5')
                                            AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                                        </when>
                                        <when test='sListType == "CWA"'>
                                            AND RO_STAT_CD = '02'
                                            AND WRK_STAT_CD = '05'
                                            AND CAR_WASH_TP IN ('01', '02', '03')
                                            AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                                        </when>
                                        <when test='sListType == "DL"'>
                                            AND RO_STAT_CD IN ('02', '03')
                                            AND WRK_STAT_CD = '05'
                                            AND DL_STAT_CD IN ('01', '02')
                                            AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                                        </when>
                                        <when test='sListType == "CA"'>
                                            AND ((RO_STAT_CD IN ('03', '04') AND WRK_STAT_CD = '05' )
                                                OR GOODWILL_YN = 'Y')
                                        </when>
                                        <otherwise>
                                          AND A.RO_STAT_CD != '06'
                                          AND A.PDI_YN != 'Y'
                                        </otherwise>
                                    </choose>
                                </if>
                                <if test='sRunDistFromVal != null and sRunDistFromVal !=""'>
                                    AND A.RUN_DIST_VAL <![CDATA[>=]]> #{sRunDistFromVal}
                                </if>
                                <if test='sRunDistToVal != null and sRunDistFromVal !=""'>
                                    AND A.RUN_DIST_VAL <![CDATA[<=]]> #{sRunDistToVal}
                                </if>
                                <if test='sCarWashYn != null and sCarWashYn !=""'>
                                    AND (A.CAR_WASH_TP != '04' OR A.CAR_WASH_TP IS NULL)
                                </if>
                                <if test='sQtTestYn != null and sQtTestYn !=""'>
                                    AND A.QT_TEST_MTH_CD = '01'
                                </if>
                                <if test='sAllocStatCd != null and sAllocStatCd !=""'>
                                    AND A.ALLOC_STAT_CD = #{sAllocStatCd}
                                </if>
                                <if test='sWrkStatCd != null and sWrkStatCd !=""'>
                                    AND A.WRK_STAT_CD = #{sWrkStatCd}
                                </if>
                                <if test='sQtTestPrsnNm != null and sQtTestPrsnNm !=""'>
                                    AND A.QT_TEST_PRSN_NM LIKE '%'||#{sQtTestPrsnNm}||'%'
                                </if>
                                <if test='sDlStatCd != null and sDlStatCd !=""'>
                                    AND A.DL_STAT_CD = #{sDlStatCd}
                                </if>
                                <if test='sPdiYn != null and sPdiYn != ""'>
                                    AND A.PDI_YN = #{sPdiYn}
                                    AND A.RO_STAT_CD != '06'
                                </if>
                            </where>
                      )B LEFT OUTER JOIN SE_0500T C
                        ON B.RO_DOC_NO  = C.RO_DOC_NO
                       AND B.DLR_CD     = C.DLR_CD
                       AND B.RO_TP      = C.RO_TP
                       AND C.CALC_CANC_YN = 'N'
                   ) F
                   <where>
                       <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                           AND F.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
                       </if>
                   </where>
                   ORDER BY
                    <choose>
                        <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "dlrCd"'>             F.DLR_CD            <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roDocNo"'>           F.RO_DOC_NO         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roTp"'>              F.RO_TP             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roDt"'>              F.RO_DT             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "resvDocNo"'>         F.RESV_DOC_NO       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "vinNo"'>             F.VIN_NO            <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "carRegNo"'>          F.CAR_REG_NO        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "enginNo"'>           F.ENGIN_NO          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "carOwnerId"'>        F.CAR_OWNER_ID      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "carOwnerNm"'>        F.CAR_OWNER_NM      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "driverNm"'>          F.DRIVER_NM         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "expcDlDt"'>          F.EXPC_DL_DT        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "dlChkDt"'>           F.DL_CHK_DT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "qtTestStartDt"'>     F.QT_TEST_START_DT  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "qtTestEndDt"'>       F.QT_TEST_END_DT    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                 F.DLR_CD ASC
                                ,F.RO_DT DESC
                                ,F.RO_TP ASC
                                </otherwise>
                            </choose>
                        </foreach>
                        </when>
                        <otherwise>
                        F.DLR_CD ASC
                        ,F.RO_DT DESC
                        ,F.RO_TP ASC
                        </otherwise>
                    </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>
    
    <!-- RO접수현황 목록 조회. -->
    <select id="selectRepairOrderListByCondition" parameterType="RepairOrderSearchVO" resultType="chn.bhmc.dms.mob.api.repair.vo.RepairOrderVO">
        /* [chn.bhmc.dms.mob.api.repair.dao.RepairOrderAppDAO.selectRepairOrderListByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM
                   ,T2.* FROM (
                SELECT T1.*
                  FROM (
                     SELECT B.*
                           ,FN_CMM_CD_NM('COM020',B.PAID_YN,#{sLangCd},'N') AS PAID_YN_NM
                           ,FN_CMM_CD_NM('COM020',B.RESV_YN,#{sLangCd},'N') AS RESV_YN_NM
                           ,B.LBR_DC + B.PAR_DC AS DC_AMT               -- 할인금액
                           ,B.PAR_AMT + B.LBR_AMT + B.ETC_AMT AS SUM_AMT --합계금액
                           ,CASE WHEN B.RO_STAT_CD ='06' THEN B.UPDT_USR_NM ELSE NULL END AS RO_CANC_NM --RO 취소자
                           ,C.CALC_DOC_NO
                           ,C.CALC_DT
                           ,B.PAR_AMT AS CALC_PAR_AMT --부품금액
                           ,B.LBR_AMT AS CALC_LBR_AMT  --공임금액
                           ,B.ETC_AMT AS CALC_ETC_AMT  --기타금액
                           ,B.PAR_DC + B.LBR_DC AS CALC_DC_AMT --할인금액
                           ,NVL(C.LBR_ETC_DC_AMT ,0 )+ NVL(C.PAR_ETC_DC_AMT,0 ) AS CALC_ETC_DC_AMT
                           ,NVL(C.LAST_CALC_TOT_AMT, 0) AS CALC_SUM_AMT
                           ,NVL(C.BM_POINT_TOT_AMT,0) AS BM_POINT_USE_AMT
                           ,NVL(C.BM_CUPN_TOT_AMT,0) AS BM_CUPN_USE_AMT
                           ,NVL(C.POINT_TOT_AMT,0) AS POINT_USE_AMT
                           ,NVL(C.LBR_DC_AMT,0) AS LBR_DC_AMT
                           ,NVL(C.PAR_DC_AMT,0) AS PAR_DC_AMT
                           ,(SELECT USR_NM FROM CM_0801T WHERE DLR_CD = C.DLR_CD AND USR_ID = C.REG_USR_ID) AS CALC_PRSN_NM
                           ,C.REG_DT AS CALC_REG_DT
                           ,E.WON_UNIT_CUT_AMT
                           ,E.DEMIC_POINT_CUT_AMT
                           ,F.PAYM_AMT
                           ,F.RCV_AMT
                           ,F.NPAY_AMT
                           ,(SELECT MAX(RCV_CPLT_DT) FROM SE_0570T WHERE RCV_DOC_NO = D.RCV_DOC_NO) AS PAY_END_DT --지불완료시간
                           ,(SELECT ORD_DLR_CD FROM SA_0121T WHERE VIN_NO = B.VIN_NO AND ROWNUM = 1) AS ORD_DLR_CD --판매딜러
                           ,(SELECT BLUE_MEMBERSHIP_NO FROM CR_0101T WHERE DLR_CD = B.DLR_CD AND CUST_NO = B.CAR_OWNER_ID) AS BLUE_MEMBERSHIP_NO --BM회원번호
                           ,CASE WHEN (SELECT MEMBERSHIP_POLICY FROM CM_0101T WHERE DLR_CD = B.DLR_CD) = 'V'
                                 THEN (SELECT MEMBERSHIP_NO FROM CR_0801T WHERE DLR_CD = B.DLR_CD AND VIN_NO = B.VIN_NO)
                                 ELSE (SELECT MEMBERSHIP_NO FROM CR_0801T WHERE DLR_CD = B.DLR_CD AND CUST_NO = B.CAR_OWNER_ID)
                            END AS MEMBERSHIP_NO --딜러회원번호
                       FROM(
                             SELECT DLR_CD                          --딜러코드
                                   ,RO_DOC_NO                       --RO문서번호
                                   ,RO_TP                           --RO유형
                                   ,FN_CMM_CD_NM('SER031',A.RO_TP,#{sLangCd},'N') AS RO_TP_NM
                                   ,RESV_DOC_NO                     --예약문서번호
                                   ,VIN_NO                          --차대번호
                                   ,CAR_REG_NO                      --차량등록번호
                                   ,ENGIN_NO                        --엔진번호
                                   ,CAR_OWNER_ID                    --차량소유자ID
                                   ,CAR_OWNER_NM                    --차량소유자명
                                   ,DRIVER_ID                       --운전자ID
                                   ,DRIVER_NM                       --운전자명
                                   ,RESV_TP                         --예약유형
                                   ,RESV_DT                         --예약일자
                                   ,BAY_NO                          --베이번호
                                   ,TEC_ID                          --TechManID
                                   ,TEC_NM                          --TechMan명
                                   ,SA_ID                           --SAID
                                   ,SA_NM                           --SA명
                                   ,OPER_RESV_DT                    --작업예약일자
                                   ,SER_RESV_START_DT               --서비스예약시작일자
                                   ,(
                                      SELECT NVL(SUM(ITEM_TOT_AMT),0)
                                        FROM SE_0160T
                                       WHERE DLR_CD = A.DLR_CD
                                         AND DOC_NO = A.RO_DOC_NO
                                         AND PREFIX_ID = 'RO'
                                     )AS PAR_AMT --부품금액
                                    ,(
                                      SELECT NVL(SUM(LBR_TOT_AMT),0)
                                        FROM SE_0170T
                                       WHERE DLR_CD = A.DLR_CD
                                         AND DOC_NO = A.RO_DOC_NO
                                         AND PREFIX_ID = 'RO'
                                     ) AS LBR_AMT  --공임금액
                                    ,(
                                      SELECT NVL(SUM(ETC_REQ_PRC),0)
                                        FROM SE_0140T
                                       WHERE DLR_CD = A.DLR_CD
                                         AND JOB_NO = A.RO_DOC_NO
                                         AND PREFIX_ID = 'RO'
                                     ) AS ETC_AMT  --기타금액
                                     ,(
                                      SELECT NVL(SUM(DC_AMT),0)
                                        FROM SE_0160T
                                       WHERE DLR_CD = A.DLR_CD
                                         AND DOC_NO = A.RO_DOC_NO
                                         AND PREFIX_ID = 'RO'
                                     )AS PAR_DC --부품할인금액
                                     ,(
                                      SELECT NVL(SUM(DC_AMT),0)
                                        FROM SE_0170T
                                       WHERE DLR_CD = A.DLR_CD
                                         AND DOC_NO = A.RO_DOC_NO
                                         AND PREFIX_ID = 'RO'
                                     )AS LBR_DC  --공임할인금액
                                   ,NVL(BAL_AMT ,0 ) BAL_AMT                         --예치금액
                                   ,CANC_REASON_CD                  --취소사유코드
                                   ,FN_CMM_CD_NM('SER014',A.CANC_REASON_CD,#{sLangCd},'N') AS CANC_REASON_NM
                                   ,CANC_REASON_CONT                --취소사유내용
                                   ,CASE WHEN RO_STAT_CD ='06' THEN UPDT_DT ELSE NULL END AS RO_CANC_DT --RO 취소시간
                                   ,DIST_UNIT_CD                    --거리단위코드
                                   ,RUN_DIST_VAL                    --주행거리값
                                   ,DIAG_DOC_NO                     --진단문서번호
                                   ,BASE_RO_NO                      --원RO번호
                                   ,INC_REQ_NO                      --보험신청번호
                                   ,CUST_WAIT_MTH_CD                --고객대기방법코드
                                   ,FN_CMM_CD_NM('SER032',A.CUST_WAIT_MTH_CD,#{sLangCd},'N') AS CUST_WAIT_MTH_NM
                                   ,ATQ_PROC_TP                     --고품처리유형
                                   ,FN_CMM_CD_NM('SER033',A.ATQ_PROC_TP,#{sLangCd},'N') AS ATQ_PROC_TP_NM
                                   ,CAR_WASH_TP                     --차량세차유형
                                   ,FN_CMM_CD_NM('SER034',A.CAR_WASH_TP,#{sLangCd},'N') AS CAR_WASH_TP_NM
                                   ,CAR_DRIVE_REQ_TP                --차량시승요청유형
                                   ,FN_CMM_CD_NM('SER035',A.CAR_DRIVE_REQ_TP,#{sLangCd},'N') AS CAR_DRIVE_REQ_TP_NM
                                   ,EXPC_DL_DT                      --예정인도일자
                                   ,ATQ_PROC_YN                     --고품처리여부
                                   ,CAR_WASH_YN                     --차량세차여부
                                   ,VSIT_CAR_RECEIVE_DT             --방문차량수령일자
                                   ,VSIT_CAR_RECEIVE_IF_NM          --방문차량수령연계인명
                                   ,VSIT_CAR_RECEIVE_CINO_NO        --방문차량수령연락처번호
                                   ,VSIT_CAR_RECEIVE_ADDR_NM        --방문차량수령주소명
                                   ,CAR_RECEIVE_DT                  --차량수령일자
                                   ,VSIT_DL_IF_NM                   --방문인도연계인명
                                   ,VSIT_DL_CINO_NO                 --방문인도연락처번호
                                   ,VSIT_DL_ADDR_NM                 --방문인도주소명
                                   ,VSIT_DT                         --방문일자
                                   ,VSIT_IF_NM                      --방문연계인명
                                   ,VSIT_CINO_NO                    --방문연락처번호
                                   ,VSIT_ADDR_NM                    --방문주소명
                                   ,REG_USR_ID                      --등록자ID
                                   ,UPDT_USR_ID                     --수정자ID
                                   ,UPDT_DT
                                   ,ALLOC_EMP_ID                    --배정자ID
                                   ,SER_RESV_END_DT                 --서비스예약종료일자
                                   ,INC_REQ_DT                      --보험신청일자
                                   ,RO_STAT_CD                      --RO상태코드
                                   ,FN_CMM_CD_NM('SER030',A.RO_STAT_CD,#{sLangCd},'N') AS RO_STAT_NM
                                   ,RO_DT                           --RO일자
                                   ,CAR_WASH_STAT_CD                --세차상태코드
                                   ,PAINT_STAT_CD                   --페인트상태코드
                                   ,QT_TEST_STAT_CD                 --품질검사상태코드
                                   ,RO_GRP_NO                       --RO그룹번호
                                   ,PAINT_QTY                       --페인트수량
                                   ,PAINT_COLOR_CD                  --페인트색상코드
                                   ,CAR_COLOR_CD                    --차량색상코드
                                   ,PAINT_TP                        --페인트유형
                                   ,RO_START_DT                     --RO시작일자
                                   ,RO_END_DT                       --RO종료일자
                                   ,RO_REMARK                       --RO비고
                                   ,QT_TEST_MTH_CD                  --품질검사방법코드
                                   ,FN_CMM_CD_NM('SER040',A.QT_TEST_MTH_CD,#{sLangCd},'N') AS QT_TEST_MTH_NM
                                   ,CHG_EXPC_DL_DT                  --변경예정인도일자
                                   ,CAU_CD1                         --원인코드1
                                   ,CAU_NM1                         --원인명1
                                   ,PHEN_CD1                        --현상코드1
                                   ,PHEN_NM1                        --현상명1
                                   ,CAU_CD2                         --원인코드2
                                   ,CAU_NM2                         --원인명2
                                   ,PHEN_CD2                        --현상코드2
                                   ,PHEN_NM2                        --현상명2
                                   ,QT_TEST_START_DT                --품질검사시작일자
                                   ,QT_TEST_END_DT                  --품질검사종료일자
                                   ,QT_TEST_PRSN_CD                 --품질검사담당자코드
                                   ,QT_TEST_PRSN_NM                 --품질검사담당자명
                                   ,CAR_WASH_START_DT               --차량세차시작일자
                                   ,CAR_WASH_END_DT                 --차량세차종료일자
                                   ,CAR_WASH_PRSN_CD                --차량세차담당자코드
                                   ,CAR_WASH_PRSN_NM                --차량세차담당자명
                                   ,ROAD_TEST_CD                    --도로검사코드
                                   ,PRE_AMT                         --선수금액
                                   ,RWRK_CD                         --리워크코드
                                   ,RWRK_REMARK                     --리워크비고
                                   ,RO_END_CHK_YN                   --RO종료확인여부
                                   ,ATQ_PROC_CHK_YN                 --고품처리확인여부
                                   ,QT_CHK_YN                       --품질확인여부
                                   ,CAR_WASH_CHK_YN                 --차량세차확인여부
                                   ,SER_TAG_CHK_YN                  --서비스태그확인여부
                                   ,GI_RUN_DIST_VAL                 --주행거리값
                                   ,CASE WHEN TO_CHAR(GI_RUN_DIST_VAL) = '0' THEN '' ELSE TO_CHAR(GI_RUN_DIST_VAL) END AS GI_RUN_DIST_VAL_TEXT
                                   ,DL_CHK_PRSN_CD                  --인도확인자코드
                                   ,DL_CHK_PRSN_NM                  --인도확인자명
                                   ,CAR_WASH_CANC_DT                --차량세차취소일자
                                   ,ALLOC_STAT_CD                   --배정상태코드
                                   ,WRK_STAT_CD                     --작업상태코드
                                   ,FN_CMM_CD_NM('SER050',A.WRK_STAT_CD,#{sLangCd},'N') AS WRK_STAT_NM
                                   ,DL_STAT_CD                      --인도상태코드
                                   ,NVL(GOODWILL_YN,'N') AS GOODWILL_YN --GOODWILL여부
                                   ,FN_CMM_CD_NM('COM020',GOODWILL_YN,#{sLangCd},'N') AS GOODWILL_YN_NM
                                   ,NVL(GOODWILL_STAT_CD,'O') AS GOODWILL_STAT_CD --GOODWILL 사용여부
                                   ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1 ) AS LAST_RUN_DIST_VAL
                                   ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO  AND ROWNUM = 1) AS CARLINE_NM
                                   ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                                   ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                                   ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) AS UPDT_USR_NM
                                   ,EXPC_DL_DT - 30/(24*60) AS EXPC_DL_START_DT  -- 예정인도시간
                                   ,RO_PRINT_DT
                                   ,DLR_RO_TP
                                   ,FN_CMM_CD_NM('SER044',A.DLR_RO_TP,#{sLangCd},'N') AS DLR_RO_TP_NM
                                   ,CASE WHEN RO_STAT_CD = '05' THEN 'Y' ELSE 'N' END AS PAID_YN
                                   ,CASE WHEN RESV_DOC_NO IS NOT NULL THEN 'Y' ELSE 'N' END AS RESV_YN
                                   ,(SELECT CUST_SALE_DT FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CUST_SALE_DT --차량판매일
                                   ,FIRST_RO_YN                     --처음수리여부
                                   ,FN_CMM_CD_NM('COM020',A.FIRST_RO_YN,#{sLangCd},'N') AS FIRST_RO_YN_NM
                                   ,FREE_RO_YN                      --처음보양여부
                                   ,FN_CMM_CD_NM('COM020',A.FREE_RO_YN,#{sLangCd},'N') AS FREE_RO_YN_NM
                            FROM SE_0300T A
                            <where>
                                <if test='sDlrCd != null and sDlrCd != ""'>
                                    AND A.DLR_CD = #{sDlrCd}
                                </if>
                                <if test='sRoDocNo != null and sRoDocNo != ""'>
                                    AND A.RO_DOC_NO like '%'||#{sRoDocNo}||'%'
                                </if>
                                <if test='sVinNo != null and sVinNo != ""'>
                                    AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                                </if>
                                <if test='sDriverId != null and sDriverId != ""'>
                                    AND DRIVER_ID = #{sDriverId}
                                </if>
                                <if test='sDriverNm != null and sDriverNm != ""'>
                                    AND DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                                </if>
                                <if test='sCarRegNo != null and sCarRegNo != ""'>
                                    AND CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                                </if>
                                <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                                    AND CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                                </if>
                                <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                                    AND A.CAR_OWNER_ID = #{sCarOwnerId}
                                </if>
                                <if test='sBayNo != null and sBayNo != ""'>
                                    AND A.BAY_NO = #{sBayNo}
                                </if>
                                <if test='sRoTp != null and sRoTp != ""'>
                                    AND A.RO_TP = #{sRoTp}
                                </if>
                                <if test='sRoTpList != null and !sRoTpList.isEmpty'> AND A.RO_TP IN
                                   <foreach item="item" index="index" collection="sRoTpList" open="(" separator="," close=")">
                                       #{item}
                                   </foreach>
                                </if>
                                <if test='sRoStatCd != null and sRoStatCd != ""'>
                                    AND A.RO_STAT_CD = #{sRoStatCd}
                                </if>
                                <if test='sRoFromDt != null'>
                                    AND A.RO_DT <![CDATA[>=]]> #{sRoFromDt}
                                </if>
                                <if test='sRoToDt != null'>
                                    AND A.RO_DT <![CDATA[<=]]> #{sRoToDt}
                                </if>
                                <if test='sExpcDlFromDt != null'>
                                    AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
                                </if>
                                <if test='sExpcDlToDt != null'>
                                    AND A.EXPC_DL_DT <![CDATA[<=]]> #{sExpcDlToDt}
                                </if>
                                <if test='sRoStartDt != null'>
                                    AND A.RO_START_DT <![CDATA[>=]]> #{sRoStartDt}
                                </if>
                                <if test='sRoEndDt != null'>
                                    AND A.RO_END_DT <![CDATA[<=]]> #{sRoEndDt}
                                </if>
                                <if test='sDlrRoTp != null and sDlrRoTp != ""'>
                                    AND A.DLR_RO_TP = #{sDlrRoTp}
                                </if>
                            </where>
                      )B LEFT OUTER JOIN SE_0500T C
                        ON B.RO_DOC_NO  = C.RO_DOC_NO
                       AND B.DLR_CD     = C.DLR_CD
                       AND B.RO_TP      = C.RO_TP
                       AND C.CALC_CANC_YN = 'N'
                      LEFT OUTER JOIN SE_0550T D
                        ON B.RO_DOC_NO  = D.RO_DOC_NO
                       AND B.DLR_CD     = D.DLR_CD
                       AND B.RO_TP      = D.RO_TP
                      LEFT OUTER JOIN (
                        SELECT DLR_CD, CALC_DOC_NO
                               ,NVL(SUM(WON_UNIT_CUT_AMT), 0) AS WON_UNIT_CUT_AMT
                               ,NVL(SUM(DEMIC_POINT_CUT_AMT), 0) AS DEMIC_POINT_CUT_AMT
                        FROM SE_0530T
                        GROUP BY DLR_CD, CALC_DOC_NO
                      ) E
                      ON C.DLR_CD = E.DLR_CD
                      AND C.CALC_DOC_NO = E.CALC_DOC_NO
                      LEFT OUTER JOIN (
                        SELECT DLR_CD, RCV_DOC_NO
                               ,NVL(SUM(PAYM_AMT), 0) AS PAYM_AMT
                               ,NVL(SUM(RCV_AMT), 0) AS RCV_AMT
                               ,NVL(SUM(NPAY_AMT), NVL(SUM(PAYM_AMT), 0) - NVL(SUM(RCV_AMT), 0)) AS NPAY_AMT
                        FROM SE_0560T
                        GROUP BY DLR_CD, RCV_DOC_NO
                      ) F
                      ON D.DLR_CD = F.DLR_CD
                      AND D.RCV_DOC_NO = F.RCV_DOC_NO
                ) T1
                <where>
                    <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                        AND T1.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
                    </if>
                    <if test='sCalcPrsnNm != null and sCalcPrsnNm != ""'>
                        AND T1.CALC_PRSN_NM LIKE '%'||#{sCalcPrsnNm}||'%'
                    </if>
                    <if test='sCalcDocNo != null and sCalcDocNo != ""'>
                        AND T1.CALC_DOC_NO LIKE '%'||#{sCalcDocNo}||'%'
                    </if>
                    <if test='sOrdDlrCd != null and sOrdDlrCd != ""'>
                        AND T1.ORD_DLR_CD LIKE '%'||#{sOrdDlrCd}||'%'
                    </if>
                    <if test='sBlueMembershipNo != null and sBlueMembershipNo != ""'>
                        AND T1.BLUE_MEMBERSHIP_NO LIKE '%'||#{sBlueMembershipNo}||'%'
                    </if>
                    <if test='sCustSaleFromDt != null'>
                        AND T1.CUST_SALE_DT <![CDATA[>=]]> #{sCustSaleFromDt}
                    </if>
                    <if test='sCustSaleToDt != null'>
                        AND T1.CUST_SALE_DT <![CDATA[<]]> #{sCustSaleToDt} + 1
                    </if>
                    <if test='sPayEndFromDt != null'>
                        AND T1.PAY_END_DT <![CDATA[>=]]> #{sPayEndFromDt}
                    </if>
                    <if test='sPayEndToDt != null'>
                        AND T1.PAY_END_DT <![CDATA[<]]> #{sPayEndToDt} + 1
                    </if>
                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                    <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                        <choose>
                            <when test='item.field == "carRegNo"'>          T1.CAR_REG_NO           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "vinNo"'>             T1.VIN_NO               <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carOwnerNm"'>        T1.CAR_OWNER_NM         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "driverNm"'>          T1.DRIVER_NM            <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carlineNm"'>         T1.CARLINE_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "modelNm"'>           T1.MODEL_NM             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "runDistVal"'>        T1.RUN_DIST_VAL         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "giRunDistVal"'>      T1.GI_RUN_DIST_VAL      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roStatNm"'>          T1.RO_STAT_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roDocNo"'>           T1.RO_DOC_NO            <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roTpNm"'>            T1.RO_TP_NM             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roDtFormat"'>        T1.RO_DT                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "regUsrNm"'>          T1.REG_USR_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roPrintDtFormat"'>   T1.RO_PRINT_DT          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "updtDtFormat"'>      T1.UPDT_DT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "updtUsrNm"'>         T1.UPDT_USR_NM          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roCancDtFormat"'>    T1.RO_CANC_DT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roCancNm"'>          T1.RO_CANC_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "cancReasonNm"'>      T1.CANC_REASON_NM       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "lbrAmt"'>            T1.LBR_AMT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "parAmt"'>            T1.PAR_AMT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "etcAmt"'>            T1.ETC_AMT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "sumAmt"'>            T1.SUM_AMT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "expcDlDtFormat"'>    T1.EXPC_DL_DT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "wrkStatNm"'>         T1.WRK_STAT_NM          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "atqProcTpNm"'>       T1.ATQ_PROC_TP_NM       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carWashTpNm"'>       T1.CAR_WASH_TP_NM       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "custWaitMthNm"'>     T1.CUST_WAIT_MTH_NM     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "qtTestMthNm"'>       T1.QT_TEST_MTH_NM       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "goodwillYnNm"'>      T1.GOODWILL_YN_NM       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carDriveReqTpNm"'>   T1.CAR_DRIVE_REQ_TP_NM  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roRemark"'>          T1.RO_REMARK           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "dlrRoTpNm"'>         T1.DLR_RO_TP_NM         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "diagDocNo"'>         T1.DIAG_DOC_NO          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "incReqNo"'>          T1.INC_REQ_NO           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "baseRoNo"'>          T1.BASE_RO_NO           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcDocNo"'>         T1.CALC_DOC_NO          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcRegDtFormat"'>   T1.CALC_REG_DT          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcPrsnNm"'>        T1.CALC_PRSN_NM         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcDtFormat"'>      T1.CALC_DT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcLbrAmt"'>        T1.CALC_LBR_AMT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcParAmt"'>        T1.CALC_PAR_AMT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcEtcAmt"'>        T1.CALC_ETC_AMT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "lbrDcAmt"'>          T1.LBR_DC_AMT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "parDcAmt"'>          T1.PAR_DC_AMT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "pointUseAmt"'>       T1.POINT_USE_AMT        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "bmPointUseAmt"'>     T1.BM_POINT_USE_AMT     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "bmCupnUseAmt"'>      T1.BM_CUPN_USE_AMT      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcEtcDcAmt"'>      T1.CALC_ETC_DC_AMT      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcSumAmt"'>        T1.CALC_SUM_AMT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "paidYnNm"'>          T1.PAID_YN_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "wonUnitCutAmt"'>     T1.WON_UNIT_CUT_AMT     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "demicPointCutAmt"'>  T1.DEMIC_POINT_CUT_AMT  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "paymAmt"'>           T1.PAYM_AMT             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "rcvAmt"'>            T1.RCV_AMT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "npayAmt"'>           T1.NPAY_AMT             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "resvYnNm"'>          T1.RESV_YN_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "custSaleDt"'>        T1.CUST_SALE_DT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "firstRoYnNm"'>       T1.FIRST_RO_YN          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "freeRoYnNm"'>        T1.FREE_RO_YN           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "ordDlrCd"'>          T1.ORD_DLR_CD           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "blueMembershipNo"'>  T1.BLUE_MEMBERSHIP_NO   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "payEndDtFormat"'>    T1.PAY_END_DT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "membershipNo"'>      T1.MEMBERSHIP_NO        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <otherwise>
                             T1.DLR_CD ASC
                            ,T1.RO_DT DESC
                            ,T1.RO_TP ASC
                            </otherwise>
                        </choose>
                    </foreach>
                    </when>
                    <otherwise>
                     T1.DLR_CD ASC
                    ,T1.RO_DT DESC
                    ,T1.RO_TP ASC
                    </otherwise>
                </choose>
            ) T2
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>
    
    <!-- RO 현황 목록 조회. -->
    <select id="selectRepairOrderInfoListByCondition" parameterType="RepairOrderSearchVO" resultType="chn.bhmc.dms.mob.api.repair.vo.RepairOrderVO">
        /* [chn.bhmc.dms.mob.api.repair.dao.RepairOrderAppDAO.selectRepairOrderInfoListByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM
                  ,T1.*
              FROM (
                 SELECT B.*
                   FROM(
                         SELECT DLR_CD                                                                            --딜러코드
                               ,RO_DOC_NO                                                                         --RO문서번호
                               ,RO_TP                                                                             --RO유형
                               ,FN_CMM_CD_NM('SER031',A.RO_TP,#{sLangCd},'N') AS RO_TP_NM                         --RO유형명
                               ,RESV_DOC_NO                                                                       --예약문서번호
                               ,VIN_NO                                                                            --차대번호
                               ,CAR_REG_NO                                                                        --차량등록번호
                               ,ENGIN_NO                                                                          --엔진번호
                               ,CAR_OWNER_ID                                                                      --차량소유자ID
                               ,CAR_OWNER_NM                                                                      --차량소유자명
                               ,DRIVER_ID                                                                         --운전자ID
                               ,DRIVER_NM                                                                         --운전자명
                               ,RESV_TP                                                                           --예약유형
                               ,RESV_DT                                                                           --예약일자
                               ,BAY_NO                                                                            --베이번호
                               ,TEC_ID                                                                            --TechManID
                               ,TEC_NM                                                                            --TechMan명
                               ,SA_ID                                                                             --SAID
                               ,SA_NM                                                                             --SA명
                               ,OPER_RESV_DT                                                                      --작업예약일자
                               ,SER_RESV_START_DT                                                                 --서비스예약시작일자
                               ,NVL(BAL_AMT ,0 ) BAL_AMT                                                          --예치금액
                               ,CANC_REASON_CD                                                                    --취소사유코드
                               ,FN_CMM_CD_NM('SER014',A.CANC_REASON_CD,#{sLangCd},'N') AS CANC_REASON_NM          --취소사유코드명
                               ,CANC_REASON_CONT                                                                  --취소사유내용
                               ,CASE WHEN RO_STAT_CD ='06' THEN UPDT_DT ELSE NULL END AS RO_CANC_DT               --RO 취소시간
                               ,DIST_UNIT_CD                                                                      --거리단위코드
                               ,RUN_DIST_VAL                                                                      --주행거리값
                               ,DIAG_DOC_NO                                                                       --진단문서번호
                               ,BASE_RO_NO                                                                        --원RO번호
                               ,INC_REQ_NO                                                                        --보험신청번호
                               ,CUST_WAIT_MTH_CD                                                                  --고객대기방법코드
                               ,FN_CMM_CD_NM('SER032',A.CUST_WAIT_MTH_CD,#{sLangCd},'N') AS CUST_WAIT_MTH_NM      --고객대기방법코드명
                               ,ATQ_PROC_TP                                                                       --고품처리유형
                               ,FN_CMM_CD_NM('SER033',A.ATQ_PROC_TP,#{sLangCd},'N') AS ATQ_PROC_TP_NM             --고품처리유형명
                               ,CAR_WASH_TP                                                                       --차량세차유형
                               ,FN_CMM_CD_NM('SER034',A.CAR_WASH_TP,#{sLangCd},'N') AS CAR_WASH_TP_NM             --차량세차유형명
                               ,CAR_DRIVE_REQ_TP                                                                  --차량시승요청유형
                               ,FN_CMM_CD_NM('SER035',A.CAR_DRIVE_REQ_TP,#{sLangCd},'N') AS CAR_DRIVE_REQ_TP_NM   --차량시승요청유형명
                               ,EXPC_DL_DT                                                                        --예정인도일자
                               ,ATQ_PROC_YN                                                                       --고품처리여부
                               ,CAR_WASH_YN                                                                       --차량세차여부
                               ,VSIT_CAR_RECEIVE_DT                                                               --방문차량수령일자
                               ,VSIT_CAR_RECEIVE_IF_NM                                                            --방문차량수령연계인명
                               ,VSIT_CAR_RECEIVE_CINO_NO                                                          --방문차량수령연락처번호
                               ,VSIT_CAR_RECEIVE_ADDR_NM                                                          --방문차량수령주소명
                               ,CAR_RECEIVE_DT                                                                    --차량수령일자
                               ,VSIT_DL_IF_NM                                                                     --방문인도연계인명
                               ,VSIT_DL_CINO_NO                                                                   --방문인도연락처번호
                               ,VSIT_DL_ADDR_NM                                                                   --방문인도주소명
                               ,VSIT_DT                                                                           --방문일자
                               ,VSIT_IF_NM                                                                        --방문연계인명
                               ,VSIT_CINO_NO                                                                      --방문연락처번호
                               ,VSIT_ADDR_NM                                                                      --방문주소명
                               ,REG_USR_ID                                                                        --등록자ID
                               ,UPDT_USR_ID                                                                       --수정자ID
                               ,UPDT_DT
                               ,ALLOC_EMP_ID                                                                      --배정자ID
                               ,SER_RESV_END_DT                                                                   --서비스예약종료일자
                               ,INC_REQ_DT                                                                        --보험신청일자
                               ,RO_STAT_CD                                                                        --RO상태코드
                               ,FN_CMM_CD_NM('SER030',A.RO_STAT_CD,#{sLangCd},'N') AS RO_STAT_NM                  --RO상태코드명
                               ,RO_DT                                                                             --RO일자
                               ,CAR_WASH_STAT_CD                                                                  --세차상태코드
                               ,PAINT_STAT_CD                                                                     --페인트상태코드
                               ,QT_TEST_STAT_CD                                                                   --품질검사상태코드
                               ,FN_CMM_CD_NM('SER052',QT_TEST_STAT_CD,#{sLangCd},'N')  AS QT_TEST_STAT_NM         --품질검사상태코드
                               ,RO_GRP_NO                                                                         --RO그룹번호
                               ,PAINT_QTY                                                                         --페인트수량
                               ,PAINT_COLOR_CD                                                                    --페인트색상코드
                               ,CAR_COLOR_CD                                                                      --차량색상코드
                               ,PAINT_TP                                                                          --페인트유형
                               ,RO_START_DT                                                                       --RO시작일자
                               ,RO_END_DT                                                                         --RO종료일자
                               ,RO_REMARK                                                                         --RO비고
                               ,QT_TEST_MTH_CD                                                                    --품질검사방법코드
                               ,FN_CMM_CD_NM('SER040',A.QT_TEST_MTH_CD,#{sLangCd},'N') AS QT_TEST_MTH_NM          --품질검사방법코드명
                               ,CHG_EXPC_DL_DT                                                                    --변경예정인도일자
                               ,CAU_CD1                                                                           --원인코드1
                               ,CAU_NM1                                                                           --원인명1
                               ,PHEN_CD1                                                                          --현상코드1
                               ,PHEN_NM1                                                                          --현상명1
                               ,CAU_CD2                                                                           --원인코드2
                               ,CAU_NM2                                                                           --원인명2
                               ,PHEN_CD2                                                                          --현상코드2
                               ,PHEN_NM2                                                                          --현상명2
                               ,QT_TEST_START_DT                                                                  --품질검사시작일자
                               ,QT_TEST_END_DT                                                                    --품질검사종료일자
                               ,QT_TEST_PRSN_CD                                                                   --품질검사담당자코드
                               ,QT_TEST_PRSN_NM                                                                   --품질검사담당자명
                               ,CAR_WASH_START_DT                                                                 --차량세차시작일자
                               ,CAR_WASH_END_DT                                                                   --차량세차종료일자
                               ,CAR_WASH_PRSN_CD                                                                  --차량세차담당자코드
                               ,CAR_WASH_PRSN_NM                                                                  --차량세차담당자명
                               ,ROAD_TEST_CD                                                                      --도로검사코드
                               ,PRE_AMT                                                                           --선수금액
                               ,RWRK_CD                                                                           --리워크코드
                               ,RWRK_REMARK                                                                       --리워크비고
                               ,RO_END_CHK_YN                                                                     --RO종료확인여부
                               ,ATQ_PROC_CHK_YN                                                                   --고품처리확인여부
                               ,QT_CHK_YN                                                                         --품질확인여부
                               ,CAR_WASH_CHK_YN                                                                   --차량세차확인여부
                               ,SER_TAG_CHK_YN                                                                    --서비스태그확인여부
                               ,GI_RUN_DIST_VAL                                                                   --주행거리값
                               ,DL_CHK_DT                                                                         --인도확인시간
                               ,DL_CHK_PRSN_CD                                                                    --인도확인자코드
                               ,DL_CHK_PRSN_NM                                                                    --인도확인자명
                               ,CAR_WASH_CANC_DT                                                                  --차량세차취소일자
                               ,ALLOC_STAT_CD                                                                     --배정상태코드
                               ,FN_CMM_CD_NM('SER043',ALLOC_STAT_CD,#{sLangCd},'N') AS ALLOC_STAT_NM              --배정상태코드명
                               ,WRK_STAT_CD                                                                       --작업상태코드
                               ,FN_CMM_CD_NM('SER050',A.WRK_STAT_CD,#{sLangCd},'N') AS WRK_STAT_NM                --작업상태코드명
                               ,DL_STAT_CD                                                                        --인도상태코드
                               ,FN_CMM_CD_NM('SER057',DL_STAT_CD,#{sLangCd},'N')    AS DL_STAT_NM                 --인도상태명
                               ,NVL(GOODWILL_YN,'N') AS GOODWILL_YN                                               --GOODWILL여부
                               ,FN_CMM_CD_NM('COM020',GOODWILL_YN,#{sLangCd},'N') AS GOODWILL_YN_NM               --GOODWILL여부명
                               ,NVL(GOODWILL_STAT_CD,'O') AS GOODWILL_STAT_CD                                     --GOODWILL 사용여부
                               ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1 ) AS LAST_RUN_DIST_VAL
                               ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO  AND ROWNUM = 1) AS CARLINE_NM
                               ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) AS UPDT_USR_NM
                               ,EXPC_DL_DT - 30/(24*60) AS EXPC_DL_START_DT                                       -- 예정인도시간
                               ,RO_PRINT_DT
                               ,DLR_RO_TP
                               ,FN_CMM_CD_NM('SER044',A.DLR_RO_TP,#{sLangCd},'N') AS DLR_RO_TP_NM
                               ,CASE WHEN RO_STAT_CD = '05' THEN 'Y' ELSE 'N' END AS PAID_YN
                               ,( SELECT MIN(WRK_START_DT)
                                   FROM SE_0330T
                                  WHERE DLR_CD = A.DLR_CD
                                    AND RO_DOC_NO = A.RO_DOC_NO
                                 ) AS WRK_START_DT                                                        --작업 시작시간
                               ,( SELECT MAX(WRK_END_DT)
                                   FROM SE_0330T
                                  WHERE DLR_CD = A.DLR_CD
                                    AND RO_DOC_NO = A.RO_DOC_NO
                                 ) AS WRK_END_DT                                                          --작업 완료시간
                               ,( SELECT MIN(REG_DT)
                                   FROM SE_0330T
                                  WHERE DLR_CD = A.DLR_CD
                                    AND RO_DOC_NO = A.RO_DOC_NO
                                 ) AS ALLOC_START_DT                                                      --배정 시작시간
                               ,( SELECT MAX(REG_DT)
                                   FROM SE_0330T
                                  WHERE DLR_CD = A.DLR_CD
                                    AND RO_DOC_NO = A.RO_DOC_NO
                                 ) AS ALLOC_END_DT                                                        --배정 완료시간
                        FROM SE_0300T A
                        <where>
                            <if test='sDlrCd != null and sDlrCd != ""'>
                                AND A.DLR_CD = #{sDlrCd}
                            </if>
                            <if test='sRoDocNo != null and sRoDocNo != ""'>
                                AND A.RO_DOC_NO like '%'||#{sRoDocNo}||'%'
                            </if>
                            <if test='sVinNo != null and sVinNo != ""'>
                                AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                            </if>
                            <if test='sDriverId != null and sDriverId != ""'>
                                AND A.DRIVER_ID = #{sDriverId}
                            </if>
                            <if test='sDriverNm != null and sDriverNm != ""'>
                                AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                            </if>
                            <if test='sCarRegNo != null and sCarRegNo != ""'>
                                AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                            </if>
                            <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                                AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                            </if>
                            <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                                AND A.CAR_OWNER_ID = #{sCarOwnerId}
                            </if>
                            <if test='sBayNo != null and sBayNo != ""'>
                                AND A.BAY_NO = #{sBayNo}
                            </if>
                            <if test='sRoTp != null and sRoTp != ""'>
                                AND A.RO_TP = #{sRoTp}
                            </if>
                            <if test='sRoStatCd != null and sRoStatCd != ""'>
                                AND A.RO_STAT_CD = #{sRoStatCd}
                            </if>
                            <if test='sRoFromDt != null'>
                                AND A.RO_DT <![CDATA[>=]]> #{sRoFromDt}
                            </if>
                            <if test='sRoToDt != null'>
                                AND A.RO_DT <![CDATA[<]]> #{sRoToDt} + 1
                            </if>
                            <if test='sExpcDlFromDt != null'>
                                AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
                            </if>
                            <if test='sExpcDlToDt != null'>
                                AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
                            </if>
                            <if test='sRoStartDt != null'>
                                AND A.RO_START_DT <![CDATA[>=]]> #{sRoStartDt}
                            </if>
                            <if test='sRoEndDt != null'>
                                AND A.RO_END_DT <![CDATA[<]]> #{sRoEndDt} + 1
                            </if>
                        </where>
                  )B
                   ORDER BY
                    <choose>
                        <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "carRegNo"'>B.CAR_REG_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "vinNo"'>B.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "carOwnerNm"'>B.CAR_OWNER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "driverNm"'>B.DRIVER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "carlineNm"'>B.CARLINE_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "modelNm"'>B.MODEL_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "runDistVal"'>B.RUN_DIST_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "lastRunDistVal"'>B.LAST_RUN_DIST_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roStatNm"'>B.RO_STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roDocNo"'>B.RO_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roTpNm"'>B.RO_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "regUsrNm"'>B.REG_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roDtFormat"'>B.RO_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "expcDlDtFormat"'>B.EXPC_DL_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roRemark"'>B.RO_REMARK <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "wrkStatNm"'>B.WRK_STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "rwrkCd"'>B.RWRK_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "dlStatNm"'>B.DL_STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "dlChkDtFormat"'>B.DL_CHK_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "allocStatNm"'>B.ALLOC_STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "allocStartDtFormat"'>B.ALLOC_START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "allocEndDtFormat"'>B.ALLOC_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "wrkStatNm"'>B.WRK_STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "wrkStartDtFormat"'>B.WRK_START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "wrkEndDtFormat"'>B.WRK_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "qtTestStatNm"'>B.QT_TEST_STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "qtTestStartDtFormat"'>B.QT_TEST_START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "qtTestEndDtFormat"'>B.QT_TEST_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                 B.DLR_CD ASC
                                ,B.RO_DT DESC
                                ,B.RO_TP ASC
                                </otherwise>
                            </choose>
                        </foreach>
                        </when>
                        <otherwise>
                        B.DLR_CD ASC
                        ,B.RO_DT DESC
                        ,B.RO_TP ASC
                        </otherwise>
                    </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
                <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                    AND T1.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
                </if>
                <if test='sAssignFromDt != null'>
                    AND T1.ALLOC_END_DT <![CDATA[>=]]> #{sAssignFromDt}
                </if>
                <if test='sAssignToDt != null'>
                    AND T1.ALLOC_END_DT <![CDATA[<]]> #{sAssignToDt} + 1
                </if>
                <if test='sWorkFromDt != null'>
                    AND T1.WRK_END_DT <![CDATA[>=]]> #{sWorkFromDt}
                </if>
                <if test='sWorkToDt != null'>
                    AND T1.WRK_END_DT <![CDATA[<]]> #{sWorkToDt} + 1
                </if>
                <if test='sQtTestFromDt != null'>
                    AND T1.QT_TEST_END_DT <![CDATA[>=]]> #{sQtTestFromDt}
                </if>
                <if test='sQtTestToDt != null'>
                    AND T1.QT_TEST_END_DT <![CDATA[<]]> #{sQtTestToDt} + 1
                </if>
                <if test='sDlChkFromDt != null'>
                    AND T1.DL_CHK_DT <![CDATA[>=]]> #{sDlChkFromDt}
                </if>
                <if test='sDlChkToDt != null'>
                    AND T1.DL_CHK_DT <![CDATA[<]]> #{sDlChkToDt} + 1
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>
    
    <!-- 서비스이력 조회  -->
    <select id="selectRepairOrderHistoryByCondition" parameterType="RepairOrderSearchVO" resultType="chn.bhmc.dms.mob.api.repair.vo.RepairOrderVO">
        /* [chn.bhmc.dms.mob.api.repair.dao.RepairOrderAppDAO.selectRepairOrderHistoryByCondition] */
        SELECT DLR_CD
              ,RO_DOC_NO
              ,RO_TP
              ,RO_TP_NM
              ,VIN_NO
              ,CAR_REG_NO
              ,CAR_OWNER_ID
              ,CAR_OWNER_NM
              ,DRIVER_ID
              ,DRIVER_NM
              ,RUN_DIST_VAL
              ,BASE_RO_NO
              ,RO_STAT_CD
              ,RO_STAT_NM
              ,RO_DT
              ,RO_GRP_NO
              ,RO_START_DT
              ,RO_END_DT
              ,RO_REMARK
              ,CALC_REMARK
              ,LAST_RUN_DIST_VAL
              ,REG_USR_NM
              ,CARLINE_NM
              ,MODEL_NM
              ,RO_PRINT_DT
              ,UPDT_DT
              ,CALC_DOC_NO
              ,CALC_PRSN_NM
              ,CALC_REG_DT
              ,CALC_DT
              ,CALC_COMP_USR_NM
              ,FN_CMM_CD_NM('COM020',PAYM_YN,#{sLangCd},'N') AS PAYM_YN_NM
            FROM (
            SELECT D.* , ROW_NUMBER() OVER(PARTITION BY DLR_CD , VIN_NO , RO_DOC_NO ORDER BY DLR_CD , VIN_NO , RO_DOC_NO ) AS RN
              FROM(
                  SELECT A.*
                        ,B.ITEM_CD
                        ,B.ITEM_NM
                        ,C.LBR_CD
                        ,C.LBR_NM
                    FROM (
                         SELECT RO.DLR_CD
                               ,RO.RO_DOC_NO
                               ,RO.RO_TP
                               ,FN_CMM_CD_NM('SER031',RO.RO_TP, #{sLangCd}, 'N') AS RO_TP_NM
                               ,RO.VIN_NO
                               ,RO.CAR_REG_NO
                               ,RO.CAR_OWNER_ID
                               ,RO.CAR_OWNER_NM
                               ,RO.DRIVER_ID
                               ,RO.DRIVER_NM
                               ,RO.RUN_DIST_VAL
                               ,RO.GI_RUN_DIST_VAL AS LAST_RUN_DIST_VAL
                               ,RO.BASE_RO_NO
                               ,RO.RO_STAT_CD
                               ,FN_CMM_CD_NM('SER030',RO.RO_STAT_CD, #{sLangCd}, 'N') AS RO_STAT_NM
                               ,RO.RO_DT
                               ,RO.RO_GRP_NO
                               ,RO.RO_START_DT
                               ,RO.RO_END_DT
                               ,RO.RO_REMARK
                               ,CA.CALC_REMARK
                               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = RO.REG_USR_ID AND DLR_CD = RO.DLR_CD) AS REG_USR_NM
                               ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = RO.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                               ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = RO.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                               ,RO.RO_PRINT_DT
                               ,RO.UPDT_DT
                               ,CA.CALC_DOC_NO
                               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = CA.REG_USR_ID AND DLR_CD = CA.DLR_CD) AS CALC_PRSN_NM
                               ,CA.REG_DT AS CALC_REG_DT
                               ,CA.CALC_DT
                               ,CA.CALC_COMP_USR_NM
                               ,CASE WHEN RO.RO_STAT_CD = '05' THEN 'Y' ELSE 'N' END AS PAYM_YN
                           FROM SE_0300T RO, SE_0500T CA, SE_0550T RCV, SA_0121T VM
                          WHERE RO.DLR_CD = #{sDlrCd}
                            AND CA.DLR_CD(+)     = RO.DLR_CD
                            AND CA.RO_DOC_NO(+)  = RO.RO_DOC_NO
                            AND RCV.DLR_CD(+)    = RO.DLR_CD
                            AND RCV.RO_DOC_NO(+) = RO.RO_DOC_NO
                            AND RO.VIN_NO = VM.VIN_NO
                            AND RO.RO_DT >= VM.CUST_SALE_DT
                            AND (RO.GOODWILL_YN != 'Y' OR RO.GOODWILL_YN IS NULL )
                            AND RO.RO_STAT_CD IN ('00', '05')
                            AND CA.CALC_STAT_CD(+) = '00'
                            AND CA.CALC_CANC_YN(+) = 'N'
                            <if test='sVinNo != null and sVinNo !=""'>
                                AND RO.VIN_NO = #{sVinNo}
                            </if>
                            <if test='sDlrCd != null and sDlrCd !=""'>
                                AND RO.DLR_CD = #{sDlrCd}
                            </if>
                            <if test='sRoDocNo != null and sRoDocNo !=""'>
                                AND RO.RO_DOC_NO = #{sRoDocNo}
                            </if>
                            <if test='sDriverNm != null and sDriverNm !=""'>
                                AND RO.DRIVER_NM = #{sDriverNm}
                            </if>
                            <if test='sRoTp != null and sRoTp !=""'>
                                AND RO.RO_TP = #{sRoTp}
                            </if>
                            <if test='sRoFromDt != null'>
                                AND RO.RO_DT <![CDATA[>=]]> #{sRoFromDt}
                            </if>
                            <if test='sRoToDt != null'>
                                AND RO.RO_DT <![CDATA[<]]> #{sRoToDt} + 1
                            </if>
                            <if test='sCarRegNo != null and sCarRegNo !=""'>
                                AND RO.CAR_REG_NO = #{sCarRegNo}
                            </if>
                            <if test='sCarOwnerId != null and sCarOwnerId !=""'>
                                AND RO.CAR_OWNER_ID = #{sCarOwnerId}
                            </if>
                            <if test='sCarOwnerNm != null and sCarOwnerNm !=""'>
                                AND RO.CAR_OWNER_NM = #{sCarOwnerNm}
                            </if>
                            <if test='sRoStatCd != null and sRoStatCd !=""'>
                                AND RO.RO_STAT_CD = #{sRoStatCd}
                            </if>
                     )A LEFT OUTER JOIN SE_0160T B
                     ON A.DLR_CD    = B.DLR_CD
                    AND A.RO_DOC_NO = B.DOC_NO
                    AND B.PREFIX_ID = 'RO'
                    LEFT OUTER JOIN SE_0170T C
                     ON A.DLR_CD    = C.DLR_CD
                    AND A.RO_DOC_NO = C.DOC_NO
                    AND C.PREFIX_ID = 'RO'
              )D WHERE 1=1
                 <if test='sLbrNm != null and sLbrNm !=""'>
                    AND LBR_NM = #{sLbrNm}
                 </if>
                 <if test='sItemNm != null and sItemNm !=""'>
                    AND ITEM_NM = #{sItemNm}
                 </if>
                 <if test='sRegUsrNm != null and sRegUsrNm !=""'>
                    AND REG_USR_NM = #{sRegUsrNm}
                 </if>
        ) WHERE RN = 1
        ORDER BY
        <choose>
            <when test='sort != null'>
                <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                    <choose>
                        <when test='item.field == "roDt"'>      RO_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "roPrintDt"'> RO_PRINT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "updtDt"'>    UPDT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "calcRegDt"'> CALC_REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "calcDt"'>    CALC_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <otherwise>
                            RO_START_DT DESC
                        </otherwise>
                    </choose>
                </foreach>
            </when>
            <otherwise>
                RO_START_DT DESC
            </otherwise>
        </choose>
    </select>
    
    <select id="selectCarWashListByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectCarWashListByConditionCnt] */
            SELECT COUNT(T1.VIN_NO) AS VALUE
              FROM (
                  SELECT A.RO_GRP_NO,
                         A.VIN_NO,
                         A.CAR_REG_NO,
                         A.CAR_OWNER_NM,
                         A.DRIVER_NM,
                         A.SA_NM,
                         FN_GET_CARLINE_NM_NC (B.CARLINE_CD) AS CARLINE_NM,
                         FN_GET_MODEL_NM (B.MODEL_CD) AS MODEL_NM,
                         A.RUN_DIST_VAL,
                         A.CAR_WASH_STAT_CD,
                         A.CAR_WASH_PRSN_NM,
                         A.CAR_WASH_START_DT,
                         A.CAR_WASH_END_DT,
                         A.CAR_WASH_CANC_DT,
                         A.CAR_WASH_CANC_REASON_CD,
                         A.CAR_WASH_CANC_REASON_CONT,
                         ROW_NUMBER() OVER(PARTITION BY  A.DLR_CD , A.VIN_NO ORDER BY A.VIN_NO ) AS RN
                    FROM SE_0300T A,
                         SA_0121T B,
                         SE_0200T C
                   WHERE A.VIN_NO      = B.VIN_NO
                     AND A.DLR_CD      = C.DLR_CD
                     AND A.DIAG_DOC_NO = C.DIAG_DOC_NO
                     AND (A.GOODWILL_YN != 'Y' OR A.GOODWILL_YN IS NULL )
                     AND (A.CAR_WASH_TP != '04' OR A.CAR_WASH_TP IS NULL )
                     AND A.RO_STAT_CD  IN ('01','02')
                     AND A.CAR_WASH_TP IN('01', '02', '03')
                     AND A.DLR_CD = #{sDlrCd}
                    <if test='sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>
                    <if test='sCarRegNo != null and sCarRegNo != ""'>
                        AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                    </if>
                    <if test='sCarWashStatCd != null and sCarWashStatCd != ""'>
                        AND A.CAR_WASH_STAT_CD = #{sCarWashStatCd}
                    </if>
                    <if test='sCarWashPrsnNm != null and sCarWashPrsnNm != ""'>
                        AND A.CAR_WASH_PRSN_NM LIKE '%'||#{sCarWashPrsnNm}||'%'
                    </if>
                    <if test='sCarWashStartFromDt != null'>
                        AND A.CAR_WASH_START_DT <![CDATA[>=]]> #{sCarWashStartFromDt}
                    </if>
                    <if test='sCarWashStartToDt != null'>
                        AND A.CAR_WASH_START_DT <![CDATA[<]]> #{sCarWashStartToDt} + 1
                    </if>
                    <if test='sCarWashEndFromDt != null'>
                        AND A.CAR_WASH_END_DT <![CDATA[>=]]> #{sCarWashEndFromDt}
                    </if>
                    <if test='sCarWashEndToDt != null'>
                        AND A.CAR_WASH_END_DT <![CDATA[<]]> #{sCarWashEndToDt} + 1
                    </if>
                    <if test='sPreChkFromDt != null'>
                        AND C.PRE_CHK_DT <![CDATA[>=]]> #{sPreChkFromDt}
                    </if>
                    <if test='sPreChkToDt != null'>
                        AND C.PRE_CHK_DT <![CDATA[<]]> #{sPreChkToDt} + 1
                    </if>
            ) T1
            WHERE RN = 1
            <if test='sCarlineNm != null and sCarlineNm != ""'>
              AND CARLINE_NM LIKE '%'||#{sCarlineNm}||'%'
            </if>
    </select>
    
    <select id="selectCarWashListByCondition" parameterType="RepairOrderSearchVO" resultType="chn.bhmc.dms.mob.api.repair.vo.RepairOrderVO">
        /* [chn.bhmc.dms.mob.api.repair.dao.RepairOrderAppDAO.selectCarWashListByCondition] */

        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.*
              FROM (
                  SELECT A.RO_GRP_NO,
                         A.VIN_NO,
                         A.CAR_REG_NO,
                         A.CAR_OWNER_NM,
                         A.DRIVER_NM,
                         A.SA_NM,
                         FN_GET_CARLINE_NM_NC (B.CARLINE_CD) AS CARLINE_NM,
                         FN_GET_MODEL_NM (B.MODEL_CD) AS MODEL_NM,
                         A.RUN_DIST_VAL,
                         (SELECT CMM_CD_TXT
                             FROM CM_0304T
                            WHERE LANG_CD    = NVL( #{sLangCd} ,'zh')
                              AND CMM_GRP_CD = 'SER051'
                              AND CMM_CD     = A.CAR_WASH_STAT_CD ) CAR_WASH_STAT_NM,
                         A.CAR_WASH_STAT_CD,
                         A.CAR_WASH_PRSN_NM,
                         A.CAR_WASH_START_DT,
                         A.CAR_WASH_END_DT,
                         A.CAR_WASH_CANC_PRSN_NM,
                         A.CAR_WASH_CANC_DT,
                         C.PRE_CHK_DT,
                         A.CAR_WASH_CANC_REASON_CD,
                         A.CAR_WASH_CANC_REASON_CONT,
                         ROW_NUMBER() OVER(PARTITION BY  A.DLR_CD , A.VIN_NO ORDER BY A.VIN_NO ) AS RN
                    FROM SE_0300T A,
                         SA_0121T B,
                         SE_0200T C
                   WHERE A.VIN_NO      = B.VIN_NO
                     AND A.DLR_CD      = C.DLR_CD
                     AND A.DIAG_DOC_NO = C.DIAG_DOC_NO
                     AND (A.GOODWILL_YN != 'Y'  OR A.GOODWILL_YN IS NULL )
                     AND (A.CAR_WASH_TP != '04' OR A.CAR_WASH_TP IS NULL )
                     AND A.RO_STAT_CD  IN ('01','02')
                     AND A.CAR_WASH_TP IN ('01', '02', '03')
                     AND A.DLR_CD = #{sDlrCd}
                    <if test='sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>
                    <if test='sCarRegNo != null and sCarRegNo != ""'>
                        AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                    </if>
                    <if test='sCarWashStatCd != null and sCarWashStatCd != ""'>
                        AND A.CAR_WASH_STAT_CD = #{sCarWashStatCd}
                    </if>
                    <if test='sCarWashPrsnNm != null and sCarWashPrsnNm != ""'>
                        AND A.CAR_WASH_PRSN_NM LIKE '%'||#{sCarWashPrsnNm}||'%'
                    </if>
                    <if test='sCarWashStartFromDt != null'>
                        AND A.CAR_WASH_START_DT <![CDATA[>=]]> #{sCarWashStartFromDt}
                    </if>
                    <if test='sCarWashStartToDt != null'>
                        AND A.CAR_WASH_START_DT <![CDATA[<]]> #{sCarWashStartToDt} + 1
                    </if>
                    <if test='sCarWashEndFromDt != null'>
                        AND A.CAR_WASH_END_DT <![CDATA[>=]]> #{sCarWashEndFromDt}
                    </if>
                    <if test='sCarWashEndToDt != null'>
                        AND A.CAR_WASH_END_DT <![CDATA[<]]> #{sCarWashEndToDt} + 1
                    </if>
                    <if test='sPreChkFromDt != null'>
                        AND C.PRE_CHK_DT <![CDATA[>=]]> #{sPreChkFromDt}
                    </if>
                    <if test='sPreChkToDt != null'>
                        AND C.PRE_CHK_DT <![CDATA[<]]> #{sPreChkToDt} + 1
                    </if>
            ) T1
            WHERE RN = 1
            <if test='sCarlineNm != null and sCarlineNm != ""'>
            AND CARLINE_NM LIKE '%'||#{sCarlineNm}||'%'
            </if>
            <if test='firstIndex != -1 and lastIndex != -1'>
             AND ROWNUM <![CDATA[<=]]> #{lastIndex}
            </if>
            ORDER BY
            <choose>
                <when test='sort != null'>
                    <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                        <choose>
                            <when test='item.field == "carRegNo"'>          T1.CAR_REG_NO           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "vinNo"'>             T1.VIN_NO               <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "preChkDt"'>          T1.PRE_CHK_DT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carWashStartDt"'>    T1.CAR_WASH_START_DT    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carWashEndDt"'>      T1.CAR_WASH_END_DT      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carWashCancDt"'>     T1.CAR_WASH_CANC_DT     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <otherwise>
                                PRE_CHK_DT DESC
                            </otherwise>
                        </choose>
                    </foreach>
                </when>
                <otherwise>
                    PRE_CHK_DT DESC
                </otherwise>
            </choose>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>
    
    <!-- 공임 이력 조회  -->
    <select id="selectLbrHistListByCondition" parameterType="RepairOrderSearchVO" resultType="chn.bhmc.dms.mob.api.repair.vo.RepairOrderVO">
        /* [chn.bhmc.dms.mob.api.repair.dao.RepairOrderAppDAO.selectLbrHistListByCondition] */

          SELECT * FROM (
              SELECT ROWNUM AS RNUM , T1.*
                 FROM (
                    SELECT A.DLR_CD
                          ,A.VIN_NO
                          ,A.CAR_OWNER_NM
                          ,A.DRIVER_NM
                          ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                          ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                          ,A.CAR_REG_NO
                          ,(SELECT RUN_DIST_VAL
                              FROM SE_0200T
                              WHERE DLR_CD = A.DLR_CD
                                AND VIN_NO = A.VIN_NO
                                AND DIAG_DOC_NO = A.DIAG_DOC_NO
                                AND ROWNUM = 1 ) AS RUN_DIST_VAL
                          ,A.RUN_DIST_VAL  AS LAST_RUN_DIST_VAL
                          ,FN_CMM_CD_NM('SER030', A.RO_STAT_CD, #{sLangCd}, 'N') AS RO_STAT_NM
                          ,D.CALC_DT
                          ,A.RO_DOC_NO
                          ,A.RO_TP
                          ,FN_CMM_CD_NM('SER031', A.RO_TP , #{sLangCd}, 'N') AS RO_TP_NM
                          ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                          ,A.RO_DT
                          ,FN_CMM_CD_NM('SER036', B.LBR_TP , #{sLangCd}, 'N') AS LBR_TP_NM
                          ,B.PKG_ITEM_CD
                          ,B.LBR_CD
                          ,B.LBR_NM
                          ,NVL(B.LBR_HM,0) AS LBR_HM
                          ,NVL(C.ALLOC_HM, NVL(B.DSTB_HM,0)) AS DSTB_HM  --배정공임
                          ,B.LBR_PRC  --공임단가
                          ,B.LBR_PRC * B.LBR_QTY * B.LBR_HM AS LBR_AMT  --공임금액
                          ,B.DC_RATE AS LBR_DC_RATE  --공임할인율
                          ,B.DC_AMT AS LBR_DC_AMT  --공임할인금액
                          ,B.LBR_TOT_AMT  --공임할인후 금액
                          ,C.REAL_TEC_ID AS TEC_ID
                          ,C.REAL_TEC_NM AS TEC_NM
                          ,C.WKGRP_NO
                          ,C.WKGRP_NM
                          ,C.BAY_NO
                          ,(SELECT BAY_NM FROM SE_1012T WHERE DLR_CD = A.DLR_CD AND BAY_NO = C.BAY_NO) AS BAY_NM
                          ,C.SHT_CNT
                          ,C.SHT_CNT AS SER_CNT
                          ,C.PAINT_CNT
                          ,C.LBR_CNT
                          ,C.DIFF_VAL
                          ,B.SUB_BP_CD               --점검코드
                          ,B.SUB_BP_NM               --의견번호
                          ,A.RO_PRINT_DT
                          ,A.UPDT_DT
                          ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) AS UPDT_USR_NM
                          ,FN_CMM_CD_NM('SER043', NVL(C.ALLOC_STAT_CD, '01') , #{sLangCd}, 'N') AS ALLOC_STAT_NM  --정비배정상태
                          ,(SELECT SA_NM FROM SE_0300T WHERE DLR_CD = C.DLR_CD AND RO_DOC_NO = C.RO_DOC_NO) AS SA_NM
                          ,(SELECT MIN(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO) AS ALLOC_START_DT         --배정시작시간
                          ,(SELECT MAX(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO) AS ALLOC_END_DT         --배정완료시간
                          ,C.ALLOC_START_DT AS EXPT_START_DT  --예정시작시간
                          ,C.ALLOC_END_DT AS EXPT_END_DT  --예정완료시간
                          ,C.ALLOC_REMARK --배정비고
                          ,FN_CMM_CD_NM('SER050', NVL(C.WRK_STAT_CD, '01') , #{sLangCd}, 'N') AS WRK_STAT_NM  --정비진도상태
                          ,FN_CMM_CD_NM('SER053', NVL(C.PAINT_STAT_CD, '') , #{sLangCd}, 'N') AS PAINT_STAT_NM  --판금페인트상태
                          ,C.WRK_START_DT  --작업시작시간
                          ,C.WRK_END_DT  --작업종료시간
                          ,C.PAUSE_CAU_CD --정비중단원인
                          ,C.PAUSE_CAU_RMK --정비중단비고
                          ,FN_CMM_CD_NM('SER052', NVL(C.QT_TEST_STAT_CD, 'Q5') , #{sLangCd}, 'N') AS QT_TEST_STAT_NM  --품질검사상태
                          ,C.QT_TEST_START_DT  --품질검사시작시간
                          ,C.QT_TEST_END_DT  --품질검사종료시간
                          ,B.CR_NO  --캠페인번호
                          ,B.CR_TP  --켐페인유형 코드
                          ,FN_CMM_CD_NM('SER930', B.CR_TP, #{sLangCd}, 'N') AS CR_TP_NM --캠페인유형 명칭
                          ,B.CR_NM  --캠페인명칭
                          ,NVL(ROUND(((SELECT MIN(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO) - A.RO_DT)*24,2),0) AS ALLOC_READY_TIME      --배정대기사용시간
                          ,NVL(ROUND(((SELECT MAX(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO) - (SELECT MIN(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO))*24,2),0) AS ALLOC_USE_TIME        --배정사용시간
                          ,NVL(ROUND((A.DL_CHK_DT - A.RO_DT)*24,2),0) AS RPIR_SER_TIME         --정비서비스사용시간
                          ,NVL(ROUND((C.WRK_START_DT - (SELECT MAX(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO))*24,2),0) AS RPIR_READY_TIME       --정비서비스사용시간
                          ,NVL(ROUND((C.WRK_END_DT - C.WRK_START_DT)*24,2),0) AS RPIR_TIME             --정비조작사용시간
                          ,NVL(ROUND((C.QT_TEST_START_DT - C.WRK_END_DT)*24,2),0) AS QT_TEST_READY_TIME    --품질점검대기사용시간
                          ,NVL(ROUND((C.QT_TEST_END_DT - C.QT_TEST_START_DT)*24,2),0) AS QT_TEST_TIME          --품질점검사용시간
                          ,(CASE WHEN C.WRK_START_DT <![CDATA[<=]]> C.ALLOC_START_DT THEN 'Y' ELSE 'N' END) AS ON_TIME_START_YN  --On time 작업시작
                          ,(CASE WHEN C.WRK_END_DT   <![CDATA[<=]]> C.ALLOC_END_DT   THEN 'Y' ELSE 'N' END) AS ON_TIME_END_YN    --On time 작업완료
                          ,(CASE WHEN C.WRK_START_DT <![CDATA[>]]>  C.ALLOC_START_DT THEN 'Y' ELSE 'N' END) AS DELAY_START_YN    --지연 작업시작
                          ,(CASE WHEN C.WRK_END_DT   <![CDATA[>]]>  C.ALLOC_END_DT   THEN 'Y' ELSE 'N' END) AS DELAY_END_YN      --지연 작업완료
                          ,(SELECT MAX(RCV_CPLT_DT) FROM SE_0560T WHERE RCV_DOC_NO = E.RCV_DOC_NO) AS RCV_CPLT_DT --수납완료일자
                          ,(SELECT MAX(RCV_CPLT_DT) FROM SE_0570T WHERE RCV_DOC_NO = E.RCV_DOC_NO) AS PAY_END_DT --지불완료시간
                      FROM SE_0300T A
                      LEFT OUTER JOIN SE_0170T B ON A.DLR_CD = B.DLR_CD AND A.RO_DOC_NO = B.DOC_NO
                      LEFT OUTER JOIN SE_0330T C ON B.DLR_CD = C.DLR_CD AND B.DOC_NO = C.RO_DOC_NO AND B.LBR_CD = C.RPIR_CD
                      LEFT OUTER JOIN SE_0500T D ON A.DLR_CD = D.DLR_CD AND A.RO_DOC_NO = D.RO_DOC_NO AND D.CALC_CANC_YN = 'N'
                      LEFT OUTER JOIN SE_0550T E ON A.DLR_CD = E.DLR_CD AND A.RO_DOC_NO = E.RO_DOC_NO
                    WHERE A.DLR_CD = #{sDlrCd}
                      AND B.PREFIX_ID = 'RO'
                      AND A.RO_STAT_CD != '06'
                      <if test='sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                      </if>
                      <if test='sRoStatCd != null and sRoStatCd != ""'>
                        AND A.RO_STAT_CD = #{sRoStatCd}
                      </if>
                      <if test='sRoFromDt != null'>
                        AND A.RO_DT <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                      </if>
                      <if test='sRoToDt!= null'>
                        AND A.RO_DT <![CDATA[<]]> TO_CHAR(#{sRoToDt} + 1, 'YYYYMMDD')
                      </if>
                      <if test='sRoTp != null and sRoTp != ""'>
                        AND A.RO_TP  = #{sRoTp}
                      </if>
                      <if test='sLbrTp != null and sLbrTp != ""'>
                        AND B.LBR_TP  = #{sLbrTp}
                      </if>
                      <if test='sCarRegNo != null and sCarRegNo != ""'>
                        AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                      </if>
                      <if test='sRoDocNo != null and sRoDocNo != ""'>
                        AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                      </if>
                      <if test='sLbrCd != null and sLbrCd != ""'>
                        AND B.LBR_CD LIKE '%'||#{sLbrCd}||'%'
                      </if>
                      <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                        AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                      </if>
                      <if test='sCalcFromDt != null'>
                        AND TO_CHAR(D.CALC_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sCalcFromDt}, 'YYYYMMDD')
                      </if>
                      <if test='sCalcToDt != null'>
                        AND TO_CHAR(D.CALC_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sCalcToDt}, 'YYYYMMDD')
                      </if>
                      <if test='sCrNm != null and sCrNm != ""'>
                        AND B.CR_NM LIKE '%'||#{sCrNm}||'%'
                      </if>
                      <if test='sCrTp != null and sCrTp != "" '>
                        AND B.CR_TP = #{sCrTp}
                      </if>
                      ORDER BY
                      <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                    <when test='item.field == "carRegNo"'>              CAR_REG_NO                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "vinNo"'>                 VIN_NO                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carOwnerNm"'>            CAR_OWNER_NM                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "driverNm"'>              DRIVER_NM                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carlineNm"'>             CARLINE_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "modelNm"'>               MODEL_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "runDistVal"'>            RUN_DIST_VAL                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lastRunDistVal"'>        LAST_RUN_DIST_VAL             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roStatNm"'>              RO_STAT_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roDocNo"'>               RO_DOC_NO                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roTpNm"'>                RO_TP_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roDtFormat"'>            RO_DT                         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regUsrNm"'>              REG_USR_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roPrintDtFormat"'>       RO_PRINT_DT                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "updtDtFormat"'>          UPDT_DT                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "updtUsrNm"'>             UPDT_USR_NM                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "calcDtFormat"'>          CALC_DT                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "pkgItemCd"'>             PKG_ITEM_CD                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrCd"'>                 LBR_CD                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrNm"'>                 LBR_NM                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrTpNm"'>               LBR_TP_NM                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "subBpNm"'>               SUB_BP_NM                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "subBpCd"'>               SUB_BP_CD                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrHm"'>                 LBR_HM                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrPrc"'>                LBR_PRC                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrAmt"'>                LBR_AMT                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrDcRate"'>             LBR_DC_RATE                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrDcAmt"'>              LBR_DC_AMT                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrTotAmt"'>             LBR_TOT_AMT                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "tecNm"'>                 TEC_NM                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "tecId"'>                 TEC_ID                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "wkgrpNm"'>               WKGRP_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "wkgrpNo"'>               WKGRP_NO                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "bayNm"'>                 BAY_NM                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "bayNo"'>                 BAY_NO                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "serCnt"'>                SER_CNT                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "diffVal"'>               DIFF_VAL                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocStatNm"'>           ALLOC_STAT_NM                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "dstbHm"'>                DSTB_HM                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "saNm"'>                  SA_NM                         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocStartDtFormat"'>    ALLOC_START_DT                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocEndDtFormat"'>      ALLOC_END_DT                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "exptStartDtFormat"'>     EXPT_START_DT                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "exptEndDtFormat"'>       EXPT_END_DT                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocRemark"'>           ALLOC_REMARK                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "wrkStatNm"'>             WRK_STAT_NM                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "paintStatNm"'>           PAINT_STAT_NM                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "wrkStartDtFormat"'>      WRK_START_DT                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "wrkEndDtFormat"'>        WRK_END_DT                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "pauseCauCd"'>            PAUSE_CAU_CD                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "pauseCauRmk"'>           PAUSE_CAU_RMK                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "qtTestStatNm"'>          QT_TEST_STAT_NM               <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "qtTestStartDtFormat"'>   QT_TEST_START_DT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "qtTestEndDtFormat"'>     QT_TEST_END_DT                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "crNo"'>                  CR_NO                         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "crTpNm"'>                CR_TP_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "crNm"'>                  CR_NM                         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocReadyTime"'>        ALLOC_READY_TIME              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocUseTime"'>          ALLOC_USE_TIME                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "rpirSerTime"'>           RPIR_SER_TIME                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "rpirReadyTime"'>         RPIR_READY_TIME               <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "rpirTime"'>              RPIR_TIME                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "qtTestReadyTime"'>       QT_TEST_READY_TIME            <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "qtTestTime"'>            QT_TEST_TIME                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "onTimeStartYn"'>         ON_TIME_START_YN              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "onTimeEndYn"'>           ON_TIME_END_YN                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "delayStartYn"'>          DELAY_START_YN                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "delayEndYn"'>            DELAY_END_YN                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "rcvCpltDtFormat"'>       RCV_CPLT_DT                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "payEndDtFormat"'>        PAY_END_DT                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <otherwise>
                                        RO_DT DESC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            RO_DT DESC
                        </otherwise>
                    </choose>
                )T1
                <where>
                    <if test='sLbrNm != null and sLbrNm != "" '>
                        AND T1.LBR_NM LIKE '%'|| #{sLbrNm} ||'%'
                    </if>
                    <if test='sRegUsrNm != null and sRegUsrNm != "" '>
                        AND T1.REG_USR_NM LIKE '%'|| #{sRegUsrNm} ||'%'
                    </if>
                    <if test='sTecNm != null and sTecNm != ""'>
                        AND T1.TEC_NM LIKE '%'||#{sTecNm}||'%'
                    </if>
                    <if test='sPayFromDt != null'>
                        AND TO_CHAR(T1.PAY_END_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sPayFromDt}, 'YYYYMMDD')
                    </if>
                    <if test='sPayToDt != null'>
                        AND TO_CHAR(T1.PAY_END_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sPayToDt}, 'YYYYMMDD')
                    </if>
                    <if test='firstIndex != -1 and lastIndex != -1'>
                        AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                    </if>
                </where>

        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>
    
    <!-- 공임 이력 조회  -->
    <select id="selectCustDmndHistListByCondition" parameterType="RepairOrderSearchVO" resultType="chn.bhmc.dms.mob.api.repair.vo.RepairOrderVO">
        /* [chn.bhmc.dms.mob.api.repair.dao.RepairOrderAppDAO.selectCustDmndHistListByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM , T1.*
              FROM (
                    SELECT A.DLR_CD
                          ,A.VIN_NO
                          ,A.CAR_OWNER_NM
                          ,A.DRIVER_NM
                          ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                          ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                          ,A.CAR_REG_NO
                          ,(SELECT RUN_DIST_VAL
                              FROM SE_0200T
                              WHERE DLR_CD = A.DLR_CD
                                AND VIN_NO = A.VIN_NO
                                AND DIAG_DOC_NO = A.DIAG_DOC_NO
                                AND ROWNUM = 1 ) AS RUN_DIST_VAL
                          ,RUN_DIST_VAL  AS LAST_RUN_DIST_VAL
                          ,A.RO_DOC_NO
                          ,A.RO_TP
                          ,FN_CMM_CD_NM('SER031', A.RO_TP , #{sLangCd} , 'N') AS RO_TP_NM
                          ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                          ,A.RO_DT
                          ,FN_CMM_CD_NM('SER030', A.RO_STAT_CD , #{sLangCd} , 'N') AS RO_STAT_NM
                          ,A.RO_PRINT_DT
                          ,A.UPDT_DT
                          ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) AS UPDT_USR_NM
                          ,B.LINE_NO AS CUST_REQ_CD
                          ,B.CUST_REQ_CONT
                      FROM SE_0300T A
                      INNER JOIN SE_0130T B
                       ON A.DLR_CD    = B.DLR_CD
                      AND A.RO_DOC_NO = B.JOB_NO
                      AND B.PREFIX_ID = 'RO'
                    WHERE A.DLR_CD = #{sDlrCd}
                      AND A.RO_STAT_CD != '06'
                      <if test=' sVinNo != null and sVinNo != ""'>
                      AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                      </if>
                      <if test=' sDriverNm != null and sDriverNm != ""'>
                      AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                      </if>
                      <if test=' sRoDocNo != null and sRoDocNo != ""'>
                      AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                      </if>
                      <if test='sRoFromDt != null'>
                      AND A.RO_DT <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                      </if>
                      <if test='sRoToDt!= null'>
                      AND A.RO_DT <![CDATA[<]]> TO_CHAR(#{sRoToDt} + 1, 'YYYYMMDD')
                      </if>
                      <if test=' sCarRegNo != null and sCarRegNo != ""'>
                      AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                      </if>
                      <if test=' sCustReqCd != null and sCustReqCd != ""'>
                      AND B.LINE_NO LIKE '%'||#{sCustReqCd}||'%'
                      </if>
                      <if test=' sCustReqCont != null and sCustReqCont != ""'>
                      AND B.CUST_REQ_CONT LIKE '%'||#{sCustReqCont}||'%'
                      </if>
                      <if test=' sRoTp != null and sRoTp != ""'>
                      AND A.RO_TP  = #{sRoTp}
                      </if>
                      <if test=' sRoStatCd != null and sRoStatCd != ""'>
                      AND A.RO_STAT_CD = #{sRoStatCd}
                      </if>
                   ORDER BY
                   <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                    <when test='item.field == "carRegNo"'>              CAR_REG_NO                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "vinNo"'>                 VIN_NO                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carOwnerNm"'>            CAR_OWNER_NM                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "driverNm"'>              DRIVER_NM                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carlineNm"'>             CARLINE_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "modelNm"'>               MODEL_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "runDistVal"'>            RUN_DIST_VAL                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lastRunDistVal"'>        LAST_RUN_DIST_VAL             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roStatNm"'>              RO_STAT_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roDocNo"'>               RO_DOC_NO                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roTpNm"'>                RO_TP_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roDtFormat"'>            RO_DT                         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regUsrNm"'>              REG_USR_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roPrintDtFormat"'>       RO_PRINT_DT                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "updtDtFormat"'>          UPDT_DT                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "updtUsrNm"'>             UPDT_USR_NM                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custReqCd"'>             CUST_REQ_CD                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custReqCont"'>           CUST_REQ_CONT                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <otherwise>
                                        RO_DT DESC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            RO_DT DESC
                        </otherwise>
                    </choose>
                )T1
                <where>
                    <if test='firstIndex != -1 and lastIndex != -1'>
                        AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                    </if>
                </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>
    
    <!-- 기타사항 조회  -->
    <select id="selectEtcHistListByCondition" parameterType="RepairOrderSearchVO" resultType="chn.bhmc.dms.mob.api.repair.vo.RepairOrderVO">
        /* [chn.bhmc.dms.mob.api.repair.dao.RepairOrderAppDAO.selectEtcHistListByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM , T1.*
              FROM (
                    SELECT A.DLR_CD
                          ,A.VIN_NO
                          ,A.CAR_OWNER_NM
                          ,A.DRIVER_NM
                          ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                          ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                          ,A.CAR_REG_NO
                          ,(SELECT RUN_DIST_VAL
                              FROM SE_0200T
                              WHERE DLR_CD = A.DLR_CD
                                AND VIN_NO = A.VIN_NO
                                AND DIAG_DOC_NO = A.DIAG_DOC_NO
                                AND ROWNUM = 1 ) AS RUN_DIST_VAL
                          ,RUN_DIST_VAL  AS LAST_RUN_DIST_VAL
                          ,A.RO_DOC_NO
                          ,A.RO_TP
                          ,FN_CMM_CD_NM('SER031', A.RO_TP , #{sLangCd} , 'N') AS RO_TP_NM
                          ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                          ,A.RO_DT
                          ,FN_CMM_CD_NM('SER030', A.RO_STAT_CD , #{sLangCd} , 'N') AS RO_STAT_NM
                          ,A.RO_PRINT_DT
                          ,A.UPDT_DT
                          ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) AS UPDT_USR_NM
                          ,B.ETC_TP_CD
                          ,B.ETC_TP_NM
                          ,B.ETC_REQ_PRC
                      FROM SE_0300T A
                      INNER JOIN SE_0140T B
                       ON A.DLR_CD    = B.DLR_CD
                      AND A.RO_DOC_NO = B.JOB_NO
                      AND B.PREFIX_ID = 'RO'
                    WHERE A.DLR_CD = #{sDlrCd}
                      AND A.RO_STAT_CD != '06'
                      <if test='sVinNo != null and sVinNo != ""'>
                      AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                      </if>
                      <if test='sDriverNm != null and sDriverNm != ""'>
                      AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                      </if>
                      <if test='sRoDocNo != null and sRoDocNo != ""'>
                      AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                      </if>
                      <if test='sRoFromDt != null'>
                      AND A.RO_DT <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                      </if>
                      <if test='sRoToDt!= null'>
                      AND A.RO_DT <![CDATA[<]]> TO_CHAR(#{sRoToDt} + 1, 'YYYYMMDD')
                      </if>
                      <if test='sCarRegNo != null and sCarRegNo != ""'>
                      AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                      </if>
                      <if test='sEtcTpCd != null and sEtcTpCd != ""'>
                      AND B.ETC_TP_CD LIKE '%'||#{sEtcTpCd}||'%'
                      </if>
                      <if test='sRoTp != null and sRoTp != ""'>
                      AND A.RO_TP  = #{sRoTp}
                      </if>
                      <if test='sRoStatCd != null and sRoStatCd != ""'>
                      AND A.RO_STAT_CD = #{sRoStatCd}
                      </if>
                   ORDER BY
                     <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                    <when test='item.field == "carRegNo"'>              CAR_REG_NO                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "vinNo"'>                 VIN_NO                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carOwnerNm"'>            CAR_OWNER_NM                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "driverNm"'>              DRIVER_NM                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carlineNm"'>             CARLINE_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "modelNm"'>               MODEL_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "runDistVal"'>            RUN_DIST_VAL                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lastRunDistVal"'>        LAST_RUN_DIST_VAL             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roStatNm"'>              RO_STAT_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roDocNo"'>               RO_DOC_NO                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roTpNm"'>                RO_TP_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roDtFormat"'>            RO_DT                         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regUsrNm"'>              REG_USR_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roPrintDtFormat"'>       RO_PRINT_DT                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "updtDtFormat"'>          UPDT_DT                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "updtUsrNm"'>             UPDT_USR_NM                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "etcTpCd"'>               ETC_TP_CD                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "etcTpNm"'>               ETC_TP_NM                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "etcReqPrc"'>             ETC_REQ_PRC                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <otherwise>
                                        RO_DT DESC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            RO_DT DESC
                        </otherwise>
                    </choose>
                )T1
                <where>
                    <if test='firstIndex != -1 and lastIndex != -1'>
                        AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                    </if>
                </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>
	
</mapper>