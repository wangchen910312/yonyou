<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : ReceiveEtcDAO_SqlMap.xml
    Description : 기타입고 관리.
    author In Bo Shim
    since 2016. 2. 23.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 02. 23.     Ju Won Lee     최초 생성
-->

<mapper namespace="chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO">

    <!-- 기타입고 헤더 정보를 추가한다. -->
    <insert id="insertReceiveEtc" parameterType="ReceiveEtcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.insertReceiveEtc] */
        INSERT INTO DMSDB.PT_0621T    --기타입고문서헤더정보
        (
          DLR_CD               --딜러코드
         ,ETC_GR_DOC_NO        --기타입고문서번호
         ,ETC_GR_DOC_TP        --입고문서업무구분
         ,STAT_CD              --상태코드
         ,MVT_TP               --수불유형
         ,PLT_CD               --센터코드
         ,BP_CD                --거래처코드
         ,REMARK               --비고
         ,REG_USR_ID           --등록자ID
         ,REG_DT               --등록일자
         ,UPDT_USR_ID
         ,UPDT_DT
        )
        VALUES
        (
          #{dlrCd}               --딜러코드
         ,#{etcGrDocNo}          --기타입고문서번호
         ,NVL(#{etcGrDocTp},'PARTS') --입고문서업무구분
         ,#{statCd}              --상태코드
         ,#{mvtTp}               --수불유형
         ,#{pltCd}               --센터코드
         ,#{bpCd}                --거래처코드
         ,#{remark}              --비고
         ,#{regUsrId}            --등록자ID
         ,sysdate                --등록일자
         ,#{regUsrId}            --등록자ID
         ,sysdate                --등록일자
        )
    </insert>

    <!-- 기타입고  부품 정보를 추가한다. -->
    <insert id="insertReceiveEtcItem" parameterType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.insertReceiveEtcItem] */
        INSERT INTO DMSDB.PT_0622T    --기타입고문서품목정보
        (
          DLR_CD                    --딜러코드
         ,ETC_GR_DOC_NO             --기타입고문서번호
         ,ETC_GR_DOC_LINE_NO        --기타입고문서라인번호
         ,CANC_YN                   --취소여부
         ,ITEM_CD                   --품목코드
         ,QTY                       --수량
         ,UNIT_CD                   --단위코드
         ,STRGE_CD                  --창고코드
         ,LOC_CD                    --위치코드
         ,DC_RATE                   --할인율
         ,PRC                       --단가
         ,AMT                       --금액
         ,TAX_DDCT_PRC              --세금공제단가
         ,TAX_DDCT_AMT              --세금공제금액
         ,TAX_AMT                   --세금금액
         ,GR_REASON_CD              --입고사유코드
         ,GR_STAT_CD                --입고상태
         ,REF_DOC_NO                --참조번호
         ,REF_DOC_LINE_NO           --참조라인번호
         ,RECEIVE_USR_ID
         ,REG_USR_ID                --등록자ID
         ,REG_DT                    --등록일자
         ,UPDT_USR_ID
         ,UPDT_DT
        )
        VALUES
        (
          #{dlrCd}                    --딜러코드
         ,#{etcGrDocNo}               --기타입고문서번호
         ,#{etcGrDocLineNo}           --기타입고문서라인번호
         ,#{cancYn}                   --취소여부
         ,#{itemCd}                   --품목코드
         ,round(#{qty},2)                --수량
         ,NVL(#{unitCd},'EA')         --단위코드
         ,#{strgeCd}                  --창고코드
         ,#{locCd}                    --위치코드
         ,round(#{dcRate},2)          --할인율
         ,round(#{prc},2)             --단가
         ,round(#{amt},2)             --금액
         ,round(#{taxDdctPrc},2)      --세금공제단가
         ,round(#{taxDdctAmt},2)      --세금공제금액
         ,round(#{taxAmt},2)          --세금금액
         ,#{grReasonCd}               --입고사유코드
         ,#{grStatCd}                 --입고상태코드
         ,#{refDocNo}                 --참조번호
         ,#{refDocLineNo}             --참조라인번호
         ,#{regUsrId}                 --수령인ID
         ,#{regUsrId}                 --등록자ID
         ,sysdate                    --등록일자
         ,#{regUsrId}                 --등록자ID
         ,sysdate                    --등록일자
        )
    </insert>

     <!-- 기타입고 헤더 정보를 수정한다. -->
    <update id="updateReceiveEtc" parameterType="ReceiveEtcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.updateReceiveEtc] */
        UPDATE DMSDB.PT_0621T    --기타입고문서헤더정보
          SET  STAT_CD       = #{statCd}              --거래처코드
              ,BP_CD         = #{bpCd}                --거래처코드
              ,REMARK        = #{remark}              --비고
              ,UPDT_USR_ID   = #{regUsrId}           --수정자ID
              ,UPDT_DT       = sysdate                --수정일자
         WHERE DLR_CD        = #{dlrCd}               --딜러코드
           AND ETC_GR_DOC_NO = #{etcGrDocNo}          --기타입고문서번호
    </update>

     <!-- 기타입고 헤더 정보를 수정일자정보를 수정한다. -->
    <update id="updateReceiveEtcUpdtDt" parameterType="ReceiveEtcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.updateReceiveEtcUpdtDt] */
        UPDATE DMSDB.PT_0621T    --기타입고문서헤더정보
          SET  UPDT_USR_ID   = #{regUsrId}           --수정자ID
              ,UPDT_DT       = sysdate                --수정일자
         WHERE DLR_CD        = #{dlrCd}               --딜러코드
           AND ETC_GR_DOC_NO = #{etcGrDocNo}          --기타입고문서번호
    </update>

     <!-- 기타입고 헤더 정보를 취소한다. -->
    <update id="cancelReceiveEtc" parameterType="ReceiveEtcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.cancelReceiveEtc] */
        UPDATE DMSDB.PT_0621T    --기타입고문서헤더정보
          SET  STAT_CD       = #{statCd}              --거래처코드
              ,UPDT_USR_ID   = #{regUsrId}           --수정자ID
              ,UPDT_DT       = sysdate                --수정일자
         WHERE DLR_CD        = #{dlrCd}               --딜러코드
           AND ETC_GR_DOC_NO = #{etcGrDocNo}          --기타입고문서번호
    </update>

    <!-- 기타입고 부품 정보를 수정한다. -->
    <update id="updateReceiveEtcItem" parameterType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.updateReceiveEtcItem] */
        UPDATE DMSDB.PT_0622T    --기타입고품목정보
          SET  UNIT_CD             = #{unitCd}                  --단위
              ,PRC                 = round(#{prc},2)            --가격
              ,AMT                 = round(#{amt},2)            --금액
              ,TAX_DDCT_PRC        = round(#{taxDdctPrc},2)     --세금공제단가
              ,TAX_DDCT_AMT        = round(#{taxDdctAmt},2)     --세금공제금액
              ,TAX_AMT             = round(#{taxAmt},2)         --세금액
              ,QTY                 = #{qty}                     --수량
              ,STRGE_CD            = #{strgeCd}                 --입고창고
              ,LOC_CD              = #{locCd}                   --입고로케이션
              ,GR_REASON_CD        = #{grReasonCd}              --입고사유코드
              ,DC_RATE             = NVL(#{dcRate},( 100 * FN_GET_VAT(null,'ALL')))          --입고사유코드
              ,UPDT_USR_ID         = #{regUsrId}                --수정자ID
              ,UPDT_DT             = sysdate                    --수정일자
         WHERE DLR_CD              = #{dlrCd}                   --딜러코드
           AND ETC_GR_DOC_NO       = #{etcGrDocNo}              --기타입고번호
           AND ETC_GR_DOC_LINE_NO  = #{etcGrDocLineNo}        --기타입고라인번호
    </update>

    <!-- 기타입고 부품 정보를 확정한다. -->
    <update id="updateCnfmReceiveEtcItem" parameterType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.updateCnfmReceiveEtcItem] */
        UPDATE DMSDB.PT_0622T    --기타입고품목정보
          SET  GR_STAT_CD          = #{grStatCd}                 --입고상태코드
              ,UNIT_CD             = #{unitCd}                  --단위
              ,PRC                 = round(#{prc},2)            --가격
              ,AMT                 = round(#{amt},2)            --금액
              ,TAX_DDCT_PRC        = round(#{taxDdctPrc},2)     --세금공제단가
              ,TAX_DDCT_AMT        = round(#{taxDdctAmt},2)     --세금공제금액
              ,TAX_AMT             = round(#{taxAmt},2)         --세금액
              ,QTY                 = round(#{qty},2)            --수량
              ,STRGE_CD            = #{strgeCd}                 --입고창고
              ,LOC_CD              = #{locCd}                   --입고로케이션
              ,GR_REASON_CD        = #{grReasonCd}              --입고사유코드
              ,DC_RATE             = NVL(#{dcRate},( 100 * FN_GET_VAT(null,'ALL')))          --입고사유코드
              ,UPDT_USR_ID         = #{regUsrId}                --수정자ID
              ,UPDT_DT             = sysdate                    --수정일자
         WHERE DLR_CD              = #{dlrCd}                   --딜러코드
           AND ETC_GR_DOC_NO       = #{etcGrDocNo}              --기타입고번호
           AND ETC_GR_DOC_LINE_NO  = #{etcGrDocLineNo}        --기타입고라인번호
    </update>

    <!-- 기타입고인터페이스 부품 정보를 수정한다. -->
    <update id="updateReceiveEtcItemInfc" parameterType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.updateReceiveEtcItemInfc] */
        UPDATE DMSDB.PT_0612I    --기타출고인터페이스품목정보
          SET  RCV_ID              = #{regUsrId}                --수령인ID
              ,RCV_DT              = sysdate                    --수령일
         WHERE DLR_CD              = #{dlrCd}                   --딜러코드
           AND ETC_GI_DOC_NO       = #{refDocNo}                --기타출고번호
           AND ETC_GI_DOC_LINE_NO  = #{refDocLineNo}            --기타출고라인번호
           AND DLR_CD_RCV          = #{bpCd}                    --타딜러
    </update>

    <!-- 기타입고 부품 정보를 삭제한다. -->
    <update id="deleteReceiveEtcItem" parameterType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.deleteReceiveEtcItem] */
        UPDATE DMSDB.PT_0622T    --기타입고품목정보
          SET  CANC_YN             = 'Y'                   --취소여부
              ,GR_STAT_CD          = #{grStatCd}
              ,CANC_ID             = #{regUsrId}
              ,CANC_DT             = sysdate
              ,UPDT_USR_ID         = #{regUsrId}                 --수정자ID
              ,UPDT_DT             = sysdate                     --수정일자
         WHERE DLR_CD              = #{dlrCd}                    --딜러코드
           AND ETC_GR_DOC_NO       = #{etcGrDocNo}               --기타입고번호
           AND ETC_GR_DOC_LINE_NO  = #{etcGrDocLineNo}         --기타입고라인번호
    </update>

    <!-- 기타입고상세 전체 취소 -->
    <update id="updateReceiveCancelEtcKey" parameterType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.updateReceiveCancelEtcKey] */
        UPDATE DMSDB.PT_0622T    --기타입고품목정보
          SET  CANC_YN             = 'Y'                   --취소여부
              ,GR_STAT_CD          = #{grStatCd}
              ,CANC_ID             = #{regUsrId}
              ,CANC_DT             = sysdate
              ,UPDT_USR_ID         = #{regUsrId}                 --수정자ID
              ,UPDT_DT             = sysdate                     --수정일자
         WHERE DLR_CD              = #{dlrCd}                    --딜러코드
           AND ETC_GR_DOC_NO       = #{etcGrDocNo}               --기타입고번호
    </update>

     <!-- 등록된 기타입고 부품 정보를 삭제한다.(수불발생 안한 부품 실제 삭제) -->
    <delete id="deleteRegReceiveEtcItem" parameterType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.deleteRegReceiveEtcItem] */
        DELETE FROM DMSDB.PT_0622T    --기타입고품목정보
         WHERE DLR_CD              = #{dlrCd}                    --딜러코드
           AND ETC_GR_DOC_NO       = #{etcGrDocNo}               --기타입고번호
           AND ETC_GR_DOC_LINE_NO  = #{etcGrDocLineNo}         --기타입고라인번호
    </delete>

    <!-- 기타입고 부품 정보의 수불 정보를 반영한다. -->
    <update id="updateReceiveEtcItemMvtInfo" parameterType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.updateReceiveEtcItemMvtInfo] */
        UPDATE DMSDB.PT_0622T    --기타입고품목정보
          SET  MVT_DOC_YY_MM       = #{mvtDocYyMm}               --수불문서년월
              ,MVT_DOC_NO          = #{mvtDocNo}                 --수불문서번호
              ,MVT_DOC_LINE_NO     = #{mvtDocLineNo}             --수불문서라인번호
              ,UPDT_USR_ID         = #{regUsrId}                 --수정자ID
              ,UPDT_DT             = sysdate                     --수정일자
         WHERE DLR_CD              = #{dlrCd}                    --딜러코드
           AND ETC_GR_DOC_NO       = #{etcGrDocNo}               --기타입고번호
           AND ETC_GR_DOC_LINE_NO  = #{etcGrDocLineNo}         --기타입고라인번호
    </update>



    <!-- 기타입고 헤더 정보를 조회한다. -->
    <select id="selectReceiveEtcByKey" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcByKey] */
        SELECT
                A.DLR_CD                    --딜러코드
               ,A.ETC_GR_DOC_NO             --기타입고번호
               ,A.STAT_CD                   --상태코드
               ,A.REG_DT                    --일자
               ,A.BP_CD                     --거래처
               ,DECODE(C.BP_NM,NULL,D.DLR_NM,C.BP_NM) AS BP_NM                     --거래처명
               ,C.BP_TP                     --거래처유형
               ,A.MVT_TP                    --수불유형
               ,NVL(B.ITEM_CNT,0) AS ITEM_CNT
               ,NVL(B.ITEM_QTY,0) AS ITEM_QTY
               ,NVL(B.GR_TAX_DDCT_AMT,0) AS GR_TAX_DDCT_AMT
               ,NVL(B.GR_TOT_AMT,0) AS GR_TOT_AMT
               ,A.REMARK                    --비고
               ,A.REG_USR_ID                --등록자
               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   --등록자명
               ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
          FROM DMSDB.PT_0621T A    --기타입고헤더정보
                 LEFT OUTER JOIN
                      (
                      SELECT   A.DLR_CD
                              ,A.ETC_GR_DOC_NO
                              ,COUNT(*) AS ITEM_CNT
                              ,SUM(NVL(A.QTY,0)) AS ITEM_QTY
                              ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS GR_TAX_DDCT_AMT
                              ,SUM(NVL(A.AMT,0)) AS GR_TOT_AMT
                        FROM   DMSDB.PT_0622T A    --기타입고부품정보
                       WHERE   A.DLR_CD = #{sDlrCd}  --딜러코드
                         AND   A.ETC_GR_DOC_NO = #{sEtcGrDocNo}  --기타입고번호
                         AND   A.CANC_YN != 'Y'
                         AND   A.CANC_DT IS NULL
                         AND   A.GR_STAT_CD != '03'  --취소
                        GROUP BY A.DLR_CD
                                ,A.ETC_GR_DOC_NO
                       ) B
                   ON A.DLR_CD        = B.DLR_CD
                  AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                 LEFT OUTER JOIN DMSDB.PT_0211T C
                    ON A.DLR_CD = C.DLR_CD
                   AND A.BP_CD  = C.BP_CD
                 LEFT OUTER JOIN (SELECT DLR_CD, DLR_NM FROM DMSDB.CM_0101T) D
                    ON A.BP_CD = D.DLR_CD
         WHERE A.DLR_CD             = #{sDlrCd}
           AND A.ETC_GR_DOC_NO      = #{sEtcGrDocNo}
    </select>

    <!-- 구매반품입고 헤더 정보를 조회한다. -->
    <select id="selectReceiveReturnEtcByKey" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveReturnEtcByKey] */
        SELECT
                A.DLR_CD                    --딜러코드
               ,A.ETC_GR_DOC_NO             --기타입고번호
               ,A.STAT_CD                   --상태코드
               ,A.REG_DT                    --일자
               ,A.BP_CD                     --거래처
               ,C.BP_NM                     --거래처명
               ,C.BP_TP                     --거래처유형
               ,A.MVT_TP                    --수불유형
               ,NVL(B.ITEM_CNT,0) AS ITEM_CNT
               ,NVL(B.ITEM_QTY,0) AS ITEM_QTY
               ,NVL(B.GR_TAX_DDCT_AMT,0) AS GR_TAX_DDCT_AMT
               ,NVL(B.GR_TOT_AMT,0) AS GR_TOT_AMT
               ,A.REMARK                    --비고
               ,A.REG_USR_ID                --등록자
               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   --등록자명
               ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
          FROM DMSDB.PT_0621T A    --기타입고헤더정보
                 LEFT OUTER JOIN
                      (
                      SELECT   A.DLR_CD
                              ,A.ETC_GR_DOC_NO
                              ,COUNT(*) AS ITEM_CNT
                              ,SUM(NVL(A.QTY,0)) AS ITEM_QTY
                              ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS GR_TAX_DDCT_AMT
                              ,SUM(NVL(A.AMT,0)) AS GR_TOT_AMT
                        FROM   DMSDB.PT_0622T A    --기타입고부품정보
                       WHERE   A.DLR_CD = #{sDlrCd}  --딜러코드
                         AND   A.ETC_GR_DOC_NO = #{sEtcGrDocNo}  --기타입고번호
                         AND   A.CANC_YN != 'Y'
                         AND   A.CANC_DT IS NULL
                         AND   A.GR_STAT_CD != '03'  --취소
                        GROUP BY A.DLR_CD
                                ,A.ETC_GR_DOC_NO
                       ) B
                   ON A.DLR_CD        = B.DLR_CD
                  AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                 LEFT OUTER JOIN DMSDB.PT_0211T C
                    ON A.DLR_CD = C.DLR_CD
                   AND A.BP_CD  = C.BP_CD
         WHERE A.DLR_CD             = #{sDlrCd}
           AND A.ETC_GR_DOC_NO      = #{sEtcGrDocNo}
           AND A.MVT_TP = '03' --반품인 기타입고건
    </select>

    <!-- 기타입고 부품 정보를 조회한다. -->
    <select id="selectReceiveEtcItemByKey" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcItemByKey] */
         SELECT
                A.DLR_CD                      --딜러코드
               ,A.ETC_GR_DOC_NO               --기타입고번호
               ,A.ETC_GR_DOC_LINE_NO          --기타입고라인번호
               ,A.ITEM_CD                     --품목코드
               ,C.ITEM_NM
               ,A.QTY
               ,A.PRC
               ,A.AMT
               ,A.LOC_CD
               ,A.UNIT_CD
               ,NVL(A.STRGE_CD, C.GR_STRGE_CD) AS STRGE_CD       --입고창고
               ,C.ITEM_DSTIN_CD
               ,D.AVLB_STOCK_QTY                --가용수량
               ,C.GR_STRGE_CD AS STD_STRGE_CD   --기준창고
               ,C.GR_STRGE_CD
               ,A.REF_DOC_NO
               ,A.REF_DOC_LINE_NO
               ,A.GR_REASON_CD
               ,CASE WHEN NVL(A.CANC_ID,'-999') = '-999' THEN 0 ELSE A.QTY END CANC_QTY
               ,A.RECEIVE_USR_ID
               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.RECEIVE_USR_ID) AS RECEIVE_USR_NM   --등록자명
               ,A.REG_DT AS GR_DT
               ,TO_CHAR(A.REG_DT, 'HH24:MI:SS') AS GR_TIME
               ,A.CANC_ID
               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.CANC_ID) AS CANC_USR_NM   --취소자명
               ,A.CANC_DT
               ,TO_CHAR(A.CANC_DT, 'HH24:MI:SS') AS CANC_TIME
               ,A.TAX_DDCT_PRC
               ,A.TAX_DDCT_AMT
               ,A.TAX_AMT
               ,A.DC_RATE
               ,A.MVT_DOC_YY_MM
               ,A.MVT_DOC_NO
               ,A.MVT_DOC_LINE_NO
               ,NVL(E.QTY, 0) AS RENT_QTY
               ,NVL(F.QTY, 0) AS RETURN_QTY
               ,A.GR_STAT_CD
               ,NVL(D.AVLB_STOCK_QTY,0) + NVL(D.RESV_STOCK_QTY,0) - NVL(D.BORROW_QTY,0) + NVL(D.RENT_QTY,0) AS STOCK_QTY
               ,NVL(D.BORROW_QTY,0) AS BORROW_QTY
               ,NVL(D.RENT_QTY,0) AS RENT_QTY
               ,NVL(D.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY
               ,NVL(G.MOVING_AVG_PRC,0) AS MOVING_AVG_PRC
               ,TO_CHAR(NVL(B.UPDT_DT,B.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
           FROM DMSDB.PT_0622T A    --기타입고품목정보
                INNER JOIN  DMSDB.PT_0621T B
                   ON A.DLR_CD        = B.DLR_CD
                  AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                INNER JOIN  DMSDB.PT_0201T C    --품목정보
                   ON A.DLR_CD  = C.DLR_CD
                  AND A.ITEM_CD = C.ITEM_CD
                LEFT OUTER JOIN  DMSDB.PT_0301T D    --재고정보
                   ON A.DLR_CD      = D.DLR_CD
                  AND A.STRGE_CD    = D.STRGE_CD
                  AND A.ITEM_CD     = D.ITEM_CD
                LEFT OUTER JOIN  DMSDB.PT_0612T E
                  ON A.DLR_CD              = E.DLR_CD
                 AND A.REF_DOC_NO          = E.ETC_GI_DOC_NO
                 AND A.REF_DOC_LINE_NO     = E.ETC_GI_DOC_LINE_NO
                LEFT OUTER JOIN
                                (
                                  SELECT   A.DLR_CD
                                          ,A.REF_DOC_NO
                                          ,A.REF_DOC_LINE_NO
                                          ,SUM(A.QTY) AS QTY
                                    FROM PT_0622T A
                                   WHERE A.DLR_CD = #{sDlrCd}
                                     AND A.REF_DOC_NO IS NOT NULL
                                  GROUP BY A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                ) F
                  ON A.DLR_CD = C.DLR_CD
                 AND A.ETC_GR_DOC_NO = F.REF_DOC_NO
                 AND A.ETC_GR_DOC_LINE_NO = F.REF_DOC_LINE_NO
                LEFT OUTER JOIN  DMSDB.PT_0312T G
                  ON A.DLR_CD              = G.DLR_CD
                 AND A.ETC_GR_DOC_NO       = G.REF_DOC_NO
                 AND A.ETC_GR_DOC_LINE_NO  = G.REF_DOC_LINE_NO
          WHERE A.DLR_CD            = #{sDlrCd}
            AND A.ETC_GR_DOC_NO     = #{sEtcGrDocNo}
            ORDER BY A.DLR_CD                      --딜러코드
                    ,A.ETC_GR_DOC_NO DESC               --기타입고번호
                    ,A.ETC_GR_DOC_LINE_NO          --기타입고라인번호
    </select>

    <!-- 반품용 기타입고 부품 정보를 조회한다. -->
    <select id="selectReceiveEtcReturnItemByKey" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcReturnItemByKey] */
         SELECT
                A.DLR_CD                      --딜러코드
               ,A.ETC_GR_DOC_NO               --기타입고번호
               ,A.ETC_GR_DOC_LINE_NO          --기타입고라인번호
               ,A.ITEM_CD                     --품목코드
               ,C.ITEM_NM
               ,A.QTY
               ,A.PRC
               ,A.AMT
               ,NVL(G.MOVING_AVG_PRC,0) AS MOVING_AVG_PRC
               ,NVL(ROUND(G.MOVING_AVG_PRC * A.QTY,2),0) AS MOVING_AVG_AMT
               ,A.LOC_CD
               ,A.UNIT_CD
               ,NVL(A.STRGE_CD, C.GR_STRGE_CD) AS STRGE_CD       --입고창고
               ,C.ITEM_DSTIN_CD
               ,D.AVLB_STOCK_QTY                --가용수량
               ,C.GR_STRGE_CD AS STD_STRGE_CD   --기준창고
               ,C.GR_STRGE_CD
               ,A.REF_DOC_NO
               ,A.REF_DOC_LINE_NO
               ,A.GR_REASON_CD
               ,CASE WHEN NVL(A.CANC_ID,'-999') = '-999' THEN 0 ELSE A.QTY END CANC_QTY
               ,A.RECEIVE_USR_ID
               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.RECEIVE_USR_ID) AS RECEIVE_USR_NM   --등록자명
               ,A.REG_DT AS GR_DT
               ,TO_CHAR(A.REG_DT, 'HH24:MI:SS') AS GR_TIME
               ,A.CANC_ID
               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.CANC_ID) AS CANC_USR_NM   --취소자명
               ,A.CANC_DT
               ,TO_CHAR(A.CANC_DT, 'HH24:MI:SS') AS CANC_TIME
               ,A.TAX_DDCT_PRC
               ,A.TAX_DDCT_AMT
               ,A.TAX_AMT
               ,A.DC_RATE
               ,A.MVT_DOC_YY_MM
               ,A.MVT_DOC_NO
               ,A.MVT_DOC_LINE_NO
               ,NVL(E.QTY, 0) AS RENT_QTY
               ,NVL(F.QTY, 0) AS RETURN_QTY
               ,A.GR_STAT_CD
               ,NVL(D.AVLB_STOCK_QTY,0) + NVL(D.RESV_STOCK_QTY,0) - NVL(D.BORROW_QTY,0) + NVL(D.RENT_QTY,0) AS STOCK_QTY
               ,NVL(D.BORROW_QTY,0) AS BORROW_QTY
               ,NVL(D.RENT_QTY,0) AS RENT_QTY
               ,NVL(D.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY
               ,NVL(A.DC_RATE,0) AS DC_RATE
               ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
           FROM DMSDB.PT_0622T A    --기타입고품목정보
                INNER JOIN  DMSDB.PT_0621T B
                   ON A.DLR_CD        = B.DLR_CD
                  AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                INNER JOIN  DMSDB.PT_0201T C    --품목정보
                   ON A.DLR_CD  = C.DLR_CD
                  AND A.ITEM_CD = C.ITEM_CD
                LEFT OUTER JOIN  DMSDB.PT_0301T D    --재고정보
                   ON A.DLR_CD      = D.DLR_CD
                  AND A.STRGE_CD    = D.STRGE_CD
                  AND A.ITEM_CD     = D.ITEM_CD
                LEFT OUTER JOIN  DMSDB.PT_0612T E
                  ON A.DLR_CD              = E.DLR_CD
                 AND A.REF_DOC_NO          = E.ETC_GI_DOC_NO
                 AND A.REF_DOC_LINE_NO     = E.ETC_GI_DOC_LINE_NO
                LEFT OUTER JOIN
                                (
                                  SELECT   A.DLR_CD
                                          ,A.REF_DOC_NO
                                          ,A.REF_DOC_LINE_NO
                                          ,SUM(A.QTY) AS QTY
                                    FROM PT_0622T A
                                   WHERE A.DLR_CD = #{sDlrCd}
                                     AND A.REF_DOC_NO IS NOT NULL
                                  GROUP BY A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                ) F
                  ON A.DLR_CD = C.DLR_CD
                 AND A.ETC_GR_DOC_NO = F.REF_DOC_NO
                 AND A.ETC_GR_DOC_LINE_NO = F.REF_DOC_LINE_NO
                LEFT OUTER JOIN PT_0208T G
                  ON A.DLR_CD      = G.DLR_CD
                 AND A.STRGE_CD    = G.STRGE_CD
                 AND A.ITEM_CD     = G.ITEM_CD
          WHERE A.DLR_CD            = #{sDlrCd}
            AND A.ETC_GR_DOC_NO     = #{sEtcGrDocNo}
            ORDER BY A.DLR_CD                      --딜러코드
                    ,A.ETC_GR_DOC_NO DESC               --기타입고번호
                    ,A.ETC_GR_DOC_LINE_NO          --기타입고라인번호
    </select>

    <!-- 반품용 기타입고문서 부품 정보를 조회한다. (이평가를 수불정보로 가져온다.)-->
    <select id="selectReceiveEtcReturnDocItemByKey" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcReturnDocItemByKey] */
         SELECT
                A.DLR_CD                      --딜러코드
               ,A.ETC_GR_DOC_NO               --기타입고번호
               ,A.ETC_GR_DOC_LINE_NO          --기타입고라인번호
               ,A.ITEM_CD                     --품목코드
               ,C.ITEM_NM
               ,A.QTY
               ,A.PRC
               ,A.AMT
               ,NVL(G.MOVING_AVG_PRC,0) AS MOVING_AVG_PRC
               ,NVL(ROUND(G.MOVING_AVG_PRC * A.QTY,2),0) AS MOVING_AVG_AMT
               ,A.LOC_CD
               ,A.UNIT_CD
               ,NVL(A.STRGE_CD, C.GR_STRGE_CD) AS STRGE_CD       --입고창고
               ,C.ITEM_DSTIN_CD
               ,D.AVLB_STOCK_QTY                --가용수량
               ,C.GR_STRGE_CD AS STD_STRGE_CD   --기준창고
               ,C.GR_STRGE_CD
               ,A.REF_DOC_NO
               ,A.REF_DOC_LINE_NO
               ,A.GR_REASON_CD
               ,CASE WHEN NVL(A.CANC_ID,'-999') = '-999' THEN 0 ELSE A.QTY END CANC_QTY
               ,A.RECEIVE_USR_ID
               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.RECEIVE_USR_ID) AS RECEIVE_USR_NM   --등록자명
               ,A.REG_DT AS GR_DT
               ,TO_CHAR(A.REG_DT, 'HH24:MI:SS') AS GR_TIME
               ,A.CANC_ID
               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.CANC_ID) AS CANC_USR_NM   --취소자명
               ,A.CANC_DT
               ,TO_CHAR(A.CANC_DT, 'HH24:MI:SS') AS CANC_TIME
               ,A.TAX_DDCT_PRC
               ,A.TAX_DDCT_AMT
               ,A.TAX_AMT
               ,A.DC_RATE
               ,A.MVT_DOC_YY_MM
               ,A.MVT_DOC_NO
               ,A.MVT_DOC_LINE_NO
               ,NVL(E.QTY, 0) AS RENT_QTY
               ,NVL(F.QTY, 0) AS RETURN_QTY
               ,A.GR_STAT_CD
               ,NVL(D.AVLB_STOCK_QTY,0) + NVL(D.RESV_STOCK_QTY,0) - NVL(D.BORROW_QTY,0) + NVL(D.RENT_QTY,0) AS STOCK_QTY
               ,NVL(D.BORROW_QTY,0) AS BORROW_QTY
               ,NVL(D.RENT_QTY,0) AS RENT_QTY
               ,NVL(D.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY
               ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
           FROM DMSDB.PT_0622T A    --기타입고품목정보
                INNER JOIN  DMSDB.PT_0621T B
                   ON A.DLR_CD        = B.DLR_CD
                  AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                INNER JOIN  DMSDB.PT_0201T C    --품목정보
                   ON A.DLR_CD  = C.DLR_CD
                  AND A.ITEM_CD = C.ITEM_CD
                LEFT OUTER JOIN  DMSDB.PT_0301T D    --재고정보
                   ON A.DLR_CD      = D.DLR_CD
                  AND A.STRGE_CD    = D.STRGE_CD
                  AND A.ITEM_CD     = D.ITEM_CD
                LEFT OUTER JOIN  DMSDB.PT_0612T E
                  ON A.DLR_CD              = E.DLR_CD
                 AND A.REF_DOC_NO          = E.ETC_GI_DOC_NO
                 AND A.REF_DOC_LINE_NO     = E.ETC_GI_DOC_LINE_NO
                LEFT OUTER JOIN
                                (
                                  SELECT   A.DLR_CD
                                          ,A.REF_DOC_NO
                                          ,A.REF_DOC_LINE_NO
                                          ,SUM(A.QTY) AS QTY
                                    FROM PT_0622T A
                                   WHERE A.DLR_CD = #{sDlrCd}
                                     AND A.REF_DOC_NO IS NOT NULL
                                  GROUP BY A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                ) F
                  ON A.DLR_CD = C.DLR_CD
                 AND A.ETC_GR_DOC_NO = F.REF_DOC_NO
                 AND A.ETC_GR_DOC_LINE_NO = F.REF_DOC_LINE_NO
                LEFT OUTER JOIN PT_0312T G
                  ON A.DLR_CD      = G.DLR_CD
                 AND A.ETC_GR_DOC_NO = G.REF_DOC_NO
                 AND A.ETC_GR_DOC_LINE_NO = G.REF_DOC_LINE_NO
          WHERE A.DLR_CD            = #{sDlrCd}
            AND A.ETC_GR_DOC_NO     = #{sEtcGrDocNo}
            ORDER BY A.DLR_CD                      --딜러코드
                    ,A.ETC_GR_DOC_NO DESC               --기타입고번호
                    ,A.ETC_GR_DOC_LINE_NO          --기타입고라인번호
    </select>

    <!-- 기타입고 리스트정보를 조회한다. -->
    <select id="selectReceiveEtcList" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcList] */
       SELECT    A.*
         FROM
             (
              SELECT    ROWNUM AS RNUM
                       ,T1.*
                FROM
                     (
                         SELECT A.DLR_CD                    --딜러코드
                               ,A.STAT_CD               --상태코드
                               ,A.REG_DT                    --일자
                               ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
                          FROM DMSDB.PT_0621T A    --기타입고헤더정보
                         WHERE A.DLR_CD = #{sDlrCd}  --딜러코드
                           <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                               AND A.ETC_GR_DOC_NO    = #{sEtcGrDocNo}
                           </if>        --기타입고번호
                           <if test='sStatCd  != null and !sStatCd.isEmpty'>
                               AND A.STAT_CD IN
                               <foreach item="item" index="index" collection="sStatCd" open="(" separator="," close=")">
                                   #{item}
                               </foreach>
                           </if>        --기타입고상태코드
                           <if test='sRegDtFr != null'>
                               AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                           </if>
                           <if test='sRegDtTo != null'>
                               AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                           </if>
                           AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                         ORDER BY
                         <choose>
                             <when test='sort != null'>
                                 <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                     <choose>
                                         <when test='item.field == "etcGrDocNo"'> A.ETC_GR_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "statCd"'> A.STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "regDt"'> A.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <otherwise>
                                           A.DLR_CD ASC
                                          ,A.ETC_GR_DOC_NO DESC
                                         </otherwise>
                                     </choose>
                                 </foreach>
                             </when>
                             <otherwise>
                               A.DLR_CD ASC
                              ,A.ETC_GR_DOC_NO DESC
                             </otherwise>
                         </choose>
                     ) T1
                  ) A
             <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
             </where>
    </select>

    <!-- 기타입고 리스트정보를 조회한다. -->
    <select id="selectReceiveEtcListCnt" parameterType="ReceiveEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcListCnt] */
             SELECT COUNT(*)
              FROM DMSDB.PT_0621T A    --기타입고헤더정보
             WHERE A.DLR_CD             = #{sDlrCd}  --딜러코드
               <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                   AND A.ETC_GR_DOC_NO    = #{sEtcGrDocNo}
               </if>        --기타입고번호
               <if test='sStatCd != null and !sStatCd.isEmpty'>
                   AND A.STAT_CD IN
                   <foreach item="item" index="index" collection="sStatCd" open="(" separator="," close=")">
                       #{item}
                   </foreach>
               </if>        --기타입고상태코드
               <if test='sRegDtFr != null'>
                    AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
               </if>
               <if test='sRegDtTo != null'>
                    AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
               </if>
               AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
    </select>

       <!-- 기타입고 정보 Max 라인번호를 조회한다. -->
    <select id="selectReceiveEtcMaxLineNo" parameterType="ReceiveEtcVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcMaxLineNo] */
        SELECT NVL(max(A.ETC_GR_DOC_LINE_NO),0) + 1
          FROM DMSDB.PT_0622T A    --기타입고부품정보
         WHERE A.DLR_CD             = #{dlrCd}                 --딜러코드
           AND A.ETC_GR_DOC_NO      = #{etcGrDocNo}
    </select>

    <!-- 기타입고(차환부품)팝업 부품 정보를 조회한다. -->
    <select id="selectReceiveEtcPop" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcPop] */
         SELECT  A.DLR_CD
                ,A.ETC_GR_DOC_NO
                ,A.ETC_GR_DOC_LINE_NO
                ,A.PLT_CD
                ,A.BP_CD
                ,A.BP_NM
                ,A.ITEM_CD
                ,A.ITEM_NM
                ,A.BORROW_QTY
                ,A.RETURN_QTY
                ,(A.BORROW_QTY - A.RETURN_QTY) AS REMAIN_QTY
                ,A.UNIT_CD
                ,A.STRGE_CD
                ,A.LOC_CD
                ,A.PRC
                ,A.AMT
                ,A.DC_RATE
                ,A.TAX_DDCT_PRC
                ,A.TAX_AMT
                ,A.TAX_DDCT_AMT
                ,A.AVLB_STOCK_QTY
                ,A.MOVING_AVG_PRC
           FROM
               (
                SELECT   A.DLR_CD
                        ,A.ETC_GR_DOC_NO
                        ,B.ETC_GR_DOC_LINE_NO
                        ,A.PLT_CD
                        ,A.BP_CD
                        ,E.BP_NM
                        ,B.ITEM_CD
                        ,C.ITEM_NM
                        ,B.QTY AS BORROW_QTY
                        ,NVL(F.QTY, 0) AS RETURN_QTY
                        ,B.UNIT_CD
                        ,B.STRGE_CD
                        ,B.LOC_CD
                        ,B.PRC
                        ,B.AMT
                        ,B.DC_RATE
                        ,B.TAX_DDCT_PRC
                        ,B.TAX_AMT
                        ,B.TAX_DDCT_AMT
                        ,D.AVLB_STOCK_QTY
                        ,G.MOVING_AVG_PRC
                  FROM   PT_0621T A
                           INNER JOIN PT_0622T B
                             ON A.DLR_CD = B.DLR_CD
                            AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                           INNER JOIN  DMSDB.PT_0201T C              --품목정보
                             ON B.DLR_CD  = C.DLR_CD
                            AND B.ITEM_CD = C.ITEM_CD
                           LEFT OUTER JOIN  DMSDB.PT_0301T D    --재고정보
                              ON A.DLR_CD      = D.DLR_CD
                             AND B.STRGE_CD    = D.STRGE_CD
                             AND B.ITEM_CD     = D.ITEM_CD
                           LEFT OUTER JOIN DMSDB.PT_0211T E
                              ON A.DLR_CD = E.DLR_CD
                             AND A.BP_CD  = E.BP_CD
                           LEFT OUTER JOIN
                                (
                                  SELECT   A.DLR_CD
                                          ,A.REF_DOC_NO
                                          ,A.REF_DOC_LINE_NO
                                          ,SUM(A.QTY) AS QTY
                                    FROM PT_0612T A
                                   WHERE A.DLR_CD = #{sDlrCd}
                                     AND A.REF_DOC_NO IS NOT NULL
                                  GROUP BY A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                ) F
                              ON A.DLR_CD = F.DLR_CD
                             AND B.ETC_GR_DOC_NO = F.REF_DOC_NO
                             AND B.ETC_GR_DOC_LINE_NO = F.REF_DOC_LINE_NO
                           LEFT OUTER JOIN  DMSDB.PT_0208T G    --원가정보
                              ON A.DLR_CD      = G.DLR_CD
                             AND B.STRGE_CD    = G.STRGE_CD
                             AND B.ITEM_CD     = G.ITEM_CD
                 WHERE   A.MVT_TP   = #{sMvtTp}
                   AND   A.BP_CD    = #{sBpCd}
                   AND   NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                   AND   B.CANC_YN != 'Y'
                   <if test='sRegDtFr != null'>
                        AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                   </if>
                   <if test='sRegDtTo != null'>
                        AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                   </if>
                 ) A
           WHERE   A.BORROW_QTY <![CDATA[>]]> A.RETURN_QTY
           ORDER BY  A.DLR_CD
                    ,A.ETC_GR_DOC_NO DESC
                    ,A.ETC_GR_DOC_LINE_NO
         </select>


    <!-- 기타입고(차환부품)팝업 부품 정보를 조회한다. -->
    <select id="selectReceiveEtcPopCnt" parameterType="ReceiveEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcPopCnt] */
        SELECT   COUNT(*)
          FROM
               (
                SELECT   A.DLR_CD
                        ,A.ETC_GR_DOC_NO
                        ,B.ETC_GR_DOC_LINE_NO
                        ,A.PLT_CD
                        ,A.BP_CD
                        ,B.ITEM_CD
                        ,B.QTY AS BORROW_QTY
                        ,B.QTY
                        ,NVL(E.QTY, 0) AS RETURN_QTY
                        ,B.UNIT_CD
                        ,B.STRGE_CD
                        ,B.LOC_CD
                        ,B.PRC
                        ,B.AMT
                  FROM   PT_0621T A
                           INNER JOIN PT_0622T B
                             ON A.DLR_CD = B.DLR_CD
                            AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                           INNER JOIN  DMSDB.PT_0201T C              --품목정보
                             ON B.DLR_CD  = C.DLR_CD
                            AND B.ITEM_CD = C.ITEM_CD
                           LEFT OUTER JOIN DMSDB.PT_0211T D
                             ON A.DLR_CD = D.DLR_CD
                            AND A.BP_CD  = D.BP_CD
                           LEFT OUTER JOIN
                                (
                                  SELECT   A.DLR_CD
                                          ,A.REF_DOC_NO
                                          ,A.REF_DOC_LINE_NO
                                          ,SUM(A.QTY) AS QTY
                                    FROM PT_0612T A
                                   WHERE A.DLR_CD = #{sDlrCd}
                                     AND A.REF_DOC_NO IS NOT NULL
                                  GROUP BY A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                ) E
                              ON A.DLR_CD = E.DLR_CD
                             AND B.ETC_GR_DOC_NO = E.REF_DOC_NO
                             AND B.ETC_GR_DOC_LINE_NO = E.REF_DOC_LINE_NO
                 WHERE   A.MVT_TP = #{sMvtTp}
                   AND   A.BP_CD    = #{sBpCd}
                   AND   B.CANC_YN != 'Y'
                   AND   NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                   <if test='sRegDtFr != null'>
                        AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                   </if>
                   <if test='sRegDtTo != null'>
                        AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                   </if>
                 ) A
         WHERE   A.BORROW_QTY <![CDATA[>]]> A.RETURN_QTY
    </select>

     <!-- 기타입고(차환부품) 부품 정보를 조회한다. -->
    <select id="selectBorrowItemByKey" parameterType="ReceiveEtcSearchVO" resultType="IssueEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectBorrowItemByKey] */
         SELECT  A.DLR_CD
                ,A.ETC_GR_DOC_NO AS REF_DOC_NO
                ,A.ETC_GR_DOC_LINE_NO AS REF_DOC_LINE_NO
                ,A.PLT_CD
                ,A.BP_CD
                ,A.BP_NM
                ,A.ITEM_CD
                ,A.ITEM_NM
                ,A.BORROW_QTY
                ,(A.BORROW_QTY - A.RETURN_QTY) AS QTY
                ,(A.BORROW_QTY - A.RETURN_QTY) AS REMAIN_QTY
                ,A.RETURN_QTY
                ,A.UNIT_CD
                ,A.STRGE_CD
                ,NVL(A.LOC_CD,' ') AS LOC_CD
                ,A.PRC
                ,A.AMT
                ,A.DC_RATE
                ,A.TAX_DDCT_PRC
                ,A.TAX_AMT
                ,A.TAX_DDCT_AMT
                ,A.AVLB_STOCK_QTY
                ,A.MOVING_AVG_PRC
           FROM
               (
                SELECT   A.DLR_CD
                        ,A.ETC_GR_DOC_NO
                        ,B.ETC_GR_DOC_LINE_NO
                        ,A.PLT_CD
                        ,A.BP_CD
                        ,E.BP_NM
                        ,B.ITEM_CD
                        ,C.ITEM_NM
                        ,B.QTY AS BORROW_QTY
                        ,NVL(F.QTY, 0) AS RETURN_QTY
                        ,B.UNIT_CD
                        ,B.STRGE_CD
                        ,B.LOC_CD
                        ,B.PRC
                        ,B.AMT
                        ,B.DC_RATE
                        ,B.TAX_DDCT_PRC
                        ,B.TAX_AMT
                        ,B.TAX_DDCT_AMT
                        ,D.AVLB_STOCK_QTY
                        ,G.MOVING_AVG_PRC
                  FROM   PT_0621T A
                           INNER JOIN PT_0622T B
                             ON A.DLR_CD = B.DLR_CD
                            AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                           INNER JOIN  DMSDB.PT_0201T C              --품목정보
                             ON B.DLR_CD  = C.DLR_CD
                            AND B.ITEM_CD = C.ITEM_CD
                           LEFT OUTER JOIN  DMSDB.PT_0301T D    --재고정보
                             ON A.DLR_CD      = D.DLR_CD
                            AND B.STRGE_CD    = D.STRGE_CD
                            AND B.ITEM_CD     = D.ITEM_CD
                           LEFT OUTER JOIN DMSDB.PT_0211T E
                              ON A.DLR_CD = E.DLR_CD
                             AND A.BP_CD  = E.BP_CD
                           LEFT OUTER JOIN
                                (
                                  SELECT   A.DLR_CD
                                          ,A.REF_DOC_NO
                                          ,A.REF_DOC_LINE_NO
                                          ,SUM(A.QTY) AS QTY
                                    FROM PT_0612T A
                                   WHERE A.DLR_CD = #{sDlrCd}
                                     AND A.REF_DOC_NO IS NOT NULL
                                  GROUP BY A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                ) F
                              ON A.DLR_CD = F.DLR_CD
                             AND B.ETC_GR_DOC_NO = F.REF_DOC_NO
                             AND B.ETC_GR_DOC_LINE_NO = F.REF_DOC_LINE_NO
                           LEFT OUTER JOIN  DMSDB.PT_0208T G    --원가정보
                              ON A.DLR_CD      = G.DLR_CD
                             AND B.STRGE_CD    = G.STRGE_CD
                             AND B.ITEM_CD     = G.ITEM_CD
                 WHERE   A.DLR_CD        = #{sDlrCd}
                   AND   A.ETC_GR_DOC_NO = #{sEtcGrDocNo}
                   AND   B.CANC_YN != 'Y'
                 ) A
           ORDER BY  A.DLR_CD
                    ,A.ETC_GR_DOC_NO DESC
                    ,A.ETC_GR_DOC_LINE_NO
         </select>

    <!-- 기타입고 리스트정보를 조회한다. -->
    <select id="selectReceiveEtcsByCondition" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcsByCondition] */
          SELECT    A.*
            FROM
                 (
              SELECT    ROWNUM AS RNUM
                       ,T1.*
                FROM
                     (
                         SELECT A.DLR_CD                <!-- 딜러코드 -->
                               ,A.MVT_TP                <!-- 수불유형 -->
                               ,A.ETC_GR_DOC_NO         <!-- 기타입고문서번호 -->
                               ,A.BP_CD                 <!-- 거래처코드 -->
                               ,DECODE(C.BP_NM,NULL,E.DLR_NM,C.BP_NM) AS BP_NM                 <!-- 거래처 -->
                               ,A.STAT_CD               <!-- 상태코드 -->
                               ,A.REG_DT                <!-- 일자 -->
                               ,A.REG_USR_ID            <!-- 등록인 -->
                               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   <!-- 등록자명 -->
                               ,A.REMARK                <!-- 비고 -->
                               ,NVL(B.ITEM_CNT,0) AS ITEM_CNT
                               ,NVL(B.ITEM_QTY,0) AS ITEM_QTY
                               ,NVL(B.GR_TOT_AMT,0) AS GR_TOT_AMT
                               ,NVL(B.GR_TAX_DDCT_AMT,0) AS GR_TAX_DDCT_AMT
                               ,NVL(D.RETURN_ITEM_CNT,0) AS RETURN_ITEM_CNT
                               ,NVL(D.RETURN_ITEM_QTY,0) AS RETURN_ITEM_QTY
                               ,NVL(D.RETURN_TOT_AMT,0) AS RETURN_TOT_AMT
                               ,NVL(D.RETURN_TAX_DDCT_AMT,0) AS RETURN_TAX_DDCT_AMT
                               ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
                          FROM DMSDB.PT_0621T A    <!-- 기타입고헤더정보 -->
                                 LEFT OUTER JOIN
                                      (
                                      SELECT   A.DLR_CD
                                              ,A.ETC_GR_DOC_NO
                                              ,COUNT(*) AS ITEM_CNT
                                              ,SUM(NVL(A.QTY,0)) AS ITEM_QTY
                                              ,SUM(NVL(A.AMT,0)) AS GR_TOT_AMT
                                              ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS GR_TAX_DDCT_AMT
                                        FROM   DMSDB.PT_0622T A    <!-- 기타입고부품정보 -->
                                                  INNER JOIN DMSDB.PT_0621T B
                                                     ON A.DLR_CD = B.DLR_CD
                                                    AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                       WHERE   A.DLR_CD = #{sDlrCd}  <!-- 딜러코드 -->
                                         <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                             AND A.ETC_GR_DOC_NO LIKE '%'|| #{sEtcGrDocNo} ||'%'
                                         </if>        <!-- 기타입고번호 -->
                                         AND   A.CANC_YN != 'Y'
                                         AND   A.CANC_DT IS NULL
                                         AND   A.GR_STAT_CD != '03'  <!-- 취소 -->
                                         AND   NVL(B.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                                        GROUP BY A.DLR_CD, A.ETC_GR_DOC_NO
                                       ) B
                                    ON A.DLR_CD = B.DLR_CD
                                   AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                 LEFT OUTER JOIN DMSDB.PT_0211T C
                                        ON A.DLR_CD = C.DLR_CD
                                       AND A.BP_CD = C.BP_CD
                                 LEFT OUTER JOIN
                                      (
                                      SELECT   A.DLR_CD
                                              ,A.REF_DOC_NO
                                              ,COUNT(*) AS RETURN_ITEM_CNT
                                              ,SUM(NVL(A.QTY,0)) AS RETURN_ITEM_QTY
                                              ,SUM(NVL(A.AMT,0)) AS RETURN_TOT_AMT
                                              ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS RETURN_TAX_DDCT_AMT
                                        FROM   DMSDB.PT_0612T A    <!-- 기타출고부품정보 -->
                                       WHERE   A.DLR_CD = #{sDlrCd}  <!-- 딜러코드 -->
                                       <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                           AND A.REF_DOC_NO LIKE '%'|| #{sEtcGrDocNo} ||'%'
                                       </if>        <!-- 기타입고번호 -->
                                         AND A.CANC_YN != 'Y'
                                         AND A.CANC_DT IS NULL
                                         AND A.GI_STAT_CD != '03'  <!-- 취소 -->
                                        GROUP BY A.DLR_CD, A.REF_DOC_NO
                                       ) D
                                    ON A.DLR_CD = D.DLR_CD
                                   AND A.ETC_GR_DOC_NO = D.REF_DOC_NO
                                 LEFT OUTER JOIN
                                        (
                                        SELECT DLR_CD, DLR_NM
                                        FROM DMSDB.CM_0101T
                                        ) E
                                    ON A.BP_CD = E.DLR_CD
                         WHERE A.DLR_CD   = #{sDlrCd}  <!-- 딜러코드 -->
                           AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                           <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                               AND A.ETC_GR_DOC_NO LIKE '%'|| #{sEtcGrDocNo} ||'%'
                           </if>  <!-- 기타입고번호 -->
                           <if test='sMvtTp != null and sMvtTp != ""'>
                               AND A.MVT_TP = #{sMvtTp}
                           </if>  <!-- 수불유형 -->
                           <if test='sBpCd != null and sBpCd != ""'>
                               AND A.BP_CD = #{sBpCd}
                           </if>  <!-- 업체코드 -->
                           <if test='sBpNm != null and sBpCd != ""'>
                               AND C.BP_NM LIKE '%'||#{sBpNm}||'%'
                           </if>  <!-- 업체코드 -->
                           <if test='sStatCd != null and sStatCd != ""'>
                               AND A.STAT_CD = #{sStatCd}
                           </if>  <!-- 상태 -->
                           <if test='sRegUsrId != null and sRegUsrId != ""'>
                               AND A.REG_USR_ID LIKE '%'|| #{sRegUsrId} ||'%'
                           </if>  <!-- 등록자 -->
                           <if test='sRemark != null and sRemark != ""'>
                               AND A.REMARK LIKE '%'|| #{sRemark} ||'%'
                           </if>  <!-- 비고 -->
                           <if test='sRegDtFr != null'>
                               AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                           </if>
                           <if test='sRegDtTo != null'>
                               AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                           </if>
                           <if test='sBpTp == "ETC"'>
                               AND C.BP_TP != '01'
                           </if>
                           <if test='sInitDataYn != null and sInitDataYn   != ""'>
                             <choose>
                                 <when test='sInitDataYn == "Y"'>  --기초입고(V2)
                                     AND NVL(A.REMARK,'-999') = '-INIT-'
                                 </when>
                                 <when test='sInitDataYn == "N"'>
                                     AND NVL(A.REMARK,'-999') != '-INIT-'
                                 </when>
                             </choose>
                          </if>
                         ORDER BY
                         <choose>
                             <when test='sort != null'>
                                 <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                     <choose>
                                         <when test='item.field == "etcGrDocNo"'> A.ETC_GR_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "statCd"'> A.STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "regDt"'> A.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <otherwise>
                                           A.DLR_CD ASC, A.ETC_GR_DOC_NO DESC
                                         </otherwise>
                                     </choose>
                                 </foreach>
                             </when>
                             <otherwise>
                               A.DLR_CD ASC, A.ETC_GR_DOC_NO DESC
                             </otherwise>
                         </choose>
                     ) T1
                     WHERE 1=1
                     <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                         AND T1.REG_USR_NM LIKE '%'|| #{sRegUsrNm} ||'%'
                     </if>  <!-- 등록자 -->
                  ) A
             <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
             </where>
    </select>

    <!-- 기타입고 리스트정보를 조회한다. -->
    <select id="selectReceiveEtcsByConditionCnt" parameterType="ReceiveEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcsByConditionCnt] */
          SELECT COUNT(*)
            FROM
                 (
                     SELECT A.DLR_CD                <!-- 딜러코드 -->
                           ,A.MVT_TP                <!-- 수불유형 -->
                           ,A.ETC_GR_DOC_NO         <!-- 기타입고문서번호 -->
                           ,A.BP_CD                 <!-- 거래처코드 -->
                           ,C.BP_NM                 <!-- 거래처 -->
                           ,A.STAT_CD               <!-- 상태코드 -->
                           ,A.REG_DT                <!-- 일자 -->
                           ,A.REG_USR_ID            <!-- 등록인 -->
                           ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   <!-- 등록자명 -->
                           ,A.REMARK                <!-- 비고 -->
                           ,NVL(B.ITEM_CNT,0) AS ITEM_CNT
                           ,NVL(B.ITEM_QTY,0) AS ITEM_QTY
                           ,NVL(B.GR_TOT_AMT,0) AS GR_TOT_AMT
                           ,NVL(B.GR_TAX_DDCT_AMT,0) AS GR_TAX_DDCT_AMT
                           ,NVL(D.RETURN_ITEM_CNT,0) AS RETURN_ITEM_CNT
                           ,NVL(D.RETURN_ITEM_QTY,0) AS RETURN_ITEM_QTY
                           ,NVL(D.RETURN_TOT_AMT,0) AS RETURN_TOT_AMT
                           ,NVL(D.RETURN_TAX_DDCT_AMT,0) AS RETURN_TAX_DDCT_AMT
                           ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
                      FROM DMSDB.PT_0621T A    <!-- 기타입고헤더정보 -->
                             LEFT OUTER JOIN
                                  (
                                  SELECT   A.DLR_CD
                                          ,A.ETC_GR_DOC_NO
                                          ,COUNT(*) AS ITEM_CNT
                                          ,SUM(NVL(A.QTY,0)) AS ITEM_QTY
                                          ,SUM(NVL(A.AMT,0)) AS GR_TOT_AMT
                                          ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS GR_TAX_DDCT_AMT
                                    FROM   DMSDB.PT_0622T A    <!-- 기타입고부품정보 -->
                                              INNER JOIN DMSDB.PT_0621T B
                                                 ON A.DLR_CD = B.DLR_CD
                                                AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                   WHERE   A.DLR_CD = #{sDlrCd}  <!-- 딜러코드 -->
                                     <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                         AND A.ETC_GR_DOC_NO LIKE '%'|| #{sEtcGrDocNo} ||'%'
                                     </if>        --기타입고번호
                                     AND   A.CANC_YN != 'Y'
                                     AND   A.CANC_DT IS NULL
                                     AND   A.GR_STAT_CD != '03'  <!-- 취소 -->
                                     AND   NVL(B.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                                    GROUP BY A.DLR_CD
                                            ,A.ETC_GR_DOC_NO
                                   ) B
                                ON A.DLR_CD = B.DLR_CD
                               AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                             LEFT OUTER JOIN DMSDB.PT_0211T C
                                    ON A.DLR_CD = C.DLR_CD
                                   AND A.BP_CD  = C.BP_CD
                             LEFT OUTER JOIN
                                  (
                                  SELECT   A.DLR_CD
                                          ,A.REF_DOC_NO
                                          ,COUNT(*) AS RETURN_ITEM_CNT
                                          ,SUM(NVL(A.QTY,0)) AS RETURN_ITEM_QTY
                                          ,SUM(NVL(A.AMT,0)) AS RETURN_TOT_AMT
                                          ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS RETURN_TAX_DDCT_AMT
                                    FROM   DMSDB.PT_0612T A    <!-- 기타출고부품정보 -->
                                   WHERE   A.DLR_CD = #{sDlrCd}  <!-- 딜러코드 -->
                                   <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                       AND A.REF_DOC_NO LIKE '%'|| #{sEtcGrDocNo} ||'%'
                                   </if>        --기타입고번호
                                     AND   A.CANC_YN != 'Y'
                                     AND   A.CANC_DT IS NULL
                                     AND   A.GI_STAT_CD != '03'  <!-- 취소 -->
                                    GROUP BY A.DLR_CD
                                            ,A.REF_DOC_NO
                                   ) D
                                ON A.DLR_CD = D.DLR_CD
                               AND A.ETC_GR_DOC_NO = D.REF_DOC_NO
                     WHERE A.DLR_CD   = #{sDlrCd}  <!-- 딜러코드 -->
                       AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                       <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                           AND A.ETC_GR_DOC_NO LIKE '%'|| #{sEtcGrDocNo} ||'%'
                       </if>  <!-- 기타입고번호 -->
                       <if test='sMvtTp != null and sMvtTp != ""'>
                           AND A.MVT_TP = #{sMvtTp}
                       </if>  <!-- 수불유형 -->
                       <if test='sBpCd != null and sBpCd != ""'>
                           AND A.BP_CD = #{sBpCd}
                       </if>  <!-- 업체코드 -->
                       <if test='sBpNm != null and sBpCd != ""'>
                           AND C.BP_NM LIKE '%'||#{sBpNm}||'%'
                       </if>  <!-- 업체코드 -->
                       <if test='sStatCd != null and sStatCd != ""'>
                           AND A.STAT_CD = #{sStatCd}
                       </if>  <!-- 상태 -->
                       <if test='sRegDtFr != null'>
                           AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                       </if>
                       <if test='sRegDtTo != null'>
                           AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                       </if>
                       <if test='sBpTp == "ETC"'>
                           AND C.BP_TP != '01'
                       </if>
                       <if test='sRemark != null and sRemark != ""'>
                           AND A.REMARK LIKE '%'|| #{sRemark} ||'%'
                       </if>  <!-- 비고 -->
                       <if test='sRegUsrId != null and sRegUsrId != ""'>
                           AND A.REG_USR_ID LIKE '%'|| #{sRegUsrId} ||'%'
                       </if>  <!-- 등록자 -->
                       <if test='sInitDataYn != null and sInitDataYn   != ""'>
                         <choose>
                             <when test='sInitDataYn == "Y"'>  <!-- 기초입고(V2) -->
                                 AND NVL(A.REMARK,'-999') = '-INIT-'
                             </when>
                             <when test='sInitDataYn == "N"'>
                                 AND NVL(A.REMARK,'-999') != '-INIT-'
                             </when>
                         </choose>
                      </if>
                 ) T1
             WHERE 1=1
             <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                 AND T1.REG_USR_NM LIKE '%'|| #{sRegUsrNm} ||'%'    <!-- 등록자 -->
             </if>
    </select>

    <!-- 기타입고 리스트정보(반품대상)를 조회한다. -->
    <select id="selectReceiveEtcForReturnsByCondition" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcForReturnsByCondition] */
          SELECT    A.*
            FROM
                 (
              SELECT    ROWNUM AS RNUM
                       ,T1.*
                FROM
                     (
                         SELECT A.DLR_CD                --딜러코드
                               ,A.MVT_TP                --수불유형
                               ,A.ETC_GR_DOC_NO         --기타입고문서번호
                               ,A.BP_CD                 --거래처코드
                               ,C.BP_NM                 --거래처
                               ,A.STAT_CD               --상태코드
                               ,A.REG_DT                --일자
                               ,A.REG_USR_ID            --등록인
                               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   --등록자명
                               ,A.REMARK                --비고
                               ,NVL(B.ITEM_CNT,0) AS ITEM_CNT
                               ,NVL(B.ITEM_QTY,0) AS ITEM_QTY
                               ,NVL(B.GR_TOT_AMT,0) AS GR_TOT_AMT
                               ,NVL(B.GR_TAX_DDCT_AMT,0) AS GR_TAX_DDCT_AMT
                               ,NVL(D.RETURN_ITEM_CNT,0) AS RETURN_ITEM_CNT
                               ,NVL(D.RETURN_ITEM_QTY,0) AS RETURN_ITEM_QTY
                               ,NVL(D.RETURN_TOT_AMT,0) AS RETURN_TOT_AMT
                               ,NVL(D.RETURN_TAX_DDCT_AMT,0) AS RETURN_TAX_DDCT_AMT
                               ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
                          FROM DMSDB.PT_0621T A    --기타입고헤더정보
                                 LEFT OUTER JOIN
                                      (
                                      SELECT   A.DLR_CD
                                              ,A.ETC_GR_DOC_NO
                                              ,COUNT(*) AS ITEM_CNT
                                              ,SUM(NVL(A.QTY,0)) AS ITEM_QTY
                                              ,SUM(NVL(A.AMT,0)) AS GR_TOT_AMT
                                              ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS GR_TAX_DDCT_AMT
                                        FROM   DMSDB.PT_0622T A    --기타입고부품정보
                                                  INNER JOIN DMSDB.PT_0621T B
                                                     ON A.DLR_CD = B.DLR_CD
                                                    AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                       WHERE   A.DLR_CD = #{sDlrCd}  --딜러코드
                                         <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                             AND A.ETC_GR_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                                         </if>        --기타입고번호
                                         AND   A.CANC_YN != 'Y'
                                         AND   A.CANC_DT IS NULL
                                         AND   A.GR_STAT_CD != '03'  --취소
                                         AND   NVL(B.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                                        GROUP BY A.DLR_CD
                                                ,A.ETC_GR_DOC_NO
                                       ) B
                                    ON A.DLR_CD = B.DLR_CD
                                   AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                 LEFT OUTER JOIN DMSDB.PT_0211T C
                                        ON A.DLR_CD = C.DLR_CD
                                       AND A.BP_CD  = C.BP_CD
                                 LEFT OUTER JOIN
                                      (
                                      SELECT   A.DLR_CD
                                              ,A.REF_DOC_NO
                                              ,COUNT(*) AS RETURN_ITEM_CNT
                                              ,SUM(NVL(A.QTY,0)) AS RETURN_ITEM_QTY
                                              ,SUM(NVL(A.AMT,0)) AS RETURN_TOT_AMT
                                              ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS RETURN_TAX_DDCT_AMT
                                        FROM   DMSDB.PT_0622T A    --반품입고부품정보
                                       WHERE   A.DLR_CD = #{sDlrCd}  --딜러코드
                                       <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                           AND A.REF_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                                       </if>        --기타입고번호
                                         AND   A.CANC_YN != 'Y'
                                         AND   A.CANC_DT IS NULL
                                         AND   A.GR_STAT_CD != '03'  --취소
                                                --기타입고번호
                                        GROUP BY A.DLR_CD
                                                ,A.REF_DOC_NO
                                       ) D
                                    ON A.DLR_CD = D.DLR_CD
                                   AND A.ETC_GR_DOC_NO = D.REF_DOC_NO
                         WHERE A.DLR_CD   = #{sDlrCd}  --딜러코드
                           AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                           <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                               AND A.ETC_GR_DOC_NO   like '%'|| #{sEtcGrDocNo} ||'%'
                           </if>  --기타입고번호
                           <if test='sMvtTp != null and sMvtTp != ""'>
                               AND A.MVT_TP = #{sMvtTp}
                           </if>  --수불유형
                           <if test='sBpCd != null and sBpCd != ""'>
                               AND A.BP_CD = #{sBpCd}
                           </if>  --업체코드
                           <if test='sBpNm != null and sBpCd != ""'>
                               AND C.BP_NM like '%'||#{sBpNm}||'%'
                           </if>  --업체코드
                           <if test='sStatCd != null and sStatCd != ""'>
                               AND A.STAT_CD = #{sStatCd}
                           </if>  --상태
                           <if test='sRegUsrId != null and sRegUsrId != ""'>
                               AND A.REG_USR_ID like '%'|| #{sRegUsrId} ||'%'
                           </if>  --등록자
                           <if test='sRemark != null and sRemark != ""'>
                               AND A.REMARK like '%'|| #{sRemark} ||'%'
                           </if>  --비고
                           <if test='sRegDtFr != null'>
                               AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                           </if>
                           <if test='sRegDtTo != null'>
                               AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                           </if>
                           <if test='sBpTp == "ETC"'>
                               AND C.BP_TP != '01'
                           </if>
                         ORDER BY
                         <choose>
                             <when test='sort != null'>
                                 <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                     <choose>
                                         <when test='item.field == "etcGrDocNo"'> A.ETC_GR_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "statCd"'> A.STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "regDt"'> A.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <otherwise>
                                           A.DLR_CD ASC
                                          ,A.ETC_GR_DOC_NO DESC
                                         </otherwise>
                                     </choose>
                                 </foreach>
                             </when>
                             <otherwise>
                               A.DLR_CD ASC
                              ,A.ETC_GR_DOC_NO DESC
                             </otherwise>
                         </choose>
                     ) T1
                     WHERE 1=1
                     <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                         AND T1.REG_USR_NM like '%'|| #{sRegUsrNm} ||'%'
                     </if>  --등록자
                     AND T1.ITEM_QTY != T1.RETURN_ITEM_QTY
                  ) A
             <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
             </where>
    </select>

    <!-- 기타입고 리스트정보를 조회한다. -->
    <select id="selectReceiveEtcForReturnsByConditionCnt" parameterType="ReceiveEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcForReturnsByConditionCnt] */
          SELECT    COUNT(*)
            FROM
                 (
                     SELECT A.DLR_CD                --딜러코드
                           ,A.MVT_TP                --수불유형
                           ,A.ETC_GR_DOC_NO         --기타입고문서번호
                           ,A.BP_CD                 --거래처코드
                           ,C.BP_NM                 --거래처
                           ,A.STAT_CD               --상태코드
                           ,A.REG_DT                --일자
                           ,A.REG_USR_ID            --등록인
                           ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   --등록자명
                           ,A.REMARK                --비고
                           ,NVL(B.ITEM_CNT,0) AS ITEM_CNT
                           ,NVL(B.ITEM_QTY,0) AS ITEM_QTY
                           ,NVL(B.GR_TOT_AMT,0) AS GR_TOT_AMT
                           ,NVL(B.GR_TAX_DDCT_AMT,0) AS GR_TAX_DDCT_AMT
                           ,NVL(D.RETURN_ITEM_CNT,0) AS RETURN_ITEM_CNT
                           ,NVL(D.RETURN_ITEM_QTY,0) AS RETURN_ITEM_QTY
                           ,NVL(D.RETURN_TOT_AMT,0) AS RETURN_TOT_AMT
                           ,NVL(D.RETURN_TAX_DDCT_AMT,0) AS RETURN_TAX_DDCT_AMT
                           ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
                      FROM DMSDB.PT_0621T A    --기타입고헤더정보
                             LEFT OUTER JOIN
                                  (
                                  SELECT   A.DLR_CD
                                          ,A.ETC_GR_DOC_NO
                                          ,COUNT(*) AS ITEM_CNT
                                          ,SUM(NVL(A.QTY,0)) AS ITEM_QTY
                                          ,SUM(NVL(A.AMT,0)) AS GR_TOT_AMT
                                          ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS GR_TAX_DDCT_AMT
                                    FROM   DMSDB.PT_0622T A    --기타입고부품정보
                                              INNER JOIN DMSDB.PT_0621T B
                                                 ON A.DLR_CD = B.DLR_CD
                                                AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                   WHERE   A.DLR_CD = #{sDlrCd}  --딜러코드
                                     <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                         AND A.ETC_GR_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                                     </if>        --기타입고번호
                                     AND   A.CANC_YN != 'Y'
                                     AND   A.CANC_DT IS NULL
                                     AND   A.GR_STAT_CD != '03'  --취소
                                     AND   NVL(B.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                                    GROUP BY A.DLR_CD
                                            ,A.ETC_GR_DOC_NO
                                   ) B
                                ON A.DLR_CD = B.DLR_CD
                               AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                             LEFT OUTER JOIN DMSDB.PT_0211T C
                                    ON A.DLR_CD = C.DLR_CD
                                   AND A.BP_CD  = C.BP_CD
                             LEFT OUTER JOIN
                                  (
                                  SELECT   A.DLR_CD
                                              ,A.REF_DOC_NO
                                              ,COUNT(*) AS RETURN_ITEM_CNT
                                              ,SUM(NVL(A.QTY,0)) AS RETURN_ITEM_QTY
                                              ,SUM(NVL(A.AMT,0)) AS RETURN_TOT_AMT
                                              ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS RETURN_TAX_DDCT_AMT
                                        FROM   DMSDB.PT_0622T A    --반품입고부품정보
                                       WHERE   A.DLR_CD = #{sDlrCd}  --딜러코드
                                       <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                           AND A.REF_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                                       </if>        --기타입고번호
                                         AND   A.CANC_YN != 'Y'
                                         AND   A.CANC_DT IS NULL
                                         AND   A.GR_STAT_CD != '03'  --취소
                                                --기타입고번호
                                        GROUP BY A.DLR_CD
                                                ,A.REF_DOC_NO
                                   ) D
                                ON A.DLR_CD = D.DLR_CD
                               AND A.ETC_GR_DOC_NO = D.REF_DOC_NO
                     WHERE A.DLR_CD   = #{sDlrCd}  --딜러코드
                       AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                       <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                           AND A.ETC_GR_DOC_NO   like '%'|| #{sEtcGrDocNo} ||'%'
                       </if>  --기타입고번호
                       <if test='sMvtTp != null and sMvtTp != ""'>
                           AND A.MVT_TP = #{sMvtTp}
                       </if>  --수불유형
                       <if test='sBpCd != null and sBpCd != ""'>
                           AND A.BP_CD = #{sBpCd}
                       </if>  --업체코드
                       <if test='sBpNm != null and sBpCd != ""'>
                           AND C.BP_NM like '%'||#{sBpNm}||'%'
                       </if>  --업체코드
                       <if test='sStatCd != null and sStatCd != ""'>
                           AND A.STAT_CD = #{sStatCd}
                       </if>  --상태
                       <if test='sRegDtFr != null'>
                           AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                       </if>
                       <if test='sRegDtTo != null'>
                           AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                       </if>
                       <if test='sBpTp == "ETC"'>
                           AND C.BP_TP != '01'
                       </if>
                       <if test='sRemark != null and sRemark != ""'>
                           AND A.REMARK like '%'|| #{sRemark} ||'%'
                       </if>  --비고
                       <if test='sRegUsrId != null and sRegUsrId != ""'>
                           AND A.REG_USR_ID like '%'|| #{sRegUsrId} ||'%'
                       </if>  --등록자
                 ) T1
             WHERE 1=1
             <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                 AND T1.REG_USR_NM like '%'|| #{sRegUsrNm} ||'%'
             </if>  --등록자
             AND T1.ITEM_QTY != T1.RETURN_ITEM_QTY
    </select>

    <!-- 구매입고(반품)현황 정보(반품문서기준)를 조회한다. -->
    <select id="selectPurcReceiveReturnsByCondition" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectPurcReceiveReturnsByCondition] */
      SELECT    A.*
        FROM
        (
          SELECT    ROWNUM AS RNUM
                    ,A.*
            FROM
                 (
              SELECT    T1.DLR_CD                  --딜러코드
                       ,T1.ETC_GR_DOC_NO           --반품문서번호
                       ,T1.ETC_GR_DOC_LINE_NO      --반품문서라인번호
                       ,T1.BP_CD                   --거래처코드
                       ,T1.BP_NM                   --거래처코드
                       ,T1.ITEM_CD                 --품목코드
                       ,T1.ITEM_NM                 --품목코드
                       ,T1.RETURN_QTY              --반품수량
                       ,T1.UNIT_CD                 --구매단위코드
                       ,T1.PRC                     --구매단가
                       ,T1.TAX_DDCT_PRC            --구매세금제외단가
                       ,T1.MOVING_AVG_PRC          --이평가단가
                       ,T1.RETURN_AMT              --구매반품금액
                       ,T1.RETURN_TAX_DDCT_AMT     --구매반품세금제외금액
                       ,T1.RETURN_TAX_AMT          --구매반품세금금액
                       ,T1.RETURN_MOVING_AVG_AMT   --구매이평가금액
                       ,T1.RETURN_DT               --반품일자
                       ,T1.REF_DOC_NO              --구매오더번호
                       ,T1.REF_DOC_LINE_NO         --구매오더라인번호
                       ,T1.GR_DT                   --입고일자
                       ,T1.QTY                     --입고수량
                       ,T1.AMT                     --구매금액
                       ,T1.TAX_DDCT_AMT            --구매세금제외금액
                       ,T1.TAX_AMT                 --구매세금금액
                       ,T1.PRE_RETURN_QTY
                       ,T1.PRE_RETURN_AMT
                       ,T1.PRE_RETURN_MOVING_AVG_AMT
                       ,T1.REMARK                  --비고
                       ,T1.REG_USR_ID              --등록자ID
                       ,T1.REG_USR_NM   --등록자명
                       ,T1.UPDT_USR_ID             --수정자ID
                       ,T1.UPDT_DT                 --수정일자
                       ,T1.AVLB_STOCK_QTY     --가용재고
                       ,T1.BORROW_QTY             --차입
                       ,T1.RENT_QTY                 --대여수량
                       ,T1.STOCK_QTY
                FROM
                     (
                         SELECT
                                    A.DLR_CD                  --딜러코드
                                   ,A.ETC_GR_DOC_NO           --반품문서번호
                                   ,B.ETC_GR_DOC_LINE_NO      --반품문서라인번호
                                   ,A.BP_CD                   --거래처코드
                                   ,E.BP_NM                   --거래처코드
                                   ,B.ITEM_CD                 --품목코드
                                   ,D.ITEM_NM                 --품목코드
                                   ,B.QTY AS RETURN_QTY       --반품수량
                                   ,B.UNIT_CD                 --구매단위코드
                                   ,B.PRC                     --구매단가
                                   ,B.TAX_DDCT_PRC            --구매세금제외단가
                                   ,NVL(G.MOVING_AVG_PRC,0) AS MOVING_AVG_PRC  --이평가
                                   ,B.AMT AS RETURN_AMT       --구매반품금액
                                   ,B.TAX_DDCT_AMT AS RETURN_TAX_DDCT_AMT            --구매반품세금제외금액
                                   ,B.TAX_AMT AS RETURN_TAX_AMT                 --구매반품세금금액
                                   ,NVL(G.MOVING_AVG_AMT,0) AS RETURN_MOVING_AVG_AMT  --반품 이평가금액
                                   ,A.REG_DT AS RETURN_DT     --반품일자
                                   ,C.ETC_GR_DOC_NO AS REF_DOC_NO                --구매오더번호
                                   ,C.ETC_GR_DOC_LINE_NO AS REF_DOC_LINE_NO      --구매오더라인번호
                                   ,C.REG_DT AS GR_DT         --입고일자
                                   ,C.QTY                     --입고수량
                                   ,C.AMT                     --구매금액
                                   ,C.TAX_DDCT_AMT            --구매세금제외금액
                                   ,C.TAX_AMT                 --구매세금금액
                                   ,SUM(B.QTY) OVER(PARTITION BY B.REF_DOC_NO,B.REF_DOC_LINE_NO ORDER BY B.REG_DT ASC
                                               ROWS BETWEEN UNBOUNDED PRECEDING AND  CURRENT ROW  ) - B.QTY AS PRE_RETURN_QTY
                                   ,SUM(B.AMT) OVER(PARTITION BY B.REF_DOC_NO,B.REF_DOC_LINE_NO ORDER BY B.REG_DT ASC
                                               ROWS BETWEEN UNBOUNDED PRECEDING AND  CURRENT ROW  ) - B.AMT AS PRE_RETURN_AMT
                                   ,SUM(G.MOVING_AVG_AMT) OVER(PARTITION BY B.REF_DOC_NO,B.REF_DOC_LINE_NO ORDER BY B.REG_DT ASC
                                               ROWS BETWEEN UNBOUNDED PRECEDING AND  CURRENT ROW  ) - G.MOVING_AVG_AMT AS PRE_RETURN_MOVING_AVG_AMT
                                   ,A.REMARK                  --비고
                                   ,A.REG_USR_ID              --등록자ID
                                   ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   --등록자명
                                   ,A.UPDT_USR_ID             --수정자ID
                                   ,A.UPDT_DT                 --수정일자
                                   ,NVL(F.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY     --가용재고
                                   ,NVL(F.BORROW_QTY,0) AS BORROW_QTY             --차입
                                   ,NVL(F.RENT_QTY,0) AS RENT_QTY                 --대여수량
                                   ,NVL(F.AVLB_STOCK_QTY,0) + NVL(F.RESV_STOCK_QTY,0) - NVL(F.BORROW_QTY,0) + NVL(F.RENT_QTY,0) AS STOCK_QTY
                              FROM DMSDB.PT_0621T A    --기타입고 번호(반품)
                                  INNER JOIN  DMSDB.PT_0622T B
                                     ON A.DLR_CD  = B.DLR_CD
                                    AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                  INNER JOIN (
                                           SELECT D.*
                                             FROM DMSDB.PT_0622T D
                                                   INNER JOIN DMSDB.PT_0621T H
                                                      ON H.DLR_CD = D.DLR_CD
                                                     AND H.ETC_GR_DOC_NO = D.ETC_GR_DOC_NO
                                             WHERE  D.DLR_CD = #{sDlrCd}       --딜러코드
                                               AND NVL(H.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')) C    --입고
                                     ON B.DLR_CD          = C.DLR_CD
                                    AND B.REF_DOC_NO      = C.ETC_GR_DOC_NO
                                    AND B.REF_DOC_LINE_NO = C.ETC_GR_DOC_LINE_NO
                                  INNER JOIN  DMSDB.PT_0201T D    --품목정보
                                     ON B.DLR_CD  = D.DLR_CD
                                    AND B.ITEM_CD = D.ITEM_CD
                                  INNER JOIN DMSDB.PT_0211T E
                                     ON A.DLR_CD = E.DLR_CD
                                    AND A.BP_CD  = E.BP_CD
                                  LEFT OUTER JOIN PT_0301T F
                                     ON D.DLR_CD           = F.DLR_CD
                                    AND D.ITEM_CD          = F.ITEM_CD
                                    AND D.GR_STRGE_CD      = F.STRGE_CD
                                  LEFT OUTER JOIN PT_0312T G
                                     ON B.DLR_CD             = G.DLR_CD
                                    AND B.ETC_GR_DOC_NO      = G.REF_DOC_NO
                                    AND B.ETC_GR_DOC_LINE_NO = G.REF_DOC_LINE_NO
                         WHERE  A.DLR_CD = #{sDlrCd}       --딜러코드
                         <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                             AND A.ETC_GR_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                         </if>        --반품번호
                         <if test='sRefDocNo != null and sRefDocNo != ""'>
                             AND C.ETC_GR_DOC_NO like '%'|| #{sRefDocNo} ||'%'
                         </if>        --입고번호
                         <if test='sBpCd != null and sBpCd != ""'>
                             AND A.BP_CD = #{sBpCd}
                         </if>  --업체코드
                         <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                             AND A.BP_CD IN
                              <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                                 #{item}
                              </foreach>
                         </if>        --거래처코드
                         <if test='sRegUsrId != null and sRegUsrId != ""'>
                             AND A.REG_USR_ID like '%'|| #{sRegUsrId} ||'%'
                         </if>  --등록자
                         <if test='sItemCd != null and sItemCd != ""'>
                             AND B.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                         </if>  ----품목번호
                         <if test='sItemNm != null and sItemNm != ""'>
                             AND D.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                         </if>  ----품목명
                         <if test='sRegDtFr != null'>
                             AND C.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                         </if>
                         <if test='sRegDtTo != null'>
                             AND C.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                         </if>
                         <if test='sReturnDtFr != null'>
                             AND A.REG_DT <![CDATA[>=]]> #{sReturnDtFr}
                         </if>
                         <if test='sReturnDtTo != null'>
                             AND A.REG_DT <![CDATA[<=]]> #{sReturnDtTo} + 1
                         </if>
                         AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                     ) T1
                     ORDER BY
                         <choose>
                             <when test='sort != null'>
                                 <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                     <choose>
                                         <when test='item.field == "etcGrDocNo"'> T1.ETC_GR_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "grDt"'> T1.GR_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "returnDt"'> T1.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <otherwise>
                                           T1.DLR_CD ASC
                                          ,T1.ETC_GR_DOC_NO DESC
                                          ,T1.ETC_GR_DOC_LINE_NO
                                         </otherwise>
                                     </choose>
                                 </foreach>
                             </when>
                             <otherwise>
                               T1.DLR_CD ASC
                              ,T1.ETC_GR_DOC_NO DESC
                              ,T1.ETC_GR_DOC_LINE_NO
                             </otherwise>
                         </choose>
                  ) A
              ) A
              <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
             </where>

    </select>

    <!-- 구매입고(반품)현황(반품문서기준) COUNT정보를 조회한다. -->
    <select id="selectPurcReceiveReturnsByConditionCnt" parameterType="ReceiveEtcSearchVO"  resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectPurcReceiveReturnsByConditionCnt] */
            SELECT    COUNT(*)
              FROM    DMSDB.PT_0621T A    --기타입고 번호(반품)
                      INNER JOIN  DMSDB.PT_0622T B
                         ON A.DLR_CD  = B.DLR_CD
                        AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                      INNER JOIN (
                               SELECT D.*
                                 FROM DMSDB.PT_0622T D
                                       INNER JOIN DMSDB.PT_0621T H
                                          ON H.DLR_CD = D.DLR_CD
                                         AND H.ETC_GR_DOC_NO = D.ETC_GR_DOC_NO
                                 WHERE  D.DLR_CD = #{sDlrCd}       --딜러코드
                                   AND NVL(H.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')) C    --입고
                         ON B.DLR_CD          = C.DLR_CD
                        AND B.REF_DOC_NO      = C.ETC_GR_DOC_NO
                        AND B.REF_DOC_LINE_NO = C.ETC_GR_DOC_LINE_NO
                      INNER JOIN  DMSDB.PT_0201T D    --품목정보
                         ON B.DLR_CD  = D.DLR_CD
                        AND B.ITEM_CD = D.ITEM_CD
                      INNER JOIN DMSDB.PT_0211T E
                         ON A.DLR_CD = E.DLR_CD
                        AND A.BP_CD  = E.BP_CD
                      LEFT OUTER JOIN PT_0301T F
                         ON D.DLR_CD           = F.DLR_CD
                        AND D.ITEM_CD          = F.ITEM_CD
                        AND D.GR_STRGE_CD      = F.STRGE_CD
             WHERE  A.DLR_CD = #{sDlrCd}       --딜러코드
             <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                 AND A.ETC_GR_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
             </if>        --반품번호
             <if test='sRefDocNo != null and sRefDocNo != ""'>
                 AND C.ETC_GR_DOC_NO like '%'|| #{sRefDocNo} ||'%'
             </if>        --입고번호
             <if test='sBpCd != null and sBpCd != ""'>
                 AND A.BP_CD = #{sBpCd}
             </if>  --업체코드
             <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                 AND A.BP_CD IN
                  <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                     #{item}
                  </foreach>
             </if>        --거래처코드
             <if test='sRegUsrId != null and sRegUsrId != ""'>
                 AND A.REG_USR_ID like '%'|| #{sRegUsrId} ||'%'
             </if>  --등록자
             <if test='sItemCd != null and sItemCd != ""'>
                 AND B.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
             </if>  ----품목번호
             <if test='sItemNm != null and sItemNm != ""'>
                 AND D.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
             </if>  ----품목명
             <if test='sRegDtFr != null'>
                 AND C.REG_DT <![CDATA[>=]]> #{sRegDtFr}
             </if>
             <if test='sRegDtTo != null'>
                 AND C.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
             </if>
             <if test='sReturnDtFr != null'>
                 AND A.REG_DT <![CDATA[>=]]> #{sReturnDtFr}
             </if>
             <if test='sReturnDtTo != null'>
                 AND A.REG_DT <![CDATA[<=]]> #{sReturnDtTo} + 1
             </if>
             AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
    </select>

    <!-- 구매입고(반품)집계 정보(반품문서기준)를 조회한다. -->
    <select id="selectPurcReceiveReturnSummaryListByCondition" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectPurcReceiveReturnSummaryListByConditionCnt] */
          SELECT    A.*
           FROM
             (
              SELECT     ROWNUM AS RNUM
                        ,T1.DLR_CD
                        ,T1.ETC_GR_DOC_NO
                        ,T1.REF_DOC_NO
                        ,T1.BP_CD
                        ,T1.BP_NM
                        ,T1.GR_DT
                        ,T1.RETURN_DT
                        ,T1.REG_USR_ID
                        ,T1.REG_USR_NM
                        ,T1.ITEM_CNT
                        ,T1.ITEM_QTY
                        ,T1.GR_TOT_AMT
                        ,T1.GR_TAX_DDCT_AMT
                        ,T1.GR_TAX_AMT
                        ,T1.RETURN_ITEM_CNT
                        ,T1.RETURN_QTY
                        ,T1.RETURN_TOT_AMT
                        ,T1.RETURN_TAX_DDCT_AMT
                        ,T1.RETURN_TAX_AMT
                        ,T1.PRE_RETURN_QTY
                        ,T1.PRE_RETURN_AMT
                        ,T1.RETURN_MOVING_AVG_TOT_AMT
                        ,T1.PRE_RETURN_MOVING_AVG_AMT
                FROM    (
                        SELECT   A.DLR_CD
                                ,A.ETC_GR_DOC_NO
                                ,A.REF_DOC_NO
                                ,MAX(A.BP_CD) AS BP_CD
                                ,MAX(A.BP_NM) AS BP_NM
                                ,MAX(A.GR_DT) AS GR_DT
                                ,MAX(A.RETURN_DT) AS RETURN_DT
                                ,MAX(A.REG_USR_ID) AS REG_USR_ID
                                ,MAX(A.REG_USR_NM) AS REG_USR_NM
                                ,MAX(A.ITEM_CNT) AS ITEM_CNT
                                ,MAX(A.ITEM_QTY) AS ITEM_QTY
                                ,MAX(A.GR_TOT_AMT) AS GR_TOT_AMT
                                ,MAX(A.GR_TAX_DDCT_AMT) AS GR_TAX_DDCT_AMT
                                ,MAX(A.GR_TAX_AMT) AS GR_TAX_AMT
                                ,COUNT(A.ETC_GR_DOC_NO) AS RETURN_ITEM_CNT
                                ,SUM(A.RETURN_QTY) AS RETURN_QTY
                                ,SUM(A.RETURN_AMT) AS RETURN_TOT_AMT
                                ,SUM(A.RETURN_TAX_DDCT_AMT) AS RETURN_TAX_DDCT_AMT
                                ,SUM(A.RETURN_TAX_AMT) AS RETURN_TAX_AMT
                                ,SUM(A.PRE_RETURN_QTY) AS PRE_RETURN_QTY
                                ,SUM(A.PRE_RETURN_AMT) AS PRE_RETURN_AMT
                                ,SUM(A.RETURN_MOVING_AVG_AMT) AS RETURN_MOVING_AVG_TOT_AMT
                                ,SUM(A.PRE_RETURN_MOVING_AVG_AMT) AS PRE_RETURN_MOVING_AVG_AMT
                          FROM
                                (
                                 SELECT
                                            A.DLR_CD                       --딜러코드
                                           ,A.ETC_GR_DOC_NO                --반품번호
                                           ,A.BP_CD                        --거래처코드
                                           ,E.BP_NM                        --거래처코드
                                           ,B.ITEM_CD                      --품목코드
                                           ,D.ITEM_NM                      --품목코드
                                           ,B.QTY AS RETURN_QTY            --구매반품수량
                                           ,B.UNIT_CD                      --구매단위코드
                                           ,B.PRC                          --구매단가
                                           ,NVL(G.MOVING_AVG_PRC,0) AS MOVING_AVG_PRC  --이평가
                                           ,B.TAX_DDCT_PRC                 --구매세금제외단가
                                           ,B.AMT AS RETURN_AMT
                                           ,B.TAX_DDCT_AMT AS RETURN_TAX_DDCT_AMT
                                           ,B.TAX_AMT AS RETURN_TAX_AMT
                                           ,NVL(G.MOVING_AVG_AMT,0) AS RETURN_MOVING_AVG_AMT  --반품 이평가금액
                                           ,C.ETC_GR_DOC_NO AS REF_DOC_NO               --구매오더번호
                                           ,B.REG_DT AS RETURN_DT          --구매반품일자
                                           ,C.GR_DT              --구매일자
                                           ,C.ITEM_QTY
                                           ,C.ITEM_CNT
                                           ,C.GR_TOT_AMT
                                           ,C.GR_TAX_DDCT_AMT
                                           ,C.GR_TAX_AMT
                                           ,A.REMARK                       --비고
                                           ,A.REG_USR_ID                   --등록자ID
                                           ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   --등록자명
                                           ,SUM(B.QTY) OVER(PARTITION BY B.REF_DOC_NO,B.REF_DOC_LINE_NO ORDER BY B.REG_DT ASC
                                               ROWS BETWEEN UNBOUNDED PRECEDING AND  CURRENT ROW  ) - B.QTY AS PRE_RETURN_QTY
                                           ,SUM(B.AMT) OVER(PARTITION BY B.REF_DOC_NO,B.REF_DOC_LINE_NO ORDER BY B.REG_DT ASC
                                               ROWS BETWEEN UNBOUNDED PRECEDING AND  CURRENT ROW  ) - B.AMT AS PRE_RETURN_AMT
                                           ,SUM(G.MOVING_AVG_AMT) OVER(PARTITION BY B.REF_DOC_NO,B.REF_DOC_LINE_NO ORDER BY B.REG_DT ASC
                                               ROWS BETWEEN UNBOUNDED PRECEDING AND  CURRENT ROW  ) - G.MOVING_AVG_AMT AS PRE_RETURN_MOVING_AVG_AMT
                                           ,A.UPDT_USR_ID                  --수정자ID
                                           ,A.UPDT_DT                      --수정일자
                                           ,NVL(F.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY           --가용재고
                                           ,NVL(F.BORROW_QTY,0) AS BORROW_QTY               --차입
                                           ,NVL(F.RENT_QTY,0) AS RENT_QTY                 --대여수량
                                           ,NVL(F.AVLB_STOCK_QTY,0) + NVL(F.RESV_STOCK_QTY,0) - NVL(F.BORROW_QTY,0) + NVL(F.RENT_QTY,0) AS STOCK_QTY
                                      FROM DMSDB.PT_0621T A    --반품입고 번호
                                          INNER JOIN  DMSDB.PT_0622T B
                                             ON A.DLR_CD        = B.DLR_CD
                                            AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                          INNER JOIN  (
                                                   SELECT   A.DLR_CD
                                                           ,A.ETC_GR_DOC_NO
                                                           ,MAX(A.REG_DT) AS GR_DT
                                                           ,COUNT(*) AS ITEM_CNT
                                                           ,SUM(B.QTY) AS ITEM_QTY
                                                           ,SUM(B.AMT) AS GR_TOT_AMT
                                                           ,SUM(B.TAX_DDCT_AMT) AS GR_TAX_DDCT_AMT
                                                           ,SUM(B.TAX_AMT) AS GR_TAX_AMT
                                                     FROM   DMSDB.PT_0621T A
                                                              INNER JOIN DMSDB.PT_0622T B
                                                                 ON A.DLR_CD = B.DLR_CD
                                                                AND A.ETC_GR_DOC_NO  = B.ETC_GR_DOC_NO
                                                    WHERE A.DLR_CD = #{sDlrCd}       --딜러코드
                                                      AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                                                    <if test='sRefDocNo != null and sRefDocNo != ""'>
                                                         AND A.ETC_GR_DOC_NO like '%'|| #{sRefDocNo} ||'%'
                                                     </if>        --기타입고번호
                                                    GROUP BY  A.DLR_CD
                                                             ,A.ETC_GR_DOC_NO
                                              ) C    --구매입고
                                             ON B.DLR_CD           = C.DLR_CD
                                            AND B.REF_DOC_NO       = C.ETC_GR_DOC_NO
                                          INNER JOIN  DMSDB.PT_0201T D    --품목정보
                                             ON B.DLR_CD  = D.DLR_CD
                                            AND B.ITEM_CD = D.ITEM_CD
                                          INNER JOIN DMSDB.PT_0211T E
                                             ON A.DLR_CD = E.DLR_CD
                                            AND A.BP_CD  = E.BP_CD
                                          LEFT OUTER JOIN PT_0301T F
                                             ON D.DLR_CD           = F.DLR_CD
                                            AND D.ITEM_CD          = F.ITEM_CD
                                            AND D.GR_STRGE_CD      = F.STRGE_CD
                                          LEFT OUTER JOIN PT_0312T G
                                             ON B.DLR_CD             = G.DLR_CD
                                            AND B.ETC_GR_DOC_NO      = G.REF_DOC_NO
                                            AND B.ETC_GR_DOC_LINE_NO = G.REF_DOC_LINE_NO
                                 WHERE  A.DLR_CD = #{sDlrCd}       --딜러코드
                                 <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                     AND A.ETC_GR_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                                 </if>        --반품입고번호
                                 <if test='sRefDocNo != null and sRefDocNo != ""'>
                                     AND C.ETC_GR_DOC_NO like '%'|| #{sRefDocNo} ||'%'
                                 </if>        --기타입고번호
                                 <if test='sBpCd != null and sBpCd != ""'>
                                     AND A.BP_CD = #{sBpCd}
                                 </if>  --업체코드
                                 <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                                     AND A.BP_CD IN
                                      <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                                         #{item}
                                      </foreach>
                                 </if>        --거래처코드
                                 <if test='sRegUsrId != null and sRegUsrId != ""'>
                                     AND A.REG_USR_ID like '%'|| #{sRegUsrId} ||'%'
                                 </if>  --등록자
                                 <if test='sItemCd != null and sItemCd != ""'>
                                     AND B.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                                 </if>  ----품목번호
                                 <if test='sItemNm != null and sItemNm != ""'>
                                     AND D.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                 </if>  ----품목명
                                 <if test='sRegDtFr != null'>
                                     AND C.GR_DT <![CDATA[>=]]> #{sRegDtFr}
                                 </if>
                                 <if test='sRegDtTo != null'>
                                     AND C.GR_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                                 </if>
                                 <if test='sReturnDtFr != null'>
                                     AND A.REG_DT <![CDATA[>=]]> #{sReturnDtFr}
                                 </if>
                                 <if test='sReturnDtTo != null'>
                                     AND A.REG_DT <![CDATA[<=]]> #{sReturnDtTo} + 1
                                 </if>
                                 AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                                ) A
                                GROUP BY   A.DLR_CD
                                          ,A.ETC_GR_DOC_NO
                                          ,A.REF_DOC_NO
                           ORDER BY A.DLR_CD
                                   ,A.ETC_GR_DOC_NO DESC
                      ) T1
                  ) A
                 <where>
                    <if test='firstIndex != -1 and lastIndex != -1'>
                        RNUM <![CDATA[<=]]> #{lastIndex}
                    AND RNUM <![CDATA[>]]> #{firstIndex}
                    </if>
                 </where>
    </select>

    <!-- 구매입고(반품)집계 정보(반품문서기준)를 조회한다. -->
    <select id="selectPurcReceiveReturnSummaryListByConditionCnt" parameterType="ReceiveEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectPurcReceiveReturnSummaryListByConditionCnt] */
          SELECT COUNT(*)
            FROM    (
                    SELECT   A.DLR_CD
                            ,A.ETC_GR_DOC_NO
                            ,A.REF_DOC_NO
                            ,MAX(A.BP_CD) AS BP_CD
                            ,MAX(A.BP_NM) AS BP_NM
                            ,MAX(A.GR_DT) AS GR_DT
                            ,MAX(A.RETURN_DT) AS RETURN_DT
                            ,MAX(A.REG_USR_ID) AS REG_USR_ID
                            ,MAX(A.REG_USR_NM) AS REG_USR_NM
                            ,MAX(A.ITEM_CNT) AS ITEM_CNT
                            ,MAX(A.ITEM_QTY) AS ITEM_QTY
                            ,MAX(A.GR_TOT_AMT) AS GR_TOT_AMT
                            ,MAX(A.GR_TAX_DDCT_AMT) AS GR_TAX_DDCT_AMT
                            ,MAX(A.GR_TAX_AMT) AS GR_TAX_AMT
                            ,COUNT(A.ETC_GR_DOC_NO) AS RETURN_ITEM_CNT
                            ,SUM(A.RETURN_QTY) AS RETURN_QTY
                            ,SUM(A.RETURN_AMT) AS RETURN_TOT_AMT
                            ,SUM(A.RETURN_TAX_DDCT_AMT) AS RETURN_TAX_DDCT_AMT
                            ,SUM(A.RETURN_TAX_AMT) AS RETURN_TAX_AMT
                            ,SUM(A.PRE_RETURN_QTY) AS PRE_RETURN_QTY
                            ,SUM(A.PRE_RETURN_AMT) AS PRE_RETURN_AMT
                      FROM
                            (
                             SELECT
                                        A.DLR_CD                       --딜러코드
                                       ,A.ETC_GR_DOC_NO                --반품번호
                                       ,A.BP_CD                        --거래처코드
                                       ,E.BP_NM                        --거래처코드
                                       ,B.ITEM_CD                      --품목코드
                                       ,D.ITEM_NM                      --품목코드
                                       ,B.QTY AS RETURN_QTY            --구매반품수량
                                       ,B.UNIT_CD                      --구매단위코드
                                       ,B.PRC                          --구매단가
                                       ,B.TAX_DDCT_PRC                 --구매세금제외단가
                                       ,B.AMT AS RETURN_AMT
                                       ,B.TAX_DDCT_AMT AS RETURN_TAX_DDCT_AMT
                                       ,B.TAX_AMT AS RETURN_TAX_AMT
                                       ,C.ETC_GR_DOC_NO AS REF_DOC_NO               --구매오더번호
                                       ,B.REG_DT AS RETURN_DT          --구매반품일자
                                       ,C.GR_DT              --구매일자
                                       ,C.ITEM_QTY
                                       ,C.ITEM_CNT
                                       ,C.GR_TOT_AMT
                                       ,C.GR_TAX_DDCT_AMT
                                       ,C.GR_TAX_AMT
                                       ,SUM(B.QTY) OVER(PARTITION BY B.REF_DOC_NO,B.REF_DOC_LINE_NO ORDER BY B.REG_DT ASC
                                               ROWS BETWEEN UNBOUNDED PRECEDING AND  CURRENT ROW  ) - B.QTY AS PRE_RETURN_QTY
                                       ,SUM(B.AMT) OVER(PARTITION BY B.REF_DOC_NO,B.REF_DOC_LINE_NO ORDER BY B.REG_DT ASC
                                               ROWS BETWEEN UNBOUNDED PRECEDING AND  CURRENT ROW  ) - B.AMT AS PRE_RETURN_AMT
                                       ,A.REMARK                       --비고
                                       ,A.REG_USR_ID                   --등록자ID
                                       ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   --등록자명
                                       ,A.UPDT_USR_ID                  --수정자ID
                                       ,A.UPDT_DT                      --수정일자
                                       ,NVL(F.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY           --가용재고
                                       ,NVL(F.BORROW_QTY,0) AS BORROW_QTY               --차입
                                       ,NVL(F.RENT_QTY,0) AS RENT_QTY                 --대여수량
                                       ,NVL(F.AVLB_STOCK_QTY,0) + NVL(F.RESV_STOCK_QTY,0) - NVL(F.BORROW_QTY,0) + NVL(F.RENT_QTY,0) AS STOCK_QTY
                                  FROM DMSDB.PT_0621T A    --반품입고 번호
                                      INNER JOIN  DMSDB.PT_0622T B
                                         ON A.DLR_CD        = B.DLR_CD
                                        AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                      INNER JOIN  (
                                               SELECT   A.DLR_CD
                                                       ,A.ETC_GR_DOC_NO
                                                       ,MAX(A.REG_DT) AS GR_DT
                                                       ,COUNT(*) AS ITEM_CNT
                                                       ,SUM(B.QTY) AS ITEM_QTY
                                                       ,SUM(B.AMT) AS GR_TOT_AMT
                                                       ,SUM(B.TAX_DDCT_AMT) AS GR_TAX_DDCT_AMT
                                                       ,SUM(B.TAX_AMT) AS GR_TAX_AMT
                                                 FROM   DMSDB.PT_0621T A
                                                          INNER JOIN DMSDB.PT_0622T B
                                                             ON A.DLR_CD = B.DLR_CD
                                                            AND A.ETC_GR_DOC_NO  = B.ETC_GR_DOC_NO
                                                  WHERE A.DLR_CD = #{sDlrCd}       --딜러코드
                                                    AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                                                    <if test='sRefDocNo != null and sRefDocNo != ""'>
                                                         AND A.ETC_GR_DOC_NO like '%'|| #{sRefDocNo} ||'%'
                                                     </if>        --기타입고번호
                                                GROUP BY  A.DLR_CD
                                                         ,A.ETC_GR_DOC_NO
                                          ) C    --구매입고
                                         ON B.DLR_CD           = C.DLR_CD
                                        AND B.REF_DOC_NO       = C.ETC_GR_DOC_NO
                                      INNER JOIN  DMSDB.PT_0201T D    --품목정보
                                         ON B.DLR_CD  = D.DLR_CD
                                        AND B.ITEM_CD = D.ITEM_CD
                                      INNER JOIN DMSDB.PT_0211T E
                                         ON A.DLR_CD = E.DLR_CD
                                        AND A.BP_CD  = E.BP_CD
                                      LEFT OUTER JOIN PT_0301T F
                                         ON D.DLR_CD           = F.DLR_CD
                                        AND D.ITEM_CD          = F.ITEM_CD
                                        AND D.GR_STRGE_CD      = F.STRGE_CD
                             WHERE  A.DLR_CD = #{sDlrCd}       --딜러코드
                             <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                 AND A.ETC_GR_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                             </if>        --반품입고번호
                             <if test='sRefDocNo != null and sRefDocNo != ""'>
                                 AND C.ETC_GR_DOC_NO like '%'|| #{sRefDocNo} ||'%'
                             </if>        --기타입고번호
                             <if test='sBpCd != null and sBpCd != ""'>
                                 AND A.BP_CD = #{sBpCd}
                             </if>  --업체코드
                             <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                                 AND A.BP_CD IN
                                  <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                                     #{item}
                                  </foreach>
                             </if>        --거래처코드
                             <if test='sRegUsrId != null and sRegUsrId != ""'>
                                 AND A.REG_USR_ID like '%'|| #{sRegUsrId} ||'%'
                             </if>  --등록자
                             <if test='sItemCd != null and sItemCd != ""'>
                                 AND B.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                             </if>  ----품목번호
                             <if test='sItemNm != null and sItemNm != ""'>
                                 AND D.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                             </if>  ----품목명
                             <if test='sRegDtFr != null'>
                                 AND C.GR_DT <![CDATA[>=]]> #{sRegDtFr}
                             </if>
                             <if test='sRegDtTo != null'>
                                 AND C.GR_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                             </if>
                             <if test='sReturnDtFr != null'>
                                 AND A.REG_DT <![CDATA[>=]]> #{sReturnDtFr}
                             </if>
                             <if test='sReturnDtTo != null'>
                                 AND A.REG_DT <![CDATA[<=]]> #{sReturnDtTo} + 1
                             </if>
                              AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                            ) A
                            GROUP BY   A.DLR_CD
                                      ,A.ETC_GR_DOC_NO
                                      ,A.REF_DOC_NO
                       ORDER BY A.DLR_CD
                               ,A.ETC_GR_DOC_NO DESC
                  ) T1
    </select>

    <!-- 기타입고(반품)현황 정보를 조회한다. -->
    <select id="selectReceiveEtcReturnsByCondition" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcReturnsByCondition] */
          SELECT    A.*
            FROM
                 (
              SELECT    ROWNUM AS RNUM
                       ,T1.*
                FROM
                     (
                         SELECT
                                    A.DLR_CD                       --딜러코드
                                   ,A.ETC_GR_DOC_NO                  --구매오더번호
                                   ,B.ETC_GR_DOC_LINE_NO             --구매오더라인번호
                                   ,A.BP_CD                        --거래처코드
                                   ,E.BP_NM                        --거래처코드
                                   ,B.ITEM_CD                      --품목코드
                                   ,D.ITEM_NM                      --품목코드
                                   ,B.QTY                     --구매수량
                                   ,B.UNIT_CD                 --구매단위코드
                                   ,B.PRC                     --구매단가
                                   ,B.TAX_DDCT_PRC            --구매세금제외단가
                                   ,B.AMT                     --구매금액
                                   ,B.TAX_DDCT_AMT            --구매세금제외금액
                                   ,A.REG_DT AS GR_DT         --구매등록일자
                                   ,C.RETURN_DT     --구매반품일자
                                   ,C.RETURN_QTY    --반품수량
                                   ,A.REMARK                       --비고
                                   ,A.REG_USR_ID                   --등록자ID
                                   ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   --등록자명
                                   ,A.UPDT_USR_ID                  --수정자ID
                                   ,A.UPDT_DT                      --수정일자
                                   ,NVL(F.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY           --가용재고
                                   ,NVL(F.BORROW_QTY,0) AS BORROW_QTY               --차입
                                   ,NVL(F.RENT_QTY,0) AS RENT_QTY                 --대여수량
                                   ,NVL(F.AVLB_STOCK_QTY,0) + NVL(F.RESV_STOCK_QTY,0) - NVL(F.BORROW_QTY,0) + NVL(F.RENT_QTY,0) AS STOCK_QTY
                              FROM DMSDB.PT_0621T A    --기타입고 번호
                                  INNER JOIN  DMSDB.PT_0622T B
                                     ON A.DLR_CD  = B.DLR_CD
                                    AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                  INNER JOIN (SELECT DLR_CD
                                                    ,REF_DOC_NO
                                                    ,REF_DOC_LINE_NO
                                                    ,MAX(REG_DT) AS RETURN_DT
                                                    ,SUM(QTY) AS RETURN_QTY
                                               FROM (
                                                      SELECT  A.DLR_CD
                                                             ,A.ETC_GR_DOC_NO
                                                             ,A.REG_DT
                                                             ,B.REF_DOC_NO
                                                             ,B.REF_DOC_LINE_NO
                                                             ,B.QTY
                                                        FROM  DMSDB.PT_0621T A    --기타입고헤더정보
                                                              INNER JOIN DMSDB.PT_0622T B    --기타입고부품정보
                                                                 ON A.DLR_CD        = B.DLR_CD
                                                                AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                                        WHERE A.DLR_CD      = #{sDlrCd}
                                                          <if test='sEtcGrDocNo      != null and sEtcGrDocNo      != ""'>
                                                              AND B.REF_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                                                          </if>        --기타입고번호
                                                          AND A.MVT_TP      = '03'
                                                          AND B.CANC_YN    != 'Y'
                                                          AND B.CANC_DT IS NULL
                                                          AND B.GR_STAT_CD != '03'  --취소
                                                          AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                                                      )
                                                  group by DLR_CD
                                                          ,REF_DOC_NO
                                                          ,REF_DOC_LINE_NO
                                              ) C    --반품
                                     ON B.DLR_CD             = C.DLR_CD
                                    AND B.ETC_GR_DOC_NO      = C.REF_DOC_NO
                                    AND B.ETC_GR_DOC_LINE_NO = C.REF_DOC_LINE_NO
                                  INNER JOIN  DMSDB.PT_0201T D    --품목정보
                                     ON B.DLR_CD  = D.DLR_CD
                                    AND B.ITEM_CD = D.ITEM_CD
                                  INNER JOIN DMSDB.PT_0211T E
                                     ON A.DLR_CD = E.DLR_CD
                                    AND A.BP_CD  = E.BP_CD
                                  LEFT OUTER JOIN PT_0301T F
                                     ON D.DLR_CD           = F.DLR_CD
                                    AND D.ITEM_CD          = F.ITEM_CD
                                    AND D.GR_STRGE_CD      = F.STRGE_CD
                         WHERE  A.DLR_CD = #{sDlrCd}       --딜러코드
                         <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                             AND A.ETC_GR_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                         </if>        --기타입고번호
                         <if test='sBpCd != null and sBpCd != ""'>
                             AND A.BP_CD = #{sBpCd}
                         </if>  --업체코드
                         <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                             AND A.BP_CD IN
                              <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                                 #{item}
                              </foreach>
                         </if>        --거래처코드
                         <if test='sRegUsrId != null and sRegUsrId != ""'>
                             AND A.REG_USR_ID like '%'|| #{sRegUsrId} ||'%'
                         </if>  --등록자
                         <if test='sItemCd != null and sItemCd != ""'>
                             AND B.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                         </if>  ----품목번호
                         <if test='sItemNm != null and sItemNm != ""'>
                             AND D.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                         </if>  ----품목명
                         <if test='sRegDtFr != null'>
                             AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                         </if>
                         <if test='sRegDtTo != null'>
                             AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                         </if>
                         <if test='sReturnDtFr != null'>
                             AND C.RETURN_DT <![CDATA[>=]]> #{sReturnDtFr}
                         </if>
                         <if test='sReturnDtTo != null'>
                             AND C.RETURN_DT <![CDATA[<=]]> #{sReturnDtTo} + 1
                         </if>
                          AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                         ORDER BY
                         <choose>
                             <when test='sort != null'>
                                 <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                     <choose>
                                         <when test='item.field == "etcGrDocNo"'> A.ETC_GR_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "regDt"'> A.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "returnDt"'> C.RETURN_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <otherwise>
                                           A.DLR_CD ASC
                                          ,A.ETC_GR_DOC_NO DESC
                                          ,B.ETC_GR_DOC_LINE_NO DESC
                                         </otherwise>
                                     </choose>
                                 </foreach>
                             </when>
                             <otherwise>
                               A.DLR_CD ASC
                              ,A.ETC_GR_DOC_NO DESC
                              ,B.ETC_GR_DOC_LINE_NO DESC
                             </otherwise>
                         </choose>
                     ) T1

                  ) A
             <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
             </where>
    </select>

    <!-- 기타입고(반품)현황 정보를 조회한다. -->
    <select id="selectReceiveEtcReturnsByConditionCnt" parameterType="ReceiveEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcReturnsByConditionCnt] */
             SELECT COUNT(*)
               FROM DMSDB.PT_0621T A    --기타입고 번호
                      INNER JOIN  DMSDB.PT_0622T B
                         ON A.DLR_CD  = B.DLR_CD
                        AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                      INNER JOIN (SELECT DLR_CD
                                        ,REF_DOC_NO
                                        ,REF_DOC_LINE_NO
                                        ,MAX(REG_DT) AS RETURN_DT
                                        ,SUM(QTY) AS RETURN_QTY
                                   FROM (
                                          SELECT  A.DLR_CD
                                                 ,A.ETC_GR_DOC_NO
                                                 ,A.REG_DT
                                                 ,B.REF_DOC_NO
                                                 ,B.REF_DOC_LINE_NO
                                                 ,B.QTY
                                            FROM  DMSDB.PT_0621T A    --기타입고헤더정보
                                                  INNER JOIN DMSDB.PT_0622T B    --기타입고부품정보
                                                     ON A.DLR_CD        = B.DLR_CD
                                                    AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                            WHERE A.DLR_CD      = #{sDlrCd}
                                              <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                                  AND B.REF_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                                              </if>        --기타입고번호
                                              AND A.MVT_TP      = '03'
                                              AND B.CANC_YN    != 'Y'
                                              AND B.CANC_DT IS NULL
                                              AND B.GR_STAT_CD != '03'  --취소
                                              AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                                          )
                                      group by DLR_CD
                                              ,REF_DOC_NO
                                              ,REF_DOC_LINE_NO
                                  ) C    --반품
                         ON B.DLR_CD             = C.DLR_CD
                        AND B.ETC_GR_DOC_NO      = C.REF_DOC_NO
                        AND B.ETC_GR_DOC_LINE_NO = C.REF_DOC_LINE_NO
                      INNER JOIN  DMSDB.PT_0201T D    --품목정보
                         ON B.DLR_CD  = D.DLR_CD
                        AND B.ITEM_CD = D.ITEM_CD
                      INNER JOIN DMSDB.PT_0211T E
                         ON A.DLR_CD = E.DLR_CD
                        AND A.BP_CD  = E.BP_CD
                      LEFT OUTER JOIN PT_0301T F
                         ON D.DLR_CD           = F.DLR_CD
                        AND D.ITEM_CD          = F.ITEM_CD
                        AND D.GR_STRGE_CD      = F.STRGE_CD
             WHERE  A.DLR_CD = #{sDlrCd}       --딜러코드
             <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                 AND A.ETC_GR_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
             </if>        --기타입고번호
             <if test='sBpCd       != null and sBpCd != ""'>
                 AND A.BP_CD = #{sBpCd}
             </if>  --업체코드
             <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                 AND A.BP_CD IN
                  <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                     #{item}
                  </foreach>
             </if>        --거래처코드
             <if test='sRegUsrId != null and sRegUsrId != ""'>
                 AND A.REG_USR_ID like '%'|| #{sRegUsrId} ||'%'
             </if>  --등록자
             <if test='sItemCd != null and sItemCd != ""'>
                 AND B.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
             </if>  ----품목번호
             <if test='sItemNm != null and sItemNm != ""'>
                 AND D.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
             </if>  ----품목명
             <if test='sRegDtFr != null'>
                 AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
             </if>
             <if test='sRegDtTo != null'>
                 AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
             </if>
             <if test='sReturnDtFr != null'>
                 AND C.RETURN_DT <![CDATA[>=]]> #{sReturnDtFr}
             </if>
             <if test='sReturnDtTo != null'>
                 AND C.RETURN_DT <![CDATA[<=]]> #{sReturnDtTo} + 1
             </if>
             AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
    </select>

    <!-- 기타입고(반품)집계 정보를 조회한다. -->
    <select id="selectReceiveEtcReturnSummaryListByCondition" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcReturnSummaryListByCondition] */
          SELECT    A.*
           FROM
             (
              SELECT     ROWNUM AS RNUM
                        ,T1.DLR_CD
                        ,T1.ETC_GR_DOC_NO
                        ,T1.BP_CD
                        ,T1.BP_NM
                        ,T1.GR_DT
                        ,T1.RETURN_DT
                        ,T1.REG_USR_ID
                        ,T1.REG_USR_NM
                        ,T1.ITEM_CNT
                        ,T1.ITEM_QTY
                        ,T1.GR_TOT_AMT
                        ,T1.GR_TAX_DDCT_AMT
                        ,T1.GR_TAX_AMT
                        ,T1.RETURN_QTY
                        ,T1.RETURN_TOT_AMT
                        ,T1.RETURN_TAX_DDCT_AMT
                        ,T1.RETURN_TAX_AMT
                FROM    (
                        SELECT   A.DLR_CD
                                ,A.ETC_GR_DOC_NO
                                ,MAX(A.BP_CD) AS BP_CD
                                ,MAX(A.BP_NM) AS BP_NM
                                ,MAX(A.GR_DT) AS GR_DT
                                ,MAX(A.RETURN_DT) AS RETURN_DT
                                ,MAX(A.REG_USR_ID) AS REG_USR_ID
                                ,MAX(A.REG_USR_NM) AS REG_USR_NM
                                ,COUNT(A.ETC_GR_DOC_NO) AS ITEM_CNT
                                ,SUM(A.QTY) AS ITEM_QTY
                                ,SUM(A.AMT) AS GR_TOT_AMT
                                ,SUM(A.TAX_DDCT_AMT) AS GR_TAX_DDCT_AMT
                                ,SUM(A.TAX_AMT) AS GR_TAX_AMT
                                ,SUM(A.RETURN_QTY) AS RETURN_QTY
                                ,SUM(A.RETURN_AMT) AS RETURN_TOT_AMT
                                ,SUM(A.RETURN_TAX_DDCT_AMT) AS RETURN_TAX_DDCT_AMT
                                ,SUM(A.RETURN_TAX_AMT) AS RETURN_TAX_AMT
                          FROM
                                (
                                 SELECT
                                            A.DLR_CD                       --딜러코드
                                           ,A.ETC_GR_DOC_NO                  --구매오더번호
                                           ,B.ETC_GR_DOC_LINE_NO             --구매오더라인번호
                                           ,A.BP_CD                        --거래처코드
                                           ,E.BP_NM                        --거래처코드
                                           ,B.ITEM_CD                      --품목코드
                                           ,D.ITEM_NM                      --품목코드
                                           ,B.QTY                     --구매수량
                                           ,B.UNIT_CD                 --구매단위코드
                                           ,B.PRC                     --구매단가
                                           ,B.TAX_DDCT_PRC            --구매세금제외단가
                                           ,B.AMT                     --구매금액
                                           ,B.TAX_DDCT_AMT            --구매세금제외금액
                                           ,B.TAX_AMT                 --구매세금금액
                                           ,A.REG_DT AS GR_DT         --구매등록일자
                                           ,C.RETURN_DT     --구매반품일자
                                           ,C.RETURN_QTY    --반품수량
                                           ,C.RETURN_AMT
                                           ,C.RETURN_TAX_DDCT_AMT
                                           ,C.RETURN_TAX_AMT
                                           ,A.REMARK                       --비고
                                           ,A.REG_USR_ID                   --등록자ID
                                           ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   --등록자명
                                           ,A.UPDT_USR_ID                  --수정자ID
                                           ,A.UPDT_DT                      --수정일자
                                           ,NVL(F.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY           --가용재고
                                           ,NVL(F.BORROW_QTY,0) AS BORROW_QTY               --차입
                                           ,NVL(F.RENT_QTY,0) AS RENT_QTY                 --대여수량
                                           ,NVL(F.AVLB_STOCK_QTY,0) + NVL(F.RESV_STOCK_QTY,0) - NVL(F.BORROW_QTY,0) + NVL(F.RENT_QTY,0) AS STOCK_QTY
                                      FROM DMSDB.PT_0621T A    --기타입고 번호
                                          INNER JOIN  DMSDB.PT_0622T B
                                             ON A.DLR_CD  = B.DLR_CD
                                            AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                          INNER JOIN (SELECT DLR_CD
                                                            ,REF_DOC_NO
                                                            ,REF_DOC_LINE_NO
                                                            ,MAX(REG_DT) AS RETURN_DT
                                                            ,SUM(QTY) AS RETURN_QTY
                                                            ,SUM(AMT) AS RETURN_AMT
                                                            ,SUM(TAX_DDCT_AMT) AS RETURN_TAX_DDCT_AMT
                                                            ,SUM(TAX_AMT) AS RETURN_TAX_AMT
                                                       FROM (
                                                              SELECT  A.DLR_CD
                                                                     ,A.ETC_GR_DOC_NO
                                                                     ,A.REG_DT
                                                                     ,B.REF_DOC_NO
                                                                     ,B.REF_DOC_LINE_NO
                                                                     ,B.QTY
                                                                     ,B.AMT                     --구매금액
                                                                     ,B.TAX_DDCT_AMT            --구매세금제외금액
                                                                     ,B.TAX_AMT                 --구매세금금액
                                                                FROM  DMSDB.PT_0621T A    --기타입고헤더정보
                                                                      INNER JOIN DMSDB.PT_0622T B    --기타입고부품정보
                                                                         ON A.DLR_CD        = B.DLR_CD
                                                                        AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                                                WHERE A.DLR_CD      = #{sDlrCd}
                                                                <if test='sEtcGrDocNo      != null and sEtcGrDocNo      != ""'>
                                                                    AND B.REF_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                                                                </if>        --기타입고번호
                                                                  AND A.MVT_TP      = '03'
                                                                  AND B.CANC_YN    != 'Y'
                                                                  AND B.CANC_DT IS NULL
                                                                  AND B.GR_STAT_CD != '03'  --취소
                                                                  AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                                                              )
                                                          group by DLR_CD
                                                                  ,REF_DOC_NO
                                                                  ,REF_DOC_LINE_NO
                                                      ) C    --반품
                                             ON B.DLR_CD             = C.DLR_CD
                                            AND B.ETC_GR_DOC_NO      = C.REF_DOC_NO
                                            AND B.ETC_GR_DOC_LINE_NO = C.REF_DOC_LINE_NO
                                          INNER JOIN  DMSDB.PT_0201T D    --품목정보
                                             ON B.DLR_CD  = D.DLR_CD
                                            AND B.ITEM_CD = D.ITEM_CD
                                          INNER JOIN DMSDB.PT_0211T E
                                             ON A.DLR_CD = E.DLR_CD
                                            AND A.BP_CD  = E.BP_CD
                                          LEFT OUTER JOIN PT_0301T F
                                             ON D.DLR_CD           = F.DLR_CD
                                            AND D.ITEM_CD          = F.ITEM_CD
                                            AND D.GR_STRGE_CD      = F.STRGE_CD
                                 WHERE  A.DLR_CD = #{sDlrCd}       --딜러코드
                                 <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                     AND A.ETC_GR_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                                 </if>        --기타입고번호
                                 <if test='sBpCd != null and sBpCd != ""'>
                                     AND A.BP_CD = #{sBpCd}
                                 </if>  --업체코드
                                 <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                                     AND A.BP_CD IN
                                      <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                                         #{item}
                                      </foreach>
                                 </if>        --거래처코드
                                 <if test='sRegUsrId != null and sRegUsrId != ""'>
                                     AND A.REG_USR_ID like '%'|| #{sRegUsrId} ||'%'
                                 </if>  --등록자
                                 <if test='sItemCd != null and sItemCd != ""'>
                                     AND B.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                                 </if>  ----품목번호
                                 <if test='sItemNm != null and sItemNm != ""'>
                                     AND D.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                 </if>  ----품목명
                                 <if test='sRegDtFr != null'>
                                     AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                                 </if>
                                 <if test='sRegDtTo != null'>
                                     AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                                 </if>
                                 <if test='sReturnDtFr != null'>
                                     AND C.RETURN_DT <![CDATA[>=]]> #{sReturnDtFr}
                                 </if>
                                 <if test='sReturnDtTo != null'>
                                     AND C.RETURN_DT <![CDATA[<=]]> #{sReturnDtTo} + 1
                                 </if>
                                 AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                                ) A
                                GROUP BY   A.DLR_CD
                                          ,A.ETC_GR_DOC_NO
                           ORDER BY A.DLR_CD
                                   ,A.ETC_GR_DOC_NO DESC
                      ) T1
                  ) A
                 <where>
                    <if test='firstIndex != -1 and lastIndex != -1'>
                        RNUM <![CDATA[<=]]> #{lastIndex}
                    AND RNUM <![CDATA[>]]> #{firstIndex}
                    </if>
                 </where>
    </select>

    <!-- 기타입고(반품)집계 정보를 조회한다. -->
    <select id="selectReceiveEtcReturnSummaryListByConditionCnt" parameterType="ReceiveEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcReturnSummaryListByConditionCnt] */
                  SELECT COUNT(*)
                    FROM    (
                            SELECT   A.DLR_CD
                                    ,A.ETC_GR_DOC_NO
                                    ,MAX(A.BP_CD) AS BP_CD
                                    ,MAX(A.BP_NM) AS BP_NM
                                    ,MAX(A.GR_DT) AS GR_DT
                                    ,MAX(A.RETURN_DT) AS RETURN_DT
                                    ,MAX(A.REG_USR_ID) AS REG_USR_ID
                                    ,MAX(A.REG_USR_NM) AS REG_USR_NM
                                    ,COUNT(A.ETC_GR_DOC_NO) AS ITEM_CNT
                                    ,SUM(A.QTY) AS ITEM_QTY
                                    ,SUM(A.AMT) AS GR_TOT_AMT
                                    ,SUM(A.TAX_DDCT_AMT) AS GR_TAX_DDCT_AMT
                                    ,SUM(A.TAX_AMT) AS GR_TAX_AMT
                                    ,SUM(A.RETURN_QTY) AS RETURN_ITEM_QTY
                                    ,SUM(A.RETURN_AMT) AS RETURN_TOT_AMT
                                    ,SUM(A.RETURN_TAX_DDCT_AMT) AS RETURN_TAX_DDCT_AMT
                                    ,SUM(A.RETURN_TAX_AMT) AS RETURN_TAX_AMT
                              FROM
                                    (
                                     SELECT
                                                A.DLR_CD                       --딜러코드
                                               ,A.ETC_GR_DOC_NO                  --구매오더번호
                                               ,B.ETC_GR_DOC_LINE_NO             --구매오더라인번호
                                               ,A.BP_CD                        --거래처코드
                                               ,E.BP_NM                        --거래처코드
                                               ,B.ITEM_CD                      --품목코드
                                               ,D.ITEM_NM                      --품목코드
                                               ,B.QTY                     --구매수량
                                               ,B.UNIT_CD                 --구매단위코드
                                               ,B.PRC                     --구매단가
                                               ,B.TAX_DDCT_PRC            --구매세금제외단가
                                               ,B.AMT                     --구매금액
                                               ,B.TAX_DDCT_AMT            --구매세금제외금액
                                               ,B.TAX_AMT                 --구매세금금액
                                               ,A.REG_DT AS GR_DT         --구매등록일자
                                               ,C.RETURN_DT     --구매반품일자
                                               ,C.RETURN_QTY    --반품수량
                                               ,C.RETURN_AMT
                                               ,C.RETURN_TAX_DDCT_AMT
                                               ,C.RETURN_TAX_AMT
                                               ,A.REMARK                       --비고
                                               ,A.REG_USR_ID                   --등록자ID
                                               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   --등록자명
                                               ,A.UPDT_USR_ID                  --수정자ID
                                               ,A.UPDT_DT                      --수정일자
                                               ,NVL(F.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY           --가용재고
                                               ,NVL(F.BORROW_QTY,0) AS BORROW_QTY               --차입
                                               ,NVL(F.RENT_QTY,0) AS RENT_QTY                 --대여수량
                                               ,NVL(F.AVLB_STOCK_QTY,0) + NVL(F.RESV_STOCK_QTY,0) - NVL(F.BORROW_QTY,0) + NVL(F.RENT_QTY,0) AS STOCK_QTY
                                          FROM DMSDB.PT_0621T A    --기타입고 번호
                                              INNER JOIN  DMSDB.PT_0622T B
                                                 ON A.DLR_CD  = B.DLR_CD
                                                AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                              INNER JOIN (SELECT DLR_CD
                                                                ,REF_DOC_NO
                                                                ,REF_DOC_LINE_NO
                                                                ,MAX(REG_DT) AS RETURN_DT
                                                                ,SUM(QTY) AS RETURN_QTY
                                                                ,SUM(AMT) AS RETURN_AMT
                                                                ,SUM(TAX_DDCT_AMT) AS RETURN_TAX_DDCT_AMT
                                                                ,SUM(TAX_AMT) AS RETURN_TAX_AMT
                                                           FROM (
                                                                  SELECT  A.DLR_CD
                                                                         ,A.ETC_GR_DOC_NO
                                                                         ,A.REG_DT
                                                                         ,B.REF_DOC_NO
                                                                         ,B.REF_DOC_LINE_NO
                                                                         ,B.QTY
                                                                         ,B.AMT                     --구매금액
                                                                         ,B.TAX_DDCT_AMT            --구매세금제외금액
                                                                         ,B.TAX_AMT                 --구매세금금액
                                                                    FROM  DMSDB.PT_0621T A    --기타입고헤더정보
                                                                          INNER JOIN DMSDB.PT_0622T B    --기타입고부품정보
                                                                             ON A.DLR_CD        = B.DLR_CD
                                                                            AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                                                    WHERE A.DLR_CD = #{sDlrCd}
                                                                    <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                                                        AND B.REF_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                                                                    </if>        --기타입고번호
                                                                      AND A.MVT_TP      = '03'
                                                                      AND B.CANC_YN    != 'Y'
                                                                      AND B.CANC_DT IS NULL
                                                                      AND B.GR_STAT_CD != '03'  --취소
                                                                      AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                                                                  )
                                                              group by DLR_CD
                                                                      ,REF_DOC_NO
                                                                      ,REF_DOC_LINE_NO
                                                          ) C    --반품
                                                 ON B.DLR_CD             = C.DLR_CD
                                                AND B.ETC_GR_DOC_NO      = C.REF_DOC_NO
                                                AND B.ETC_GR_DOC_LINE_NO = C.REF_DOC_LINE_NO
                                              INNER JOIN  DMSDB.PT_0201T D    --품목정보
                                                 ON B.DLR_CD  = D.DLR_CD
                                                AND B.ITEM_CD = D.ITEM_CD
                                              INNER JOIN DMSDB.PT_0211T E
                                                 ON A.DLR_CD = E.DLR_CD
                                                AND A.BP_CD  = E.BP_CD
                                              LEFT OUTER JOIN PT_0301T F
                                                 ON D.DLR_CD           = F.DLR_CD
                                                AND D.ITEM_CD          = F.ITEM_CD
                                                AND D.GR_STRGE_CD      = F.STRGE_CD
                                     WHERE  A.DLR_CD = #{sDlrCd}       --딜러코드
                                     <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                         AND A.ETC_GR_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                                     </if>        --기타입고번호
                                     <if test='sBpCd != null and sBpCd != ""'>
                                         AND A.BP_CD = #{sBpCd}
                                     </if>  --업체코드
                                     <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                                         AND A.BP_CD IN
                                          <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                                             #{item}
                                          </foreach>
                                     </if>        --거래처코드
                                     <if test='sRegUsrId != null and sRegUsrId != ""'>
                                         AND A.REG_USR_ID like '%'|| #{sRegUsrId} ||'%'
                                     </if>  --등록자
                                     <if test='sItemCd != null and sItemCd != ""'>
                                         AND B.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                                     </if>  ----품목번호
                                     <if test='sItemNm != null and sItemNm != ""'>
                                         AND D.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                     </if>  ----품목명
                                     <if test='sRegDtFr != null'>
                                         AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                                     </if>
                                     <if test='sRegDtTo != null'>
                                         AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                                     </if>
                                     <if test='sReturnDtFr != null'>
                                         AND C.RETURN_DT <![CDATA[>=]]> #{sReturnDtFr}
                                     </if>
                                     <if test='sReturnDtTo != null'>
                                         AND C.RETURN_DT <![CDATA[<=]]> #{sReturnDtTo} + 1
                                     </if>
                                     AND NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                                    ) A
                                    GROUP BY   A.DLR_CD
                                              ,A.ETC_GR_DOC_NO
                          ) T1
    </select>

    <!-- 기타입고 집계정보를 조회한다. -->
    <select id="selectReceiveEtcListByCondition" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcListByCondition] */
        SELECT    A.*
          FROM
             (
            SELECT    ROWNUM AS RNUM
                   ,T1.*
            FROM
                 (
                    SELECT
                                    A.DLR_CD               --딜러코드
                                   ,A.ETC_GR_DOC_NO        --입고문서번호
                                   ,A.MVT_TP              --입고유형
                                   ,A.STAT_CD             --입고상태코드
                                   ,A.REG_DT AS GR_DT      --입고일자
                                   ,A.BP_CD                --거래처코드
                                   ,DECODE(C.BP_NM,NULL,D.DLR_NM,C.BP_NM) AS BP_NM                --거래처명
                                   ,A.REMARK               --비고
                                   ,A.REG_USR_ID           --등록자ID
                                   ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   --등록자명
                                   ,A.UPDT_USR_ID          --수정자ID
                                   ,A.UPDT_DT              --수정일자
                                   ,NVL(B.ITEM_CNT, 0) AS ITEM_CNT
                                   ,NVL(B.ITEM_QTY, 0) AS ITEM_QTY
                                   ,NVL(B.GR_TAX_AMT, 0) AS GR_TAX_AMT
                                   ,NVL(B.GR_TAX_DDCT_AMT, 0) AS GR_TAX_DDCT_AMT
                                   ,NVL(B.GR_TOT_AMT, 0) AS GR_TOT_AMT
                                   ,NVL(B.DC_RATE * 100, 0) AS DC_RATE
                                   ,CASE WHEN A.STAT_CD = '02'   --헤더 문서가 확정인 경우에만.
                                           THEN CASE WHEN NVL(B.RETURN_QTY,0) = 0
                                                       THEN '未归还'  --미반환
                                                     WHEN NVL(B.RETURN_QTY,0) = NVL(B.ITEM_QTY,0)
                                                       THEN '已归还'  --이미반환
                                                     ELSE '部分归还'  --부분반환
                                                END
                                         ELSE ''
                                    END RETURN_STAT
                                   ,NVL(B.RETURN_CNT, 0) AS RETURN_ITEM_CNT
                                   ,NVL(B.RETURN_QTY, 0) AS RETURN_ITEM_QTY
                                   ,NVL(B.RETURN_AMT, 0) AS RETURN_TOT_AMT
                              FROM   DMSDB.PT_0621T A    --기타입고문서헤더정보
                                        INNER JOIN (
                                                SELECT   A.DLR_CD
                                                        ,A.ETC_GR_DOC_NO
                                                        ,COUNT(*) AS ITEM_CNT
                                                        ,SUM(A.QTY) AS ITEM_QTY
                                                        ,SUM(NVL(A.TAX_AMT,0)) AS GR_TAX_AMT
                                                        ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS GR_TAX_DDCT_AMT
                                                        ,SUM(NVL(A.AMT,0)) AS GR_TOT_AMT
                                                        ,MAX(A.DC_RATE) AS DC_RATE
                                                        ,SUM(D.RETURN_CNT) AS RETURN_CNT
                                                        ,SUM(NVL(D.RETURN_QTY,0)) AS RETURN_QTY
                                                        ,SUM(NVL(D.RETURN_AMT,0)) AS RETURN_AMT
                                                 FROM   DMSDB.PT_0622T A
                                                          INNER JOIN  DMSDB.PT_0621T B              --기타입고헤더정보
                                                             ON A.DLR_CD        = B.DLR_CD
                                                            AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                                          INNER JOIN  DMSDB.PT_0201T C              --품목정보
                                                             ON A.DLR_CD  = C.DLR_CD
                                                            AND A.ITEM_CD = C.ITEM_CD
                                                          LEFT OUTER JOIN
                                                                     (
                                                                         SELECT   A.DLR_CD
                                                                                 ,A.REF_DOC_NO
                                                                                 ,A.REF_DOC_LINE_NO
                                                                                 ,COUNT(*) AS RETURN_CNT
                                                                                 ,SUM(NVL(A.QTY,0)) AS RETURN_QTY
                                                                                 ,SUM(NVL(A.AMT,0)) AS RETURN_AMT
                                                                           FROM   PT_0612T A
                                                                                     INNER JOIN PT_0611T B
                                                                                        ON A.DLR_CD        = B.DLR_CD
                                                                                       AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                                                                          WHERE   B.DLR_CD = #{sDlrCd}  --딜러코드
                                                                            AND   B.MVT_TP = #{sReturnMvtTp}   --차입 반환 출고 ['48']
                                                                       GROUP BY   A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                                                     ) D
                                                         ON A.DLR_CD             = D.DLR_CD
                                                        AND A.ETC_GR_DOC_NO      = D.REF_DOC_NO
                                                        AND A.ETC_GR_DOC_LINE_NO = D.REF_DOC_LINE_NO
                                                WHERE   A.DLR_CD = #{sDlrCd}  --딜러코드
                                                  --AND   A.GR_STAT_CD != '03'
                                                  <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                                      AND A.ETC_GR_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                                                  </if>  --기타입고번호
                                                  <if test='sItemCd != null and sItemCd != ""'>
                                                      AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                                                  </if>  ----품목번호
                                                  <if test='sItemNm != null and sItemNm != ""'>
                                                      AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                                  </if>  ----품목명
                                                  <if test='sRegDtFr != null'>
                                                       AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                                                  </if>
                                                  <if test='sRegDtTo != null'>
                                                       AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                                                  </if>
                                                  <if test='sMvtTpList != null and !sMvtTpList.isEmpty'>
                                                      AND B.MVT_TP IN
                                                        <foreach item="item" index="index" collection="sMvtTpList" open="(" separator="," close=")">
                                                           #{item}
                                                        </foreach>
                                                  </if>        --수불유형
                                                  <if test='sStrgeCd != null and sStrgeCd != ""'>
                                                      AND A.STRGE_CD = #{sStrgeCd}
                                                  </if> --입고창고코드
                                                  <if test='sLocCd != null and sLocCd != ""'>
                                                      AND A.LOC_CD = #{sLocCd}
                                                  </if> --입고로케이션코드
                                                  <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                                                      AND B.BP_CD IN
                                                        <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                                                          #{item}
                                                        </foreach>
                                                  </if>        --거래처코드
                                                  <if test='sStatCd != null and sStatCd != ""'>
                                                      AND B.STAT_CD = #{sStatCd}
                                                  </if>        --입고상태코드
                                                  AND NVL(B.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                                             GROUP BY   A.DLR_CD
                                                       ,A.ETC_GR_DOC_NO
                                             ) B
                                           ON A.DLR_CD         = B.DLR_CD
                                          AND A.ETC_GR_DOC_NO  = B.ETC_GR_DOC_NO
                                       LEFT OUTER JOIN DMSDB.PT_0211T C
                                               ON A.DLR_CD = C.DLR_CD
                                              AND A.BP_CD  = C.BP_CD
                                       LEFT OUTER JOIN (SELECT DLR_CD, DLR_NM
                                                        FROM DMSDB.CM_0101T) D
                                               ON A.BP_CD = D.DLR_CD
                             WHERE   A.DLR_CD        = #{sDlrCd}  --딜러코드
                               --AND   A.STAT_CD      != '03'
                               AND   NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                               <if test='sMvtTp == "63"'>
                                   AND A.REG_USR_ID = 'SYSTEM'
                               </if>
                             ORDER BY
                             <choose>
                                 <when test='sort != null'>
                                     <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                         <choose>
                                             <when test='item.field == "etcGrDocNo"'> A.ETC_GR_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "statCd"'> A.STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "grDt"'> A.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "bpCd"'> A.BP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "bpNm"'> C.BP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "regUsrId"'> A.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "itemCnt"'> B.ITEM_CNT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "itemQty"'> B.ITEM_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "grTotIncTaxAmt"'> B.GR_TOT_INC_TAX_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "grTotAmt"'> B.GR_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "dcRate"'> B.DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <otherwise>
                                               A.DLR_CD ASC
                                              ,A.ETC_GR_DOC_NO DESC
                                             </otherwise>
                                         </choose>
                                     </foreach>
                                 </when>
                                 <otherwise>
                                   A.DLR_CD ASC
                                  ,A.ETC_GR_DOC_NO DESC
                                 </otherwise>
                             </choose>
                        ) T1
                    ) A
             <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
             </where>
    </select>

    <!-- 기타입고 집계정보를 COUNT한다. -->
    <select id="selectReceiveEtcListByConditionCnt" parameterType="ReceiveEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcListByConditionCnt] */
            SELECT    COUNT(*)
              FROM   DMSDB.PT_0621T A    --기타입고문서헤더정보
                        INNER JOIN (
                                SELECT   A.DLR_CD
                                        ,A.ETC_GR_DOC_NO
                                        ,COUNT(*) AS ITEM_CNT
                                        ,SUM(A.QTY) AS ITEM_QTY
                                        ,SUM(A.PRC * A.QTY) AS GR_TOT_INC_TAX_AMT
                                        ,SUM(NVL(A.TAX_DDCT_PRC,0) * A.QTY) AS GR_TOT_AMT
                                        ,MAX(A.DC_RATE) AS DC_RATE
                                 FROM   DMSDB.PT_0622T A
                                          INNER JOIN  DMSDB.PT_0621T B              --기타입고헤더정보
                                             ON A.DLR_CD        = B.DLR_CD
                                            AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                          INNER JOIN  DMSDB.PT_0201T C              --품목정보
                                             ON A.DLR_CD  = C.DLR_CD
                                            AND A.ITEM_CD = C.ITEM_CD
                                WHERE   A.DLR_CD = #{sDlrCd}  --딜러코드
                                  --AND   A.GR_STAT_CD != '03'
                                  <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                      AND A.ETC_GR_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                                  </if>  --기타입고번호
                                  <if test='sItemCd != null and sItemCd != ""'>
                                      AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                                  </if>  ----품목번호
                                  <if test='sItemNm != null and sItemNm != ""'>
                                      AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                  </if>  ----품목명
                                  <if test='sRegDtFr != null'>
                                       AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                                  </if>
                                  <if test='sRegDtTo != null'>
                                       AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                                  </if>
                                  <if test='sMvtTpList != null and !sMvtTpList.isEmpty'>
                                      AND B.MVT_TP IN
                                      <foreach item="item" index="index" collection="sMvtTpList" open="(" separator="," close=")">
                                         #{item}
                                      </foreach>
                                  </if>        --수불유형
                                  <if test='sStrgeCd != null and sStrgeCd != ""'>
                                      AND A.STRGE_CD = #{sStrgeCd}
                                  </if> --입고창고코드
                                  <if test='sLocCd != null and sLocCd != ""'>
                                      AND A.LOC_CD = #{sLocCd}
                                  </if> --입고로케이션코드
                                  <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                                      AND B.BP_CD IN
                                      <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                                        #{item}
                                      </foreach>
                                  </if>        --거래처코드
                                  <if test='sStatCd != null and sStatCd != ""'>
                                      AND B.STAT_CD = #{sStatCd}
                                  </if>        --입고상태코드
                                  AND NVL(B.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                             GROUP BY   A.DLR_CD
                                       ,A.ETC_GR_DOC_NO
                             ) B
                           ON A.DLR_CD         = B.DLR_CD
                          AND A.ETC_GR_DOC_NO  = B.ETC_GR_DOC_NO
                       LEFT OUTER JOIN DMSDB.PT_0211T C
                               ON A.DLR_CD = C.DLR_CD
                              AND A.BP_CD  = C.BP_CD
             WHERE   A.DLR_CD = #{sDlrCd}  --딜러코드
               --AND   A.STAT_CD      != '03'
               AND   NVL(A.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
    </select>

    <!-- 기타입고 명세정보를 조회한다. -->
    <select id="selectReceiveEtcDetailListByCondition" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcDetailListByCondition] */
        SELECT    A.*
        FROM
             (
            SELECT    ROWNUM AS RNUM
                   ,T1.*
            FROM
                 (
                    SELECT  A.DLR_CD                       --딜러코드
                           ,A.ETC_GR_DOC_NO                --입고번호
                           ,A.ETC_GR_DOC_LINE_NO           --입고라인번호
                           ,A.ITEM_CD                      --품목코드
                           ,C.ITEM_NM                      --품목명
                           ,A.QTY                          --수량
                           ,A.UNIT_CD                      --단위코드
                           ,A.PRC                          --단가
                           ,A.TAX_DDCT_PRC                 --세금공제단가
                           ,A.AMT                          --입고금액
                           ,A.TAX_AMT                      --세금액
                           ,A.TAX_DDCT_AMT                 --부가세 제외 금액
                           ,A.REG_DT AS GR_DT              --입고일자
                           ,A.STRGE_CD                     --입고창고코드
                           ,A.LOC_CD                       --입고위치코드
                           ,A.GR_REASON_CD                 --입고사유
                           ,B.BP_CD                        --거래처코드
                           ,DECODE(D.BP_NM, NULL, F.DLR_NM, D.BP_NM) AS BP_NM                        --거래처명
                           ,NVL(E.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY               --가용재고
                           ,NVL(E.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY               --예류재고
                           ,NVL(E.AVLB_STOCK_QTY,0) + NVL(E.RESV_STOCK_QTY,0) - NVL(E.BORROW_QTY,0) + NVL(E.RENT_QTY,0) AS STOCK_QTY
                          FROM DMSDB.PT_0622T A                   --입고문서품목정보
                               INNER JOIN DMSDB.PT_0621T B        --입고문서헤더정보
                                  ON A.DLR_CD        = B.DLR_CD
                                 AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                               INNER JOIN DMSDB.PT_0201T C
                                  ON A.DLR_CD = C.DLR_CD
                                 AND A.ITEM_CD = C.ITEM_CD
                               LEFT OUTER JOIN DMSDB.PT_0211T D
                                  ON B.DLR_CD = D.DLR_CD
                                 AND B.BP_CD  = D.BP_CD
                               LEFT OUTER JOIN PT_0301T E
                                  ON A.DLR_CD           = E.DLR_CD
                                 AND A.ITEM_CD          = E.ITEM_CD
                                 AND A.STRGE_CD         = E.STRGE_CD
                               LEFT OUTER JOIN (SELECT DLR_CD, DLR_NM FROM CM_0101T) F
                                  ON B.BP_CD = F.DLR_CD
                         WHERE A.DLR_CD = #{sDlrCd}  --딜러코드
                             <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                                 AND A.ETC_GR_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                             </if>  --기타입고번호
                             <if test='sItemCd != null and sItemCd != ""'>
                                 AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                             </if>  ----품목번호
                             <if test='sItemNm != null and sItemNm != ""'>
                                 AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                             </if>  ----품목명
                              <if test='sRegDtFr != null'>
                                   AND B.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                              </if>
                              <if test='sRegDtTo != null'>
                                   AND B.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                              </if>
                              <if test='sMvtTpList != null and !sMvtTpList.isEmpty'>
                                  AND B.MVT_TP IN
                                  <foreach item="item" index="index" collection="sMvtTpList" open="(" separator="," close=")">
                                     #{item}
                                  </foreach>
                              </if>        --수불유형
                              <if test='sStrgeCd != null and sStrgeCd != ""'>
                                  AND A.STRGE_CD = #{sStrgeCd}
                              </if> --입고창고코드
                              <if test='sLocCd != null and sLocCd != ""'>
                                  AND A.LOC_CD = #{sLocCd}
                              </if> --입고로케이션코드
                              <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                                  AND B.BP_CD IN
                                  <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                                    #{item}
                                  </foreach>
                              </if>        --거래처코드
                              <if test='sStatCd != null and sStatCd != ""'>
                                  AND B.STAT_CD = #{sStatCd}
                              </if>        --입고상태코드
                              AND NVL(B.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                              ORDER BY
                             <choose>
                                 <when test='sort != null'>
                                     <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                         <choose>
                                             <when test='item.field == "etcGrDocNo"'> A.ETC_GR_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "statCd"'> A.STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "mvtTp"'> B.MVT_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "grDt"'> A.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "bpCd"'> B.BP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "bpNm"'> D.BP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "itemCd"'> A.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "itemNm"'> C.ITEM_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "regUsrId"'> A.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "qty"'> A.QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "unitCd"'> A.UNIT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "prc"'> A.PRC <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "taxDdctPrc"'> A.TAX_DDCT_PRC <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "amt"'> A.AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "taxAmt"'> A.TAX_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "taxDdctAmt"'> A.TAX_DDCT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "strgeCd"'> A.STRGE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "locCd"'> A.LOC_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "avlbStockQty"'> E.AVLB_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "resvStockQty"'> E.RESV_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <otherwise>
                                                A.DLR_CD ASC ,A.ETC_GR_DOC_NO DESC ,A.ETC_GR_DOC_LINE_NO ASC
                                             </otherwise>
                                         </choose>
                                     </foreach>
                                 </when>
                                 <otherwise>
                                    A.DLR_CD ASC ,A.ETC_GR_DOC_NO DESC ,A.ETC_GR_DOC_LINE_NO ASC
                                 </otherwise>
                             </choose>
                    ) T1
             ) A
             <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
             </where>
    </select>

    <!-- 기타입고 명세정보를 COUNT한다. -->
    <select id="selectReceiveEtcDetailListByConditionCnt" parameterType="ReceiveEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcDetailListByConditionCnt] */
            SELECT    COUNT(*)
              FROM DMSDB.PT_0622T A                   --입고문서품목정보
                   INNER JOIN DMSDB.PT_0621T B        --입고문서헤더정보
                      ON A.DLR_CD        = B.DLR_CD
                     AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                   INNER JOIN DMSDB.PT_0201T C
                      ON A.DLR_CD = C.DLR_CD
                     AND A.ITEM_CD = C.ITEM_CD
                   LEFT OUTER JOIN DMSDB.PT_0211T D
                      ON B.DLR_CD = D.DLR_CD
                     AND B.BP_CD  = D.BP_CD
                   LEFT OUTER JOIN PT_0301T E
                      ON A.DLR_CD           = E.DLR_CD
                     AND A.ITEM_CD          = E.ITEM_CD
                     AND A.STRGE_CD         = E.STRGE_CD
             WHERE A.DLR_CD = #{sDlrCd}  --딜러코드
                 <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                     AND A.ETC_GR_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                 </if>  --기타입고번호
                 <if test='sItemCd != null and sItemCd != ""'>
                     AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                 </if>  ----품목번호
                 <if test='sItemNm != null and sItemNm != ""'>
                     AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                 </if>  ----품목명
                 <if test='sRegDtFr != null'>
                     AND B.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                 </if>
                 <if test='sRegDtTo != null'>
                     AND B.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                 </if>
                 <if test='sMvtTpList != null and !sMvtTpList.isEmpty'>
                     AND B.MVT_TP IN
                     <foreach item="item" index="index" collection="sMvtTpList" open="(" separator="," close=")">
                        #{item}
                     </foreach>
                 </if>        --수불유형
                 <if test='sStrgeCd != null and sStrgeCd != ""'>
                     AND A.STRGE_CD = #{sStrgeCd}
                 </if> --입고창고코드
                 <if test='sLocCd != null and sLocCd != ""'>
                     AND A.LOC_CD = #{sLocCd}
                 </if> --입고로케이션코드
                 <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                    AND B.BP_CD IN
                    <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                      #{item}
                    </foreach>
                  </if>        --거래처코드
                  <if test='sStatCd != null and sStatCd != ""'>
                      AND B.STAT_CD = #{sStatCd}
                  </if>        --입고상태코드
                  AND NVL(B.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
    </select>

    <!-- 기타입고(차입등기입고) 명세정보를 조회한다. -->
    <select id="selectReceiveEtcBorrowDetailListByCondition" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcBorrowDetailListByCondition] */
        SELECT    A.*
        FROM
             (
                SELECT    ROWNUM AS RNUM
                       ,T1.*
                FROM
                     (
                        SELECT  A.DLR_CD                       --딜러코드
                               ,A.ETC_GR_DOC_NO                --입고번호
                               ,A.ETC_GR_DOC_LINE_NO           --입고라인번호
                               ,A.ITEM_CD                      --품목코드
                               ,C.ITEM_NM                      --품목명
                               ,A.QTY                          --수량
                               ,A.UNIT_CD                      --단위코드
                               ,A.PRC                          --단가
                               ,A.TAX_DDCT_PRC                 --세금공제단가
                               ,A.AMT                          --입고금액
                               ,A.TAX_AMT                      --세금액
                               ,A.TAX_DDCT_AMT                 --부가세 제외 금액
                               ,A.REG_DT AS GR_DT              --입고일자
                               ,A.STRGE_CD                     --입고창고코드
                               ,A.LOC_CD                       --입고위치코드
                               ,B.BP_CD                        --거래처코드
                               ,D.BP_NM                        --거래처명
                               ,NVL(E.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY               --가용재고
                               ,NVL(E.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY               --예류재고
                               ,NVL(E.AVLB_STOCK_QTY,0) + NVL(E.RESV_STOCK_QTY,0) - NVL(E.BORROW_QTY,0) + NVL(E.RENT_QTY,0) AS STOCK_QTY
                               ,NVL(F.RETURN_QTY,0) AS RETURN_QTY
                               ,NVL(F.RETURN_AMT,0) AS RETURN_AMT
                               ,CASE WHEN B.STAT_CD = '03'
                                       THEN '取消'
                                     ELSE  CASE WHEN NVL(F.RETURN_QTY,0) = 0
                                                  THEN '未归还'  --미반환
                                                WHEN NVL(F.RETURN_QTY,0) = A.QTY
                                                  THEN '已归还' --이미반환
                                                ELSE '部分归还'  --부분반환
                                            END
                                 END  RETURN_STAT
                               ,NVL(F.RETURN_DOC_NO,' ') AS RETURN_DOC_NO
                              FROM DMSDB.PT_0622T A                   --입고문서품목정보
                                   INNER JOIN DMSDB.PT_0621T B        --입고문서헤더정보
                                      ON A.DLR_CD        = B.DLR_CD
                                     AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                   INNER JOIN DMSDB.PT_0201T C
                                      ON A.DLR_CD = C.DLR_CD
                                     AND A.ITEM_CD = C.ITEM_CD
                                   LEFT OUTER JOIN DMSDB.PT_0211T D
                                      ON B.DLR_CD = D.DLR_CD
                                     AND B.BP_CD  = D.BP_CD
                                   LEFT OUTER JOIN PT_0301T E
                                      ON A.DLR_CD           = E.DLR_CD
                                     AND A.ITEM_CD          = E.ITEM_CD
                                     AND A.STRGE_CD         = E.STRGE_CD
                                   LEFT OUTER JOIN
                                                 (
                                                     SELECT   A.DLR_CD
                                                             ,A.REF_DOC_NO
                                                             ,A.REF_DOC_LINE_NO
                                                             ,SUM(NVL(A.QTY,0)) AS RETURN_QTY
                                                             ,SUM(NVL(A.AMT,0)) AS RETURN_AMT
                                                             ,SUBSTR(xmlagg(xmlelement(a,','||B.ETC_GI_DOC_NO) ORDER BY B.ETC_GI_DOC_NO).extract('//text()'),2) AS RETURN_DOC_NO
                                                       FROM   PT_0612T A
                                                                 INNER JOIN PT_0611T B
                                                                    ON A.DLR_CD        = B.DLR_CD
                                                                   AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                                                      WHERE   B.DLR_CD = #{sDlrCd}
                                                        AND   B.MVT_TP = #{sReturnMvtTp}   --차입 반환 출고 ['48']
                                                   GROUP BY   A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                                 ) F
                                     ON A.DLR_CD             = F.DLR_CD
                                    AND A.ETC_GR_DOC_NO      = F.REF_DOC_NO
                                   AND  A.ETC_GR_DOC_LINE_NO = F.REF_DOC_LINE_NO
                     WHERE A.DLR_CD = #{sDlrCd}  --딜러코드
                         <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                             AND A.ETC_GR_DOC_NO   like '%'|| #{sEtcGrDocNo} ||'%'
                         </if>  --기타입고번호
                         <if test='sItemCd != null and sItemCd != ""'>
                             AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                         </if>  ----품목번호
                         <if test='sItemNm != null and sItemNm != ""'>
                             AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                         </if>  ----품목명
                         <if test='sRegDtFr != null'>
                             AND B.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                         </if>
                         <if test='sRegDtTo != null'>
                             AND B.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                         </if>
                         <if test='sMvtTpList != null and !sMvtTpList.isEmpty'>
                             AND B.MVT_TP IN
                             <foreach item="item" index="index" collection="sMvtTpList" open="(" separator="," close=")">
                                #{item}
                             </foreach>
                         </if>        --수불유형
                         <if test='sStrgeCd != null and sStrgeCd != ""'>
                             AND A.STRGE_CD = #{sStrgeCd}
                         </if> --입고창고코드
                         <if test='sLocCd != null and sLocCd != ""'>
                             AND A.LOC_CD = #{sLocCd}
                         </if> --입고로케이션코드
                         <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                             AND B.BP_CD IN
                             <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                               #{item}
                             </foreach>
                         </if>        --거래처코드
                         <if test='sStatCd   != null and sStatCd   != ""'>
                             AND B.STAT_CD = #{sStatCd}
                         </if>        --입고상태코드
                         <if test='sReturnStat != null and sReturnStat   != ""'>
                             <choose>
                                 <when test='sReturnStat == 01'>  --미반환
                                     AND NVL(F.RETURN_QTY,0) =  0
                                 </when>
                                 <when test='sReturnStat == 02'>  --기반환
                                     AND NVL(F.RETURN_QTY,0) <![CDATA[>]]>  0
                                 </when>
                             </choose>
                          </if>        --반환여부상태코드
                          AND NVL(B.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
                         ORDER BY
                         <choose>
                             <when test='sort != null'>
                                 <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                     <choose>
                                         <when test='item.field == "etcGrDocNo"'> A.ETC_GR_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "statCd"'> A.STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "grDt"'> A.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "bpCd"'> B.BP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "bpNm"'> D.BP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "itemCd"'> A.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "itemNm"'> C.ITEM_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "regUsrId"'> A.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "qty"'> A.QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "unitCd"'> A.UNIT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "prc"'> A.PRC <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "taxDdctPrc"'> A.TAX_DDCT_PRC <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "amt"'> A.AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "taxAmt"'> A.TAX_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "taxDdctAmt"'> A.TAX_DDCT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "strgeCd"'> A.STRGE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "locCd"'> A.LOC_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "avlbStockQty"'> E.AVLB_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "resvStockQty"'> E.RESV_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "returnQty"'> F.RETURN_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <when test='item.field == "returnAmt"'> F.RETURN_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                         <otherwise>
                                           A.DLR_CD ASC
                                          ,A.ETC_GR_DOC_NO DESC
                                          ,A.ETC_GR_DOC_LINE_NO ASC
                                         </otherwise>
                                     </choose>
                                 </foreach>
                             </when>
                             <otherwise>
                               A.DLR_CD ASC
                              ,A.ETC_GR_DOC_NO DESC
                              ,A.ETC_GR_DOC_LINE_NO ASC
                             </otherwise>
                         </choose>
                ) T1
             ) A
             <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
             </where>
    </select>

    <!-- 기타입고(차입등기입고) 명세정보를 Count한다. -->
    <select id="selectReceiveEtcBorrowDetailListByConditionCnt" parameterType="ReceiveEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcBorrowDetailListByConditionCnt] */
            SELECT COUNT(*)
              FROM DMSDB.PT_0622T A                   --입고문서품목정보
                   INNER JOIN DMSDB.PT_0621T B        --입고문서헤더정보
                      ON A.DLR_CD        = B.DLR_CD
                     AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                   INNER JOIN DMSDB.PT_0201T C
                      ON A.DLR_CD = C.DLR_CD
                     AND A.ITEM_CD = C.ITEM_CD
                   LEFT OUTER JOIN DMSDB.PT_0211T D
                      ON B.DLR_CD = D.DLR_CD
                     AND B.BP_CD  = D.BP_CD
                   LEFT OUTER JOIN PT_0301T E
                      ON A.DLR_CD           = E.DLR_CD
                     AND A.ITEM_CD          = E.ITEM_CD
                     AND A.STRGE_CD         = E.STRGE_CD
                   LEFT OUTER JOIN
                                 (
                                     SELECT   A.DLR_CD
                                             ,A.REF_DOC_NO
                                             ,A.REF_DOC_LINE_NO
                                             ,SUM(A.QTY) AS RETURN_QTY
                                             ,SUM(A.AMT) AS RETURN_AMT
                                       FROM   PT_0612T A
                                                 INNER JOIN PT_0611T B
                                                    ON A.DLR_CD        = B.DLR_CD
                                                   AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                                      WHERE   B.DLR_CD = #{sDlrCd}
                                        AND   B.MVT_TP = #{sReturnMvtTp}   --차입 반환 출고 ['48']
                                   GROUP BY   A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                 ) F
                     ON A.DLR_CD             = F.DLR_CD
                    AND A.ETC_GR_DOC_NO      = F.REF_DOC_NO
                   AND  A.ETC_GR_DOC_LINE_NO = F.REF_DOC_LINE_NO
             WHERE A.DLR_CD = #{sDlrCd}  --딜러코드
                 <if test='sEtcGrDocNo != null and sEtcGrDocNo != ""'>
                     AND A.ETC_GR_DOC_NO like '%'|| #{sEtcGrDocNo} ||'%'
                 </if>  --기타입고번호
                 <if test='sItemCd != null and sItemCd != ""'>
                     AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                 </if>  ----품목번호
                 <if test='sItemNm != null and sItemNm != ""'>
                     AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                 </if>  ----품목명
                  <if test='sRegDtFr != null'>
                       AND B.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                  </if>
                  <if test='sRegDtTo != null'>
                       AND B.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                  </if>
                  <if test='sMvtTpList != null and !sMvtTpList.isEmpty'>
                      AND B.MVT_TP IN
                      <foreach item="item" index="index" collection="sMvtTpList" open="(" separator="," close=")">
                         #{item}
                      </foreach>
                  </if>        --수불유형
                  <if test='sStrgeCd != null and sStrgeCd != ""'>
                      AND A.STRGE_CD = #{sStrgeCd}
                  </if> --입고창고코드
                  <if test='sLocCd != null and sLocCd != ""'>
                      AND A.LOC_CD = #{sLocCd}
                  </if> --입고로케이션코드
                  <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                      AND B.BP_CD IN
                      <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                        #{item}
                      </foreach>
                  </if>        --거래처코드
                  <if test='sStatCd != null and sStatCd != ""'>
                      AND B.STAT_CD = #{sStatCd}
                  </if>        --입고상태코드
                  <if test='sReturnStat != null and sReturnStat != ""'>
                       <choose>
                            <when test='sReturnStat == 01'>  --미반환
                                AND NVL(F.RETURN_QTY,0) =  0
                            </when>
                            <when test='sReturnStat == 02'>  --기반환
                                AND NVL(F.RETURN_QTY,0) <![CDATA[>]]>  0
                            </when>
                       </choose>
                  </if>        --반환여부상태코드
                  AND NVL(B.ETC_GR_DOC_TP,'PARTS') = NVL(#{sEtcGrDocTp},'PARTS')
    </select>

    <!-- 구매입고 취소 가능 여부 체크. -->
    <select id="selectReceiveEtcReturnAvailableChk" parameterType="ReceiveEtcVO" resultType="String">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcReturnAvailableChk] */
        SELECT CASE WHEN COUNT(*) = 0 THEN 'Y' ELSE 'N' END CHK_YN
          FROM PT_0622T A
                INNER JOIN PT_0621T B
                  ON A.DLR_CD = B.DLR_CD
                 AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
          WHERE B.DLR_CD     = #{dlrCd}
            AND A.REF_DOC_NO = #{etcGrDocNo}
            AND B.MVT_TP     = '03'
    </select>

    <!-- 기타입고 헤더 수정일자정보를 조회한다. -->
    <select id="selectReceiveEtcUpdtDtByKey" parameterType="ReceiveEtcVO" resultType="String">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveEtcUpdtDtByKey] */
        SELECT  TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
          FROM  DMSDB.PT_0621T A    --기타입고헤더정보
         WHERE  A.DLR_CD             = #{dlrCd}
           AND  A.ETC_GR_DOC_NO      = #{etcGrDocNo}    --입고번호
    </select>

    <!-- 기초재고입고 리스트정보를 조회한다. -->
    <select id="selectReceiveInitListCnt" parameterType="ReceiveEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveInitListCnt] */
             SELECT COUNT(*)
              FROM DMSDB.PT_0301OH A    --기초재고입고기초정보
                    INNER JOIN DMSDB.PT_0201T B
                        ON A.DLR_CD  = B.DLR_CD
                       AND A.ITEM_CD = B.ITEM_CD
                    INNER JOIN DMSDB.CM_0104T C
                        ON A.DLR_CD  = C.DLR_CD
                       AND A.STRGE_CD = C.STRGE_CD
             WHERE A.DLR_CD             = #{sDlrCd}  --딜러코드
               AND NVL(A.APPLY_YN,'N')  = 'N'
               AND B.ITEM_DSTIN_CD != '04'  --패키지부품제외
    </select>

    <!-- 기초재고입고 리스트정보를 조회한다. -->
    <select id="selectReceiveInitList" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveInitListCnt] */
             SELECT  A.DLR_CD
                    ,A.ITEM_CD
                    ,A.STRGE_CD
                    ,A.AVLB_STOCK_QTY AS QTY
                    ,A.LAST_GR_AMT AS PRC
              FROM DMSDB.PT_0301OH A    --기초재고입고기초정보
                    INNER JOIN DMSDB.PT_0201T B
                        ON A.DLR_CD  = B.DLR_CD
                       AND A.ITEM_CD = B.ITEM_CD
                    INNER JOIN DMSDB.CM_0104T C
                        ON A.DLR_CD  = C.DLR_CD
                       AND A.STRGE_CD = C.STRGE_CD
             WHERE A.DLR_CD             = #{sDlrCd}  --딜러코드
               AND NVL(A.APPLY_YN,'N')  = 'N'
               AND B.ITEM_DSTIN_CD != '04'  --패키지부품제외
    </select>

    <!-- 기초재고입고 리스트정보를 조회한다. -->
    <select id="selectReceiveInitListByConditionCnt" parameterType="ReceiveEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveInitListCnt] */
             SELECT COUNT(*)
              FROM DMSDB.PT_0301OH A    --기초재고입고기초정보
             WHERE A.DLR_CD             = #{sDlrCd}  --딜러코드
               <if test='sInitDataYn != null and sInitDataYn   != ""'>
                  AND NVL(A.APPLY_YN,'N')  = #{sInitDataYn}
              </if>
               <if test='sItemCd != null and sItemCd != ""'>
                   AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
               </if>  ----품목번호
               <if test='sItemNm != null and sItemNm != ""'>
                   AND B.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
               </if>  ----품목명
               <if test='sStrgeCd != null and sStrgeCd != ""'>
                   AND A.STRGE_CD = #{sStrgeCd}
               </if> --입고창고코드
    </select>

    <!-- 기초재고입고 리스트정보를 조회한다. -->
    <select id="selectReceiveInitListByCondition" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveInitListCnt] */
             SELECT  A.DLR_CD
                    ,A.ITEM_CD
                    ,A.STRGE_CD
                    ,A.AVLB_STOCK_QTY AS QTY
                    ,A.LAST_GR_AMT AS PRC
                    ,A.APPLY_YN AS GR_STAT_CD
              FROM DMSDB.PT_0301OH A    --기초재고입고기초정보
             WHERE A.DLR_CD             = #{sDlrCd}  --딜러코드
               <if test='sInitDataYn != null and sInitDataYn   != ""'>
                  AND NVL(A.APPLY_YN,'N')  = #{sInitDataYn}
              </if>
               <if test='sItemCd != null and sItemCd != ""'>
                   AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
               </if>  ----품목번호
               <if test='sStrgeCd != null and sStrgeCd != ""'>
                   AND A.STRGE_CD = #{sStrgeCd}
               </if> --입고창고코드
    </select>

    <!-- 기초재고입고 부품 Count를 조회한다. -->
    <select id="selectReceiveInitItemByKeyCnt" parameterType="ReceiveEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveInitItemByKeyCnt] */
         SELECT
                COUNT(*)
           FROM DMSDB.PT_0622T A    --기타입고품목정보
                INNER JOIN  DMSDB.PT_0621T B
                   ON A.DLR_CD        = B.DLR_CD
                  AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                INNER JOIN  DMSDB.PT_0201T C    --품목정보
                   ON A.DLR_CD  = C.DLR_CD
                  AND A.ITEM_CD = C.ITEM_CD
                LEFT OUTER JOIN  DMSDB.PT_0301T D    --재고정보
                   ON A.DLR_CD      = D.DLR_CD
                  AND A.STRGE_CD    = D.STRGE_CD
                  AND A.ITEM_CD     = D.ITEM_CD
                LEFT OUTER JOIN  DMSDB.PT_0612T E
                  ON A.DLR_CD              = E.DLR_CD
                 AND A.REF_DOC_NO          = E.ETC_GI_DOC_NO
                 AND A.REF_DOC_LINE_NO     = E.ETC_GI_DOC_LINE_NO
                LEFT OUTER JOIN
                                (
                                  SELECT   A.DLR_CD
                                          ,A.REF_DOC_NO
                                          ,A.REF_DOC_LINE_NO
                                          ,SUM(A.QTY) AS QTY
                                    FROM PT_0622T A
                                   WHERE A.DLR_CD = #{sDlrCd}
                                     AND A.REF_DOC_NO IS NOT NULL
                                  GROUP BY A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                ) F
                  ON A.DLR_CD = C.DLR_CD
                 AND A.ETC_GR_DOC_NO = F.REF_DOC_NO
                 AND A.ETC_GR_DOC_LINE_NO = F.REF_DOC_LINE_NO
          WHERE A.DLR_CD            = #{sDlrCd}
            AND A.ETC_GR_DOC_NO     = #{sEtcGrDocNo}
            ORDER BY A.DLR_CD                      --딜러코드
                    ,A.ETC_GR_DOC_NO DESC               --기타입고번호
                    ,A.ETC_GR_DOC_LINE_NO          --기타입고라인번호
    </select>

    <!-- 기초재고입고 부품 정보를 조회한다. -->
    <select id="selectReceiveInitItemByKey" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveInitItemByKey] */
         SELECT    A.*
            FROM
                 (
              SELECT    ROWNUM AS RNUM
                       ,T1.*
                FROM
                     (
                         SELECT
                                A.DLR_CD                      --딜러코드
                               ,A.ETC_GR_DOC_NO               --기타입고번호
                               ,A.ETC_GR_DOC_LINE_NO          --기타입고라인번호
                               ,A.ITEM_CD                     --품목코드
                               ,C.ITEM_NM
                               ,A.QTY
                               ,A.PRC
                               ,A.AMT
                               ,A.LOC_CD
                               ,A.UNIT_CD
                               ,NVL(A.STRGE_CD, C.GR_STRGE_CD) AS STRGE_CD       --입고창고
                               ,C.ITEM_DSTIN_CD
                               ,D.AVLB_STOCK_QTY                --가용수량
                               ,C.GR_STRGE_CD AS STD_STRGE_CD   --기준창고
                               ,C.GR_STRGE_CD
                               ,A.REF_DOC_NO
                               ,A.REF_DOC_LINE_NO
                               ,A.GR_REASON_CD
                               ,CASE WHEN NVL(A.CANC_ID,'-999') = '-999' THEN 0 ELSE A.QTY END CANC_QTY
                               ,A.RECEIVE_USR_ID
                               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.RECEIVE_USR_ID) AS RECEIVE_USR_NM   --등록자명
                               ,A.REG_DT AS GR_DT
                               ,TO_CHAR(A.REG_DT, 'HH24:MI:SS') AS GR_TIME
                               ,A.CANC_ID
                               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.CANC_ID) AS CANC_USR_NM   --취소자명
                               ,A.CANC_DT
                               ,TO_CHAR(A.CANC_DT, 'HH24:MI:SS') AS CANC_TIME
                               ,A.TAX_DDCT_PRC
                               ,A.TAX_DDCT_AMT
                               ,A.TAX_AMT
                               ,A.DC_RATE
                               ,A.MVT_DOC_YY_MM
                               ,A.MVT_DOC_NO
                               ,A.MVT_DOC_LINE_NO
                               ,NVL(E.QTY, 0) AS RENT_QTY
                               ,NVL(F.QTY, 0) AS RETURN_QTY
                               ,A.GR_STAT_CD
                               ,NVL(D.AVLB_STOCK_QTY,0) + NVL(D.RESV_STOCK_QTY,0) - NVL(D.BORROW_QTY,0) + NVL(D.RENT_QTY,0) AS STOCK_QTY
                               ,NVL(D.BORROW_QTY,0) AS BORROW_QTY
                               ,NVL(D.RENT_QTY,0) AS RENT_QTY
                               ,NVL(D.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY
                               ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
                           FROM DMSDB.PT_0622T A    --기타입고품목정보
                                INNER JOIN  DMSDB.PT_0621T B
                                   ON A.DLR_CD        = B.DLR_CD
                                  AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                INNER JOIN  DMSDB.PT_0201T C    --품목정보
                                   ON A.DLR_CD  = C.DLR_CD
                                  AND A.ITEM_CD = C.ITEM_CD
                                LEFT OUTER JOIN  DMSDB.PT_0301T D    --재고정보
                                   ON A.DLR_CD      = D.DLR_CD
                                  AND A.STRGE_CD    = D.STRGE_CD
                                  AND A.ITEM_CD     = D.ITEM_CD
                                LEFT OUTER JOIN  DMSDB.PT_0612T E
                                  ON A.DLR_CD              = E.DLR_CD
                                 AND A.REF_DOC_NO          = E.ETC_GI_DOC_NO
                                 AND A.REF_DOC_LINE_NO     = E.ETC_GI_DOC_LINE_NO
                                LEFT OUTER JOIN
                                                (
                                                  SELECT   A.DLR_CD
                                                          ,A.REF_DOC_NO
                                                          ,A.REF_DOC_LINE_NO
                                                          ,SUM(A.QTY) AS QTY
                                                    FROM PT_0622T A
                                                   WHERE A.DLR_CD = #{sDlrCd}
                                                     AND A.REF_DOC_NO IS NOT NULL
                                                  GROUP BY A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                                ) F
                                  ON A.DLR_CD = C.DLR_CD
                                 AND A.ETC_GR_DOC_NO = F.REF_DOC_NO
                                 AND A.ETC_GR_DOC_LINE_NO = F.REF_DOC_LINE_NO
                          WHERE A.DLR_CD            = #{sDlrCd}
                            AND A.ETC_GR_DOC_NO     = #{sEtcGrDocNo}
                            ORDER BY A.DLR_CD                      --딜러코드
                                    ,A.ETC_GR_DOC_NO DESC               --기타입고번호
                                    ,A.ETC_GR_DOC_LINE_NO          --기타입고라인번호
                 ) T1
                 WHERE 1=1
                 <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                     AND T1.REG_USR_NM like '%'|| #{sRegUsrNm} ||'%'
                 </if>  --등록자
              ) A
         <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM <![CDATA[<=]]> #{lastIndex}
            AND RNUM <![CDATA[>]]> #{firstIndex}
            </if>
         </where>
    </select>

    <!-- 기초재고입고 V3 count 정보를 조회한다. -->
    <select id="selectReceiveInitMigDataByCnt" parameterType="ReceiveEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveInitMigDataByCnt] */
        SELECT COUNT(*)
        FROM PT_0303OH
        WHERE DLR_CD = #{sDlrCd}
        AND APPLY_YN = 'N'
    </select>

    <!-- 기초재고입고 V3 정보를 조회한다. -->
    <select id="selectReceiveInitMigDataByKey" parameterType="ReceiveEtcSearchVO" resultType="ReceiveEtcItemTrdVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.selectReceiveInitMigDataByKey] */
        SELECT *
        FROM PT_0303OH
        WHERE DLR_CD = #{sDlrCd}
        AND APPLY_YN = 'N'
    </select>

    <!-- 기초재고입고 대상 부품 정보를 확정한다. -->
    <update id="applyReceiveInitItem" parameterType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.applyReceiveInitItem] */
        UPDATE DMSDB.PT_0301OH    --기초입고대상품목정보
          SET  APPLY_YN            = 'Y'                        --입고적용여부
              ,APPLY_DT            = sysdate                    --적용일자
              ,UPDT_USR_ID         = #{regUsrId}                --수정자ID
              ,UPDT_DT             = sysdate                    --수정일자
         WHERE DLR_CD              = #{dlrCd}                   --딜러코드
           AND STRGE_CD            = #{strgeCd}                 --창고코드
           AND ITEM_CD             = #{itemCd}                  --부품번호
    </update>

     <!-- 기초재고입고 대상 부품 정보를 확정한다. -->
    <update id="closingReceiveInitItem" parameterType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.closingReceiveInitItem] */
        UPDATE DMSDB.PT_0301OH    --기초입고대상품목정보
          SET  APPLY_YN            = 'C'                        --입고적용여부
              ,APPLY_DT            = sysdate                    --적용일자
              ,UPDT_USR_ID         = #{regUsrId}                --수정자ID
              ,UPDT_DT             = sysdate                    --수정일자
         WHERE DLR_CD              = #{dlrCd}                   --딜러코드
           AND STRGE_CD            = #{strgeCd}                 --창고코드
           AND ITEM_CD             = #{itemCd}                  --부품번호
    </update>

    <!-- 기초재고입고 대상 부품 정보를 취소한다. -->
    <update id="cancelReceiveInitTargetItem" parameterType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.cancelReceiveInitTargetItem] */
        UPDATE DMSDB.PT_0301OH    --기초입고대상품목정보
          SET  APPLY_YN            = 'N'                        --입고적용여부
              ,APPLY_DT            = null                       --적용일자
              ,UPDT_USR_ID         = #{regUsrId}                --수정자ID
              ,UPDT_DT             = sysdate                    --수정일자
         WHERE DLR_CD              = #{dlrCd}                   --딜러코드
           AND (STRGE_CD,ITEM_CD) in (SELECT STRGE_CD, ITEM_CD
                                        from DMSDB.PT_0622T
                                       where DLR_CD              = #{dlrCd}
                                         AND ETC_GR_DOC_NO       = #{etcGrDocNo})
           AND APPLY_YN            = 'Y'
    </update>

    <!-- 기초재고입고 대상 부품 정보를 전체 취소한다. -->
    <update id="cancelReceiveInitTargetAll" parameterType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.cancelReceiveInitTargetAll] */
        UPDATE DMSDB.PT_0301OH    --기초입고대상품목정보
          SET  APPLY_YN            = 'N'                        --입고적용여부
              ,APPLY_DT            = null                       --적용일자
              ,UPDT_USR_ID         = #{regUsrId}                --수정자ID
              ,UPDT_DT             = sysdate                    --수정일자
         WHERE DLR_CD              = #{dlrCd}                   --딜러코드
    </update>

    <!-- 기초재고입고 확정 실행 프로시저  -->
    <select id="executeReceiveEtcInitProcedure" parameterType="String" statementType="CALLABLE">
    /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.executeReceiveEtcInitProcedure] */
        { CALL SP_PAR_INIT_STOCK_RECEIVE(#{param1, mode=IN, jdbcType=VARCHAR},#{param2, mode=IN, jdbcType=VARCHAR},#{param3, mode=IN, jdbcType=VARCHAR},#{param4, mode=IN, jdbcType=VARCHAR},#{param5, mode=IN, jdbcType=VARCHAR},#{param6, mode=IN, jdbcType=VARCHAR}) }
    </select>

    <!-- 기초재고입고 확정 실행 프로시저  -->
    <select id="executeReceiveEtcInitProcedureTest" parameterType="ReceiveEtcInitProcedureVO" flushCache="true" statementType="CALLABLE" >
    /* [chn.bhmc.dms.par.pcm.service.dao.ReceiveEtcDAO.executeReceiveEtcInitProcedureTest] */
        { CALL SP_PAR_INIT_STOCK_RECEIVE_T(
            #{inDlrCd, mode=IN, jdbcType=VARCHAR},#{inDocNo, mode=IN, jdbcType=VARCHAR},#{inUsrId, mode=IN, jdbcType=VARCHAR},#{inCallMode, mode=IN, jdbcType=VARCHAR},#{inPrCallId, mode=IN, jdbcType=VARCHAR},#{inDebugMod, mode=IN, jdbcType=VARCHAR}
            ,#{returnVal, mode=OUT, jdbcType=INTEGER}
            )
        }
    </select>

</mapper>