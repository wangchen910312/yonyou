<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : IssueEtcDAO_SqlMap.xml
    Description : 기타출고 관리.
    author In Bo Shim
    since 2016. 2. 23.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 02. 23.     Ju Won Lee     최초 생성
-->

<mapper namespace="chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO">

    <!-- 기타출고 헤더 정보를 추가한다. -->
    <insert id="insertIssueEtc" parameterType="IssueEtcVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.insertIssueEtc] */
        INSERT INTO DMSDB.PT_0611T    --기타출고문서헤더정보
        (
          DLR_CD               --딜러코드
         ,ETC_GI_DOC_NO        --기타출고문서번호
         ,STAT_CD              --상태코드
         ,MVT_TP               --수불유형
         ,PLT_CD               --센터코드
         ,BP_CD                --거래처코드
         ,REMARK               --비고
         ,REG_USR_ID           --등록자ID
         ,REG_DT               --등록일자
         ,UPDT_USR_ID
         ,UPDT_DT
        )
        VALUES
        (
          #{dlrCd}               --딜러코드
         ,#{etcGiDocNo}          --기타출고문서번호
         ,#{statCd}              --상태코드
         ,#{mvtTp}               --수불유형
         ,#{pltCd}               --센터코드
         ,#{bpCd}                --거래처코드
         ,#{remark}              --비고
         ,#{regUsrId}            --등록자ID
         ,sysdate                --등록일자
         ,#{regUsrId}            --등록자ID
         ,sysdate                --등록일자
        )
    </insert>

    <!-- 기타출고  부품 정보를 추가한다. -->
    <insert id="insertIssueEtcItem" parameterType="IssueEtcItemVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.insertIssueEtcItem] */
        INSERT INTO DMSDB.PT_0612T    --기타출고문서품목정보
        (
          DLR_CD                    --딜러코드
         ,ETC_GI_DOC_NO             --기타출고문서번호
         ,ETC_GI_DOC_LINE_NO        --기타출고문서라인번호
         ,CANC_YN                   --취소여부
         ,ITEM_CD                   --품목코드
         ,QTY                       --수량
         ,UNIT_CD                   --단위코드
         ,STRGE_CD                  --창고코드
         ,LOC_CD                    --위치코드
         ,PRC                       --단가
         ,AMT                       --금액
         ,DC_RATE                   --할인율
         ,TAX_AMT                   --세액
         ,TAX_DDCT_AMT              --세금공제금액
         ,TAX_DDCT_PRC              --세금공제단가
         ,GI_REASON_CD              --출고사유코드
         ,GI_DT                     --출고일자
         ,GI_STAT_CD                --출고상태
         ,REF_DOC_NO                --참조번호
         ,REF_DOC_LINE_NO           --참조라인번호
         ,REG_USR_ID                --등록자ID
         ,REG_DT                    --등록일자
         ,UPDT_USR_ID
         ,UPDT_DT
        )
        VALUES
        (
          #{dlrCd}                    --딜러코드
         ,#{etcGiDocNo}               --기타출고문서번호
         ,#{etcGiDocLineNo}           --기타출고문서라인번호
         ,#{cancYn}                   --취소여부
         ,#{itemCd}                   --품목코드
         ,#{qty}                      --수량
         ,NVL(#{unitCd},'EA')                   --단위코드
         ,#{strgeCd}                  --창고코드
         ,#{locCd}                    --위치코드
         ,round(#{prc},2)             --단가
         ,round(#{amt},2)             --금액
         ,round(#{dcRate},2)          --할인율
         ,round(#{taxAmt},2)          --세액
         ,round(#{taxDdctAmt},2)      --세금공제금액
         ,round(#{taxDdctPrc},2)      --세금공제단가
         ,#{giReasonCd}               --출고사유코드
         ,sysdate
         ,#{giStatCd}                 --출고상태
         ,#{refDocNo}                 --참조번호
         ,#{refDocLineNo}             --참조라인번호
         ,#{regUsrId}                 --등록자ID
         ,sysdate                    --등록일자
         ,#{regUsrId}                 --등록자ID
         ,sysdate                    --등록일자
        )
    </insert>

    <!-- 기타출고  인터페이스 부품 정보를 추가한다. -->
    <insert id="insertIssueEtcInterfaceItem" parameterType="IssueEtcItemVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.insertIssueEtcInterfaceItem] */
        INSERT INTO DMSDB.PT_0612I    --기타출고인터페이스(조달출고)
        (
          DLR_CD                    --딜러코드
         ,DLR_CD_RCV                --입고대상딜러코드
         ,ETC_GI_DOC_NO             --기타출고문서번호
         ,ETC_GI_DOC_LINE_NO        --기타출고문서라인번호
         ,CANC_YN                   --취소여부
         ,ITEM_CD                   --품목코드
         ,QTY                       --수량
         ,PRC                       --단가
         ,AMT                       --금액
         ,REASON_CD                 --출고사유코드
         ,ISS_DT                    --출고일자
         ,ISS_TM                    --출고시간
         ,PRC_WOT                   --세금제외가격
         ,TAX                       --세금
         ,REG_USR_ID                --등록자ID
         ,REG_DT                    --등록일자
        )
        VALUES
        (
          #{dlrCd}                    --딜러코드
         ,#{bpCd}                     --입고대상딜러코드
         ,#{etcGiDocNo}               --기타출고문서번호
         ,#{etcGiDocLineNo}           --기타출고문서라인번호
         ,#{cancYn}                   --취소여부
         ,#{itemCd}                   --품목코드
         ,#{qty}                      --수량
         ,round(#{prc},2)             --단가
         ,round(#{amt},2)             --금액
         ,#{giReasonCd}               --출고사유코드
         ,to_char(sysdate,'YYYYMMDD') --출고일자
         ,to_char(sysdate,'HH24MISS') --출고시간
         ,round(#{taxDdctAmt},2)      --세금제외가격
         ,round(#{taxAmt},2)          --세금
         ,#{regUsrId}                 --등록자ID
         ,sysdate                     --등록일자
        )
    </insert>

     <!-- 기타출고 헤더 정보를 수정한다. -->
    <update id="updateIssueEtc" parameterType="IssueEtcVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.updateIssueEtc] */
        UPDATE DMSDB.PT_0611T    --기타출고문서헤더정보
          SET  STAT_CD       = #{statCd}              --거래처코드
              ,BP_CD         = #{bpCd}                --거래처코드
              ,REMARK        = #{remark}              --비고
              ,UPDT_USR_ID   = #{regUsrId}           --수정자ID
              ,UPDT_DT       = sysdate                --수정일자
         WHERE DLR_CD        = #{dlrCd}               --딜러코드
           AND ETC_GI_DOC_NO = #{etcGiDocNo}          --기타출고문서번호
    </update>

    <!-- 기타입고 헤더 정보를 수정일자정보를 수정한다. -->
    <update id="updateIssueEtcUpdtDt" parameterType="IssueEtcVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.updateIssueEtcUpdtDt] */
        UPDATE DMSDB.PT_0611T    --기타출고문서헤더정보
          SET  UPDT_USR_ID   = #{regUsrId}           --수정자ID
              ,UPDT_DT       = sysdate                --수정일자
         WHERE DLR_CD        = #{dlrCd}               --딜러코드
           AND ETC_GI_DOC_NO = #{etcGiDocNo}          --기타출고문서번호
    </update>

    <!-- 기타출고 헤더 정보를 취소처리한다. -->
    <update id="cancelIssueEtc" parameterType="IssueEtcVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.cancelIssueEtc] */
        UPDATE DMSDB.PT_0611T    --기타출고문서헤더정보
          SET  STAT_CD       = #{statCd}              --거래처코드
              ,UPDT_USR_ID   = #{regUsrId}           --수정자ID
              ,UPDT_DT       = sysdate                --수정일자
         WHERE DLR_CD        = #{dlrCd}               --딜러코드
           AND ETC_GI_DOC_NO = #{etcGiDocNo}          --기타출고문서번호
    </update>

    <!-- 기타출고 부품 정보를 확정처리한다. -->
    <update id="updateCnfmIssueEtcItem" parameterType="IssueEtcItemVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.updateCnfmIssueEtcItem] */
        UPDATE DMSDB.PT_0612T    --기타출고품목정보
          SET  GI_STAT_CD          = #{giStatCd}
              ,UNIT_CD             = #{unitCd}                  --단위
              ,PRC                 = round(#{prc},2)            --가격
              ,AMT                 = round(#{amt},2)            --금액
              ,TAX_AMT             = round(#{taxAmt},2)         --세액
              ,TAX_DDCT_PRC        = round(#{taxDdctPrc},2)     --세금공제단가
              ,TAX_DDCT_AMT        = round(#{taxDdctAmt},2)     --세금공제금액
              ,QTY                 = #{qty}                     --수량
              ,STRGE_CD            = #{strgeCd}                 --출고창고
              ,LOC_CD              = #{locCd}                   --출고로케이션
              ,GI_REASON_CD        = #{giReasonCd}              --출고사유코드
              ,UPDT_USR_ID         = #{regUsrId}                --수정자ID
              ,UPDT_DT             = sysdate                    --수정일자
         WHERE DLR_CD              = #{dlrCd}                   --딜러코드
           AND ETC_GI_DOC_NO       = #{etcGiDocNo}              --기타출고번호
           AND ETC_GI_DOC_LINE_NO  = #{etcGiDocLineNo}          --기타출고라인번호
    </update>

    <!-- 기타출고 부품 정보를 수정한다. -->
    <update id="updateIssueEtcItem" parameterType="IssueEtcItemVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.updateIssueEtcItem] */
        UPDATE DMSDB.PT_0612T    --기타출고품목정보
          SET  UNIT_CD             = #{unitCd}                  --단위
              ,PRC                 = round(#{prc},2)            --가격
              ,AMT                 = round(#{amt},2)            --금액
              ,TAX_AMT             = round(#{taxAmt},2)         --세액
              ,TAX_DDCT_PRC        = round(#{taxDdctPrc},2)     --세금공제단가
              ,TAX_DDCT_AMT        = round(#{taxDdctAmt},2)     --세금공제금액
              ,QTY                 = #{qty}                     --수량
              ,STRGE_CD            = #{strgeCd}                 --출고창고
              ,LOC_CD              = #{locCd}                   --출고로케이션
              ,GI_REASON_CD        = #{giReasonCd}              --출고사유코드
              ,UPDT_USR_ID         = #{regUsrId}                --수정자ID
              ,UPDT_DT             = sysdate                    --수정일자
         WHERE DLR_CD              = #{dlrCd}                   --딜러코드
           AND ETC_GI_DOC_NO       = #{etcGiDocNo}              --기타출고번호
           AND ETC_GI_DOC_LINE_NO  = #{etcGiDocLineNo}        --기타출고라인번호
    </update>

    <!-- 기타출고 디테일 정보를 전체 취소처리한다. -->
    <update id="cancelIssueEtcItemAll" parameterType="IssueEtcItemVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.cancelIssueEtcItemAll] */
        UPDATE DMSDB.PT_0612T    --기타출고문서헤더정보
          SET  CANC_YN       = 'Y'
              ,GI_STAT_CD    = #{giStatCd}             --상태코드
              ,CANC_ID       = #{regUsrId}            --취소자
              ,CANC_DT       = sysdate                --취소일자
              ,UPDT_USR_ID   = #{regUsrId}           --수정자ID
              ,UPDT_DT       = sysdate                --수정일자
         WHERE DLR_CD        = #{dlrCd}               --딜러코드
           AND ETC_GI_DOC_NO = #{etcGiDocNo}          --기타출고문서번호
    </update>

    <!-- 기타출고 부품 정보를 삭제한다. -->
    <update id="deleteIssueEtcItem" parameterType="IssueEtcItemVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.deleteIssueEtcItem] */
        UPDATE DMSDB.PT_0612T    --기타출고품목정보
          SET  CANC_YN             = 'Y'                         --취소여부
              ,CANC_ID             = #{regUsrId}                 --수정자ID
              ,GI_STAT_CD          = #{giStatCd}                 --취소상태(03)
              ,CANC_DT             = sysdate
              ,UPDT_USR_ID         = #{regUsrId}                 --수정자ID
              ,UPDT_DT             = sysdate                     --수정일자
         WHERE DLR_CD              = #{dlrCd}                    --딜러코드
           AND ETC_GI_DOC_NO       = #{etcGiDocNo}               --기타출고번호
           AND ETC_GI_DOC_LINE_NO  = #{etcGiDocLineNo}         --기타출고라인번호
    </update>

     <!-- 기타출고 부품 정보를 삭제한다.(수불발생안한 등록 부품 삭제) -->
    <delete id="deleteRegIssueEtcItem" parameterType="IssueEtcItemVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.deleteRegIssueEtcItem] */
        DELETE FROM DMSDB.PT_0612T    --기타출고품목정보
         WHERE DLR_CD              = #{dlrCd}                    --딜러코드
           AND ETC_GI_DOC_NO       = #{etcGiDocNo}               --기타출고번호
           AND ETC_GI_DOC_LINE_NO  = #{etcGiDocLineNo}         --기타출고라인번호
    </delete>

    <!-- 기타출고 부품 정보의 수불 정보를 반영한다. -->
    <update id="updateIssueEtcItemMvtInfo" parameterType="IssueEtcItemVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.updateIssueEtcItemMvtInfo] */
        UPDATE DMSDB.PT_0612T    --기타출고품목정보
          SET  MVT_DOC_YY_MM       = #{mvtDocYyMm}               --수불문서년월
              ,MVT_DOC_NO          = #{mvtDocNo}                 --수불문서번호
              ,MVT_DOC_LINE_NO     = #{mvtDocLineNo}             --수불문서라인번호
              ,UPDT_USR_ID         = #{regUsrId}                 --수정자ID
              ,UPDT_DT             = sysdate                     --수정일자
         WHERE DLR_CD              = #{dlrCd}                    --딜러코드
           AND ETC_GI_DOC_NO       = #{etcGiDocNo}               --기타출고번호
           AND ETC_GI_DOC_LINE_NO  = #{etcGiDocLineNo}         --기타출고라인번호
    </update>

    <!-- 기타출고인터페이스 부품 정보를 수정한다. -->
    <update id="updateIssueEtcItemInfc" parameterType="IssueEtcItemVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.updateIssueEtcItemInfc] */
        UPDATE DMSDB.PT_0612I      --기타출고인터페이스품목정보
          SET  RCV_ID              = #{rcvId}                   --수령인ID
              ,RCV_DT              = #{rcvDt}                   --수령일
         WHERE DLR_CD              = #{dlrCd}                   --딜러코드
           AND ETC_GI_DOC_NO       = #{etcGiDocNo}              --기타출고번호
           AND ETC_GI_DOC_LINE_NO  = #{etcGiDocLineNo}          --기타출고라인번호
           AND DLR_CD_RCV          = #{bpCd}                    --타딜러
    </update>

    <!-- 기타출고 헤더 정보를 조회한다. -->
    <select id="selectIssueEtcByKey" parameterType="IssueEtcSearchVO" resultType="IssueEtcVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcByKey] */
        SELECT
                A.DLR_CD                    --딜러코드
               ,A.ETC_GI_DOC_NO             --기타출고번호
               ,A.STAT_CD                   --상태코드
               ,A.REG_DT                    --일자
               ,A.MVT_TP                    --수불유형
               ,A.BP_CD                     --거래처
               ,DECODE(C.BP_NM, NULL, D.DLR_NM, C.BP_NM) AS BP_NM        --거래처명
               ,NVL(B.ITEM_CNT,0) AS ITEM_CNT
               ,NVL(B.ITEM_QTY,0) AS ITEM_QTY
               ,NVL(B.GI_TAX_DDCT_AMT,0) AS GI_TAX_DDCT_AMT
               ,NVL(B.GI_TOT_AMT,0) AS GI_TOT_AMT
               ,A.REMARK                    --비고
               ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
          FROM DMSDB.PT_0611T A    --기타출고헤더정보
                 LEFT OUTER JOIN
                      (
                      SELECT   A.DLR_CD
                              ,A.ETC_GI_DOC_NO
                              ,COUNT(*) AS ITEM_CNT
                              ,SUM(NVL(A.QTY,0)) AS ITEM_QTY
                              ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS GI_TAX_DDCT_AMT
                              ,SUM(NVL(A.AMT,0)) AS GI_TOT_AMT
                        FROM   DMSDB.PT_0612T A    --기타입출고부품정보
                       WHERE   A.DLR_CD        = #{sDlrCd} --딜러코드
                         AND   A.ETC_GI_DOC_NO = #{sEtcGiDocNo}  --기타출고번호
                         AND   A.CANC_YN      != 'Y'
                         AND   A.CANC_DT IS NULL
                         AND   A.GI_STAT_CD   != '03'  --취소
                        GROUP BY A.DLR_CD
                                ,A.ETC_GI_DOC_NO
                       ) B
                   ON A.DLR_CD        = B.DLR_CD
                  AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                 LEFT OUTER JOIN DMSDB.PT_0211T C
                    ON A.DLR_CD = C.DLR_CD
                   AND A.BP_CD  = C.BP_CD
                 LEFT OUTER JOIN
                      (
                      SELECT  DLR_CD
                             ,DLR_NM
                      FROM DMSDB.CM_0101T
                      ) D
                    ON A.BP_CD = D.DLR_CD
         WHERE A.DLR_CD           = #{sDlrCd}
           AND A.ETC_GI_DOC_NO    = #{sEtcGiDocNo}
    </select>

    <!-- 기타출고 부품 정보를 조회한다. -->
    <select id="selectIssueEtcItemByKey" parameterType="IssueEtcSearchVO" resultType="IssueEtcItemVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcItemByKey] */
         SELECT
                A.DLR_CD                      --딜러코드
               ,A.ETC_GI_DOC_NO               --기타출고번호
               ,A.ETC_GI_DOC_LINE_NO          --기타출고라인번호
               ,A.ITEM_CD                     --품목코드
               ,C.ITEM_NM
               ,C.ITEM_DSTIN_CD
               ,D.AVLB_STOCK_QTY              --가용수량
               ,A.STRGE_CD AS STD_STRGE_CD    --기준창고
               ,A.STRGE_CD                    --출고창고
               ,A.QTY
               ,A.PRC
               ,A.AMT
               ,A.TAX_AMT
               ,A.UNIT_CD
               ,A.LOC_CD
               ,A.REF_DOC_NO
               ,A.REF_DOC_LINE_NO
               ,A.GI_REASON_CD
               ,E.RETL_PRC
               ,A.RECEIVE_ID
               ,CASE WHEN NVL(A.CANC_ID,'-999') = '-999' THEN 0 ELSE A.QTY END CANC_QTY
               ,A.CANC_ID
               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.CANC_ID) AS CANC_USR_NM   --취소자명
               ,A.GI_DT
               ,TO_CHAR(A.GI_DT, 'HH24:MI:SS') AS GI_TIME
               ,A.CANC_DT
               ,TO_CHAR(A.CANC_DT, 'HH24:MI:SS') AS CANC_TIME
               ,A.DC_RATE
               ,A.TAX_DDCT_PRC
               ,A.TAX_AMT
               ,A.TAX_DDCT_AMT
               ,A.MVT_DOC_YY_MM
               ,A.MVT_DOC_NO
               ,A.MVT_DOC_LINE_NO
               ,F.QTY AS RETURN_QTY
               ,A.REG_USR_ID
               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   --등록자명
               ,A.GI_STAT_CD
               ,NVL(D.AVLB_STOCK_QTY,0) + NVL(D.RESV_STOCK_QTY,0) - NVL(D.BORROW_QTY,0) + NVL(D.RENT_QTY,0) AS STOCK_QTY
               ,NVL(D.BORROW_QTY,0) AS BORROW_QTY
               ,NVL(D.RENT_QTY,0) AS RENT_QTY
               ,NVL(D.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY
           FROM DMSDB.PT_0612T A    --기타출고품목정보
                INNER JOIN  DMSDB.PT_0611T B
                   ON A.DLR_CD        = B.DLR_CD
                  AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                INNER JOIN  DMSDB.PT_0201T C    --품목정보
                   ON A.DLR_CD  = C.DLR_CD
                  AND A.ITEM_CD = C.ITEM_CD
                LEFT OUTER JOIN  DMSDB.PT_0301T D    --재고정보
                   ON A.DLR_CD      = D.DLR_CD
                  AND A.STRGE_CD    = D.STRGE_CD
                  AND A.ITEM_CD     = D.ITEM_CD
                LEFT OUTER JOIN  (SELECT   DLR_CD
                                  ,ITEM_CD
                                  ,MAX(PRC_TP) AS PRC_TP
                                  ,MAX(LINE_NO) AS LINE_NO
                                  ,MAX(NVL(RETL_PRC,0)) AS RETL_PRC
                                  ,MAX(NVL(WHSL_PRC,0)) AS WHSL_PRC
                                  ,MAX(NVL(SALE_PRC_AMT,0)) AS SALE_PRC_AMT
                            FROM   PT_0214T
                           WHERE   DLR_CD = #{sDlrCd}
                             AND   DEL_YN != 'Y'
                          GROUP BY DLR_CD, ITEM_CD) E --가격
                   ON A.DLR_CD      = E.DLR_CD
                  AND A.ITEM_CD     = E.ITEM_CD
                LEFT OUTER JOIN
                    (
                      SELECT   A.DLR_CD
                              ,A.REF_DOC_NO
                              ,A.REF_DOC_LINE_NO
                              ,SUM(A.QTY) AS QTY
                        FROM PT_0622T A
                       WHERE A.DLR_CD = #{sDlrCd}
                         AND A.REF_DOC_NO IS NOT NULL
                      GROUP BY A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                    ) F
                  ON A.DLR_CD             = F.DLR_CD
                 AND A.ETC_GI_DOC_NO      = F.REF_DOC_NO
                 AND A.ETC_GI_DOC_LINE_NO = F.REF_DOC_LINE_NO
          WHERE A.DLR_CD            = #{sDlrCd}
            AND A.ETC_GI_DOC_NO     = #{sEtcGiDocNo}
           ORDER BY A.DLR_CD                      --딜러코드
                   ,A.ETC_GI_DOC_NO  DESC         --기타출고번호
                   ,A.ETC_GI_DOC_LINE_NO
    </select>

    <!-- 기타출고 리스트정보를 조회한다. -->
    <select id="selectIssueEtcsByCondition" parameterType="IssueEtcSearchVO" resultType="IssueEtcVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcsByCondition] */
          SELECT    A.*
            FROM
                 (
              SELECT    ROWNUM AS RNUM
                       ,T1.*
                FROM
                     (
                         SELECT A.DLR_CD                --딜러코드
                               ,A.MVT_TP                --수불유형
                               ,A.ETC_GI_DOC_NO         --기타출고문서번호
                               ,A.BP_CD                 --거래처코드
                               ,DECODE(C.BP_NM, NULL, E.DLR_NM, C.BP_NM) AS BP_NM                 --거래처
                               ,A.STAT_CD               --상태코드
                               ,A.REG_DT                --일자
                               ,A.REG_USR_ID            --등록인
                               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   --등록자명
                               ,A.REMARK                --비고
                               ,NVL(B.ITEM_CNT,0) AS ITEM_CNT
                               ,NVL(B.ITEM_QTY,0) AS ITEM_QTY
                               ,NVL(B.GI_TOT_AMT,0) AS GI_TOT_AMT
                               ,NVL(B.GI_TAX_DDCT_AMT,0) AS GI_TAX_DDCT_AMT
                               ,NVL(D.RETURN_ITEM_CNT,0) AS RETURN_ITEM_CNT
                               ,NVL(D.RETURN_ITEM_QTY,0) AS RETURN_ITEM_QTY
                               ,NVL(D.RETURN_TOT_AMT,0) AS RETURN_TOT_AMT
                               ,NVL(D.RETURN_TAX_DDCT_AMT,0) AS RETURN_TAX_DDCT_AMT
                               ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
                          FROM DMSDB.PT_0611T A    --기타출고헤더정보
                                 LEFT OUTER JOIN
                                      (
                                      SELECT   A.DLR_CD
                                              ,A.ETC_GI_DOC_NO
                                              ,COUNT(*) AS ITEM_CNT
                                              ,SUM(NVL(A.QTY,0)) AS ITEM_QTY
                                              ,SUM(NVL(A.AMT,0)) AS GI_TOT_AMT
                                              ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS GI_TAX_DDCT_AMT
                                        FROM   DMSDB.PT_0612T A    --기타출고부품정보
                                       WHERE   A.DLR_CD = #{sDlrCd}  --딜러코드
                                         <if test='sEtcGiDocNo != null and sEtcGiDocNo != ""'>
                                             AND A.ETC_GI_DOC_NO = #{sEtcGiDocNo}
                                         </if>        --기타출고번호
                                         AND   A.CANC_YN     != 'Y'
                                         AND   A.GI_STAT_CD  != '03'
                                         AND   A.CANC_DT    IS NULL
                                         AND   A.RETURN_DT  IS NULL
                                         AND   A.RECEIVE_DT IS NULL
                                        GROUP BY A.DLR_CD
                                                ,A.ETC_GI_DOC_NO
                                       ) B
                                    ON A.DLR_CD        = B.DLR_CD
                                   AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                                 LEFT OUTER JOIN DMSDB.PT_0211T C
                                        ON A.DLR_CD = C.DLR_CD
                                       AND A.BP_CD  = C.BP_CD
                                 LEFT OUTER JOIN
                                      (
                                      SELECT   A.DLR_CD
                                              ,A.REF_DOC_NO
                                              ,COUNT(*) AS RETURN_ITEM_CNT
                                              ,SUM(NVL(A.QTY,0)) AS RETURN_ITEM_QTY
                                              ,SUM(NVL(A.AMT,0)) AS RETURN_TOT_AMT
                                              ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS RETURN_TAX_DDCT_AMT
                                        FROM   DMSDB.PT_0622T A    --기타입고부품정보
                                       WHERE   A.DLR_CD = #{sDlrCd}  --딜러코드
                                       <if test='sEtcGiDocNo != null and sEtcGiDocNo != ""'>
                                           AND A.REF_DOC_NO like '%'|| #{sEtcGiDocNo} ||'%'
                                       </if>        --기타출고번호
                                         AND   A.CANC_YN    != 'Y'
                                         AND   A.GR_STAT_CD != '03'
                                         AND   A.CANC_DT IS NULL
                                        GROUP BY A.DLR_CD
                                                ,A.REF_DOC_NO
                                       ) D
                                    ON A.DLR_CD        = D.DLR_CD
                                   AND A.ETC_GI_DOC_NO = D.REF_DOC_NO
                                 LEFT OUTER JOIN
                                      (
                                      SELECT  DLR_CD
                                             ,DLR_NM
                                      FROM DMSDB.CM_0101T
                                      ) E
                                    ON A.BP_CD = E.DLR_CD
                     WHERE A.DLR_CD      = #{sDlrCd}  --딜러코드
                       <if test='sEtcGiDocNo != null and sEtcGiDocNo != ""'>
                           AND A.ETC_GI_DOC_NO LIKE '%'|| #{sEtcGiDocNo} ||'%'
                       </if>  --기타출고번호
                       <if test='sMvtTp != null and sMvtTp != ""'>
                           AND A.MVT_TP = #{sMvtTp}
                       </if>        --수불유형
                       <if test='sStatCd != null and sStatCd != ""'>
                           AND A.STAT_CD = #{sStatCd}
                       </if>        --상태
                       <if test='sRegUsrId != null and sRegUsrId != ""'>
                           AND A.REG_USR_ID like '%'|| #{sRegUsrId} ||'%'
                       </if>  --등록자
                       <if test='sRegDtFr != null'>
                           AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                       </if>
                       <if test='sRegDtTo != null'>
                           AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                       </if>
                       <if test='sRemark != null and sRemark != ""'>
                           AND A.REMARK like '%'|| #{sRemark} ||'%'
                       </if>  --비고
                     ORDER BY
                     <choose>
                         <when test='sort != null'>
                             <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                 <choose>
                                     <when test='item.field == "etcGiDocNo"'> A.ETC_GI_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "statCd"'> A.STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "regDt"'> A.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <otherwise>
                                       A.DLR_CD ASC
                                      ,A.ETC_GI_DOC_NO DESC
                                     </otherwise>
                                 </choose>
                             </foreach>
                         </when>
                         <otherwise>
                           A.DLR_CD ASC
                          ,A.ETC_GI_DOC_NO DESC
                         </otherwise>
                     </choose>
                 ) T1
                 WHERE 1=1
                 <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                     AND T1.REG_USR_NM like '%'|| #{sRegUsrNm} ||'%'
                 </if>  --등록자
              ) A
             <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
             </where>
    </select>

    <!-- 기타출고 리스트정보를 조회한다. -->
    <select id="selectIssueEtcsByConditionCnt" parameterType="IssueEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcsByConditionCnt] */
             SELECT COUNT(*)
               FROM
                 (
                     SELECT A.DLR_CD                --딜러코드
                           ,A.MVT_TP                --수불유형
                           ,A.ETC_GI_DOC_NO         --기타출고문서번호
                           ,A.BP_CD                 --거래처코드
                           ,C.BP_NM                 --거래처
                           ,A.STAT_CD               --상태코드
                           ,A.REG_DT                --일자
                           ,A.REG_USR_ID            --등록인
                           ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   --등록자명
                           ,A.REMARK                --비고
                           ,NVL(B.ITEM_CNT,0) AS ITEM_CNT
                           ,NVL(B.ITEM_QTY,0) AS ITEM_QTY
                           ,NVL(B.GI_TOT_AMT,0) AS GI_TOT_AMT
                           ,NVL(B.GI_TAX_DDCT_AMT,0) AS GI_TAX_DDCT_AMT
                           ,NVL(D.RETURN_ITEM_CNT,0) AS RETURN_ITEM_CNT
                           ,NVL(D.RETURN_ITEM_QTY,0) AS RETURN_ITEM_QTY
                           ,NVL(D.RETURN_TOT_AMT,0) AS RETURN_TOT_AMT
                           ,NVL(D.RETURN_TAX_DDCT_AMT,0) AS RETURN_TAX_DDCT_AMT
                           ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
                      FROM DMSDB.PT_0611T A    --기타출고헤더정보
                             LEFT OUTER JOIN
                                  (
                                  SELECT   A.DLR_CD
                                          ,A.ETC_GI_DOC_NO
                                          ,COUNT(*) AS ITEM_CNT
                                          ,SUM(NVL(A.QTY,0)) AS ITEM_QTY
                                          ,SUM(NVL(A.AMT,0)) AS GI_TOT_AMT
                                          ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS GI_TAX_DDCT_AMT
                                    FROM   DMSDB.PT_0612T A    --기타출고부품정보
                                   WHERE   A.DLR_CD = #{sDlrCd}  --딜러코드
                                     <if test='sEtcGiDocNo != null and sEtcGiDocNo != ""'>
                                         AND A.ETC_GI_DOC_NO = #{sEtcGiDocNo}
                                     </if>        --기타출고번호
                                     AND   A.CANC_YN     != 'Y'
                                     AND   A.GI_STAT_CD  != '03'
                                     AND   A.CANC_DT    IS NULL
                                     AND   A.RETURN_DT  IS NULL
                                     AND   A.RECEIVE_DT IS NULL
                                    GROUP BY A.DLR_CD
                                            ,A.ETC_GI_DOC_NO
                                   ) B
                                ON A.DLR_CD        = B.DLR_CD
                               AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                             LEFT OUTER JOIN DMSDB.PT_0211T C
                                    ON A.DLR_CD = C.DLR_CD
                                   AND A.BP_CD  = C.BP_CD
                             LEFT OUTER JOIN
                                  (
                                  SELECT   A.DLR_CD
                                          ,A.REF_DOC_NO
                                          ,COUNT(*) AS RETURN_ITEM_CNT
                                          ,SUM(NVL(A.QTY,0)) AS RETURN_ITEM_QTY
                                          ,SUM(NVL(A.AMT,0)) AS RETURN_TOT_AMT
                                          ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS RETURN_TAX_DDCT_AMT
                                    FROM   DMSDB.PT_0622T A    --기타입고부품정보
                                   WHERE   A.DLR_CD = #{sDlrCd}  --딜러코드
                                   <if test='sEtcGiDocNo != null and sEtcGiDocNo != ""'>
                                       AND A.REF_DOC_NO like '%'|| #{sEtcGiDocNo} ||'%'
                                   </if>        --기타출고번호
                                     AND   A.CANC_YN    != 'Y'
                                     AND   A.GR_STAT_CD != '03'
                                     AND   A.CANC_DT IS NULL
                                    GROUP BY A.DLR_CD
                                            ,A.REF_DOC_NO
                                   ) D
                                ON A.DLR_CD        = D.DLR_CD
                               AND A.ETC_GI_DOC_NO = D.REF_DOC_NO
                 WHERE A.DLR_CD      = #{sDlrCd}  --딜러코드
                   <if test='sEtcGiDocNo != null and sEtcGiDocNo != ""'>
                       AND A.ETC_GI_DOC_NO LIKE '%'|| #{sEtcGiDocNo} ||'%'
                   </if>  --기타출고번호
                   <if test='sMvtTp != null and sMvtTp != ""'>
                       AND A.MVT_TP = #{sMvtTp}
                   </if>        --수불유형
                   <if test='sStatCd != null and sStatCd != ""'>
                       AND A.STAT_CD = #{sStatCd}
                   </if>        --상태
                   <if test='sRegUsrId != null and sRegUsrId != ""'>
                       AND A.REG_USR_ID like '%'|| #{sRegUsrId} ||'%'
                   </if>  --등록자
                   <if test='sRegDtFr != null'>
                       AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                   </if>
                   <if test='sRegDtTo != null'>
                       AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                   </if>
                   <if test='sRemark != null and sRemark != ""'>
                       AND A.REMARK like '%'|| #{sRemark} ||'%'
                   </if>  --비고
             ) T1
             WHERE 1=1
             <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                 AND T1.REG_USR_NM like '%'|| #{sRegUsrNm} ||'%'
             </if>  --등록자
    </select>

       <!-- 기타출고 정보 Max 라인번호를 조회한다. -->
    <select id="selectIssueEtcMaxLineNo" parameterType="IssueEtcVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcMaxLineNo] */
        SELECT NVL(max(A.ETC_GI_DOC_LINE_NO),0) + 1
          FROM DMSDB.PT_0612T A    --기타출고부품정보
         WHERE A.DLR_CD             = #{dlrCd}                 --딜러코드
           AND A.ETC_GI_DOC_NO      = #{etcGiDocNo}
    </select>

    <!-- 기타입고(차입입고 시)팝업 부품 정보(대여출고)를 조회한다. -->
    <select id="selectIssueEtcRentalPop" parameterType="IssueEtcSearchVO" resultType="IssueEtcItemVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcRentalPop] */
                SELECT   A.DLR_CD
                        ,A.ETC_GI_DOC_NO
                        ,B.ETC_GI_DOC_LINE_NO
                        ,A.PLT_CD
                        ,A.BP_CD
                        ,E.BP_NM
                        ,B.ITEM_CD
                        ,F.ITEM_NM
                        ,B.QTY AS RENT_QTY
                        ,B.UNIT_CD
                        ,B.STRGE_CD
                        ,B.LOC_CD
                        ,B.PRC
                        ,B.AMT
                        ,B.DC_RATE
                        ,B.TAX_DDCT_PRC
                        ,B.TAX_AMT
                        ,B.TAX_DDCT_AMT
                        ,D.AVLB_STOCK_QTY
                  FROM   PT_0611T A
                           INNER JOIN PT_0612T B
                             ON A.DLR_CD        = B.DLR_CD
                            AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                           LEFT OUTER JOIN  DMSDB.PT_0301T D    --재고정보
                              ON A.DLR_CD      = D.DLR_CD
                             AND B.STRGE_CD    = D.STRGE_CD
                             AND B.ITEM_CD     = D.ITEM_CD
                           LEFT OUTER JOIN DMSDB.PT_0211T E
                              ON A.DLR_CD = E.DLR_CD
                             AND A.BP_CD  = E.BP_CD
                           LEFT OUTER JOIN  DMSDB.PT_0201T F              --품목정보
                             ON B.DLR_CD  = F.DLR_CD
                            AND B.ITEM_CD = F.ITEM_CD
                 WHERE   A.MVT_TP   = #{sMvtTp}
                   AND   A.DLR_CD   = #{sBpCd}
                   AND   A.BP_CD    = #{sDlrCd}
                   AND   B.CANC_YN != 'Y'
                   <if test='sRegDtFr != null'>
                        AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                   </if>
                   <if test='sRegDtTo != null'>
                        AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                   </if>
                   ORDER BY A.DLR_CD
                           ,A.ETC_GI_DOC_NO  DESC
                           ,B.ETC_GI_DOC_LINE_NO
     </select>

    <!-- 기타입고(차입입고 시)팝업 부품 정보 Count를 조회한다. -->
    <select id="selectIssueEtcRentalPopCnt" parameterType="IssueEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcRentalPopCnt] */
            SELECT   COUNT(*)
              FROM   PT_0611T A
                       INNER JOIN PT_0612T B
                         ON A.DLR_CD        = B.DLR_CD
                        AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                       LEFT OUTER JOIN DMSDB.PT_0211T E
                         ON A.DLR_CD = E.DLR_CD
                        AND A.BP_CD  = E.BP_CD
                       LEFT OUTER JOIN  DMSDB.PT_0201T F              --품목정보
                         ON B.DLR_CD  = F.DLR_CD
                        AND B.ITEM_CD = F.ITEM_CD
             WHERE   A.MVT_TP   = #{sMvtTp}
               AND   A.DLR_CD   = #{sBpCd}
               AND   A.BP_CD    = #{sDlrCd}
               AND   B.CANC_YN != 'Y'
               <if test='sRegDtFr != null'>
                    AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
               </if>
               <if test='sRegDtTo != null'>
                    AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
               </if>
    </select>

    <!-- 기타입고(대여반환입고 시)팝업 부품 정보(대여출고)를 조회한다. -->
    <select id="selectIssueEtcReturnPop" parameterType="IssueEtcSearchVO" resultType="IssueEtcItemVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcReturnPop] */
         SELECT  A.DLR_CD
                ,A.ETC_GI_DOC_NO
                ,A.ETC_GI_DOC_LINE_NO
                ,A.PLT_CD
                ,A.BP_CD
                ,A.BP_NM
                ,A.ITEM_CD
                ,A.ITEM_NM
                ,A.RENT_QTY
                ,A.RETURN_QTY
                ,(A.RENT_QTY - A.RETURN_QTY) AS REMAIN_QTY
                ,A.UNIT_CD
                ,A.STRGE_CD
                ,A.LOC_CD
                ,A.PRC
                ,A.AMT
                ,A.DC_RATE
                ,A.TAX_DDCT_PRC
                ,A.TAX_AMT
                ,A.TAX_DDCT_AMT
                ,A.AVLB_STOCK_QTY
           FROM
               (
                SELECT   A.DLR_CD
                        ,A.ETC_GI_DOC_NO
                        ,B.ETC_GI_DOC_LINE_NO
                        ,A.PLT_CD
                        ,A.BP_CD
                        ,E.BP_NM
                        ,B.ITEM_CD
                        ,F.ITEM_NM
                        ,B.QTY AS RENT_QTY
                        ,NVL(C.QTY, 0) AS RETURN_QTY
                        ,B.UNIT_CD
                        ,B.STRGE_CD
                        ,B.LOC_CD
                        ,B.PRC
                        ,B.AMT
                        ,B.DC_RATE
                        ,B.TAX_DDCT_PRC
                        ,B.TAX_AMT
                        ,B.TAX_DDCT_AMT
                        ,D.AVLB_STOCK_QTY
                  FROM   PT_0611T A
                           INNER JOIN PT_0612T B
                             ON A.DLR_CD        = B.DLR_CD
                            AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                           INNER JOIN  DMSDB.PT_0201T F              --품목정보
                             ON B.DLR_CD  = F.DLR_CD
                            AND B.ITEM_CD = F.ITEM_CD
                           LEFT OUTER JOIN
                                (
                                  SELECT   A.DLR_CD
                                          ,A.REF_DOC_NO
                                          ,A.REF_DOC_LINE_NO
                                          ,SUM(A.QTY) AS QTY
                                    FROM PT_0622T A
                                   WHERE A.DLR_CD = #{sDlrCd}
                                     AND A.REF_DOC_NO IS NOT NULL
                                  GROUP BY A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                ) C
                              ON A.DLR_CD             = C.DLR_CD
                             AND B.ETC_GI_DOC_NO      = C.REF_DOC_NO
                             AND B.ETC_GI_DOC_LINE_NO = C.REF_DOC_LINE_NO
                           LEFT OUTER JOIN  DMSDB.PT_0301T D    --재고정보
                              ON A.DLR_CD      = D.DLR_CD
                             AND B.STRGE_CD    = D.STRGE_CD
                             AND B.ITEM_CD     = D.ITEM_CD
                            LEFT OUTER JOIN DMSDB.PT_0211T E
                              ON A.DLR_CD = E.DLR_CD
                             AND A.BP_CD  = E.BP_CD
                 WHERE   A.MVT_TP   = #{sMvtTp}
                   AND   A.DLR_CD   = #{sDlrCd}
                   AND   A.BP_CD    = #{sBpCd}
                   AND   B.CANC_YN != 'Y'
                   <if test='sRegDtFr != null'>
                        AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                   </if>
                   <if test='sRegDtTo != null'>
                        AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                   </if>
                 ) A
         WHERE   A.RENT_QTY <![CDATA[>]]> A.RETURN_QTY
      ORDER BY   A.DLR_CD
                ,A.ETC_GI_DOC_NO DESC
                ,A.ETC_GI_DOC_LINE_NO
    </select>

    <!-- 기타입고(대여반환입고 시)팝업 부품 정보(대여출고) Count를 조회한다. -->
    <select id="selectIssueEtcReturnPopCnt" parameterType="IssueEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcReturnPopCnt] */
        SELECT   COUNT(*)
          FROM
               (
                SELECT   A.DLR_CD
                        ,A.ETC_GI_DOC_NO
                        ,B.ETC_GI_DOC_LINE_NO
                        ,A.PLT_CD
                        ,A.BP_CD
                        ,B.ITEM_CD
                        ,B.QTY AS RENT_QTY
                        ,NVL(C.QTY, 0) AS RETURN_QTY
                        ,B.UNIT_CD
                        ,B.STRGE_CD
                        ,B.LOC_CD
                        ,B.PRC
                        ,B.AMT
                  FROM   PT_0611T A
                           INNER JOIN PT_0612T B
                             ON A.DLR_CD        = B.DLR_CD
                            AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                           INNER JOIN  DMSDB.PT_0201T F              --품목정보
                             ON B.DLR_CD  = F.DLR_CD
                            AND B.ITEM_CD = F.ITEM_CD
                           LEFT OUTER JOIN
                                (
                                  SELECT   A.DLR_CD
                                          ,A.REF_DOC_NO
                                          ,A.REF_DOC_LINE_NO
                                          ,SUM(A.QTY) AS QTY
                                    FROM PT_0622T A
                                   WHERE A.DLR_CD = #{sDlrCd}
                                     AND A.REF_DOC_NO IS NOT NULL
                                  GROUP BY A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                ) C
                              ON A.DLR_CD             = C.DLR_CD
                             AND B.ETC_GI_DOC_NO      = C.REF_DOC_NO
                             AND B.ETC_GI_DOC_LINE_NO = C.REF_DOC_LINE_NO
                          LEFT OUTER JOIN DMSDB.PT_0211T E
                             ON A.DLR_CD = E.DLR_CD
                            AND A.BP_CD  = E.BP_CD
                 WHERE   A.MVT_TP   = #{sMvtTp}
                   AND   A.DLR_CD   = #{sDlrCd}
                   AND   A.BP_CD    = #{sBpCd}
                   AND   B.CANC_YN != 'Y'
                   <if test='sRegDtFr != null'>
                        AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                   </if>
                   <if test='sRegDtTo != null'>
                        AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                   </if>
                 ) A
         WHERE   A.RENT_QTY <![CDATA[>]]> A.RETURN_QTY
    </select>

    <!-- 기타출고(차입반환출고 시) 부품 정보를 조회한다. -->
    <select id="selectRentalItemByKey" parameterType="IssueEtcSearchVO" resultType="ReceiveEtcItemVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectRentalItemByKey] */
         SELECT  A.DLR_CD
                ,A.ETC_GI_DOC_NO  AS REF_DOC_NO
                ,A.ETC_GI_DOC_LINE_NO AS REF_DOC_LINE_NO
                ,A.PLT_CD
                ,A.BP_CD
                ,A.BP_NM
                ,A.ITEM_CD
                ,A.ITEM_NM
                ,A.RENT_QTY
                ,A.RETURN_QTY
                ,(A.RENT_QTY - A.RETURN_QTY) AS QTY
                ,(A.RENT_QTY - A.RETURN_QTY) AS REMAIN_QTY
                ,A.UNIT_CD
                ,A.STRGE_CD
                ,NVL(A.LOC_CD,' ') AS LOC_CD
                ,A.PRC
                ,A.AMT
                ,A.DC_RATE
                ,A.TAX_DDCT_PRC
                ,A.TAX_AMT
                ,A.TAX_DDCT_AMT
                ,A.AVLB_STOCK_QTY
                ,A.MOVING_AVG_PRC
           FROM
               (
                SELECT   A.DLR_CD
                        ,A.ETC_GI_DOC_NO
                        ,B.ETC_GI_DOC_LINE_NO
                        ,A.PLT_CD
                        ,A.BP_CD
                        ,E.BP_NM
                        ,B.ITEM_CD
                        ,C.ITEM_NM
                        ,B.QTY AS RENT_QTY
                        ,NVL(F.QTY, 0) AS RETURN_QTY
                        ,B.UNIT_CD
                        ,B.STRGE_CD
                        ,B.LOC_CD
                        ,B.PRC
                        ,B.AMT
                        ,B.DC_RATE
                        ,B.TAX_DDCT_PRC
                        ,B.TAX_AMT
                        ,B.TAX_DDCT_AMT
                        ,D.AVLB_STOCK_QTY
                        ,G.MOVING_AVG_PRC
                  FROM   PT_0611T A
                           INNER JOIN PT_0612T B
                             ON A.DLR_CD        = B.DLR_CD
                            AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                           INNER JOIN  DMSDB.PT_0201T C              --품목정보
                             ON B.DLR_CD  = C.DLR_CD
                            AND B.ITEM_CD = C.ITEM_CD
                           LEFT OUTER JOIN  DMSDB.PT_0301T D    --재고정보
                              ON A.DLR_CD      = D.DLR_CD
                             AND B.STRGE_CD    = D.STRGE_CD
                             AND B.ITEM_CD     = D.ITEM_CD
                           LEFT OUTER JOIN DMSDB.PT_0211T E
                              ON A.DLR_CD = E.DLR_CD
                             AND A.BP_CD  = E.BP_CD
                           LEFT OUTER JOIN
                                (
                                  SELECT   A.DLR_CD
                                          ,A.REF_DOC_NO
                                          ,A.REF_DOC_LINE_NO
                                          ,SUM(A.QTY) AS QTY
                                    FROM PT_0622T A
                                   WHERE A.DLR_CD = #{sDlrCd}
                                     AND A.REF_DOC_NO IS NOT NULL
                                  GROUP BY A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                ) F
                              ON A.DLR_CD = F.DLR_CD
                             AND B.ETC_GI_DOC_NO      = F.REF_DOC_NO
                             AND B.ETC_GI_DOC_LINE_NO = F.REF_DOC_LINE_NO
                           LEFT OUTER JOIN  DMSDB.PT_0208T G    --원가정보
                              ON A.DLR_CD      = G.DLR_CD
                             AND B.STRGE_CD    = G.STRGE_CD
                             AND B.ITEM_CD     = G.ITEM_CD
                 WHERE   A.DLR_CD        = #{sDlrCd}
                   AND   A.ETC_GI_DOC_NO = #{sEtcGiDocNo}
                   AND   B.CANC_YN != 'Y'
                 ) A
      ORDER BY   A.DLR_CD
                ,A.ETC_GI_DOC_NO DESC
                ,A.ETC_GI_DOC_LINE_NO
    </select>

    <!-- 기타입고(조달출고)부품 정보를 조회한다. -->
    <select id="selectIssueEtcFundsByCondition" parameterType="IssueEtcSearchVO" resultType="IssueEtcItemVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcFundsByCondition] */
         SELECT  A.ETC_GI_DOC_NO
                ,A.ETC_GI_DOC_LINE_NO
                ,A.DLR_CD_RCV
                ,A.DLR_CD AS BP_CD
                ,C.BP_NM
                ,A.ITEM_CD
                ,B.ITEM_NM
                ,A.QTY
                ,A.PRC
                ,A.AMT
                ,to_char(to_date(A.ISS_DT,'yyyy-mm-dd'),'yyyy-mm-dd') AS ISS_DT
                ,'' AS REMARK
                ,NVL(B.GR_STRGE_CD,' ') AS GR_STRGE_CD
           FROM   PT_0612I A
                    INNER JOIN   DMSDB.PT_0201T B              --품목정보
                       ON A.DLR_CD      = B.DLR_CD
                      AND A.ITEM_CD     = B.ITEM_CD
                    LEFT OUTER JOIN DMSDB.PT_0211T C                --거래처정보
                       ON A.DLR_CD      = C.DLR_CD
                      AND A.DLR_CD_RCV  = C.BP_CD
          WHERE   A.DLR_CD       = #{sDlrCd}
            AND   A.DLR_CD_RCV   = #{sBpCd}
            AND   A.CANC_YN != 'Y'
            <if test='sRegDtFr != null'>
                 AND A.ISS_DT <![CDATA[>=]]> to_char(#{sRegDtFr},'yyyymmdd')
            </if>
            <if test='sRegDtTo != null'>
                 AND A.ISS_DT <![CDATA[<=]]> to_char(#{sRegDtTo} + 1,'yyyymmdd')
            </if>
            AND  A.RCV_ID IS NULL
            ORDER BY A.ETC_GI_DOC_NO DESC
                    ,A.ETC_GI_DOC_LINE_NO
    </select>

    <!-- 기타입고(조달출고)팝업 부품 정보 Count를 조회한다. -->
    <select id="selectIssueEtcFundsByConditionCnt" parameterType="IssueEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcFundsByConditionCnt] */
        SELECT   COUNT(*)
          FROM   PT_0612I
         WHERE   DLR_CD_RCV   = #{sDlrCd}
           AND   DLR_CD       = #{sBpCd}
           AND   CANC_YN     != 'Y'
           <if test='sRegDtFr != null'>
                AND ISS_DT <![CDATA[>=]]> to_char(#{sRegDtFr},'yyyymmdd')
           </if>
           <if test='sRegDtTo != null'>
                AND ISS_DT <![CDATA[<=]]> to_char(#{sRegDtTo} + 1,'yyyymmdd')
           </if>
    </select>

    <!-- 기타출고 집계정보를 조회한다. -->
    <select id="selectIssueEtcListByCondition" parameterType="IssueEtcSearchVO" resultType="IssueEtcVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcListByCondition] */
        SELECT    A.*
          FROM
             (
                SELECT    ROWNUM AS RNUM
                       ,T1.*
                FROM
                     (
                        SELECT
                                        A.DLR_CD               --딜러코드
                                       ,A.ETC_GI_DOC_NO        --출고문서번호
                                       ,A.MVT_TP              --출고유형
                                       ,A.STAT_CD             --출고상태코드
                                       ,B.GI_DT                --출고일자
                                       ,A.BP_CD                --거래처코드
                                       ,C.BP_NM                --거래처명
                                       ,A.REMARK               --비고
                                       ,A.REG_USR_ID           --등록자ID
                                       ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID) AS REG_USR_NM   --등록자명
                                       ,A.UPDT_USR_ID          --수정자ID
                                       ,A.UPDT_DT              --수정일자
                                       ,NVL(B.ITEM_CNT, 0) AS ITEM_CNT
                                       ,NVL(B.ITEM_QTY, 0) AS ITEM_QTY
                                       ,NVL(B.GI_TAX_AMT, 0) AS GI_TAX_AMT
                                       ,NVL(B.GI_TAX_DDCT_AMT, 0) AS GI_TAX_DDCT_AMT
                                       ,NVL(B.GI_TOT_AMT, 0) AS GI_TOT_AMT
                                       ,NVL(B.DC_RATE * 100, 0) AS DC_RATE
                                       ,CASE WHEN A.STAT_CD = '02'   --헤더 문서가 확정인 경우에만.
                                               THEN CASE WHEN NVL(B.RETURN_QTY,0) = 0
                                                           THEN '未归还'  --미반환
                                                         WHEN NVL(B.RETURN_QTY,0) = NVL(B.ITEM_QTY,0)
                                                           THEN '已归还'  --이미반환
                                                         ELSE '部分归还'  --부분반환
                                                    END
                                             ELSE ''
                                        END RETURN_STAT
                                  FROM   DMSDB.PT_0611T A    --기타출고문서헤더정보
                                            INNER JOIN (
                                                    SELECT   A.DLR_CD
                                                            ,A.ETC_GI_DOC_NO
                                                            ,COUNT(*) AS ITEM_CNT
                                                            ,SUM(A.QTY) AS ITEM_QTY
                                                            ,SUM(NVL(A.TAX_AMT,0)) AS GI_TAX_AMT
                                                            ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS GI_TAX_DDCT_AMT
                                                            ,SUM(NVL(A.AMT,0)) AS GI_TOT_AMT
                                                            ,MAX(A.DC_RATE) AS DC_RATE
                                                            ,MAX(A.GI_DT) AS GI_DT
                                                            ,SUM(NVL(D.RETURN_QTY,0)) AS RETURN_QTY
                                                            ,SUM(NVL(D.RETURN_AMT,0)) AS RETURN_AMT
                                                     FROM   DMSDB.PT_0612T A
                                                              INNER JOIN  DMSDB.PT_0611T B              --기타출고헤더정보
                                                                 ON A.DLR_CD        = B.DLR_CD
                                                                AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                                                              INNER JOIN  DMSDB.PT_0201T C              --품목정보
                                                                 ON A.DLR_CD  = C.DLR_CD
                                                                AND A.ITEM_CD = C.ITEM_CD
                                                               LEFT OUTER JOIN
                                                                            (
                                                                             SELECT A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                                                                   ,SUM(NVL(A.QTY,0)) AS RETURN_QTY
                                                                                   ,SUM(NVL(A.AMT,0)) AS RETURN_AMT
                                                                               FROM PT_0622T A
                                                                                     INNER JOIN PT_0621T B
                                                                                        ON A.DLR_CD        = B.DLR_CD
                                                                                       AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                                                              WHERE B.DLR_CD = #{sDlrCd}
                                                                                AND B.MVT_TP = #{sReturnMvtTp}   --차출 반환 입고['36']
                                                                              GROUP BY A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                                                             ) D
                                                                 ON A.DLR_CD             = D.DLR_CD
                                                                AND A.ETC_GI_DOC_NO      = D.REF_DOC_NO
                                                                AND A.ETC_GI_DOC_LINE_NO = D.REF_DOC_LINE_NO
                                                    WHERE   A.DLR_CD       = #{sDlrCd}  --딜러코드
                                                      --AND   A.GI_STAT_CD  != '03'
                                                      <if test='sEtcGiDocNo != null and sEtcGiDocNo != ""'>
                                                          AND A.ETC_GI_DOC_NO like '%'|| #{sEtcGiDocNo} ||'%'
                                                      </if>  --기타출고번호
                                                      <if test='sItemCd != null and sItemCd != ""'>
                                                          AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                                                      </if>  ----품목번호
                                                      <if test='sItemNm != null and sItemNm != ""'>
                                                          AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                                      </if>  ----품목명
                                                      <if test='sGiDtFr != null'>
                                                           AND A.GI_DT <![CDATA[>=]]> #{sGiDtFr}
                                                      </if>
                                                      <if test='sGiDtTo != null'>
                                                           AND A.GI_DT <![CDATA[<=]]> #{sGiDtTo} + 1
                                                      </if>
                                                      <if test='sMvtTpList != null and !sMvtTpList.isEmpty'>
                                                          AND B.MVT_TP IN
                                                          <foreach item="item" index="index" collection="sMvtTpList" open="(" separator="," close=")">
                                                             #{item}
                                                          </foreach>
                                                      </if>        --수불유형
                                                      <if test='sStrgeCd != null and sStrgeCd != ""'>
                                                          AND A.STRGE_CD = #{sStrgeCd}
                                                      </if> --출고창고코드
                                                      <if test='sLocCd != null and sLocCd != ""'>
                                                          AND A.LOC_CD = #{sLocCd}
                                                      </if> --출고로케이션코드
                                                      <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                                                          AND B.BP_CD IN
                                                          <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                                                            #{item}
                                                          </foreach>
                                                      </if>        --거래처코드
                                                      <if test='sStatCd != null and sStatCd != ""'>
                                                          AND B.STAT_CD = #{sStatCd}
                                                      </if>        --출고상태코드
                                                 GROUP BY   A.DLR_CD
                                                           ,A.ETC_GI_DOC_NO
                                                 ) B
                                               ON A.DLR_CD         = B.DLR_CD
                                              AND A.ETC_GI_DOC_NO  = B.ETC_GI_DOC_NO
                                           LEFT OUTER JOIN DMSDB.PT_0211T C
                                                   ON A.DLR_CD = C.DLR_CD
                                                  AND A.BP_CD  = C.BP_CD
                             WHERE   A.DLR_CD        = #{sDlrCd}  --딜러코드
                               --AND   A.STAT_CD      != '03'
                             ORDER BY
                             <choose>
                                 <when test='sort != null'>
                                     <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                         <choose>
                                             <when test='item.field == "etcGiDocNo"'> A.ETC_GI_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "statCd"'> A.STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <!-- <when test='item.field == "mvtTp'> A.MVT_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when> -->
                                             <when test='item.field == "giDt"'> B.GI_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "bpCd"'> A.BP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "bpNm"'> C.BP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "regUsrId"'> A.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "itemCnt"'> B.ITEM_CNT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "itemQty"'> B.ITEM_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "giTotIncTaxAmt"'> B.GI_TOT_INC_TAX_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                                             <when test='item.field == "giTotAmt"'> B.GI_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "dcRate"'> B.DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <otherwise>
                                               A.DLR_CD ASC
                                              ,A.ETC_GI_DOC_NO DESC
                                             </otherwise>
                                         </choose>
                                     </foreach>
                                 </when>
                                 <otherwise>
                                   A.DLR_CD ASC
                                  ,A.ETC_GI_DOC_NO DESC
                                 </otherwise>
                             </choose>
                        ) T1
                     ) A
             <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
             </where>
    </select>

    <!-- 기타출고 집계정보를 COUNT한다. -->
    <select id="selectIssueEtcListByConditionCnt" parameterType="IssueEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcListByConditionCnt] */
            SELECT    COUNT(*)
              FROM   DMSDB.PT_0611T A    --기타출고문서헤더정보
                        INNER JOIN (
                                SELECT   A.DLR_CD
                                        ,A.ETC_GI_DOC_NO
                                        ,count(*) AS ITEM_CNT
                                        ,SUM(A.QTY) AS ITEM_QTY
                                        ,SUM(A.PRC * A.QTY) AS GI_TOT_INC_TAX_AMT
                                        ,SUM(NVL(A.TAX_DDCT_PRC,0) * A.QTY) AS GI_TOT_AMT
                                        ,MAX(A.DC_RATE) AS DC_RATE
                                 FROM   DMSDB.PT_0612T A
                                          INNER JOIN  DMSDB.PT_0611T B              --기타출고헤더정보
                                             ON A.DLR_CD        = B.DLR_CD
                                            AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                                          INNER JOIN  DMSDB.PT_0201T C              --품목정보
                                             ON A.DLR_CD  = C.DLR_CD
                                            AND A.ITEM_CD = C.ITEM_CD
                                WHERE   A.DLR_CD       = #{sDlrCd}  --딜러코드
                                  --AND   A.GI_STAT_CD  != '03'
                                  <if test='sEtcGiDocNo != null and sEtcGiDocNo != ""'>
                                      AND A.ETC_GI_DOC_NO like '%'|| #{sEtcGiDocNo} ||'%'
                                  </if>  --기타출고번호
                                  <if test='sItemCd != null and sItemCd != ""'>
                                      AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                                  </if>  ----품목번호
                                  <if test='sItemNm != null and sItemNm != ""'>
                                      AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                  </if>  ----품목명
                                  <if test='sGiDtFr != null'>
                                      AND A.GI_DT <![CDATA[>=]]> #{sGiDtFr}
                                  </if>
                                  <if test='sGiDtTo != null'>
                                      AND A.GI_DT <![CDATA[<=]]> #{sGiDtTo} + 1
                                  </if>
                                  <if test='sMvtTpList != null and !sMvtTpList.isEmpty'>
                                      AND B.MVT_TP IN
                                      <foreach item="item" index="index" collection="sMvtTpList" open="(" separator="," close=")">
                                         #{item}
                                      </foreach>
                                  </if>        --수불유형
                                  <if test='sStrgeCd != null and sStrgeCd != ""'>
                                      AND A.STRGE_CD = #{sStrgeCd}
                                  </if> --출고창고코드
                                  <if test='sLocCd != null and sLocCd != ""'>
                                      AND A.LOC_CD = #{sLocCd}
                                  </if> --출고로케이션코드
                                  <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                                      AND B.BP_CD IN
                                      <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                                        #{item}
                                      </foreach>
                                  </if>        --거래처코드
                                  <if test='sStatCd != null and sStatCd != ""'>
                                      AND B.STAT_CD = #{sStatCd}
                                  </if>        --출고상태코드
                             GROUP BY   A.DLR_CD
                                       ,A.ETC_GI_DOC_NO
                             ) B
                           ON A.DLR_CD         = B.DLR_CD
                          AND A.ETC_GI_DOC_NO  = B.ETC_GI_DOC_NO
                       LEFT OUTER JOIN DMSDB.PT_0211T C
                               ON A.DLR_CD = C.DLR_CD
                              AND A.BP_CD  = C.BP_CD
             WHERE   A.DLR_CD        = #{sDlrCd}  --딜러코드
               --AND   A.STAT_CD      != '03'
    </select>

    <!-- 기타출고 명세정보를 조회한다. -->
    <select id="selectIssueEtcDetailListByCondition" parameterType="IssueEtcSearchVO" resultType="IssueEtcItemVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcDetailListByCondition] */
        SELECT    A.*
          FROM
             (
                SELECT    ROWNUM AS RNUM
                       ,T1.*
                FROM
                     (
                        SELECT  A.DLR_CD                       --딜러코드
                               ,A.ETC_GI_DOC_NO                --출고번호
                               ,A.ETC_GI_DOC_LINE_NO           --출고라인번호
                               ,A.ITEM_CD                      --품목코드
                               ,C.ITEM_NM                      --품목명
                               ,A.QTY                          --수량
                               ,A.UNIT_CD                      --단위코드
                               ,A.PRC                          --단가
                               ,A.TAX_DDCT_PRC                 --세금공제단가
                               ,A.AMT                          --출고금액
                               ,A.TAX_AMT                      --세금액
                               ,A.TAX_DDCT_AMT                 --부가세 제외 금액
                               ,A.GI_DT                        --출고일자
                               ,A.STRGE_CD                     --출고창고코드
                               ,A.LOC_CD                       --출고위치코드
                               ,A.GI_REASON_CD                       --출고위치코드
                               ,B.BP_CD                        --거래처코드
                               ,D.BP_NM                        --거래처명
                               ,E.AVLB_STOCK_QTY               --가용재고
                               ,E.RESV_STOCK_QTY               --예류재고
                               ,NVL(E.AVLB_STOCK_QTY,0) + NVL(E.RESV_STOCK_QTY,0) - NVL(E.BORROW_QTY,0) + NVL(E.RENT_QTY,0) AS STOCK_QTY
                              FROM DMSDB.PT_0612T A                   --출고문서품목정보
                                   INNER JOIN DMSDB.PT_0611T B        --출고문서헤더정보
                                      ON A.DLR_CD        = B.DLR_CD
                                     AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                                   INNER JOIN DMSDB.PT_0201T C
                                      ON A.DLR_CD  = C.DLR_CD
                                     AND A.ITEM_CD = C.ITEM_CD
                                   LEFT OUTER JOIN DMSDB.PT_0211T D
                                      ON B.DLR_CD = D.DLR_CD
                                     AND B.BP_CD  = D.BP_CD
                                   LEFT OUTER JOIN PT_0301T E
                                      ON A.DLR_CD      = E.DLR_CD
                                     AND A.ITEM_CD     = E.ITEM_CD
                                     AND A.STRGE_CD    = E.STRGE_CD
                         WHERE A.DLR_CD = #{sDlrCd}  --딜러코드
                             <if test='sEtcGiDocNo != null and sEtcGiDocNo != ""'>
                                 AND A.ETC_GI_DOC_NO like '%'|| #{sEtcGiDocNo} ||'%'
                             </if>  --기타출고번호
                             <if test='sItemCd != null and sItemCd != ""'>
                                 AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                             </if>  ----품목번호
                             <if test='sItemNm != null and sItemNm != ""'>
                                 AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                             </if>  ----품목명
                              <if test='sGiDtFr != null'>
                                   AND A.GI_DT <![CDATA[>=]]> #{sGiDtFr}
                              </if>
                              <if test='sGiDtTo != null'>
                                   AND A.GI_DT <![CDATA[<=]]> #{sGiDtTo} + 1
                              </if>
                              <if test='sMvtTpList != null and !sMvtTpList.isEmpty'>
                                  AND B.MVT_TP IN
                                  <foreach item="item" index="index" collection="sMvtTpList" open="(" separator="," close=")">
                                     #{item}
                                  </foreach>
                              </if>        --수불유형
                              <if test='sStrgeCd != null and sStrgeCd != ""'>
                                  AND A.STRGE_CD = #{sStrgeCd}
                              </if> --출고창고코드
                              <if test='sLocCd != null and sLocCd != ""'>
                                  AND A.LOC_CD = #{sLocCd}
                              </if> --출고로케이션코드
                              <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                                  AND B.BP_CD IN
                                  <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                                    #{item}
                                  </foreach>
                              </if>        --거래처코드
                              <if test='sStatCd != null and sStatCd != ""'>
                                  AND B.STAT_CD = #{sStatCd}
                              </if>        --출고상태코드
                              ORDER BY
                             <choose>
                                 <when test='sort != null'>
                                     <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                         <choose>
                                             <when test='item.field == "etcGiDocNo"'> A.ETC_GI_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "statCd"'> A.STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <!-- <when test='item.field == "mvtTp'> A.MVT_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when> -->
                                             <when test='item.field == "giDt"'> A.GI_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "bpCd"'> B.BP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "bpNm"'> D.BP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "itemCd"'> A.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "itemNm"'> C.ITEM_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "regUsrId"'> A.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "qty"'> A.QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "unitCd"'> A.UNIT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "prc"'> A.PRC <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "taxDdctPrc"'> A.TAX_DDCT_PRC <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "amt"'> A.AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "taxAmt"'> A.TAX_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "taxDdctAmt"'> A.TAX_DDCT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "strgeCd"'> A.STRGE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "locCd"'> A.LOC_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "avlbStockQty"'> E.AVLB_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "resvStockQty"'> E.RESV_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <otherwise>
                                               A.DLR_CD ASC
                                              ,A.ETC_GI_DOC_NO DESC
                                              ,A.ETC_GI_DOC_LINE_NO ASC
                                             </otherwise>
                                         </choose>
                                     </foreach>
                                 </when>
                                 <otherwise>
                                   A.DLR_CD ASC
                                  ,A.ETC_GI_DOC_NO DESC
                                  ,A.ETC_GI_DOC_LINE_NO ASC
                                 </otherwise>
                             </choose>
                    ) T1
                 ) A
             <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
             </where>
    </select>

    <!-- 기타출고 명세정보를 COUNT한다. -->
    <select id="selectIssueEtcDetailListByConditionCnt" parameterType="IssueEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcDetailListByConditionCnt] */
            SELECT    COUNT(*)
              FROM DMSDB.PT_0612T A                   --출고문서품목정보
                   INNER JOIN DMSDB.PT_0611T B        --출고문서헤더정보
                      ON A.DLR_CD        = B.DLR_CD
                     AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                   INNER JOIN DMSDB.PT_0201T C
                      ON A.DLR_CD  = C.DLR_CD
                     AND A.ITEM_CD = C.ITEM_CD
                   LEFT OUTER JOIN DMSDB.PT_0211T D
                      ON B.DLR_CD = D.DLR_CD
                     AND B.BP_CD  = D.BP_CD
                   LEFT OUTER JOIN PT_0301T E
                      ON A.DLR_CD           = E.DLR_CD
                     AND A.ITEM_CD          = E.ITEM_CD
                     AND A.STRGE_CD         = E.STRGE_CD
             WHERE A.DLR_CD = #{sDlrCd}  --딜러코드
                  <if test='sEtcGiDocNo != null and sEtcGiDocNo != ""'>
                      AND A.ETC_GI_DOC_NO like '%'|| #{sEtcGiDocNo} ||'%'
                  </if>  --기타출고번호
                  <if test='sItemCd != null and sItemCd != ""'>
                      AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                  </if>  ----품목번호
                  <if test='sItemNm != null and sItemNm != ""'>
                      AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                  </if>  ----품목명
                  <if test='sGiDtFr != null'>
                      AND A.GI_DT <![CDATA[>=]]> #{sGiDtFr}
                  </if>
                  <if test='sGiDtTo != null'>
                      AND A.GI_DT <![CDATA[<=]]> #{sGiDtTo} + 1
                  </if>
                  <if test='sMvtTpList != null and !sMvtTpList.isEmpty'>
                      AND B.MVT_TP IN
                      <foreach item="item" index="index" collection="sMvtTpList" open="(" separator="," close=")">
                         #{item}
                      </foreach>
                  </if>        --수불유형
                  <if test='sStrgeCd != null and sStrgeCd != ""'>
                      AND A.STRGE_CD   = #{sStrgeCd}
                  </if> --출고창고코드
                  <if test='sLocCd != null and sLocCd != ""'>
                      AND A.LOC_CD = #{sLocCd}
                  </if> --출고로케이션코드
                  <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                      AND B.BP_CD IN
                      <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                        #{item}
                      </foreach>
                  </if>        --거래처코드
                  <if test='sStatCd != null and sStatCd != ""'>
                      AND B.STAT_CD = #{sStatCd}
                  </if>        --출고상태코드
    </select>

    <!-- 기타출고(차출등기출고) 명세정보를 조회한다. -->
    <select id="selectIssueEtcRentalDetailListByCondition" parameterType="IssueEtcSearchVO" resultType="IssueEtcItemVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcRentalDetailListByCondition] */
        SELECT    A.*
          FROM
             (
                SELECT    ROWNUM AS RNUM
                       ,T1.*
                FROM
                     (
                        SELECT  A.DLR_CD                       --딜러코드
                               ,A.ETC_GI_DOC_NO                --출고번호
                               ,A.ETC_GI_DOC_LINE_NO           --출고라인번호
                               ,A.ITEM_CD                      --품목코드
                               ,C.ITEM_NM                      --품목명
                               ,A.QTY                          --수량
                               ,A.UNIT_CD                      --단위코드
                               ,A.PRC                          --단가
                               ,A.TAX_DDCT_PRC                 --세금공제단가
                               ,A.AMT                          --출고금액
                               ,A.TAX_AMT                      --세금액
                               ,A.TAX_DDCT_AMT                 --부가세 제외 금액
                               ,A.GI_DT                        --출고일자
                               ,A.STRGE_CD                     --출고창고코드
                               ,A.LOC_CD                       --출고위치코드
                               ,B.BP_CD                        --거래처코드
                               ,D.BP_NM                        --거래처명
                               ,E.AVLB_STOCK_QTY               --가용재고
                               ,E.RESV_STOCK_QTY               --예류재고
                               ,NVL(E.AVLB_STOCK_QTY,0) + NVL(E.RESV_STOCK_QTY,0) - NVL(E.BORROW_QTY,0) + NVL(E.RENT_QTY,0) AS STOCK_QTY
                               ,NVL(F.RETURN_QTY,0) AS RETURN_QTY
                               ,NVL(F.RETURN_AMT,0) AS RETURN_AMT
                               ,CASE WHEN B.STAT_CD = '03'
                                       THEN '取消'
                                     ELSE  CASE WHEN NVL(F.RETURN_QTY,0) = 0
                                                  THEN '未归还'  --미반환
                                                WHEN NVL(F.RETURN_QTY,0) = A.QTY
                                                  THEN '已归还' --이미반환
                                                ELSE '部分归还'  --부분반환
                                           END
                                 END RETURN_STAT
                                ,NVL(F.RETURN_DOC_NO,' ') AS RETURN_DOC_NO
                          FROM DMSDB.PT_0612T A                   --출고문서품목정보
                               INNER JOIN DMSDB.PT_0611T B        --출고문서헤더정보
                                  ON A.DLR_CD        = B.DLR_CD
                                 AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                               INNER JOIN DMSDB.PT_0201T C
                                  ON A.DLR_CD  = C.DLR_CD
                                 AND A.ITEM_CD = C.ITEM_CD
                               LEFT OUTER JOIN DMSDB.PT_0211T D
                                  ON B.DLR_CD = D.DLR_CD
                                 AND B.BP_CD  = D.BP_CD
                               LEFT OUTER JOIN PT_0301T E
                                  ON A.DLR_CD           = E.DLR_CD
                                 AND A.ITEM_CD          = E.ITEM_CD
                                 AND A.STRGE_CD         = E.STRGE_CD
                               LEFT OUTER JOIN
                                             (
                                                 SELECT A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                                       ,SUM(NVL(A.QTY,0)) AS RETURN_QTY
                                                       ,SUM(NVL(A.AMT,0)) AS RETURN_AMT
                                                       ,SUBSTR(xmlagg(xmlelement(a,','||B.ETC_GR_DOC_NO) ORDER BY B.ETC_GR_DOC_NO).extract('//text()'),2) AS RETURN_DOC_NO
                                                   FROM PT_0622T A
                                                         INNER JOIN PT_0621T B
                                                            ON A.DLR_CD        = B.DLR_CD
                                                           AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                                  WHERE B.DLR_CD = #{sDlrCd}
                                                    AND B.MVT_TP = #{sReturnMvtTp}   --차출 반환 입고['36']
                                                  GROUP BY A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                                 ) F
                                 ON A.DLR_CD             = F.DLR_CD
                                AND A.ETC_GI_DOC_NO      = F.REF_DOC_NO
                                AND A.ETC_GI_DOC_LINE_NO = F.REF_DOC_LINE_NO
                         WHERE A.DLR_CD = #{sDlrCd}  --딜러코드
                              <if test='sEtcGiDocNo != null and sEtcGiDocNo != ""'>
                                  AND A.ETC_GI_DOC_NO like '%'|| #{sEtcGiDocNo} ||'%'
                              </if>  --기타출고번호
                              <if test='sItemCd != null and sItemCd != ""'>
                                  AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                              </if>  ----품목번호
                              <if test='sItemNm != null and sItemNm != ""'>
                                  AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                              </if>  ----품목명
                              <if test='sGiDtFr != null'>
                                  AND A.GI_DT <![CDATA[>=]]> #{sGiDtFr}
                              </if>
                              <if test='sGiDtTo != null'>
                                  AND A.GI_DT <![CDATA[<=]]> #{sGiDtTo} + 1
                              </if>
                              <if test='sMvtTpList != null and !sMvtTpList.isEmpty'>
                                  AND B.MVT_TP IN
                                  <foreach item="item" index="index" collection="sMvtTpList" open="(" separator="," close=")">
                                     #{item}
                                  </foreach>
                              </if>        --수불유형
                              <if test='sStrgeCd != null and sStrgeCd != ""'>
                                  AND A.STRGE_CD = #{sStrgeCd}
                              </if> --출고창고코드
                              <if test='sLocCd != null and sLocCd != ""'>
                                  AND A.LOC_CD = #{sLocCd}
                              </if> --출고로케이션코드
                              <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                                  AND B.BP_CD IN
                                  <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                                    #{item}
                                  </foreach>
                              </if>        --거래처코드
                              <if test='sStatCd != null and sStatCd != ""'>
                                  AND B.STAT_CD = #{sStatCd}
                              </if>        --출고상태코드
                              <if test='sReturnStat != null and sReturnStat != ""'>
                                   <choose>
                                        <when test='sReturnStat == 01'>  --미반환
                                            AND NVL(F.RETURN_QTY,0) =  0
                                        </when>
                                        <when test='sReturnStat == 02'>  --기반환
                                            AND NVL(F.RETURN_QTY,0) <![CDATA[>]]>  0
                                        </when>
                                   </choose>
                              </if>        --반환여부상태코드
                              ORDER BY
                             <choose>
                                 <when test='sort != null'>
                                     <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                         <choose>
                                             <when test='item.field == "etcGiDocNo"'> A.ETC_GI_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "statCd"'> A.STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "giDt"'> A.GI_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "bpCd"'> B.BP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "bpNm"'> D.BP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "itemCd"'> A.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "itemNm"'> C.ITEM_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "regUsrId"'> A.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "qty"'> A.QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "unitCd"'> A.UNIT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "prc"'> A.PRC <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "taxDdctPrc"'> A.TAX_DDCT_PRC <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "amt"'> A.AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "taxAmt"'> A.TAX_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "taxDdctAmt"'> A.TAX_DDCT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "strgeCd"'> A.STRGE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "locCd"'> A.LOC_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "avlbStockQty"'> E.AVLB_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <when test='item.field == "resvStockQty"'> E.RESV_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                             <otherwise>
                                               A.DLR_CD ASC
                                              ,A.ETC_GI_DOC_NO DESC
                                              ,A.ETC_GI_DOC_LINE_NO ASC
                                             </otherwise>
                                         </choose>
                                     </foreach>
                                 </when>
                                 <otherwise>
                                   A.DLR_CD ASC
                                  ,A.ETC_GI_DOC_NO DESC
                                  ,A.ETC_GI_DOC_LINE_NO ASC
                                 </otherwise>
                             </choose>
                    ) T1
             ) A
             <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
             </where>
    </select>

    <!-- 기타출고(차출등기출고) 명세정보를 COUNT한다. -->
    <select id="selectIssueEtcRentalDetailListByConditionCnt" parameterType="IssueEtcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcRentalDetailListByConditionCnt] */
            SELECT    COUNT(*)
              FROM DMSDB.PT_0612T A                   --출고문서품목정보
                   INNER JOIN DMSDB.PT_0611T B        --출고문서헤더정보
                      ON A.DLR_CD        = B.DLR_CD
                     AND A.ETC_GI_DOC_NO = B.ETC_GI_DOC_NO
                   INNER JOIN DMSDB.PT_0201T C
                      ON A.DLR_CD  = C.DLR_CD
                     AND A.ITEM_CD = C.ITEM_CD
                   LEFT OUTER JOIN DMSDB.PT_0211T D
                      ON B.DLR_CD = D.DLR_CD
                     AND B.BP_CD  = D.BP_CD
                   LEFT OUTER JOIN PT_0301T E
                      ON A.DLR_CD           = E.DLR_CD
                     AND A.ITEM_CD          = E.ITEM_CD
                     AND A.STRGE_CD         = E.STRGE_CD
                   LEFT OUTER JOIN
                                 (
                                     SELECT A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                           ,SUM(A.QTY) AS RETURN_QTY
                                           ,SUM(A.AMT) AS RETURN_AMT
                                       FROM PT_0622T A
                                             INNER JOIN PT_0621T B
                                                ON A.DLR_CD        = B.DLR_CD
                                               AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                      WHERE B.DLR_CD = #{sDlrCd}
                                        AND B.MVT_TP = #{sReturnMvtTp}   --차출 반환 입고['36']
                                      GROUP BY A.DLR_CD, A.REF_DOC_NO, A.REF_DOC_LINE_NO
                                     ) F
                     ON A.DLR_CD             = F.DLR_CD
                    AND A.ETC_GI_DOC_NO      = F.REF_DOC_NO
                    AND A.ETC_GI_DOC_LINE_NO = F.REF_DOC_LINE_NO
             WHERE A.DLR_CD = #{sDlrCd}  --딜러코드
                 <if test='sEtcGiDocNo != null and sEtcGiDocNo != ""'>
                     AND A.ETC_GI_DOC_NO like '%'|| #{sEtcGiDocNo} ||'%'
                 </if>  --기타출고번호
                 <if test='sItemCd != null and sItemCd != ""'>
                     AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                 </if>  ----품목번호
                 <if test='sItemNm != null and sItemNm != ""'>
                     AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                 </if>  ----품목명
                  <if test='sGiDtFr != null'>
                       AND A.GI_DT <![CDATA[>=]]> #{sGiDtFr}
                  </if>
                  <if test='sGiDtTo != null'>
                       AND A.GI_DT <![CDATA[<=]]> #{sGiDtTo} + 1
                  </if>
                  <if test='sMvtTpList != null and !sMvtTpList.isEmpty'>
                      AND B.MVT_TP IN
                      <foreach item="item" index="index" collection="sMvtTpList" open="(" separator="," close=")">
                         #{item}
                      </foreach>
                  </if>        --수불유형
                  <if test='sStrgeCd != null and sStrgeCd != ""'>
                      AND A.STRGE_CD = #{sStrgeCd}
                  </if> --출고창고코드
                  <if test='sLocCd != null and sLocCd != ""'>
                      AND A.LOC_CD = #{sLocCd}
                  </if> --출고로케이션코드
                  <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                      AND B.BP_CD IN
                      <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                        #{item}
                      </foreach>
                  </if>        --거래처코드
                  <if test='sStatCd != null and sStatCd != ""'>
                      AND B.STAT_CD = #{sStatCd}
                  </if>        --출고상태코드
                  <if test='sReturnStat != null and sReturnStat != ""'>
                       <choose>
                            <when test='sReturnStat == 01'>  --미반환
                                AND NVL(F.RETURN_QTY,0) =  0
                            </when>
                            <when test='sReturnStat == 02'>  --기반환
                                AND NVL(F.RETURN_QTY,0) <![CDATA[>]]>  0
                            </when>
                       </choose>
                  </if>        --반환여부상태코드
    </select>

    <!-- 기타입고 헤더 수정일자정보를 조회한다. -->
    <select id="selectIssueEtcUpdtDtByKey" parameterType="IssueEtcVO" resultType="String">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueEtcDAO.selectIssueEtcUpdtDtByKey] */
        SELECT  TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
          FROM  DMSDB.PT_0611T A    --기타출고헤더정보
         WHERE  A.DLR_CD             = #{dlrCd}
           AND  A.ETC_GI_DOC_NO      = #{etcGiDocNo}    --입고번호
    </select>
</mapper>