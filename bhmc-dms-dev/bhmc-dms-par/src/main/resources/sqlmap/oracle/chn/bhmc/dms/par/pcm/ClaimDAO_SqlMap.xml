<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : ClaimDAO_SqlMap.xml
    Description : 클레임요청.
    author In Bo Shim
    since 2016. 1. 29.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 01. 29.     In Bo Shim     최초 생성
-->

<mapper namespace="chn.bhmc.dms.par.pcm.service.dao.ClaimDAO">

    <!-- 클레임 헤더 정보를 추가한다. -->
    <insert id="insertClaim" parameterType="ClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.insertClaim] */
        INSERT INTO DMSDB.PT_0441T    --클레임문서 헤더정보
        (
          DLR_CD                  --딜러코드
         ,CLAIM_DOC_NO            --클레임문서번호
         ,PLT_CD                  --센터코드
         ,BP_CD                   --거래처코드
         ,CLAIM_STAT_CD           --클레임상태코드
         ,CLAIM_TARG_CD           --클레임대상코드
         ,DL_BP_CD                --배송거래처코드
         ,DEL_YN                  --삭제여부
         ,CLAIM_TP                --클레임유형
         ,ITEM_CD                 --품목번호
         ,CLAIM_QTY               --클레임수량
         ,CLAIM_UNIT_CD           --클레임단위코드
         ,PRC                     --단가
         ,AMT                     --금액
         ,INVC_DOC_NO             --송장문서번호
         ,INVC_DOC_LINE_NO        --송장문서라인번호
         ,DOC_FILE_NO             --문서파일번호
         ,REQ_CONT                --요청내용
         ,REG_USR_ID              --등록자ID
         ,REG_DT                  --등록일자
        )
        VALUES
        (
          #{dlrCd}                  --딜러코드
         ,#{claimDocNo}             --클레임문서번호
         ,#{pltCd}                  --센터코드
         ,#{bpCd}                   --거래처코드
         ,#{claimStatCd}            --클레임상태코드
         ,#{claimTargCd}            --클레임대상코드
         ,#{dlBpCd}                 --배송거래처코드
         ,'N'                       --삭제여부
         ,#{claimTp}                --클레임유형
         ,#{itemCd}                 --품목번호
         ,#{claimQty}               --클레임수량
         ,#{claimUnitCd}            --클레임단위코드
         ,round(#{prc},2)           --단가
         ,round(#{amt},2)           --금액
         ,#{invcDocNo}              --송장문서번호
         ,#{invcDocLineNo}          --송장문서라인번호
         ,#{docFileNo}              --문서파일번호
         ,#{reqCont}                --요청내용
         ,#{regUsrId}               --등록자ID
         ,sysdate                   --등록일자
        )
    </insert>

    <!-- 과부족클레임 헤더 정보를 추가한다. -->
    <insert id="insertOversAndShortsClaim" parameterType="OversAndShortsClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.insertOversAndShortsClaim] */
        INSERT INTO DMSDB.PT_0442T    --과부족클레임헤더정보
        (
          DLR_CD                         --딜러코드
         ,CLAIM_NO                       --DMS클레임번호
         ,BOXING_NO                      --송장문서번호
         ,CREATE_TIME                    --신청일
         ,ARRIVED_DATE                   --도착일
         ,SELL_INVENTORY_NO              --판매리스트코드
         ,WAYBILL_NO                     --운송번호
         ,DELIVERY_INVENTORY_DATE        --출고서일자
         ,DELIVERY_INVENTORY_NO          --출고서번호
         ,IS_INTACT                      --포장파손여부
         ,ATTACHMENT_NAME                --첨무파일명
         ,ATTACHMENT_URL                 --첨부파일URL
         ,ATCH_FILE_CONT                 --첨부파일 데이터
         ,DESCRIBE                       --상세서술
         ,STATUS
         ,REG_USR_ID                     --등록자ID
         ,REG_DT                         --등록일자
        )
        VALUES
        (
          #{dlrCd}                         --딜러코드
         ,#{claimNo}                       --DMS클레임번호
         ,#{boxingNo}                      --송장문서번호
         ,#{createTime}                    --신청일
         ,#{arrivedDate}                   --도착일
         ,#{sellInventoryNo}               --판매리스트코드
         ,#{waybillNo}                     --운송번호
         ,#{deliveryInventoryDate}         --출고서일자
         ,#{deliveryInventoryNo}           --출고서번호
         ,#{isIntact}                      --포장파손여부
         ,#{attachmentName}                --첨무파일명
         ,#{attachmentUrl}                 --첨부파일URL
         ,#{atchFileCont}                  --첨부데이터
         ,#{describe}                      --상세서술
         ,#{status}                        --상태
         ,#{regUsrId}                      --등록자ID
         ,sysdate                          --등록일자
        )
    </insert>

    <!-- 과부족클레임 부품 정보를 추가한다. -->
    <insert id="insertOversAndShortsClaimItem" parameterType="OversAndShortsClaimItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.insertOversAndShortsClaimItem] */
        INSERT INTO DMSDB.PT_0443T    --과부족클레임품목정보
        (
          DLR_CD                 --딜러코드
         ,CLAIM_NO               --DMS클레임번호
         ,CLAIM_LINE             --클레임라인번호
         ,ORDER_NO               --오더번호
         ,PART_NO                --부품번호
         ,CLAIMANT_TYPE          --클레임유형
         ,ERROR_PART_NO          --오배송부품번호
         ,ORDER_NUM              --발주수량
         ,REAL_NUM               --실제도착수량
         ,CLAIMANT_NUM           --클레임수량
         ,REG_USR_ID             --등록자ID
         ,REG_DT                 --등록일자
        )
        VALUES
        (
          #{dlrCd}                 --딜러코드
         ,#{claimNo}               --DMS클레임번호
         ,#{claimLine}             --클레임라인번호
         ,#{orderNo}               --오더번호
         ,#{partNo}                --부품번호
         ,#{claimantType}          --클레임유형
         ,#{errorPartNo}           --에러부품번호
         ,#{orderNum}              --발주수량
         ,#{realNum}               --실제수량
         ,#{claimantNum}           --클레임수량
         ,#{regUsrId}              --등록자ID
         ,sysdate                  --등록일자
        )
    </insert>

    <!-- 품질클레임 정보를 추가한다. -->
    <insert id="insertQualityClaim" parameterType="QualityClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.insertQualityClaim] */
        INSERT INTO DMSDB.PT_0444T    --품질클레임정보
        (
          DLR_CD                        --딜러코드
         ,CLAIM_NO                      --DMS클레임번호
         ,ORDER_NO                      --오더번호
         ,ORDER_LN                      --오더라인번호
         ,PART_NO                       --부품번호
         ,ARRIVAL_DATE                  --도착일
         ,VIN                           --VIN코드
         ,ENGINE_CYLINDER               --엔진실린더
         ,CLAIM_NUM                     --클레임수량
         ,PROBLEM_DATE                  --문제발견일
         ,CAR_MODEL                     --차형코드
         ,CLAIM_TYPE                    --클레임유형
         ,DEALER_CLAIM_WAY              --클레임방식
         ,PRC_CODE                      --발주창고
         ,DELIVERY_TYPE                 --배송방식
         ,TRANSPORT_NO                  --화물송장코드
         ,DELIVERY_REMARK               --화물송장비고
         ,DESCRIPTION                   --상세묘사
         ,TAG_FILE_URL                  --부속품(태그)
         ,TAG_FILE_DATA_CONT            --부속품(태그)
         ,PART_FILE_URL                 --부속품(부품)
         ,PAR_FILE_DATA_CONT            --부속품(태그)
         ,PACK_FILE_URL                 --부속품(포장)
         ,PACK_FILE_DATA_CONT            --부속품(태그)
         ,CLAIMANTS                     --부품매니저
         ,CLAIM_PERSON                  --클레임신고인
         ,TELEPHONE                     --신고인연락처
         ,SUPPLIER_CODE                 --공급상코드
         ,REG_USR_ID                    --등록자ID
         ,REG_DT                        --등록일자
        )
        VALUES
        (
          #{dlrCd}                        --딜러코드
         ,#{claimNo}                      --DMS클레임번호
         ,#{orderNo}                      --오더번호
         ,#{orderLn}                      --오더라인번호
         ,#{partNo}                       --부품번호
         ,#{arrivalDate}                  --도착일
         ,#{vin}                          --VIN코드
         ,#{engineCylinder}               --엔진실린더
         ,#{claimNum}                     --클레임수량
         ,#{problemDate}                  --문제발견일
         ,#{carModel}                     --차형코드
         ,#{claimType}                    --클레임유형
         ,#{dealerClaimWay}               --클레임방식
         ,#{prcCode}                      --발주창고
         ,#{deliveryType}                 --배송방식
         ,#{transportNo}                  --화물송장코드
         ,#{deliveryRemark}               --화물송장비고
         ,#{description}                  --상세묘사
         ,#{tagFileUrl}                   --부속품(태그)
         ,#{tagFileDataCont}              --부속품(태그)
         ,#{partFileUrl}                  --부속품(부품)
         ,#{parFileDataCont}              --부속품(부품)
         ,#{packFileUrl}                  --부속품(포장)
         ,#{packFileDataCont}             --부속품(포장)
         ,#{claimants}                    --부품매니저
         ,#{claimPerson}                  --클레임신고일
         ,#{telephone}                    --신고인연락처
         ,#{supplierCode}                 --공급상코드
         ,#{regUsrId}                     --등록자ID
         ,sysdate                         --등록일자
        )
    </insert>

    <!-- 품질클레임에 BMP클레임 정보를 반영한다. -->
    <update id="updateQualityBMPClaim" parameterType="QualityClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.updateQualityBMPClaim] */
        UPDATE DMSDB.PT_0444T    --품질클레임정보
          SET  CLAIM_CODE    = #{claimCode}
              ,UPDT_USR_ID   = #{regUsrId}                     --수정자ID
              ,UPDT_DT       = sysdate                         --수정일자
         WHERE DLR_CD        = #{dlrCd}                        --딜러코드
           AND CLAIM_NO      = #{claimNo}                      --DMS클레임번호
    </update>

    <!-- 품질클레임 정보를 수정한다. -->
    <update id="updateQualityClaim" parameterType="QualityClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.updateQualityClaim] */
        UPDATE DMSDB.PT_0444T    --품질클레임정보
          SET
               ORDER_NO               = #{orderNo}                      --오더번호
              ,ORDER_LN               = #{orderLn}                      --오더라인번호
              ,PART_NO                = #{partNo}                       --부품번호
              ,ARRIVAL_DATE           = #{arrivalDate}                  --도착일
              ,VIN                    = #{vin}                          --VIN코드
              ,ENGINE_CYLINDER        = #{engineCylinder}               --엔진실린더
              ,CLAIM_NUM              = #{claimNum}                     --클레임수량
              ,PROBLEM_DATE           = #{problemDate}                  --문제발견일
              ,CAR_MODEL              = #{carModel}                     --차형코드
              ,CLAIM_TYPE             = #{claimType}                    --클레임유형
              ,DEALER_CLAIM_WAY       = #{dealerClaimWay}               --클레임방식
              ,PRC_CODE               = #{prcCode}                      --발주창고
              ,DELIVERY_TYPE          = #{deliveryType}                 --배송방식
              ,TRANSPORT_NO           = #{transportNo}                  --화물송장코드
              ,DELIVERY_REMARK        = #{deliveryRemark}               --화물송장비고
              ,DESCRIPTION            = #{description}                  --상세묘사
              ,TAG_FILE_URL           = #{tagFileUrl}                   --부속품(태그)
              ,TAG_FILE_DATA_CONT     = #{tagFileDataCont}              --부속품(태그)
              ,PART_FILE_URL          = #{partFileUrl}                  --부속품(부품)
              ,PAR_FILE_DATA_CONT     = #{parFileDataCont}             --부속품(부품)
              ,PACK_FILE_URL          = #{packFileUrl}                  --부속품(포장)
              ,PACK_FILE_DATA_CONT    = #{packFileDataCont}             --부속품(포장)
              ,CLAIMANTS              = #{claimants}                    --부품매니저
              ,CLAIM_PERSON           = #{claimPerson}                  --클레임신고일
              ,TELEPHONE              = #{telephone}                    --신고인연락처
              ,UPDT_USR_ID            = #{regUsrId}                     --수정자ID
              ,UPDT_DT                = sysdate                         --수정일자
         WHERE DLR_CD                 = #{dlrCd}                        --딜러코드
           AND CLAIM_NO               = #{claimNo}                      --DMS클레임번호
    </update>

    <!-- 품질클레임 정보를 삭제한다.(삭제 인터페이스 후 BMP 클레임 코드만 삭제함) -->
    <update id="deleteQualityClaim" parameterType="QualityClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.deleteQualityClaim] */
        UPDATE DMSDB.PT_0444T    --품질클레임정보
          SET  CLAIM_CODE       = ''
              ,UPDT_USR_ID      = #{regUsrId}                     --수정자ID
              ,UPDT_DT          = sysdate                         --수정일자
         WHERE DLR_CD           = #{dlrCd}                        --딜러코드
           AND CLAIM_NO         = #{claimNo}                      --DMS클레임번호
    </update>

     <!-- 과부족클레임에 BMP클레임 정보를 반영한다. -->
    <update id="updateOversAndShortsBMPClaim" parameterType="OversAndShortsClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.updateOversAndShortsBMPClaim] */
        UPDATE DMSDB.PT_0442T    --과부족클레임정보
          SET  CLAIMANT_NO            = #{claimantNo}
              ,UPDT_USR_ID            = #{regUsrId}                     --수정자ID
              ,UPDT_DT                = sysdate                         --수정일자
         WHERE DLR_CD                 = #{dlrCd}                        --딜러코드
           AND CLAIM_NO               = #{claimNo}                      --DMS클레임번호
    </update>

    <!-- 품질클레임건 상태정보를 수정한다. -->
    <update id="updateQualityClaimStatus" parameterType="QualityClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.updateQualityClaimStatus] */
        UPDATE DMSDB.PT_0444T    --품질클레임정보
          SET  WORN_STATUS      = #{wornStatus}
              ,UPDT_USR_ID      = #{regUsrId}                     --수정자ID
              ,UPDT_DT          = sysdate                         --수정일자
         WHERE DLR_CD           = #{dlrCd}                        --딜러코드
           AND CLAIM_NO         = #{claimNo}                      --DMS클레임번호
           AND CLAIM_CODE       = #{claimCode}                      --DMS클레임번호
    </update>

    <!-- 품질클레임건 탁송여부정보를 수정한다. -->
    <update id="updateQualityClaimIsCheck" parameterType="QualityClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.updateQualityClaimIsCheck] */
        UPDATE DMSDB.PT_0444T    --품질클레임정보
          SET  IS_CHECK         = #{isCheck}
              ,UPDT_USR_ID      = #{regUsrId}                     --수정자ID
              ,UPDT_DT          = sysdate                         --수정일자
         WHERE DLR_CD           = #{dlrCd}                        --딜러코드
           AND CLAIM_NO         = #{claimNo}                      --DMS클레임번호
           AND CLAIM_CODE       = #{claimCode}                    --클레임번호
           AND WORN_STATUS      = #{wornStatus}                   --클레임건 상태
    </update>

    <!-- 품질클레임건 회수운송장정보를 수정한다. -->
    <update id="updateReClaimOrder" parameterType="QualityClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.updateReClaimOrder] */
        UPDATE DMSDB.PT_0444T    --품질클레임정보
          SET  RECLAIM_ORDER    = #{reclaimOrder}
              ,UPDT_USR_ID      = #{regUsrId}                     --수정자ID
              ,UPDT_DT          = sysdate                         --수정일자
         WHERE DLR_CD           = #{dlrCd}                        --딜러코드
           AND CLAIM_NO         = #{claimNo}                      --DMS클레임번호
           AND CLAIM_CODE       = #{claimCode}                    --클레임번호
    </update>

    <!-- 품질클레임건 영수증정보를 수정한다. -->
    <update id="updateQualityClaimBillNo" parameterType="QualityClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.updateQualityClaimBillNo] */
        UPDATE DMSDB.PT_0444T    --품질클레임정보
          SET  BILL_NO          = #{billNo}
              ,UPDT_USR_ID      = #{regUsrId}                     --수정자ID
              ,UPDT_DT          = sysdate                         --수정일자
         WHERE DLR_CD           = #{dlrCd}                        --딜러코드
           AND CLAIM_NO         = #{claimNo}                      --DMS클레임번호
           AND CLAIM_CODE       = #{claimCode}                    --클레임번호
    </update>

    <!-- 과부족클레임 정보를 수정한다. -->
    <update id="updateOversAndShortsClaim" parameterType="OversAndShortsClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.updateOversAndShortsClaim] */
        UPDATE DMSDB.PT_0442T    --과부족클레임정보
          SET
               CREATE_TIME             = #{createTime}                    --신고일
              ,BOXING_NO               = #{boxingNo}                      --송장문서번호
              ,SELL_INVENTORY_NO       = #{sellInventoryNo}               --판매리스트코드
              ,WAYBILL_NO              = #{waybillNo}                     --운송번호
              ,ARRIVED_DATE            = #{arrivedDate}                   --도착일
              ,DELIVERY_INVENTORY_DATE = #{deliveryInventoryDate}         --출고서일자
              ,DELIVERY_INVENTORY_NO   = #{deliveryInventoryNo}           --출고서번호
              ,IS_INTACT               = #{isIntact}                      --포장완벽여부
              ,ATTACHMENT_NAME         = #{attachmentName}                --첨부파일명
              ,ATTACHMENT_URL          = #{attachmentUrl}                 --첨부파일URL
              ,ATCH_FILE_CONT          = #{atchFileCont}                  --첨부파일데이터
              ,DESCRIBE                = #{describe}                      --상세서술
              ,UPDT_USR_ID             = #{regUsrId}                      --수정자ID
              ,UPDT_DT                 = sysdate                          --수정일자
         WHERE DLR_CD                 = #{dlrCd}                        --딜러코드
           AND CLAIM_NO               = #{claimNo}                      --DMS클레임번호
    </update>

    <!-- 과부족클레임 상태 정보를 수정한다. -->
    <update id="updateOversAndShortsClaimStatus" parameterType="OversAndShortsClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.updateOversAndShortsClaimStatus] */
        UPDATE DMSDB.PT_0442T    --과부족클레임정보
          SET
               STATUS                 = #{status}                       --상태
              ,UPDT_USR_ID            = #{regUsrId}                     --수정자ID
              ,UPDT_DT                = sysdate                         --수정일자
         WHERE DLR_CD                 = #{dlrCd}                        --딜러코드
           AND CLAIM_NO               = #{claimNo}                      --DMS클레임번호
    </update>

    <!-- 과부족클레임 부품 정보를 수정한다. -->
    <update id="updateOversAndShortsClaimItem" parameterType="OversAndShortsClaimItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.updateOversAndShortsClaimItem] */
        UPDATE DMSDB.PT_0443T    --과부족클레임부품정보
          SET
               ORDER_NO        = #{orderNo}               --오더번호
              ,PART_NO         = #{partNo}                --부품번호
              ,CLAIMANT_TYPE   = #{claimantType}          --클레임유형
              ,ERROR_PART_NO   = #{errorPartNo}           --오전송부품번호
              ,ORDER_NUM       = #{orderNum}              --발주수량
              ,REAL_NUM        = #{realNum}               --실제도착수량
              ,CLAIMANT_NUM    = #{claimantNum}           --클레임수량
              ,UPDT_USR_ID     = #{regUsrId}              --수정자ID
              ,UPDT_DT         = sysdate                  --수정일자
         WHERE DLR_CD          = #{dlrCd}                 --딜러코드
           AND CLAIM_NO        = #{claimNo}               --DMS클레임번호
           AND CLAIM_LINE      = #{claimLine}             --DMS클레임라인번호
    </update>

    <!-- 과부족클레임 부품 정보를 수정한다. -->
    <delete id="deleteOversAndShortsClaimItem" parameterType="OversAndShortsClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.deleteOversAndShortsClaimItem] */
        DELETE FROM DMSDB.PT_0443T    --과부족클레임부품정보
         WHERE DLR_CD      = #{dlrCd}      --딜러코드
           AND CLAIM_NO    = #{claimNo}    --DMS클레임번호
           AND CLAIM_LINE  = #{claimLine}  --DMS클레임라인번호
    </delete>

    <!-- 클레임관리 정보를 조회한다. -->
    <select id="selectClaimManageItemByCondition" parameterType="ClaimSearchVO" resultType="ClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.selectClaimManageItemByCondition] */
        SELECT   A.DLR_CD
                ,A.CLAIM_DOC_NO
                ,A.CLAIM_STAT_CD
                ,A.PLT_CD
                ,A.BP_CD
                ,A.DL_BP_CD
                ,NVL(D.BP_NM, ' ') AS DL_BP_NM
                ,B.INVC_DOC_NO
                ,B.INVC_DOC_LINE_NO
                ,B.MOBIS_INVC_NO
                ,B.MOBIS_INVC_LINE_NO
                ,B.INVC_DT
                ,B.PURC_ORD_NO
                ,B.PURC_ORD_LINE_NO
                ,A.ITEM_CD
                ,C.ITEM_NM
                ,B.INVC_QTY
                ,B.INVC_PRC
                ,B.INVC_AMT
                ,A.CLAIM_QTY
                ,A.CLAIM_TARG_CD
                ,A.CLAIM_TP
                ,A.PROC_TP
                ,A.CLAIM_UNIT_CD
                ,A.PRC
                ,A.AMT
                ,A.INVC_DOC_NO
                ,A.INVC_DOC_LINE_NO
                ,A.DOC_FILE_NO
                ,A.REQ_CONT
          FROM   PT_0441T A
                   INNER JOIN (
                           SELECT   A.DLR_CD
                                  , A.INVC_DOC_NO
                                  , B.INVC_DOC_LINE_NO
                                  , B.MOBIS_INVC_NO
                                  , B.MOBIS_INVC_LINE_NO
                                  , A.INVC_DT
                                  , B.PURC_ORD_NO
                                  , B.PURC_ORD_LINE_NO
                                  , B.INVC_QTY
                                  , B.INVC_PRC
                                  , B.INVC_AMT
                             FROM PT_0431T A
                                    INNER JOIN PT_0432T B
                                      ON A.DLR_CD = B.DLR_CD
                                     AND A.INVC_DOC_NO = B.INVC_DOC_NO
                          ) B
                 ON A.DLR_CD           = B.DLR_CD
                AND A.INVC_DOC_NO      = B.INVC_DOC_NO
                AND A.INVC_DOC_LINE_NO = B.INVC_DOC_LINE_NO
               INNER JOIN PT_0201T C
                 ON A.DLR_CD           = C.DLR_CD
                AND A.ITEM_CD          = C.ITEM_CD
               LEFT OUTER JOIN PT_0211T D
                 ON A.DLR_CD           = D.DLR_CD
                AND A.DL_BP_CD         = D.BP_CD
         WHERE  A.DLR_CD        = #{sDlrCd}        --딜러코드
           AND  A.DEL_YN       != 'Y'
           <if test='sPurcOrdNo != null and sPurcOrdNo != ""'>
               AND A.PURC_ORD_NO LIKE '%'|| #{sPurcOrdNo} ||'%'
           </if>        --구매오더정보
           <if test='sMobisInvcNo != null and sMobisInvcNo != ""'>
               AND B.MOBIS_INVC_NO LIKE '%'|| #{sMobisInvcNo} ||'%'
           </if>        --모비스송장번호
           <if test='sClaimDocNo != null and sClaimDocNo != ""'>
               AND A.CLAIM_DOC_NO LIKE '%'|| #{sClaimDocNo} ||'%'
           </if>        --모비스송장번호
           <if test='sRegDtFr != null'>
                <choose>
                    <otherwise>
                         AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                    </otherwise>
                </choose>
            </if>
            <if test='sRegDtTo != null'>
                <choose>
                    <otherwise>
                         AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                    </otherwise>
                </choose>
            </if>
            <if test='sItemCd != null and sItemCd != ""'>
                AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
            </if>        --부품번호
            <if test='sItemNm != null and sItemNm != ""'>
                AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
           </if>
           <if test='sClaimStatCd != null and sClaimStatCd != ""'>
               AND A.CLAIM_STAT_CD = #{sClaimStatCd}
           </if>        --클레임 상태
           <if test='sAbcInd != null and sAbcInd != ""'>
               AND C.ABC_IND = #{sAbcInd}
           </if>        --ABC CLASS
           <if test='sCarlineCd != null and sCarlineCd != ""'>
               AND C.CARLINE_CD = #{sCarlineCd}
           </if>        --차종
           ORDER BY
         <choose>
             <when test='sort != null'>
                 <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                     <choose>
                         <when test='item.field == "invcDt"'>        B.INVC_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                         <when test='item.field == "claimDocNo"'>    A.CLAIM_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                         <when test='item.field == "claimStatCd"'>   A.CLAIM_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>   </when>
                         <when test='item.field == "mobisInvcNo"'>   B.MOBIS_INVC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                         <when test='item.field == "purcOrdNo"'>     B.PURC_ORD_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                         <when test='item.field == "itemCd"'>        B.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                         <otherwise>
                              B.INVC_DT DESC
                             ,A.CLAIM_DOC_NO DESC
                         </otherwise>
                     </choose>
                 </foreach>
             </when>
             <otherwise>
                   B.INVC_DT DESC
                  ,A.CLAIM_DOC_NO DESC
             </otherwise>
         </choose>
    </select>

    <!-- 클레임관리 정보 Count를 조회한다. -->
    <select id="selectClaimManageItemByConditionCnt" parameterType="ClaimSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.selectClaimManageItemByConditionCnt] */
        SELECT   COUNT(*)
          FROM   PT_0441T A
                   INNER JOIN (
                           SELECT   A.DLR_CD
                                  , A.INVC_DOC_NO
                                  , B.INVC_DOC_LINE_NO
                                  , B.MOBIS_INVC_NO
                                  , B.MOBIS_INVC_LINE_NO
                                  , A.INVC_DT
                                  , B.PURC_ORD_NO
                                  , B.PURC_ORD_LINE_NO
                                  , B.INVC_QTY
                                  , B.INVC_PRC
                                  , B.INVC_AMT
                             FROM PT_0431T A
                                    INNER JOIN PT_0432T B
                                      ON A.DLR_CD = B.DLR_CD
                                     AND A.INVC_DOC_NO = B.INVC_DOC_NO
                          ) B
                 ON A.DLR_CD           = B.DLR_CD
                AND A.INVC_DOC_NO      = B.INVC_DOC_NO
                AND A.INVC_DOC_LINE_NO = B.INVC_DOC_LINE_NO
               INNER JOIN PT_0201T C
                 ON A.DLR_CD           = C.DLR_CD
                AND A.ITEM_CD          = C.ITEM_CD
               LEFT OUTER JOIN PT_0211T D
                 ON A.DLR_CD           = D.DLR_CD
                AND A.DL_BP_CD         = D.BP_CD
         WHERE  A.DLR_CD        = #{sDlrCd}        --딜러코드
           AND  A.DEL_YN       != 'Y'
           <if test='sPurcOrdNo != null and sPurcOrdNo != ""'>
               AND A.PURC_ORD_NO LIKE '%'|| #{sPurcOrdNo} ||'%'
           </if>        --구매오더정보
           <if test='sMobisInvcNo != null and sMobisInvcNo != ""'>
               AND B.MOBIS_INVC_NO LIKE '%'|| #{sMobisInvcNo} ||'%'
           </if>        --모비스송장번호
           <if test='sClaimDocNo != null and sClaimDocNo != ""'>
               AND A.CLAIM_DOC_NO LIKE '%'|| #{sClaimDocNo} ||'%'
           </if>        --모비스송장번호
           <if test='sRegDtFr != null'>
                <choose>
                    <otherwise>
                         AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                    </otherwise>
                </choose>
            </if>
            <if test='sRegDtTo != null'>
                <choose>
                    <otherwise>
                         AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                    </otherwise>
                </choose>
            </if>
            <if test='sItemCd != null and sItemCd != ""'>
                AND A.ITEM_CD    LIKE '%'|| #{sItemCd} ||'%'
            </if>        --부품번호
            <if test='sItemNm != null and sItemNm != ""'>
                 AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
           </if>
           <if test='sClaimStatCd != null and sClaimStatCd != ""'>
               AND A.CLAIM_STAT_CD = #{sClaimStatCd}
           </if>        --클레임 상태
           <if test='sAbcInd != null and sAbcInd != ""'>
               AND C.ABC_IND = #{sAbcInd}
           </if>        --ABC CLASS
           <if test='sCarlineCd != null and sCarlineCd != ""'>
               AND C.CARLINE_CD = #{sCarlineCd}
           </if>        --차종
    </select>

    <!-- 품질클레임 정보를 조회한다. -->
    <select id="selectQualityClaimByCondition" parameterType="QualityClaimSearchVO" resultType="QualityClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.selectQualityClaimByCondition] */
        SELECT   A.*
          FROM (
            SELECT   ROWNUM AS RNUM
                       , T1.*
                  FROM (
                        SELECT
                                A.DLR_CD                        --딜러코드
                               ,A.CLAIM_NO                      --DMS클레임번호
                               ,A.CLAIM_CODE                    --BMP클레임번호
                               ,A.ORDER_NO                      --오더번호
                               ,A.ORDER_LN                      --오더라인번호
                               ,A.PART_NO                       --부품번호
                               ,B.ITEM_NM AS PART_NM            --부품명
                               ,A.CLAIM_NUM                     --클레임수량
                               ,A.DEALER_CLAIM_WAY              --클레임방식
                               ,A.CLAIM_CATEGORY                 --유형표기
                               ,A.RESPONSIBILITY                --책임표기
                               ,A.ADDED
                               ,A.STATUS                        --처리상태
                               ,A.DEAL_DATE                     --배상년월
                               ,TO_CHAR(A.DEAL_DATE,'YYYY-MM-DD') AS DEAL_DATE_CHAR                 --도착일
                               ,A.DEAL_MARK                     --배상표기
                               ,A.WORN_DEAL                     --클레임건처리
                               ,A.WORN_STATUS                   --클레임건상태
                               ,A.IS_CHECK                      --탁송여부
                               ,A.HAS_ARRIVED                   --도착여부
                               ,A.WORN_ARRIVAL_NUM              --클레임건도착수량
                               ,A.HAS_SUBMIT                    --변상수령증
                               ,A.RECLAIM_ORDER                 --화물송장코드회수
                               ,A.BILL_NO                       --영수증코드
                               ,A.ARRIVAL_DATE                  --도착일
                               ,TO_CHAR(A.ARRIVAL_DATE,'YYYY-MM-DD') AS ARRIVAL_DATE_CHAR                 --도착일
                               ,A.VIN                           --VIN코드
                               ,A.ENGINE_CYLINDER               --엔진실린더
                               ,TO_CHAR(A.PROBLEM_DATE,'YYYY-MM-DD') AS PROBLEM_DATE_CHAR                 --도착일
                               ,A.PROBLEM_DATE                  --문제발견일
                               ,A.CREATE_TIME                   --신청일자
                               ,A.CAR_MODEL                     --차형코드
                               ,A.CLAIM_TYPE                    --클레임유형
                               ,A.PRC_CODE                      --발주창고
                               ,A.DELIVERY_TYPE                 --배송방식
                               ,A.TRANSPORT_NO                  --화물송장코드
                               ,A.DELIVERY_REMARK               --화물송장비고
                               ,A.DESCRIPTION                   --상세묘사
                               ,A.IS_INDIVIDUAL_WRAPPED         --부품종이박스포장
                               ,A.IS_PACKING_SOUND              --종이박스포장온전함
                               ,A.HAS_PART_FRAGMENT             --포장내깨진조각있음
                               ,A.HAS_OUTER_WRAPPER             --종이박스가AD/SQ에있음
                               ,A.IS_OUTER_PACKING_SOUND        --SD/SQ박스온전
                               ,A.TAG_FILE_URL                  --부속품(태그)
                               ,A.TAG_FILE_DATA_CONT            --부속품(태그)
                               ,A.PART_FILE_URL                 --부속품(부품)
                               ,A.PAR_FILE_DATA_CONT           --부속품(부품)
                               ,A.PACK_FILE_URL                 --부속품(포장)
                               ,A.PACK_FILE_DATA_CONT           --부속품(포장)
                               ,A.CLAIMANTS                     --부품매니저
                               ,A.CLAIM_PERSON                  --클레임신고일
                               ,A.TELEPHONE                     --신고인연락처
                               ,A.COMPENSATION_WAY              --배상방식
                               ,A.SUPPLIER_CODE                 --공급상코드
                               ,A.IS_COMPENSATION               --배상여부
                               ,A.CIRCULATION_NO                --서큘레이션번호
                               ,CASE WHEN NVL(A.SHOP_PRICE,0) = 0 THEN 0
                                     ELSE ROUND(A.SHOP_PRICE/100,2)
                                END SHOP_PRICE                    --판매가격
                               ,CASE WHEN NVL(A.TOTAL_PRICE,0) = 0 THEN 0
                                     ELSE ROUND(A.TOTAL_PRICE/100,2)
                                END TOTAL_PRICE                    --총판매금액
                               ,CASE WHEN NVL(A.SURCHARGE,0) = 0 THEN 0
                                     ELSE ROUND(A.SURCHARGE/100,2)
                                END SURCHARGE                    --부대금액
                               ,CASE WHEN NVL(A.PROPORTION,0) = 0 THEN 0
                                     ELSE ROUND(A.PROPORTION/100,2)
                                END PROPORTION                    --배상율
                               ,CASE WHEN NVL(A.TAX,0) = 0 THEN 0
                                     ELSE ROUND(A.TAX/100,2)
                                END TAX                    --세금율
                               ,CASE WHEN NVL(A.ORPTION_RATE_DEALER,0) = 0 THEN 0
                                     ELSE ROUND(A.ORPTION_RATE_DEALER/100,2)
                                END ORPTION_RATE_DEALER                    --배부율
                               ,CASE WHEN NVL(A.LABOR_FEE,0) = 0 THEN 0
                                     ELSE ROUND(A.LABOR_FEE/100,2)
                                END LABOR_FEE                    --공임비용
                               ,CASE WHEN NVL(A.OUT_FEE,0) = 0 THEN 0
                                     ELSE ROUND(A.OUT_FEE/100,2)
                                END OUT_FEE                    --외주비용
                               ,CASE WHEN NVL(A.TOTAL_MONEY,0) = 0 THEN 0
                                     ELSE ROUND(A.TOTAL_MONEY/100,2)
                                END TOTAL_MONEY                 --배상총금액
                               ,CASE WHEN NVL(A.TOTAL_MONEY_TAX,0) = 0 THEN 0
                                     ELSE ROUND(A.TOTAL_MONEY_TAX/100,2)
                                END TOTAL_MONEY_TAX                 --배상총세액
                               ,A.SURCHARGE_EXPLAIN             --부대비용 설명
                               ,A.REMARK                        --배상비고
                               ,A.ADDED                         --보완자료
                               ,A.BMP_DEAL_CHIEF                --처리담당
                               ,A.DECIDE_DATE                   --판정일
                               ,B.ITEM_EN_NM AS PART_EN_NM
                               ,TO_CHAR(A.DECIDE_DATE,'YYYY-MM-DD') AS DECIDE_DATE_CHAR                 --도착일
                          FROM  DMSDB.PT_0444T A    --품질클레임정보
                                  INNER JOIN PT_0201T B
                                     ON A.DLR_CD     = B.DLR_CD
                                    AND A.PART_NO    = B.ITEM_CD
                         WHERE  A.DLR_CD = #{sDlrCd}        --딜러코드
                           <if test='sClaimCode != null and sClaimCode != ""'>
                               AND A.CLAIM_CODE LIKE '%'|| #{sClaimCode} ||'%'
                           </if>        --BMP클레임번호
                           <if test='sClaimNo != null and sClaimNo != ""'>
                               AND A.CLAIM_NO LIKE '%'|| #{sClaimNo} ||'%'
                           </if>        --DMS클레임번호
                           <if test='sOrderNo != null and sOrderNo != ""'>
                               AND A.ORDER_NO LIKE '%'||  #{sOrderNo} ||'%'
                           </if>        --오더번호
                           <if test='sPartNo != null and sPartNo != ""'>
                               AND A.PART_NO like '%'|| #{sPartNo} ||'%'
                           </if>        --부품번호
                           <if test='sCompensationWay != null and sCompensationWay != ""'>
                               AND A.COMPENSATION_WAY = #{sCompensationWay}
                           </if>        --배상방식
                           <if test='sStatus != null and sStatus != ""'>
                               AND A.STATUS = #{sStatus}
                           </if>        --처리상태
                           <if test='sDealMark != null and sDealMark != ""'>
                               AND A.DEAL_MARK = #{sDealMark}
                           </if>        --배상표기
                           <if test='sCreateTimeFr != null'>
                                <choose>
                                    <otherwise>
                                         AND A.CREATE_TIME <![CDATA[>=]]> #{sCreateTimeFr}
                                    </otherwise>
                                </choose>
                            </if>
                            <if test='sCreateTimeTo != null'>
                                <choose>
                                    <otherwise>
                                         AND A.CREATE_TIME <![CDATA[<=]]> #{sCreateTimeTo} + 1
                                    </otherwise>
                                </choose>
                            </if>
                            <if test='sWornStatus != null and sWornStatus != ""'>
                                AND A.WORN_STATUS = #{sWornStatus}
                            </if>        --클레임건상태
                            <if test='sHasSubmit != null and sHasSubmit != ""'>
                                AND A.HAS_SUBMIT = #{sHasSubmit}
                            </if>        --변상수령증
                            <if test='sHasArrived != null and sHasArrived != ""'>
                                AND A.HAS_ARRIVED = #{sHasArrived}
                            </if>        --도착여부
                            <if test='sIsCheck != null and sIsCheck != ""'>
                                AND A.IS_CHECK = #{sIsCheck}
                            </if>        --탁송여부
                            <if test='sBillNo != null and sBillNo != ""'>
                                AND A.BILL_NO like '%'|| #{sBillNo} ||'%'
                            </if>        --영수증번호
                            <if test='sRequestClaimYn != null and sRequestClaimYn != ""'>
                                <choose>
                                     <when test='sRequestClaimYn == "Y"'>
                                         AND A.CLAIM_CODE IS NOT NULL
                                     </when>
                                     <otherwise>
                                         AND A.CLAIM_CODE IS NULL
                                     </otherwise>
                               </choose>
                            </if>        --클레임 신청여부
                            <if test='sDealDateFr != null'>
                                <choose>
                                    <otherwise>
                                         AND A.DEAL_DATE <![CDATA[>=]]> #{sDealDateFr}
                                    </otherwise>
                                </choose>
                            </if>
                            <if test='sDealDateTo != null'>
                                <choose>
                                    <otherwise>
                                         AND A.DEAL_DATE <![CDATA[<=]]> #{sDealDateTo} + 1
                                    </otherwise>
                                </choose>
                            </if>
                         ORDER BY
                              A.DLR_CD ASC
                             ,A.CLAIM_NO ASC
                             ,A.CLAIM_CODE
                 ) T1
              ) A
              <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
            </where>
    </select>

    <!-- 품질클레임 정보 Count를 조회한다. -->
    <select id="selectQualityClaimByConditionCnt" parameterType="QualityClaimSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.selectQualityClaimByConditionCnt] */
        SELECT   COUNT(*)
          FROM  DMSDB.PT_0444T A    --품질클레임정보
                  INNER JOIN PT_0201T B
                     ON A.DLR_CD   = B.DLR_CD
                    AND A.PART_NO  = B.ITEM_CD
         WHERE  A.DLR_CD = #{sDlrCd}        --딜러코드
           <if test='sClaimCode != null and sClaimCode != ""'>
               AND A.CLAIM_CODE LIKE '%'|| #{sClaimCode} ||'%'
           </if>        --BMP클레임번호
           <if test='sClaimNo != null and sClaimNo != ""'>
               AND A.CLAIM_NO LIKE '%'|| #{sClaimNo} ||'%'
           </if>        --DMS클레임번호
           <if test='sOrderNo != null and sOrderNo != ""'>
               AND A.ORDER_NO LIKE '%'||  #{sOrderNo} ||'%'
           </if>        --오더번호
           <if test='sPartNo != null and sPartNo != ""'>
               AND A.PART_NO like '%'|| #{sPartNo} ||'%'
           </if>        --부품번호
           <if test='sCompensationWay != null and sCompensationWay != ""'>
               AND A.COMPENSATION_WAY = #{sCompensationWay}
           </if>        --배상방식
           <if test='sStatus != null and sStatus != ""'>
               AND A.STATUS = #{sStatus}
           </if>        --처리상태
           <if test='sDealMark != null and sDealMark != ""'>
               AND A.DEAL_MARK = #{sDealMark}
           </if>        --배상표기
           <if test='sCreateTimeFr != null'>
                <choose>
                    <otherwise>
                         AND A.CREATE_TIME <![CDATA[>=]]> #{sCreateTimeFr}
                    </otherwise>
                </choose>
            </if>
            <if test='sCreateTimeTo != null'>
                <choose>
                    <otherwise>
                         AND A.CREATE_TIME <![CDATA[<=]]> #{sCreateTimeTo} + 1
                    </otherwise>
                </choose>
            </if>
             <if test='sWornStatus != null and sWornStatus != ""'>
                AND A.WORN_STATUS = #{sWornStatus}
            </if>        --클레임건상태
            <if test='sHasSubmit != null and sHasSubmit != ""'>
                AND A.HAS_SUBMIT = #{sHasSubmit}
            </if>        --변상수령증
            <if test='sHasArrived != null and sHasArrived != ""'>
                AND A.HAS_ARRIVED = #{sHasArrived}
            </if>        --도착여부
            <if test='sIsCheck != null and sIsCheck != ""'>
                AND A.IS_CHECK = #{sIsCheck}
            </if>        --탁송여부
            <if test='sBillNo != null and sBillNo != ""'>
                AND A.BILL_NO like '%'|| #{sBillNo} ||'%'
            </if>        --탁송여부
            <if test='sRequestClaimYn != null and sRequestClaimYn        != ""'>
                <choose>
                     <when test='sRequestClaimYn == "Y"'>
                         AND A.CLAIM_CODE IS NOT NULL
                     </when>
                     <otherwise>
                         AND A.CLAIM_CODE IS NULL
                     </otherwise>
               </choose>
            </if>        --클레임 신청여부
            <if test='sDealDateFr != null'>
                <choose>
                    <otherwise>
                         AND A.DEAL_DATE <![CDATA[>=]]> #{sDealDateFr}
                    </otherwise>
                </choose>
            </if>
            <if test='sDealDateTo != null'>
                <choose>
                    <otherwise>
                         AND A.DEAL_DATE <![CDATA[<=]]> #{sDealDateTo} + 1
                    </otherwise>
                </choose>
            </if>
    </select>

    <!-- 품질클레임 정보를 조회한다. -->
    <select id="selectQualityClaimByKey" parameterType="QualityClaimSearchVO" resultType="QualityClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.selectQualityClaimByKey] */
                    SELECT
                            A.DLR_CD                        --딜러코드
                           ,A.CLAIM_NO                      --DMS클레임번호
                           ,A.CLAIM_CODE                    --BMP클레임번호
                           ,A.ORDER_NO                      --오더번호
                           ,A.ORDER_LN                      --오더라인번호
                           ,A.PART_NO                       --부품번호
                           ,B.ITEM_NM AS PART_NM            --부품명
                           ,A.CLAIM_NUM                     --클레임수량
                           ,A.DEALER_CLAIM_WAY              --클레임방식
                           ,A.TOTAL_MONEY_TAX               --배상총금액세금포함
                           ,A.CLAIM_CATEGORY                 --유형표기
                           ,A.RESPONSIBILITY                --책임표기
                           ,A.STATUS                        --처리상태
                           ,A.DEAL_DATE                     --배상년월
                           ,TO_CHAR(A.DEAL_DATE,'YYYY-MM-DD') AS DEAL_DATE_CHAR                 --도착일
                           ,A.DEAL_MARK                     --배상표기
                           ,A.WORN_DEAL                     --클레임건처리
                           ,A.WORN_STATUS                   --클레임건상태
                           ,A.IS_CHECK                      --탁송여부
                           ,A.HAS_ARRIVED                   --도착여부
                           ,A.WORN_ARRIVAL_NUM              --클레임건도착수량
                           ,A.HAS_SUBMIT                    --변상수령증
                           ,A.RECLAIM_ORDER                 --화물송장코드회수
                           ,A.BILL_NO                       --영수증코드
                           ,A.ARRIVAL_DATE                  --도착일
                           ,TO_CHAR(A.ARRIVAL_DATE,'YYYY-MM-DD') AS ARRIVAL_DATE_CHAR                 --도착일
                           ,A.VIN                           --VIN코드
                           ,A.ENGINE_CYLINDER               --엔진실린더
                           ,A.PROBLEM_DATE                  --문제발견일
                           ,TO_CHAR(A.PROBLEM_DATE,'YYYY-MM-DD') AS PROBLEM_DATE_CHAR                 --문제발견일
                           ,A.CREATE_TIME                   --신청일자
                           ,A.CAR_MODEL                     --차형코드
                           ,A.CLAIM_TYPE                    --클레임유형
                           ,A.PRC_CODE                      --발주창고
                           ,A.DELIVERY_TYPE                 --배송방식
                           ,A.TRANSPORT_NO                  --화물송장코드
                           ,A.DELIVERY_REMARK               --화물송장비고
                           ,A.DESCRIPTION                   --상세묘사
                           ,A.IS_INDIVIDUAL_WRAPPED         --부품종이박스포장
                           ,A.IS_PACKING_SOUND              --종이박스포장온전함
                           ,A.HAS_PART_FRAGMENT             --포장내깨진조각있음
                           ,A.HAS_OUTER_WRAPPER             --종이박스가AD/SQ에있음
                           ,A.IS_OUTER_PACKING_SOUND        --SD/SQ박스온전
                           ,A.TAG_FILE_URL                  --부속품(태그)
                           ,A.TAG_FILE_DATA_CONT            --부속품(태그)
                           ,A.PART_FILE_URL                 --부속품(부품)
                           ,A.PAR_FILE_DATA_CONT           --부속품(부품)
                           ,A.PACK_FILE_URL                 --부속품(포장)
                           ,A.PACK_FILE_DATA_CONT           --부속품(포장)
                           ,A.CLAIMANTS                     --부품매니저
                           ,A.CLAIM_PERSON                  --클레임신고일
                           ,A.TELEPHONE                     --신고인연락처
                           ,A.COMPENSATION_WAY              --배상방식
                           ,A.SUPPLIER_CODE                 --공급상코드
                           ,A.IS_COMPENSATION               --배상여부
                           ,A.CIRCULATION_NO                --서큘레이션번호
                           ,A.SHOP_PRICE                    --판매망가격
                           ,A.TOTAL_PRICE                   --총판매금액
                           ,A.SURCHARGE                     --부대금액
                           ,A.PROPORTION                    --배상율
                           ,A.TAX                           --세금율
                           ,A.ORPTION_RATE_DEALER           --배부율
                           ,A.LABOR_FEE                     --공임비용
                           ,A.OUT_FEE                       --외주비용
                           ,A.TOTAL_MONEY                   --배상총금액
                           ,A.REMARK                        --배상비고
                           ,A.ADDED                         --보완자료
                           ,A.BMP_DEAL_CHIEF                --처리담당
                           ,A.DECIDE_DATE                   --판정일
                           ,TO_CHAR(A.DECIDE_DATE,'YYYY-MM-DD') AS DECIDE_DATE_CHAR                 --판정일
                           ,A.UPDT_DT                   --판정일
                      FROM  DMSDB.PT_0444T A    --품질클레임정보
                              INNER JOIN PT_0201T B
                                 ON A.DLR_CD           = B.DLR_CD
                                AND A.PART_NO          = B.ITEM_CD
                     WHERE  A.DLR_CD        = #{sDlrCd}        --딜러코드
                       AND  A.CLAIM_NO =      #{sClaimNo}      --클레임번호
    </select>

    <!-- 품질클레임 정보를 조회한다.(클레임다운로드 출력물용) -->
    <select id="selectQualityClaimDownloadListByCondition" parameterType="QualityClaimSearchVO" resultType="QualityClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.selectQualityClaimDownloadListByCondition] */
          Select  A.Dlr_Cd
                 ,A.Claim_No
                 ,A.CLAIM_CODE
                 ,A.Part_No
                 ,A.Claim_Num
                 ,A.SHOP_PRICE
                 ,A.Total_Price
                 ,A.Proportion
                 ,A.Total_Money
                 ,A.Total_Money_Tax
                 ,A.CLAIM_TYPE
                 ,A.Responsibility
                 ,A.Bill_No
                 ,A.TNUM
            FROM
                (
                Select  A.Dlr_Cd
                       ,A.Claim_No
                       ,MAX(A.CLAIM_CODE) AS CLAIM_CODE
                       ,MAX(A.Part_No) AS Part_No
                       ,SUM(A.Claim_Num) AS Claim_Num
                       ,SUM(A.SHOP_PRICE) AS SHOP_PRICE
                       ,Sum(A.Total_Price) As Total_Price
                       ,SUM(A.Proportion) AS Proportion
                       ,Sum(A.Total_Money) As Total_Money
                       ,SUM(A.Total_Money_Tax) AS Total_Money_Tax
                       ,MAX(A.CLAIM_TYPE) AS CLAIM_TYPE
                       ,MAX(A.Responsibility) AS Responsibility
                       ,Max(A.Bill_No) As Bill_No
                       ,Max(A.TNUM) As TNUM
                  FROM
                      (
                      Select  A.DLR_CD
                             ,Case When A.Tnum = 2
                                    Then '总计'
                                  Else A.Claim_No
                              End Claim_No
                             ,Case When A.Tnum = 2
                                    Then '总计'
                                  Else A.CLAIM_CODE
                              End CLAIM_CODE
                             ,Case When A.Tnum = 2
                                    Then NULL
                                  Else A.Part_No
                              End Part_No
                             ,Case When A.Tnum = 2
                                    Then NULL
                                  Else A.Claim_Num
                              End Claim_Num
                              ,Case When A.Tnum = 2
                                    Then NULL
                                  Else A.SHOP_PRICE
                              End Shop_Price
                               ,A.TOTAL_PRICE                   --총판매금액
                              ,Case When A.Tnum = 2
                                    Then NULL
                                  Else A.Proportion
                              End Proportion
                               ,A.Total_Money                   --배상총금액
                              ,A.Total_Money_Tax               --배상총세액
                              ,Case When A.Tnum = 2
                                    Then NULL
                                  Else A.CLAIM_TYPE
                              End CLAIM_TYPE
                              ,Case When A.Tnum = 2
                                    Then NULL
                                  Else A.Responsibility
                              End Responsibility
                              ,Case When A.Tnum = 2
                                    Then NULL
                                  Else A.Bill_No
                              End Bill_No
                              ,A.TNUM
                        FROM
                          (
                            SELECT
                                        A.DLR_CD                        --딜러코드
                                       ,A.CLAIM_NO                      --DMS클레임번호
                                       ,A.CLAIM_CODE                    --BMP클레임번호
                                       ,A.Part_No                       --부품번호
                                       ,A.Responsibility                --책임표기
                                       ,A.CLAIM_TYPE                    --클레임유형
                                       ,A.Claim_Num                     --클레임수량
                                       ,A.Bill_No                       --영수증코드
                                       ,CASE WHEN NVL(A.SHOP_PRICE,0) = 0 THEN 0
                                             ELSE ROUND(A.SHOP_PRICE/100,2)
                                        END SHOP_PRICE                    --판매가격
                                       ,CASE WHEN NVL(A.TOTAL_PRICE,0) = 0 THEN 0
                                             ELSE ROUND(A.TOTAL_PRICE/100,2)
                                        END TOTAL_PRICE                    --총판매금액
                                       ,CASE WHEN NVL(A.PROPORTION,0) = 0 THEN 0
                                             ELSE ROUND(A.PROPORTION/100,2)
                                        END PROPORTION                    --배상율
                                       ,CASE WHEN NVL(A.TOTAL_MONEY,0) = 0 THEN 0
                                             ELSE ROUND(A.TOTAL_MONEY/100,2)
                                        END TOTAL_MONEY                 --배상총금액
                                       ,CASE WHEN NVL(A.TOTAL_MONEY_TAX,0) = 0 THEN 0
                                             Else Round(A.Total_Money_Tax/100,2)
                                        End Total_Money_Tax                 --배상총세액
                                       ,B.TNUM
                                  From  Dmsdb.Pt_0444t A    --품질클레임정보
                                       ,(
                                          Select 1 AS TNUM
                                            From Dual
                                           Union All
                                           Select 2  AS TNUM
                                            From Dual
                                        ) B
                                   WHERE  A.DLR_CD = #{sDlrCd}        --딜러코드
                                       <if test='sClaimCode != null and sClaimCode != ""'>
                                           AND A.CLAIM_CODE like '%'|| #{sClaimCode} ||'%'
                                       </if>        --BMP클레임번호
                                       <if test='sClaimNo != null and sClaimNo != ""'>
                                           AND A.CLAIM_NO like '%'|| #{sClaimNo} ||'%'
                                       </if>        --DMS클레임번호
                                       <if test='sOrderNo != null and sOrderNo != ""'>
                                           AND A.ORDER_NO like '%'|| #{sOrderNo} ||'%'
                                       </if>        --오더번호
                                       <if test='sPartNo != null and sPartNo != ""'>
                                           AND A.PART_NO like '%'|| #{sPartNo} ||'%'
                                       </if>        --부품번호
                                       <if test='sCompensationWay != null and sCompensationWay != ""'>
                                           AND A.COMPENSATION_WAY = #{sCompensationWay}
                                       </if>        --배상방식
                                       <if test='sStatus != null and sStatus != ""'>
                                           AND A.STATUS = #{sStatus}
                                       </if>        --처리상태
                                       <if test='sDealMark != null and sDealMark != ""'>
                                           AND A.DEAL_MARK = #{sDealMark}
                                       </if>        --배상표기
                                       <if test='sCreateTimeFr != null'>
                                            <choose>
                                                <otherwise>
                                                     AND A.CREATE_TIME <![CDATA[>=]]> #{sCreateTimeFr}
                                                </otherwise>
                                            </choose>
                                        </if>
                                        <if test='sCreateTimeTo != null'>
                                            <choose>
                                                <otherwise>
                                                     AND A.CREATE_TIME <![CDATA[<=]]> #{sCreateTimeTo} + 1
                                                </otherwise>
                                            </choose>
                                        </if>
                                        <if test='sWornStatus != null and sWornStatus != ""'>
                                            AND A.WORN_STATUS = #{sWornStatus}
                                        </if>        --클레임건상태
                                        <if test='sHasSubmit != null and sHasSubmit != ""'>
                                            AND A.HAS_SUBMIT = #{sHasSubmit}
                                        </if>        --변상수령증
                                        <if test='sHasArrived != null and sHasArrived != ""'>
                                            AND A.HAS_ARRIVED = #{sHasArrived}
                                        </if>        --도착여부
                                        <if test='sIsCheck != null and sIsCheck != ""'>
                                            AND A.IS_CHECK = #{sIsCheck}
                                        </if>        --탁송여부
                                        <if test='sBillNo != null and sBillNo != ""'>
                                            AND A.BILL_NO like '%'|| #{sBillNo} ||'%'
                                        </if>        --탁송여부
                                        <if test='sRequestClaimYn != null and sRequestClaimYn        != ""'>
                                            <choose>
                                                 <when test='sRequestClaimYn == "Y"'>
                                                     AND A.CLAIM_CODE IS NOT NULL
                                                 </when>
                                                 <otherwise>
                                                     AND A.CLAIM_CODE IS NULL
                                                 </otherwise>
                                           </choose>
                                        </if>        --클레임 신청여부
                                        <if test='sDealDateFr != null'>
                                            <choose>
                                                <otherwise>
                                                     AND A.DEAL_DATE <![CDATA[>=]]> #{sDealDateFr}
                                                </otherwise>
                                            </choose>
                                        </if>
                                        <if test='sDealDateTo != null'>
                                            <choose>
                                                <otherwise>
                                                     AND A.DEAL_DATE <![CDATA[<=]]> #{sDealDateTo} + 1
                                                </otherwise>
                                            </choose>
                                        </if>
                              ) A
                         ) A
                         Group By A.Dlr_Cd
                                , A.Claim_No
                    ) A
                    ORDER BY A.TNUM, A.DLR_CD, A.CLAIM_CODE DESC
    </select>

    <!-- 과부족클레임 정보를 조회한다. -->
    <select id="selectOversAndShortsClaimByCondition" parameterType="OversAndShortsClaimSearchVO" resultType="OversAndShortsClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.selectOversAndShortsClaimByCondition] */
          SELECT   A.*
            FROM (
                SELECT   ROWNUM AS RNUM
                           , T1.*
                  FROM (
                        SELECT
                                A.DLR_CD                         --딜러코드
                               ,A.CLAIM_NO                       --DMS클레임번호
                               ,A.CLAIMANT_NO                    --BMP클레임코드
                               ,A.STATUS                         --상태
                               ,A.CLAIMANT_NAME                  --클레임배상
                               ,A.CREATE_TIME                    --신고일
                               ,A.BOXING_NO                      --송장문서번호
                               ,A.SELL_INVENTORY_NO              --판매리스트코드
                               ,A.WAYBILL_NO                     --운송번호
                               ,A.ARRIVED_DATE                   --도착일
                               ,A.DELIVERY_INVENTORY_DATE        --출고서일자
                               ,A.DELIVERY_INVENTORY_NO          --출고서번호
                               ,A.IS_INTACT                      --포장완벽여부
                               ,A.ATTACHMENT_NAME                --첨부파일명
                               ,A.ATTACHMENT_URL                 --첨부파일URL
                           --    ,A.CLAIMANT_TOTAL_AMOUNT          --클레임총금액
                               ,A.BMP_PAYMENT_AMOUNT             --BMP배상금액
                               ,A.NO_REPARATION_REASON           --미배상원인
                               ,A.IS_PASS                        --심사통과여부
                               ,A.NO_PASS_REASON                 --심사불통원인
                               ,A.IS_ACCOUNT_ARRIVED             --선불금계좌에배상금이입금
                               ,A.DESCRIBE                       --상세서술
                               --,B.CLAIMANT_AMOUNT AS CLAIMANT_TOTAL_AMOUNT
                               ,B.CLAIM_PART_AMT AS CLAIMANT_TOTAL_AMOUNT
                               ,CASE WHEN NVL(A.CLAIMANT_NO,'N') != 'N' THEN '索赔接收信息' ELSE ' ' END CONTROL
                               ,B.ORDER_NO
                               ,B.ITEM_CNT
                               ,B.ITEM_QTY
                               ,B.INVC_CLAIM_AMT
                               ,B.ORDER_NO
                          FROM DMSDB.PT_0442T A    --과부족클레임헤더정보
                               LEFT OUTER JOIN (
                                       SELECT   A.DLR_CD
                                               ,A.CLAIM_NO
                                               ,MAX(A.ORDER_NO) AS ORDER_NO
                                               ,SUM(A.CLAIMANT_AMOUNT) AS CLAIMANT_AMOUNT
                                               ,SUM(A.CLAIMANT_NUM) AS ITEM_QTY
                                               ,SUM(A.INVC_CLAIM_AMT) AS INVC_CLAIM_AMT
                                               ,SUM(A.CLAIM_PART_AMT) AS CLAIM_PART_AMT
                                               ,COUNT(*) AS ITEM_CNT
                                          FROM (
                                                 select   A.DLR_CD
                                                         ,A.CLAIM_NO
                                                         ,A.ORDER_NO
                                                         ,NVL(A.CLAIMANT_AMOUNT,0) AS CLAIMANT_AMOUNT
                                                         ,NVL(A.CLAIMANT_NUM,0) AS CLAIMANT_NUM
                                                         ,(NVL(B.INVC_PRC,0) * NVL(A.CLAIMANT_NUM,0)) AS INVC_CLAIM_AMT
                                                         ,(NVL(A.PART_PRICE,0) * NVL(A.CLAIMANT_NUM,0)) AS CLAIM_PART_AMT
                                                   from   pt_0443t A
                                                          LEFT OUTER JOIN PT_0432T B
                                                             ON A.DLR_CD   = B.DLR_CD
                                                            AND A.ORDER_NO = B.INVC_IF_ORD_NO
                                                            AND A.PART_NO  = B.ITEM_CD
                                                   WHERE  A.DLR_CD = #{sDlrCd}
                                                ) A
                                                GROUP BY A.DLR_CD, A.CLAIM_NO) B
                                 ON A.DLR_CD   = B.DLR_CD
                                AND A.CLAIM_NO = B.CLAIM_NO
                         WHERE A.DLR_CD = #{sDlrCd}
                           <if test='sClaimantNo != null and sClaimantNo != ""'>
                               AND A.CLAIMANT_NO like '%'|| #{sClaimantNo} ||'%'
                           </if>        --BMP클레임코드
                           <if test='sOrderNo != null and sOrderNo != ""'>
                               AND B.ORDER_NO like '%'|| #{sOrderNo} ||'%'
                           </if>        --BMP오더번호
                           <if test='sStatus != null and sStatus != ""'>
                               AND A.STATUS = #{sStatus}
                           </if>        --상태
                           <if test='sCreateTimeFr != null'>
                               <choose>
                                   <otherwise>
                                        AND A.CREATE_TIME <![CDATA[>=]]> #{sCreateTimeFr}
                                   </otherwise>
                               </choose>
                           </if>
                           <if test='sCreateTimeTo != null'>
                               <choose>
                                   <otherwise>
                                        AND A.CREATE_TIME <![CDATA[<=]]> #{sCreateTimeTo} + 1
                                   </otherwise>
                               </choose>
                           </if>
                           <if test='sBoxingNo != null and sBoxingNo != ""'>
                               AND A.BOXING_NO like '%'|| #{sBoxingNo} ||'%'
                           </if>        --송장문서번호
                           <if test='sSellInventoryNo != null and sSellInventoryNo != ""'>
                               AND A.SELL_INVENTORY_NO like '%'|| #{sSellInventoryNo} ||'%'
                           </if>        --판매리스트코드
                           <if test='sRequestClaimYn != null and sRequestClaimYn != ""'>
                                <choose>
                                     <when test='sRequestClaimYn == "Y"'>
                                         AND A.CLAIMANT_NO IS NOT NULL
                                         AND A.STATUS <![CDATA[>]]> 0
                                     </when>
                                     <otherwise>
                                         AND A.CLAIMANT_NO IS NULL
                                         AND A.STATUS <![CDATA[<=]]> 1
                                     </otherwise>
                               </choose>
                            </if>        --클레임 신청여부
                            AND B.ITEM_QTY > 0 <!-- 클레임 처리 건수 > 0(CLAIMANT_NUM) -->
                      ORDER BY A.DLR_CD ASC ,A.CLAIM_NO DESC
                 ) T1
              ) A
              <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
            </where>
    </select>

    <!-- 과부족클레임 정보 Count를 조회한다. -->
    <select id="selectOversAndShortsClaimByConditionCnt" parameterType="OversAndShortsClaimSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.selectOversAndShortsClaimByConditionCnt] */
        SELECT   COUNT(*)
          FROM DMSDB.PT_0442T A    --과부족클레임헤더정보
         WHERE A.DLR_CD = #{sDlrCd}
           <if test='sClaimantNo != null and sClaimantNo != ""'>
               AND A.CLAIMANT_NO like '%'|| #{sClaimantNo} ||'%'
           </if>        --BMP클레임코드
           <if test='sStatus != null and sStatus != ""'>
               AND A.STATUS = #{sStatus}
           </if>        --상태
           <if test='sCreateTimeFr != null'>
               <choose>
                   <otherwise>
                        AND A.CREATE_TIME <![CDATA[>=]]> #{sCreateTimeFr}
                   </otherwise>
               </choose>
           </if>
           <if test='sCreateTimeTo != null'>
               <choose>
                   <otherwise>
                        AND A.CREATE_TIME <![CDATA[<=]]> #{sCreateTimeTo} + 1
                   </otherwise>
               </choose>
           </if>
           <if test='sBoxingNo != null and sBoxingNo != ""'>
               AND A.BOXING_NO like '%'|| #{sBoxingNo} ||'%'
           </if>        --송장문서번호
           <if test='sSellInventoryNo != null and sSellInventoryNo != ""'>
               AND A.SELL_INVENTORY_NO like '%'|| #{sSellInventoryNo} ||'%'
           </if>        --판매리스트코드
           <if test='sRequestClaimYn != null and sRequestClaimYn != ""'>
                <choose>
                     <when test='sRequestClaimYn == "Y"'>
                         AND A.CLAIMANT_NO IS NOT NULL
                         AND A.STATUS <![CDATA[>]]> 0
                     </when>
                     <otherwise>
                         AND A.CLAIMANT_NO IS NULL
                         AND A.STATUS <![CDATA[<=]]> 1
                     </otherwise>
               </choose>
            </if>        --클레임 신청여부
    </select>

    <!-- 과부족클레임 Key 정보를 조회한다. -->
    <select id="selectOversAndShortsClaimByKey" parameterType="OversAndShortsClaimSearchVO" resultType="OversAndShortsClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.selectOversAndShortsClaimByKey] */
            SELECT
                    A.DLR_CD                         --딜러코드
                   ,A.CLAIM_NO                       --DMS클레임번호
                   ,A.CLAIMANT_NO                    --BMP클레임코드
                   ,A.STATUS                         --상태
                   ,A.CLAIMANT_NAME                  --클레임배상
                   ,A.CREATE_TIME                    --신고일
                   ,TO_CHAR(A.CREATE_TIME,'YYYY-MM-DD') AS CREATE_TIME_CHAR                 --신고일
                   ,A.BOXING_NO                      --송장문서번호
                   ,A.SELL_INVENTORY_NO              --판매리스트코드
                   ,A.WAYBILL_NO                     --운송번호
                   ,A.ARRIVED_DATE                   --도착일
                   ,TO_CHAR(A.ARRIVED_DATE,'YYYY-MM-DD') AS ARRIVED_DATE_CHAR                 --도착일
                   ,A.DELIVERY_INVENTORY_DATE        --출고서일자
                   ,TO_CHAR(A.DELIVERY_INVENTORY_DATE,'YYYY-MM-DD') AS DELIVERY_INVENTORY_DATE_CHAR                 --출고서일자
                   ,A.DELIVERY_INVENTORY_NO          --출고서번호
                   ,A.IS_INTACT                      --포장완벽여부
                   ,A.ATTACHMENT_NAME                --첨부파일명
                   ,A.ATTACHMENT_URL                 --첨부파일URL
                   ,A.ATCH_FILE_CONT
                   ,A.CLAIMANT_TOTAL_AMOUNT          --클레임총금액
                   ,A.BMP_PAYMENT_AMOUNT             --BMP배상금액
                   ,A.NO_REPARATION_REASON           --미배상원인
                   ,A.IS_PASS                        --심사통과여부
                   ,A.NO_PASS_REASON                 --심사불통원인
                   ,A.IS_ACCOUNT_ARRIVED             --선불금계좌에배상금이입금
                   ,A.DESCRIBE                       --상세서술
              FROM DMSDB.PT_0442T A    --과부족클레임헤더정보
             WHERE A.DLR_CD     = #{sDlrCd}
               AND A.CLAIM_NO   = #{sClaimNo}      --클레임번호
    </select>

    <!-- 과부족클레임수신정보를 조회한다. -->
    <select id="selectOversAndShortsClaimInfcByKey" parameterType="OversAndShortsClaimSearchVO" resultType="OversAndShortsClaimVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.selectOversAndShortsClaimInfcByKey] */
            SELECT
                    A.DLR_CD                         --딜러코드
                   ,A.CLAIM_NO                       --DMS클레임번호
                   ,A.CLAIMANT_NO                    --BMP클레임코드
                   ,A.STATUS                         --상태
                   ,A.ENABLED                        --창고
                   ,A.AUDIT_TYPE
                   ,A.AUDIT_USER_ID
                   ,A.AUDIT_USER_NAME
                   ,A.AUDIT_TIME
                   ,A.CONFIRM_TYPE
                   ,A.CONFIRM_USER_ID
                   ,A.CONFIRM_USER_NAME
                   ,A.CONFIRM_TIME
                   ,A.HANDLE_TYPE
                   ,A.HANDLE_USER_ID
                   ,A.HANDLE_USER_NAME
                   ,A.HANDLE_TIME
                   ,A.ACCOUNT_TRACK_TYPE
                   ,A.ACCOUNT_USER_ID
                   ,A.ACCOUNT_USER_NAME
                   ,A.ACCOUNT_TIME
                   ,A.FOLLOW_TRACK_TYPE
                   ,A.FOLLOW_USER_ID
                   ,A.FOLLOW_USER_NAME
                   ,A.FOLLOW_TIME
              FROM DMSDB.PT_0442T A    --과부족클레임헤더정보
             WHERE A.DLR_CD        = #{sDlrCd}
               AND A.CLAIMANT_NO   = #{sClaimantNo}      --클레임번호
    </select>

    <!-- 과부족클레임 Key 부품정보를 조회한다. -->
    <select id="selectOversAndShortsClaimItemsByKey" parameterType="OversAndShortsClaimSearchVO" resultType="OversAndShortsClaimItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.selectOversAndShortsClaimItemsByKey] */
            SELECT
                    A.DLR_CD                 --딜러코드
                   ,A.CLAIM_NO               --DMS클레임번호
                   ,A.CLAIM_LINE             --클레임라인번호
                   ,A.ORDER_NO               --오더번호
                   ,A.PART_NO                --부품번호
                   ,NVL(A.CLAIMANT_TYPE, 0) AS  CLAIMANT_TYPE         --클레임유형
                   ,A.ERROR_PART_NO          --오전송부품번호
                   ,A.ORDER_NUM              --발주수량
                   ,A.REAL_NUM               --실제도착수량
                   ,A.CLAIMANT_NUM           --클레임수량
                   ,A.CLAIMANT_AMOUNT        --클레임금액
                   ,A.PART_PRICE             --부품단가
              FROM DMSDB.PT_0443T A    --과부족클레임품목정보
                     INNER JOIN DMSDB.PT_0442T B --과부족클레임
                       ON A.DLR_CD   = B.DLR_CD
                      AND A.CLAIM_NO = B.CLAIM_NO
             WHERE A.DLR_CD     = #{sDlrCd}
               AND A.CLAIM_NO   = #{sClaimNo}      --클레임번호
            ORDER BY    A.DLR_CD ASC
                       ,A.CLAIM_NO ASC
                       ,A.CLAIM_LINE ASC
    </select>

    <!-- 과부족클레임 Key 부품정보를 조회한다. -->
    <select id="selectOversAndShortsClaimInfcItemsByKey" parameterType="OversAndShortsClaimSearchVO" resultType="OversAndShortsClaimItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.selectOversAndShortsClaimInfcItemsByKey] */
            SELECT
                    A.DLR_CD                 --딜러코드
                   ,A.CLAIM_NO               --DMS클레임번호
                   ,A.CLAIM_LINE             --클레임라인번호
                   ,A.ORDER_NO               --오더번호
                   ,A.PART_NO                --부품번호
                   ,A.IS_PASS                --부품번호
                   ,A.NO_PASS_REASON         --부품번호
                   ,A.PART_PRICE              --부품번호
                   ,A.SITE_VERIFY_RESULT       --부품번호
                   ,A.SITE_HANDLE_VIEW         --부품번호
                   ,A.RESP_DETERMIN           --부품번호
                   ,A.HANDLE_MODE             --부품번호
                   ,A.CLAIMANT_AMOUNT         --부품번호
                   ,ROUND(nvl(A.CLAIMANT_AMOUNT,0)/100,2) AS CLAIMANT_AMOUNT
                   ,A.BMP_PAYMENT_AMOUNT       --부품번호
                   ,A.NO_REPARATION_REASON     --부품번호
                   ,A.IS_ACCOUNT_ARRIVED       --부품번호
                   ,A.FOLLOW_TRACK            --부품번호
              FROM DMSDB.PT_0443T A    --과부족클레임품목정보
                     INNER JOIN DMSDB.PT_0442T B --과부족클레임
                       ON A.DLR_CD   = B.DLR_CD
                      AND A.CLAIM_NO = B.CLAIM_NO
             WHERE A.DLR_CD        = #{sDlrCd}
               AND B.CLAIMANT_NO   = #{sClaimantNo}      --클레임번호
            ORDER BY    A.DLR_CD ASC
                       ,A.CLAIM_NO ASC
                       ,A.CLAIM_LINE ASC
    </select>

    <!-- 과부족클레임부품 정보 Count를 조회한다.(VALIDATION CHECK) -->
    <select id="checkOversAndShortsClaimItemByDocNo" parameterType="OversAndShortsClaimSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.checkOversAndShortsClaimItemByDocNo] */
        SELECT   COUNT(*)
          FROM DMSDB.PT_0443T A    --과부족클레임품목정보
                  INNER JOIN DMSDB.PT_0442T B --과부족클레임
                               ON A.DLR_CD   = B.DLR_CD
                              AND A.CLAIM_NO = B.CLAIM_NO
         WHERE A.DLR_CD = #{sDlrCd}
           <if test='sBoxingNo != null and sBoxingNo != ""'>
               AND B.BOXING_NO like '%'|| #{sBoxingNo} ||'%'
           </if>        --송장문서번호
           <if test='sOrderNo != null and sOrderNo != ""'>
               AND A.ORDER_NO like '%'|| #{sOrderNo} ||'%'
           </if>        --오더번호
           <if test='sPartNo != null and sPartNo != ""'>
               AND A.PART_NO like '%'|| #{sPartNo} ||'%'
           </if>        --부품번호
    </select>

    <!-- 과부족 클레임 정보 Max 라인번호를 조회한다. -->
    <select id="selectOversAndShortsClaimMaxLineNo" parameterType="OversAndShortsClaimVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.selectOversAndShortsClaimMaxLineNo] */
        SELECT NVL(max(A.CLAIM_LINE),0) + 1
          FROM DMSDB.PT_0443T A    --과부족클레임부품정보
         WHERE A.DLR_CD     = #{dlrCd}                 --딜러코드
           AND A.CLAIM_NO   = #{claimNo}
    </select>


    <!-- 클레임 정보를 확정한다. -->
    <update id="updateClaimCnfm" parameterType="InvcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.ClaimDAO.updateClaimCnfm] */
        UPDATE DMSDB.PT_0441T A    --클레임정보
          SET  A.CLAIM_STAT_CD    = #{claimStatCd}             --클레임상태코드
              ,A.CLAIM_TARG_CD    = #{claimTargCd}             --클레임대상코드
              ,A.DL_BP_CD         = #{dlBpCd}                  --배송거래처코드
              ,A.CLAIM_TP         = #{claimTp}                 --클레임유형
              ,A.PROC_TP          = #{procTp}                  --처리유형
              ,A.CLAIM_QTY        = #{claimQty}                --클레임수량
              ,A.PRC              = round(#{prc},2)            --단가
              ,A.AMT              = round(#{amt},2)            --금액
              ,A.REQ_CONT         = #{reqCont}                 --요청내용
              ,A.UPDT_USR_ID      = #{regUsrId}                --수정자ID
              ,A.UPDT_DT          = sysdate
         WHERE A.DLR_CD             = #{dlrCd}                  --딜러코드
           AND A.CLAIM_DOC_NO       = #{claimDocNo}             --클레임번호
           AND A.DEL_YN != 'Y'
    </update>
</mapper>