<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : InvcDAO_SqlMap.xml
    Description : 송장.
    author Ju Won Lee
    since 2016. 1. 29.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 01. 29.     Ju Won Lee     최초 생성
-->

<mapper namespace="chn.bhmc.dms.par.pcm.service.dao.InvcDAO">

    <!-- 송장 헤더 정보를 추가한다. -->
    <insert id="insertInvc" parameterType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.insertInvc] */
        INSERT INTO DMSDB.PT_0431T    --송장문서헤더정보
        (
          DLR_CD               --딜러코드
         ,INVC_DOC_NO          --송장문서번호
         ,INVC_TP              --송장유형
         ,INVC_DSTIN_CD        --송장구분코드
         ,INVC_STAT_CD         --송장상태코드
         ,INVC_DT              --송장일자
         ,ARRV_DT              --도착일자
         ,PLT_CD               --센터코드
         ,BP_CD                --거래처코드
         ,MOBIS_INVC_NO        --모비스송장번호
         ,CURR_CD              --통화
         ,INVC_TOT_AMT         --송장총금액
         ,VAT_CD               --부가세코드
         ,VAT_AMT              --부가세금액
         ,REMARK               --비고
         ,CANC_YN              --취소여부
         ,IF_YN                --인터페이스여부
         ,REG_USR_ID           --등록자ID
         ,REG_DT               --등록일자
         ,UPDT_USR_ID
         ,UPDT_DT
        )
        VALUES
        (
          #{dlrCd}               --딜러코드
         ,#{invcDocNo}           --송장문서번호
         ,#{invcTp}              --송장유형
         ,#{invcDstinCd}         --송장구분코드
         ,#{invcStatCd}          --송장상태코드
         ,#{invcDt}              --송장일자
         ,#{arrvDt}              --도착일자
         ,#{pltCd}               --센터코드
         ,#{bpCd}                --거래처코드
         ,#{mobisInvcNo}         --모비스송장번호
         ,'CNY'                  --통화
         ,round(#{invcTotAmt},2) --송장총금액
         ,#{vatCd}               --부가세코드
         ,round(#{vatAmt},2)     --부가세금액
         ,#{remark}              --비고
         ,#{cancYn}              --취소여부
         ,'N'                    --인터페이스여부
         ,#{regUsrId}            --등록자ID
         ,sysdate                --등록일자
         ,#{regUsrId}            --등록자ID
         ,sysdate                --등록일자
        )
    </insert>

    <!-- 송장 부품 정보를 추가한다. -->
    <insert id="insertInvcItem" parameterType="InvcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.insertInvcItem] */
        INSERT INTO DMSDB.PT_0432T    --송장문서품목정보
        (
          DLR_CD                       --딜러코드
         ,INVC_DOC_NO                  --송장문서번호
         ,INVC_DOC_LINE_NO             --송장문서라인번호
         ,MOBIS_INVC_NO                --모비스송장번호
         ,MOBIS_INVC_LINE_NO           --모비스송장라인번호
         ,PURC_ORD_NO                  --구매오더번호
         ,PURC_ORD_LINE_NO             --구매오더라인번호
         ,PURC_ORD_LINE_DETL_NO       --구매오더라인구분자
         ,ITEM_CD                      --품목코드
         ,INVC_QTY                     --송장수량
         ,INVC_UNIT_CD                 --송장단위코드
         ,INVC_PRC                     --송장단가
         ,TAX_DDCT_PRC                 --세금공제단가
         ,INVC_AMT                     --송장금액
         ,VAT_AMT                      --부가세금액
         ,INVC_TOT_AMT                 --송장총금액
         ,CLAIM_QTY                    --클레임 수량
         ,GR_STRGE_CD                  --입고창고
         ,GR_LOC_CD                    --입고위치
         ,GR_END_YN                    --입고여부
         ,DL_PDC_CD                    --배송PDC코드
         ,REQ_CONT                     --차이사유
         ,REG_USR_ID                   --등록자ID
         ,REG_DT                       --등록일자
         ,UPDT_USR_ID
         ,UPDT_DT
        )
        VALUES
        (
          #{dlrCd}                       --딜러코드
         ,#{invcDocNo}                   --송장문서번호
         ,#{invcDocLineNo}               --송장문서라인번호
         ,#{mobisInvcNo}                 --모비스송장번호
         ,#{mobisInvcLineNo}             --모비스송장라인번호
         ,#{purcOrdNo}                   --구매오더번호
         ,#{purcOrdLineNo}               --구매오더라인번호
         ,#{purcOrdLineDetlNo}           --구매오더라인구분자
         ,#{itemCd}                      --품목코드
         ,#{invcQty}                     --송장수량
         ,#{invcUnitCd}                  --송장단위코드
         ,round(#{invcPrc},2)            --송장단가
         ,round(#{taxDdctPrc},2)         --송장단가
         ,round(#{invcAmt},2)            --송장금액
         ,round(#{vatAmt},2)             --부가세금액
         ,round(#{invcTotAmt},2)         --송장총금액
         ,#{claimQty}                    --클레임 수량
         ,#{grStrgeCd}                   --입고창고
         ,#{grLocCd}                     --입고Location
         ,'N'                            --입고완료여부
         ,#{dlPdcCd}                     --배송PDC코드
         ,#{reqCont}                     --차이사유
         ,#{regUsrId}                    --등록자ID
         ,sysdate                        --등록일자
         ,#{regUsrId}                    --등록자ID
         ,sysdate                        --등록일자
        )
    </insert>

    <!-- 송장 정보 목록을 조회한다. -->
    <select id="selectInvcsByCondition" parameterType="InvcSearchVO" resultType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectInvcsByCondition] */
        SELECT A.*
          FROM
            (
            SELECT   ROWNUM AS RNUM
                   , T1.*
              FROM (
                SELECT
                        A.DLR_CD               --딜러코드
                       ,A.INVC_DOC_NO          --송장문서번호
                       ,A.INVC_TP              --송장유형
                       ,A.INVC_DSTIN_CD        --송장구분코드
                       ,A.INVC_STAT_CD         --송장상태코드
                       ,A.INVC_DT              --송장일자
                       ,A.ARRV_DT              --도착일자
                       ,TO_CHAR(A.ARRV_DT, 'YYYYMMDD')  AS ARRV_DT_CHAR              --등록일자
                       ,TO_CHAR(A.ARRV_DT, 'HH24MISS')  AS ARRV_TM_CHAR              --등록일자
                       ,A.CONFIRM_DT           --확정일자
                       ,A.PLT_CD               --센터코드
                       ,D.PLT_NM               --센터명
                       ,A.BP_CD                --거래처코드
                       ,C.BP_NM                --거래처명
                       ,A.MOBIS_INVC_NO        --모비스송장번호
                       ,A.CURR_CD              --통화코드
                       ,E.INVC_TOT_AMT AS PURC_INC_TAX_AMT         --송장총금액
                       ,E.INVC_TOT_AMT         --송장총금액
                       ,A.VAT_CD               --부가세코드
                       ,A.VAT_AMT              --부가세금액
                       ,A.REMARK               --비고
                       ,A.CANC_YN              --취소여부
                       ,A.REG_USR_ID           --등록자ID
                       ,A.REG_DT               --등록일자
                       ,TO_CHAR(A.REG_DT, 'YYYYMMDD')  AS REG_DT_CHAR              --등록일자
                       ,A.UPDT_USR_ID          --수정자ID
                       ,A.UPDT_DT              --수정일자
                       ,A.IF_YN                --인터페이스여부
                       ,NVL(A.INVC_TOTAL_LINE, B.ITEM_CNT) AS INVC_TOTAL_LINE
                       ,NVL(A.INVC_SUM_QT, B.ITEM_QTY) AS INVC_SUM_QT
                       ,A.INVC_AMT_CUR
                       ,A.INVC_TSP_CODE
                       ,A.INVC_CSE_CNT
                       ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
                  FROM   DMSDB.PT_0431T A    --송장문서헤더정보
                            INNER JOIN (
                                    SELECT   A.DLR_CD
                                            ,A.INVC_DOC_NO
                                            ,COUNT(*) AS ITEM_CNT
                                            ,SUM(A.INVC_QTY) AS ITEM_QTY
                                            ,SUM(B.PURC_AMT + ROUND(B.PURC_AMT * FN_GET_VAT(TO_CHAR(NVL(A.INVC_GR_DT, A.REG_DT),'YYYYMMDD'),'ALL'),2) ) AS PURC_INC_TAX_AMT
                                            ,SUM(B.PURC_AMT) AS PURC_AMT
                                     FROM   DMSDB.PT_0432T A
                                              INNER JOIN DMSDB.PT_0422T B
                                                 ON A.DLR_CD           = B.DLR_CD
                                                AND A.PURC_ORD_NO      = B.PURC_ORD_NO
                                                AND A.PURC_ORD_LINE_NO = B.PURC_ORD_LINE_NO
                                                AND A.PURC_ORD_LINE_DETL_NO = B.PURC_ORD_LINE_DETL_NO
                                              INNER JOIN  DMSDB.PT_0201T C              --품목정보
                                                 ON A.DLR_CD  = C.DLR_CD
                                                AND A.ITEM_CD = C.ITEM_CD
                                    WHERE    (1 = 1)
                                    <if test='sItemCd != null and sItemCd != ""'>
                                        AND A.ITEM_CD = #{sItemCd}
                                    </if>        --부품번호
                                    <if test='sItemNm != null and sItemNm != ""'>
                                        AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                    </if>
                                    <if test='sItemDstinCd != null and sItemDstinCd != ""'>
                                        AND C.ITEM_DSTIN_CD = #{sItemDstinCd}
                                    </if>
                                 GROUP BY   A.DLR_CD
                                           ,A.INVC_DOC_NO
                                 ) B
                               ON A.DLR_CD       = B.DLR_CD
                              AND A.INVC_DOC_NO  = B.INVC_DOC_NO
                           INNER JOIN DMSDB.PT_0211T C
                              ON A.DLR_CD = C.DLR_CD
                             AND A.BP_CD  = C.BP_CD
                           INNER JOIN DMSDB.CM_0103T D
                              ON A.DLR_CD  = D.DLR_CD
                             AND A.PLT_CD  = D.PLT_CD
                           INNER JOIN (
                                    SELECT   A.DLR_CD
                                            ,A.INVC_DOC_NO
                                            ,SUM(A.INVC_TOT_AMT) AS INVC_TOT_AMT
                                     FROM   DMSDB.PT_0432T A
                                    WHERE   A.DLR_CD   = #{sDlrCd}
                                    <if test='sMobisInvcNo != null and sMobisInvcNo != ""'>
                                       AND A.MOBIS_INVC_NO LIKE '%'||#{sMobisInvcNo}||'%'
                                   </if>        --모비스송장번호
                                 GROUP BY   A.DLR_CD
                                           ,A.INVC_DOC_NO
                                 ) E
                               ON A.DLR_CD       = E.DLR_CD
                              AND A.INVC_DOC_NO  = E.INVC_DOC_NO
                           INNER JOIN (
                                SELECT INR_DLR_CD
                                       ,INR_INV_NO
                                       ,MAX(INR_TOT_LN) AS INR_TOT_LN
                                  FROM PT_0433I
                              GROUP BY INR_DLR_CD, INR_INV_NO
                                   ) F
                                   ON A.DLR_CD = F.INR_DLR_CD
                                  AND A.MOBIS_INVC_NO = F.INR_INV_NO
                 WHERE   A.DLR_CD        = #{sDlrCd}
                   <if test='sInvcTp != null and sInvcTp != ""'>
                       AND A.INVC_TP       = #{sInvcTp}
                   </if>        --송장유형
                   <if test='sInvcStatCd != null and sInvcStatCd != ""'>
                       AND A.INVC_STAT_CD  = #{sInvcStatCd}
                   </if>        --송장상태코드
                   <if test='sInvcDtFr != null'>
                        <choose>
                            <otherwise>
                                 AND A.INVC_DT <![CDATA[>=]]> #{sInvcDtFr}
                            </otherwise>
                        </choose>
                    </if>
                    <if test='sInvcDtTo != null'>
                        <choose>
                            <otherwise>
                                 AND A.INVC_DT <![CDATA[<]]> #{sInvcDtTo} + 1
                            </otherwise>
                        </choose>
                    </if>
                   <if test='sConfirmDtFr != null'>
                        <choose>
                            <otherwise>
                                 AND A.CONFIRM_DT <![CDATA[>=]]> #{sConfirmDtFr}
                            </otherwise>
                        </choose>
                    </if>
                    <if test='sConfirmDtTo != null'>
                        <choose>
                            <otherwise>
                                 AND A.CONFIRM_DT <![CDATA[<=]]> #{sConfirmDtTo} + 1
                            </otherwise>
                        </choose>
                    </if>
                   <if test='sBpCd != null and sBpCd != ""'>
                       AND A.BP_CD = #{sBpCd}
                   </if>        --거래처코드
                   <if test='sMobisInvcNo != null and sMobisInvcNo != ""'>
                       AND A.MOBIS_INVC_NO LIKE '%'||#{sMobisInvcNo}||'%'
                   </if>        --모비스송장번호
                   <if test='sRegDtFr != null'>
                        <choose>
                            <otherwise>
                                 AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                            </otherwise>
                        </choose>
                    </if>
                    <if test='sRegDtTo != null'>
                        <choose>
                            <otherwise>
                                 AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                            </otherwise>
                        </choose>
                    </if>
                    AND A.CANC_YN != 'Y'
                    AND (F.INR_TOT_LN IS NULL OR (B.ITEM_CNT <![CDATA[>=]]> F.INR_TOT_LN))
                 ORDER BY
                 <choose>
                     <when test='sort != null'>
                         <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                             <choose>
                                 <when test='item.field == "invcTp"'> A.INVC_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "invcStatCd"'> A.INVC_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "invcDt"'> A.INVC_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "arrvDt"'> A.ARRV_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "pltCd"'> A.PLT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "pltNm"'> D.PLT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "bpNm"'> C.BP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "mobisInvcNo"'> A.MOBIS_INVC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                 <when test='item.field == "invcTotAmt"'> A.INVC_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "vatCd"'> A.VAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "vatAmt"'> A.VAT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "remark"'> A.REMARK <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "regDt"'> A.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <otherwise>
                                   A.DLR_CD ASC
                                 ,A.INVC_DT DESC
                                 </otherwise>
                             </choose>
                         </foreach>
                     </when>
                     <otherwise>
                      A.DLR_CD ASC
                     ,A.INVC_DT DESC
                     </otherwise>
                 </choose>
                 ) T1
              ) A
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
            </where>
    </select>

    <!-- 송장 정보 카운트를 조회한다. -->
    <select id="selectInvcsByConditionCnt" parameterType="InvcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectInvcsByConditionCnt] */
        SELECT  COUNT(*)
          FROM  DMSDB.PT_0431T A    --송장문서헤더정보
                    INNER JOIN (
                            SELECT   A.DLR_CD
                                    ,A.INVC_DOC_NO
                                    ,COUNT(*) AS ITEM_CNT
                                    ,SUM(A.INVC_QTY) AS ITEM_QTY
                                    ,SUM(B.PURC_AMT + (B.PURC_AMT * FN_GET_VAT(TO_CHAR(NVL(A.INVC_GR_DT, A.REG_DT),'YYYYMMDD'),'ALL')) ) AS PURC_INC_TAX_AMT
                                    ,SUM(B.PURC_AMT) AS PURC_AMT
                             FROM   DMSDB.PT_0432T A
                                      INNER JOIN DMSDB.PT_0422T B
                                         ON A.DLR_CD           = B.DLR_CD
                                        AND A.PURC_ORD_NO      = B.PURC_ORD_NO
                                        AND A.PURC_ORD_LINE_NO = B.PURC_ORD_LINE_NO
                                        AND A.PURC_ORD_LINE_DETL_NO = B.PURC_ORD_LINE_DETL_NO
                                      INNER JOIN  DMSDB.PT_0201T C              --품목정보
                                         ON A.DLR_CD  = C.DLR_CD
                                        AND A.ITEM_CD = C.ITEM_CD
                            WHERE    (1 = 1)
                            <if test='sItemCd != null and sItemCd != ""'>
                                AND A.ITEM_CD = #{sItemCd}
                            </if>        --부품번호
                            <if test='sItemNm != null and sItemNm != ""'>
                                AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                            </if>
                            <if test='sItemDstinCd != null and sItemDstinCd != ""'>
                                AND C.ITEM_DSTIN_CD = #{sItemDstinCd}
                            </if>
                         GROUP BY   A.DLR_CD
                                   ,A.INVC_DOC_NO
                         ) B
                       ON A.DLR_CD       = B.DLR_CD
                      AND A.INVC_DOC_NO  = B.INVC_DOC_NO
                   INNER JOIN DMSDB.PT_0211T C
                      ON A.DLR_CD = C.DLR_CD
                     AND A.BP_CD  = C.BP_CD
                   INNER JOIN DMSDB.CM_0103T D
                      ON A.DLR_CD  = D.DLR_CD
                     AND A.PLT_CD  = D.PLT_CD
                   INNER JOIN (
                            SELECT   A.DLR_CD
                                    ,A.INVC_DOC_NO
                                    ,SUM(A.INVC_TOT_AMT) AS INVC_TOT_AMT
                             FROM   DMSDB.PT_0432T A
                            WHERE   A.DLR_CD   = #{sDlrCd}
                            <if test='sMobisInvcNo != null and sMobisInvcNo != ""'>
                               AND A.MOBIS_INVC_NO LIKE '%'||#{sMobisInvcNo}||'%'
                           </if>        --모비스송장번호
                         GROUP BY   A.DLR_CD
                                   ,A.INVC_DOC_NO
                         ) E
                       ON A.DLR_CD       = E.DLR_CD
                      AND A.INVC_DOC_NO  = E.INVC_DOC_NO
                   INNER JOIN (
                        SELECT INR_DLR_CD
                               ,INR_INV_NO
                               ,MAX(INR_TOT_LN) AS INR_TOT_LN
                          FROM PT_0433I
                      GROUP BY INR_DLR_CD, INR_INV_NO
                            ) F
                           ON A.DLR_CD = F.INR_DLR_CD
                          AND A.MOBIS_INVC_NO = F.INR_INV_NO
         WHERE   A.DLR_CD        = #{sDlrCd}
           <if test='sInvcTp != null and sInvcTp != ""'>
               AND A.INVC_TP       = #{sInvcTp}
           </if>        --송장유형
           <if test='sInvcStatCd != null and sInvcStatCd != ""'>
               AND A.INVC_STAT_CD  = #{sInvcStatCd}
           </if>        --송장상태코드
           <if test='sInvcDtFr != null'>
                <choose>
                    <otherwise>
                         AND A.INVC_DT <![CDATA[>=]]> #{sInvcDtFr}
                    </otherwise>
                </choose>
            </if>
            <if test='sInvcDtTo != null'>
                <choose>
                    <otherwise>
                         AND A.INVC_DT <![CDATA[<]]> #{sInvcDtTo} + 1
                    </otherwise>
                </choose>
            </if>
           <if test='sConfirmDtFr != null'>
                <choose>
                    <otherwise>
                         AND A.CONFIRM_DT <![CDATA[>=]]> #{sConfirmDtFr}
                    </otherwise>
                </choose>
            </if>
            <if test='sConfirmDtTo != null'>
                <choose>
                    <otherwise>
                         AND A.CONFIRM_DT <![CDATA[<=]]> #{sConfirmDtTo} + 1
                    </otherwise>
                </choose>
            </if>
           <if test='sBpCd != null and sBpCd != ""'>
               AND A.BP_CD = #{sBpCd}
           </if>        --거래처코드
           <if test='sMobisInvcNo != null and sMobisInvcNo != ""'>
               AND A.MOBIS_INVC_NO LIKE '%'||#{sMobisInvcNo}||'%'
           </if>        --모비스송장번호
           <if test='sRegDtFr != null'>
                <choose>
                    <otherwise>
                         AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                    </otherwise>
                </choose>
            </if>
            <if test='sRegDtTo != null'>
                <choose>
                    <otherwise>
                         AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                    </otherwise>
                </choose>
            </if>
            AND A.CANC_YN != 'Y'
            AND (F.INR_TOT_LN IS NULL OR (B.ITEM_CNT <![CDATA[>=]]> F.INR_TOT_LN))
    </select>

    <!-- 입고 정보 목록을 조회한다. -->
    <select id="selectReceivesByCondition" parameterType="InvcSearchVO" resultType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceivesByCondition] */
        SELECT A.*
          FROM
            (
            SELECT   ROWNUM AS RNUM
                   , T1.*
              FROM (
                SELECT      A.DLR_CD               --딜러코드
                           ,A.INVC_DOC_NO          --송장문서번호
                           ,A.INVC_TP              --송장유형
                           ,A.INVC_DSTIN_CD        --송장구분코드
                           ,A.INVC_STAT_CD         --송장상태코드
                           ,A.INVC_DT              --송장일자
                           ,A.ARRV_DT              --도착일자
                           ,A.CONFIRM_DT           --확정일자
                           ,A.BP_CD                --거래처코드
                           ,A.BP_NM                --거래처명
                           ,A.BP_TP                --거래처명
                           ,A.MOBIS_INVC_NO        --모비스송장번호
                           ,A.CURR_CD              --통화코드
                           ,NVL(A.INVC_TOT_AMT, 0) AS INVC_TOT_AMT --송장총금액
                           ,A.VAT_CD               --부가세코드
                           ,A.REMARK               --비고
                           ,A.CANC_YN              --취소여부
                           ,A.REG_USR_ID           --등록자ID
                           ,NVL((SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID),' ') AS REG_USR_NM   --등록자명
                           ,A.REG_DT               --등록일자
                           ,A.UPDT_USR_ID          --수정자ID
                           ,A.UPDT_DT              --수정일자
                           ,A.INVC_GR_DT
                           ,NVL(A.ITEM_CNT, 0) AS ITEM_CNT
                           ,NVL(A.ITEM_QTY, 0) AS ITEM_QTY
                           ,A.INVC_AMT_CUR
                           ,NVL(A.GR_TOT_INC_TAX_AMT, 0) AS GR_TOT_INC_TAX_AMT
                           ,NVL(A.GR_TOT_AMT, 0) AS GR_TOT_AMT
                           ,NVL(A.VAT_AMT, 0) AS VAT_AMT
                           ,A.DC_RATE
                  FROM
                    (
                    SELECT
                            A.DLR_CD               --딜러코드
                           ,A.INVC_DOC_NO          --송장문서번호
                           ,A.INVC_TP              --송장유형
                           ,A.INVC_DSTIN_CD        --송장구분코드
                           ,A.INVC_STAT_CD         --송장상태코드
                           ,A.INVC_DT              --송장일자
                           ,A.ARRV_DT              --도착일자
                           ,A.CONFIRM_DT           --확정일자
                           ,A.BP_CD                --거래처코드
                           ,C.BP_NM                --거래처명
                           ,C.BP_TP                --거래처명
                           ,A.MOBIS_INVC_NO        --모비스송장번호
                           ,NVL(A.CURR_CD,'CNY') AS CURR_CD              --통화코드
                           ,A.INVC_TOT_AMT         --송장총금액
                           ,A.VAT_CD               --부가세코드
                           ,A.REMARK               --비고
                           ,A.CANC_YN              --취소여부
                           ,A.REG_USR_ID           --등록자ID
                           ,A.REG_DT               --등록일자
                           ,A.UPDT_USR_ID          --수정자ID
                           ,A.UPDT_DT              --수정일자
                           ,B.INVC_GR_DT
                           ,B.ITEM_CNT
                           ,B.ITEM_QTY
                           ,A.INVC_AMT_CUR
                           ,B.INVC_TOT_AMT AS GR_TOT_INC_TAX_AMT --수량*단가로 계산된 금액이 아닌 AMOS에서 계산되서 내려온 금액을 기준으로함
                           --,B.GR_TOT_AMT
                           --,(B.GR_TOT_INC_TAX_AMT - B.GR_TOT_AMT) AS VAT_AMT
                           ,B.INVC_AMT AS GR_TOT_AMT --계산된 금액이 아닌 AMOS에서 계산되서 내려온 세전가격을 기준으로함
                           ,B.VAT_AMT --계산된 금액이 아닌 AMOS에서 계산되서 내려온 부가세를 기준으로함
                           ,FN_GET_VAT(TO_CHAR(NVL(A.CONFIRM_DT, A.INVC_DT),'YYYYMMDD'),'ALL') AS DC_RATE
                      FROM   DMSDB.PT_0431T A    --송장문서헤더정보
                                INNER JOIN (
                                        SELECT   A.DLR_CD
                                                ,A.INVC_DOC_NO
                                                ,MAX(A.GR_DT) AS INVC_GR_DT
                                                ,COUNT(*) AS ITEM_CNT
                                                ,SUM(NVL(A.GR_QTY,0)) AS ITEM_QTY
                                                ,SUM(A.INVC_PRC * NVL(A.GR_QTY,0)) AS GR_TOT_INC_TAX_AMT
                                                ,SUM(A.TAX_DDCT_PRC * NVL(A.GR_QTY,0)) AS GR_TOT_AMT
                                                ,SUM(NVL(A.INVC_AMT,0)) AS INVC_AMT
                                                ,SUM(NVL(A.VAT_AMT,0)) AS VAT_AMT
                                                ,SUM(NVL(A.INVC_TOT_AMT,0)) AS INVC_TOT_AMT
                                         FROM   DMSDB.PT_0432T A
                                                  INNER JOIN  DMSDB.PT_0201T B              --품목정보
                                                     ON A.DLR_CD  = B.DLR_CD
                                                    AND A.ITEM_CD = B.ITEM_CD
                                        WHERE    A.DLR_CD = #{sDlrCd}
                                          AND    A.GR_END_YN = 'Y'
                                        <if test='sItemCd != null and sItemCd != ""'>
                                            AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                                        </if>        --부품번호
                                        <if test='sItemNm != null and sItemNm != ""'>
                                            AND B.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                        </if>
                                        <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                                            AND A.GR_STRGE_CD = #{sGrStrgeCd}
                                        </if> --입고창고코드
                                        <if test='sGrLocCd != null and sGrLocCd != ""'>
                                            AND A.GR_LOC_CD LIKE '%'|| #{sGrLocCd} ||'%'
                                        </if>  --입고로케이션
                                        <if test='sInvcGrDtFr != null'>
                                            <choose>
                                                <otherwise>
                                                    AND A.GR_DT <![CDATA[>=]]> #{sInvcGrDtFr}
                                                </otherwise>
                                            </choose>
                                        </if>
                                        <if test='sInvcGrDtTo != null'>
                                            <choose>
                                                <otherwise>
                                                    AND A.GR_DT <![CDATA[<=]]> #{sInvcGrDtTo} + 1
                                                </otherwise>
                                            </choose>
                                        </if> --송장입고일자
                                     GROUP BY   A.DLR_CD
                                               ,A.INVC_DOC_NO
                                     ) B
                                   ON A.DLR_CD       = B.DLR_CD
                                  AND A.INVC_DOC_NO  = B.INVC_DOC_NO
                               INNER JOIN DMSDB.PT_0211T C
                                  ON A.DLR_CD = C.DLR_CD
                                 AND A.BP_CD  = C.BP_CD
                     WHERE   A.DLR_CD = #{sDlrCd}
                       --AND   A.INVC_STAT_CD in ('03','00')
                       --AND   A.INVC_STAT_CD in ('03')
                       <if test='sBpTp != null and sBpTp != ""'>
                           AND C.BP_TP = #{sBpTp}
                       </if>        --거래처유형
                       <if test='sInvcGrDtFr != null'>
                            <choose>
                                <otherwise>
                                    AND B.INVC_GR_DT <![CDATA[>=]]> #{sInvcGrDtFr}
                                </otherwise>
                            </choose>
                        </if>
                        <if test='sInvcGrDtTo != null'>
                            <choose>
                                <otherwise>
                                    AND B.INVC_GR_DT <![CDATA[<=]]> #{sInvcGrDtTo} + 1
                                </otherwise>
                            </choose>
                        </if> --송장입고일자
                     UNION ALL
                       SELECT   A.DLR_CD               --딜러코드
                               ,A.ETC_GR_DOC_NO AS GR_DOC_NO         --송장문서번호
                               ,'01'  AS INVC_TP                  --송장유형
                               ,NULL  AS INVC_DSTIN_CD                  --송장구분코드
                               ,DECODE(A.STAT_CD,'01','00','02','03','03','04','') AS STAT_CD            --송장상태코드
                               ,NULL  AS INVC_DT                 --송장일자
                               ,NULL  AS ARRV_DT                  --도착일자
                               ,NULL  AS CONFIRM_DT                 --확정일자
                               ,A.BP_CD                --거래처코드
                               ,C.BP_NM                --거래처명
                               ,C.BP_TP                --거래처명
                               ,NULL  AS MOBIS_INVC_NO                 --모비스송장번호
                               ,'CNY'  AS CURR_CD            --통화코드
                               ,0     AS INVC_TOT_AMT     --송장총금액
                               ,'02'  AS VAT_CD            --부가세코드
                               ,A.REMARK               --비고
                               ,'N'   AS CANC_YN            --취소여부
                               ,A.REG_USR_ID           --등록자ID
                               ,A.REG_DT               --등록일자
                               ,A.UPDT_USR_ID          --수정자ID
                               ,A.UPDT_DT              --수정일자
                               ,B.INVC_GR_DT
                               ,B.ITEM_CNT
                               ,B.ITEM_QTY
                               ,NULL AS INVC_AMT_CUR
                               ,B.GR_TOT_INC_TAX_AMT
                               ,B.GR_TOT_AMT
                               ,(B.GR_TOT_INC_TAX_AMT - B.GR_TOT_AMT) AS VAT_AMT
                               ,B.DC_RATE
                         FROM PT_0621T A
                                INNER JOIN (
                                        SELECT   A.DLR_CD
                                                ,A.ETC_GR_DOC_NO
                                                ,MAX(NVL(A.UPDT_DT,A.REG_DT)) AS INVC_GR_DT
                                                ,COUNT(*) AS ITEM_CNT
                                                ,SUM(CASE WHEN A.GR_STAT_CD = '03' THEN 0  ELSE NVL(A.QTY,0) END) AS ITEM_QTY
                                                ,SUM(CASE WHEN A.GR_STAT_CD = '03' THEN  NVL(A.AMT,0) - NVL(G.MOVING_AVG_AMT,0)    ELSE NVL(A.AMT,0) END) AS GR_TOT_INC_TAX_AMT
                                                ,SUM(CASE WHEN A.GR_STAT_CD = '03' THEN 0  ELSE NVL(A.TAX_DDCT_AMT,0) END) AS GR_TOT_AMT
                                                ,MAX(NVL(A.DC_RATE,0)) AS DC_RATE
                                         FROM   DMSDB.PT_0622T A
                                                  INNER JOIN  DMSDB.PT_0201T B              --품목정보
                                                     ON A.DLR_CD  = B.DLR_CD
                                                    AND A.ITEM_CD = B.ITEM_CD
                                                INNER JOIN PT_0312T G
                                                    ON A.DLR_CD = G.DLR_cD
                                                   AND A.ETC_GR_DOC_NO = G.REF_DOC_NO
                                                   AND A.ETC_gR_DOC_LINE_NO = G.REF_DOC_LINE_NO
                                       WHERE    A.DLR_CD = #{sDlrCd}
                                         AND    A.GR_STAT_CD in ('02','03')
                                         --AND    A.GR_STAT_CD in ('01','02')
                                        <if test='sItemCd != null and sItemCd != ""'>
                                            AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                                        </if>        --부품번호
                                        <if test='sItemNm != null and sItemNm != ""'>
                                            AND B.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                        </if>
                                        <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                                            AND A.STRGE_CD = #{sGrStrgeCd}
                                        </if> --입고창고코드
                                        <if test='sGrLocCd != null and sGrLocCd != ""'>
                                            AND A.LOC_CD LIKE '%'|| #{sGrLocCd} ||'%'
                                        </if>  --입고로케이션
                                        <if test='sInvcGrDtFr != null'>
                                            <choose>
                                                <otherwise>
                                                    AND NVL(A.UPDT_DT,A.REG_DT) <![CDATA[>=]]> #{sInvcGrDtFr}
                                                </otherwise>
                                            </choose>
                                        </if>
                                        <if test='sInvcGrDtTo != null'>
                                            <choose>
                                                <otherwise>
                                                    AND NVL(A.UPDT_DT,A.REG_DT) <![CDATA[<=]]> #{sInvcGrDtTo} + 1
                                                </otherwise>
                                            </choose>
                                        </if> --송장입고일자
                                     GROUP BY   A.DLR_CD
                                               ,A.ETC_GR_DOC_NO
                                     ) B
                                   ON A.DLR_CD         = B.DLR_CD
                                  AND A.ETC_GR_DOC_NO  = B.ETC_GR_DOC_NO
                                INNER JOIN DMSDB.PT_0211T C
                                   ON A.DLR_CD = C.DLR_CD
                                  AND A.BP_CD  = C.BP_CD
                        WHERE A.DLR_CD = #{sDlrCd}
                          AND A.MVT_TP IN ('01','02')
                          AND NVL(A.ETC_GR_DOC_TP,'PARTS') = 'PARTS'
                          <if test='sBpTp != null and sBpTp != ""'>
                              AND C.BP_TP = #{sBpTp}
                          </if>        --거래처유형
                      ) A
                      WHERE A.DLR_CD = #{sDlrCd}
                      <if test='sInvcDocNo != null and sInvcDocNo != ""'>
                          AND A.INVC_DOC_NO LIKE '%'|| #{sInvcDocNo} ||'%'
                      </if> --입고번호
                      <if test='sInvcTp != null and sInvcTp != ""'>
                          AND A.INVC_TP = #{sInvcTp}
                      </if>        --송장유형
                      <if test='sBpCd != null and sBpCd != ""'>
                          AND A.BP_CD = #{sBpCd}
                      </if><!--거래처코드  -->
                      <if test='sBpNm != null and sBpNm != ""'>
                          AND A.BP_NM LIKE '%'||#{sBpNm}||'%'
                      </if><!-- 거래처명 -->
                      <if test='sBpTp != null and sBpTp != ""'>
                          AND A.BP_TP = #{sBpTp}
                      </if>        --거래처유형
                      <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                          AND A.BP_CD IN
                           <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                              #{item}
                           </foreach>
                      </if>        --거래처코드
                 ORDER BY
                 <choose>
                     <when test='sort != null'>
                         <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                             <choose>
                                 <when test='item.field == "invcTp"'> A.INVC_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "invcStatCd"'> A.INVC_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "invcDt"'> A.INVC_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "arrvDt"'> A.ARRV_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "bpNm"'> A.BP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "mobisInvcNo"'> A.MOBIS_INVC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                 <when test='item.field == "invcTotAmt"'> A.INVC_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "vatCd"'> A.VAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "vatAmt"'> A.VAT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "remark"'> A.REMARK <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "regDt"'> A.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <otherwise>
                                  A.DLR_CD ASC
                                 ,A.INVC_GR_DT DESC
                                 ,A.INVC_DOC_NO DESC
                                 </otherwise>
                             </choose>
                         </foreach>
                     </when>
                     <otherwise>
                      A.DLR_CD ASC
                     ,A.INVC_GR_DT DESC
                     ,A.INVC_DOC_NO DESC
                     </otherwise>
                 </choose>
                 ) T1
              ) A
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
            </where>
    </select>

    <!-- 송장 정보 카운트를 조회한다. -->
    <select id="selectReceivesByConditionCnt" parameterType="InvcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceivesByConditionCnt] */
        SELECT count(*)
          FROM (
                SELECT      A.DLR_CD               --딜러코드
                           ,A.INVC_DOC_NO          --송장문서번호
                           ,A.INVC_TP              --송장유형
                           ,A.INVC_DSTIN_CD        --송장구분코드
                           ,A.INVC_STAT_CD         --송장상태코드
                           ,A.INVC_DT              --송장일자
                           ,A.ARRV_DT              --도착일자
                           ,A.CONFIRM_DT           --확정일자
                           ,A.BP_CD                --거래처코드
                           ,C.BP_NM                --거래처명
                           ,C.BP_TP                --거래처유형
                           ,A.MOBIS_INVC_NO        --모비스송장번호
                           ,A.CURR_CD              --통화코드
                           ,A.INVC_TOT_AMT         --송장총금액
                           ,A.VAT_CD               --부가세코드
                           ,A.REMARK               --비고
                           ,A.CANC_YN              --취소여부
                           ,A.REG_USR_ID           --등록자ID
                           ,A.REG_DT               --등록일자
                           ,A.UPDT_USR_ID          --수정자ID
                           ,A.UPDT_DT              --수정일자
                           ,B.INVC_GR_DT
                           ,B.ITEM_CNT
                           ,B.ITEM_QTY
                           ,A.INVC_AMT_CUR
                           ,B.GR_TOT_INC_TAX_AMT
                           ,B.GR_TOT_AMT
                           ,(B.GR_TOT_INC_TAX_AMT - B.GR_TOT_AMT) AS VAT_AMT
                           ,FN_GET_VAT(TO_CHAR(NVL(A.CONFIRM_DT, A.INVC_DT),'YYYYMMDD'),'ALL') AS DC_RATE
                  FROM   DMSDB.PT_0431T A    --송장문서헤더정보
                           INNER JOIN (
                                   SELECT A.DLR_CD
                                          ,A.INVC_DOC_NO
                                          ,MAX(A.GR_DT) AS INVC_GR_DT
                                          ,COUNT(*) AS ITEM_CNT
                                          ,SUM(A.GR_QTY) AS ITEM_QTY
                                          ,SUM(A.INVC_PRC * A.GR_QTY ) AS GR_TOT_INC_TAX_AMT
                                          ,SUM(A.TAX_DDCT_PRC * A.GR_QTY) AS GR_TOT_AMT
                                     FROM DMSDB.PT_0432T A
                               INNER JOIN DMSDB.PT_0201T B              --품목정보
                                       ON A.DLR_CD  = B.DLR_CD
                                      AND A.ITEM_CD = B.ITEM_CD
                                    WHERE    A.DLR_CD    = #{sDlrCd}
                                      AND    A.GR_END_YN = 'Y'
                                      <if test='sItemCd != null and sItemCd != ""'>
                                          AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                                      </if>        --부품번호
                                      <if test='sItemNm != null and sItemNm != ""'>
                                          AND B.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                      </if>
                                      <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                                          AND A.GR_STRGE_CD = #{sGrStrgeCd}
                                      </if> --입고창고코드
                                      <if test='sGrLocCd != null and sGrLocCd != ""'>
                                          AND A.GR_LOC_CD LIKE '%'|| #{sGrLocCd}||'%'
                                      </if>  --입고로케이션
                                      <if test='sInvcGrDtFr != null'>
                                            <choose>
                                                <otherwise>
                                                    AND A.GR_DT <![CDATA[>=]]> #{sInvcGrDtFr}
                                                </otherwise>
                                            </choose>
                                        </if>
                                        <if test='sInvcGrDtTo != null'>
                                            <choose>
                                                <otherwise>
                                                    AND A.GR_DT <![CDATA[<=]]> #{sInvcGrDtTo} + 1
                                                </otherwise>
                                            </choose>
                                        </if> --송장입고일자
                                 GROUP BY   A.DLR_CD
                                           ,A.INVC_DOC_NO
                                 ) B
                               ON A.DLR_CD       = B.DLR_CD
                              AND A.INVC_DOC_NO  = B.INVC_DOC_NO
                           INNER JOIN DMSDB.PT_0211T C
                                   ON A.DLR_CD = C.DLR_CD
                                  AND A.BP_CD  = C.BP_CD
                 WHERE   A.DLR_CD = #{sDlrCd}
                   --AND   A.INVC_STAT_CD in ('03', '00')
                   --AND   A.INVC_STAT_CD in ('03')
                   <if test='sBpTp != null and sBpTp != ""'>
                       AND C.BP_TP = #{sBpTp}
                   </if>        --거래처유형
                   <if test='sInvcGrDtFr != null'>
                        <choose>
                            <otherwise>
                                AND B.INVC_GR_DT <![CDATA[>=]]> #{sInvcGrDtFr}
                            </otherwise>
                        </choose>
                    </if>
                    <if test='sInvcGrDtTo != null'>
                        <choose>
                            <otherwise>
                                AND B.INVC_GR_DT <![CDATA[<=]]> #{sInvcGrDtTo} + 1
                            </otherwise>
                        </choose>
                    </if> --송장입고일자
                 UNION ALL
                  SELECT    A.DLR_CD               --딜러코드
                           ,A.ETC_GR_DOC_NO AS GR_DOC_NO         --송장문서번호
                           ,'01'  AS INVC_TP                  --송장유형
                           ,NULL  AS INVC_DSTIN_CD                  --송장구분코드
                           ,DECODE(A.STAT_CD,'01','00','02','03','03','04','') AS STAT_CD            --송장상태코드
                           ,NULL  AS INVC_DT                 --송장일자
                           ,NULL  AS ARRV_DT                  --도착일자
                           ,NULL  AS CONFIRM_DT                 --확정일자
                           ,A.BP_CD                --거래처코드
                           ,C.BP_NM                --거래처명
                           ,C.BP_TP                --거래처유형
                           ,NULL  AS MOBIS_INVC_NO                 --모비스송장번호
                           ,NULL  AS CURR_CD            --통화코드
                           ,0     AS INVC_TOT_AMT     --송장총금액
                           ,'02'  AS VAT_CD            --부가세코드
                           ,A.REMARK               --비고
                           ,'N'   AS CANC_YN            --취소여부
                           ,A.REG_USR_ID           --등록자ID
                           ,A.REG_DT               --등록일자
                           ,A.UPDT_USR_ID          --수정자ID
                           ,A.UPDT_DT              --수정일자
                           ,B.INVC_GR_DT
                           ,B.ITEM_CNT
                           ,B.ITEM_QTY
                           ,NULL AS INVC_AMT_CUR
                           ,B.GR_TOT_INC_TAX_AMT
                           ,B.GR_TOT_AMT
                           ,(B.GR_TOT_INC_TAX_AMT - B.GR_TOT_AMT) AS VAT_AMT
                           ,B.DC_RATE
                     FROM   PT_0621T A
                            INNER JOIN (
                                    SELECT   A.DLR_CD
                                            ,A.ETC_GR_DOC_NO
                                            ,MAX(NVL(A.UPDT_DT,A.REG_DT)) AS INVC_GR_DT
                                            ,COUNT(*) AS ITEM_CNT
                                            ,SUM(CASE WHEN A.GR_STAT_CD = '03' THEN 0  ELSE NVL(A.QTY,0) END) AS ITEM_QTY
                                            ,SUM(CASE WHEN A.GR_STAT_CD = '03' THEN  NVL(A.AMT,0) - NVL(G.MOVING_AVG_AMT,0)    ELSE NVL(A.AMT,0) END) AS GR_TOT_INC_TAX_AMT
                                            ,SUM(CASE WHEN A.GR_STAT_CD = '03' THEN 0  ELSE NVL(A.TAX_DDCT_AMT,0) END) AS GR_TOT_AMT
                                            ,MAX(NVL(A.DC_RATE,0)) AS DC_RATE
                                     FROM   DMSDB.PT_0622T A
                               INNER JOIN DMSDB.PT_0201T B              --품목정보
                                       ON A.DLR_CD  = B.DLR_CD
                                      AND A.ITEM_CD = B.ITEM_CD
                               INNER JOIN PT_0312T G
                                       ON A.DLR_CD = G.DLR_cD
                                      AND A.ETC_GR_DOC_NO = G.REF_DOC_NO
                                      AND A.ETC_gR_DOC_LINE_NO = G.REF_DOC_LINE_NO
                                    WHERE A.DLR_CD = #{sDlrCd}
                                      AND A.GR_STAT_CD in ('02','03')
                                     --AND    A.GR_STAT_CD in ('01','02')
                                     <if test='sItemCd != null and sItemCd != ""'>
                                         AND A.ITEM_CD LIKE '%'|| #{sItemCd}||'%'
                                     </if>        --부품번호
                                     <if test='sItemNm != null and sItemNm != ""'>
                                         AND B.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                     </if>
                                     <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                                         AND A.STRGE_CD = #{sGrStrgeCd}
                                     </if> --입고창고코드
                                     <if test='sGrLocCd != null and sGrLocCd != ""'>
                                         AND A.LOC_CD LIKE '%'|| #{sGrLocCd} ||'%'
                                     </if>  --입고로케이션
                                     <if test='sInvcGrDtFr != null'>
                                         <choose>
                                             <otherwise>
                                                  AND NVL(A.UPDT_DT,A.REG_DT) <![CDATA[>=]]> #{sInvcGrDtFr}
                                             </otherwise>
                                         </choose>
                                     </if>
                                     <if test='sInvcGrDtTo != null'>
                                         <choose>
                                             <otherwise>
                                                 AND NVL(A.UPDT_DT,A.REG_DT) <![CDATA[<=]]> #{sInvcGrDtTo} + 1
                                             </otherwise>
                                         </choose>
                                     </if> --송장입고일자
                                 GROUP BY   A.DLR_CD
                                           ,A.ETC_GR_DOC_NO
                                 ) B
                               ON A.DLR_CD         = B.DLR_CD
                              AND A.ETC_GR_DOC_NO  = B.ETC_GR_DOC_NO
                            INNER JOIN DMSDB.PT_0211T C
                                   ON A.DLR_CD = C.DLR_CD
                                  AND A.BP_CD  = C.BP_CD
                    WHERE A.DLR_CD = #{sDlrCd}
                      AND A.MVT_TP IN ('01','02')
                      AND NVL(A.ETC_GR_DOC_TP,'PARTS') = 'PARTS'
                      <if test='sBpTp != null and sBpTp != ""'>
                          AND C.BP_TP = #{sBpTp}
                      </if>        --거래처유형
             ) A
             WHERE  A.DLR_CD = #{sDlrCd}          --딜러코드
             <if test='sInvcDocNo != null and sInvcDocNo   != ""'>
                 AND A.INVC_DOC_NO LIKE '%'|| #{sInvcDocNo} ||'%'
             </if> --입고번호
             <if test='sInvcTp != null and sInvcTp != ""'>
                 AND A.INVC_TP = #{sInvcTp}
             </if>        --송장유형
             <if test='sBpCd != null and sBpCd != ""'>
                 AND A.BP_CD = #{sBpCd}
             </if><!-- 거래처코드 -->
             <if test='sBpNm != null and sBpNm != ""'>
                 AND A.BP_NM LIKE '%'||#{sBpNm}||'%'
             </if><!-- 거래처명 -->
             <if test='sBpTp != null and sBpTp != ""'>
                 AND A.BP_TP = #{sBpTp}
             </if>        --거래처유형
             <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                 AND A.BP_CD IN
                   <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                      #{item}
                   </foreach>
              </if>        --거래처코드
    </select>

    <!-- 입고 정보 목록을 조회한다. -->
    <select id="selectReceivesByConditionForPopup" parameterType="InvcSearchVO" resultType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceivesByConditionForPopup] */
        SELECT A.*
          FROM
            (
            SELECT   ROWNUM AS RNUM
                   , T1.*
              FROM (
                SELECT      A.DLR_CD               --딜러코드
                           ,A.INVC_DOC_NO          --송장문서번호
                           ,A.INVC_TP              --송장유형
                           ,A.INVC_DSTIN_CD        --송장구분코드
                           ,A.INVC_STAT_CD         --송장상태코드
                           ,A.INVC_DT              --송장일자
                           ,A.ARRV_DT              --도착일자
                           ,A.CONFIRM_DT           --확정일자
                           ,A.BP_CD                --거래처코드
                           ,A.BP_NM                --거래처명
                           ,A.BP_TP                --거래처명
                           ,A.MOBIS_INVC_NO        --모비스송장번호
                           ,A.CURR_CD              --통화코드
                           ,NVL(A.INVC_TOT_AMT, 0) AS INVC_TOT_AMT --송장총금액
                           ,A.VAT_CD               --부가세코드
                           ,A.REMARK               --비고
                           ,A.CANC_YN              --취소여부
                           ,A.REG_USR_ID           --등록자ID
                           ,NVL((SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID),' ') AS REG_USR_NM   --등록자명
                           ,A.REG_DT               --등록일자
                           ,A.UPDT_USR_ID          --수정자ID
                           ,A.UPDT_DT              --수정일자
                           ,A.INVC_GR_DT
                           ,NVL(A.ITEM_CNT, 0) AS ITEM_CNT
                           ,NVL(A.ITEM_QTY, 0) AS ITEM_QTY
                           ,A.INVC_AMT_CUR
                           ,NVL(A.GR_TOT_INC_TAX_AMT, 0) AS GR_TOT_INC_TAX_AMT
                           ,NVL(A.GR_TOT_AMT, 0) AS GR_TOT_AMT
                           ,NVL(A.VAT_AMT, 0) AS VAT_AMT
                           ,A.DC_RATE
                  FROM
                    (
                    SELECT
                            A.DLR_CD               --딜러코드
                           ,A.INVC_DOC_NO          --송장문서번호
                           ,A.INVC_TP              --송장유형
                           ,A.INVC_DSTIN_CD        --송장구분코드
                           ,A.INVC_STAT_CD         --송장상태코드
                           ,A.INVC_DT              --송장일자
                           ,A.ARRV_DT              --도착일자
                           ,A.CONFIRM_DT           --확정일자
                           ,A.BP_CD                --거래처코드
                           ,C.BP_NM                --거래처명
                           ,C.BP_TP                --거래처명
                           ,A.MOBIS_INVC_NO        --모비스송장번호
                           ,NVL(A.CURR_CD,'CNY') AS CURR_CD              --통화코드
                           ,A.INVC_TOT_AMT         --송장총금액
                           ,A.VAT_CD               --부가세코드
                           ,A.REMARK               --비고
                           ,A.CANC_YN              --취소여부
                           ,A.REG_USR_ID           --등록자ID
                           ,A.REG_DT               --등록일자
                           ,A.UPDT_USR_ID          --수정자ID
                           ,A.UPDT_DT              --수정일자
                           ,B.INVC_GR_DT
                           ,B.ITEM_CNT
                           ,B.ITEM_QTY
                           ,A.INVC_AMT_CUR
                           ,B.INVC_TOT_AMT AS GR_TOT_INC_TAX_AMT
                           ,B.INVC_TOT_AMT-B.VAT_AMT AS GR_TOT_AMT
                           ,(B.GR_TOT_INC_TAX_AMT - B.GR_TOT_AMT) AS VAT_AMT
                           ,FN_GET_VAT(TO_CHAR(NVL(A.CONFIRM_DT, A.INVC_DT),'YYYYMMDD'),'ALL') AS DC_RATE
                      FROM   DMSDB.PT_0431T A    --송장문서헤더정보
                                INNER JOIN (
                                        SELECT   A.DLR_CD
                                                ,A.INVC_DOC_NO
                                                ,MAX(A.INVC_GR_DT) AS INVC_GR_DT
                                                ,COUNT(*) AS ITEM_CNT
                                                ,SUM(A.GR_QTY) AS ITEM_QTY
                                                ,SUM(A.INVC_PRC * A.GR_QTY ) AS GR_TOT_INC_TAX_AMT
                                                ,SUM(A.TAX_DDCT_PRC * A.GR_QTY) AS GR_TOT_AMT
                                                ,SUM(A.VAT_AMT) AS VAT_AMT
                                                ,SUM(A.INVC_TOT_AMT) AS INVC_TOT_AMT
                                         FROM   DMSDB.PT_0432T A
                                                  INNER JOIN  DMSDB.PT_0201T B              --품목정보
                                                     ON A.DLR_CD  = B.DLR_CD
                                                    AND A.ITEM_CD = B.ITEM_CD
                                        WHERE    A.DLR_CD = #{sDlrCd}
                                          --AND    A.GR_END_YN = 'Y'
                                        <if test='sItemCd != null and sItemCd != ""'>
                                            AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                                        </if>        --부품번호
                                        <if test='sItemNm != null and sItemNm != ""'>
                                            AND B.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                        </if>
                                        <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                                            AND A.GR_STRGE_CD = #{sGrStrgeCd}
                                        </if> --입고창고코드
                                        <if test='sGrLocCd != null and sGrLocCd != ""'>
                                            AND A.GR_LOC_CD LIKE '%'|| #{sGrLocCd} ||'%'
                                        </if>  --입고로케이션
                                     GROUP BY   A.DLR_CD
                                               ,A.INVC_DOC_NO
                                     ) B
                                   ON A.DLR_CD       = B.DLR_CD
                                  AND A.INVC_DOC_NO  = B.INVC_DOC_NO
                               INNER JOIN DMSDB.PT_0211T C
                                  ON A.DLR_CD = C.DLR_CD
                                 AND A.BP_CD  = C.BP_CD
                     WHERE   A.DLR_CD = #{sDlrCd}
                       AND   A.INVC_STAT_CD in ('03','00')
                       <if test='sBpTp != null and sBpTp != ""'>
                           AND C.BP_TP = #{sBpTp}
                       </if>        --거래처유형
                       <if test='sInvcGrDtFr != null'>
                            <choose>
                                <otherwise>
                                    AND A.INVC_DT <![CDATA[>=]]> #{sInvcGrDtFr}
                                </otherwise>
                            </choose>
                        </if>
                        <if test='sInvcGrDtTo != null'>
                            <choose>
                                <otherwise>
                                    AND A.INVC_DT <![CDATA[<=]]> #{sInvcGrDtTo} + 1
                                </otherwise>
                            </choose>
                        </if> --송장입고일자
                     UNION ALL
                       SELECT   A.DLR_CD               --딜러코드
                               ,A.ETC_GR_DOC_NO AS GR_DOC_NO         --송장문서번호
                               ,'01'  AS INVC_TP                  --송장유형
                               ,NULL  AS INVC_DSTIN_CD                  --송장구분코드
                               ,DECODE(A.STAT_CD,'01','00','02','03','03','04','') AS STAT_CD            --송장상태코드
                               ,NULL  AS INVC_DT                 --송장일자
                               ,NULL  AS ARRV_DT                  --도착일자
                               ,NULL  AS CONFIRM_DT                 --확정일자
                               ,A.BP_CD                --거래처코드
                               ,C.BP_NM                --거래처명
                               ,C.BP_TP                --거래처명
                               ,NULL  AS MOBIS_INVC_NO                 --모비스송장번호
                               ,'CNY'  AS CURR_CD            --통화코드
                               ,0     AS INVC_TOT_AMT     --송장총금액
                               ,'02'  AS VAT_CD            --부가세코드
                               ,A.REMARK               --비고
                               ,'N'   AS CANC_YN            --취소여부
                               ,A.REG_USR_ID           --등록자ID
                               ,A.REG_DT               --등록일자
                               ,A.UPDT_USR_ID          --수정자ID
                               ,A.UPDT_DT              --수정일자
                               ,B.INVC_GR_DT
                               ,B.ITEM_CNT
                               ,B.ITEM_QTY
                               ,NULL AS INVC_AMT_CUR
                               ,B.GR_TOT_INC_TAX_AMT
                               ,B.GR_TOT_AMT
                               ,(B.GR_TOT_INC_TAX_AMT - B.GR_TOT_AMT) AS VAT_AMT
                               ,B.DC_RATE
                         FROM PT_0621T A
                                INNER JOIN (
                                        SELECT   A.DLR_CD
                                                ,A.ETC_GR_DOC_NO
                                                ,MAX(A.REG_DT) AS INVC_GR_DT
                                                ,COUNT(*) AS ITEM_CNT
                                                ,SUM(NVL(A.QTY,0)) AS ITEM_QTY
                                                ,SUM(NVL(A.AMT,0)) AS GR_TOT_INC_TAX_AMT
                                                ,SUM(NVL(A.TAX_DDCT_AMT,0)) AS GR_TOT_AMT
                                                ,MAX(NVL(A.DC_RATE,0)) AS DC_RATE
                                         FROM   DMSDB.PT_0622T A
                                                  INNER JOIN  DMSDB.PT_0201T B              --품목정보
                                                     ON A.DLR_CD  = B.DLR_CD
                                                    AND A.ITEM_CD = B.ITEM_CD
                                       WHERE    A.DLR_CD = #{sDlrCd}
                                         AND    A.GR_STAT_CD in ('01','02')
                                        <if test='sItemCd != null and sItemCd != ""'>
                                            AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                                        </if>        --부품번호
                                        <if test='sItemNm != null and sItemNm != ""'>
                                            AND B.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                        </if>
                                        <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                                            AND A.STRGE_CD = #{sGrStrgeCd}
                                        </if> --입고창고코드
                                        <if test='sGrLocCd != null and sGrLocCd != ""'>
                                            AND A.LOC_CD LIKE '%'|| #{sGrLocCd} ||'%'
                                        </if>  --입고로케이션
                                        <if test='sInvcGrDtFr != null'>
                                            <choose>
                                                <otherwise>
                                                    AND A.REG_DT <![CDATA[>=]]> #{sInvcGrDtFr}
                                                </otherwise>
                                            </choose>
                                        </if>
                                        <if test='sInvcGrDtTo != null'>
                                            <choose>
                                                <otherwise>
                                                    AND A.REG_DT <![CDATA[<=]]> #{sInvcGrDtTo} + 1
                                                </otherwise>
                                            </choose>
                                        </if> --송장입고일자
                                     GROUP BY   A.DLR_CD
                                               ,A.ETC_GR_DOC_NO
                                     ) B
                                   ON A.DLR_CD         = B.DLR_CD
                                  AND A.ETC_GR_DOC_NO  = B.ETC_GR_DOC_NO
                                INNER JOIN DMSDB.PT_0211T C
                                   ON A.DLR_CD = C.DLR_CD
                                  AND A.BP_CD  = C.BP_CD
                        WHERE A.DLR_CD = #{sDlrCd}
                          AND A.MVT_TP = '01'
                          AND NVL(A.ETC_GR_DOC_TP,'PARTS') = 'PARTS'
                          <if test='sBpTp != null and sBpTp != ""'>
                              AND C.BP_TP = #{sBpTp}
                          </if>        --거래처유형
                      ) A
                      WHERE A.DLR_CD = #{sDlrCd}
                      <if test='sInvcDocNo != null and sInvcDocNo != ""'>
                          AND A.INVC_DOC_NO LIKE '%'|| #{sInvcDocNo} ||'%'
                      </if> --입고번호
                      <if test='sInvcTp != null and sInvcTp != ""'>
                          AND A.INVC_TP = #{sInvcTp}
                      </if>        --송장유형
                      <if test='sBpCd != null and sBpCd != ""'>
                          AND A.BP_CD = #{sBpCd}
                      </if><!--거래처코드  -->
                      <if test='sBpNm != null and sBpNm != ""'>
                          AND A.BP_NM LIKE '%'||#{sBpNm}||'%'
                      </if><!-- 거래처명 -->
                      <if test='sBpTp != null and sBpTp != ""'>
                          AND A.BP_TP = #{sBpTp}
                      </if>        --거래처유형
                      <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                          AND A.BP_CD IN
                           <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                              #{item}
                           </foreach>
                      </if>        --거래처코드
                 ORDER BY
                 <choose>
                     <when test='sort != null'>
                         <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                             <choose>
                                 <when test='item.field == "invcTp"'> A.INVC_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "invcStatCd"'> A.INVC_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "invcDt"'> A.INVC_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "arrvDt"'> A.ARRV_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "bpNm"'> A.BP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "mobisInvcNo"'> A.MOBIS_INVC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                 <when test='item.field == "invcTotAmt"'> A.INVC_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "vatCd"'> A.VAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "vatAmt"'> A.VAT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "remark"'> A.REMARK <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "regDt"'> A.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <otherwise>
                                  A.DLR_CD ASC
                                 ,A.INVC_GR_DT DESC
                                 ,A.INVC_DOC_NO DESC
                                 </otherwise>
                             </choose>
                         </foreach>
                     </when>
                     <otherwise>
                      A.DLR_CD ASC
                     ,A.INVC_GR_DT DESC
                     ,A.INVC_DOC_NO DESC
                     </otherwise>
                 </choose>
                 ) T1
              ) A
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
            </where>
    </select>

    <!-- 송장 정보 카운트를 조회한다. -->
    <select id="selectReceivesByConditionForPopupCnt" parameterType="InvcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceivesByConditionForPopupCnt] */
        SELECT count(*)
          FROM (
                SELECT      A.DLR_CD               --딜러코드
                           ,A.INVC_DOC_NO          --송장문서번호
                           ,A.INVC_TP              --송장유형
                           ,A.INVC_DSTIN_CD        --송장구분코드
                           ,A.INVC_STAT_CD         --송장상태코드
                           ,A.INVC_DT              --송장일자
                           ,A.ARRV_DT              --도착일자
                           ,A.CONFIRM_DT           --확정일자
                           ,A.BP_CD                --거래처코드
                           ,C.BP_NM                --거래처명
                           ,C.BP_TP                --거래처유형
                           ,A.MOBIS_INVC_NO        --모비스송장번호
                           ,A.CURR_CD              --통화코드
                           ,A.INVC_TOT_AMT         --송장총금액
                           ,A.VAT_CD               --부가세코드
                           ,A.REMARK               --비고
                           ,A.CANC_YN              --취소여부
                           ,A.REG_USR_ID           --등록자ID
                           ,A.REG_DT               --등록일자
                           ,A.UPDT_USR_ID          --수정자ID
                           ,A.UPDT_DT              --수정일자
                           ,B.INVC_GR_DT
                           ,B.ITEM_CNT
                           ,B.ITEM_QTY
                           ,A.INVC_AMT_CUR
                           ,B.GR_TOT_INC_TAX_AMT
                           ,B.GR_TOT_AMT
                           ,(B.GR_TOT_INC_TAX_AMT - B.GR_TOT_AMT) AS VAT_AMT
                           ,FN_GET_VAT(TO_CHAR(NVL(A.CONFIRM_DT, A.INVC_DT),'YYYYMMDD'),'ALL') AS DC_RATE
                  FROM   DMSDB.PT_0431T A    --송장문서헤더정보
                           INNER JOIN (
                                    SELECT   A.DLR_CD
                                            ,A.INVC_DOC_NO
                                            ,MAX(A.INVC_GR_DT) AS INVC_GR_DT
                                            ,COUNT(*) AS ITEM_CNT
                                            ,SUM(A.GR_QTY) AS ITEM_QTY
                                            ,SUM(A.INVC_PRC * A.GR_QTY ) AS GR_TOT_INC_TAX_AMT
                                            ,SUM(A.TAX_DDCT_PRC * A.GR_QTY) AS GR_TOT_AMT
                                     FROM   DMSDB.PT_0432T A
                                              INNER JOIN  DMSDB.PT_0201T B              --품목정보
                                                 ON A.DLR_CD  = B.DLR_CD
                                                AND A.ITEM_CD = B.ITEM_CD
                                    WHERE    A.DLR_CD    = #{sDlrCd}
                                      --AND    A.GR_END_YN = 'Y'
                                      <if test='sItemCd != null and sItemCd != ""'>
                                          AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                                      </if>        --부품번호
                                      <if test='sItemNm != null and sItemNm != ""'>
                                          AND B.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                      </if>
                                      <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                                          AND A.GR_STRGE_CD = #{sGrStrgeCd}
                                      </if> --입고창고코드
                                      <if test='sGrLocCd != null and sGrLocCd != ""'>
                                          AND A.GR_LOC_CD LIKE '%'|| #{sGrLocCd}||'%'
                                      </if>  --입고로케이션
                                 GROUP BY   A.DLR_CD
                                           ,A.INVC_DOC_NO
                                 ) B
                               ON A.DLR_CD       = B.DLR_CD
                              AND A.INVC_DOC_NO  = B.INVC_DOC_NO
                           INNER JOIN DMSDB.PT_0211T C
                                   ON A.DLR_CD = C.DLR_CD
                                  AND A.BP_CD  = C.BP_CD
                 WHERE   A.DLR_CD = #{sDlrCd}
                   AND   A.INVC_STAT_CD in ('03', '00')
                   <if test='sBpTp != null and sBpTp != ""'>
                       AND C.BP_TP = #{sBpTp}
                   </if>        --거래처유형
                   <if test='sInvcGrDtFr != null'>
                        <choose>
                            <otherwise>
                                AND A.INVC_DT <![CDATA[>=]]> #{sInvcGrDtFr}
                            </otherwise>
                        </choose>
                    </if>
                    <if test='sInvcGrDtTo != null'>
                        <choose>
                            <otherwise>
                                AND A.INVC_DT <![CDATA[<=]]> #{sInvcGrDtTo} + 1
                            </otherwise>
                        </choose>
                    </if> --송장입고일자
                 UNION ALL
                  SELECT    A.DLR_CD               --딜러코드
                           ,A.ETC_GR_DOC_NO AS GR_DOC_NO         --송장문서번호
                           ,'01'  AS INVC_TP                  --송장유형
                           ,NULL  AS INVC_DSTIN_CD                  --송장구분코드
                           ,DECODE(A.STAT_CD,'01','00','02','03','03','04','') AS STAT_CD            --송장상태코드
                           ,NULL  AS INVC_DT                 --송장일자
                           ,NULL  AS ARRV_DT                  --도착일자
                           ,NULL  AS CONFIRM_DT                 --확정일자
                           ,A.BP_CD                --거래처코드
                           ,C.BP_NM                --거래처명
                           ,C.BP_TP                --거래처유형
                           ,NULL  AS MOBIS_INVC_NO                 --모비스송장번호
                           ,NULL  AS CURR_CD            --통화코드
                           ,0     AS INVC_TOT_AMT     --송장총금액
                           ,'02'  AS VAT_CD            --부가세코드
                           ,A.REMARK               --비고
                           ,'N'   AS CANC_YN            --취소여부
                           ,A.REG_USR_ID           --등록자ID
                           ,A.REG_DT               --등록일자
                           ,A.UPDT_USR_ID          --수정자ID
                           ,A.UPDT_DT              --수정일자
                           ,B.INVC_GR_DT
                           ,B.ITEM_CNT
                           ,B.ITEM_QTY
                           ,NULL AS INVC_AMT_CUR
                           ,B.GR_TOT_INC_TAX_AMT
                           ,B.GR_TOT_AMT
                           ,(B.GR_TOT_INC_TAX_AMT - B.GR_TOT_AMT) AS VAT_AMT
                           ,B.DC_RATE
                     FROM   PT_0621T A
                            INNER JOIN (
                                    SELECT   A.DLR_CD
                                            ,A.ETC_GR_DOC_NO
                                            ,MAX(A.REG_DT) AS INVC_GR_DT
                                            ,COUNT(*) AS ITEM_CNT
                                            ,SUM(NVL(A.QTY,0)) AS ITEM_QTY
                                            ,SUM(NVL(A.PRC,0) * NVL(A.QTY,0) ) AS GR_TOT_INC_TAX_AMT
                                            ,SUM(NVL(A.TAX_DDCT_PRC,0) * NVL(A.QTY,0)) AS GR_TOT_AMT
                                            ,MAX(NVL(A.DC_RATE,0)) AS DC_RATE
                                     FROM   DMSDB.PT_0622T A
                                              INNER JOIN  DMSDB.PT_0201T B              --품목정보
                                                 ON A.DLR_CD  = B.DLR_CD
                                                AND A.ITEM_CD = B.ITEM_CD
                                   WHERE    A.DLR_CD = #{sDlrCd}
                                     AND    A.GR_STAT_CD in ('01','02')
                                     <if test='sItemCd != null and sItemCd != ""'>
                                         AND A.ITEM_CD LIKE '%'|| #{sItemCd}||'%'
                                     </if>        --부품번호
                                     <if test='sItemNm != null and sItemNm != ""'>
                                         AND B.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                     </if>
                                     <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                                         AND A.STRGE_CD = #{sGrStrgeCd}
                                     </if> --입고창고코드
                                     <if test='sGrLocCd != null and sGrLocCd != ""'>
                                         AND A.LOC_CD LIKE '%'|| #{sGrLocCd} ||'%'
                                     </if>  --입고로케이션
                                     <if test='sInvcGrDtFr != null'>
                                         <choose>
                                             <otherwise>
                                                  AND A.REG_DT <![CDATA[>=]]> #{sInvcGrDtFr}
                                             </otherwise>
                                         </choose>
                                     </if>
                                     <if test='sInvcGrDtTo != null'>
                                         <choose>
                                             <otherwise>
                                                 AND A.REG_DT <![CDATA[<=]]> #{sInvcGrDtTo} + 1
                                             </otherwise>
                                         </choose>
                                     </if> --송장입고일자
                                 GROUP BY   A.DLR_CD
                                           ,A.ETC_GR_DOC_NO
                                 ) B
                               ON A.DLR_CD         = B.DLR_CD
                              AND A.ETC_GR_DOC_NO  = B.ETC_GR_DOC_NO
                            INNER JOIN DMSDB.PT_0211T C
                                   ON A.DLR_CD = C.DLR_CD
                                  AND A.BP_CD  = C.BP_CD
                    WHERE A.DLR_CD = #{sDlrCd}
                      AND A.MVT_TP = '01'
                      AND NVL(A.ETC_GR_DOC_TP,'PARTS') = 'PARTS'
                      <if test='sBpTp != null and sBpTp != ""'>
                          AND C.BP_TP = #{sBpTp}
                      </if>        --거래처유형
             ) A
             WHERE  A.DLR_CD = #{sDlrCd}          --딜러코드
             <if test='sInvcDocNo != null and sInvcDocNo   != ""'>
                 AND A.INVC_DOC_NO LIKE '%'|| #{sInvcDocNo} ||'%'
             </if> --입고번호
             <if test='sInvcTp != null and sInvcTp != ""'>
                 AND A.INVC_TP = #{sInvcTp}
             </if>        --송장유형
             <if test='sBpCd != null and sBpCd != ""'>
                 AND A.BP_CD = #{sBpCd}
             </if><!-- 거래처코드 -->
             <if test='sBpNm != null and sBpNm != ""'>
                 AND A.BP_NM LIKE '%'||#{sBpNm}||'%'
             </if><!-- 거래처명 -->
             <if test='sBpTp != null and sBpTp != ""'>
                 AND A.BP_TP = #{sBpTp}
             </if>        --거래처유형
             <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                 AND A.BP_CD IN
                   <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                      #{item}
                   </foreach>
              </if>        --거래처코드
    </select>

    <!-- 송장 정보를 조회한다. -->
    <select id="selectInvcByKey" parameterType="InvcVO" resultType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectInvcByKey] */
        SELECT  A.DLR_CD               --딜러코드
               ,A.INVC_DOC_NO          --송장문서번호
               ,A.INVC_TP              --송장유형
               ,A.INVC_DSTIN_CD        --송장구분코드
               ,A.INVC_STAT_CD         --송장상태코드
               ,A.INVC_DT              --송장일자
               ,A.ARRV_DT              --도착일자
               ,A.CONFIRM_DT           --확정일자
               ,A.PLT_CD               --센터코드
               ,A.BP_CD                --거래처코드
               ,A.MOBIS_INVC_NO        --모비스송장번호
               ,A.CURR_CD              --통화코드
               ,A.INVC_TOT_AMT         --송장총금액
               ,A.VAT_CD               --부가세코드
               ,A.VAT_AMT              --부가세금액
               ,A.REMARK               --비고
               ,A.CANC_YN              --취소여부
               ,A.REG_USR_ID           --등록자ID
               ,A.REG_DT               --등록일자
               ,A.UPDT_USR_ID          --수정자ID
               ,A.UPDT_DT              --수정일자
               ,A.IF_YN                --인터페이스여부
               ,A.INVC_TOT_AMT
               ,A.INVC_AMT_CUR
               ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
          FROM  DMSDB.PT_0431T A                        --송장헤더정보
         WHERE  A.DLR_CD            = #{dlrCd}          --딜러코드
           AND  A.MOBIS_INVC_NO     = #{mobisInvcNo}    --송장번호
    </select>

    <!-- 송장 정보를 조회한다.(딜러) -->
    <select id="selectDmsInvcByKey" parameterType="InvcVO" resultType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectDmsInvcByKey] */
        SELECT  A.DLR_CD               --딜러코드
               ,A.INVC_DOC_NO          --송장문서번호
               ,A.INVC_TP              --송장유형
               ,A.INVC_DSTIN_CD        --송장구분코드
               ,A.INVC_STAT_CD         --송장상태코드
               ,A.INVC_DT              --송장일자
               ,A.ARRV_DT              --도착일자
               ,A.CONFIRM_DT           --확정일자
               ,A.PLT_CD               --센터코드
               ,A.BP_CD                --거래처코드
               ,A.MOBIS_INVC_NO        --모비스송장번호
               ,A.CURR_CD              --통화코드
               ,A.INVC_TOT_AMT         --송장총금액
               ,A.VAT_CD               --부가세코드
               ,A.VAT_AMT              --부가세금액
               ,A.REMARK               --비고
               ,A.CANC_YN              --취소여부
               ,A.REG_USR_ID           --등록자ID
               ,A.REG_DT               --등록일자
               ,A.UPDT_USR_ID          --수정자ID
               ,A.UPDT_DT              --수정일자
               ,A.IF_YN                --인터페이스여부
               ,A.INVC_TOT_AMT
               ,A.INVC_AMT_CUR
               ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
          FROM  DMSDB.PT_0431T A                        --송장헤더정보
         WHERE  A.DLR_CD        = #{sDlrCd}          --딜러코드
           AND  A.INVC_DOC_NO   = #{sInvcDocNo}         --송장번호
    </select>

     <!-- 송장 부품 정보를 조회한다.(딜러용): 전체일괄등록용 -->
    <select id="selectInvcItemByKeyForRgstCnt" parameterType="InvcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectInvcItemByKeyForRgstCnt] */
        SELECT   COUNT(*) AS CNT
          FROM  DMSDB.PT_0431T A                  --송장헤더정보
                  INNER JOIN  DMSDB.PT_0432T B    --송장품목정보
                     ON A.DLR_CD      = B.DLR_CD
                    AND A.INVC_DOC_NO = B.INVC_DOC_NO
                  INNER JOIN  DMSDB.PT_0421T C    --구매정보
                     ON B.DLR_CD           = C.DLR_CD
                    AND B.PURC_ORD_NO      = C.PURC_ORD_NO
                  INNER JOIN  DMSDB.PT_0201T D    --품목정보
                     ON B.DLR_CD  = D.DLR_CD
                    AND B.ITEM_CD = D.ITEM_CD
                   LEFT OUTER JOIN DMSDB.PT_0211T E
                     ON C.DLR_CD = E.DLR_CD
                    AND C.BP_CD  = E.BP_CD
                   LEFT OUTER JOIN PT_0301T F
                     ON D.DLR_CD        = F.DLR_CD
                    AND D.ITEM_CD       = F.ITEM_CD
                    AND D.GR_STRGE_CD   = F.STRGE_CD
         WHERE  B.DLR_CD        = #{sDlrCd}        --딜러코드
           AND  B.INVC_DOC_NO   = #{sInvcDocNo}    --송장번호
           AND  A.INVC_STAT_CD  IN ('00','02')
           AND  NVL(B.GR_END_YN,'N') = 'N'
        ORDER BY  B.DLR_CD ASC
               ,B.INVC_DOC_NO ASC
               ,B.INVC_DOC_LINE_NO ASC
    </select>

     <!-- 송장 부품 정보를 조회한다.(딜러용): 전체일괄등록용 -->
    <select id="selectInvcItemByKeyForRgst" parameterType="InvcSearchVO" resultType="InvcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectInvcItemByKeyForRgst] */
        SELECT   B.DLR_CD                          --딜러코드
                ,B.INVC_DOC_NO                     --송장문서번호
                ,B.INVC_DOC_LINE_NO                --송장문서라인번호
                ,B.MOBIS_INVC_NO                   --모비스송장번호
                ,B.MOBIS_INVC_LINE_NO              --모비스송장라인번호
                ,B.PURC_ORD_NO                     --구매오더번호
                ,B.INVC_IF_ORD_NO                  --I/F 구매오더번호
                ,B.INVC_IF_ORD_LN                  --I/F 구매오더라인번호
                ,B.PURC_ORD_LINE_NO                --구매오더라인번호
                ,B.PURC_ORD_LINE_DETL_NO          --구매오더라인구분자
                ,B.ITEM_CD                         --품목코드
                ,D.ITEM_NM                         --품목명
                ,B.INVC_QTY                        --송장수량
                ,B.INVC_UNIT_CD                    --송장단위코드
                ,B.INVC_PRC                        --송장단가
                ,B.TAX_DDCT_PRC                    --세금공제단가
                ,B.INVC_AMT                        --송장금액
                ,B.VAT_AMT                         --부가세금액
                ,B.INVC_TOT_AMT                    --송장총금액
                ,to_date(to_char(C.PURC_REG_DT,'yyyymmdd'),'yyyymmdd') AS PURC_REG_DT
                ,C.PURC_ORD_TP
                ,C.BP_CD
                ,E.BP_NM
                ,NVL(B.CLAIM_QTY,0) AS CLAIM_QTY                       --클레임 수량
                ,NVL(B.COMPARE_QTY,0) AS COMPARE_QTY                 --차이 수량
                ,B.DEBIT_CREDIT_DSTIN_CD           --차변대변구분코드
                ,B.REF_INVC_DOC_NO                 --참조송장문서번호
                ,B.REF_INVC_DOC_LINE_NO            --참조송장문서라인번호
                ,B.DL_PDC_CD                       --배송PDC코드
                ,NVL(#{sGrStrgeCd},D.GR_STRGE_CD) AS GR_STRGE_CD  --입고창고코드
                ,B.GR_LOC_CD                       --입고위치코드
                ,B.INVC_GR_DT                      --송장입고일자
                ,B.REQ_CONT                        --차이사유
                ,NVL(F.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY           --가용재고
                ,NVL(F.BORROW_QTY,0) AS BORROW_QTY               --차입
                ,NVL(F.RENT_QTY,0) AS RENT_QTY                 --대여수량
                ,NVL(F.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY                 --예류수량
                ,NVL(F.AVLB_STOCK_QTY,0) + NVL(F.RESV_STOCK_QTY,0) - NVL(F.BORROW_QTY,0) + NVL(F.RENT_QTY,0) AS STOCK_QTY
          FROM  DMSDB.PT_0431T A                  --송장헤더정보
                  INNER JOIN  DMSDB.PT_0432T B    --송장품목정보
                     ON A.DLR_CD      = B.DLR_CD
                    AND A.INVC_DOC_NO = B.INVC_DOC_NO
                  INNER JOIN  DMSDB.PT_0421T C    --구매정보
                     ON B.DLR_CD           = C.DLR_CD
                    AND B.PURC_ORD_NO      = C.PURC_ORD_NO
                  INNER JOIN  DMSDB.PT_0201T D    --품목정보
                     ON B.DLR_CD  = D.DLR_CD
                    AND B.ITEM_CD = D.ITEM_CD
                   LEFT OUTER JOIN DMSDB.PT_0211T E
                     ON C.DLR_CD = E.DLR_CD
                    AND C.BP_CD  = E.BP_CD
                   LEFT OUTER JOIN PT_0301T F
                     ON D.DLR_CD        = F.DLR_CD
                    AND D.ITEM_CD       = F.ITEM_CD
                    AND D.GR_STRGE_CD   = F.STRGE_CD
         WHERE  B.DLR_CD        = #{sDlrCd}        --딜러코드
           AND  B.INVC_DOC_NO   = #{sInvcDocNo}    --송장번호
           AND  A.INVC_STAT_CD  IN ('00','02')
           AND  NVL(B.GR_END_YN,'N') = 'N'
        ORDER BY  B.DLR_CD ASC
               ,B.INVC_DOC_NO ASC
               ,B.INVC_DOC_LINE_NO ASC
    </select>

    <!-- 송장 부품 정보를 조회한다.(구매번호에 의한) -->
    <select id="selectInvcItemByPurcKey" parameterType="InvcSearchVO" resultType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectInvcItemByPurcKey] */
        SELECT
                    A.DLR_CD               --딜러코드
                   ,A.INVC_DOC_NO          --송장문서번호
                   ,A.MOBIS_INVC_NO        --모비스송장번호
                   ,A.INVC_TP              --송장유형
                   ,A.INVC_DSTIN_CD        --송장구분코드
                   ,A.INVC_STAT_CD         --송장상태코드
                   ,A.INVC_DT              --송장일자
                   ,A.ARRV_DT              --도착일자
                   ,B.TRSF_TP              --운송유형
                   ,TO_CHAR(A.ARRV_DT, 'YYYYMMDD')  AS ARRV_DT_CHAR              --등록일자
                   ,TO_CHAR(A.ARRV_DT, 'HH24MISS')  AS ARRV_TM_CHAR              --등록일자
                   ,A.CONFIRM_DT           --확정일자
                   ,A.PLT_CD               --센터코드
                   ,D.PLT_NM               --센터명
                   ,A.BP_CD                --거래처코드
                   ,C.BP_NM                --거래처명
                   ,A.CURR_CD              --통화코드
                   ,B.PURC_INC_TAX_AMT     --구매총금액
                   ,B.PURC_AMT             --구매총금액(세금제외)
                   ,A.INVC_TOT_AMT         --송장총금액
                   ,A.INVC_AMT_CUR           --송장총금액(부가세 제외)
                   ,A.INVC_AMT_CUR AS TRSF_AMT           --전송금액
                   ,0 AS INC_AMT           --보험비
                   ,A.VAT_CD               --부가세코드
                   ,A.VAT_AMT              --부가세금액
                   ,A.REMARK               --비고
                   ,A.CANC_YN              --취소여부
                   ,A.INVC_TSP_CODE        --물류회사
                   ,A.INVC_CSE_CNT         --out box count
                   ,A.REG_USR_ID           --등록자ID
                   ,A.REG_DT               --등록일자
                   ,TO_CHAR(A.REG_DT, 'YYYYMMDD')  AS REG_DT_CHAR              --등록일자
                   ,A.UPDT_USR_ID          --수정자ID
                   ,A.UPDT_DT              --수정일자
                   ,A.IF_YN                --인터페이스여부
                   ,NVL(A.INVC_TOTAL_LINE, B.ITEM_CNT) AS INVC_TOTAL_LINE
                   ,NVL(A.INVC_SUM_QT, B.ITEM_QTY) AS INVC_SUM_QT
                   ,A.INVC_AMT_CUR
                   ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
              FROM   DMSDB.PT_0431T A    --송장문서헤더정보
                        INNER JOIN (
                                SELECT   A.DLR_CD
                                        ,A.MOBIS_INVC_NO
                                        ,MAX(D.TRSF_TP) AS TRSF_TP
                                        ,COUNT(*) AS ITEM_CNT
                                        ,SUM(A.INVC_QTY) AS ITEM_QTY
                                        ,SUM(B.TAX_DDCT_AMT) AS PURC_INC_TAX_AMT
                                        ,SUM(B.PURC_AMT) AS PURC_AMT
                                 FROM   DMSDB.PT_0432T A
                                          INNER JOIN DMSDB.PT_0422T B
                                             ON A.DLR_CD           = B.DLR_CD
                                            AND A.PURC_ORD_NO      = B.PURC_ORD_NO
                                            AND A.PURC_ORD_LINE_NO = B.PURC_ORD_LINE_NO
                                            AND A.PURC_ORD_LINE_DETL_NO = B.PURC_ORD_LINE_DETL_NO
                                          INNER JOIN  DMSDB.PT_0201T C              --품목정보
                                             ON A.DLR_CD  = C.DLR_CD
                                            AND A.ITEM_CD = C.ITEM_CD
                                          INNER JOIN DMSDB.PT_0421T D
                                             ON A.DLR_CD      = D.DLR_CD
                                            AND A.PURC_ORD_NO = D.PURC_ORD_NO
                                WHERE   A.DLR_CD      = #{sDlrCd}        --딜러코드
                                  AND   A.PURC_ORD_NO = #{sPurcOrdNo}    --구매오더번호
                             GROUP BY   A.DLR_CD
                                       ,A.MOBIS_INVC_NO
                             ) B
                           ON A.DLR_CD         = B.DLR_CD
                          AND A.MOBIS_INVC_NO  = B.MOBIS_INVC_NO
                        INNER JOIN DMSDB.PT_0211T C
                           ON A.DLR_CD = C.DLR_CD
                          AND A.BP_CD  = C.BP_CD
                        INNER JOIN DMSDB.CM_0103T D
                           ON A.DLR_CD  = D.DLR_CD
                          AND A.PLT_CD  = D.PLT_CD
             WHERE   A.DLR_CD        = #{sDlrCd}        --딜러코드
          ORDER BY  A.DLR_CD ASC
                   ,A.INVC_DOC_NO ASC
    </select>

    <!-- 송장 부품 정보를 조회한다. -->
    <select id="selectInvcItemByKey" parameterType="InvcSearchVO" resultType="InvcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectInvcItemByKey] */
        SELECT   B.DLR_CD                          --딜러코드
                ,B.INVC_DOC_NO                     --송장문서번호
                ,B.INVC_DOC_LINE_NO                --송장문서라인번호
                ,B.MOBIS_INVC_NO                   --모비스송장번호
                ,B.MOBIS_INVC_LINE_NO              --모비스송장라인번호
                ,B.PURC_ORD_NO                     --구매오더번호
                ,B.INVC_IF_ORD_NO                  --I/F 구매오더번호
                ,B.INVC_IF_ORD_LN                  --I/F 구매오더라인번호
                ,B.PURC_ORD_LINE_NO                --구매오더라인번호
                ,B.PURC_ORD_LINE_DETL_NO          --구매오더라인구분자
                ,B.ITEM_CD                         --품목코드
                ,D.ITEM_NM                         --품목명
                ,B.INVC_QTY                        --송장수량
                ,B.INVC_UNIT_CD                    --송장단위코드
                ,B.INVC_PRC                        --송장단가
                ,B.TAX_DDCT_PRC                    --세금공제단가
                ,B.INVC_AMT                        --송장금액
                ,B.VAT_AMT                         --부가세금액
                ,B.INVC_TOT_AMT                    --송장총금액
                ,to_date(to_char(C.PURC_REG_DT,'yyyymmdd'),'yyyymmdd') AS PURC_REG_DT
                ,C.PURC_ORD_TP
                ,C.BP_CD
                ,E.BP_NM
                ,B.CLAIM_QTY                       --클레임 수량
                ,B.DEBIT_CREDIT_DSTIN_CD           --차변대변구분코드
                ,B.REF_INVC_DOC_NO                 --참조송장문서번호
                ,B.REF_INVC_DOC_LINE_NO            --참조송장문서라인번호
                ,B.DL_PDC_CD                       --배송PDC코드
                ,B.GR_STRGE_CD                     --입고창고코드
                ,B.GR_LOC_CD                       --입고위치코드
                ,B.INVC_GR_DT                      --송장입고일자
                ,B.REQ_CONT                        --차이사유
                ,NVL(F.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY           --가용재고
                ,NVL(F.BORROW_QTY,0) AS BORROW_QTY               --차입
                ,NVL(F.RENT_QTY,0) AS RENT_QTY                 --대여수량
                ,NVL(F.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY                 --예류수량
                ,NVL(F.AVLB_STOCK_QTY,0) + NVL(F.RESV_STOCK_QTY,0) - NVL(F.BORROW_QTY,0) + NVL(F.RENT_QTY,0) AS STOCK_QTY
          FROM  DMSDB.PT_0431T A                  --송장헤더정보
                  INNER JOIN  DMSDB.PT_0432T B    --송장품목정보
                     ON A.DLR_CD      = B.DLR_CD
                    AND A.INVC_DOC_NO = B.INVC_DOC_NO
                  INNER JOIN  DMSDB.PT_0421T C    --구매정보
                     ON B.DLR_CD           = C.DLR_CD
                    AND B.PURC_ORD_NO      = C.PURC_ORD_NO
                  INNER JOIN  DMSDB.PT_0201T D    --품목정보
                     ON B.DLR_CD  = D.DLR_CD
                    AND B.ITEM_CD = D.ITEM_CD
                   LEFT OUTER JOIN DMSDB.PT_0211T E
                     ON C.DLR_CD = E.DLR_CD
                    AND C.BP_CD  = E.BP_CD
                   LEFT OUTER JOIN PT_0301T F
                     ON D.DLR_CD        = F.DLR_CD
                    AND D.ITEM_CD       = F.ITEM_CD
                    AND D.GR_STRGE_CD   = F.STRGE_CD
         WHERE  B.DLR_CD        = #{sDlrCd}        --딜러코드
           AND  B.INVC_DOC_NO   = #{sInvcDocNo}    --송장번호
        ORDER BY  B.DLR_CD ASC
               ,B.INVC_DOC_NO ASC
               ,B.INVC_DOC_LINE_NO ASC
    </select>

    <!-- 송장 정보를 확정처리한다. -->
    <update id="updateInvcCnfm" parameterType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.updateInvcCnfm] */
        UPDATE DMSDB.PT_0431T    --송장헤더정보
          SET
               INVC_STAT_CD     = '02'                      --송장상태
              ,CONFIRM_DT       = sysdate
              ,UPDT_USR_ID      = #{regUsrId}               --수정자ID
              ,UPDT_DT          = sysdate
         WHERE DLR_CD           = #{dlrCd}                  --딜러코드
           AND INVC_DOC_NO      = #{invcDocNo}              --송장번호
           AND INVC_STAT_CD     = '01'
    </update>

    <!-- 송장확정정보를 취소처리한다. -->
    <update id="cancelInvcCnfm" parameterType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.cancelInvcCnfm] */
        UPDATE DMSDB.PT_0431T    --송장헤더정보
          SET
               INVC_STAT_CD     = '01'                      --송장상태
              ,CONFIRM_DT       = null
              ,UPDT_USR_ID      = #{regUsrId}               --수정자ID
              ,UPDT_DT          = sysdate
         WHERE DLR_CD           = #{dlrCd}                  --딜러코드
           AND INVC_DOC_NO      = #{invcDocNo}              --송장번호
           AND INVC_STAT_CD     = '02'
    </update>

    <!-- 송장정보를 입고확정처리한다. -->
    <update id="updateReceiveCnfm" parameterType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.updateReceiveCnfm] */
        UPDATE DMSDB.PT_0431T    --송장헤더정보
          SET
               INVC_STAT_CD     = '03'                      --송장상태
              ,REMARK           = #{remark}                 --비고
              ,UPDT_USR_ID      = #{regUsrId}               --수정자ID
              ,UPDT_DT          = sysdate
         WHERE DLR_CD           = #{dlrCd}                  --딜러코드
           AND INVC_DOC_NO      = #{invcDocNo}              --송장번호
           AND INVC_STAT_CD     = '00'
    </update>

    <!-- 송장정보를 입고확정처리한다.(모바일용) -->
    <update id="updateReceiveCnfmForMobile" parameterType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.updateReceiveCnfmForMobile] */
        UPDATE DMSDB.PT_0431T    --송장헤더정보
          SET
               INVC_STAT_CD     = '03'                      --송장상태
              ,REMARK           = #{remark}                 --비고
              ,UPDT_USR_ID      = #{regUsrId}               --수정자ID
              ,UPDT_DT          = sysdate
         WHERE DLR_CD           = #{dlrCd}                  --딜러코드
           AND INVC_DOC_NO      = #{invcDocNo}              --송장번호
           AND INVC_STAT_CD     = '02'
    </update>

    <!-- 송장정보를 입고등록처리한다. -->
    <update id="updateReceiveRgst" parameterType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.updateReceiveRgst] */
        UPDATE DMSDB.PT_0431T    --송장헤더정보
          SET  ARRV_DT          = sysdate                   --도착일자
              ,INVC_STAT_CD     = '00'                      --송장상태
              ,REMARK           = #{remark}                 --비고
              ,UPDT_USR_ID      = #{regUsrId}               --수정자ID
              ,UPDT_DT          = sysdate
         WHERE DLR_CD           = #{dlrCd}                  --딜러코드
           AND INVC_DOC_NO      = #{invcDocNo}              --송장번호
           AND INVC_STAT_CD     = #{invcStatCd}
    </update>

    <!-- 송장 부품 정보를 삭제한다. -->
    <delete id="deleteInvcDocItem" parameterType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.deleteInvcDocItem] */
        DELETE FROM DMSDB.PT_0432T    --송장헤더정보
         WHERE DLR_CD           = #{dlrCd}                  --딜러코드
           AND INVC_DOC_NO      = #{invcDocNo}              --송장번호
    </delete>

    <!-- 송장 정보를 삭제한다. -->
    <delete id="deleteInvcDoc" parameterType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.deleteInvcDoc] */
        DELETE FROM DMSDB.PT_0431T    --송장헤더정보
         WHERE DLR_CD           = #{dlrCd}                  --딜러코드
           AND INVC_DOC_NO      = #{invcDocNo}              --송장번호
           AND IF_YN            = 'N'
    </delete>

    <!-- 입고확정 대상 송장정보를 조회한다.(모바일용) -->
    <select id="selectReceiveByMobile" parameterType="InvcSearchVO" resultType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceiveByMobile] */
        SELECT   A.DLR_CD                                   --딜러코드
                ,A.INVC_DT                                  --INVOICE일자
                ,A.CONFIRM_DT                               --확정일자
                ,A.BP_CD                                    --공급업체코드
                ,E.BP_NM                                    --공급업체명
                ,B.PURC_ORD_NO                              --구매오더번호
                ,A.INVC_DOC_NO                              --송장문서번호
                ,A.MOBIS_INVC_NO                            --모비스송장번호
          FROM  DMSDB.PT_0431T A                            --송장헤더정보
                 INNER JOIN (
                        SELECT   DLR_CD, INVC_DOC_NO,PURC_ORD_NO, COUNT(*) AS CNT
                          FROM   DMSDB.PT_0432T
                         WHERE   DLR_CD      = #{sDlrCd}
                           AND   GR_END_YN  != 'Y'
                         GROUP BY DLR_CD, INVC_DOC_NO, PURC_ORD_NO
                     ) B
                   ON A.DLR_CD       = B.DLR_CD
                  AND A.INVC_DOC_NO  = B.INVC_DOC_NO
                 INNER JOIN DMSDB.PT_0211T E
                   ON A.DLR_CD = E.DLR_CD
                  AND A.BP_CD  = E.BP_CD
         WHERE   A.DLR_CD            = #{sDlrCd}        --딜러코드
           --AND   A.INVC_STAT_CD      = '02'
           AND   A.INVC_STAT_CD      = '00'
           AND   A.BP_CD             = #{sBpCd}         --거래처코드
           AND   B.CNT  <![CDATA[>]]> 0
           <if test='sMobisInvcNo != null and sMobisInvcNo != ""'>
               AND A.MOBIS_INVC_NO = #{sMobisInvcNo}
           </if>        --모비스송장번호
           <if test='sInvcDt != null'>
                <choose>
                    <otherwise>
                         AND A.INVC_DT = #{sInvcDt}
                    </otherwise>
                </choose>
            </if>
         ORDER BY A.INVC_DT DESC
                 ,A.MOBIS_INVC_NO ASC
    </select>

    <!-- 입고확정 대상 송장정보 COUNT를 조회한다.(모바일용) -->
    <select id="selectReceiveByMobileCnt" parameterType="InvcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceiveByMobileCnt] */
        SELECT  COUNT(*)
          FROM  DMSDB.PT_0431T A                            --송장헤더정보
                 INNER JOIN (
                        SELECT   DLR_CD, INVC_DOC_NO,PURC_ORD_NO, COUNT(*) AS CNT
                          FROM   DMSDB.PT_0432T
                         WHERE   DLR_CD      = #{sDlrCd}
                           AND   GR_END_YN  != 'Y'
                         GROUP BY DLR_CD, INVC_DOC_NO, PURC_ORD_NO
                     ) B
                   ON A.DLR_CD       = B.DLR_CD
                  AND A.INVC_DOC_NO  = B.INVC_DOC_NO
                 INNER JOIN DMSDB.PT_0211T E
                   ON A.DLR_CD = E.DLR_CD
                  AND A.BP_CD  = E.BP_CD
         WHERE   A.DLR_CD            = #{sDlrCd}        --딜러코드
           --AND   A.INVC_STAT_CD      = '02'
           AND   A.INVC_STAT_CD      = '00'
           AND   A.BP_CD             = #{sBpCd}         --거래처코드
           AND   B.CNT  <![CDATA[>]]> 0
           <if test='sMobisInvcNo != null and sMobisInvcNo != ""'>
               AND A.MOBIS_INVC_NO = #{sMobisInvcNo}
           </if>        --모비스송장번호
           <if test='sInvcDt != null'>
                <choose>
                    <otherwise>
                         AND A.INVC_DT = #{sInvcDt}
                    </otherwise>
                </choose>
            </if>
    </select>

    <!-- 입고확정 대상 정보를 조회한다. -->
    <select id="selectReceiveItemByCondition" parameterType="InvcSearchVO" resultType="InvcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceiveItemByCondition] */
        SELECT   B.DLR_CD                                   --딜러코드
                ,A.INVC_DT                                  --INVOICE일자
                ,D.PURC_ORD_TP                              --오더유형
                ,A.BP_CD                                    --공급업체코드
                ,E.BP_NM                                    --공급업체명
                ,B.PURC_ORD_LINE_DETL_NO                   --구매오더라인구분자
                ,B.INVC_DOC_NO                              --송장문서번호
                ,B.INVC_DOC_LINE_NO                         --송장문서라인번호
                ,B.MOBIS_INVC_NO                            --모비스송장번호
                ,B.MOBIS_INVC_LINE_NO                       --모비스송장라인번호
                ,A.INVC_TP                                  --송장유형
                ,A.INVC_STAT_CD
                ,B.ITEM_CD                                  --품목코드
                ,C.ITEM_NM                                  --품목명
                ,B.INVC_QTY AS INVC_TARGET_QTY                                --송장수량
                ,D.PURC_QTY
                ,B.INVC_QTY                  --입고수량
                ,B.INVC_QTY AS GR_QTY                    --입고수량
                ,0 AS COMPARE_QTY            --비교수량
                ,B.INVC_UNIT_CD                              --송장단위코드
                ,B.INVC_PRC                                 --송장단가
                ,B.TAX_DDCT_PRC                             --세금공제단가
                ,B.INVC_AMT                                 --송장금액(세금제외)
                ,B.INVC_TOT_AMT                             --송장금액
                ,(B.INVC_TOT_AMT - B.INVC_AMT) AS TAX_AMT                       --세액
                ,DECODE(B.INVC_PRC - NVL(B.TAX_DDCT_PRC, 0), 0, 0, FN_GET_VAT(TO_CHAR(NVL(A.CONFIRM_DT, A.INVC_DT),'YYYYMMDD'),'ALL')) AS DC_RATE
                ,NVL(NVL(D.GR_STRGE_CD ,C.GR_STRGE_CD), ' ') AS GR_STRGE_CD
                ,NVL(G.LOC_CD, ' ') AS GR_LOC_CD
                ,NVL(F.CLAIM_TARG_CD,' ') AS CLAIM_TARG_CD  --클레임대상코드
                ,NVL(F.DL_BP_CD,' ') AS DL_BP_CD            --배송거래처코드
                ,NVL(H.BP_NM,' ') AS DL_BP_NM
                ,NVL(F.CLAIM_TP,' ') AS CLAIM_TP            --클레임유형
                ,NVL(F.CLAIM_QTY, 0) AS CLAIM_QTY                               --클레임수량
                ,NVL(F.REQ_CONT, ' ') AS REQ_CONT                                  --요청내용
                ,NVL(B.DL_PDC_CD, ' ') AS DL_PDC_CD                                  --PDC창고
                ,A.ARRV_DT
                ,B.BOX_NO
                ,NVL(D.BMP_ORD_NO,B.INVC_IF_ORD_NO) AS  BMP_ORD_NO  --구매오더번호(BMP)
                ,NVL(D.BMP_ORD_LINE_NO,B.INVC_IF_ORD_LN) AS  BMP_ORD_LINE_NO           --구매오더라인번호(BMP)
                ,D.PURC_ORD_NO                --구매오더번호
                ,D.PURC_ORD_LINE_NO           --구매오더라인번호
                ,B.REQ_CONT           --차이사유
                ,D.PURC_REG_DT
                ,D.REG_USR_ID AS ORD_REG_USR_ID
                ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = D.REG_USR_ID) AS ORD_REG_USR_NM   --등록자명
                ,I.REG_USR_ID AS REQ_USR_ID
                ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = I.REG_USR_ID) AS REQ_USR_NM   --결품신청자명
          FROM  DMSDB.PT_0431T A                            --송장헤더정보
                  INNER JOIN  DMSDB.PT_0432T B              --송장품목정보
                     ON A.DLR_CD      = B.DLR_CD
                    AND A.INVC_DOC_NO = B.INVC_DOC_NO
                  INNER JOIN  DMSDB.PT_0201T C              --품목정보
                     ON B.DLR_CD  = C.DLR_CD
                    AND B.ITEM_CD = C.ITEM_CD
                  INNER JOIN (
                           SELECT   A.DLR_CD
                                   ,A.BMP_ORD_NO
                                   ,B.PURC_ORD_NO
                                   ,B.PURC_ORD_LINE_NO
                                   ,B.PURC_ORD_LINE_DETL_NO
                                   ,A.PURC_ORD_TP
                                   ,A.BP_CD
                                   ,B.GR_STRGE_CD
                                   ,A.PURC_REG_DT
                                   ,B.BMP_ORD_LINE_NO
                                   ,A.REG_USR_ID
                                   ,B.CONFIRM_QTY AS PURC_QTY
                                   ,B.PURC_REQ_NO
                                   ,B.PURC_REQ_LINE_NO
                             FROM   DMSDB.PT_0421T A
                                      INNER JOIN DMSDB.PT_0422T B
                                        ON A.DLR_CD      = B.DLR_CD
                                       AND A.PURC_ORD_NO = B.PURC_ORD_NO
                                       AND B.DEL_YN     != 'Y'
                                       AND B.PURC_PGSS_CD != 'X'
                      ) D
                    ON B.DLR_CD           = D.DLR_CD
                   AND B.PURC_ORD_NO      = D.PURC_ORD_NO
                   AND B.PURC_ORD_LINE_NO = D.PURC_ORD_LINE_NO
                   AND B.PURC_ORD_LINE_DETL_NO = D.PURC_ORD_LINE_DETL_NO
                 INNER JOIN DMSDB.PT_0211T E
                   ON A.DLR_CD = E.DLR_CD
                  AND A.BP_CD  = E.BP_CD
                 LEFT OUTER JOIN DMSDB.PT_0441T F
                   ON B.DLR_CD           = F.DLR_CD
                  AND B.INVC_DOC_NO      = F.INVC_DOC_NO
                  AND B.INVC_DOC_LINE_NO = F.INVC_DOC_LINE_NO
                 LEFT OUTER JOIN PT_0224T G
                  ON C.DLR_CD      = G.DLR_CD
                 AND C.GR_STRGE_CD = G.STRGE_CD
                 AND C.ITEM_CD     = G.ITEM_CD
                 AND G.LOC_CD != ''
                 LEFT OUTER JOIN DMSDB.PT_0211T H
                   ON F.DLR_CD    = H.DLR_CD
                  AND F.DL_BP_CD  = H.BP_CD
                  AND H.BP_TP     = '04'
                 LEFT OUTER JOIN DMSDB.PT_0411T I
                   ON I.DLR_CD = D.DLR_CD
                  AND I.PURC_REQ_NO = D.PURC_REQ_NO
                  --AND I.PURC_REQ_LINE_NO = D.PURC_REQ_LINE_NO
         WHERE   B.DLR_CD            = #{sDlrCd}        --딜러코드
           AND   A.INVC_STAT_CD      = '02'
           AND   A.BP_CD             = #{sBpCd}         --거래처코드
           AND   B.GR_END_YN        != 'Y'
           <if test='sPurcOrdNo != null and sPurcOrdNo != ""'>
               AND B.PURC_ORD_NO = #{sPurcOrdNo}
           </if>        --구매오더정보
           <if test='sMobisInvcNo != null and sMobisInvcNo != ""'>
               AND B.MOBIS_INVC_NO = #{sMobisInvcNo}
           </if>        --모비스송장번호
           <if test='sDlPdcCd != null and sDlPdcCd != ""'>
               AND B.DL_PDC_CD = #{sDlPdcCd}
           </if>        --배송PDC
           <if test='sInvcDtFr != null'>
                <choose>
                    <otherwise>
                         AND A.INVC_DT <![CDATA[>=]]> #{sInvcDtFr}
                    </otherwise>
                </choose>
            </if>
            <if test='sInvcDtTo != null'>
                <choose>
                    <otherwise>
                         AND A.INVC_DT <![CDATA[<=]]> #{sInvcDtTo} + 1
                    </otherwise>
                </choose>
            </if>
           <if test='sConfirmDtFr != null'>
                <choose>
                    <otherwise>
                         AND CONFIRM_DT <![CDATA[>=]]> #{sConfirmDtFr}
                    </otherwise>
                </choose>
            </if>
            <if test='sConfirmDtTo != null'>
                <choose>
                    <otherwise>
                         AND CONFIRM_DT <![CDATA[<=]]> #{sConfirmDtTo} + 1
                    </otherwise>
                </choose>
            </if>
            <if test='sItemCd != null and sItemCd != ""'>
                AND B.ITEM_CD    = #{sItemCd}
            </if>        --부품번호
            <if test='sItemNm != null and sItemNm != ""'>
                AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
            </if>
            <if test='sAbcInd != null and sAbcInd != ""'>
                AND C.ABC_IND = #{sAbcInd}
            </if>        --ABC CLASS
            <if test='sCarlineCd != null and sCarlineCd != ""'>
                AND C.CARLINE_CD = #{sCarlineCd}
            </if>        --차종
         ORDER BY
         <choose>
             <when test='sort != null'>
                 <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                     <choose>
                         <when test='item.field == "invcDt"'> A.INVC_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                         <when test='item.field == "purcOrdNo"'> B.PURC_ORD_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                         <when test='item.field == "purcOrdTp"'> D.PURC_ORD_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                         <when test='item.field == "mobisInvcNo"'> B.MOBIS_INVC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                         <when test='item.field == "itemCd"'> B.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                         <otherwise>
                              A.INVC_DT DESC
                             ,D.PURC_ORD_TP ASC
                             ,B.PURC_ORD_NO DESC
                             ,B.INVC_DOC_LINE_NO ASC
                         </otherwise>
                     </choose>
                 </foreach>
             </when>
             <otherwise>
                  A.INVC_DT DESC
                 ,D.PURC_ORD_TP ASC
                 ,B.PURC_ORD_NO DESC
                 ,B.INVC_DOC_LINE_NO ASC
             </otherwise>
         </choose>
    </select>

    <!-- 입고확정 대상 정보(부품별)를 조회한다. -->
    <select id="selectReceiveItemByInvcItemBarcode" parameterType="InvcSearchVO" resultType="InvcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceiveItemByInvcItemBarcode] */
        SELECT   B.DLR_CD                                   --딜러코드
                ,A.INVC_DT                                  --INVOICE일자
                ,D.PURC_ORD_TP                              --오더유형
                ,B.PURC_ORD_NO                              --구매오더번호
                ,B.PURC_ORD_LINE_NO                         --구매오더라인번호
                ,B.PURC_ORD_LINE_DETL_NO                   --구매오더라인구분자
                ,B.INVC_DOC_NO                              --송장문서번호
                ,B.INVC_DOC_LINE_NO                         --송장문서라인번호
                ,B.INVC_PRC                                 --송장단가
                ,B.TAX_DDCT_PRC                             --세금공제단가
                ,B.INVC_AMT                                 --송장금액
                ,B.INVC_TOT_AMT                             --송장(세금미포함)금액
                ,B.VAT_AMT AS TAX_AMT                       --세액
                ,A.BP_CD                                    --공급업체코드
                ,E.BP_NM                                    --공급업체명
                ,B.MOBIS_INVC_NO                            --모비스송장번호(화면 표시 Invoice번호)
                ,B.MOBIS_INVC_LINE_NO                       --모비스송장라인번호(화면 표시 InvoiceLine번호)
                ,B.ITEM_CD                                  --품목코드
                ,C.ITEM_NM                                  --품목명
                ,B.INVC_QTY AS INVC_TARGET_QTY                                --송장수량
                ,B.INVC_QTY                  --입고수량
                ,0 AS COMPARE_QTY            --차이수량
                ,B.INVC_UNIT_CD                             --송장단위코드
                ,NVL(NVL(D.GR_STRGE_CD ,C.GR_STRGE_CD), ' ') AS GR_STRGE_CD  --입고창고
                ,NVL(G.LOC_CD, ' ') AS GR_LOC_CD            --입고 Location
                ,NVL(F.CLAIM_TARG_CD,' ') AS CLAIM_TARG_CD  --클레임대상코드
                ,NVL(F.DL_BP_CD,' ') AS DL_BP_CD            --배송거래처코드
                ,NVL(H.BP_NM,' ') AS DL_BP_NM               --배송거래처명
                ,NVL(F.CLAIM_TP,' ') AS CLAIM_TP            --클레임유형(클레임 사유)
                ,NVL(F.CLAIM_QTY, 0) AS CLAIM_QTY           --클레임수량
                ,NVL(B.REQ_CONT, F.REQ_CONT) AS REQ_CONT           --요청내용(요청사항)
          FROM  DMSDB.PT_0431T A                            --송장헤더정보
                  INNER JOIN  DMSDB.PT_0432T B              --송장품목정보
                     ON A.DLR_CD      = B.DLR_CD
                    AND A.INVC_DOC_NO = B.INVC_DOC_NO
                  INNER JOIN  DMSDB.PT_0201T C              --품목정보
                     ON B.DLR_CD  = C.DLR_CD
                    AND B.ITEM_CD = C.ITEM_CD
                  INNER JOIN (
                           SELECT   A.DLR_CD
                                   ,B.PURC_ORD_NO
                                   ,B.PURC_ORD_LINE_NO
                                   ,B.PURC_ORD_LINE_DETL_NO
                                   ,A.PURC_ORD_TP
                                   ,A.BP_CD
                                   ,B.GR_STRGE_CD
                             FROM   DMSDB.PT_0421T A
                                      INNER JOIN DMSDB.PT_0422T B
                                        ON A.DLR_CD      = B.DLR_CD
                                       AND A.PURC_ORD_NO = B.PURC_ORD_NO
                                       AND B.DEL_YN     != 'Y'
                      ) D
                    ON B.DLR_CD           = D.DLR_CD
                   AND B.PURC_ORD_NO      = D.PURC_ORD_NO
                   AND B.PURC_ORD_LINE_NO = D.PURC_ORD_LINE_NO
                   AND B.PURC_ORD_LINE_DETL_NO = D.PURC_ORD_LINE_DETL_NO
                 INNER JOIN DMSDB.PT_0211T E
                   ON A.DLR_CD = E.DLR_CD
                  AND A.BP_CD  = E.BP_CD
                 LEFT OUTER JOIN DMSDB.PT_0441T F
                   ON B.DLR_CD           = F.DLR_CD
                  AND B.INVC_DOC_NO      = F.INVC_DOC_NO
                  AND B.INVC_DOC_LINE_NO = F.INVC_DOC_LINE_NO
                 LEFT OUTER JOIN PT_0224T G
                  ON C.DLR_CD      = G.DLR_CD
                 AND C.GR_STRGE_CD = G.STRGE_CD
                 AND C.ITEM_CD     = G.ITEM_CD
                 AND G.LOC_CD != ''
                 LEFT OUTER JOIN DMSDB.PT_0211T H
                   ON F.DLR_CD    = H.DLR_CD
                  AND F.DL_BP_CD  = H.BP_CD
                  AND H.BP_TP     = '04'
         WHERE   B.DLR_CD            = #{sDlrCd}        --딜러코드
           AND   B.MOBIS_INVC_NO     = #{sMobisInvcNo}  --모비스송장번호
           AND   A.INVC_STAT_CD      = '02'
           AND   A.BP_CD             = #{sBpCd}         --거래처코드
           AND   B.GR_END_YN        != 'Y'
           AND   B.ITEM_CD           = #{sItemCd}       --부품번호
    </select>

    <!-- 입고확정 대상 정보 Count를 조회한다. -->
    <select id="selectReceiveItemByConditionCnt" parameterType="InvcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceiveItemByConditionCnt] */
        SELECT   COUNT(*)
          FROM  DMSDB.PT_0431T A                  --송장헤더정보
                  INNER JOIN  DMSDB.PT_0432T B    --송장품목정보
                     ON A.DLR_CD      = B.DLR_CD
                    AND A.INVC_DOC_NO = B.INVC_DOC_NO
                  INNER JOIN  DMSDB.PT_0201T C    --품목정보
                     ON B.DLR_CD  = C.DLR_CD
                    AND B.ITEM_CD = C.ITEM_CD
                  INNER JOIN (
                           SELECT   A.DLR_CD
                                   ,B.PURC_ORD_NO
                                   ,B.PURC_ORD_LINE_NO
                                   ,B.PURC_ORD_LINE_DETL_NO
                                   ,A.PURC_ORD_TP
                                   ,A.BP_CD
                             FROM   DMSDB.PT_0421T A
                                      INNER JOIN DMSDB.PT_0422T B
                                        ON A.DLR_CD      = B.DLR_CD
                                       AND A.PURC_ORD_NO = B.PURC_ORD_NO
                                       AND B.DEL_YN     != 'Y'
                                       AND B.PURC_PGSS_CD != 'X'
                      ) D
                    ON B.DLR_CD           = D.DLR_CD
                   AND B.PURC_ORD_NO      = D.PURC_ORD_NO
                   AND B.PURC_ORD_LINE_NO = D.PURC_ORD_LINE_NO
                   AND B.PURC_ORD_LINE_DETL_NO = D.PURC_ORD_LINE_DETL_NO
                 INNER JOIN DMSDB.PT_0211T E
                   ON A.DLR_CD = E.DLR_CD
                  AND A.BP_CD  = E.BP_CD
                 LEFT OUTER JOIN DMSDB.PT_0441T F
                   ON B.DLR_CD           = F.DLR_CD
                  AND B.INVC_DOC_NO      = F.INVC_DOC_NO
                  AND B.INVC_DOC_LINE_NO = F.INVC_DOC_LINE_NO
         WHERE   B.DLR_CD            = #{sDlrCd}        --딜러코드
           AND   A.INVC_STAT_CD      = '02'
           AND   A.BP_CD             = #{sBpCd}         --거래처코드
           AND   B.GR_END_YN        != 'Y'
           <if test='sPurcOrdNo != null and sPurcOrdNo != ""'>
               AND B.PURC_ORD_NO = #{sPurcOrdNo}
           </if>        --구매오더정보
           <if test='sMobisInvcNo != null and sMobisInvcNo != ""'>
               AND B.MOBIS_INVC_NO = #{sMobisInvcNo}
           </if>        --모비스송장번호
           <if test='sDlPdcCd != null and sDlPdcCd != ""'>
               AND B.DL_PDC_CD = #{sDlPdcCd}
           </if>        --배송PDC
           <if test='sInvcDtFr != null'>
                <choose>
                    <otherwise>
                         AND A.INVC_DT <![CDATA[>=]]> #{sInvcDtFr}
                    </otherwise>
                </choose>
            </if>
            <if test='sInvcDtTo != null'>
                <choose>
                    <otherwise>
                         AND A.INVC_DT <![CDATA[<=]]> #{sInvcDtTo} + 1
                    </otherwise>
                </choose>
            </if>
           <if test='sConfirmDtFr != null'>
                <choose>
                    <otherwise>
                         AND CONFIRM_DT <![CDATA[>=]]> #{sConfirmDtFr}
                    </otherwise>
                </choose>
            </if>
            <if test='sConfirmDtTo != null'>
                <choose>
                    <otherwise>
                         AND CONFIRM_DT <![CDATA[<=]]> #{sConfirmDtTo} + 1
                    </otherwise>
                </choose>
            </if>
            <if test='sItemCd != null and sItemCd != ""'>
                AND B.ITEM_CD    = #{sItemCd}
            </if>        --부품번호
            <if test='sItemNm != null and sItemNm != ""'>
                 AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
            </if>
            <if test='sAbcInd != null and sAbcInd != ""'>
                 AND C.ABC_IND = #{sAbcInd}
            </if>        --ABC CLASS
            <if test='sCarlineCd != null and sCarlineCd != ""'>
                 AND C.CARLINE_CD = #{sCarlineCd}
            </if>        --차종
    </select>

    <!-- 클레임등록 대상 정보를 조회한다. -->
    <select id="selectClaimItemByCondition" parameterType="InvcSearchVO" resultType="InvcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectClaimItemByCondition] */
        SELECT   B.DLR_CD                                   --딜러코드
                ,A.INVC_DT                                  --INVOICE일자
                ,A.BP_CD                                    --공급업체코드
                ,E.BP_NM                                    --공급업체명
                ,B.PURC_ORD_NO                              --구매오더번호
                ,B.PURC_ORD_LINE_NO                         --구매오더라인번호
                ,B.PURC_ORD_LINE_DETL_NO                   --구매오더라인구분자
                ,B.INVC_DOC_NO                              --송장문서번호
                ,B.INVC_DOC_LINE_NO                         --송장문서라인번호
                ,B.MOBIS_INVC_NO                            --모비스송장번호
                ,B.MOBIS_INVC_LINE_NO                       --모비스송장라인번호
                ,B.ITEM_CD                                  --품목코드
                ,C.ITEM_NM                                  --품목명
                ,B.INVC_QTY                                 --송장수량
                ,B.INVC_UNIT_CD                             --송장단위코드
                ,B.INVC_PRC                                 --송장단가
                ,B.INVC_AMT                                 --송장금액
                ,B.CLAIM_QTY AS PREV_CLAIM_QTY              --등록된 클레임 수량
                ,NVL(B.GR_STRGE_CD, ' ') AS GR_STRGE_CD
                ,NVL(H.STRGE_NM, ' ')    AS GR_STRGE_NM
                ,NVL(G.LOC_CD, ' ')   AS GR_LOC_CD
                ,NVL(G.LOC_NM, ' ')      AS GR_LOC_NM
                ,' ' AS CLAIM_TARG_CD       --클레임대상코드
                ,' ' AS DL_BP_CD            --배송거래처코드
                ,' ' AS DL_BP_NM
                ,' ' AS CLAIM_TP            --클레임유형
                ,0   AS CLAIM_QTY           --클레임수량
                ,B.REQ_CONT AS REQ_CONT            --요청내용
                ,' ' AS DOC_FILE_NO         --문서파일번호
          FROM  DMSDB.PT_0431T A                            --송장헤더정보
                  INNER JOIN  DMSDB.PT_0432T B              --송장품목정보
                     ON A.DLR_CD      = B.DLR_CD
                    AND A.INVC_DOC_NO = B.INVC_DOC_NO
                  INNER JOIN  DMSDB.PT_0201T C              --품목정보
                     ON B.DLR_CD  = C.DLR_CD
                    AND B.ITEM_CD = C.ITEM_CD
                  INNER JOIN (
                           SELECT   A.DLR_CD
                                   ,B.PURC_ORD_NO
                                   ,B.PURC_ORD_LINE_NO
                                   ,B.PURC_ORD_LINE_DETL_NO
                                   ,A.PURC_ORD_TP
                                   ,A.BP_CD
                                   ,B.GR_STRGE_CD
                             FROM   DMSDB.PT_0421T A
                                      INNER JOIN DMSDB.PT_0422T B
                                        ON A.DLR_CD      = B.DLR_CD
                                       AND A.PURC_ORD_NO = B.PURC_ORD_NO
                                       AND B.DEL_YN     != 'Y'
                      ) D
                    ON B.DLR_CD           = D.DLR_CD
                   AND B.PURC_ORD_NO      = D.PURC_ORD_NO
                   AND B.PURC_ORD_LINE_NO = D.PURC_ORD_LINE_NO
                   AND B.PURC_ORD_LINE_DETL_NO = D.PURC_ORD_LINE_DETL_NO
                 INNER JOIN DMSDB.PT_0211T E
                    ON A.DLR_CD = E.DLR_CD
                   AND A.BP_CD  = E.BP_CD
                 LEFT OUTER JOIN PT_0224T G
                    ON B.DLR_CD      = G.DLR_CD
                   AND B.GR_STRGE_CD = G.STRGE_CD
                   AND B.ITEM_CD     = G.ITEM_CD
                   AND G.LOC_CD != ''
                 INNER JOIN CM_0104T H
                    ON A.DLR_CD      = H.DLR_CD
                   AND A.PLT_CD      = H.PLT_CD
                   AND B.GR_STRGE_CD = H.STRGE_CD
         WHERE   B.DLR_CD         = #{sDlrCd}        --딜러코드
           AND   A.INVC_STAT_CD   in ('02' ,'03', '00')
           AND   A.BP_CD          = #{sBpCd}         --거래처코드
           AND   B.GR_END_YN      = 'Y'
           <if test='sPurcOrdNo != null and sPurcOrdNo != ""'>
               AND A.PURC_ORD_NO = #{sPurcOrdNo}
           </if>        --구매오더정보
           <if test='sMobisInvcNo != null and sMobisInvcNo != ""'>
               AND B.MOBIS_INVC_NO = #{sMobisInvcNo}
           </if>        --모비스송장번호
           <if test='sInvcGrDtFr != null'>
                <choose>
                    <otherwise>
                         AND B.INVC_GR_DT <![CDATA[>=]]> #{sInvcGrDtFr}
                    </otherwise>
                </choose>
            </if>
            <if test='sInvcGrDtTo != null'>
                <choose>
                    <otherwise>
                         AND B.INVC_GR_DT <![CDATA[<=]]> #{sInvcGrDtTo} + 1
                    </otherwise>
                </choose>
            </if>
            <if test='sItemCd != null and sItemCd != ""'>
                AND B.ITEM_CD    = #{sItemCd}
            </if>        --부품번호
            <if test='sItemNm != null and sItemNm != ""'>
                 AND C.ITEM_NM LIKE '%'|| #{sItemNm} || '%'
           </if>
           <if test='sAbcInd != null and sAbcInd != ""'>
               AND C.ABC_IND = #{sAbcInd}
           </if>        --ABC CLASS
           <if test='sCarlineCd != null and sCarlineCd != ""'>
               AND C.CARLINE_CD = #{sCarlineCd}
           </if>        --차종
         ORDER BY
         <choose>
             <when test='sort != null'>
                 <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                     <choose>
                         <when test='item.field == "invcDt"'> A.INVC_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                         <when test='item.field == "purcOrdNo"'> B.PURC_ORD_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                         <when test='item.field == "mobisInvcNo"'> B.MOBIS_INVC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                         <when test='item.field == "itemCd"'> B.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                         <otherwise>
                              A.INVC_DT DESC
                             ,B.PURC_ORD_NO DESC
                             ,B.INVC_DOC_LINE_NO ASC
                         </otherwise>
                     </choose>
                 </foreach>
             </when>
             <otherwise>
                  A.INVC_DT DESC
                 ,B.PURC_ORD_NO DESC
                 ,B.INVC_DOC_LINE_NO ASC
             </otherwise>
         </choose>
    </select>

    <!-- 클레임등록 대상 정보 Count를 조회한다. -->
    <select id="selectClaimItemByConditionCnt" parameterType="InvcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectClaimItemByConditionCnt] */
        SELECT   COUNT(*)
          FROM  DMSDB.PT_0431T A                            --송장헤더정보
                  INNER JOIN  DMSDB.PT_0432T B              --송장품목정보
                     ON A.DLR_CD      = B.DLR_CD
                    AND A.INVC_DOC_NO = B.INVC_DOC_NO
                  INNER JOIN  DMSDB.PT_0201T C              --품목정보
                     ON B.DLR_CD  = C.DLR_CD
                    AND B.ITEM_CD = C.ITEM_CD
                  INNER JOIN (
                           SELECT   A.DLR_CD
                                   ,B.PURC_ORD_NO
                                   ,B.PURC_ORD_LINE_NO
                                   ,B.PURC_ORD_LINE_DETL_NO
                                   ,A.PURC_ORD_TP
                                   ,A.BP_CD
                                   ,B.GR_STRGE_CD
                             FROM   DMSDB.PT_0421T A
                                      INNER JOIN DMSDB.PT_0422T B
                                        ON A.DLR_CD      = B.DLR_CD
                                       AND A.PURC_ORD_NO = B.PURC_ORD_NO
                                       AND B.DEL_YN     != 'Y'
                      ) D
                    ON B.DLR_CD           = D.DLR_CD
                   AND B.PURC_ORD_NO      = D.PURC_ORD_NO
                   AND B.PURC_ORD_LINE_NO = D.PURC_ORD_LINE_NO
                   AND B.PURC_ORD_LINE_DETL_NO = D.PURC_ORD_LINE_DETL_NO
                 INNER JOIN DMSDB.PT_0211T E
                   ON A.DLR_CD = E.DLR_CD
                  AND A.BP_CD  = E.BP_CD
                 LEFT OUTER JOIN PT_0224T G
                   ON B.DLR_CD      = G.DLR_CD
                  AND B.GR_STRGE_CD = G.STRGE_CD
                  AND B.ITEM_CD     = G.ITEM_CD
                  AND G.LOC_CD != ''
                INNER JOIN CM_0104T H
                   ON A.DLR_CD      = H.DLR_CD
                  AND A.PLT_CD      = H.PLT_CD
                  AND B.GR_STRGE_CD = H.STRGE_CD
         WHERE   B.DLR_CD            = #{sDlrCd}        --딜러코드
           AND   A.INVC_STAT_CD      in ('02' ,'03', '00')
           AND   A.BP_CD             = #{sBpCd}         --거래처코드
           AND   B.GR_END_YN         = 'Y'
           <if test='sPurcOrdNo != null and sPurcOrdNo != ""'>
               AND A.PURC_ORD_NO = #{sPurcOrdNo}
           </if>        --구매오더정보
           <if test='sMobisInvcNo != null and sMobisInvcNo != ""'>
               AND B.MOBIS_INVC_NO = #{sMobisInvcNo}
           </if>        --모비스송장번호
           <if test='sInvcGrDtFr != null'>
                <choose>
                    <otherwise>
                         AND B.INVC_GR_DT <![CDATA[>=]]> #{sInvcGrDtFr}
                    </otherwise>
                </choose>
            </if>
            <if test='sInvcGrDtTo != null'>
                <choose>
                    <otherwise>
                         AND B.INVC_GR_DT <![CDATA[<=]]> #{sInvcGrDtTo} + 1
                    </otherwise>
                </choose>
            </if>
            <if test='sItemCd != null and sItemCd != ""'>
                AND B.ITEM_CD = #{sItemCd}
            </if>        --부품번호
            <if test='sItemNm != null and sItemNm != ""'>
                 AND C.ITEM_NM LIKE '%'|| #{sItemNm} || '%'
           </if>
           <if test='sAbcInd != null and sAbcInd != ""'>
               AND C.ABC_IND          = #{sAbcInd}
           </if>        --ABC CLASS
           <if test='sCarlineCd != null and sCarlineCd != ""'>
               AND C.CARLINE_CD       = #{sCarlineCd}
           </if>        --차종
    </select>

    <!-- 부품별 입고 내역  정보를 조회한다. -->
    <select id="selectReceiveHistoryByItemCd" parameterType="InvcSearchVO" resultType="InvcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceiveHistoryByItemCd] */
        SELECT   B.DLR_CD                                   --딜러코드
                ,B.GR_DT AS INVC_GR_DT                      --입고일자
                ,A.BP_CD                                    --공급업체코드
                ,E.BP_NM                                    --공급업체명
                ,B.INVC_DOC_NO                              --송장문서번호
                ,B.INVC_DOC_LINE_NO                         --송장문서라인번호
                ,B.MOBIS_INVC_NO                            --모비스송장번호
                ,B.MOBIS_INVC_LINE_NO                       --모비스송장라인번호
                ,A.INVC_TP                                  --송장유형
                ,A.INVC_STAT_CD
                ,B.ITEM_CD                                  --품목코드
                ,C.ITEM_NM                                  --품목명
                ,D.PURC_QTY
                ,B.INVC_QTY                  --입고수량
                ,B.GR_QTY                    --입고수량
                ,0 AS COMPARE_QTY            --비교수량
                ,B.INVC_UNIT_CD                              --송장단위코드
                ,B.INVC_PRC                                 --송장단가
                ,B.TAX_DDCT_PRC                             --세금공제단가
                ,B.INVC_AMT                                 --송장금액(세금제외)
                ,B.INVC_TOT_AMT                             --송장금액
                ,(B.INVC_TOT_AMT - B.INVC_AMT) AS TAX_AMT                       --세액
                ,DECODE(B.INVC_PRC - NVL(B.TAX_DDCT_PRC, 0), 0, 0, FN_GET_VAT(TO_CHAR(NVL(A.CONFIRM_DT, A.INVC_DT),'YYYYMMDD'),'ALL')) AS DC_RATE
                ,NVL(NVL(D.GR_STRGE_CD ,C.GR_STRGE_CD), ' ') AS GR_STRGE_CD
                ,NVL(G.LOC_CD, ' ') AS GR_LOC_CD
                ,NVL(B.DL_PDC_CD, ' ') AS DL_PDC_CD                                  --PDC창고
                ,A.ARRV_DT
                ,B.BOX_NO
                ,NVL(D.BMP_ORD_NO,B.INVC_IF_ORD_NO) AS  BMP_ORD_NO  --구매오더번호(BMP)
                ,NVL(D.BMP_ORD_LINE_NO,B.INVC_IF_ORD_LN) AS  BMP_ORD_LINE_NO           --구매오더라인번호(BMP)
                ,D.PURC_ORD_NO                --구매오더번호
                ,D.PURC_ORD_LINE_NO           --구매오더라인번호
                ,D.PURC_REG_DT
                ,D.REG_USR_ID AS ORD_REG_USR_ID
                ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = D.REG_USR_ID) AS ORD_REG_USR_NM   --등록자명
                ,I.REG_USR_ID AS REQ_USR_ID
                ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = I.REG_USR_ID) AS REQ_USR_NM   --결품신청자명
          FROM  DMSDB.PT_0431T A                            --송장헤더정보
                  INNER JOIN  DMSDB.PT_0432T B              --송장품목정보
                     ON A.DLR_CD      = B.DLR_CD
                    AND A.INVC_DOC_NO = B.INVC_DOC_NO
                  INNER JOIN  DMSDB.PT_0201T C              --품목정보
                     ON B.DLR_CD  = C.DLR_CD
                    AND B.ITEM_CD = C.ITEM_CD
                  INNER JOIN (
                           SELECT   A.DLR_CD
                                   ,A.BMP_ORD_NO
                                   ,B.PURC_ORD_NO
                                   ,B.PURC_ORD_LINE_NO
                                   ,B.PURC_ORD_LINE_DETL_NO
                                   ,A.PURC_ORD_TP
                                   ,A.BP_CD
                                   ,B.GR_STRGE_CD
                                   ,A.PURC_REG_DT
                                   ,B.BMP_ORD_LINE_NO
                                   ,A.REG_USR_ID
                                   ,B.CONFIRM_QTY AS PURC_QTY
                                   ,B.PURC_REQ_NO
                                   ,B.PURC_REQ_LINE_NO
                             FROM   DMSDB.PT_0421T A
                                      INNER JOIN DMSDB.PT_0422T B
                                        ON A.DLR_CD      = B.DLR_CD
                                       AND A.PURC_ORD_NO = B.PURC_ORD_NO
                                       AND B.DEL_YN     != 'Y'
                      ) D
                    ON B.DLR_CD           = D.DLR_CD
                   AND B.PURC_ORD_NO      = D.PURC_ORD_NO
                   AND B.PURC_ORD_LINE_NO = D.PURC_ORD_LINE_NO
                   AND B.PURC_ORD_LINE_DETL_NO = D.PURC_ORD_LINE_DETL_NO
                 INNER JOIN DMSDB.PT_0211T E
                   ON A.DLR_CD = E.DLR_CD
                  AND A.BP_CD  = E.BP_CD
                 LEFT OUTER JOIN PT_0224T G
                  ON C.DLR_CD      = G.DLR_CD
                 AND C.GR_STRGE_CD = G.STRGE_CD
                 AND C.ITEM_CD     = G.ITEM_CD
                 AND G.LOC_CD != ''
                 LEFT OUTER JOIN DMSDB.PT_0411T I
                   ON I.DLR_CD = D.DLR_CD
                  AND I.PURC_REQ_NO = D.PURC_REQ_NO
                  --AND I.PURC_REQ_LINE_NO = D.PURC_REQ_LINE_NO
         WHERE   B.DLR_CD            = #{sDlrCd}        --딜러코드
           AND   B.ITEM_CD           = #{sItemCd}       --부품번호
           AND   A.INVC_STAT_CD      = '03'
           AND   B.GR_QTY            <![CDATA[>]]> 0
         ORDER BY
              B.GR_DT DESC
             ,D.PURC_ORD_TP ASC
             ,B.PURC_ORD_NO DESC
             ,B.INVC_DOC_LINE_NO ASC
    </select>

    <!-- 부품별 입고 내역   정보 Count를 조회한다. -->
    <select id="selectReceiveHistoryByItemCdCnt" parameterType="InvcSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceiveHistoryByItemCdCnt] */
        SELECT   COUNT(*)
          FROM  DMSDB.PT_0431T A                            --송장헤더정보
                  INNER JOIN  DMSDB.PT_0432T B              --송장품목정보
                     ON A.DLR_CD      = B.DLR_CD
                    AND A.INVC_DOC_NO = B.INVC_DOC_NO
                  INNER JOIN  DMSDB.PT_0201T C              --품목정보
                     ON B.DLR_CD  = C.DLR_CD
                    AND B.ITEM_CD = C.ITEM_CD
                  INNER JOIN (
                           SELECT   A.DLR_CD
                                   ,A.BMP_ORD_NO
                                   ,B.PURC_ORD_NO
                                   ,B.PURC_ORD_LINE_NO
                                   ,B.PURC_ORD_LINE_DETL_NO
                                   ,A.PURC_ORD_TP
                                   ,A.BP_CD
                                   ,B.GR_STRGE_CD
                                   ,A.PURC_REG_DT
                                   ,B.BMP_ORD_LINE_NO
                                   ,A.REG_USR_ID
                                   ,B.CONFIRM_QTY AS PURC_QTY
                             FROM   DMSDB.PT_0421T A
                                      INNER JOIN DMSDB.PT_0422T B
                                        ON A.DLR_CD      = B.DLR_CD
                                       AND A.PURC_ORD_NO = B.PURC_ORD_NO
                                       AND B.DEL_YN     != 'Y'
                      ) D
                    ON B.DLR_CD           = D.DLR_CD
                   AND B.PURC_ORD_NO      = D.PURC_ORD_NO
                   AND B.PURC_ORD_LINE_NO = D.PURC_ORD_LINE_NO
                   AND B.PURC_ORD_LINE_DETL_NO = D.PURC_ORD_LINE_DETL_NO
                 INNER JOIN DMSDB.PT_0211T E
                   ON A.DLR_CD = E.DLR_CD
                  AND A.BP_CD  = E.BP_CD
                 LEFT OUTER JOIN PT_0224T G
                  ON C.DLR_CD      = G.DLR_CD
                 AND C.GR_STRGE_CD = G.STRGE_CD
                 AND C.ITEM_CD     = G.ITEM_CD
                 AND G.LOC_CD != ''
         WHERE   B.DLR_CD            = #{sDlrCd}        --딜러코드
           AND   B.ITEM_CD           = #{sItemCd}       --부품번호
           AND   A.INVC_STAT_CD      = '03'
           AND   B.GR_QTY            <![CDATA[>]]> 0
    </select>

    <!-- 입고 확정 시 남아있는 입고 대상 정보 Count를 조회한다. -->
    <select id="selectInvcsByReceiveCnt" parameterType="InvcItemVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectInvcsByReceiveCnt] */
        SELECT   COUNT(*)
          FROM  DMSDB.PT_0431T A                  --송장헤더정보
                  INNER JOIN  DMSDB.PT_0432T B    --송장품목정보
                     ON A.DLR_CD      = B.DLR_CD
                    AND A.INVC_DOC_NO = B.INVC_DOC_NO
         WHERE   A.DLR_CD            = #{dlrCd}        --딜러코드
           AND   A.INVC_DOC_NO       = #{invcDocNo}
           AND   B.GR_END_YN        != 'Y'
    </select>

    <!-- 입고 확정 시 송장 품목 정보를 수정한다. -->
    <update id="updateReceiveCnfmItem" parameterType="InvcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.updateReceiveCnfmItem] */
        UPDATE DMSDB.PT_0432T A    --송장품목정보
          SET  A.INVC_GR_DT       = NVL(A.INVC_GR_DT, sysdate)
              ,A.GR_END_YN        = 'Y'
              ,A.GR_QTY           = #{grQty}                   --입고수량
              ,A.GR_DT            = sysdate                    --입고일자
              ,A.COMPARE_QTY      = #{compareQty}              --차이수량
              ,A.CLAIM_QTY        = #{claimQty}                --클레임수량
              ,A.GR_STRGE_CD      = #{grStrgeCd}               --입고창고
              ,A.GR_LOC_CD        = #{grLocCd}                 --입고로케이션
              ,A.REQ_CONT         = #{reqCont}                 --차이사유
              ,A.UPDT_USR_ID      = #{regUsrId}                --수정자ID
              ,A.UPDT_DT          = sysdate
         WHERE A.DLR_CD             = #{dlrCd}                  --딜러코드
           AND A.INVC_DOC_NO        = #{invcDocNo}              --송장번호
           AND A.INVC_DOC_LINE_NO   = #{invcDocLineNo}          --송장라인번호
           AND A.GR_END_YN != 'Y'
    </update>

    <!-- 입고 등록 시 송장 품목 정보를 수정한다. -->
    <update id="updateReceiveRgstItem" parameterType="InvcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.updateReceiveRgstItem] */
        UPDATE DMSDB.PT_0432T A    --송장품목정보
          SET  A.INVC_GR_DT       = sysdate
              ,A.GR_END_YN        = 'N'
              ,A.GR_QTY           = #{grQty}                   --입고수량
              ,A.COMPARE_QTY      = #{compareQty}              --차이수량
              ,A.CLAIM_QTY        = #{claimQty}                --클레임수량
              ,A.GR_STRGE_CD      = #{grStrgeCd}               --입고창고
              ,A.GR_LOC_CD        = #{grLocCd}                 --입고로케이션
              ,A.REQ_CONT         = #{reqCont}                 --차이사유
              ,A.UPDT_USR_ID      = #{regUsrId}                --수정자ID
              ,A.UPDT_DT          = sysdate
         WHERE A.DLR_CD             = #{dlrCd}                  --딜러코드
           AND A.INVC_DOC_NO        = #{invcDocNo}              --송장번호
           AND A.INVC_DOC_LINE_NO   = #{invcDocLineNo}          --송장라인번호
           AND A.GR_END_YN != 'Y'
    </update>

    <!-- 송장 품목 정보 중 클레임 발생 시 클레임 수량정보를 수정한다. -->
    <update id="updateInvcItemByClaim" parameterType="InvcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.updateInvcItemByClaim] */
        UPDATE DMSDB.PT_0432T A    --송장품목정보
          SET  A.CLAIM_QTY        = NVL(A.CLAIM_QTY, 0) + NVL(#{claimQty}, 0)                 --클레임 등록 수량
              ,A.UPDT_USR_ID      = #{regUsrId}                --수정자ID
              ,A.UPDT_DT          = sysdate
         WHERE A.DLR_CD             = #{dlrCd}                  --딜러코드
           AND A.INVC_DOC_NO        = #{invcDocNo}              --송장번호
           AND A.INVC_DOC_LINE_NO   = #{invcDocLineNo}          --송장라인번호
    </update>

    <!-- 입고현황 조회 정보 Count를 조회한다. -->
    <select id="selectReceiveCnfmListByConditionCnt" resultType="int" parameterType="InvcSearchVO">
    /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceiveCnfmListByConditionCnt] */
    SELECT COUNT(*)
      FROM
          (
            SELECT
                    A.DLR_CD                       --딜러코드
                   ,A.MOBIS_INVC_NO                --모비스송장번호
                   ,A.MOBIS_INVC_LINE_NO           --모비스송장라인번호
                   ,A.PURC_ORD_NO                  --구매오더번호
                   ,A.PURC_ORD_LINE_NO             --구매오더라인번호
                   ,A.PURC_ORD_LINE_DETL_NO       --구매오더라인번호구분자
                   ,A.INVC_DOC_NO
                   ,A.INVC_DOC_LINE_NO
                   ,A.ITEM_CD                      --품목코드
                   ,C.ITEM_NM                      --품목명
                   ,A.INVC_QTY                     --송장수량
                   ,A.GR_QTY                       --입고수량
                   ,A.INVC_UNIT_CD                 --송장단위코드
                   ,A.INVC_PRC                     --송장단가
                   ,A.TAX_DDCT_PRC                 --세금공제단가
                   ,A.INVC_AMT                     --송장금액
                   ,A.VAT_AMT                      --부가세금액
                   ,A.INVC_TOT_AMT                 --송장총금액
                   ,A.GR_DT AS INVC_GR_DT                   --송장입고일자
                   ,A.DL_PDC_CD                    --배송PDC코드
                   ,A.GR_STRGE_CD                  --입고창고코드
                   ,A.GR_LOC_CD                    --입고위치코드
                   ,A.GR_END_YN                    --입고완료여부
                   ,B.INVC_DT                      --송장일자
                   ,B.BP_CD                        --거래처코드
                   ,D.BP_NM                        --거래처명
                   ,(A.INVC_PRC * NVL(A.GR_QTY,0) ) AS GR_TOT_AMT
                   ,(A.TAX_DDCT_PRC * NVL(A.GR_QTY,0)) AS GR_TAX_DDCT_AMT
                   ,E.AVLB_STOCK_QTY               --가용재고
                   ,E.RESV_STOCK_QTY               --예류재고
                   ,NVL(E.BORROW_QTY,0) AS BORROW_QTY  --차용재고
                   ,NVL(E.RENT_QTY,0) AS RENT_QTY  --차출재고
                   ,NVL(E.AVLB_STOCK_QTY,0) + NVL(E.RESV_STOCK_QTY,0) - NVL(E.BORROW_QTY,0) + NVL(E.RENT_QTY,0) AS STOCK_QTY
                   ,D.BP_TP
                  FROM DMSDB.PT_0432T A                   --송장문서품목정보
                       INNER JOIN DMSDB.PT_0431T B        --송장문서헤더정보
                          ON A.DLR_CD      = B.DLR_CD
                         AND A.INVC_DOC_NO = B.INVC_DOC_NO
                       INNER JOIN DMSDB.PT_0201T C
                          ON A.DLR_CD  = C.DLR_CD
                         AND A.ITEM_CD = C.ITEM_CD
                       INNER JOIN DMSDB.PT_0211T D
                          ON B.DLR_CD = D.DLR_CD
                         AND B.BP_CD  = D.BP_CD
                       LEFT OUTER JOIN PT_0301T E
                          ON A.DLR_CD       = E.DLR_CD
                         AND A.ITEM_CD      = E.ITEM_CD
                         AND A.GR_STRGE_CD  = E.STRGE_CD
                 WHERE A.DLR_CD = #{sDlrCd}
                   AND A.GR_END_YN = 'Y'
                   --AND B.INVC_STAT_CD in ('03')
                 UNION ALL
               SELECT   A.DLR_CD                       --딜러코드
                       ,NULL AS MOBIS_INVC_NO                --모비스송장번호
                       ,NULL AS MOBIS_INVC_LINE_NO           --모비스송장라인번호
                       ,NULL AS PURC_ORD_NO                  --구매오더번호
                       ,NULL AS PURC_ORD_LINE_NO             --구매오더라인번호
                       ,NULL AS PURC_ORD_LINE_DETL_NO       --구매오더라인번호구분자
                       ,A.ETC_GR_DOC_NO AS INVC_DOC_NO                  --송장번호
                       ,A.ETC_GR_DOC_LINE_NO AS INVC_DOC_LINE_NO             --송장라인번호
                       ,A.ITEM_CD                      --품목코드
                       ,C.ITEM_NM                      --품목명
                       ,0  AS INVC_QTY                     --송장수량
                       ,A.QTY AS GR_QTY                       --입고수량
                       ,A.UNIT_CD AS INVC_UNIT_CD                 --송장단위코드
                       ,A.PRC AS INVC_PRC                     --송장단가
                       ,A.TAX_DDCT_PRC                 --세금공제단가
                       ,0  AS INVC_AMT                  --송장금액
                       ,A.TAX_AMT AS VAT_AMT           --부가세금액
                       ,0  AS INVC_TOT_AMT                 --송장총금액
                       ,NVL(A.UPDT_DT,A.REG_DT) AS INVC_GR_DT                   --송장입고일자
                       ,NULL AS DL_PDC_CD                    --배송PDC코드
                       ,A.STRGE_CD AS GR_STRGE_CD                  --입고창고코드
                       ,A.LOC_CD AS GR_LOC_CD                    --입고위치코드
                       ,'Y' AS GR_END_YN                    --입고완료여부
                       ,NULL AS INVC_DT                      --송장일자
                       ,B.BP_CD                        --거래처코드
                       ,D.BP_NM                        --거래처명
                       ,CASE WHEN A.GR_STAT_CD = '03' THEN  NVL(A.AMT,0) - NVL(G.MOVING_AVG_AMT,0)    ELSE NVL(A.AMT,0) END GR_TOT_AMT
                       ,CASE WHEN A.GR_STAT_CD = '03' THEN 0  ELSE NVL(A.TAX_DDCT_AMT,0) END GR_TAX_DDCT_AMT
                       ,NVL(E.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY               --가용재고
                       ,NVL(E.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY               --예류재고
                       ,NVL(E.BORROW_QTY,0) AS BORROW_QTY  --차용재고
                       ,NVL(E.RENT_QTY,0) AS RENT_QTY  --차출재고
                       ,NVL(E.AVLB_STOCK_QTY,0) + NVL(E.RESV_STOCK_QTY,0) - NVL(E.BORROW_QTY,0) + NVL(E.RENT_QTY,0) AS STOCK_QTY
                       ,D.BP_TP
                 FROM   DMSDB.PT_0622T A                   --기타입고품목정보
                           INNER JOIN DMSDB.PT_0621T B        --기타입고문서헤더정보
                              ON A.DLR_CD        = B.DLR_CD
                             AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                           INNER JOIN DMSDB.PT_0201T C
                              ON A.DLR_CD  = C.DLR_CD
                             AND A.ITEM_CD = C.ITEM_CD
                           INNER JOIN DMSDB.PT_0211T D
                              ON B.DLR_CD = D.DLR_CD
                             AND B.BP_CD  = D.BP_CD
                           LEFT OUTER JOIN PT_0301T E
                              ON A.DLR_CD      = E.DLR_CD
                             AND A.ITEM_CD     = E.ITEM_CD
                             AND A.STRGE_CD    = E.STRGE_CD
                           INNER JOIN PT_0312T G
                              ON A.DLR_CD = G.DLR_cD
                             AND A.ETC_GR_DOC_NO = G.REF_DOC_NO
                             AND A.ETC_gR_DOC_LINE_NO = G.REF_DOC_LINE_NO
                WHERE   B.DLR_CD     = #{sDlrCd}
                  AND   B.MVT_TP     IN ('01','02')
                  AND   A.GR_STAT_CD in ('02','03')
                  AND   NVL(B.ETC_GR_DOC_TP,'PARTS') = 'PARTS'
               ) A
              WHERE A.DLR_CD = #{sDlrCd}
              <if test='sBpCd != null and sBpCd != ""'>
                  AND A.BP_CD = #{sBpCd}
              </if>        --거래처코드
              <if test='sBpNm != null and sBpNm != ""'>
                  AND A.BP_NM LIKE '%'||#{sBpNm}||'%'
              </if><!-- 거래처명 -->
              <if test='sItemCd != null and sItemCd != ""'>
                  AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
              </if> --품목코드
              <if test='sInvcDocNo != null and sInvcDocNo != ""'>
                  AND A.INVC_DOC_NO LIKE '%'|| #{sInvcDocNo} ||'%'
              </if> --입고번호
              <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                  AND A.GR_STRGE_CD = #{sGrStrgeCd}
              </if> --입고창고코드
              <if test='sInvcTp != null and sInvcTp != ""'>
                  AND A.INVC_TP = #{sInvcTp}
              </if>        --송장유형
              <if test='sBpTp != null and sBpTp != ""'>
                  AND A.BP_TP = #{sBpTp}
              </if>        --거래처유형
              <if test='sInvcGrDtFr != null'>
              <choose>
                  <otherwise>
                       AND A.INVC_GR_DT <![CDATA[>=]]> #{sInvcGrDtFr}
                  </otherwise>
              </choose>
              </if>
              <if test='sInvcGrDtTo != null'>
                  <choose>
                      <otherwise>
                           AND A.INVC_GR_DT <![CDATA[<=]]> #{sInvcGrDtTo} + 1
                      </otherwise>
                  </choose>
              </if> --송장입고일자
              <if test='sInvcDtFr != null'>
              <choose>
                  <otherwise>
                       AND A.INVC_DT <![CDATA[>=]]> #{sInvcDtFr}
                  </otherwise>
              </choose>
              </if>
              <if test='sInvcDtTo != null'>
                  <choose>
                      <otherwise>
                           AND A.INVC_DT <![CDATA[<=]]> #{sInvcDtTo} + 1
                      </otherwise>
                  </choose>
              </if> --송장일자
              <if test='sItemNm != null and sItemNm != ""'>
                     AND A.ITEM_NM LIKE '%'|| #{sItemNm} || '%'
              </if>  --품목명
              <if test='sGrLocCd != null and sGrLocCd != ""'>
                   AND A.GR_LOC_CD LIKE '%'|| #{sGrLocCd} ||'%'
              </if>  --입고로케이션
              <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                   AND A.BP_CD IN
                   <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                      #{item}
                   </foreach>
              </if>        --거래처코드
    </select>

       <!-- 입고현황 조회 정보를 조회한다. -->
    <select id="selectReceiveCnfmListByCondition" resultType="InvcItemVO" parameterType="InvcSearchVO">
    /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceiveCnfmListByCondition] */
      SELECT A.*
        FROM
            (
            SELECT   ROWNUM AS RNUM
                   , T1.*
              FROM (
                  SELECT    A.DLR_CD                       --딜러코드
                           ,A.MOBIS_INVC_NO                --모비스송장번호
                           ,A.MOBIS_INVC_LINE_NO           --모비스송장라인번호
                           ,A.PURC_ORD_NO                  --구매오더번호
                           ,A.PURC_ORD_LINE_NO             --구매오더라인번호
                           ,A.PURC_ORD_LINE_DETL_NO       --구매오더라인번호구분자
                           ,A.INVC_DOC_NO
                           ,A.INVC_DOC_LINE_NO
                           ,A.ITEM_CD                      --품목코드
                           ,A.ITEM_NM                      --품목명
                           ,A.INVC_QTY                     --송장수량
                           ,A.GR_QTY                       --입고수량
                           ,A.INVC_UNIT_CD                 --송장단위코드
                           ,A.INVC_PRC                     --입고단가
                           ,A.TAX_DDCT_PRC                 --세금공제단가
                           ,A.INVC_AMT                     --송장금액
                           ,A.VAT_AMT                      --부가세금액
                           ,A.INVC_TOT_AMT                 --송장총금액
                           ,A.INVC_GR_DT                   --송장입고일자
                           ,A.DL_PDC_CD                    --배송PDC코드
                           ,A.GR_STRGE_CD                  --입고창고코드
                           ,A.GR_LOC_CD                    --입고위치코드
                           ,A.GR_END_YN                    --입고완료여부
                           ,A.INVC_DT                      --송장일자
                           ,A.BP_CD                        --거래처코드
                           ,A.BP_NM                        --거래처명
                           --,A.GR_TOT_AMT
                           --,A.GR_TAX_DDCT_AMT
                           ,A.INVC_AMT AS GR_TAX_DDCT_AMT  --송장금액
                           ,A.INVC_TOT_AMT AS GR_TOT_AMT   --송장총금액
                           ,A.AVLB_STOCK_QTY               --가용재고
                           ,A.RESV_STOCK_QTY               --예류재고
                           ,A.STOCK_QTY
                           ,A.BORROW_QTY  --차용재고
                           ,A.RENT_QTY  --차출재고
                    FROM
                      (
                        SELECT
                            A.DLR_CD                       --딜러코드
                           ,A.MOBIS_INVC_NO                --모비스송장번호
                           ,A.MOBIS_INVC_LINE_NO           --모비스송장라인번호
                           ,A.PURC_ORD_NO                  --구매오더번호
                           ,A.PURC_ORD_LINE_NO             --구매오더라인번호
                           ,A.PURC_ORD_LINE_DETL_NO        --구매오더라인번호구분자
                           ,A.INVC_DOC_NO                  --송장번호
                           ,A.INVC_DOC_LINE_NO             --송장라인번호
                           ,A.ITEM_CD                      --품목코드
                           ,C.ITEM_NM                      --품목명
                           ,A.INVC_QTY                     --송장수량
                           ,NVL(A.GR_QTY,0) AS GR_QTY                       --입고수량
                           ,A.INVC_UNIT_CD                 --송장단위코드
                           ,A.INVC_PRC                     --송장단가
                           ,A.TAX_DDCT_PRC                 --세금공제단가
                           ,A.INVC_AMT                     --송장금액
                           ,A.VAT_AMT                      --부가세금액
                           ,A.INVC_TOT_AMT                 --송장총금액
                           ,A.GR_DT AS INVC_GR_DT                   --송장입고일자
                           ,A.DL_PDC_CD                    --배송PDC코드
                           ,A.GR_STRGE_CD                  --입고창고코드
                           ,A.GR_LOC_CD                    --입고위치코드
                           ,A.GR_END_YN                    --입고완료여부
                           ,B.INVC_DT                      --송장일자
                           ,B.BP_CD                        --거래처코드
                           ,D.BP_NM                        --거래처명
                           ,(A.INVC_PRC * NVL(A.GR_QTY,0) ) AS GR_TOT_AMT
                           ,(A.TAX_DDCT_PRC * NVL(A.GR_QTY,0)) AS GR_TAX_DDCT_AMT
                           ,E.AVLB_STOCK_QTY               --가용재고
                           ,E.RESV_STOCK_QTY               --예류재고
                           ,NVL(E.BORROW_QTY,0) AS BORROW_QTY  --차용재고
                           ,NVL(E.RENT_QTY,0) AS RENT_QTY  --차출재고
                           ,NVL(E.AVLB_STOCK_QTY,0) + NVL(E.RESV_STOCK_QTY,0) - NVL(E.BORROW_QTY,0) + NVL(E.RENT_QTY,0) AS STOCK_QTY
                           ,D.BP_TP
                          FROM DMSDB.PT_0432T A                   --송장문서품목정보
                               INNER JOIN DMSDB.PT_0431T B        --송장문서헤더정보
                                  ON A.DLR_CD      = B.DLR_CD
                                 AND A.INVC_DOC_NO = B.INVC_DOC_NO
                               INNER JOIN DMSDB.PT_0201T C
                                  ON A.DLR_CD  = C.DLR_CD
                                 AND A.ITEM_CD = C.ITEM_CD
                               INNER JOIN DMSDB.PT_0211T D
                                  ON B.DLR_CD = D.DLR_CD
                                 AND B.BP_CD  = D.BP_CD
                               LEFT OUTER JOIN PT_0301T E
                                  ON A.DLR_CD       = E.DLR_CD
                                 AND A.ITEM_CD      = E.ITEM_CD
                                 AND A.GR_STRGE_CD  = E.STRGE_CD
                         WHERE A.DLR_CD = #{sDlrCd}
                           AND A.GR_END_YN = 'Y'
                           --AND B.INVC_STAT_CD in ('03')
                         UNION ALL
                       SELECT   A.DLR_CD                       --딜러코드
                               ,NULL AS MOBIS_INVC_NO                --모비스송장번호
                               ,NULL AS MOBIS_INVC_LINE_NO           --모비스송장라인번호
                               ,NULL AS PURC_ORD_NO                  --구매오더번호
                               ,NULL AS PURC_ORD_LINE_NO             --구매오더라인번호
                               ,NULL AS PURC_ORD_LINE_DETL_NO       --구매오더라인번호구분자
                               ,A.ETC_GR_DOC_NO AS INVC_DOC_NO                  --송장번호
                               ,A.ETC_GR_DOC_LINE_NO AS INVC_DOC_LINE_NO             --송장라인번호
                               ,A.ITEM_CD                      --품목코드
                               ,C.ITEM_NM                      --품목명
                               ,0  AS INVC_QTY                     --송장수량
                               ,CASE WHEN A.GR_STAT_CD = '03' THEN 0  ELSE NVL(A.QTY,0) END GR_QTY
                               ,A.UNIT_CD AS INVC_UNIT_CD                 --송장단위코드
                               ,A.PRC AS INVC_PRC                     --송장단가
                               ,A.TAX_DDCT_PRC                 --세금공제단가
                               ,CASE WHEN A.GR_STAT_CD = '03' THEN 0  ELSE NVL(A.TAX_DDCT_AMT,0) END  AS INVC_AMT                  --송장금액
                               ,A.TAX_AMT AS VAT_AMT           --부가세금액
                               ,CASE WHEN A.GR_STAT_CD = '03' THEN  NVL(A.AMT,0) - NVL(G.MOVING_AVG_AMT,0)    ELSE NVL(A.AMT,0) END   AS INVC_TOT_AMT                 --송장총금액
                               ,NVL(A.UPDT_DT,A.REG_DT) AS INVC_GR_DT                   --송장입고일자
                               ,NULL AS DL_PDC_CD                    --배송PDC코드
                               ,A.STRGE_CD AS GR_STRGE_CD                  --입고창고코드
                               ,A.LOC_CD AS GR_LOC_CD                    --입고위치코드
                               ,'Y' AS GR_END_YN                    --입고완료여부
                               ,NULL AS INVC_DT                      --송장일자
                               ,B.BP_CD                        --거래처코드
                               ,D.BP_NM                        --거래처명
                               ,CASE WHEN A.GR_STAT_CD = '03' THEN  NVL(A.AMT,0) - NVL(G.MOVING_AVG_AMT,0)    ELSE NVL(A.AMT,0) END GR_TOT_AMT
                               ,CASE WHEN A.GR_STAT_CD = '03' THEN 0  ELSE NVL(A.TAX_DDCT_AMT,0) END GR_TAX_DDCT_AMT
                               ,NVL(E.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY               --가용재고
                               ,NVL(E.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY               --예류재고
                               ,NVL(E.BORROW_QTY,0) AS BORROW_QTY  --차용재고
                               ,NVL(E.RENT_QTY,0) AS RENT_QTY  --차출재고
                               ,NVL(E.AVLB_STOCK_QTY,0) + NVL(E.RESV_STOCK_QTY,0) - NVL(E.BORROW_QTY,0) + NVL(E.RENT_QTY,0) AS STOCK_QTY
                               ,D.BP_TP
                         FROM   DMSDB.PT_0622T A                   --기타입고품목정보
                                   INNER JOIN DMSDB.PT_0621T B        --기타입고문서헤더정보
                                      ON A.DLR_CD        = B.DLR_CD
                                     AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                                   INNER JOIN DMSDB.PT_0201T C
                                      ON A.DLR_CD  = C.DLR_CD
                                     AND A.ITEM_CD = C.ITEM_CD
                                   INNER JOIN DMSDB.PT_0211T D
                                      ON B.DLR_CD = D.DLR_CD
                                     AND B.BP_CD  = D.BP_CD
                                   LEFT OUTER JOIN PT_0301T E
                                      ON A.DLR_CD           = E.DLR_CD
                                     AND A.ITEM_CD          = E.ITEM_CD
                                     AND A.STRGE_CD         = E.STRGE_CD
                                   INNER JOIN PT_0312T G
                                    ON A.DLR_CD = G.DLR_cD
                                   AND A.ETC_GR_DOC_NO = G.REF_DOC_NO
                                   AND A.ETC_gR_DOC_LINE_NO = G.REF_DOC_LINE_NO
                         WHERE   B.DLR_CD     = #{sDlrCd}
                           --AND   B.MVT_TP     = '01'
                           --AND   A.GR_STAT_CD in ('02')
                           AND   B.MVT_TP     IN ('01','02')
                           AND   A.GR_STAT_CD in ('02','03')
                           AND   NVL(B.ETC_GR_DOC_TP,'PARTS') = 'PARTS'
                           ) A
                      WHERE A.DLR_CD = #{sDlrCd}
                      <if test='sBpCd != null and sBpCd != ""'>
                          AND A.BP_CD = #{sBpCd}
                      </if>        --거래처코드
                      <if test='sBpNm != null and sBpNm != ""'>
                          AND A.BP_NM LIKE '%'||#{sBpNm}||'%'
                      </if><!-- 거래처명 -->
                      <if test='sItemCd != null and sItemCd != ""'>
                          AND A.ITEM_CD LIKE '%'|| #{sItemCd} ||'%'
                      </if> --품목코드
                      <if test='sInvcDocNo != null and sInvcDocNo != ""'>
                          AND A.INVC_DOC_NO LIKE '%'|| #{sInvcDocNo} ||'%'
                      </if> --입고번호
                      <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                          AND A.GR_STRGE_CD = #{sGrStrgeCd}
                      </if> --입고창고코드
                      <if test='sInvcTp != null and sInvcTp != ""'>
                          AND A.INVC_TP = #{sInvcTp}
                      </if>        --송장유형
                      <if test='sBpTp != null and sBpTp != ""'>
                          AND A.BP_TP = #{sBpTp}
                      </if>        --거래처유형
                      <if test='sInvcGrDtFr != null'>
                      <choose>
                          <otherwise>
                               AND A.INVC_GR_DT <![CDATA[>=]]> #{sInvcGrDtFr}
                          </otherwise>
                      </choose>
                      </if>
                      <if test='sInvcGrDtTo != null'>
                          <choose>
                              <otherwise>
                                   AND A.INVC_GR_DT <![CDATA[<=]]> #{sInvcGrDtTo} + 1
                              </otherwise>
                          </choose>
                      </if> --송장입고일자
                      <if test='sInvcDtFr != null'>
                      <choose>
                          <otherwise>
                               AND A.INVC_DT <![CDATA[>=]]> #{sInvcDtFr}
                          </otherwise>
                      </choose>
                      </if>
                      <if test='sInvcDtTo != null'>
                          <choose>
                              <otherwise>
                                   AND A.INVC_DT <![CDATA[<=]]> #{sInvcDtTo} + 1
                              </otherwise>
                          </choose>
                      </if> --송장일자
                      <if test='sItemNm != null and sItemNm != ""'>
                          AND A.ITEM_NM LIKE '%'|| #{sItemNm} || '%'
                      </if>  --품목명
                      <if test='sGrLocCd != null and sGrLocCd != ""'>
                          AND A.GR_LOC_CD LIKE '%'|| #{sGrLocCd} ||'%'
                      </if>  --입고로케이션
                      <if test='sBpCdList != null and !sBpCdList.isEmpty'>
                          AND A.BP_CD IN
                           <foreach item="item" index="index" collection="sBpCdList" open="(" separator="," close=")">
                              #{item}
                           </foreach>
                      </if>        --거래처코드
                     ORDER BY
                     <choose>
                         <when test='sort != null'>
                             <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                 <choose>
                                     <when test='item.field == "dlrCd"'> A.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "mobisInvcNo"'> A.MOBIS_INVC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "mobisInvcLineNo"'> A.MOBIS_INVC_LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "purcOrdNo"'> A.PURC_ORD_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "purcOrdLineNo"'> A.PURC_ORD_LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "itemCd"'> A.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "invcQty"'> A.INVC_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "invcUnitCd"'> A.INVC_UNIT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "invcPrc"'> A.INVC_PRC <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "invcAmt"'> A.INVC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "vatAmt"'> A.VAT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "invcTotAmt"'> A.INVC_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "invcGrDt"'> A.INVC_GR_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "dlPdcCd"'> A.DL_PDC_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "grStrgeCd"'> A.GR_STRGE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "grLocCd"'> A.GR_LOC_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "grEndYn"'> A.GR_END_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "bpCd"'> A.BP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <when test='item.field == "invcDt"'> A.INVC_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                     <otherwise>
                                      A.DLR_CD ASC
                                     ,A.INVC_GR_DT DESC
                                     ,A.INVC_DOC_NO DESC
                                     ,A.INVC_DOC_LINE_NO ASC
                                     </otherwise>
                                 </choose>
                             </foreach>
                         </when>
                         <otherwise>
                          A.DLR_CD ASC
                         ,A.INVC_GR_DT DESC
                         ,A.INVC_DOC_NO DESC
                         ,A.INVC_DOC_LINE_NO ASC
                         </otherwise>
                     </choose>
             ) T1
           ) A
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
            </where>
    </select>

    <!-- 입고확정  SUMMARY 정보를 조회한다.(송장번호로 인한) -->
    <select id="selectReceiveCnfmItemSummaryByInvcKey" parameterType="InvcSearchVO" resultType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceiveCnfmItemSummaryByInvcKey] */

        SELECT   B.DLR_CD                                   --딜러코드
                ,B.INVC_DOC_NO AS GR_DOC_NO                             --송장문서번호
                ,A.BP_CD                              --공급업체코드
                ,C.BP_TP                              --공급업체유형
                ,A.REMARK
                ,MAX(C.BP_NM) AS BP_NM                --공급업체명
                ,MAX(A.MOBIS_INVC_NO) AS MOBIS_INVC_NO
                ,MAX(A.INVC_DOC_NO) AS INVC_DOC_NO
                ,MAX(A.CONFIRM_DT) AS CONFIRM_DT
                ,MAX(A.ARRV_DT) AS ARRV_DT
                ,MAX(A.INVC_TP) AS INVC_TP
                ,MAX(A.INVC_STAT_CD) AS INVC_STAT_CD
                ,'01' AS GR_TP
                ,ABS(SUM(NVL(B.INVC_QTY,0) - NVL(B.GR_QTY,0))) AS CLAIM_TOT_QTY                                --송장수량
                ,SUM(NVL(B.GR_QTY,0)) AS GR_TOT_QTY                    --입고수량
                ,MAX(NVL(A.DC_RATE,0)) AS DC_RATE                    --입고
                ,SUM(NVL(B.TAX_DDCT_PRC,0) * NVL(B.GR_QTY,0)) AS GR_TOT_AMT  --입고금액
                ,MAX(A.REG_USR_ID) AS REG_USR_ID  --등록자
                ,MAX(D.USR_NM) AS REG_USR_NM   --등록자명
                ,MAX(A.CONFIRM_DT) AS INVC_GR_DT  --확정일자
                ,MAX(TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS')) AS UPDT_DT_STR
          FROM  DMSDB.PT_0431T A                            --송장헤더정보
                  INNER JOIN  DMSDB.PT_0432T B              --송장품목정보
                     ON A.DLR_CD      = B.DLR_CD
                    AND A.INVC_DOC_NO = B.INVC_DOC_NO
                  INNER JOIN DMSDB.PT_0211T C
                     ON A.DLR_CD = C.DLR_CD
                    AND A.BP_CD  = C.BP_CD
                  LEFT OUTER JOIN DMSDB.CM_0801T D
                     ON A.UPDT_USR_ID  = D.USR_ID
         WHERE   B.DLR_CD            = #{sDlrCd}
           AND   A.INVC_DOC_NO       = #{sInvcDocNo}
           --AND   A.INVC_STAT_CD      = '03'
           --AND   B.GR_END_YN         = 'Y'
         GROUP BY B.DLR_CD                                   --딜러코드
                 ,B.INVC_DOC_NO
                 ,A.BP_CD
                 ,C.BP_TP
                 ,A.REMARK
    </select>

    <!-- 입고확정  정보를 조회한다.(송장번호로 인한) -->
    <select id="selectReceiveCnfmItemByInvcKey" parameterType="InvcSearchVO" resultType="InvcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceiveCnfmItemByInvcKey] */
        SELECT   B.DLR_CD                                   --딜러코드
                ,A.INVC_DT                                  --INVOICE일자
                ,D.PURC_ORD_TP                              --오더유형
                ,A.BP_CD                                    --공급업체코드
                ,E.BP_NM                                    --공급업체명
                ,B.PURC_ORD_LINE_DETL_NO                   --구매오더라인구분자
                ,B.INVC_DOC_NO                              --송장문서번호
                ,B.INVC_DOC_LINE_NO                         --송장문서라인번호
                ,B.MOBIS_INVC_NO                            --모비스송장번호
                ,B.MOBIS_INVC_LINE_NO                       --모비스송장라인번호
                ,A.INVC_TP                                  --송장유형
                ,CASE WHEN B.GR_END_YN = 'Y' THEN '03' ELSE A.INVC_STAT_CD END INVC_STAT_CD
                ,B.ITEM_CD                                  --품목코드
                ,C.ITEM_NM                                  --품목명
                ,B.INVC_QTY AS INVC_TARGET_QTY                                --송장수량
                ,D.PURC_QTY
                ,B.GR_QTY AS INVC_QTY                  --입고수량
                ,B.GR_QTY                    --입고수량
                --,(NVL(B.INVC_QTY,0) - NVL(B.GR_QTY,0)) AS COMPARE_QTY            --비교수량
                ,NVL(B.COMPARE_QTY,0) AS COMPARE_QTY             --비교수량
                ,B.INVC_UNIT_CD                              --송장단위코드
                ,B.INVC_PRC                                 --송장단가
                ,B.TAX_DDCT_PRC                             --세금공제단가
                ,B.INVC_AMT                                 --송장금액(세금제외)
                ,B.INVC_TOT_AMT                             --송장금액
                ,(B.INVC_TOT_AMT - B.INVC_AMT) AS TAX_AMT                       --세액
                ,DECODE(B.INVC_PRC - NVL(B.TAX_DDCT_PRC, 0), 0, 0, FN_GET_VAT(TO_CHAR(NVL(A.CONFIRM_DT, A.INVC_DT),'YYYYMMDD'),'ALL')) AS DC_RATE
                ,NVL(NVL(B.GR_STRGE_CD ,D.GR_STRGE_CD), C.GR_STRGE_CD) AS GR_STRGE_CD
                ,NVL(G.LOC_CD, ' ') AS GR_LOC_CD
                ,NVL(F.CLAIM_TARG_CD,' ') AS CLAIM_TARG_CD  --클레임대상코드
                ,NVL(F.DL_BP_CD,' ') AS DL_BP_CD            --배송거래처코드
                ,NVL(H.BP_NM,' ') AS DL_BP_NM
                ,NVL(F.CLAIM_TP,' ') AS CLAIM_TP            --클레임유형
                ,NVL(F.CLAIM_QTY, 0) AS CLAIM_QTY                               --클레임수량
                ,NVL(B.REQ_CONT, F.REQ_CONT) AS REQ_CONT                                  --요청내용
                ,NVL(B.DL_PDC_CD, ' ') AS DL_PDC_CD                                  --PDC창고
                ,A.ARRV_DT
                ,B.BOX_NO
                ,A.REMARK
                ,NVL(D.BMP_ORD_NO,B.INVC_IF_ORD_NO) AS  BMP_ORD_NO  --구매오더번호(BMP)
                ,NVL(D.BMP_ORD_LINE_NO,B.INVC_IF_ORD_LN) AS  BMP_ORD_LINE_NO           --구매오더라인번호(BMP)
                ,D.PURC_ORD_NO                --구매오더번호
                ,D.PURC_ORD_LINE_NO           --구매오더라인번호
                ,D.PURC_REG_DT
                ,D.REG_USR_ID AS ORD_REG_USR_ID
                ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = D.REG_USR_ID) AS ORD_REG_USR_NM   --등록자명
                ,I.REG_USR_ID AS REQ_USR_ID
                ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = I.REG_USR_ID) AS REQ_USR_NM   --결품신청자명
                ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
          FROM  DMSDB.PT_0431T A                            --송장헤더정보
                  INNER JOIN  DMSDB.PT_0432T B              --송장품목정보
                     ON A.DLR_CD      = B.DLR_CD
                    AND A.INVC_DOC_NO = B.INVC_DOC_NO
                  INNER JOIN  DMSDB.PT_0201T C              --품목정보
                     ON B.DLR_CD  = C.DLR_CD
                    AND B.ITEM_CD = C.ITEM_CD
                  INNER JOIN (
                           SELECT   A.DLR_CD
                                   ,A.BMP_ORD_NO
                                   ,B.PURC_ORD_NO
                                   ,B.PURC_ORD_LINE_NO
                                   ,A.PURC_ORD_TP
                                   ,A.BP_CD
                                   ,B.GR_STRGE_CD
                                   ,A.PURC_REG_DT
                                   ,B.BMP_ORD_LINE_NO
                                   ,A.REG_USR_ID
                                   ,B.CONFIRM_QTY AS PURC_QTY
                                   ,B.PURC_REQ_NO
                                   ,B.PURC_REQ_LINE_NO
                                   ,B.PURC_ORD_LINE_DETL_NO
                             FROM   DMSDB.PT_0421T A
                                      INNER JOIN DMSDB.PT_0422T B
                                        ON A.DLR_CD      = B.DLR_CD
                                       AND A.BMP_ORD_NO = B.BMP_ORD_NO
                                       AND B.DEL_YN     != 'Y'
                                       AND (B.PURC_PGSS_CD != 'X' OR (B.PURC_PGSS_CD = 'X' AND NVL(TRIM(B.SHIP_QTY),0) > 0))
                      ) D
                    ON B.DLR_CD           = D.DLR_CD
                   AND B.PURC_ORD_NO      = D.PURC_ORD_NO
                   AND B.PURC_ORD_LINE_NO = D.PURC_ORD_LINE_NO
                   AND B.PURC_ORD_LINE_DETL_NO = D.PURC_ORD_LINE_DETL_NO
                 INNER JOIN DMSDB.PT_0211T E
                   ON A.DLR_CD = E.DLR_CD
                  AND A.BP_CD  = E.BP_CD
                 LEFT OUTER JOIN DMSDB.PT_0441T F
                   ON B.DLR_CD           = F.DLR_CD
                  AND B.INVC_DOC_NO      = F.INVC_DOC_NO
                  AND B.INVC_DOC_LINE_NO = F.INVC_DOC_LINE_NO
                 LEFT OUTER JOIN PT_0224T G
                  ON C.DLR_CD      = G.DLR_CD
                 AND C.GR_STRGE_CD = G.STRGE_CD
                 AND C.ITEM_CD     = G.ITEM_CD
                 AND G.LOC_CD != ''
                 LEFT OUTER JOIN DMSDB.PT_0211T H
                   ON F.DLR_CD    = H.DLR_CD
                  AND F.DL_BP_CD  = H.BP_CD
                  AND H.BP_TP     = '04'
                 LEFT OUTER JOIN DMSDB.PT_0411T I
                   ON I.DLR_CD = D.DLR_CD
                  AND I.PURC_REQ_NO = D.PURC_REQ_NO
                  --AND I.PURC_REQ_LINE_NO = D.PURC_REQ_LINE_NO
         WHERE   B.DLR_CD            = #{sDlrCd}        --딜러코드
           AND   A.INVC_DOC_NO       = #{sInvcDocNo}    --입고번호
         ORDER BY
         <choose>
             <when test='sort != null'>
                 <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                     <choose>
                         <when test='item.field == "invcDt"'> A.INVC_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                         <when test='item.field == "purcOrdNo"'> B.PURC_ORD_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                         <when test='item.field == "purcOrdTp"'> D.PURC_ORD_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                         <when test='item.field == "mobisInvcNo"'> B.MOBIS_INVC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                         <when test='item.field == "itemCd"'> B.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                         <otherwise>
                              A.INVC_DT DESC
                             ,D.PURC_ORD_TP ASC
                             ,B.PURC_ORD_NO DESC
                             ,B.INVC_DOC_LINE_NO ASC
                         </otherwise>
                     </choose>
                 </foreach>
             </when>
             <otherwise>
                  A.INVC_DT DESC
                 ,D.PURC_ORD_TP ASC
                 ,B.PURC_ORD_NO DESC
                 ,B.INVC_DOC_LINE_NO ASC
             </otherwise>
         </choose>
    </select>

    <!-- 입고확정  SUMMARY 정보를 조회한다.(기타번호로 인한) -->
    <select id="selectReceiveCnfmItemSummaryByEtcGrKey" parameterType="InvcSearchVO" resultType="InvcVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceiveCnfmItemSummaryByEtcGrKey] */
               SELECT   A.DLR_CD                             --딜러코드
                       ,A.ETC_GR_DOC_NO AS GR_DOC_NO         --송장번호
                       ,B.BP_CD                              --공급업체코드
                       ,C.BP_TP                              --공급업체유형
                       ,B.REMARK
                       ,MAX(C.BP_NM) AS BP_NM                --공급업체명
                       ,NULL AS MOBIS_INVC_NO
                       ,NULL AS INVC_DOC_NO
                       ,NULL AS CONFIRM_DT
                       ,NULL AS ARRV_DT
                       ,NULL AS INVC_TP
                       ,DECODE(MAX(B.STAT_CD),'01','00','02','03','03','04','') AS INVC_STAT_CD
                       ,'02' AS GR_TP
                       ,SUM(NVL(A.QTY,0)) AS GR_TOT_QTY                       --입고수량
                       ,0 AS CLAIM_TOT_QTY
                       ,SUM(NVL(A.TAX_DDCT_PRC,0) * NVL(A.QTY,0) )  AS GR_TOT_AMT                 --송장총금액
                       ,MAX(NVL(A.DC_RATE,0)) AS DC_RATE
                       ,MAX(A.REG_USR_ID) AS REG_USR_ID  --등록자
                       ,MAX(D.USR_NM) AS REG_USR_NM   --등록자명
                       ,MAX(A.REG_DT) AS INVC_GR_DT  --입고일자
                       ,MAX(TO_CHAR(NVL(B.UPDT_DT,B.REG_DT), 'YYYYMMDDHH24MISS')) AS UPDT_DT_STR
                 FROM   DMSDB.PT_0622T A                   --기타입고품목정보
                           INNER JOIN DMSDB.PT_0621T B        --기타입고문서헤더정보
                              ON A.DLR_CD        = B.DLR_CD
                             AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                           INNER JOIN DMSDB.PT_0211T C
                              ON B.DLR_CD = C.DLR_CD
                             AND B.BP_CD  = C.BP_CD
                           LEFT OUTER JOIN DMSDB.CM_0801T D
                              ON A.REG_USR_ID  = D.USR_ID
                 WHERE   B.DLR_CD          = #{sDlrCd}
                   AND   B.ETC_GR_DOC_NO   = #{sEtcGrDocNo}
                   AND   B.MVT_TP          = '01'
                --   AND   A.GR_STAT_CD      = '02'
                   GROUP BY  A.DLR_CD                             --딜러코드
                            ,A.ETC_GR_DOC_NO
                            ,B.BP_CD
                            ,C.BP_TP
                            ,B.REMARK
    </select>

    <!-- 입고  정보를 조회한다.(기타번호로 인한) -->
    <select id="selectReceiveCnfmItemByEtcGrKey" parameterType="InvcSearchVO" resultType="InvcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceiveCnfmItemByEtcGrKey] */
               SELECT   A.DLR_CD                             --딜러코드
                       ,NULL AS INVC_DT
                       ,NULL AS PURC_ORD_TP
                       ,B.BP_CD                              --거래처코드
                       ,D.BP_NM                              --거래처명
                       ,NULL AS PURC_ORD_LINE_DETL_NO        --구매오더라인번호구분자
                       ,A.ETC_GR_DOC_NO AS INVC_DOC_NO       --송장번호
                       ,A.ETC_GR_DOC_LINE_NO AS INVC_DOC_LINE_NO             --송장라인번호
                       ,NULL AS MOBIS_INVC_NO                --모비스송장번호
                       ,NULL AS MOBIS_INVC_LINE_NO           --모비스송장라인번호
                       ,NULL AS INVC_TP
                       ,DECODE(B.STAT_CD,'01','00','02','03','03','04','') AS INVC_STAT_CD
                       ,A.ITEM_CD                      --품목코드
                       ,C.ITEM_NM                      --품목명
                       ,0 AS INVC_TARGET_QTY
                       ,0 AS PURC_QTY
                       ,A.QTY AS INVC_QTY
                       ,A.QTY AS GR_QTY                       --입고수량
                       ,0 AS COMPARE_QTY
                       ,A.UNIT_CD AS INVC_UNIT_CD                 --송장단위코드
                       ,A.PRC AS INVC_PRC                     --송장단가
                       ,A.TAX_DDCT_PRC                 --세금공제단가
                       ,A.TAX_DDCT_AMT  AS INVC_AMT                  --송장금액
                       ,(NVL(A.PRC,0) * NVL(A.QTY,0) )  AS INVC_TOT_AMT                 --송장총금액
                       ,A.TAX_AMT          --부가세금액
                       ,A.DC_RATE
                       ,A.STRGE_CD AS GR_STRGE_CD                  --입고창고코드
                       ,A.LOC_CD AS GR_LOC_CD                    --입고위치코드
                       ,A.MVT_DOC_YY_MM --수불년월
                       ,A.MVT_DOC_NO --수불번호
                       ,A.MVT_DOC_LINE_NO --수불라인번호
                       ,NULL AS CLAIM_TARG_CD                    --배송PDC코드
                       ,NULL AS DL_BP_CD                    --배송PDC코드
                       ,NULL AS DL_BP_NM                    --배송PDC코드
                       ,NULL AS CLAIM_TP                    --배송PDC코드
                       ,0 AS CLAIM_QTY                    --배송PDC코드
                       ,NULL AS REQ_CONT                    --배송PDC코드
                       ,NULL AS DL_PDC_CD                    --배송PDC코드
                       ,NULL AS ARRV_DT
                       ,NULL AS BOX_NO
                       ,NULL AS BMP_ORD_NO
                       ,NULL AS BMP_ORD_LINE_NO
                       ,NULL AS PURC_ORD_NO
                       ,NULL AS PURC_ORD_LINE_NO
                       ,NULL AS PURC_REG_DT
                       ,NULL AS ORD_REG_USR_ID
                       ,NULL AS ORD_REG_USR_NM
                 FROM   DMSDB.PT_0622T A                   --기타입고품목정보
                           INNER JOIN DMSDB.PT_0621T B        --기타입고문서헤더정보
                              ON A.DLR_CD        = B.DLR_CD
                             AND A.ETC_GR_DOC_NO = B.ETC_GR_DOC_NO
                           INNER JOIN DMSDB.PT_0201T C
                              ON A.DLR_CD  = C.DLR_CD
                             AND A.ITEM_CD = C.ITEM_CD
                           INNER JOIN DMSDB.PT_0211T D
                              ON B.DLR_CD = D.DLR_CD
                             AND B.BP_CD  = D.BP_CD
                           LEFT OUTER JOIN PT_0301T E
                              ON A.DLR_CD           = E.DLR_CD
                             AND A.ITEM_CD          = E.ITEM_CD
                             AND A.STRGE_CD         = E.STRGE_CD
                 WHERE   B.DLR_CD          = #{sDlrCd}
                   AND   B.ETC_GR_DOC_NO   = #{sEtcGrDocNo}
                   AND   B.MVT_TP          = '01'
         ORDER BY
                   A.ETC_GR_DOC_NO DESC
                  ,A.ETC_GR_DOC_LINE_NO
    </select>

    <!-- 기타입고 엑셀업로드 정보를 조회한다.(송장외) -->
    <select id="selectInvcReceiveEtcItemExcelUploadByKey" parameterType="InvcItemVO" resultType="InvcItemVO">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectInvcReceiveEtcItemExcelUploadByKey] */
            SELECT   A.DLR_CD
                    ,A.BP_CD
                    ,A.ITEM_CD
                    ,A.ITEM_NM
                    ,A.GR_STRGE_CD
                    ,A.INVC_UNIT_CD
                    ,A.GR_QTY
                    ,A.INVC_QTY
                    ,A.COMPARE_QTY
                    ,A.CLAIM_QTY
                    ,A.INVC_TARGET_QTY
                    ,A.PURC_QTY
                    ,A.EXCEL_QTY
                    ,A.INVC_PRC
                    ,A.EXCEL_PRC
                    ,A.EXCEL_TAX_DDCT_PRC
                    ,A.TAX_DDCT_PRC                 --세전
                    ,A.INVC_QTY * A.INVC_PRC AS INVC_TOT_AMT
                    ,ROUND(A.TAX_DDCT_PRC * A.INVC_QTY, 2) AS INVC_AMT                 --세전
                    ,ROUND((A.INVC_QTY * A.INVC_PRC) - (A.TAX_DDCT_PRC * A.INVC_QTY), 2) AS TAX_AMT
                    ,A.DC_RATE
                    ,A.SPYR_CD
             FROM
                  (
                    SELECT   A.DLR_CD
                            ,A.BP_CD
                            ,A.ITEM_CD
                            ,A.ITEM_NM
                            ,NVL(#{excelStrgeCd},A.GR_STRGE_CD) AS GR_STRGE_CD
                            ,A.STOCK_UNIT_CD AS INVC_UNIT_CD
                            ,0 AS INVC_TARGET_QTY
                            ,0 AS PURC_QTY
                            ,NVL(ROUND(DECODE(${excelQty},'-999','0',${excelQty})), 0) AS EXCEL_QTY
                            ,NVL(ROUND(${excelQty}), 0) AS INVC_QTY
                            ,NVL(ROUND(${excelQty}), 0) AS GR_QTY
                            ,0 AS COMPARE_QTY
                            ,NVL(ROUND(DECODE(${excelPrc},'-999','0',${excelPrc}),2), 0) AS EXCEL_PRC
                            ,NVL(ROUND(DECODE(${excelTaxDdctPrc},'-999','0',${excelTaxDdctPrc}),2), 0) AS EXCEL_TAX_DDCT_PRC
                            ,CASE WHEN NVL(${excelPrc}, -999) = -999 THEN ROUND(NVL(${excelTaxDdctPrc}, 0) * (1 + FN_GET_VAT(null,'ALL')), 2) ELSE NVL(ROUND(${excelPrc},2), 0) END  INVC_PRC
                            ,CASE WHEN NVL(${excelTaxDdctPrc}, -999) = -999 THEN ROUND(NVL(${excelPrc}, 0) / (1 + FN_GET_VAT(null,'ALL')), 2) ELSE NVL(ROUND(${excelTaxDdctPrc},2), 0) END  TAX_DDCT_PRC
                            ,0 AS CLAIM_QTY
                            ,A.SPYR_CD
                            ,FN_GET_VAT(null,'ALL') AS DC_RATE
                      FROM   DMSDB.PT_0201T A
                    ) A
                     WHERE  A.DLR_CD     = #{dlrCd}        --딜러코드
                       AND  A.ITEM_CD    = #{itemCd}       --부품번호
    </select>

     <!-- 기타입고 정보 Max 라인번호를 조회한다. -->
    <select id="selectReceiveEtcMaxLineNo" parameterType="InvcItemVO" resultType="int">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectReceiveEtcMaxLineNo] */
        SELECT NVL(max(A.ETC_GR_DOC_LINE_NO),0) + 1
          FROM DMSDB.PT_0622T A    --기타입고부품정보
         WHERE A.DLR_CD             = #{dlrCd}                 --딜러코드
           AND A.ETC_GR_DOC_NO      = #{grDocNo}
    </select>

    <!-- 송장 헤더 수정일자정보를 조회한다. -->
    <select id="selectInvcUpdtDtByKey" parameterType="InvcVO" resultType="String">
        /* [chn.bhmc.dms.par.pcm.service.dao.InvcDAO.selectInvcUpdtDtByKey] */
        SELECT  TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
          FROM  DMSDB.PT_0431T A    --송장헤더정보
         WHERE  A.DLR_CD             = #{dlrCd}
           AND  A.INVC_DOC_NO        = #{grDocNo}    --송장번호
        UNION ALL
        SELECT  TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
          FROM  DMSDB.PT_0621T A    --기타입고헤더정보
         WHERE  A.DLR_CD             = #{dlrCd}
           AND  A.ETC_GR_DOC_NO      = #{grDocNo}    --입고번호
    </select>
    
    
    
    
    
    
    
    
    
    
    
    
    <!-- 电子发票/待入库清单的Excel导出  wangc 2021年5月12日20:15:51-->
    <select id="selectInvcsByConditionExcel" parameterType="InvcSearchVO" resultType="InvcExcelVO">
        select invc.*
        ,(select t.CMM_CD_NM from CM_0303T t where t.CMM_GRP_CD = 'PAR213' and t.CMM_CD=invc.INVC_STAT_CD) as INVC_STAT_CD_NM
        ,invcs.DLR_CD as SDLR_CD
        ,invcs.INVC_DOC_LINE_NO as SINVC_DOC_LINE_NO
        ,invcs.MOBIS_INVC_NO as SMOBIS_INVC_NO
        ,invcs.MOBIS_INVC_LINE_NO as SMOBIS_INVC_LINE_NO
        ,invcs.PURC_ORD_NO as SPURC_ORD_NO
        ,invcs.INVC_IF_ORD_NO as SINVC_IF_ORD_NO
        ,invcs.INVC_IF_ORD_LN as SINVC_IF_ORD_LN
        ,invcs.PURC_ORD_LINE_NO as SPURC_ORD_LINE_NO
        ,invcs.PURC_ORD_LINE_DETL_NO as SPURC_ORD_LINE_DETL_NO
        ,invcs.ITEM_CD as SITEM_CD
        ,invcs.ITEM_NM as SITEM_NM
        ,invcs.INVC_QTY as SINVC_QTY
        ,invcs.INVC_UNIT_CD as SINVC_UNIT_CD
        ,invcs.INVC_PRC as SINVC_PRC
        ,invcs.TAX_DDCT_PRC as STAX_DDCT_PRC
        ,invcs.INVC_AMT as SINVC_AMT
        ,invcs.VAT_AMT as SVAT_AMT
        ,invcs.INVC_TOT_AMT as SINVC_TOT_AMT
        ,invcs.PURC_REG_DT as SPURC_REG_DT
        ,(select t.CMM_CD_NM from CM_0303T t where t.CMM_GRP_CD = 'PAR203' and t.CMM_CD=invcs.PURC_ORD_TP) as SPURC_ORD_TP
        ,invcs.BP_CD as SBP_CD
        ,invcs.BP_NM as SBP_NM
        ,invcs.CLAIM_QTY as SCLAIM_QTY
        ,invcs.DEBIT_CREDIT_DSTIN_CD as SDEBIT_CREDIT_DSTIN_CD
        ,invcs.REF_INVC_DOC_NO as SREF_INVC_DOC_NO
        ,invcs.REF_INVC_DOC_LINE_NO as SREF_INVC_DOC_LINE_NO
        ,(select t.CMM_CD_NM from CM_0303T t where t.CMM_GRP_CD = 'PAR214' and t.CMM_CD=invcs.DL_PDC_CD) as SDL_PDC_CD
        ,invcs.GR_STRGE_CD as SGR_STRGE_CD
        ,invcs.GR_LOC_CD as SGR_LOC_CD
        ,invcs.INVC_GR_DT as SINVC_GR_DT
        ,invcs.REQ_CONT as SREQ_CONT
        ,invcs.AVLB_STOCK_QTY as SAVLB_STOCK_QTY
        ,invcs.BORROW_QTY as SBORROW_QTY
        ,invcs.RENT_QTY as SRENT_QTY
        ,invcs.RESV_STOCK_QTY as SRESV_STOCK_QTY
        ,invcs.STOCK_QTY as SSTOCK_QTY
        from (
        SELECT A.*
          FROM
            (
            SELECT   ROWNUM AS RNUM
                   , T1.*
              FROM (
                SELECT
                        A.DLR_CD               --딜러코드
                       ,A.INVC_DOC_NO          --송장문서번호
                       ,A.INVC_TP              --송장유형
                       ,A.INVC_DSTIN_CD        --송장구분코드
                       ,A.INVC_STAT_CD         --송장상태코드
                       ,A.INVC_DT              --송장일자
                       ,A.ARRV_DT              --도착일자
                       ,TO_CHAR(A.ARRV_DT, 'YYYYMMDD')  AS ARRV_DT_CHAR              --등록일자
                       ,TO_CHAR(A.ARRV_DT, 'HH24MISS')  AS ARRV_TM_CHAR              --등록일자
                       ,A.CONFIRM_DT           --확정일자
                       ,A.PLT_CD               --센터코드
                       ,D.PLT_NM               --센터명
                       ,A.BP_CD                --거래처코드
                       ,C.BP_NM                --거래처명
                       ,A.MOBIS_INVC_NO        --모비스송장번호
                       ,A.CURR_CD              --통화코드
                       ,E.INVC_TOT_AMT AS PURC_INC_TAX_AMT         --송장총금액
                       ,E.INVC_TOT_AMT         --송장총금액
                       ,A.VAT_CD               --부가세코드
                       ,A.VAT_AMT              --부가세금액
                       ,A.REMARK               --비고
                       ,A.CANC_YN              --취소여부
                       ,A.REG_USR_ID           --등록자ID
                       ,A.REG_DT               --등록일자
                       ,TO_CHAR(A.REG_DT, 'YYYYMMDD')  AS REG_DT_CHAR              --등록일자
                       ,A.UPDT_USR_ID          --수정자ID
                       ,A.UPDT_DT              --수정일자
                       ,A.IF_YN                --인터페이스여부
                       ,NVL(A.INVC_TOTAL_LINE, B.ITEM_CNT) AS INVC_TOTAL_LINE
                       ,NVL(A.INVC_SUM_QT, B.ITEM_QTY) AS INVC_SUM_QT
                       ,A.INVC_AMT_CUR
                       ,A.INVC_TSP_CODE
                       ,A.INVC_CSE_CNT
                       ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
                  FROM   DMSDB.PT_0431T A    --송장문서헤더정보
                            INNER JOIN (
                                    SELECT   A.DLR_CD
                                            ,A.INVC_DOC_NO
                                            ,COUNT(*) AS ITEM_CNT
                                            ,SUM(A.INVC_QTY) AS ITEM_QTY
                                            ,SUM(B.PURC_AMT + ROUND(B.PURC_AMT * FN_GET_VAT(TO_CHAR(NVL(A.INVC_GR_DT, A.REG_DT),'YYYYMMDD'),'ALL'),2) ) AS PURC_INC_TAX_AMT
                                            ,SUM(B.PURC_AMT) AS PURC_AMT
                                     FROM   DMSDB.PT_0432T A
                                              INNER JOIN DMSDB.PT_0422T B
                                                 ON A.DLR_CD           = B.DLR_CD
                                                AND A.PURC_ORD_NO      = B.PURC_ORD_NO
                                                AND A.PURC_ORD_LINE_NO = B.PURC_ORD_LINE_NO
                                                AND A.PURC_ORD_LINE_DETL_NO = B.PURC_ORD_LINE_DETL_NO
                                              INNER JOIN  DMSDB.PT_0201T C              --품목정보
                                                 ON A.DLR_CD  = C.DLR_CD
                                                AND A.ITEM_CD = C.ITEM_CD
                                    WHERE    (1 = 1)
                                    <if test='sItemCd != null and sItemCd != ""'>
                                        AND A.ITEM_CD = #{sItemCd}
                                    </if>        --부품번호
                                    <if test='sItemNm != null and sItemNm != ""'>
                                        AND C.ITEM_NM LIKE '%'|| #{sItemNm} ||'%'
                                    </if>
                                    <if test='sItemDstinCd != null and sItemDstinCd != ""'>
                                        AND C.ITEM_DSTIN_CD = #{sItemDstinCd}
                                    </if>
                                 GROUP BY   A.DLR_CD
                                           ,A.INVC_DOC_NO
                                 ) B
                               ON A.DLR_CD       = B.DLR_CD
                              AND A.INVC_DOC_NO  = B.INVC_DOC_NO
                           INNER JOIN DMSDB.PT_0211T C
                              ON A.DLR_CD = C.DLR_CD
                             AND A.BP_CD  = C.BP_CD
                           INNER JOIN DMSDB.CM_0103T D
                              ON A.DLR_CD  = D.DLR_CD
                             AND A.PLT_CD  = D.PLT_CD
                           INNER JOIN (
                                    SELECT   A.DLR_CD
                                            ,A.INVC_DOC_NO
                                            ,SUM(A.INVC_TOT_AMT) AS INVC_TOT_AMT
                                     FROM   DMSDB.PT_0432T A
                                    WHERE   A.DLR_CD   = #{sDlrCd}
                                    <if test='sMobisInvcNo != null and sMobisInvcNo != ""'>
                                       AND A.MOBIS_INVC_NO LIKE '%'||#{sMobisInvcNo}||'%'
                                   </if>        --모비스송장번호
                                 GROUP BY   A.DLR_CD
                                           ,A.INVC_DOC_NO
                                 ) E
                               ON A.DLR_CD       = E.DLR_CD
                              AND A.INVC_DOC_NO  = E.INVC_DOC_NO
                           INNER JOIN (
                                SELECT INR_DLR_CD
                                       ,INR_INV_NO
                                       ,MAX(INR_TOT_LN) AS INR_TOT_LN
                                  FROM PT_0433I
                              GROUP BY INR_DLR_CD, INR_INV_NO
                                   ) F
                                   ON A.DLR_CD = F.INR_DLR_CD
                                  AND A.MOBIS_INVC_NO = F.INR_INV_NO
                 WHERE   A.DLR_CD        = #{sDlrCd}
                   <if test='sInvcTp != null and sInvcTp != ""'>
                       AND A.INVC_TP       = #{sInvcTp}
                   </if>        --송장유형
                   <if test='sInvcStatCd != null and sInvcStatCd != ""'>
                       AND A.INVC_STAT_CD  = #{sInvcStatCd}
                   </if>        --송장상태코드
                   <if test='sInvcDtFr != null'>
                        <choose>
                            <otherwise>
                                 AND A.INVC_DT <![CDATA[>=]]> #{sInvcDtFr}
                            </otherwise>
                        </choose>
                    </if>
                    <if test='sInvcDtTo != null'>
                        <choose>
                            <otherwise>
                                 AND A.INVC_DT <![CDATA[<]]> #{sInvcDtTo} + 1
                            </otherwise>
                        </choose>
                    </if>
                   <if test='sConfirmDtFr != null'>
                        <choose>
                            <otherwise>
                                 AND A.CONFIRM_DT <![CDATA[>=]]> #{sConfirmDtFr}
                            </otherwise>
                        </choose>
                    </if>
                    <if test='sConfirmDtTo != null'>
                        <choose>
                            <otherwise>
                                 AND A.CONFIRM_DT <![CDATA[<=]]> #{sConfirmDtTo} + 1
                            </otherwise>
                        </choose>
                    </if>
                   <if test='sBpCd != null and sBpCd != ""'>
                       AND A.BP_CD = #{sBpCd}
                   </if>        --거래처코드
                   <if test='sMobisInvcNo != null and sMobisInvcNo != ""'>
                       AND A.MOBIS_INVC_NO LIKE '%'||#{sMobisInvcNo}||'%'
                   </if>        --모비스송장번호
                   <if test='sRegDtFr != null'>
                        <choose>
                            <otherwise>
                                 AND A.REG_DT <![CDATA[>=]]> #{sRegDtFr}
                            </otherwise>
                        </choose>
                    </if>
                    <if test='sRegDtTo != null'>
                        <choose>
                            <otherwise>
                                 AND A.REG_DT <![CDATA[<=]]> #{sRegDtTo} + 1
                            </otherwise>
                        </choose>
                    </if>
                    AND A.CANC_YN != 'Y'
                    AND (F.INR_TOT_LN IS NULL OR (B.ITEM_CNT <![CDATA[>=]]> F.INR_TOT_LN))
                 ORDER BY
                 <choose>
                     <when test='sort != null'>
                         <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                             <choose>
                                 <when test='item.field == "invcTp"'> A.INVC_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "invcStatCd"'> A.INVC_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "invcDt"'> A.INVC_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "arrvDt"'> A.ARRV_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "pltCd"'> A.PLT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "pltNm"'> D.PLT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "bpNm"'> C.BP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "mobisInvcNo"'> A.MOBIS_INVC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                 <when test='item.field == "invcTotAmt"'> A.INVC_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "vatCd"'> A.VAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "vatAmt"'> A.VAT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "remark"'> A.REMARK <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <when test='item.field == "regDt"'> A.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                 <otherwise>
                                   A.DLR_CD ASC
                                 ,A.INVC_DT DESC
                                 </otherwise>
                             </choose>
                         </foreach>
                     </when>
                     <otherwise>
                      A.DLR_CD ASC
                     ,A.INVC_DT DESC
                     </otherwise>
                 </choose>
                 ) T1
              ) A
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM <![CDATA[<=]]> #{lastIndex}
                AND RNUM <![CDATA[>]]> #{firstIndex}
                </if>
            </where>
            ) invc left join (
            SELECT   B.DLR_CD                          --딜러코드
                ,B.INVC_DOC_NO                     --송장문서번호
                ,B.INVC_DOC_LINE_NO                --송장문서라인번호
                ,B.MOBIS_INVC_NO                   --모비스송장번호
                ,B.MOBIS_INVC_LINE_NO              --모비스송장라인번호
                ,B.PURC_ORD_NO                     --구매오더번호
                ,B.INVC_IF_ORD_NO                  --I/F 구매오더번호
                ,B.INVC_IF_ORD_LN                  --I/F 구매오더라인번호
                ,B.PURC_ORD_LINE_NO                --구매오더라인번호
                ,B.PURC_ORD_LINE_DETL_NO          --구매오더라인구분자
                ,B.ITEM_CD                         --품목코드
                ,D.ITEM_NM                         --품목명
                ,B.INVC_QTY                        --송장수량
                ,B.INVC_UNIT_CD                    --송장단위코드
                ,B.INVC_PRC                        --송장단가
                ,B.TAX_DDCT_PRC                    --세금공제단가
                ,B.INVC_AMT                        --송장금액
                ,B.VAT_AMT                         --부가세금액
                ,B.INVC_TOT_AMT                    --송장총금액
                ,to_date(to_char(C.PURC_REG_DT,'yyyymmdd'),'yyyymmdd') AS PURC_REG_DT
                ,C.PURC_ORD_TP
                ,C.BP_CD
                ,E.BP_NM
                ,B.CLAIM_QTY                       --클레임 수량
                ,B.DEBIT_CREDIT_DSTIN_CD           --차변대변구분코드
                ,B.REF_INVC_DOC_NO                 --참조송장문서번호
                ,B.REF_INVC_DOC_LINE_NO            --참조송장문서라인번호
                ,B.DL_PDC_CD                       --배송PDC코드
                ,B.GR_STRGE_CD                     --입고창고코드
                ,B.GR_LOC_CD                       --입고위치코드
                ,B.INVC_GR_DT                      --송장입고일자
                ,B.REQ_CONT                        --차이사유
                ,NVL(F.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY           --가용재고
                ,NVL(F.BORROW_QTY,0) AS BORROW_QTY               --차입
                ,NVL(F.RENT_QTY,0) AS RENT_QTY                 --대여수량
                ,NVL(F.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY                 --예류수량
                ,NVL(F.AVLB_STOCK_QTY,0) + NVL(F.RESV_STOCK_QTY,0) - NVL(F.BORROW_QTY,0) + NVL(F.RENT_QTY,0) AS STOCK_QTY
          FROM  DMSDB.PT_0431T A                  --송장헤더정보
                  INNER JOIN  DMSDB.PT_0432T B    --송장품목정보
                     ON A.DLR_CD      = B.DLR_CD
                    AND A.INVC_DOC_NO = B.INVC_DOC_NO
                  INNER JOIN  DMSDB.PT_0421T C    --구매정보
                     ON B.DLR_CD           = C.DLR_CD
                    AND B.PURC_ORD_NO      = C.PURC_ORD_NO
                  INNER JOIN  DMSDB.PT_0201T D    --품목정보
                     ON B.DLR_CD  = D.DLR_CD
                    AND B.ITEM_CD = D.ITEM_CD
                   LEFT OUTER JOIN DMSDB.PT_0211T E
                     ON C.DLR_CD = E.DLR_CD
                    AND C.BP_CD  = E.BP_CD
                   LEFT OUTER JOIN PT_0301T F
                     ON D.DLR_CD        = F.DLR_CD
                    AND D.ITEM_CD       = F.ITEM_CD
                    AND D.GR_STRGE_CD   = F.STRGE_CD
            ) as invcs on invcs.DLR_CD = invc.DLR_CD and invcs.INVC_DOC_NO   = invc.INVC_DOC_NO
    </select>
</mapper>