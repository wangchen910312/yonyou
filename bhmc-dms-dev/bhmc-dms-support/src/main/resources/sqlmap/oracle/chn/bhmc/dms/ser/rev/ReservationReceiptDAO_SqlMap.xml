<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : ReservationReceiptDAO_SqlMap.xml
    Description : 예약접수에 관한 데이터처리
    author KyungMok Kim
    since 2016. 01. 19.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 01. 19.  KyungMok Kim     최초 생성
-->

<mapper namespace="chn.bhmc.dms.ser.rev.service.dao.ReservationReceiptDAO">

    <!-- 예약접수 등록. -->
    <insert id="insertReservationReceipt" parameterType="ReservationReceiptVO">
        /* [chn.bhmc.dms.ser.rev.service.dao.ReservationReceiptDAO.insertReservationReceipt] */
        INSERT INTO SE_0100T    --예약접수
        (
             RESV_DOC_NO                     --예약문서번호
            ,DLR_CD                          --딜러코드
            ,VIN_NO                          --차대번호
            ,CAR_REG_NO                      --차량등록번호
            ,ENGIN_NO                        --엔진시리얼번호
            ,CAR_OWNER_ID                    --차량소유자ID
            ,CAR_OWNER_NM                    --차량소유자명
            ,DRIVER_ID                       --운전자ID
            ,DRIVER_NM                       --운전자명
            ,RESV_TP                         --예약유형
            ,RESV_DT                         --예약일자
            ,BAY_NO                          --베이번호
            ,TEC_ID                          --TECMANID
            ,TEC_NM                          --TECMAN명
            ,SA_ID                           --SAID
            ,SA_NM                           --SA명
            ,HOPE_RESV_DT                    --희망예약일자
            ,SER_RESV_START_DT               --서비스예약시작일자
            ,SER_RESV_END_DT                 --서비스예약종료일자
            ,PAR_AMT                         --부품금액
            ,LBR_AMT                         --공임금액
            ,ETC_AMT                         --기타금액
            ,DC_AMT                          --할인금액
            ,SUM_AMT                         --합계금액
            ,VAT_AMT                         --부가가치세금액
            ,TOT_AMT                         --총합금액
            ,BAL_AMT                         --예치금액
            ,RESV_STAT_CD                    --예약상태코드
            ,CUST_REMARK                     --고객비고
            ,CANC_REASON_CD                  --취소사유코드
            ,CANC_REASON_CONT                --취소사유내용
            ,DIST_UNIT_CD                    --거리단위코드
            ,REG_USR_ID                      --등록자ID
            ,REG_DT                          --등록일자
            ,VSIT_CAR_RECEIVE_DT             --방문차량수령일자
            ,VSIT_CAR_RECEIVE_IF_NM          --방문차량수령연계인명
            ,VSIT_CAR_RECEIVE_CINO_NO        --방문차량수령연락처번호
            ,VSIT_CAR_RECEIVE_ADDR_NM        --방문차량수령주소명
            ,CAR_RECEIVE_DT                  --차량수령일자
            ,VSIT_DL_IF_NM                   --방문인도연계인명
            ,VSIT_DL_CINO_NO                 --방문인도연락처번호
            ,VSIT_DL_ADDR_NM                 --방문인도주소명
            ,VSIT_DT                         --방문일자
            ,VSIT_IF_NM                      --방문연계인명
            ,VSIT_CINO_NO                    --방문연락처번호
            ,VSIT_ADDR_NM                    --방문주소명
            ,RESV_REMARK
            ,CAR_ID                          --CARID
        )
        VALUES
        (
             #{resvDocNo}              --예약문서번호
            ,#{dlrCd}                  --딜러코드
            ,#{vinNo}                  --차대번호
            ,#{carRegNo}               --차량등록번호
            ,#{enginNo}          --엔진시리얼번호
            ,#{carOwnerId}             --차량소유자ID
            ,#{carOwnerNm}             --차량소유자명
            ,#{driverId}               --운전자ID
            ,#{driverNm}               --운전자명
            ,#{resvTp}                 --예약유형
            ,SYSDATE
            ,#{bayNo}                  --베이번호
            ,#{tecId}                  --TECMANID
            ,#{tecNm}                  --TECMAN명
            ,#{saId}                   --SAID
            ,#{saNm}                   --SA명
            ,#{hopeResvDt}             --희망예약일자
            ,#{serResvStartDt}         --서비스예약시작일자
            ,#{serResvEndDt}           --서비스예약종료일자
            ,#{parAmt}                 --부품금액
            ,#{lbrAmt}                 --공임금액
            ,#{etcAmt}                 --기타금액
            ,#{dcAmt}                  --할인금액
            ,#{sumAmt}                 --합계금액
            ,#{vatAmt}                 --부가가치세금액
            ,#{totAmt}                 --총합금액
            ,#{balAmt}                 --예치금액
            ,#{resvStatCd}             --예약상태코드
            ,#{custRemark}             --고객비고
            ,#{cancReasonCd}           --취소사유코드
            ,#{cancReasonCont}         --취소사유내용
            ,#{distUnitCd}             --거리단위코드
            ,#{regUsrId}               --등록자ID
            ,SYSDATE                   --등록일자
            ,#{vsitCarReceiveDt}       --방문차량수령일자
            ,#{vsitCarReceiveIfNm}     --방문차량수령연계인명
            ,#{vsitCarReceiveCinoNo}   --방문차량수령연락처번호
            ,#{vsitCarReceiveAddrNm}   --방문차량수령주소명
            ,#{carReceiveDt}           --차량수령일자
            ,#{vsitDlIfNm}             --방문인도연계인명
            ,#{vsitDlCinoNo}           --방문인도연락처번호
            ,#{vsitDlAddrNm}           --방문인도주소명
            ,#{vsitDt}                 --방문일자
            ,#{vsitIfNm}               --방문연계인명
            ,#{vsitCinoNo}             --방문연락처번호
            ,#{vsitAddrNm}             --방문주소명
            ,#{resvRemark}
            ,#{carId}                  --CAR ID
        )
    </insert>

    <!-- 예약접수  수정. -->
    <update id="updateReservationReceipt" parameterType="ReservationReceiptVO">
        /* [chn.bhmc.dms.ser.rev.service.dao.ReservationReceiptDAO.updateReservationReceipt] */
        UPDATE SE_0100T
        SET UPDT_USR_ID      = #{updtUsrId}               --수정자ID
            ,UPDT_DT          = SYSDATE                   --수정일자
            <if test='resvStatCd == "I"'>
            ,CAR_ACCEPT_DT    = SYSDATE
            </if>
            <if test='vinNo != null and vinNo != ""'>
            ,VIN_NO           = #{vinNo}                  --차대번호
            </if>
            <if test='carRegNo != null and carRegNo != ""'>
            ,CAR_REG_NO       = #{carRegNo}               --차량등록번호
            </if>
            <if test='enginNo != null and enginNo != ""'>
            ,ENGIN_NO  = #{enginNo}          --엔진시리얼번호
            </if>
            <if test='carOwnerId != null and carOwnerId != ""'>
            ,CAR_OWNER_ID     = #{carOwnerId}             --차량소유자ID
            </if>
            <if test='carOwnerNm != null and carOwnerNm != ""'>
            ,CAR_OWNER_NM     = #{carOwnerNm}             --차량소유자명
            </if>
            <if test='driverId != null and driverId != ""'>
            ,DRIVER_ID        = #{driverId}               --운전자ID
            </if>
            <if test='driverNm != null and driverNm != ""'>
            ,DRIVER_NM        = #{driverNm}               --운전자명
            </if>
            <if test='resvTp != null and resvTp != ""'>
            ,RESV_TP          = #{resvTp}                 --예약유형
            </if>
            <if test='bayNo != null and bayNo != ""'>
            ,BAY_NO           = #{bayNo}                  --베이번호
            </if>
            <if test='tecId != null and tecId != ""'>
            ,TEC_ID           = #{tecId}                  --TECMANID
            </if>
            <if test='tecNm != null and tecNm != ""'>
            ,TEC_NM           = #{tecNm}                  --TECMAN명
            </if>
            <if test='saId != null and saId != ""'>
            ,SA_ID            = #{saId}                   --SAID
            </if>
            <if test='saNm != null and saNm != ""'>
            ,SA_NM            = #{saNm}                   --SA명
            </if>
            <if test='hopeResvDt != null'>
            ,HOPE_RESV_DT     = #{hopeResvDt}             --희망예약일자
            </if>
            <if test='serResvStartDt != null'>
            ,SER_RESV_START_DT = #{serResvStartDt}          --서비스예약시작일자
            </if>
            <if test='serResvEndDt != null'>
            ,SER_RESV_END_DT = #{serResvEndDt}              --서비스예약종료일자
            </if>
            <if test='parAmt != null and parAmt != ""'>
            ,PAR_AMT          = #{parAmt}                 --부품금액
            </if>
            <if test='lbrAmt != null and lbrAmt != ""'>
            ,LBR_AMT          = #{lbrAmt}                 --공임금액
            </if>
            <if test='etcAmt != null and etcAmt != ""'>
            ,ETC_AMT          = #{etcAmt}                 --기타금액
            </if>
            <if test='dcAmt != null and dcAmt != ""'>
            ,DC_AMT           = #{dcAmt}                  --할인금액
            </if>
            <if test='sumAmt != null and sumAmt != ""'>
            ,SUM_AMT          = #{sumAmt}                 --합계금액
            </if>
            <if test='vatAmt != null and vatAmt != ""'>
            ,VAT_AMT          = #{vatAmt}                 --부가가치세금액
            </if>
            <if test='totAmt != null and totAmt != ""'>
            ,TOT_AMT          = #{totAmt}                 --총합금액
            </if>
            <if test='balAmt != null and balAmt != ""'>
            ,BAL_AMT          = #{balAmt}                 --예치금액
            </if>
            <if test='resvStatCd != null and resvStatCd != ""'>
            ,RESV_STAT_CD     = #{resvStatCd}             --예약상태코드
            </if>
            <if test='custRemark != null and custRemark != ""'>
            ,CUST_REMARK      = #{custRemark}             --고객의견
            </if>
            <if test='cancReasonCd != null and cancReasonCd != ""'>
            ,CANC_REASON_CD   = #{cancReasonCd}           --취소사유코드
            </if>
            <if test='cancReasonCont != null and cancReasonCont != ""'>
            ,CANC_REASON_CONT = #{cancReasonCont}         --취소사유내용
            </if>
            <if test='distUnitCd != null and distUnitCd != ""'>
            ,DIST_UNIT_CD     = #{distUnitCd}             --거리단위코드
            </if>
            <if test='vsitCarReceiveDt != null'>
            ,VSIT_CAR_RECEIVE_DT      = #{vsitCarReceiveDt}               --방문차량수령일자
            </if>
            <if test='vsitCarReceiveIfNm != null and vsitCarReceiveIfNm != ""'>
            ,VSIT_CAR_RECEIVE_IF_NM   = #{vsitCarReceiveIfNm}             --방문차량수령연계인명
            </if>
            <if test='vsitCarReceiveCinoNo != null and vsitCarReceiveCinoNo != ""'>
            ,VSIT_CAR_RECEIVE_CINO_NO = #{vsitCarReceiveCinoNo}           --방문차량수령연락처번호
            </if>
            <if test='vsitCarReceiveAddrNm != null and vsitCarReceiveAddrNm != ""'>
            ,VSIT_CAR_RECEIVE_ADDR_NM = #{vsitCarReceiveAddrNm}           --방문차량수령주소명
            </if>
            <if test='carReceiveDt != null'>
            ,CAR_RECEIVE_DT           = #{carReceiveDt}                   --차량수령일자
            </if>
            <if test='vsitDlIfNm != null and vsitDlIfNm != ""'>
            ,VSIT_DL_IF_NM            = #{vsitDlIfNm}                     --방문인도연계인명
            </if>
            <if test='vsitDlCinoNo != null and vsitDlCinoNo != ""'>
            ,VSIT_DL_CINO_NO          = #{vsitDlCinoNo}                   --방문인도연락처번호
            </if>
            <if test='vsitDlAddrNm != null and vsitDlAddrNm != ""'>
            ,VSIT_DL_ADDR_NM          = #{vsitDlAddrNm}                   --방문인도주소명
            </if>
            <if test='vsitDt != null'>
            ,VSIT_DT                  = #{vsitDt}                         --방문일자
            </if>
            <if test='vsitIfNm != null and vsitIfNm != ""'>
            ,VSIT_IF_NM               = #{vsitIfNm}                       --방문연계인명
            </if>
            <if test='vsitCinoNo != null and vsitCinoNo != ""'>
            ,VSIT_CINO_NO             = #{vsitCinoNo}                     --방문연락처번호
            </if>
            <if test='vsitAddrNm != null and vsitAddrNm != ""'>
            ,VSIT_ADDR_NM             = #{vsitAddrNm}                     --방문주소명
            </if>
            <if test='roGrpNo != null and roGrpNo != ""'>
            ,RO_GRP_NO = #{roGrpNo}
            </if>
            <if test='resvRemark != null and resvRemark != ""'>
            ,RESV_REMARK = #{resvRemark}                     --예약서비스비고
            </if>
            <if test='receivePrsnNm != null and receivePrsnNm != ""'>
            ,RECEIVE_PRSN_NM = #{receivePrsnNm}                     --수령담당자명
            </if>
            <if test='receiveMoveDt != null'>
            ,RECEIVE_MOVE_DT = #{receiveMoveDt}                     --수령출동일자
            </if>
            <if test='receiveMoveRunDistVal != null and receiveMoveRunDistVal != ""'>
            ,RECEIVE_MOVE_RUN_DIST_VAL = #{receiveMoveRunDistVal}
            </if>
            <if test='receiveCarReturnDt != null'>
            ,RECEIVE_CAR_RETURN_DT = #{receiveCarReturnDt}
            </if>
            <if test='receiveReturnRunDistVal != null and receiveReturnRunDistVal != ""'>
            ,RECEIVE_RETURN_RUN_DIST_VAL = #{receiveReturnRunDistVal}
            </if>
            <if test='dlPrsnNm != null and dlPrsnNm != ""'>
            ,DL_PRSN_NM = #{dlPrsnNm}
            </if>
            <if test='dlMoveDt != null'>
            ,DL_MOVE_DT = #{dlMoveDt}
            </if>
            <if test='dlMoveRunDistVal != null and dlMoveRunDistVal != ""'>
            ,DL_MOVE_RUN_DIST_VAL = #{dlMoveRunDistVal}
            </if>
            <if test='dlCarReturnDt != null'>
            ,DL_CAR_RETURN_DT = #{dlCarReturnDt}
            </if>
            <if test='dlReturnRunDistVal != null and dlReturnRunDistVal != ""'>
            ,DL_RETURN_RUN_DIST_VAL = #{dlReturnRunDistVal}
            </if>
            <if test='vsitSerRemark != null and vsitSerRemark != ""'>
            ,VSIT_SER_REMARK = #{vsitSerRemark}
            </if>
            <if test='siteArrvDt != null'>
            ,SITE_ARRV_DT = #{siteArrvDt}
            </if>
            <if test='siteStartDt != null'>
            ,SITE_START_DT = #{siteStartDt}
            </if>
            <if test='serReturnDt != null'>
            ,SER_RETURN_DT = #{serReturnDt}
            </if>
            <if test='vsitSerTp != null and vsitSerTp != ""'>
            ,VSIT_SER_TP = #{vsitSerTp}
            </if>
            <if test='vsitSerCarId != null and vsitSerCarId != ""'>
            ,VSIT_SER_CAR_ID = #{vsitSerCarId}
            </if>
            <if test='vsitSerCarNm != null and vsitSerCarNm != ""'>
            ,VSIT_SER_CAR_NM = #{vsitSerCarNm}
            </if>
            <if test='vsitMoveRunDistVal != null and vsitMoveRunDistVal != ""'>
            ,VSIT_MOVE_RUN_DIST_VAL = #{vsitMoveRunDistVal}
            </if>
            <if test='vsitReturnRunDistVal != null and vsitReturnRunDistVal != ""'>
            ,VSIT_RETURN_RUN_DIST_VAL = #{vsitReturnRunDistVal}
            </if>
            <if test='dlSerRemark != null and dlSerRemark != ""'>
            ,DL_SER_REMARK = #{dlSerRemark}
            </if>
            <if test='printYn == "Y"'>
            ,RESV_PRINT_DT = SYSDATE
            </if>
            <if test='resvSerAlramCd != null and resvSerAlramCd != ""'>
            ,RESV_ALRAM_DT = SYSDATE
            ,RESV_ALRAM_USR_ID = #{resvAlramUsrId}
            ,RESV_ALRAM_USR_NM = #{resvAlramUsrNm}
            </if>
         WHERE RESV_DOC_NO = #{resvDocNo}   --예약문서번호
           AND DLR_CD      = #{dlrCd}       --딜러코드
    </update>

    <!-- 예약접수  수정 BY VIN_NO. -->
    <update id="updateReservationReceiptByVinNo" parameterType="ReservationReceiptVO">
        /* [chn.bhmc.dms.ser.rev.service.dao.ReservationReceiptDAO.updateReservationReceiptByVinNo] */
        UPDATE SE_0100T
        SET UPDT_USR_ID      = #{updtUsrId}               --수정자ID
            ,UPDT_DT          = SYSDATE                   --수정일자
            <if test='resvStatCd == "I"'>
            ,CAR_ACCEPT_DT    = SYSDATE
            </if>
            <if test='resvStatCd != null and resvStatCd != ""'>
            ,RESV_STAT_CD     = #{resvStatCd}             --예약상태코드
            </if>
            <if test='carReceiveDt != null'>
            ,CAR_RECEIVE_DT           = #{carReceiveDt}                   --차량수령일자
            </if>
         WHERE VIN_NO = #{vinNo}
         AND RESV_DOC_NO = (SELECT MAX(RESV_DOC_NO) FROM SE_0100T)
    </update>

    <delete id="deleteReservationReceipt" parameterType="String">
        /* [chn.bhmc.dms.ser.rev.service.dao.ReservationReceiptDAO.deleteReservationReceipt] */
        DELETE FROM SE_0100T
         WHERE DLR_CD = #{dlrCd}
           AND RESV_DOC_NO = #{resvDocNo}
    </delete>

    <!-- 예약접수 목록 조회. -->
    <select id="selectReservationReceiptByCondition" parameterType="ReservationReceiptSearchVO" resultType="ReservationReceiptVO">
        /* [chn.bhmc.dms.ser.rev.service.dao.ReservationReceiptDAO.selectReservationReceiptByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM
                  ,T1.*
               FROM (
                SELECT
                     A.RESV_DOC_NO
                    ,A.DLR_CD
                    ,A.VIN_NO
                    ,A.CAR_REG_NO
                    ,A.ENGIN_NO
                    ,A.CAR_OWNER_ID
                    ,A.CAR_OWNER_NM
                    ,A.DRIVER_ID
                    ,A.DRIVER_NM
                    ,A.RESV_TP
                    ,FN_CMM_CD_NM('SER013',A.RESV_TP, #{sLangCd} , 'N') AS RESV_TP_NM
                    ,A.RESV_STAT_CD
                    ,A.RESV_DT
                    ,A.BAY_NO
                    ,A.TEC_ID
                    ,A.TEC_NM
                    ,A.SA_ID
                    ,A.SA_NM
                    ,A.HOPE_RESV_DT
                    ,A.SER_RESV_START_DT
                    ,A.SER_RESV_END_DT
                    ,A.VAT_AMT
                    ,A.BAL_AMT
                    ,A.RESV_STAT_CD
                    ,A.CUST_REMARK
                    ,A.CANC_REASON_CD
                    ,A.CANC_REASON_CONT
                    ,A.DIST_UNIT_CD
                    ,A.REG_USR_ID
                    ,A.REG_DT
                    ,A.UPDT_USR_ID
                    ,A.UPDT_DT
                    ,A.RO_GRP_NO
                    ,A.CAR_ACCEPT_DT
                    ,A.RESV_REMARK
                    ,A.RECEIVE_PRSN_NM
                    ,A.RECEIVE_MOVE_DT
                    ,A.RECEIVE_MOVE_RUN_DIST_VAL
                    ,A.RECEIVE_CAR_RETURN_DT
                    ,A.RECEIVE_RETURN_RUN_DIST_VAL
                    ,A.DL_PRSN_NM
                    ,A.DL_MOVE_DT
                    ,A.DL_MOVE_RUN_DIST_VAL
                    ,A.DL_CAR_RETURN_DT
                    ,A.DL_RETURN_RUN_DIST_VAL
                    ,A.VSIT_SER_REMARK
                    ,A.SITE_ARRV_DT
                    ,A.SITE_START_DT
                    ,A.SER_RETURN_DT
                    ,A.VSIT_SER_TP
                    ,A.VSIT_SER_CAR_ID
                    ,A.VSIT_SER_CAR_NM
                    ,A.VSIT_MOVE_RUN_DIST_VAL
                    ,A.VSIT_RETURN_RUN_DIST_VAL
                    ,A.DL_SER_REMARK
                    ,A.CAR_ID
                    ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                    ,fn_ser_res_board_value(A.CAR_REG_NO) AS KANBAN_STAT
                    ,A.RESV_PRINT_DT
                FROM SE_0100T A
               WHERE A.DLR_CD = #{sDlrCd}
                    <!-- jhlim 임시 -->
                    <if test='sBayNo != null and sBayNo != ""'>
                        AND A.BAY_NO = #{sBayNo}
                    </if>
                    <if test='sResvTp != null and sResvTp != ""'>
                        AND A.RESV_TP = #{sResvTp}
                    </if>
                    <if test='sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>
                    <if test='sDriverNm != null and sDriverNm != ""'>
                        AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                    </if>
                    <if test='sCarRegNo != null and sCarRegNo != ""'>
                        AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                    </if>
                    <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                        AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                    </if>
                    <if test='sResvDocNo != null and sResvDocNo != ""'>
                        AND A.RESV_DOC_NO LIKE '%'||#{sResvDocNo}||'%'
                    </if>
                    <if test='sSerResvStartDt != null'>
                        AND A.SER_RESV_START_DT <![CDATA[>=]]> #{sSerResvStartDt}
                    </if>
                    <if test='sSerResvStartFromDt != null'>
                        AND A.SER_RESV_START_DT <![CDATA[>=]]> #{sSerResvStartFromDt}
                    </if>
                    <if test='sSerResvStartToDt != null'>
                        AND A.SER_RESV_START_DT <![CDATA[<=]]> #{sSerResvStartToDt} + 1
                    </if>
                    <if test='sResvFromDt != null'>
                        AND A.RESV_DT <![CDATA[>=]]> #{sResvFromDt}
                    </if>
                    <if test='sResvToDt != null'>
                        AND A.RESV_DT <![CDATA[<=]]> #{sResvToDt} + 1
                    </if>
                    <if test='sListType != null and sListType != ""'>
                        <choose>
                            <when test='sResvStatCd != null and sResvStatCd != ""'>
                                AND A.RESV_STAT_CD = #{sResvStatCd}
                            </when>
                            <otherwise>
                                <if test='sListType == "02"'>
                                    AND A.RESV_STAT_CD != 'C'
                                </if>
                                <if test='sListType == "03"'>
                                    AND A.RESV_STAT_CD NOT IN('F', 'C' ,'S')
                                </if>
                            </otherwise>
                        </choose>
                    </if>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "resvDocNo"'>                  A.RESV_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                </when>
                                <when test='item.field == "dlrCd"'>                      A.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                     </when>
                                <when test='item.field == "vinNo"'>                      A.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                     </when>
                                <when test='item.field == "carRegNo"'>                   A.CAR_REG_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                 </when>
                                <when test='item.field == "enginNo"'>                    A.ENGIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                   </when>
                                <when test='item.field == "carOwnerId"'>                 A.CAR_OWNER_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                <when test='item.field == "carOwnerNm"'>                 A.CAR_OWNER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                <when test='item.field == "driverId"'>                   A.DRIVER_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                  </when>
                                <when test='item.field == "driverNm"'>                   A.DRIVER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                  </when>
                                <when test='item.field == "resvTp"'>                     A.RESV_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                    </when>
                                <when test='item.field == "resvDt"'>                     A.RESV_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                    </when>
                                <when test='item.field == "bayNo"'>                      A.BAY_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                     </when>
                                <when test='item.field == "tecId"'>                      A.TEC_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                     </when>
                                <when test='item.field == "tecNm"'>                      A.TEC_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                     </when>
                                <when test='item.field == "saId"'>                       A.SA_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                      </when>
                                <when test='item.field == "saNm"'>                       A.SA_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                      </when>
                                <when test='item.field == "hopeResvDt"'>                 A.HOPE_RESV_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                <when test='item.field == "serResvStartDt"'>             A.SER_RESV_START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                <when test='item.field == "resvStatCd"'>                 A.RESV_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                <when test='item.field == "serResvEndDt"'>               A.SER_RESV_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "roGrpNo"'>                    A.RO_GRP_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                  </when>
                                <when test='item.field == "resvRemark"'>                 A.RESV_REMARK <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                </when>
                                <when test='item.field == "receivePrsnNm"'>              A.RECEIVE_PRSN_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "receiveMoveDt"'>              A.RECEIVE_MOVE_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "siteArrvDt"'>                 A.SITE_ARRV_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                <when test='item.field == "siteStartDt"'>                A.SITE_START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                <when test='item.field == "serReturnDt"'>                A.SER_RETURN_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                <when test='item.field == "dlSerRemark"'>                A.DL_SER_REMARK <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                <when test='item.field == "resvReptStatCd"'>             A.RESV_REPT_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                            <otherwise>
                            ,A.RESV_DOC_NO DESC
                            ,A.DLR_CD ASC
                            </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                    A.RESV_DOC_NO DESC
                    ,A.DLR_CD ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 예약접수 목록수를 조회. -->
    <select id="selectReservationReceiptByConditionCnt" parameterType="ReservationReceiptSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.rev.service.dao.ReservationReceiptDAO.selectReservationReceiptByConditionCnt] */

          SELECT COUNT(T.RESV_DOC_NO) AS VALUE
            FROM SE_0100T T
           WHERE T.DLR_CD = #{sDlrCd}
            <!-- jhlim 임시 -->
            <if test='sBayNo != null and sBayNo != ""'>
                AND T.BAY_NO = #{sBayNo}
            </if>
            <if test='sDlrCd != null and sDlrCd != ""'>
            </if>
            <if test='sResvTp != null and sResvTp != ""'>
                AND T.RESV_TP = #{sResvTp}
            </if>
            <if test='sVinNo != null and sVinNo != ""'>
                AND T.VIN_NO LIKE '%'||#{sVinNo}||'%'
            </if>
            <if test='sDriverNm != null and sDriverNm != ""'>
                AND T.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
            </if>
            <if test='sCarRegNo != null and sCarRegNo != ""'>
                AND T.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
            </if>
            <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                AND T.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
            </if>
            <if test='sResvDocNo != null and sResvDocNo != ""'>
                AND T.RESV_DOC_NO LIKE '%'||#{sResvDocNo}||'%'
            </if>
            <if test='sSerResvStartDt != null'>
                AND T.SER_RESV_START_DT <![CDATA[>=]]> #{sSerResvStartDt}
            </if>
            <if test='sSerResvStartFromDt != null'>
                AND T.SER_RESV_START_DT <![CDATA[>=]]> #{sSerResvStartFromDt}
            </if>
            <if test='sSerResvStartToDt != null'>
                AND T.SER_RESV_START_DT <![CDATA[<=]]> #{sSerResvStartToDt} + 1
            </if>
            <if test='sResvFromDt != null'>
                AND T.RESV_DT <![CDATA[>=]]> #{sResvFromDt}
            </if>
            <if test='sResvToDt != null'>
                AND T.RESV_DT <![CDATA[<=]]> #{sResvToDt} + 1
            </if>
            <if test='sListType != null and sListType != ""'>
                <choose>
                    <when test='sResvStatCd != null and sResvStatCd != ""'>
                        AND T.RESV_STAT_CD = #{sResvStatCd}
                    </when>
                    <otherwise>
                        <if test='sListType == "02"'>
                            AND T.RESV_STAT_CD != 'C'
                        </if>
                        <if test='sListType == "03"'>
                            AND T.RESV_STAT_CD NOT IN('F', 'C','S')
                        </if>
                    </otherwise>
                </choose>
            </if>
    </select>

     <!-- 예약접수 목록 조회. -->
    <select id="selectReservationReceiptListByCondition" parameterType="ReservationReceiptSearchVO" resultType="ReservationReceiptVO">
        /* [chn.bhmc.dms.ser.rev.service.dao.ReservationReceiptDAO.selectReservationReceiptListByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM
                   ,T2.* FROM (
                SELECT T1.*
                       ,T1.LBR_DC + T1.PAR_DC AS DC_AMT
                       ,T1.PAR_AMT + T1.LBR_AMT + T1.ETC_AMT AS SUM_AMT
                   FROM (
                    SELECT
                         A.RESV_DOC_NO
                        ,A.DLR_CD
                        ,A.VIN_NO
                        ,A.CAR_REG_NO
                        ,A.ENGIN_NO
                        ,A.CAR_OWNER_ID
                        ,A.CAR_OWNER_NM
                        ,A.DRIVER_ID
                        ,A.DRIVER_NM
                        ,(SELECT HP_NO FROM CR_0101T WHERE CUST_NO = A.DRIVER_ID) AS DRIVER_HP_NO
                        ,A.RESV_TP
                        ,FN_CMM_CD_NM('SER013',A.RESV_TP, #{sLangCd} , 'N') AS RESV_TP_NM
                        ,A.RESV_DT
                        ,A.BAY_NO
                        ,A.TEC_ID
                        ,A.TEC_NM
                        ,A.SA_ID
                        ,A.SA_NM
                        ,A.HOPE_RESV_DT
                        ,A.SER_RESV_START_DT
                        ,A.SER_RESV_END_DT
                        ,(
                          SELECT NVL(SUM(ITEM_TOT_AMT),0)
                            FROM SE_0160T
                           WHERE DLR_CD = A.DLR_CD
                             AND DOC_NO = A.RESV_DOC_NO
                             AND PREFIX_ID = #{sPreFixId}
                         )AS PAR_AMT
                        ,(
                          SELECT NVL(SUM(LBR_TOT_AMT),0)
                            FROM SE_0170T
                           WHERE DLR_CD = A.DLR_CD
                             AND DOC_NO = A.RESV_DOC_NO
                             AND PREFIX_ID = #{sPreFixId}
                         ) AS LBR_AMT
                        ,(
                          SELECT NVL(SUM(ETC_REQ_PRC),0)
                            FROM SE_0140T
                           WHERE DLR_CD = A.DLR_CD
                             AND JOB_NO = A.RESV_DOC_NO
                             AND PREFIX_ID = #{sPreFixId}
                         ) AS ETC_AMT
                         ,(
                          SELECT NVL(SUM(DC_AMT),0)
                            FROM SE_0160T
                           WHERE DLR_CD = A.DLR_CD
                             AND DOC_NO = A.RESV_DOC_NO
                             AND PREFIX_ID = #{sPreFixId}
                         )AS PAR_DC
                         ,(
                          SELECT NVL(SUM(DC_AMT),0)
                            FROM SE_0170T
                           WHERE DLR_CD = A.DLR_CD
                             AND DOC_NO = A.RESV_DOC_NO
                             AND PREFIX_ID = #{sPreFixId}
                         )AS LBR_DC
                        ,A.VAT_AMT
                        ,A.BAL_AMT
                        ,A.RESV_STAT_CD
                        ,FN_CMM_CD_NM('SER011',A.RESV_STAT_CD, #{sLangCd} , 'N') AS RESV_STAT_CD_NM
                        ,A.CUST_REMARK
                        ,A.CANC_REASON_CD
                        ,A.CANC_REASON_CONT
                        ,A.DIST_UNIT_CD
                        ,A.REG_USR_ID
                        ,A.REG_DT
                        ,A.UPDT_USR_ID
                        ,A.UPDT_DT
                        ,A.RO_GRP_NO
                        ,A.CAR_ACCEPT_DT
                        ,CASE WHEN (A.SER_RESV_END_DT <![CDATA[>=]]> SYSDATE AND A.RESV_STAT_CD = 'O')  THEN '05'
                             WHEN (A.RESV_STAT_CD = 'F' AND A.SER_RESV_END_DT <![CDATA[>=]]> A.CAR_ACCEPT_DT) THEN '01'
                             WHEN (A.RESV_STAT_CD = 'F' AND A.SER_RESV_END_DT <![CDATA[<]]> A.CAR_ACCEPT_DT) THEN '02'
                             WHEN (A.SER_RESV_END_DT <![CDATA[<]]> SYSDATE AND A.RESV_STAT_CD = 'O') THEN '03'
                             WHEN A.RESV_STAT_CD = 'C' THEN '04'
                             END AS RESV_REPT_STAT_CD
                        ,A.RESV_REMARK
                        ,A.RECEIVE_PRSN_NM
                        ,A.RECEIVE_MOVE_DT
                        ,A.RECEIVE_MOVE_RUN_DIST_VAL
                        ,A.RECEIVE_CAR_RETURN_DT
                        ,A.RECEIVE_RETURN_RUN_DIST_VAL
                        ,A.DL_PRSN_NM
                        ,A.DL_MOVE_DT
                        ,A.DL_MOVE_RUN_DIST_VAL
                        ,A.DL_CAR_RETURN_DT
                        ,A.DL_RETURN_RUN_DIST_VAL
                        ,A.VSIT_SER_REMARK
                        ,A.SITE_ARRV_DT
                        ,A.SITE_START_DT
                        ,A.SER_RETURN_DT
                        ,A.VSIT_SER_TP
                        ,A.VSIT_SER_CAR_ID
                        ,A.VSIT_SER_CAR_NM
                        ,A.VSIT_MOVE_RUN_DIST_VAL
                        ,A.VSIT_RETURN_RUN_DIST_VAL
                        ,A.DL_SER_REMARK
                        ,A.CAR_ID
                        ,(SELECT BAY_NM FROM SE_1012T WHERE BAY_NO = A.BAY_NO AND DLR_CD = #{sDlrCd}) AS BAY_NM
                        ,(SELECT NVL(CAR_RUN_DIST_VAL,0) FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CAR_RUN_DIST_VAL
                        ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                        ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                        ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                        ,CASE WHEN A.UPDT_USR_ID = 'FMS' THEN '蓝缤APP' 
                           ELSE  (SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) END UPDT_USR_NM
                        ,CASE WHEN RESV_STAT_CD = 'C' THEN A.UPDT_DT  END AS CANC_RESV_DT
                        ,CASE WHEN RESV_STAT_CD = 'C'
                         THEN 
                            CASE WHEN A.UPDT_USR_ID = 'FMS' THEN '蓝缤APP'
                            ELSE (SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) END
                         END AS CANC_USR_NM
                        ,CASE WHEN RESV_STAT_CD = 'F' THEN A.UPDT_DT  END AS CONFIRM_DT
                        ,CASE WHEN RESV_STAT_CD = 'F' THEN (SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) END AS CONFIRM_USR_NM
                        ,A.RESV_PRINT_DT
                        ,A.RESV_ALRAM_DT
                        ,A.RESV_ALRAM_USR_ID
                        ,A.RESV_ALRAM_USR_NM
                    FROM SE_0100T A
                    <where>
                        <!-- jhlim 임시 -->
                        <if test='sBayNo != null and sBayNo != ""'>
                            AND A.BAY_NO = #{sBayNo}
                        </if>
                        <if test='sDlrCd != null and sDlrCd != ""'>
                            AND A.DLR_CD = #{sDlrCd}
                        </if>
                        <if test='sResvTp != null and sResvTp != ""'>
                            AND A.RESV_TP = #{sResvTp}
                        </if>
                        <if test='sVinNo != null and sVinNo != ""'>
                            AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                        </if>
                        <if test='sDriverNm != null and sDriverNm != ""'>
                            AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                        </if>
                        <if test='sCarRegNo != null and sCarRegNo != ""'>
                            AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                        </if>
                        <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                            AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                        </if>
                        <if test='sResvDocNo != null and sResvDocNo != ""'>
                            AND A.RESV_DOC_NO LIKE '%'||#{sResvDocNo}||'%'
                        </if>
                        <if test='sSerResvStartDt != null'>
                            AND A.SER_RESV_START_DT <![CDATA[>=]]> #{sSerResvStartDt}
                        </if>
                        <if test='sSerResvStartFromDt != null'>
                            AND A.SER_RESV_START_DT <![CDATA[>=]]> #{sSerResvStartFromDt}
                        </if>
                        <if test='sSerResvStartToDt != null'>
                            AND A.SER_RESV_START_DT <![CDATA[<=]]> #{sSerResvStartToDt} + 1
                        </if>
                        <if test='sResvFromDt != null'>
                            AND A.RESV_DT <![CDATA[>=]]> #{sResvFromDt}
                        </if>
                        <if test='sResvToDt != null'>
                            AND A.RESV_DT <![CDATA[<=]]> #{sResvToDt} + 1
                        </if>
                        <if test='sRegFromDt != null'>
                            AND A.REG_DT <![CDATA[>=]]> #{sRegFromDt}
                        </if>
                        <if test='sRegToDt != null'>
                            AND A.REG_DT <![CDATA[<=]]> #{sRegToDt} + 1
                        </if>
                        <if test='sResvStatCd != null and sResvStatCd != "" '>
                            AND A.RESV_STAT_CD = #{sResvStatCd}
                        </if>
                    </where>

                ) T1
                <where>
                    <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                        T1.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
                    </if>
                    <if test='sBayNm != null and sBayNm != ""'>
                        AND T1.BAY_NM LIKE '%'||#{sBayNm}||'%'
                    </if>
                    <if test='sRresvReptStatCd != null and sRresvReptStatCd != ""'>
                        AND T1.RESV_REPT_STAT_CD = #{sRresvReptStatCd}
                    </if>
                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "carRegNo"'>                   T1.CAR_REG_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                 </when>
                                <when test='item.field == "vinNo"'>                      T1.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                     </when>
                                <when test='item.field == "resvDocNo"'>                  T1.RESV_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                </when>
                                <when test='item.field == "carOwnerNm"'>                 T1.CAR_OWNER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                <when test='item.field == "driverNm"'>                   T1.DRIVER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                  </when>
                                <when test='item.field == "carlineNm"'>                  T1.CARLINE_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                 </when>
                                <when test='item.field == "modelNm"'>                    T1.MODEL_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                   </when>
                                <when test='item.field == "carRunDistVal"'>              T1.CAR_RUN_DIST_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                <when test='item.field == "resvStatCdNm"'>               T1.RESV_STAT_CD_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                                <when test='item.field == "resvDocNo"'>                  T1.RESV_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                </when>
                                <when test='item.field == "resvTpNm"'>                   T1.RESV_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                 </when>
                                <when test='item.field == "resvDtFormat"'>               T1.RESV_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                    </when>
                                <when test='item.field == "regUsrNm"'>                   T1.REG_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                 </when>
                                <when test='item.field == "resvPrintDtFormat"'>          T1.RESV_PRINT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                <when test='item.field == "updtDtFormat"'>               T1.UPDT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                    </when>
                                <when test='item.field == "updtUsrNm"'>                  T1.UPDT_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                </when>
                                <when test='item.field == "cancResvDtFormat"'>           T1.CANC_RESV_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                <when test='item.field == "cancUsrNm"'>                  T1.CANC_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                </when>
                                <when test='item.field == "cancReasonCont"'>             T1.CANC_REASON_CONT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                                <when test='item.field == "hopeResvDtFormat"'>           T1.HOPE_RESV_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>               </when>
                                <when test='item.field == "serResvStartDtFormat"'>       T1.SER_RESV_START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                <when test='item.field == "confirmDtFormat"'>            T1.CONFIRM_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                 </when>
                                <when test='item.field == "confirmUsrNm"'>               T1.CONFIRM_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>             </when>
                                <when test='item.field == "resvRemark"'>                 T1.RESV_REMARK <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                </when>
                                <when test='item.field == "saNm"'>                       T1.SA_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                      </when>
                                <when test='item.field == "tecNm"'>                      T1.TEC_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                     </when>
                                <when test='item.field == "lbrAmt"'>                     T1.LBR_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                    </when>
                                <when test='item.field == "parAmt"'>                     T1.PAR_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                    </when>
                                <when test='item.field == "etcAmt"'>                     T1.ETC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                    </when>
                                <when test='item.field == "sumAmt"'>                     SUM_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>                       </when>
                                <when test='item.field == "resvAlramDtFormat"'>          T1.RESV_ALRAM_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>              </when>
                                <when test='item.field == "resvAlramUsrNm"'>             T1.RESV_ALRAM_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                            <otherwise>
                             T1.RESV_DOC_NO DESC
                            ,T1.DLR_CD ASC
                            </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                     T1.RESV_DOC_NO DESC
                    ,T1.DLR_CD ASC
                    </otherwise>
                </choose>
            ) T2
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        ) T3
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 예약접수 목록수를 조회. -->
    <select id="selectReservationReceiptListByConditionCnt" parameterType="ReservationReceiptSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.rev.service.dao.ReservationReceiptDAO.selectReservationReceiptListByConditionCnt] */

       SELECT COUNT(RESV_DOC_NO) AS VALUE
         FROM(
             SELECT A.RESV_DOC_NO
                   ,CASE WHEN (A.SER_RESV_END_DT <![CDATA[>=]]> SYSDATE AND A.RESV_STAT_CD = 'O')  THEN '05'
                         WHEN (A.RESV_STAT_CD = 'F' AND A.SER_RESV_END_DT <![CDATA[>=]]> A.CAR_ACCEPT_DT) THEN '01'
                         WHEN (A.RESV_STAT_CD = 'F' AND A.SER_RESV_END_DT <![CDATA[<]]> A.CAR_ACCEPT_DT) THEN '02'
                         WHEN (A.SER_RESV_END_DT <![CDATA[<]]> SYSDATE AND A.RESV_STAT_CD = 'O') THEN '03'
                         WHEN A.RESV_STAT_CD = 'C' THEN '04'
                         END AS RESV_REPT_STAT_CD
                    ,(SELECT BAY_NM FROM SE_1012T WHERE BAY_NO = A.BAY_NO AND DLR_CD = #{sDlrCd}) AS BAY_NM
                    ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
             FROM SE_0100T A
            WHERE DLR_CD = #{sDlrCd}
                <!-- jhlim 임시 -->
                <if test='sBayNo != null and sBayNo != ""'>
                    AND A.BAY_NO = #{sBayNo}
                </if>
                <if test='sResvTp != null and sResvTp != ""'>
                    AND A.RESV_TP = #{sResvTp}
                </if>
                <if test='sVinNo != null and sVinNo != ""'>
                    AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                </if>
                <if test='sDriverNm != null and sDriverNm != ""'>
                    AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                </if>
                <if test='sCarRegNo != null and sCarRegNo != ""'>
                    AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                </if>
                <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                    AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                </if>
                <if test='sResvDocNo != null and sResvDocNo != ""'>
                    AND A.RESV_DOC_NO LIKE '%'||#{sResvDocNo}||'%'
                </if>
                <if test='sSerResvStartDt != null'>
                    AND A.SER_RESV_START_DT <![CDATA[>=]]> #{sSerResvStartDt}
                </if>
                <if test='sSerResvStartFromDt != null'>
                    AND A.SER_RESV_START_DT <![CDATA[>=]]> #{sSerResvStartFromDt}
                </if>
                <if test='sSerResvStartToDt != null'>
                    AND A.SER_RESV_START_DT <![CDATA[<=]]> #{sSerResvStartToDt} + 1
                </if>
                <if test='sResvFromDt != null'>
                    AND A.RESV_DT <![CDATA[>=]]> #{sResvFromDt}
                </if>
                <if test='sResvToDt != null'>
                    AND A.RESV_DT <![CDATA[<=]]> #{sResvToDt} + 1
                </if>
                <if test='sRegFromDt != null'>
                    AND A.REG_DT <![CDATA[>=]]> #{sRegFromDt}
                </if>
                <if test='sRegToDt != null'>
                    AND A.REG_DT <![CDATA[<=]]> #{sRegToDt} + 1
                </if>
                <if test='sResvStatCd != null and sResvStatCd != "" '>
                   AND A.RESV_STAT_CD = #{sResvStatCd}
                </if>
          )T1
        <where>
            <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                AND T1.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
            </if>
            <if test='sBayNm != null and sBayNm != ""'>
                AND T1.BAY_NM LIKE '%'||#{sBayNm}||'%'
            </if>
            <if test='sRresvReptStatCd != null and sRresvReptStatCd != ""'>
                AND T1.RESV_REPT_STAT_CD = #{sRresvReptStatCd}
            </if>
        </where>

    </select>

    <!-- 예약접수 상세 조회. -->
    <select id="selectReservationReceiptByKey" parameterType="ReservationReceiptSearchVO" resultType="ReservationReceiptVO">
        /* [chn.bhmc.dms.ser.rev.service.dao.ReservationReceiptDAO.selectReservationReceiptByKey] */
        SELECT A.*
             ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
        FROM SE_0100T A
        <!-- liuxueying 一个预约单可能对应都个接车检查 此处去掉关联关系 start-->
        <!--  LEFT JOIN SE_0200T B
        ON A.RESV_DOC_NO = B.RESV_DOC_NO-->
        <!-- liuxueying 一个预约单可能对应都个接车检查 此处去掉关联关系 end-->
        <where>
            <if test='sResvDocNo != null and sResvDocNo != ""'>
                AND A.RESV_DOC_NO = #{sResvDocNo}
            </if>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND A.DLR_CD = #{sDlrCd}
            </if>
        </where>
    </select>

    <!-- 예약준수 상태 조회. -->
    <select id="selectReservationReceiptByStats" parameterType="ReservationReceiptSearchVO" resultType="ReservationReceiptVO">
        /* [chn.bhmc.dms.ser.rev.service.dao.ReservationReceiptDAO.selectReservationReceiptByStats] */
        SELECT SUM(AQTY) AQTY --예약대기
               ,SUM(BQTY) BQTY --예약준수
               ,SUM(CQTY) CQTY --예약LATE
               ,SUM(DQTY) DQTY --예약 NO SHOW
               ,SUM(EQTY) EQTY --예약취소
               ,SUM(AQTY+BQTY+CQTY+DQTY+EQTY) SQTY
           FROM
           (
                SELECT COUNT(RESV_DOC_NO) AQTY
                    ,0 BQTY
                    ,0 CQTY
                    ,0 DQTY
                    ,0 EQTY
                FROM SE_0100T A
                WHERE  SER_RESV_END_DT <![CDATA[>=]]> SYSDATE
                AND RESV_STAT_CD = 'O' --예약대기
                <!-- jhlim 임시 -->
                <if test='sBayNo != null and sBayNo != ""'>
                    AND A.BAY_NO = #{sBayNo}
                </if>

                <if test='sResvDocNo != null and sResvDocNo != ""'>
                    AND A.RESV_DOC_NO = #{sResvDocNo}
                </if>
                <if test='sDlrCd != null and sDlrCd != ""'>
                    AND A.DLR_CD = #{sDlrCd}
                </if>
                <if test='sVinNo != null and sVinNo != ""'>
                    AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                </if>
                <if test='sDriverNm != null and sDriverNm != ""'>
                    AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                </if>
                <if test='sCarRegNo != null and sCarRegNo != ""'>
                    AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                </if>
                <if test='sSerResvStartDt != null'>
                    AND A.SER_RESV_START_DT <![CDATA[>=]]> #{sSerResvStartDt}
                </if>
                <if test='sResvFromDt != null'>
                    AND A.RESV_DT <![CDATA[>=]]> #{sResvFromDt}
                </if>
                <if test='sResvToDt != null'>
                    AND A.RESV_DT <![CDATA[<=]]> #{sResvToDt} + 1
                </if>
                <choose>
                    <when test='sListType != null and sListType != ""'>
                        <if test='sResvStatCd != null and sResvStatCd != ""'>
                            AND A.RESV_STAT_CD = #{sResvStatCd}
                        </if>
                    </when>
                    <otherwise>
                        AND A.RESV_STAT_CD != 'C'
                    </otherwise>
                </choose>
                UNION ALL
                SELECT 0 AQTY
                    , COUNT(RESV_DOC_NO) BQTY
                    ,0 CQTY
                    ,0 DQTY
                    ,0 EQTY
                FROM SE_0100T A
                WHERE  (RESV_STAT_CD = 'F'
                AND SER_RESV_END_DT <![CDATA[>=]]> CAR_ACCEPT_DT) --예약준수
                <!-- jhlim 임시 -->
                <if test='sBayNo != null and sBayNo != ""'>
                    AND A.BAY_NO = #{sBayNo}
                </if>

                <if test='sResvDocNo != null and sResvDocNo != ""'>
                    AND A.RESV_DOC_NO = #{sResvDocNo}
                </if>
                <if test='sDlrCd != null and sDlrCd != ""'>
                    AND A.DLR_CD = #{sDlrCd}
                </if>
                <if test='sVinNo != null and sVinNo != ""'>
                    AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                </if>
                <if test='sDriverNm != null and sDriverNm != ""'>
                    AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                </if>
                <if test='sCarRegNo != null and sCarRegNo != ""'>
                    AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                </if>
                <if test='sSerResvStartDt != null'>
                    AND A.SER_RESV_START_DT <![CDATA[>=]]> #{sSerResvStartDt}
                </if>
                <if test='sResvFromDt != null'>
                    AND A.RESV_DT <![CDATA[>=]]> #{sResvFromDt}
                </if>
                <if test='sResvToDt != null'>
                    AND A.RESV_DT <![CDATA[<=]]> #{sResvToDt} + 1
                </if>
                <choose>
                    <when test='sListType != null and sListType != ""'>
                        <if test='sResvStatCd != null and sResvStatCd != ""'>
                            AND A.RESV_STAT_CD = #{sResvStatCd}
                        </if>
                    </when>
                    <otherwise>
                        AND A.RESV_STAT_CD != 'C'
                    </otherwise>
                </choose>

                UNION ALL
                SELECT 0 AQTY
                    ,0 BQTY
                    ,COUNT(RESV_DOC_NO) CQTY
                    ,0 DQTY
                    ,0 EQTY
                FROM SE_0100T A
                WHERE  (RESV_STAT_CD = 'F'
                AND SER_RESV_END_DT <![CDATA[<]]> CAR_ACCEPT_DT) --예약LATE

                <!-- jhlim 임시 -->
                <if test='sBayNo != null and sBayNo != ""'>
                    AND A.BAY_NO = #{sBayNo}
                </if>

                <if test='sResvDocNo != null and sResvDocNo != ""'>
                    AND A.RESV_DOC_NO = #{sResvDocNo}
                </if>
                <if test='sDlrCd != null and sDlrCd != ""'>
                    AND A.DLR_CD = #{sDlrCd}
                </if>
                <if test='sVinNo != null and sVinNo != ""'>
                    AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                </if>
                <if test='sDriverNm != null and sDriverNm != ""'>
                    AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                </if>
                <if test='sCarRegNo != null and sCarRegNo != ""'>
                    AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                </if>
                <if test='sSerResvStartDt != null'>
                    AND A.SER_RESV_START_DT <![CDATA[>=]]> #{sSerResvStartDt}
                </if>
                <if test='sResvFromDt != null'>
                    AND A.RESV_DT <![CDATA[>=]]> #{sResvFromDt}
                </if>
                <if test='sResvToDt != null'>
                    AND A.RESV_DT <![CDATA[<=]]> #{sResvToDt} + 1
                </if>
                <choose>
                    <when test='sListType != null and sListType != ""'>
                        <if test='sResvStatCd != null and sResvStatCd != ""'>
                            AND A.RESV_STAT_CD = #{sResvStatCd}
                        </if>
                    </when>
                    <otherwise>
                        AND A.RESV_STAT_CD != 'C'
                    </otherwise>
                </choose>
                UNION ALL
                SELECT 0 AQTY
                    ,0 BQTY
                    ,0 CQTY
                    ,COUNT(RESV_DOC_NO) DQTY
                    ,0 EQTY
                FROM SE_0100T A
                WHERE  SER_RESV_END_DT <![CDATA[<]]> SYSDATE
                AND RESV_STAT_CD = 'O' --NO SHOW

                <!-- jhlim 임시 -->
                <if test='sBayNo != null and sBayNo != ""'>
                    AND A.BAY_NO = #{sBayNo}
                </if>

                <if test='sResvDocNo != null and sResvDocNo != ""'>
                    AND A.RESV_DOC_NO = #{sResvDocNo}
                </if>
                <if test='sDlrCd != null and sDlrCd != ""'>
                    AND A.DLR_CD = #{sDlrCd}
                </if>
                <if test='sVinNo != null and sVinNo != ""'>
                    AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                </if>
                <if test='sDriverNm != null and sDriverNm != ""'>
                    AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                </if>
                <if test='sCarRegNo != null and sCarRegNo != ""'>
                    AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                </if>
                <if test='sSerResvStartDt != null'>
                    AND A.SER_RESV_START_DT <![CDATA[>=]]> #{sSerResvStartDt}
                </if>
                <if test='sResvFromDt != null'>
                    AND A.RESV_DT <![CDATA[>=]]> #{sResvFromDt}
                </if>
                <if test='sResvToDt != null'>
                    AND A.RESV_DT <![CDATA[<=]]> #{sResvToDt} + 1
                </if>
                <choose>
                    <when test='sListType != null and sListType != ""'>
                        <if test='sResvStatCd != null and sResvStatCd != ""'>
                            AND A.RESV_STAT_CD = #{sResvStatCd}
                        </if>
                    </when>
                    <otherwise>
                        AND A.RESV_STAT_CD != 'C'
                    </otherwise>
                </choose>
                UNION ALL
                SELECT 0 AQTY
                    ,0 BQTY
                    ,0 CQTY
                    ,0 DQTY
                    ,COUNT(RESV_DOC_NO) EQTY
                FROM SE_0100T A
                WHERE RESV_STAT_CD = 'C' --취소

                <!-- jhlim 임시 -->
                <if test='sBayNo != null and sBayNo != ""'>
                    AND A.BAY_NO = #{sBayNo}
                </if>

                <if test='sResvDocNo != null and sResvDocNo != ""'>
                    AND A.RESV_DOC_NO = #{sResvDocNo}
                </if>
                <if test='sDlrCd != null and sDlrCd != ""'>
                    AND A.DLR_CD = #{sDlrCd}
                </if>
                <if test='sVinNo != null and sVinNo != ""'>
                    AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                </if>
                <if test='sDriverNm != null and sDriverNm != ""'>
                    AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                </if>
                <if test='sCarRegNo != null and sCarRegNo != ""'>
                    AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                </if>
                <if test='sSerResvStartDt != null'>
                    AND A.SER_RESV_START_DT <![CDATA[>=]]> #{sSerResvStartDt}
                </if>
                <if test='sResvFromDt != null'>
                    AND A.RESV_DT <![CDATA[>=]]> #{sResvFromDt}
                </if>
                <if test='sResvToDt != null'>
                    AND A.RESV_DT <![CDATA[<=]]> #{sResvToDt} + 1
                </if>
                <choose>
                    <when test='sListType != null and sListType != ""'>
                        <if test='sResvStatCd != null and sResvStatCd != ""'>
                            AND A.RESV_STAT_CD = #{sResvStatCd}
                        </if>
                    </when>
                    <otherwise>
                        AND A.RESV_STAT_CD != 'C'
                    </otherwise>
                </choose>
            ) T1

    </select>



    <!-- 예약접수 목록 조회. -->
    <select id="selectKanbanReservationByCondition" parameterType="ReservationReceiptSearchVO" resultType="ReservationReceiptVO">
        /* [chn.bhmc.dms.ser.rev.service.dao.ReservationReceiptDAO.selectKanbanReservationByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM
                  ,T1.*
                  ,TO_DATE(TO_CHAR(RESV_START_DT,'YYYYMMDD')||(S_DATE||S_MM),'YYYYMMDD HH24MI') AS SER_RESV_START_DT
                  ,TO_DATE(TO_CHAR(RESV_START_DT,'YYYYMMDD')||(S_DATE||E_MM),'YYYYMMDD HH24MI') AS SER_RESV_END_DT
                  ,CASE WHEN (SYSDATE BETWEEN RESV_START_DT AND RESV_START_DT + (1/24)*NKEEP_HM) AND RESV_STAT_CD = 'O' THEN '01'
                        WHEN (RESV_START_DT + (1/24)*NKEEP_HM <![CDATA[<]]> SYSDATE) AND RESV_STAT_CD = 'O' THEN '02'
                        ELSE '00'
                   END AS RESV_REPT_STAT_CD
               FROM (
                SELECT
                     A.RESV_DOC_NO
                    ,A.DLR_CD
                    ,A.VIN_NO
                    ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                    ,A.CAR_REG_NO
                    ,A.ENGIN_NO
                    ,A.CAR_OWNER_ID
                    ,A.CAR_OWNER_NM
                    ,A.DRIVER_ID
                    ,A.DRIVER_NM
                    ,A.RESV_TP
                    ,FN_CMM_CD_NM('SER013',A.RESV_TP, #{sLangCd}, 'N') AS RESV_TP_NM
                    ,A.RESV_STAT_CD
                    ,FN_CMM_CD_NM('SER011',A.RESV_STAT_CD, #{sLangCd}, 'N') AS RESV_STAT_CD_NM
                    ,A.RESV_DT
                    ,A.BAY_NO
                    ,A.TEC_ID
                    ,A.TEC_NM
                    ,A.SA_ID
                    ,A.SA_NM
                    ,A.HOPE_RESV_DT
                    ,A.SER_RESV_START_DT AS RESV_START_DT
                    ,A.SER_RESV_END_DT   AS RESV_END_DT
                    ,FN_SER_KANBAN_TIME(TO_CHAR( SER_RESV_START_DT,'mi'),#{sResvIvalCd},'S') AS S_MM
                    ,FN_SER_KANBAN_TIME(TO_CHAR( SER_RESV_START_DT,'mi'),#{sResvIvalCd},'E') AS E_MM
                    ,SUBSTR(TO_CHAR( SER_RESV_START_DT ,'hh24mi'),0,2) S_DATE
                    ,A.RO_GRP_NO
                    ,A.CAR_ACCEPT_DT
                    ,A.RESV_REMARK
                    ,A.DL_SER_REMARK
                    ,A.CAR_ID
                    ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                    ,fn_ser_res_board_value(A.CAR_REG_NO) AS KANBAN_STAT
                    ,(SELECT DECODE(RESV_KEEP_HM_CD, '01', 15, '02', 30, '03', 45, '04', 60, 0) FROM SE_1010T WHERE DLR_CD = A.DLR_CD) AS KEEP_HM
                    ,(SELECT DECODE(RESV_NKEEP_HM_CD , '01', 1, '02', 2, '03', 3, '04', 4, 0) FROM SE_1010T WHERE DLR_CD = A.DLR_CD) AS NKEEP_HM
                FROM SE_0100T A
               WHERE A.DLR_CD = #{sDlrCd}
                    <!-- jhlim 임시 -->
                    <if test='sBayNo != null and sBayNo != ""'>
                        AND A.BAY_NO = #{sBayNo}
                    </if>
                    <if test='sResvTp != null and sResvTp != ""'>
                        AND A.RESV_TP = #{sResvTp}
                    </if>
                    <if test='sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>
                    <if test='sDriverNm != null and sDriverNm != ""'>
                        AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                    </if>
                    <if test='sCarRegNo != null and sCarRegNo != ""'>
                        AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                    </if>
                    <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                        AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                    </if>
                    <if test='sResvDocNo != null and sResvDocNo != ""'>
                        AND A.RESV_DOC_NO LIKE '%'||#{sResvDocNo}||'%'
                    </if>
                    <if test='sSaNm != null and sSaNm != ""'>
                        AND A.SA_NM LIKE '%'||#{sSaNm}||'%'
                    </if>
                    <if test='sSerResvStartDt != null'>
                        AND A.SER_RESV_START_DT <![CDATA[>=]]> #{sSerResvStartDt}
                    </if>
                    <if test='sSerResvStartFromDt != null'>
                        AND A.SER_RESV_START_DT <![CDATA[>=]]> #{sSerResvStartFromDt}
                    </if>
                    <if test='sSerResvStartToDt != null'>
                        AND A.SER_RESV_START_DT <![CDATA[<=]]> #{sSerResvStartToDt} + 1
                    </if>
                    <if test='sResvFromDt != null'>
                        AND A.RESV_DT <![CDATA[>=]]> #{sResvFromDt}
                    </if>
                    <if test='sResvToDt != null'>
                        AND A.RESV_DT <![CDATA[<=]]> #{sResvToDt} + 1
                    </if>
                    <if test='sListType != null and sListType != ""'>
                        <choose>
                            <when test='sResvStatCd != null and sResvStatCd != ""'>
                                AND A.RESV_STAT_CD = #{sResvStatCd}
                            </when>
                            <otherwise>
                                <if test='sListType == "02"'>
                                    AND A.RESV_STAT_CD != 'C'
                                </if>
                                <if test='sListType == "03"'>
                                    AND A.RESV_STAT_CD NOT IN('F', 'C')
                                </if>
                            </otherwise>
                        </choose>
                    </if>
                ORDER BY  A.RESV_DOC_NO DESC
                    ,A.DLR_CD ASC
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>
    <!-- 根据单号查询明细 -->
    <select id="selectReservationReceiptByNo" parameterType="String" resultType="ReservationReceiptVO">
         SELECT A.DLR_CD
         ,A.VIN_NO
         ,A.RESV_DOC_NO
         ,A.RESV_CONTACTS                     
         ,A.RESV_PHONE                        
         ,A.SER_RESV_START_DT                 
         ,A.RESV_DT                 
         ,A.RESV_STAT_CD                   
         ,A.FMS_ID
         ,A.DRIVER_ID
         ,B.CUST_NM AS DRIVER_NM
         ,B.HP_NO AS DRIVER_HP_NO
         ,A.RESV_TP
         ,A.REG_DT 
         ,A.RESV_DT
         ,A.UPDT_DT
        FROM SE_0100T A LEFT JOIN CR_0101t B ON A.DRIVER_ID = B.CUST_NO
         where A.RESV_DOC_NO = #{resvDocNo}            
    </select>
    <insert id="insertReservationReceiptIS" parameterType="ReservationReceiptVO">
        INSERT INTO SE_0100IS_DCSFMS    --예약접수
        (
             IF_SEQ
            ,DLR_CD                          
            ,VIN_NO                          
            ,RESV_DOC_NO                    
            ,RESV_CONTACTS                     
            ,RESV_PHONE                        
            ,RESV_ARRIVE_DT                 
            ,RESV_STAT_CD                   
            ,FMS_ID
            ,RESV_REG_DT
            ,RESV_DT
            ,OPT_DT
            ,IFRESULT                       
            ,IF_REG_DT                      
            ,CREATEDATE                        
            ,UPDATEDATE                         --예약일자
        )
        VALUES
        (    SEQ_SE_0100IS_DCSFMS.NEXTVAL
            ,#{dlrCd}                  --딜러코드
            ,#{vinNo}                  --차대번호
            ,#{resvDocNo}              --예약문서번호
            ,#{resvContacts}    
            ,#{resvPhone}              
            ,#{serResvStartDt}              --预约服务时间
            ,#{resvStatCd}   
            ,#{fmsId}  
            ,#{regDt}  
            ,#{resvDt}   
            ,#{optDt}     
            ,'N'
            ,sysdate
            ,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
            ,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')              
        )
    </insert>
     <!-- 根据单号维护第一次确认预约时间 -->
     <update id="updateReservationResvDtByNo" parameterType="String">
        UPDATE SE_0100T SET RESV_DT = SYSDATE , REG_USR_ID = #{regUsrId}
         WHERE DLR_CD = #{dlrCd}
           AND RESV_DOC_NO = #{resvDocNo}
    </update>
</mapper>