<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : RepairOrderDAO_SqlMap.xml
    Description : RO에 관한 데이터처리
    author KyungMok Kim
    since 2016. 03. 14.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 03. 14.  KyungMok Kim     최초 생성
-->

<mapper namespace="chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO">

    <!-- RO접수 등록. -->
    <insert id="insertRepairOrder" parameterType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.insertRepairOrder] */
        INSERT INTO SE_0300T
        (
             DLR_CD                          --딜러코드
            ,RO_DOC_NO                       --RO문서번호
            ,RO_TP                           --RO유형
            ,RESV_DOC_NO                     --예약문서번호
            ,VIN_NO                          --차대번호
            ,CAR_REG_NO                      --차량등록번호
            ,ENGIN_NO                        --엔진시리얼번호
            ,CAR_OWNER_ID                    --차량소유자ID
            ,CAR_OWNER_NM                    --차량소유자명
            ,DRIVER_ID                       --운전자ID
            ,DRIVER_NM                       --운전자명
            ,RESV_TP                         --예약유형
            ,RESV_DT                         --예약일자
            ,BAY_NO                          --베이번호
            ,TEC_ID                          --TecManID
            ,TEC_NM                          --TecMan명
            ,SA_ID                           --SAID
            ,SA_NM                           --SA명
            ,OPER_RESV_DT                    --작업예약일자
            ,SER_RESV_START_DT               --서비스예약일자
            ,SER_RESV_END_DT                 --서비스예약일자
            ,PAR_AMT                         --부품금액
            ,LBR_AMT                         --공임금액
            ,ETC_AMT                         --기타금액
            ,DC_AMT                          --할인금액
            ,SUM_AMT                         --합계금액
            ,VAT_AMT                         --부가가치세금액
            ,TOT_AMT                         --총금액
            ,BAL_AMT                         --예치금액
            ,CANC_REASON_CD                  --취소사유코드
            ,CANC_REASON_CONT                --취소사유내용
            ,DIST_UNIT_CD                    --거리단위코드
            ,RUN_DIST_VAL                    --주행거리값
            ,DIAG_DOC_NO                     --사전점검번호
            ,BASE_RO_NO                      --원RO번호
            ,INC_REQ_NO                      --보험신청번호
            ,CUST_WAIT_MTH_CD                --고객대기방법코드
            ,ATQ_PROC_TP                     --고품처리유형
            ,CAR_WASH_TP                     --차량세차유형
            ,CAR_DRIVE_REQ_TP                --차량시승요청유형
            ,EXPC_DL_DT                      --예정인도일자
            ,ATQ_PROC_YN                     --고품처리여부
            ,CAR_WASH_YN                     --차량세차여부
            ,VSIT_CAR_RECEIVE_DT             --방문차량수령일자
            ,VSIT_CAR_RECEIVE_IF_NM          --방문차량수령연계인명
            ,VSIT_CAR_RECEIVE_CINO_NO        --방문차량수령연락처번호
            ,VSIT_CAR_RECEIVE_ADDR_NM        --방문차량수령주소명
            ,CAR_RECEIVE_DT                  --차량수령일자
            ,VSIT_DL_IF_NM                   --방문인도연계인명
            ,VSIT_DL_CINO_NO                 --방문인도연락처번호
            ,VSIT_DL_ADDR_NM                 --방문인도주소명
            ,VSIT_DT                         --방문일자
            ,VSIT_IF_NM                      --방문연계인명
            ,VSIT_CINO_NO                    --방문연락처번호
            ,VSIT_ADDR_NM                    --방문주소명
            ,REG_USR_ID                      --등록자ID
            ,REG_DT                          --등록일자
            ,RO_STAT_CD
            ,RO_DT
            ,RO_START_DT
            ,CAR_WASH_STAT_CD
            ,PAINT_STAT_CD
            ,QT_TEST_STAT_CD
            ,RO_GRP_NO
            ,RO_REMARK
            ,QT_TEST_MTH_CD
            ,CHG_EXPC_DL_DT
            ,CAU_CD1                         --원인코드1
            ,CAU_NM1                         --원인명1
            ,PHEN_CD1                        --현상코드1
            ,PHEN_NM1                        --현상명1
            ,CAU_CD2                         --원인코드2
            ,CAU_NM2                         --원인명2
            ,PHEN_CD2                        --현상코드2
            ,PHEN_NM2                        --현상명2
            ,PRE_AMT                         --선수금금액
            ,ALLOC_STAT_CD
            ,WRK_STAT_CD
            ,DL_STAT_CD
            ,GOODWILL_YN                     --GOODWILL 여부
            ,GOODWILL_STAT_CD                --GOODWILL 사용여부
            ,DLR_RO_TP                       --딜러자체RO유형
            ,PDI_YN
            ,FIRST_RO_YN                     --처음수리여부
            ,CUST_CONFIRM_YN                 --是否发送保修app工单
        )
        VALUES
        (
             #{dlrCd}                          --딜러코드
            ,#{roDocNo}                        --RO문서번호
            ,#{roTp}                           --RO유형
            ,#{resvDocNo}                      --예약문서번호
            ,#{vinNo}                          --차대번호
            ,#{carRegNo}                       --차량등록번호
            ,#{enginNo}                        --엔진시리얼번호
            ,#{carOwnerId}                     --차량소유자ID
            ,#{carOwnerNm}                     --차량소유자명
            ,#{driverId}                       --운전자ID
            ,#{driverNm}                       --운전자명
            ,#{resvTp}                         --예약유형
            ,#{resvDt}                         --예약일자
            ,#{bayNo}                          --베이번호
            ,#{tecId}                          --TecManID
            ,#{tecNm}                          --TecMan명
            ,#{saId}                           --SAID
            ,#{saNm}                           --SA명
            ,SYSDATE                           --작업예약일자
            ,#{serResvStartDt}                 --서비스예약일자
            ,#{serResvEndDt}                   --서비스예약일자
            ,#{parAmt}                         --부품금액
            ,#{lbrAmt}                         --공임금액
            ,#{etcAmt}                         --기타금액
            ,#{dcAmt}                          --할인금액
            ,#{sumAmt}                         --합계금액
            ,#{vatAmt}                         --부가가치세금액
            ,#{totAmt}                         --총금액
            ,#{balAmt}                         --예치금액
            ,#{cancReasonCd}                   --취소사유코드
            ,#{cancReasonCont}                 --취소사유내용
            ,#{distUnitCd}                     --거리단위코드
            ,#{runDistVal}                     --주행거리값
            ,#{diagDocNo}                      --사전점검번호
            ,#{baseRoNo}                       --원RO번호
            ,#{incReqNo}                       --보험신청번호
            ,#{custWaitMthCd}                  --고객대기방법코드
            ,#{atqProcTp}                      --고품처리유형
            ,#{carWashTp}                      --차량세차유형
            ,#{carDriveReqTp}                  --차량시승요청유형
            ,#{expcDlDt}                       --예정인도일자
            ,NVL(#{atqProcYn}, 'N')            --고품처리여부
            ,NVL(#{carWashYn}, 'N')            --차량세차여부
            ,#{vsitCarReceiveDt}               --방문차량수령일자
            ,#{vsitCarReceiveIfNm}             --방문차량수령연계인명
            ,#{vsitCarReceiveCinoNo}           --방문차량수령연락처번호
            ,#{vsitCarReceiveAddrNm}           --방문차량수령주소명
            ,#{carReceiveDt}                   --차량수령일자
            ,#{vsitDlIfNm}                     --방문인도연계인명
            ,#{vsitDlCinoNo}                   --방문인도연락처번호
            ,#{vsitDlAddrNm}                   --방문인도주소명
            ,#{vsitDt}                         --방문일자
            ,#{vsitIfNm}                       --방문연계인명
            ,#{vsitCinoNo}                     --방문연락처번호
            ,#{vsitAddrNm}                     --방문주소명
            ,#{regUsrId}                       --등록자ID
            ,SYSDATE
            ,#{roStatCd}
            ,SYSDATE
            ,SYSDATE
            ,#{carWashStatCd}
            ,#{paintStatCd}
            ,#{qtTestStatCd}
            ,#{roGrpNo}
            ,#{roRemark}
            ,#{qtTestMthCd}
            ,#{chgExpcDlDt}
            ,#{cauCd1}                          --원인코드1
            ,#{cauNm1}                          --원인명1
            ,#{phenCd1}                         --현상코드1
            ,#{phenNm1}                         --현상명1
            ,#{cauCd2}                          --원인코드2
            ,#{cauNm2}                          --원인명2
            ,#{phenCd2}                         --현상코드2
            ,#{phenNm2}                         --현상명2
            ,#{preAmt}                          --선수금금액
            ,#{allocStatCd}                     --배정상태코드
            ,#{wrkStatCd}                       --작업상태코드
            ,#{dlStatCd}                        --인도상태코드
            ,NVL(#{goodwillYn},'N')             --GOODWILL 여부
            ,NVL(#{goodwillStatCd},'O')         --GOODWILL 사용여부
            ,#{dlrRoTp}                         --딜러자체RO유형
            ,#{pdiYn}
            ,#{firstRoYn}                       --처음수리여부
            ,#{custConfirmYn}                   --是否发送保修app的工单
        )
    </insert>

    <!-- RO접수  수정. -->
    <update id="updateRepairOrder" parameterType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.updateRepairOrder] */
          UPDATE SE_0300T SET
             UPDT_USR_ID              = #{updtUsrId}                     --수정자ID
            ,UPDT_DT                  = SYSDATE                          --수정일자
            <if test='roTp != null and roTp != ""'>
            ,RO_TP                     = #{roTp}                         --RO유형
            </if>
            <if test='resvDocNo != null and resvDocNo != ""'>
            ,RESV_DOC_NO              = #{resvDocNo}                     --예약문서번호
            </if>
            <if test='custConfirmYn != null and custConfirmYn != ""'>
            ,CUST_CONFIRM_YN          = #{custConfirmYn}                 --是否发送app的索赔工单
             </if>
            <if test='carRegNo != null and carRegNo != ""'>
            ,CAR_REG_NO               = #{carRegNo}                      --차량등록번호
            </if>
            <if test='enginNo != null and enginNo != ""'>
            ,ENGIN_NO                 = #{enginNo}                       --엔진시리얼번호
            </if>
            <if test='carOwnerId != null and carOwnerId != ""'>
            ,CAR_OWNER_ID             = #{carOwnerId}                    --차량소유자ID
            </if>
            <if test='carOwnerNm != null and carOwnerNm != ""'>
            ,CAR_OWNER_NM             = #{carOwnerNm}                    --차량소유자명
            </if>
            <if test='driverId != null and driverId != ""'>
            ,DRIVER_ID                = #{driverId}                      --운전자ID
            </if>
            <if test='driverNm != null and driverNm != ""'>
            ,DRIVER_NM                = #{driverNm}                      --운전자명
            </if>
            <if test='resvTp != null and resvTp != ""'>
            ,RESV_TP                  = #{resvTp}                        --예약유형
            </if>
            <if test='resvDt != null'>
            ,RESV_DT                  = #{resvDt}                        --예약일자
            </if>
            <if test='bayNo != null and bayNo != ""'>
            ,BAY_NO                   = #{bayNo}                         --베이번호
            </if>
            <if test='tecId != null and tecId != ""'>
            ,TEC_ID                   = #{tecId}                         --TecManID
            </if>
            <if test='tecNm != null and tecNm != ""'>
            ,TEC_NM                   = #{tecNm}                         --TecMan명
            </if>
            <if test='saId != null and saId != ""'>
            ,SA_ID                    = #{saId}                          --SAID
            </if>
            <if test='saNm != null and saNm != ""'>
            ,SA_NM                    = #{saNm}                          --SA명
            </if>
            <if test='operResvDt != null'>
            ,OPER_RESV_DT             = #{operResvDt}                    --작업예약일자
            </if>
            <if test='serResvStartDt != null'>
            ,SER_RESV_START_DT        = #{serResvStartDt}                --서비스예약일자
            </if>
            <if test='serResvEndDt != null'>
            ,SER_RESV_END_DT          = #{serResvEndDt}                  --서비스예약일자
            </if>
            <if test='parAmt != null'>
            ,PAR_AMT                  = #{parAmt}                        --부품금액
            </if>
            <if test='lbrAmt != null and lbrAmt != ""'>
            ,LBR_AMT                  = #{lbrAmt}                        --공임금액
            </if>
            <if test='etcAmt != null'>
            ,ETC_AMT                  = #{etcAmt}                        --기타금액
            </if>
            <if test='dcAmt != null and dcAmt != ""'>
            ,DC_AMT                   = #{dcAmt}                         --할인금액
            </if>
            <if test='sumAmt != null and sumAmt != ""'>
            ,SUM_AMT                  = #{sumAmt}                        --합계금액
            </if>
            <if test='vatAmt != null and vatAmt != ""'>
            ,VAT_AMT                  = #{vatAmt}                        --부가가치세금액
            </if>
            <if test='totAmt != null and totAmt != ""'>
            ,TOT_AMT                  = #{totAmt}                        --총금액
            </if>
            <if test='balAmt != null and balAmt != ""'>
            ,BAL_AMT                  = #{balAmt}                        --예치금액
            </if>
            <if test='cancReasonCd != null and cancReasonCd != ""'>
            ,CANC_REASON_CD           = #{cancReasonCd}                  --취소사유코드
            </if>
            <if test='cancReasonCont != null and cancReasonCont != ""'>
            ,CANC_REASON_CONT         = #{cancReasonCont}                --취소사유내용
            </if>
            <if test='distUnitCd != null and distUnitCd != ""'>
            ,DIST_UNIT_CD             = #{distUnitCd}                    --거리단위코드
            </if>
            <if test='runDistVal != null and runDistVal != ""'>
            ,RUN_DIST_VAL             = #{runDistVal}                    --주행거리값
            </if>
            <if test='diagDocNo != null and diagDocNo != ""'>
            ,DIAG_DOC_NO               = #{diagDocNo}                    --사전점검번호
            </if>
            <if test='baseRoNo != null and baseRoNo != ""'>
            ,BASE_RO_NO               = #{baseRoNo}                      --원RO번호
            </if>
            <if test='incReqNo != null'>
            ,INC_REQ_NO               = #{incReqNo}                      --보험신청번호
            </if>
            <if test='custWaitMthCd != null and custWaitMthCd != ""'>
            ,CUST_WAIT_MTH_CD         = #{custWaitMthCd}                 --고객대기방법코드
            </if>
            <if test='atqProcTp != null and atqProcTp != ""'>
            ,ATQ_PROC_TP              = #{atqProcTp}                     --고품처리유형
            </if>
            <if test='carWashTp != null and carWashTp != ""'>
            ,CAR_WASH_TP              = #{carWashTp}                     --차량세차유형
            </if>
            <if test='carDriveReqTp != null and carDriveReqTp != ""'>
            ,CAR_DRIVE_REQ_TP         = #{carDriveReqTp}                 --차량시승요청유형
            </if>
            <if test='expcDlDt != null'>
            ,EXPC_DL_DT               = #{expcDlDt}                      --예정인도일자
            </if>
            <if test='atqProcYn != null and atqProcYn != ""'>
            ,ATQ_PROC_YN              = #{atqProcYn}                     --고품처리여부
            </if>
            <if test='carWashYn != null and carWashYn != ""'>
            ,CAR_WASH_YN              = #{carWashYn}                     --차량세차여부
            </if>
            <if test='vsitCarReceiveDt != null'>
            ,VSIT_CAR_RECEIVE_DT      = #{vsitCarReceiveDt}              --방문차량수령일자
            </if>
            <if test='vsitCarReceiveIfNm != null and vsitCarReceiveIfNm != ""'>
            ,VSIT_CAR_RECEIVE_IF_NM   = #{vsitCarReceiveIfNm}             --방문차량수령연계인명
            </if>
            <if test='vsitCarReceiveCinoNo != null and vsitCarReceiveCinoNo != ""'>
            ,VSIT_CAR_RECEIVE_CINO_NO = #{vsitCarReceiveCinoNo}           --방문차량수령연락처번호
            </if>
            <if test='vsitCarReceiveAddrNm != null and vsitCarReceiveAddrNm != ""'>
            ,VSIT_CAR_RECEIVE_ADDR_NM = #{vsitCarReceiveAddrNm}           --방문차량수령주소명
            </if>
            <if test='carReceiveDt != null'>
            ,CAR_RECEIVE_DT           = #{carReceiveDt}                   --차량수령일자
            </if>
            <if test='vsitDlIfNm != null and vsitDlIfNm != ""'>
            ,VSIT_DL_IF_NM            = #{vsitDlIfNm}                     --방문인도연계인명
            </if>
            <if test='vsitDlCinoNo != null and vsitDlCinoNo != ""'>
            ,VSIT_DL_CINO_NO          = #{vsitDlCinoNo}                   --방문인도연락처번호
            </if>
            <if test='vsitDlAddrNm != null and vsitDlAddrNm != ""'>
            ,VSIT_DL_ADDR_NM          = #{vsitDlAddrNm}                   --방문인도주소명
            </if>
            <if test='vsitDt != null'>
            ,VSIT_DT                  = #{vsitDt}                         --방문일자
            </if>
            <if test='vsitIfNm != null and vsitIfNm != ""'>
            ,VSIT_IF_NM               = #{vsitIfNm}                       --방문연계인명
            </if>
            <if test='vsitCinoNo != null and vsitCinoNo != ""'>
            ,VSIT_CINO_NO             = #{vsitCinoNo}                     --방문연락처번호
            </if>
            <if test='vsitAddrNm != null and vsitAddrNm != ""'>
            ,VSIT_ADDR_NM             = #{vsitAddrNm}                     --방문주소명
            </if>
            <if test='roStatCd != null and roStatCd != ""'>
            ,RO_STAT_CD               = #{roStatCd}
            </if>
            <if test='roDt != null'>
            ,RO_DT                    = #{roDt}
            </if>
            <if test='carWashStatCd != null and carWashStatCd != ""'>
            ,CAR_WASH_STAT_CD         = #{carWashStatCd}
            </if>
            <if test='paintStatCd != null and paintStatCd != ""'>
            ,PAINT_STAT_CD            = #{paintStatCd}
            </if>
            <if test='qtTestStatCd != null'>
            ,QT_TEST_STAT_CD          = #{qtTestStatCd}
            </if>
            <if test='roGrpNo != null and roGrpNo != ""'>
            ,RO_GRP_NO          = #{roGrpNo}
            </if>
            <if test='roStartDt != null'>
            ,RO_START_DT         = #{roStartDt}
            </if>
             <if test='roEndDt != null'>
            ,RO_END_DT              = #{roEndDt}
            </if>
            <if test='paintQty != null and paintQty != ""'>
            ,PAINT_QTY          = #{paintQty}
            </if>
            <if test='paintColorCd != null and paintColorCd != ""'>
            ,PAINT_COLOR_CD          = #{paintColorCd}
            </if>
            <if test='carColorCd != null and carColorCd != ""'>
            ,CAR_COLOR_CD          = #{carColorCd}
            </if>
            <if test='paintTp != null and paintTp != ""'>
            ,PAINT_TP          = #{paintTp}
            </if>
            <if test='roRemark != null and roRemark != ""'>
            ,RO_REMARK          = #{roRemark}
            </if>
            <if test='qtTestMthCd != null and qtTestMthCd != ""'>
            ,QT_TEST_MTH_CD          = #{qtTestMthCd}
            </if>
            <if test='chgExpcDlDt != null'>
            ,CHG_EXPC_DL_DT          = #{chgExpcDlDt}
            </if>
            <if test='cauCd1 != null and cauCd1 != ""'>
            ,CAU_CD1 = #{cauCd1}
            </if>
            <if test='cauNm1 != null and cauNm1 != ""'>
            ,CAU_NM1 = #{cauNm1}
            </if>
            <if test='phenCd1 != null and phenCd1 != ""'>
            ,PHEN_CD1 = #{phenCd1}
            </if>
            <if test='phenNm1 != null and phenNm1 != ""'>
            ,PHEN_NM1 = #{phenNm1}
            </if>
            <if test='cauCd2 != null and cauCd2 != ""'>
            ,CAU_CD2 = #{cauCd2}
            </if>
            <if test='cauNm2 != null and cauNm2 != ""'>
            ,CAU_NM2 = #{cauNm2}
            </if>
            <if test='phenCd2 != null and phenCd2 != ""'>
            ,PHEN_CD2 = #{phenCd2}
            </if>
            <if test='phenNm2 != null and phenNm2 != ""'>
            ,PHEN_NM2 = #{phenNm2}
            </if>
            <if test='carWashPrsnNm != null and carWashPrsnNm != ""'>
            ,CAR_WASH_PRSN_NM = #{carWashPrsnNm}
            </if>
            <if test='carWashPrsnCd != null and carWashPrsnCd != ""'>
            ,CAR_WASH_PRSN_CD = #{carWashPrsnCd}
            </if>
            <choose>
                <when test='carWashStatCd == "W3"'>
                    ,CAR_WASH_START_DT = #{carWashStartDt}
                    ,CAR_WASH_END_DT = #{carWashEndDt}
                </when>
                <otherwise>
                    <if test='carWashStartDt != null'>
                    ,CAR_WASH_START_DT          = #{carWashStartDt}
                    </if>
                    <if test='carWashEndDt != null'>
                    ,CAR_WASH_END_DT          = #{carWashEndDt}
                    </if>
                </otherwise>
            </choose>
            <if test='carWashCancDt != null'>
            ,CAR_WASH_CANC_DT          = #{carWashCancDt}
            </if>
            <if test='qtTestPrsnNm != null and qtTestPrsnNm != ""'>
            ,QT_TEST_PRSN_NM = #{qtTestPrsnNm}
            </if>
            <if test='qtTestPrsnCd != null and qtTestPrsnCd != ""'>
            ,QT_TEST_PRSN_CD = #{qtTestPrsnCd}
            </if>
            <choose>
                <when test='qtTestStatCd == "Q5"'>
                    ,QT_TEST_START_DT = #{qtTestStartDt}
                    ,QT_TEST_END_DT = #{qtTestEndDt}
                </when>
                <otherwise>
                    <if test='qtTestStartDt != null'>
                        ,QT_TEST_START_DT = #{qtTestStartDt}
                    </if>
                    <if test='qtTestEndDt != null'>
                        ,QT_TEST_END_DT = #{qtTestEndDt}
                    </if>
                </otherwise>
            </choose>
            <if test='rwrkCd != null and rwrkCd != ""'>
            ,RWRK_CD = #{rwrkCd}
            </if>
            <if test='rwrkRemark != null and rwrkRemark != ""'>
            ,RWRK_REMARK = #{rwrkRemark}
            </if>
            <if test='roEndChkYn != null and roEndChkYn != ""'>
            ,RO_END_CHK_YN = #{roEndChkYn}
            </if>
            <if test='atqProcChkYn != null and atqProcChkYn != ""'>
            ,ATQ_PROC_CHK_YN = #{atqProcChkYn}
            </if>
            <if test='qtChkYn != null and qtChkYn != ""'>
            ,QT_CHK_YN = #{qtChkYn}
            </if>
            <if test='carWashChkYn != null and carWashChkYn != ""'>
            ,CAR_WASH_CHK_YN = #{carWashChkYn}
            </if>
            <if test='serTagChkYn != null and serTagChkYn != ""'>
            ,SER_TAG_CHK_YN = #{serTagChkYn}
            </if>
            <if test='giRunDistVal != null and giRunDistVal != ""'>
            ,GI_RUN_DIST_VAL = #{giRunDistVal}
            </if>
            <if test='preAmt != null and preAmt != ""'>
            ,PRE_AMT         = #{preAmt}
            </if>
            <if test='allocStatCd != null and allocStatCd != ""'>
            ,ALLOC_STAT_CD = #{allocStatCd}                  --배정상태코드
            </if>
            <if test='wrkStatCd != null and wrkStatCd != ""'>
            ,WRK_STAT_CD = #{wrkStatCd}                      --작업상태코드
            </if>
            <if test='dlStatCd != null and dlStatCd != ""'>
            ,DL_STAT_CD = #{dlStatCd}                        --인도상태코드
            </if>
            <if test='goodwillYn != null and goodwillYn != ""'>
            ,GOODWILL_YN = #{goodwillYn}                      --GOODWILL 여부
            </if>
            <if test='goodwillStatCd != null and goodwillStatCd != ""'>
            ,GOODWILL_STAT_CD = #{goodwillStatCd}            --GOODWILL 사용여부
            </if>
            <if test='dlrRoTp != null and dlrRoTp != ""'>
            ,DLR_RO_TP = #{dlrRoTp}             --딜러자체RO유형
            </if>
            <if test='carWashCancPrsnCd != null and carWashCancPrsnCd != ""'>
            ,CAR_WASH_CANC_PRSN_CD = #{carWashCancPrsnCd}             --세차취소자ID
            </if>
            <if test='carWashCancPrsnNm != null and carWashCancPrsnNm != ""'>
            ,CAR_WASH_CANC_PRSN_NM = #{carWashCancPrsnNm}             --세차취소자명
            </if>
            <if test='carWashCancReasonCd != null and carWashCancReasonCd != ""'>
            ,CAR_WASH_CANC_REASON_CD = #{carWashCancReasonCd}             --세차취소원인코드
            </if>
            <if test='carWashCancReasonCont != null and carWashCancReasonCont != ""'>
            ,CAR_WASH_CANC_REASON_CONT = #{carWashCancReasonCont}             --세차취소원인내용
            </if>
            <if test='roPrintDt != null'>
            ,RO_PRINT_DT          = #{roPrintDt}
            </if>
            <choose>
                <when test='dlStatCd == "01"'>
                    ,DL_CHK_DT = #{dlChkDt}
                    ,DL_CHK_PRSN_CD = #{dlChkPrsnCd}
                    ,DL_CHK_PRSN_NM = #{dlChkPrsnNm}
                </when>
                <otherwise>
                    <if test='dlChkDt != null'>
                    ,DL_CHK_DT = #{dlChkDt}
                    </if>
                    <if test='dlChkPrsnCd != null and dlChkPrsnCd != ""'>
                    ,DL_CHK_PRSN_CD = #{dlChkPrsnCd}
                    </if>
                    <if test='dlChkPrsnNm != null and dlChkPrsnNm != ""'>
                    ,DL_CHK_PRSN_NM = #{dlChkPrsnNm}
                    </if>
                </otherwise>
            </choose>
            <if test='pdiYn != null and pdiYn != ""'>
            ,PDI_YN = #{pdiYn}
            </if>
            <if test='firstRoYn != null and firstRoYn != ""'>
            ,FIRST_RO_YN = #{firstRoYn}  --처음수리여부
            </if>
            <if test='freeRoYn != null and freeRoYn != ""'>
            ,FREE_RO_YN = #{freeRoYn}  --처음보양여부
            </if>
            WHERE DLR_CD = #{dlrCd}
            <choose>
                <when test='roDocNo !=null and roDocNo != "" '>
                    AND RO_DOC_NO = #{roDocNo}
                </when>
                <when test='roGrpNo !=null and roGrpNo != "" '>
                    AND RO_GRP_NO = #{roGrpNo}
                </when>
                <otherwise>
                    AND RO_DOC_NO = 'RO'
                </otherwise>
            </choose>
            <if test='vinNo != null and vinNo != ""'>
               AND VIN_NO   = #{vinNo}  --차대번호
            </if>
    </update>

    <delete id="deleteRepairOrder" parameterType="String">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.deleteRepairOrder] */
        DELETE FROM SE_0100T WHERE DLR_CD = #{sDlrCd} AND RESV_DOC_NO = #{resvDocNo}
    </delete>

    <!-- RO접수 목록 조회. -->
    <select id="selectRepairOrderByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT F.* FROM (
                     SELECT B.*
                           ,FN_GET_CARLINE_NM_NC(B.CARLINE_CD) AS CARLINE_NM
                           ,FN_GET_MODEL_NM(B.MODEL_CD) AS MODEL_NM
                           ,C.CALC_DOC_NO
                           ,C.LAST_CALC_TOT_AMT
                       FROM(
                            SELECT A.*
                                 ,(SELECT CMM_CD_TXT
                                     FROM CM_0304T
                                    WHERE LANG_CD    = NVL( #{sLangCd} ,'zh')
                                      AND CMM_GRP_CD = 'SER031'
                                      AND CMM_CD     = A.RO_TP ) AS RO_TP_NM
                                 ,(SELECT CMM_CD_TXT
                                     FROM CM_0304T
                                    WHERE LANG_CD    = NVL( #{sLangCd} ,'zh')
                                      AND CMM_GRP_CD = 'SER030'
                                      AND CMM_CD     = A.RO_STAT_CD ) AS RO_STAT_NM
                                 ,(SELECT CMM_CD_TXT
                                     FROM CM_0304T
                                    WHERE LANG_CD    = NVL( #{sLangCd} ,'zh')
                                      AND CMM_GRP_CD = 'SER057'
                                      AND CMM_CD     = A.DL_STAT_CD ) AS DL_STAT_NM
                                  ,(SELECT CARLINE_CD FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CARLINE_CD
                                  ,(SELECT MODEL_CD FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_CD
                                  ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS LAST_RUN_DIST_VAL
                                  ,EXPC_DL_DT - 30/(24*60) AS EXPC_DL_START_DT
                                  ,(SELECT CAR_ID
                                     FROM SA_0121T
                                    WHERE VIN_NO = A.VIN_NO
                                      AND ROWNUM = 1 ) AS CAR_ID
                                  ,FN_SER_LTS_MODEL_CD(A.VIN_NO) AS LTS_MODEL_CD
                                  ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                                  ,WRK_STAT_CD
                                  ,FN_CMM_CD_NM('SER050',WRK_STAT_CD,#{sLangCd},'N') AS WRK_STAT_NM
                            FROM SE_0300T A
                            <where>
                                <if test='sDlrCd != null and sDlrCd != ""'>
                                    AND A.DLR_CD = #{sDlrCd}
                                </if>
                                <if test='sRoDocNo != null and sRoDocNo != ""'>
                                    AND A.RO_DOC_NO like '%'||#{sRoDocNo}||'%'
                                </if>
                                <if test='sRoGrpNo != null and sRoGrpNo != ""'>
                                    AND A.RO_GRP_NO = #{sRoGrpNo}
                                </if>
                                <if test='sVinNo != null and sVinNo != ""'>
                                    AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                                </if>
                                <if test='sTecNm != null and sTecNm != ""'>
                                    AND A.TEC_NM LIKE '%'||#{sTecNm}||'%'
                                </if>
                                <if test='sSaNm != null and sSaNm != ""'>
                                    AND A.SA_NM LIKE '%'||#{sSaNm}||'%'
                                </if>
                                <if test='sSaId != null and sSaId != ""'>
                                    AND A.SA_ID = #{sSaId}
                                </if>
                                <if test='sDriverId != null and sDriverId != ""'>
                                    AND DRIVER_ID = #{sDriverId}
                                </if>
                                <if test='sDriverNm != null and sDriverNm != ""'>
                                    AND DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                                </if>
                                <if test='sCarRegNo != null and sCarRegNo != ""'>
                                    AND CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                                </if>
                                <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                                    AND CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                                </if>
                                <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                                    AND A.CAR_OWNER_ID = #{sCarOwnerId}
                                </if>
                                <if test='sBayNo != null and sBayNo != ""'>
                                    AND A.BAY_NO = #{sBayNo}
                                </if>
                                <if test='sRoStatCd != null and sRoStatCd != ""'>
                                    AND A.RO_STAT_CD = #{sRoStatCd}
                                </if>
                                <if test='sAtqProcTp != null and sAtqProcTp != ""'>
                                    AND A.ATQ_PROC_TP = #{sAtqProcTp}
                                </if>
                                <if test='sPaintStatCd != null and sPaintStatCd != ""'>
                                    AND A.PAINT_STAT_CD = #{sPaintStatCd}
                                </if>
                                <if test='sQtTestStatCd != null and sQtTestStatCd != ""'>
                                    AND A.QT_TEST_STAT_CD = #{sQtTestStatCd}
                                </if>
                                <if test='sCarWashStatCd != null and sCarWashStatCd != ""'>
                                    AND A.CAR_WASH_STAT_CD = #{sCarWashStatCd}
                                </if>
                                <if test='sResvDocNo != null and sResvDocNo != ""'>
                                    AND A.RESV_DOC_NO = #{sResvDocNo}
                                </if>
                                <if test='sRoTp != null and sRoTp != ""'>
                                    AND A.RO_TP = #{sRoTp}
                                </if>
                                <if test='sRoFromDt != null'>
                                    AND TO_CHAR(A.RO_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                                </if>
                                <if test='sRoToDt != null'>
                                    AND TO_CHAR(A.RO_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sRoToDt}, 'YYYYMMDD')
                                </if>
                                <if test='sExpcDlFromDt != null'>
                                    AND TO_CHAR(A.EXPC_DL_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sExpcDlFromDt}, 'YYYYMMDD')
                                </if>
                                <if test='sExpcDlToDt != null'>
                                    AND TO_CHAR(A.EXPC_DL_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sExpcDlToDt}, 'YYYYMMDD')
                                </if>
                                <if test='sRoStartDt != null'>
                                    AND TO_CHAR(A.RO_START_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sRoStartDt}, 'YYYYMMDD')
                                </if>
                                <if test='sRoEndDt != null'>
                                    AND TO_CHAR(A.RO_END_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sRoEndDt}, 'YYYYMMDD')
                                </if>
                                <if test='sListType != null and sListType != ""'>
                                    <choose>
                                        <when test='sListType == "AL"'>
                                            AND RO_STAT_CD IN ('01', '02')
                                            AND ALLOC_STAT_CD IN ('01', '02', '03')
                                            AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                                        </when>
                                        <when test='sListType == "WRK"'>
                                            AND RO_STAT_CD = '02'
                                            AND ALLOC_STAT_CD != '01'
                                            AND (DL_STAT_CD = '01' OR DL_STAT_CD IS NULL)
                                            AND WRK_STAT_CD IN ('01', '02', '03', '04', '05')
                                            AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                                        </when>
                                        <when test='sListType == "QT"'>
                                            AND RO_STAT_CD = '02'
                                            AND WRK_STAT_CD = '05'
                                            AND QT_TEST_STAT_CD IN ('Q1', 'Q2', 'Q3', 'Q5')
                                            AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                                        </when>
                                        <when test='sListType == "CWA"'>
                                            AND RO_STAT_CD = '02'
                                            AND WRK_STAT_CD = '05'
                                            AND CAR_WASH_TP IN ('01', '02', '03')
                                            AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                                        </when>
                                        <when test='sListType == "DL"'>
                                            AND RO_STAT_CD IN ('02', '03')
                                            AND WRK_STAT_CD = '05'
                                            AND DL_STAT_CD IN ('01', '02')
                                            AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                                        </when>
                                        <when test='sListType == "CA"'>
                                            AND ((RO_STAT_CD IN ('03', '04') AND WRK_STAT_CD = '05' )
                                                OR GOODWILL_YN = 'Y')
                                        </when>
                                        <otherwise>
                                          AND A.RO_STAT_CD != '06'
                                          AND A.PDI_YN != 'Y'
                                        </otherwise>
                                    </choose>
                                </if>
                                <if test='sRunDistFromVal != null and sRunDistFromVal !=""'>
                                    AND A.RUN_DIST_VAL <![CDATA[>=]]> #{sRunDistFromVal}
                                </if>
                                <if test='sRunDistToVal != null and sRunDistFromVal !=""'>
                                    AND A.RUN_DIST_VAL <![CDATA[<=]]> #{sRunDistToVal}
                                </if>
                                <if test='sCarWashYn != null and sCarWashYn !=""'>
                                    AND (A.CAR_WASH_TP != '04' OR A.CAR_WASH_TP IS NULL)
                                </if>
                                <if test='sQtTestYn != null and sQtTestYn !=""'>
                                    AND A.QT_TEST_MTH_CD = '01'
                                </if>
                                <if test='sAllocStatCd != null and sAllocStatCd !=""'>
                                    AND A.ALLOC_STAT_CD = #{sAllocStatCd}
                                </if>
                                <if test='sWrkStatCd != null and sWrkStatCd !=""'>
                                    AND A.WRK_STAT_CD = #{sWrkStatCd}
                                </if>
                                <if test='sQtTestPrsnNm != null and sQtTestPrsnNm !=""'>
                                    AND A.QT_TEST_PRSN_NM LIKE '%'||#{sQtTestPrsnNm}||'%'
                                </if>
                                <if test='sDlStatCd != null and sDlStatCd !=""'>
                                    AND A.DL_STAT_CD = #{sDlStatCd}
                                </if>
                                <if test='sPdiYn != null and sPdiYn != ""'>
                                    AND A.PDI_YN = #{sPdiYn}
                                    AND A.RO_STAT_CD != '06'
                                </if>
                            </where>
                      )B LEFT OUTER JOIN SE_0500T C
                        ON B.RO_DOC_NO  = C.RO_DOC_NO
                       AND B.DLR_CD     = C.DLR_CD
                       AND B.RO_TP      = C.RO_TP
                       AND C.CALC_CANC_YN = 'N'
                   ) F
                   <where>
                       <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                           AND F.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
                       </if>
                   </where>
                   ORDER BY
                    <choose>
                        <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "dlrCd"'>             F.DLR_CD            <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roDocNo"'>           F.RO_DOC_NO         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roTp"'>              F.RO_TP             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roDt"'>              F.RO_DT             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "resvDocNo"'>         F.RESV_DOC_NO       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "vinNo"'>             F.VIN_NO            <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "carRegNo"'>          F.CAR_REG_NO        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "enginNo"'>           F.ENGIN_NO          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "carOwnerId"'>        F.CAR_OWNER_ID      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "carOwnerNm"'>        F.CAR_OWNER_NM      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "driverNm"'>          F.DRIVER_NM         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "expcDlDt"'>          F.EXPC_DL_DT        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "dlChkDt"'>           F.DL_CHK_DT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "qtTestStartDt"'>     F.QT_TEST_START_DT  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "qtTestEndDt"'>       F.QT_TEST_END_DT    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                 F.DLR_CD ASC
                                ,F.RO_DT DESC
                                </otherwise>
                            </choose>
                        </foreach>
                        </when>
                        <otherwise>
                        F.DLR_CD ASC
                        ,F.RO_DT DESC
                        </otherwise>
                    </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- RO접수 목록수를 조회. -->
    <select id="selectRepairOrderByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderByConditionCnt] */
         SELECT COUNT(F.RO_DOC_NO) AS VALUE FROM (
            SELECT B.DLR_CD
                   ,B.RO_DOC_NO
                   ,B.RO_TP
                   ,B.REG_USR_NM FROM (
                SELECT A.DLR_CD
                      ,A.RO_DOC_NO
                      ,A.RO_TP
                      ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                  FROM SE_0300T A
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        AND A.DLR_CD = #{sDlrCd}
                    </if>
                    <if test='sRoDocNo != null and sRoDocNo != ""'>
                        AND A.RO_DOC_NO like '%'||#{sRoDocNo}||'%'
                    </if>
                    <if test='sRoGrpNo != null and sRoGrpNo != ""'>
                        AND A.RO_GRP_NO = #{sRoGrpNo}
                    </if>
                    <if test='sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>
                    <if test='sTecNm != null and sTecNm != ""'>
                        AND A.TEC_NM LIKE '%'||#{sTecNm}||'%'
                    </if>
                    <if test='sSaNm != null and sSaNm != ""'>
                        AND A.SA_NM LIKE '%'||#{sSaNm}||'%'
                    </if>
                    <if test='sSaId != null and sSaId != ""'>
                        AND A.SA_ID = #{sSaId}
                    </if>
                    <if test='sDriverNm != null and sDriverNm != ""'>
                        AND DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                    </if>
                    <if test='sCarRegNo != null and sCarRegNo != ""'>
                        AND CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                    </if>
                    <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                        AND CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                    </if>
                    <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                        AND A.CAR_OWNER_ID = #{sCarOwnerId}
                    </if>
                    <if test='sBayNo != null and sBayNo != ""'>
                        AND A.BAY_NO = #{sBayNo}
                    </if>
                    <if test='sRoStatCd != null and sRoStatCd != ""'>
                        AND A.RO_STAT_CD = #{sRoStatCd}
                    </if>
                    <if test='sAtqProcTp != null and sAtqProcTp != ""'>
                        AND A.ATQ_PROC_TP = #{sAtqProcTp}
                    </if>
                    <if test='sPaintStatCd != null and sPaintStatCd != ""'>
                        AND A.PAINT_STAT_CD = #{sPaintStatCd}
                    </if>
                    <if test='sQtTestStatCd != null and sQtTestStatCd != ""'>
                        AND A.QT_TEST_STAT_CD = #{sQtTestStatCd}
                    </if>
                    <if test='sCarWashStatCd != null and sCarWashStatCd != ""'>
                        AND A.CAR_WASH_STAT_CD = #{sCarWashStatCd}
                    </if>
                    <if test='sResvDocNo != null and sResvDocNo != ""'>
                        AND A.RESV_DOC_NO = #{sResvDocNo}
                    </if>
                    <if test='sRoTp != null and sRoTp != ""'>
                        AND A.RO_TP = #{sRoTp}
                    </if>
                    <if test='sRoFromDt != null'>
                        AND TO_CHAR(A.RO_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                    </if>
                    <if test='sRoToDt != null'>
                        AND TO_CHAR(A.RO_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sRoToDt}, 'YYYYMMDD')
                    </if>
                    <if test='sExpcDlFromDt != null'>
                        AND TO_CHAR(A.EXPC_DL_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sExpcDlFromDt}, 'YYYYMMDD')
                    </if>
                    <if test='sExpcDlToDt != null'>
                        AND TO_CHAR(A.EXPC_DL_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sExpcDlToDt}, 'YYYYMMDD')
                    </if>
                    <if test='sRoStartDt != null'>
                        AND TO_CHAR(A.RO_START_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sRoStartDt}, 'YYYYMMDD')
                    </if>
                    <if test='sRoEndDt != null'>
                        AND TO_CHAR(A.RO_END_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sRoEndDt}, 'YYYYMMDD')
                    </if>
                    <if test='sListType != null and sListType != ""'>
                        <choose>
                            <when test='sListType == "AL"'>
                                AND RO_STAT_CD IN ('01', '02')
                                AND ALLOC_STAT_CD IN ('01', '02', '03')
                                AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                            </when>
                            <when test='sListType == "WRK"'>
                                AND RO_STAT_CD = '02'
                                AND ALLOC_STAT_CD != '01'
                                AND (DL_STAT_CD = '01' OR DL_STAT_CD IS NULL)
                                AND WRK_STAT_CD IN ('01', '02', '03', '04', '05')
                                AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                            </when>
                            <when test='sListType == "QT"'>
                                AND RO_STAT_CD = '02'
                                AND WRK_STAT_CD = '05'
                                AND QT_TEST_STAT_CD IN ('Q1', 'Q2', 'Q3', 'Q5')
                                AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                            </when>
                            <when test='sListType == "CWA"'>
                                AND RO_STAT_CD = '02'
                                AND WRK_STAT_CD = '05'
                                AND CAR_WASH_TP IN ('01', '02', '03')
                                AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                            </when>
                            <when test='sListType == "DL"'>
                                AND RO_STAT_CD IN ('02', '03')
                                AND WRK_STAT_CD = '05'
                                AND DL_STAT_CD IN ('01', '02')
                                AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
                            </when>
                            <when test='sListType == "CA"'>
                                AND ((RO_STAT_CD IN ('03', '04') AND WRK_STAT_CD = '05' ) OR GOODWILL_YN = 'Y' )
                            </when>
                            <otherwise>
                                  AND A.RO_STAT_CD != '06'
                                  AND A.PDI_YN != 'Y'
                            </otherwise>
                        </choose>
                    </if>
                    <if test='sRunDistFromVal != null and sRunDistFromVal !=""'>
                        AND A.RUN_DIST_VAL <![CDATA[>=]]> #{sRunDistFromVal}
                    </if>
                    <if test='sRunDistToVal != null and sRunDistFromVal !=""'>
                        AND A.RUN_DIST_VAL <![CDATA[<=]]> #{sRunDistToVal}
                    </if>
                    <if test='sCarWashYn != null and sCarWashYn !=""'>
                        AND ( A.CAR_WASH_TP != '04' OR A.CAR_WASH_TP IS NULL)
                    </if>
                    <if test='sQtTestYn != null and sQtTestYn !=""'>
                        AND A.QT_TEST_MTH_CD = '01'
                    </if>
                    <if test='sAllocStatCd != null and sAllocStatCd !=""'>
                        AND A.ALLOC_STAT_CD = #{sAllocStatCd}
                    </if>
                    <if test='sWrkStatCd != null and sWrkStatCd !=""'>
                        AND A.WRK_STAT_CD = #{sWrkStatCd}
                    </if>
                    <if test='sQtTestPrsnNm != null and sQtTestPrsnNm !=""'>
                        AND A.QT_TEST_PRSN_NM LIKE '%'||#{sQtTestPrsnNm}||'%'
                    </if>
                    <if test='sDlStatCd != null and sDlStatCd !=""'>
                        AND A.DL_STAT_CD = #{sDlStatCd}
                    </if>
                    <if test='sPdiYn != null and sPdiYn != ""'>
                        AND A.PDI_YN = #{sPdiYn}
                    </if>
                </where>
                )B LEFT OUTER JOIN SE_0500T C
                    ON B.RO_DOC_NO  = C.RO_DOC_NO
                   AND B.DLR_CD     = C.DLR_CD
                   AND B.RO_TP      = C.RO_TP
                   AND C.CALC_CANC_YN = 'N'
           )F
           <where>
               <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                   AND F.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
               </if>
           </where>
    </select>

    <!-- RO접수현황 목록 조회. -->
    <select id="selectRepairOrderListByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderListByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM
                   ,T2.* FROM (
                SELECT T1.*
                  FROM (
                     SELECT B.*
                           ,FN_CMM_CD_NM('COM020',B.PAID_YN,#{sLangCd},'N') AS PAID_YN_NM
                           ,FN_CMM_CD_NM('COM020',B.RESV_YN,#{sLangCd},'N') AS RESV_YN_NM
                           ,B.LBR_DC + B.PAR_DC AS DC_AMT               -- 할인금액
                           ,B.PAR_AMT + B.LBR_AMT + B.ETC_AMT AS SUM_AMT --합계금액
                           ,CASE WHEN B.RO_STAT_CD ='06' THEN B.UPDT_USR_NM ELSE NULL END AS RO_CANC_NM --RO 취소자
                           ,C.CALC_DOC_NO
                           ,C.CALC_DT
                           ,B.PAR_AMT AS CALC_PAR_AMT --부품금액
                           ,B.LBR_AMT AS CALC_LBR_AMT  --공임금액
                           ,B.ETC_AMT AS CALC_ETC_AMT  --기타금액
                           ,B.PAR_DC + B.LBR_DC AS CALC_DC_AMT --할인금액
                           ,NVL(C.LBR_ETC_DC_AMT ,0 )+ NVL(C.PAR_ETC_DC_AMT,0 ) AS CALC_ETC_DC_AMT
                           ,NVL(C.LAST_CALC_TOT_AMT, 0) AS CALC_SUM_AMT
                           ,NVL(C.BM_POINT_TOT_AMT,0) AS BM_POINT_USE_AMT
                           ,NVL(C.BM_CUPN_TOT_AMT,0) AS BM_CUPN_USE_AMT
                           ,NVL(C.POINT_TOT_AMT,0) AS POINT_USE_AMT
                           ,NVL(C.LBR_DC_AMT,0) AS LBR_DC_AMT
                           ,NVL(C.PAR_DC_AMT,0) AS PAR_DC_AMT
                           ,(SELECT USR_NM FROM CM_0801T WHERE DLR_CD = C.DLR_CD AND USR_ID = C.REG_USR_ID) AS CALC_PRSN_NM
                           ,C.REG_DT AS CALC_REG_DT
                           ,E.WON_UNIT_CUT_AMT
                           ,E.DEMIC_POINT_CUT_AMT
                           ,F.PAYM_AMT
                           ,F.RCV_AMT
                           ,F.NPAY_AMT
                           ,(SELECT MAX(RCV_CPLT_DT) FROM SE_0570T WHERE RCV_DOC_NO = D.RCV_DOC_NO) AS PAY_END_DT --지불완료시간
                           ,(SELECT ORD_DLR_CD FROM SA_0121T WHERE VIN_NO = B.VIN_NO AND ROWNUM = 1) AS ORD_DLR_CD --판매딜러
                           ,(SELECT BLUE_MEMBERSHIP_NO FROM CR_0101T WHERE DLR_CD = B.DLR_CD AND CUST_NO = B.CAR_OWNER_ID) AS BLUE_MEMBERSHIP_NO --BM회원번호
                           ,CASE WHEN (SELECT MEMBERSHIP_POLICY FROM CM_0101T WHERE DLR_CD = B.DLR_CD) = 'V'
                                 THEN (SELECT MEMBERSHIP_NO FROM CR_0801T WHERE DLR_CD = B.DLR_CD AND VIN_NO = B.VIN_NO)
                                 ELSE (SELECT MEMBERSHIP_NO FROM CR_0801T WHERE DLR_CD = B.DLR_CD AND CUST_NO = B.CAR_OWNER_ID)
                            END AS MEMBERSHIP_NO --딜러회원번호
                       FROM(
                             SELECT DLR_CD                          --딜러코드
                                   ,RO_DOC_NO                       --RO문서번호
                                   ,RO_TP                           --RO유형
                                   ,FN_CMM_CD_NM('SER031',A.RO_TP,#{sLangCd},'N') AS RO_TP_NM
                                   ,RESV_DOC_NO                     --예약문서번호
                                   ,VIN_NO                          --차대번호
                                   ,CAR_REG_NO                      --차량등록번호
                                   ,ENGIN_NO                        --엔진번호
                                   ,CAR_OWNER_ID                    --차량소유자ID
                                   ,CAR_OWNER_NM                    --차량소유자명
                                   ,DRIVER_ID                       --운전자ID
                                   ,DRIVER_NM                       --운전자명
                                   ,RESV_TP                         --예약유형
                                   ,RESV_DT                         --예약일자
                                   ,BAY_NO                          --베이번호
                                   ,TEC_ID                          --TechManID
                                   ,TEC_NM                          --TechMan명
                                   ,SA_ID                           --SAID
                                   ,SA_NM                           --SA명
                                   ,OPER_RESV_DT                    --작업예약일자
                                   ,SER_RESV_START_DT               --서비스예약시작일자
                                   ,(
                                      SELECT NVL(SUM(ITEM_TOT_AMT),0)
                                        FROM SE_0160T
                                       WHERE DLR_CD = A.DLR_CD
                                         AND DOC_NO = A.RO_DOC_NO
                                         AND PREFIX_ID = 'RO'
                                     )AS PAR_AMT --부품금액
                                    ,(
                                      SELECT NVL(SUM(LBR_TOT_AMT),0)
                                        FROM SE_0170T
                                       WHERE DLR_CD = A.DLR_CD
                                         AND DOC_NO = A.RO_DOC_NO
                                         AND PREFIX_ID = 'RO'
                                     ) AS LBR_AMT  --공임금액
                                    ,(
                                      SELECT NVL(SUM(ETC_REQ_PRC),0)
                                        FROM SE_0140T
                                       WHERE DLR_CD = A.DLR_CD
                                         AND JOB_NO = A.RO_DOC_NO
                                         AND PREFIX_ID = 'RO'
                                     ) AS ETC_AMT  --기타금액
                                     ,(
                                      SELECT NVL(SUM(DC_AMT),0)
                                        FROM SE_0160T
                                       WHERE DLR_CD = A.DLR_CD
                                         AND DOC_NO = A.RO_DOC_NO
                                         AND PREFIX_ID = 'RO'
                                     )AS PAR_DC --부품할인금액
                                     ,(
                                      SELECT NVL(SUM(DC_AMT),0)
                                        FROM SE_0170T
                                       WHERE DLR_CD = A.DLR_CD
                                         AND DOC_NO = A.RO_DOC_NO
                                         AND PREFIX_ID = 'RO'
                                     )AS LBR_DC  --공임할인금액
                                   ,NVL(BAL_AMT ,0 ) BAL_AMT                         --예치금액
                                   ,CANC_REASON_CD                  --취소사유코드
                                   ,FN_CMM_CD_NM('SER014',A.CANC_REASON_CD,#{sLangCd},'N') AS CANC_REASON_NM
                                   ,CANC_REASON_CONT                --취소사유내용
                                   ,CASE WHEN RO_STAT_CD ='06' THEN UPDT_DT ELSE NULL END AS RO_CANC_DT --RO 취소시간
                                   ,DIST_UNIT_CD                    --거리단위코드
                                   ,RUN_DIST_VAL                    --주행거리값
                                   ,DIAG_DOC_NO                     --진단문서번호
                                   ,BASE_RO_NO                      --원RO번호
                                   ,INC_REQ_NO                      --보험신청번호
                                   ,CUST_WAIT_MTH_CD                --고객대기방법코드
                                   ,FN_CMM_CD_NM('SER032',A.CUST_WAIT_MTH_CD,#{sLangCd},'N') AS CUST_WAIT_MTH_NM
                                   ,ATQ_PROC_TP                     --고품처리유형
                                   ,FN_CMM_CD_NM('SER033',A.ATQ_PROC_TP,#{sLangCd},'N') AS ATQ_PROC_TP_NM
                                   ,CAR_WASH_TP                     --차량세차유형
                                   ,FN_CMM_CD_NM('SER034',A.CAR_WASH_TP,#{sLangCd},'N') AS CAR_WASH_TP_NM
                                   ,CAR_DRIVE_REQ_TP                --차량시승요청유형
                                   ,FN_CMM_CD_NM('SER035',A.CAR_DRIVE_REQ_TP,#{sLangCd},'N') AS CAR_DRIVE_REQ_TP_NM
                                   ,EXPC_DL_DT                      --예정인도일자
                                   ,ATQ_PROC_YN                     --고품처리여부
                                   ,CAR_WASH_YN                     --차량세차여부
                                   ,VSIT_CAR_RECEIVE_DT             --방문차량수령일자
                                   ,VSIT_CAR_RECEIVE_IF_NM          --방문차량수령연계인명
                                   ,VSIT_CAR_RECEIVE_CINO_NO        --방문차량수령연락처번호
                                   ,VSIT_CAR_RECEIVE_ADDR_NM        --방문차량수령주소명
                                   ,CAR_RECEIVE_DT                  --차량수령일자
                                   ,VSIT_DL_IF_NM                   --방문인도연계인명
                                   ,VSIT_DL_CINO_NO                 --방문인도연락처번호
                                   ,VSIT_DL_ADDR_NM                 --방문인도주소명
                                   ,VSIT_DT                         --방문일자
                                   ,VSIT_IF_NM                      --방문연계인명
                                   ,VSIT_CINO_NO                    --방문연락처번호
                                   ,VSIT_ADDR_NM                    --방문주소명
                                   ,REG_USR_ID                      --등록자ID
                                   ,UPDT_USR_ID                     --수정자ID
                                   ,UPDT_DT
                                   ,ALLOC_EMP_ID                    --배정자ID
                                   ,SER_RESV_END_DT                 --서비스예약종료일자
                                   ,INC_REQ_DT                      --보험신청일자
                                   ,RO_STAT_CD                      --RO상태코드
                                   ,FN_CMM_CD_NM('SER030',A.RO_STAT_CD,#{sLangCd},'N') AS RO_STAT_NM
                                   ,RO_DT                           --RO일자
                                   ,CAR_WASH_STAT_CD                --세차상태코드
                                   ,PAINT_STAT_CD                   --페인트상태코드
                                   ,QT_TEST_STAT_CD                 --품질검사상태코드
                                   ,RO_GRP_NO                       --RO그룹번호
                                   ,PAINT_QTY                       --페인트수량
                                   ,PAINT_COLOR_CD                  --페인트색상코드
                                   ,CAR_COLOR_CD                    --차량색상코드
                                   ,PAINT_TP                        --페인트유형
                                   ,RO_START_DT                     --RO시작일자
                                   ,RO_END_DT                       --RO종료일자
                                   ,RO_REMARK                       --RO비고
                                   ,QT_TEST_MTH_CD                  --품질검사방법코드
                                   ,FN_CMM_CD_NM('SER040',A.QT_TEST_MTH_CD,#{sLangCd},'N') AS QT_TEST_MTH_NM
                                   ,CHG_EXPC_DL_DT                  --변경예정인도일자
                                   ,CAU_CD1                         --원인코드1
                                   ,CAU_NM1                         --원인명1
                                   ,PHEN_CD1                        --현상코드1
                                   ,PHEN_NM1                        --현상명1
                                   ,CAU_CD2                         --원인코드2
                                   ,CAU_NM2                         --원인명2
                                   ,PHEN_CD2                        --현상코드2
                                   ,PHEN_NM2                        --현상명2
                                   ,QT_TEST_START_DT                --품질검사시작일자
                                   ,QT_TEST_END_DT                  --품질검사종료일자
                                   ,QT_TEST_PRSN_CD                 --품질검사담당자코드
                                   ,QT_TEST_PRSN_NM                 --품질검사담당자명
                                   ,CAR_WASH_START_DT               --차량세차시작일자
                                   ,CAR_WASH_END_DT                 --차량세차종료일자
                                   ,CAR_WASH_PRSN_CD                --차량세차담당자코드
                                   ,CAR_WASH_PRSN_NM                --차량세차담당자명
                                   ,ROAD_TEST_CD                    --도로검사코드
                                   ,PRE_AMT                         --선수금액
                                   ,RWRK_CD                         --리워크코드
                                   ,RWRK_REMARK                     --리워크비고
                                   ,RO_END_CHK_YN                   --RO종료확인여부
                                   ,ATQ_PROC_CHK_YN                 --고품처리확인여부
                                   ,QT_CHK_YN                       --품질확인여부
                                   ,CAR_WASH_CHK_YN                 --차량세차확인여부
                                   ,SER_TAG_CHK_YN                  --서비스태그확인여부
                                   ,GI_RUN_DIST_VAL                 --주행거리값
                                   ,CASE WHEN TO_CHAR(GI_RUN_DIST_VAL) = '0' THEN '' ELSE TO_CHAR(GI_RUN_DIST_VAL) END AS GI_RUN_DIST_VAL_TEXT
                                   ,DL_CHK_PRSN_CD                  --인도확인자코드
                                   ,DL_CHK_PRSN_NM                  --인도확인자명
                                   ,CAR_WASH_CANC_DT                --차량세차취소일자
                                   ,ALLOC_STAT_CD                   --배정상태코드
                                   ,WRK_STAT_CD                     --작업상태코드
                                   ,FN_CMM_CD_NM('SER050',A.WRK_STAT_CD,#{sLangCd},'N') AS WRK_STAT_NM
                                   ,DL_STAT_CD                      --인도상태코드
                                   ,NVL(GOODWILL_YN,'N') AS GOODWILL_YN --GOODWILL여부
                                   ,FN_CMM_CD_NM('COM020',GOODWILL_YN,#{sLangCd},'N') AS GOODWILL_YN_NM
                                   ,NVL(GOODWILL_STAT_CD,'O') AS GOODWILL_STAT_CD --GOODWILL 사용여부
                                   ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1 ) AS LAST_RUN_DIST_VAL
                                   ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO  AND ROWNUM = 1) AS CARLINE_NM
                                   ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                                   ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                                   ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) AS UPDT_USR_NM
                                   ,EXPC_DL_DT - 30/(24*60) AS EXPC_DL_START_DT  -- 예정인도시간
                                   ,RO_PRINT_DT
                                   ,DLR_RO_TP
                                   ,FN_CMM_CD_NM('SER044',A.DLR_RO_TP,#{sLangCd},'N') AS DLR_RO_TP_NM
                                   ,CASE WHEN RO_STAT_CD = '05' THEN 'Y' ELSE 'N' END AS PAID_YN
                                   ,CASE WHEN RESV_DOC_NO IS NOT NULL THEN 'Y' ELSE 'N' END AS RESV_YN
                                   ,(SELECT CUST_SALE_DT FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CUST_SALE_DT --차량판매일
                                   ,FIRST_RO_YN                     --처음수리여부
                                   ,FN_CMM_CD_NM('COM020',A.FIRST_RO_YN,#{sLangCd},'N') AS FIRST_RO_YN_NM
                                   ,FREE_RO_YN                      --처음보양여부
                                   ,FN_CMM_CD_NM('COM020',A.FREE_RO_YN,#{sLangCd},'N') AS FREE_RO_YN_NM
                            FROM SE_0300T A
                            <where>
                                <if test='sDlrCd != null and sDlrCd != ""'>
                                    AND A.DLR_CD = #{sDlrCd}
                                </if>
                                <if test='sRoDocNo != null and sRoDocNo != ""'>
                                    AND A.RO_DOC_NO like '%'||#{sRoDocNo}||'%'
                                </if>
                                <if test='sVinNo != null and sVinNo != ""'>
                                    AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                                </if>
                                <if test='sDriverId != null and sDriverId != ""'>
                                    AND DRIVER_ID = #{sDriverId}
                                </if>
                                <if test='sDriverNm != null and sDriverNm != ""'>
                                    AND DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                                </if>
                                <if test='sCarRegNo != null and sCarRegNo != ""'>
                                    AND CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                                </if>
                                <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                                    AND CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                                </if>
                                <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                                    AND A.CAR_OWNER_ID = #{sCarOwnerId}
                                </if>
                                <if test='sBayNo != null and sBayNo != ""'>
                                    AND A.BAY_NO = #{sBayNo}
                                </if>
                                <if test='sRoTp != null and sRoTp != ""'>
                                    AND A.RO_TP = #{sRoTp}
                                </if>
                                <if test='sRoTpList != null and !sRoTpList.isEmpty'> AND A.RO_TP IN
                                   <foreach item="item" index="index" collection="sRoTpList" open="(" separator="," close=")">
                                       #{item}
                                   </foreach>
                                </if>
                                <if test='sRoStatCd != null and sRoStatCd != ""'>
                                    AND A.RO_STAT_CD = #{sRoStatCd}
                                </if>
                                <if test='sRoFromDt != null'>
                                    AND A.RO_DT <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                                </if>
                                <if test='sRoToDt != null'>
                                    AND A.RO_DT <![CDATA[<]]> TO_CHAR(#{sRoToDt} + 1, 'YYYYMMDD')
                                </if>
                                <if test='sExpcDlFromDt != null'>
                                    AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
                                </if>
                                <if test='sExpcDlToDt != null'>
                                    AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
                                </if>
                                <if test='sRoStartDt != null'>
                                    AND A.RO_START_DT <![CDATA[>=]]> #{sRoStartDt}
                                </if>
                                <if test='sRoEndDt != null'>
                                    AND A.RO_END_DT <![CDATA[<]]> #{sRoEndDt} + 1
                                </if>
                                <if test='sDlrRoTp != null and sDlrRoTp != ""'>
                                    AND A.DLR_RO_TP = #{sDlrRoTp}
                                </if>
                            </where>
                      )B LEFT OUTER JOIN SE_0500T C
                        ON B.RO_DOC_NO  = C.RO_DOC_NO
                       AND B.DLR_CD     = C.DLR_CD
                       AND B.RO_TP      = C.RO_TP
                       AND C.CALC_CANC_YN = 'N'
                      LEFT OUTER JOIN SE_0550T D
                        ON B.RO_DOC_NO  = D.RO_DOC_NO
                       AND B.DLR_CD     = D.DLR_CD
                       AND B.RO_TP      = D.RO_TP
                      LEFT OUTER JOIN (
                        SELECT DLR_CD, CALC_DOC_NO
                               ,NVL(SUM(WON_UNIT_CUT_AMT), 0) AS WON_UNIT_CUT_AMT
                               ,NVL(SUM(DEMIC_POINT_CUT_AMT), 0) AS DEMIC_POINT_CUT_AMT
                        FROM SE_0530T
                        GROUP BY DLR_CD, CALC_DOC_NO
                      ) E
                      ON C.DLR_CD = E.DLR_CD
                      AND C.CALC_DOC_NO = E.CALC_DOC_NO
                      LEFT OUTER JOIN (
                        SELECT DLR_CD, RCV_DOC_NO
                               ,NVL(SUM(PAYM_AMT), 0) AS PAYM_AMT
                               ,NVL(SUM(RCV_AMT), 0) AS RCV_AMT
                               ,NVL(SUM(NPAY_AMT), NVL(SUM(PAYM_AMT), 0) - NVL(SUM(RCV_AMT), 0)) AS NPAY_AMT
                        FROM SE_0560T
                        GROUP BY DLR_CD, RCV_DOC_NO
                      ) F
                      ON D.DLR_CD = F.DLR_CD
                      AND D.RCV_DOC_NO = F.RCV_DOC_NO
                ) T1
                <where>
                    <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                        AND T1.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
                    </if>
                    <if test='sCalcPrsnNm != null and sCalcPrsnNm != ""'>
                        AND T1.CALC_PRSN_NM LIKE '%'||#{sCalcPrsnNm}||'%'
                    </if>
                    <if test='sCalcDocNo != null and sCalcDocNo != ""'>
                        AND T1.CALC_DOC_NO LIKE '%'||#{sCalcDocNo}||'%'
                    </if>
                    <if test='sOrdDlrCd != null and sOrdDlrCd != ""'>
                        AND T1.ORD_DLR_CD LIKE '%'||#{sOrdDlrCd}||'%'
                    </if>
                    <if test='sBlueMembershipNo != null and sBlueMembershipNo != ""'>
                        AND T1.BLUE_MEMBERSHIP_NO LIKE '%'||#{sBlueMembershipNo}||'%'
                    </if>
                    <if test='sCustSaleFromDt != null'>
                        AND T1.CUST_SALE_DT <![CDATA[>=]]> #{sCustSaleFromDt}
                    </if>
                    <if test='sCustSaleToDt != null'>
                        AND T1.CUST_SALE_DT <![CDATA[<]]> #{sCustSaleToDt} + 1
                    </if>
                    <if test='sPayEndFromDt != null'>
                        AND T1.PAY_END_DT <![CDATA[>=]]> #{sPayEndFromDt}
                    </if>
                    <if test='sPayEndToDt != null'>
                        AND T1.PAY_END_DT <![CDATA[<]]> #{sPayEndToDt} + 1
                    </if>
                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                    <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                        <choose>
                            <when test='item.field == "carRegNo"'>          T1.CAR_REG_NO           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "vinNo"'>             T1.VIN_NO               <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carOwnerNm"'>        T1.CAR_OWNER_NM         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "driverNm"'>          T1.DRIVER_NM            <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carlineNm"'>         T1.CARLINE_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "modelNm"'>           T1.MODEL_NM             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "runDistVal"'>        T1.RUN_DIST_VAL         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "giRunDistVal"'>      T1.GI_RUN_DIST_VAL      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roStatNm"'>          T1.RO_STAT_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roDocNo"'>           T1.RO_DOC_NO            <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roTpNm"'>            T1.RO_TP_NM             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roDtFormat"'>        T1.RO_DT                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "regUsrNm"'>          T1.REG_USR_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roPrintDtFormat"'>   T1.RO_PRINT_DT          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "updtDtFormat"'>      T1.UPDT_DT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "updtUsrNm"'>         T1.UPDT_USR_NM          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roCancDtFormat"'>    T1.RO_CANC_DT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roCancNm"'>          T1.RO_CANC_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "cancReasonNm"'>      T1.CANC_REASON_NM       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "lbrAmt"'>            T1.LBR_AMT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "parAmt"'>            T1.PAR_AMT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "etcAmt"'>            T1.ETC_AMT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "sumAmt"'>            T1.SUM_AMT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "expcDlDtFormat"'>    T1.EXPC_DL_DT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "wrkStatNm"'>         T1.WRK_STAT_NM          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "atqProcTpNm"'>       T1.ATQ_PROC_TP_NM       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carWashTpNm"'>       T1.CAR_WASH_TP_NM       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "custWaitMthNm"'>     T1.CUST_WAIT_MTH_NM     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "qtTestMthNm"'>       T1.QT_TEST_MTH_NM       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "goodwillYnNm"'>      T1.GOODWILL_YN_NM       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carDriveReqTpNm"'>   T1.CAR_DRIVE_REQ_TP_NM  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roRemark"'>          T1.RO_REMARK           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "dlrRoTpNm"'>         T1.DLR_RO_TP_NM         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "diagDocNo"'>         T1.DIAG_DOC_NO          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "incReqNo"'>          T1.INC_REQ_NO           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "baseRoNo"'>          T1.BASE_RO_NO           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcDocNo"'>         T1.CALC_DOC_NO          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcRegDtFormat"'>   T1.CALC_REG_DT          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcPrsnNm"'>        T1.CALC_PRSN_NM         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcDtFormat"'>      T1.CALC_DT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcLbrAmt"'>        T1.CALC_LBR_AMT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcParAmt"'>        T1.CALC_PAR_AMT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcEtcAmt"'>        T1.CALC_ETC_AMT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "lbrDcAmt"'>          T1.LBR_DC_AMT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "parDcAmt"'>          T1.PAR_DC_AMT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "pointUseAmt"'>       T1.POINT_USE_AMT        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "bmPointUseAmt"'>     T1.BM_POINT_USE_AMT     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "bmCupnUseAmt"'>      T1.BM_CUPN_USE_AMT      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcEtcDcAmt"'>      T1.CALC_ETC_DC_AMT      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "calcSumAmt"'>        T1.CALC_SUM_AMT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "paidYnNm"'>          T1.PAID_YN_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "wonUnitCutAmt"'>     T1.WON_UNIT_CUT_AMT     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "demicPointCutAmt"'>  T1.DEMIC_POINT_CUT_AMT  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "paymAmt"'>           T1.PAYM_AMT             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "rcvAmt"'>            T1.RCV_AMT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "npayAmt"'>           T1.NPAY_AMT             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "resvYnNm"'>          T1.RESV_YN_NM           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "custSaleDt"'>        T1.CUST_SALE_DT         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "firstRoYnNm"'>       T1.FIRST_RO_YN          <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "freeRoYnNm"'>        T1.FREE_RO_YN           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "ordDlrCd"'>          T1.ORD_DLR_CD           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "blueMembershipNo"'>  T1.BLUE_MEMBERSHIP_NO   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "payEndDtFormat"'>    T1.PAY_END_DT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "membershipNo"'>      T1.MEMBERSHIP_NO        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <otherwise>
                             T1.DLR_CD ASC
                            ,T1.RO_DT DESC
                            </otherwise>
                        </choose>
                    </foreach>
                    </when>
                    <otherwise>
                     T1.DLR_CD ASC
                    ,T1.RO_DT DESC
                    </otherwise>
                </choose>
            ) T2
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- RO접수현황 목록수를 조회. -->
    <select id="selectRepairOrderListByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderListByConditionCnt] */
         SELECT COUNT(RO_DOC_NO) AS VALUE FROM (
              SELECT T1.*
                FROM(
                      SELECT B.*
                            ,C.CALC_DOC_NO
                            ,(SELECT USR_NM FROM CM_0801T WHERE DLR_CD = C.DLR_CD AND USR_ID = C.REG_USR_ID) AS CALC_PRSN_NM
                            ,(SELECT MAX(RCV_CPLT_DT) FROM SE_0570T WHERE RCV_DOC_NO = D.RCV_DOC_NO) AS PAY_END_DT --지불완료시간
                            ,(SELECT ORD_DLR_CD FROM SA_0121T WHERE VIN_NO = B.VIN_NO AND ROWNUM = 1) AS ORD_DLR_CD --판매딜러
                            ,(SELECT BLUE_MEMBERSHIP_NO FROM CR_0101T WHERE DLR_CD = B.DLR_CD AND CUST_NO = B.CAR_OWNER_ID) AS BLUE_MEMBERSHIP_NO --BM회원번호
                        FROM(
                              SELECT A.DLR_CD
                                    ,A.RO_DOC_NO
                                    ,A.RO_TP
                                    ,A.VIN_NO
                                    ,A.CAR_OWNER_ID
                                    ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                                    ,(SELECT CUST_SALE_DT FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CUST_SALE_DT --차량판매일
                                FROM SE_0300T A
                                <where>
                                    <if test='sDlrCd != null and sDlrCd != ""'>
                                        AND A.DLR_CD = #{sDlrCd}
                                    </if>
                                    <if test='sRoDocNo != null and sRoDocNo != ""'>
                                        AND A.RO_DOC_NO like '%'||#{sRoDocNo}||'%'
                                    </if>
                                    <if test='sVinNo != null and sVinNo != ""'>
                                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                                    </if>
                                    <if test='sDriverId != null and sDriverId != ""'>
                                        AND DRIVER_ID = #{sDriverId}
                                    </if>
                                    <if test='sDriverNm != null and sDriverNm != ""'>
                                        AND DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                                    </if>
                                    <if test='sCarRegNo != null and sCarRegNo != ""'>
                                        AND CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                                    </if>
                                    <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                                        AND CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                                    </if>
                                    <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                                        AND A.CAR_OWNER_ID = #{sCarOwnerId}
                                    </if>
                                    <if test='sBayNo != null and sBayNo != ""'>
                                        AND A.BAY_NO = #{sBayNo}
                                    </if>
                                    <if test='sRoTp != null and sRoTp != ""'>
                                        AND A.RO_TP = #{sRoTp}
                                    </if>
                                    <if test='sRoTpList != null and !sRoTpList.isEmpty'> AND A.RO_TP IN
                                       <foreach item="item" index="index" collection="sRoTpList" open="(" separator="," close=")">
                                           #{item}
                                       </foreach>
                                    </if>
                                    <if test='sRoStatCd != null and sRoStatCd != ""'>
                                        AND A.RO_STAT_CD = #{sRoStatCd}
                                    </if>
                                    <if test='sRoFromDt != null'>
                                        AND A.RO_DT <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                                    </if>
                                    <if test='sRoToDt != null'>
                                        AND A.RO_DT <![CDATA[<]]> TO_CHAR(#{sRoToDt} + 1, 'YYYYMMDD')
                                    </if>
                                    <if test='sRoStartDt != null'>
                                        AND A.RO_START_DT <![CDATA[>=]]> #{sRoStartDt}
                                    </if>
                                    <if test='sRoEndDt != null'>
                                        AND A.RO_END_DT <![CDATA[<]]> #{sRoEndDt} + 1
                                    </if>
                                    <if test='sExpcDlFromDt != null'>
                                        AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
                                    </if>
                                    <if test='sExpcDlToDt != null'>
                                        AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
                                    </if>
                                    <if test='sDlrRoTp != null and sDlrRoTp != ""'>
                                        AND A.DLR_RO_TP = #{sDlrRoTp}
                                    </if>
                                </where>
                            )B LEFT OUTER JOIN SE_0500T C
                                ON B.RO_DOC_NO  = C.RO_DOC_NO
                               AND B.DLR_CD     = C.DLR_CD
                               AND B.RO_TP      = C.RO_TP
                               AND C.CALC_CANC_YN = 'N'
                               LEFT OUTER JOIN SE_0550T D
                                ON B.RO_DOC_NO  = D.RO_DOC_NO
                               AND B.DLR_CD     = D.DLR_CD
                               AND B.RO_TP      = D.RO_TP
                  )T1
                  <where>
                      <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                          AND T1.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
                      </if>
                      <if test='sCalcPrsnNm != null and sCalcPrsnNm != ""'>
                          AND T1.CALC_PRSN_NM LIKE '%'||#{sCalcPrsnNm}||'%'
                      </if>
                      <if test='sCalcDocNo != null and sCalcDocNo != ""'>
                          AND T1.CALC_DOC_NO LIKE '%'||#{sCalcDocNo}||'%'
                      </if>
                      <if test='sCustSaleFromDt != null'>
                          AND T1.CUST_SALE_DT <![CDATA[>=]]> #{sCustSaleFromDt}
                      </if>
                      <if test='sCustSaleToDt != null'>
                          AND T1.CUST_SALE_DT <![CDATA[<]]> #{sCustSaleToDt} + 1
                      </if>
                      </where>
              )T2
              <where>
                  <if test='sOrdDlrCd != null and sOrdDlrCd != ""'>
                      AND T2.ORD_DLR_CD LIKE '%'||#{sOrdDlrCd}||'%'
                  </if>
                  <if test='sBlueMembershipNo != null and sBlueMembershipNo != ""'>
                      AND T2.BLUE_MEMBERSHIP_NO LIKE '%'||#{sBlueMembershipNo}||'%'
                  </if>
                  <if test='sPayEndFromDt != null'>
                      AND T2.PAY_END_DT <![CDATA[>=]]> #{sPayEndFromDt}
                  </if>
                  <if test='sPayEndToDt != null'>
                      AND T2.PAY_END_DT <![CDATA[<]]> #{sPayEndToDt} + 1
                  </if>
          </where>
    </select>

    <!-- RO접수 상세 조회. -->
    <select id="selectRepairOrderByKey" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderByKey] */
        SELECT A.*
              ,B.DIAG_DOC_NO
              ,B.PRE_CHK_DT
              ,FN_SER_LTS_MODEL_CD(A.VIN_NO) AS LTS_MODEL_CD
              ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
              ,(SELECT MAX(EXPC_CHK_DT) FROM SE_0500T WHERE DLR_CD = A.DLR_CD AND VIN_NO = A.VIN_NO) AS EXPC_CHK_DT
              ,(SELECT MAX(EXPC_CHK_RUN_DIST_VAL) FROM SE_0500T WHERE DLR_CD = A.DLR_CD AND VIN_NO = A.VIN_NO) AS EXPC_CHK_RUN_DIST_VAL
              ,NVL((SELECT CMM_CD_TXT
                      FROM SE_1010T C, CM_0304T D
                     WHERE C.DLR_CD   = A.DLR_CD
                       AND CMM_CD     = NEXT_FREE_HM_CD
                       AND CMM_GRP_CD = 'SER126'
                       AND LANG_CD ='zh') ,'6') AS NEXT_FREE_MONTH
              ,NVL((SELECT CMM_CD_TXT
                      FROM SE_1010T C, CM_0304T D
                     WHERE C.DLR_CD   = A.DLR_CD
                       AND CMM_CD     = NEXT_FREE_RUN_DIST_VAL_CD
                       AND CMM_GRP_CD = 'SER127'
                       AND LANG_CD ='zh'),'5000') AS NEXT_FREE_RUN_DIST_VAL
              ,(SELECT PAR_REQ_STAT_CD
                  FROM PT_0501T
                 WHERE DLR_CD = A.DLR_CD
                   AND RO_DOC_NO = A.RO_DOC_NO
                   AND ROWNUM = 1) AS ITEM_REQ_STAT_CD
        FROM SE_0300T A
        LEFT JOIN SE_0200T B
        <!-- LIUXUEYING 根据接车检查单关联start-->
         ON A.DIAG_DOC_NO = B.DIAG_DOC_NO
         <!-- LIUXUEYING 根据接车检查单关联 end -->
         <!--  ON A.RESV_DOC_NO = B.RESV_DOC_NO-->
        AND A.DLR_CD      = B.DLR_CD
        WHERE A.DLR_CD = #{sDlrCd}
        <choose>
            <when test='sRoDocNo != null and sRoDocNo != ""'>
                AND A.RO_DOC_NO = #{sRoDocNo}
            </when>
            <when test='sResvDocNo != null and sResvDocNo != ""'>
                AND A.RESV_DOC_NO = #{sResvDocNo}
            </when>
            <otherwise>
                AND A.RO_DOC_NO = 'RO'
            </otherwise>
        </choose>
    </select>
    
    <!--交车检查维修派工/维修进度校验  -->
	<select id="selectRepairCheckByCondition" parameterType="repairOrderSearchVO" resultType="RepairCheckSearchVO">
		/* chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairCheckByCondition */
		SELECT 
			 T1.DLR_CD
			,T1.DOC_NO AS RO_DOC_NO
			,NVL(T2.WRK_STAT_CD, '01') AS WRK_STAT_CD
			,NVL(T2.QT_TEST_STAT_CD, 'Q5') AS QT_TEST_STAT_CD
			,NVL(T2.ALLOC_STAT_CD, '01') AS ALLOC_STAT_CD
		FROM SE_0170T T1 LEFT JOIN SE_0330T T2
			 ON T1.DLR_CD = T2.DLR_CD
                AND T1.DOC_NO = T2.RO_DOC_NO
                AND T1.LBR_CD = T2.RPIR_CD
                AND T1.PREFIX_ID = 'RO'
		<where>
		<if test='sDlrCd != null and sDlrCd != ""'>
		AND T1.DLR_CD = #{sDlrCd}
		</if>
        <if test='sRoDocNo != null and sRoDocNo != ""'>
		AND T1.DOC_NO = #{sRoDocNo}
		</if>
		</where>
	</select>
	
    <!-- RO 접수 조회. -->
    <select id="selectRepairOrderWorkByKey" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderWorkByKey] */
        SELECT A.*
          FROM SE_0300T A
         WHERE A.DLR_CD = #{sDlrCd}
        <if test='sRoDocNo != null and sRoDocNo != ""'>
            AND A.RO_DOC_NO = #{sRoDocNo}
        </if>
        <if test='sVinNo != null and sVinNo != ""'>
            AND A.VIN_NO = #{sVinNo}
        </if>
        <if test='sResvDocNo != null and sResvDocNo != ""'>
            AND A.RESV_DOC_NO = #{sResvDocNo}
        </if>
    </select>

    <!-- 출고취소시 RO 접수확인 -->
    <select id="selectRepairOrderCheckByKey" parameterType="RepairOrderSearchVO" resultType="string">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderCheckByKey] */
         SELECT CASE WHEN NVL(RO_CNT,0) = 0 THEN 'Y' ELSE 'N' END RESULT_YN
           FROM(
             SELECT COUNT(RO_DOC_NO) AS RO_CNT
               FROM SE_0300T
              WHERE VIN_NO = #{sVinNo}
                AND RO_STAT_CD != '06'
                <if test='sDlrCd != null and sDlrCd != ""'>
                    AND DLR_CD = #{sDlrCd}
                </if>
           )DUAL
    </select>

    <!-- 클레임 이전RO 조회 팝업 -->
    <select id="selectPreRepairOrderByConditionCnt" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectPreRepairOrderByConditionCnt] */
        SELECT COUNT(1)
              ,RO.RO_DOC_NO
              ,RO.RO_DT
              ,RO.RUN_DIST_VAL
          FROM SE_0300T RO, SE_0160T PT
         WHERE RO.DLR_CD    = PT.DLR_CD
           AND RO.RO_DOC_NO = PT.DOC_NO
           AND RO.RO_TP     = PT.RO_TP
           AND RO.DLR_CD    = #{sDlrCd}
           AND RO.VIN_NO    = #{sVinNo}
           AND RO.RO_STAT_CD IN ('00', '05')
           AND PT.PREFIX_ID = 'RO'
           AND PT.ITEM_CD   = #{sItemCd}
           AND TO_CHAR(RO.RO_DT, 'YYYYMMDD') <![CDATA[<]]> #{sRoDt}
        ORDER BY RO_DOC_NO ASC
    </select>

    <!-- 클레임 이전RO 조회 팝업 -->
    <select id="selectPreRepairOrderByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectPreRepairOrderByCondition] */
        SELECT ROWNUM RNUM
              ,RO.RO_DOC_NO
              ,RO.RO_DT
              ,RO.RUN_DIST_VAL
          FROM SE_0300T RO, SE_0160T PT
         WHERE RO.DLR_CD    = PT.DLR_CD
           AND RO.RO_DOC_NO = PT.DOC_NO
           AND RO.RO_TP     = PT.RO_TP
           AND RO.DLR_CD    = #{sDlrCd}
           AND RO.VIN_NO    = #{sVinNo}
           AND RO.RO_STAT_CD IN ('00', '05')
           AND PT.PREFIX_ID = 'RO'
           AND PT.ITEM_CD   = #{sItemCd}
           AND TO_CHAR(RO.RO_DT, 'YYYYMMDD') <![CDATA[<]]> #{sRoDt}
        ORDER BY RO_DOC_NO ASC
    </select>

    <!--  RO 정보 조회 -->
    <select id="selectRepairOrderInfoByKey" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderInfoByKey] */
              SELECT
                    DLR_CD                          --딜러코드
                   ,RO_DOC_NO                       --RO문서번호
                   ,RO_TP                           --RO유형
                   ,FN_CMM_CD_NM('SER031',A.RO_TP,#{sLangCd},'N') AS RO_TP_NM
                   ,RESV_DOC_NO                     --예약문서번호
                   ,VIN_NO                          --차대번호
                   ,CAR_REG_NO                      --차량등록번호
                   ,ENGIN_NO                        --엔진번호
                   ,CAR_OWNER_ID                    --차량소유자ID
                   ,CAR_OWNER_NM                    --차량소유자명
                   ,DRIVER_ID                       --운전자ID
                   ,DRIVER_NM                       --운전자명
                   ,RESV_TP                         --예약유형
                   ,RESV_DT                         --예약일자
                   ,BAY_NO                          --베이번호
                   ,TEC_ID                          --TechManID
                   ,TEC_NM                          --TechMan명
                   ,SA_ID                           --SAID
                   ,SA_NM                           --SA명
                   ,OPER_RESV_DT                    --작업예약일자
                   ,SER_RESV_START_DT               --서비스예약시작일자
                   ,NVL(BAL_AMT ,0 ) BAL_AMT                         --예치금액
                   ,CANC_REASON_CD                  --취소사유코드
                   ,FN_CMM_CD_NM('SER014',A.CANC_REASON_CD,#{sLangCd},'N') AS CANC_REASON_NM
                   ,CANC_REASON_CONT                --취소사유내용
                   ,CASE WHEN RO_STAT_CD ='06' THEN UPDT_DT ELSE NULL END AS RO_CANC_DT --RO 취소시간
                   ,DIST_UNIT_CD                    --거리단위코드
                   ,RUN_DIST_VAL                    --주행거리값
                   ,DIAG_DOC_NO                     --진단문서번호
                   ,BASE_RO_NO                      --원RO번호
                   ,INC_REQ_NO                      --보험신청번호
                   ,CUST_WAIT_MTH_CD                --고객대기방법코드
                   ,FN_CMM_CD_NM('SER032',A.CUST_WAIT_MTH_CD,#{sLangCd},'N') AS CUST_WAIT_MTH_NM
                   ,ATQ_PROC_TP                     --고품처리유형
                   ,FN_CMM_CD_NM('SER033',A.ATQ_PROC_TP,#{sLangCd},'N') AS ATQ_PROC_TP_NM
                   ,CAR_WASH_TP                     --차량세차유형
                   ,FN_CMM_CD_NM('SER034',A.CAR_WASH_TP,#{sLangCd},'N') AS CAR_WASH_TP_NM
                   ,CAR_DRIVE_REQ_TP                --차량시승요청유형
                   ,FN_CMM_CD_NM('SER035',A.CAR_DRIVE_REQ_TP,#{sLangCd},'N') AS CAR_DRIVE_REQ_TP_NM
                   ,EXPC_DL_DT                      --예정인도일자
                   ,ATQ_PROC_YN                     --고품처리여부
                   ,CAR_WASH_YN                     --차량세차여부
                   ,VSIT_CAR_RECEIVE_DT             --방문차량수령일자
                   ,VSIT_CAR_RECEIVE_IF_NM          --방문차량수령연계인명
                   ,VSIT_CAR_RECEIVE_CINO_NO        --방문차량수령연락처번호
                   ,VSIT_CAR_RECEIVE_ADDR_NM        --방문차량수령주소명
                   ,CAR_RECEIVE_DT                  --차량수령일자
                   ,VSIT_DL_IF_NM                   --방문인도연계인명
                   ,VSIT_DL_CINO_NO                 --방문인도연락처번호
                   ,VSIT_DL_ADDR_NM                 --방문인도주소명
                   ,VSIT_DT                         --방문일자
                   ,VSIT_IF_NM                      --방문연계인명
                   ,VSIT_CINO_NO                    --방문연락처번호
                   ,VSIT_ADDR_NM                    --방문주소명
                   ,REG_USR_ID                      --등록자ID
                   ,UPDT_USR_ID                     --수정자ID
                   ,UPDT_DT
                   ,ALLOC_EMP_ID                    --배정자ID
                   ,SER_RESV_END_DT                 --서비스예약종료일자
                   ,INC_REQ_DT                      --보험신청일자
                   ,RO_STAT_CD                      --RO상태코드
                   ,FN_CMM_CD_NM('SER030',A.RO_STAT_CD,#{sLangCd},'N') AS RO_STAT_NM
                   ,RO_DT                           --RO일자
                   ,CAR_WASH_STAT_CD                --세차상태코드
                   ,PAINT_STAT_CD                   --페인트상태코드
                   ,QT_TEST_STAT_CD                 --품질검사상태코드
                   ,RO_GRP_NO                       --RO그룹번호
                   ,PAINT_QTY                       --페인트수량
                   ,PAINT_COLOR_CD                  --페인트색상코드
                   ,CAR_COLOR_CD                    --차량색상코드
                   ,PAINT_TP                        --페인트유형
                   ,RO_START_DT                     --RO시작일자
                   ,RO_END_DT                       --RO종료일자
                   ,RO_REMARK                       --RO비고
                   ,QT_TEST_MTH_CD                  --품질검사방법코드
                   ,FN_CMM_CD_NM('SER040',A.QT_TEST_MTH_CD,#{sLangCd},'N') AS QT_TEST_MTH_NM
                   ,CHG_EXPC_DL_DT                  --변경예정인도일자
                   ,CAU_CD1                         --원인코드1
                   ,CAU_NM1                         --원인명1
                   ,PHEN_CD1                        --현상코드1
                   ,PHEN_NM1                        --현상명1
                   ,CAU_CD2                         --원인코드2
                   ,CAU_NM2                         --원인명2
                   ,PHEN_CD2                        --현상코드2
                   ,PHEN_NM2                        --현상명2
                   ,QT_TEST_START_DT                --품질검사시작일자
                   ,QT_TEST_END_DT                  --품질검사종료일자
                   ,QT_TEST_PRSN_CD                 --품질검사담당자코드
                   ,QT_TEST_PRSN_NM                 --품질검사담당자명
                   ,CAR_WASH_START_DT               --차량세차시작일자
                   ,CAR_WASH_END_DT                 --차량세차종료일자
                   ,CAR_WASH_PRSN_CD                --차량세차담당자코드
                   ,CAR_WASH_PRSN_NM                --차량세차담당자명
                   ,ROAD_TEST_CD                    --도로검사코드
                   ,PRE_AMT                         --선수금액
                   ,RWRK_CD                         --리워크코드
                   ,RWRK_REMARK                     --리워크비고
                   ,RO_END_CHK_YN                   --RO종료확인여부
                   ,ATQ_PROC_CHK_YN                 --고품처리확인여부
                   ,QT_CHK_YN                       --품질확인여부
                   ,CAR_WASH_CHK_YN                 --차량세차확인여부
                   ,SER_TAG_CHK_YN                  --서비스태그확인여부
                   ,GI_RUN_DIST_VAL                 --주행거리값
                   ,DL_CHK_PRSN_CD                  --인도확인자코드
                   ,DL_CHK_PRSN_NM                  --인도확인자명
                   ,CAR_WASH_CANC_DT                --차량세차취소일자
                   ,ALLOC_STAT_CD                   --배정상태코드
                   ,FN_CMM_CD_NM('SER043',ALLOC_STAT_CD,#{sLangCd},'N') AS ALLOC_STAT_NM
                   ,WRK_STAT_CD                     --작업상태코드
                   ,FN_CMM_CD_NM('SER050',A.WRK_STAT_CD,#{sLangCd},'N') AS WRK_STAT_NM
                   ,DL_STAT_CD                      --인도상태코드
                   ,NVL(GOODWILL_YN,'N') AS GOODWILL_YN --GOODWILL여부
                   ,FN_CMM_CD_NM('COM020',GOODWILL_YN,#{sLangCd},'N') AS GOODWILL_YN_NM
                   ,NVL(GOODWILL_STAT_CD,'O') AS GOODWILL_STAT_CD --GOODWILL 사용여부
                   ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1 ) AS LAST_RUN_DIST_VAL
                   ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO  AND ROWNUM = 1) AS CARLINE_NM
                   ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                   ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                   ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) AS UPDT_USR_NM
                   ,EXPC_DL_DT - 30/(24*60) AS EXPC_DL_START_DT  -- 예정인도시간
                   ,RO_PRINT_DT
                   ,DLR_RO_TP
                   ,FN_CMM_CD_NM('SER044',A.DLR_RO_TP,#{sLangCd},'N') AS DLR_RO_TP_NM
                   ,CASE WHEN RO_STAT_CD = '05' THEN 'Y' ELSE 'N' END AS PAID_YN
                   ,( SELECT MAX(WRK_END_DT)
                       FROM SE_0330T
                      WHERE DLR_CD = A.DLR_CD
                        AND RO_DOC_NO = A.RO_DOC_NO
                     ) AS WRK_END_DT --배정 완료시간
             FROM SE_0300T A
            WHERE DLR_CD    = #{sDlrCd}
              AND RO_DOC_NO =  #{sRoDocNo}
            <if test='sVinNo != null and sVinNo != ""'>
                AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
            </if>
            <if test='sDriverId != null and sDriverId != ""'>
                AND A.DRIVER_ID = #{sDriverId}
            </if>
            <if test='sDriverNm != null and sDriverNm != ""'>
                AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
            </if>
            <if test='sCarRegNo != null and sCarRegNo != ""'>
                AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
            </if>
            <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
            </if>
            <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                AND A.CAR_OWNER_ID = #{sCarOwnerId}
            </if>
            <if test='sBayNo != null and sBayNo != ""'>
                AND A.BAY_NO = #{sBayNo}
            </if>
            <if test='sRoTp != null and sRoTp != ""'>
                AND A.RO_TP = #{sRoTp}
            </if>
            <if test='sRoStatCd != null and sRoStatCd != ""'>
                AND A.RO_STAT_CD = #{sRoStatCd}
            </if>
    </select>

    <!--  RO 작업진도 칸반 -->
    <select id="selectWorkProcessKanban" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectWorkProcessKanban] */
            SELECT
                T1.DLR_CD
                ,T1.RO_DOC_NO
                ,T1.VIN_NO
                ,T1.RESV_DOC_NO
                ,T1.RO_TP
                ,T1.CAR_REG_NO
                ,T1.CAR_OWNER_ID
                ,T1.CAR_OWNER_NM
                ,T1.DRIVER_ID
                ,T1.RO_DT
                ,T1.EXPC_DL_DT
                ,T1.DRIVER_NM
                ,NVL(T1.BAY_NO,(SELECT  MAX(BAY_NO) FROM SE_0330T WHERE RO_DOC_NO = T1.RO_DOC_NO AND DLR_CD = T1.DLR_CD AND RPIR_TP != '04')) AS BAY_NO
                ,(SELECT  MAX(BAY_NO) FROM SE_0330T WHERE RO_DOC_NO = T1.RO_DOC_NO AND DLR_CD = T1.DLR_CD AND RPIR_TP = '04') AS BP_NO
                ,T1.SA_ID
                ,T1.SA_NM
                ,T1.DIAG_DOC_NO
                ,T1.EXPC_DL_DT
                ,T1.RO_GRP_NO
                ,T1.RO_START_DT
                ,T1.RO_REMARK
                ,T1.ALLOC_EMP_ID
                ,T1.CAR_WASH_PRSN_CD
                ,T1.CAR_WASH_PRSN_NM
                ,T1.CAR_WASH_START_DT
                ,NVL(T1.CAR_WASH_END_DT,T1.QT_TEST_START_DT+1/24) AS CAR_WASH_END_DT
                ,T1.QT_TEST_PRSN_CD
                ,T1.QT_TEST_PRSN_NM
                ,T1.QT_TEST_START_DT
                ,NVL(T1.QT_TEST_END_DT,T1.QT_TEST_START_DT+1/24) AS QT_TEST_END_DT
                ,T1.RO_START_DT+(SELECT SUM(LBR_HM) FROM SE_0320T WHERE DLR_CD=T1.DLR_CD AND RO_DOC_NO = T1.RO_DOC_NO)/24 RO_END_DT
            FROM SE_0300T T1
           WHERE(GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
            <if test='sRoFromDt != null'>
                AND T1.RO_DT <![CDATA[>=]]> #{sRoFromDt} AND T1.RO_DT <![CDATA[<]]> #{sRoFromDt} + 1
            </if>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND T1.DLR_CD = #{sDlrCd}
            </if>
             ORDER BY RO_DT DESC
    </select>

    <!--  RO 페인트 칸반 -->
    <select id="selectPaintKanban" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectPaintKanban] */
            SELECT CAR_REG_NO
                   ,RO_DOC_NO
                   ,PAINT_STAT_CD
                   ,T1.DLR_CD
                    ,T1.VIN_NO
                    ,T1.RESV_DOC_NO
                    ,T1.RO_TP
                    ,T1.CAR_OWNER_ID
                    ,T1.CAR_OWNER_NM
                    ,T1.DRIVER_ID
                    ,T1.RO_DT
                    ,T1.DRIVER_NM
                    ,T1.SA_ID
                    ,T1.SA_NM
                    ,T1.DIAG_DOC_NO
                    ,T1.RO_GRP_NO
                    ,T1.RO_REMARK
                    ,T1.ALLOC_EMP_ID
                    ,T1.CAR_WASH_PRSN_CD
                    ,T1.CAR_WASH_PRSN_NM
                    ,T1.CAR_WASH_START_DT
                    ,T1.QT_TEST_PRSN_CD
                    ,T1.QT_TEST_PRSN_NM
                    ,T1.QT_TEST_START_DT
                   ,CASE WHEN T1.RN='1' THEN  to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd')+8/24
                         WHEN T1.RN='2' THEN  to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd')+9/24
                         WHEN T1.RN='3' THEN  to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd')+10/24
                         WHEN T1.RN='4' THEN  to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd')+11/24
                         WHEN T1.RN='5' THEN  to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd')+12/24
                         WHEN T1.RN='6' THEN  to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd')+13/24
                         WHEN T1.RN='7' THEN  to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd')+14/24 END RO_START_DT
                   ,CASE WHEN T1.RN='1' THEN  to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd')+9/24
                         WHEN T1.RN='2' THEN  to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd')+10/24
                         WHEN T1.RN='3' THEN  to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd')+11/24
                         WHEN T1.RN='4' THEN  to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd')+12/24
                         WHEN T1.RN='5' THEN  to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd')+13/24
                         WHEN T1.RN='6' THEN  to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd')+14/24
                         WHEN T1.RN='7' THEN  to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd')+15/24 END RO_END_DT
                   ,T1.RN
            FROM
            (
            SELECT
                T2.CAR_REG_NO
                ,T1.RO_DOC_NO
                ,T1.PAINT_STAT_CD
                ,ROW_NUMBER() OVER(partition by T1.PAINT_STAT_CD order by T1.RO_DOC_NO desc) AS RN
                ,T2.DLR_CD
                ,T2.VIN_NO
                ,T2.RESV_DOC_NO
                ,T2.RO_TP
                ,T2.CAR_OWNER_ID
                ,T2.CAR_OWNER_NM
                ,T2.DRIVER_ID
                ,T2.RO_DT
                ,T2.EXPC_DL_DT
                ,T2.DRIVER_NM
                ,T2.SA_ID
                ,T2.SA_NM
                ,T2.DIAG_DOC_NO
                ,T2.EXPC_DL_DT AS EXPC_DL_DT
                ,T2.RO_GRP_NO
                ,T2.RO_START_DT
                ,T2.RO_REMARK
                ,T2.ALLOC_EMP_ID
                ,T2.CAR_WASH_PRSN_CD
                ,T2.CAR_WASH_PRSN_NM
                ,T2.CAR_WASH_START_DT
                ,T2.QT_TEST_PRSN_CD
                ,T2.QT_TEST_PRSN_NM
                ,T2.QT_TEST_START_DT
                FROM SE_0330T T1
                    INNER JOIN SE_0300T T2
                    ON T1.RO_DOC_NO = T2.RO_DOC_NO
                WHERE T1.RPIR_TP = '04'
                 AND (T2.GOODWILL_YN != 'Y' OR T2.GOODWILL_YN IS NULL )
                ) T1
            <if test='sRoFromDt != null'>
                AND T1.RO_DT <![CDATA[>=]]> #{sRoFromDt} AND T1.RO_DT <![CDATA[<]]> #{sRoFromDt} + 1
            </if>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND T1.DLR_CD = #{sDlrCd}
            </if>
    </select>


    <!--  RO 세차및품질검사 칸반 -->
    <select id="selectDeliveryKanban" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectDeliveryKanban] */
        SELECT   T.*
                ,TO_DATE(TO_CHAR(DL_DT,'YYYYMMDD')||(S_DATE||S_MM),'YYYYMMDD HH24MI') AS EXPC_DL_START_DT
                ,TO_DATE(TO_CHAR(DL_DT,'YYYYMMDD')||(S_DATE||E_MM),'YYYYMMDD HH24MI') AS EXPC_DL_DT
                ,ROW_NUMBER() OVER( PARTITION BY (S_DATE||S_MM) ORDER BY S_DATE) AS GRP_NO
          FROM (
             SELECT  DLR_CD
                    ,RO_DOC_NO
                    ,VIN_NO
                    ,CAR_REG_NO
                    ,CAR_OWNER_ID
                    ,CAR_OWNER_NM
                    ,DRIVER_ID
                    ,DRIVER_NM
                    ,TEC_ID
                    ,TEC_NM
                    ,RO_DT
                    ,RO_GRP_NO
                    ,RO_START_DT
                    ,RO_END_DT
                    ,RO_REMARK
                    ,EXPC_DL_DT AS DL_DT
                    ,CASE WHEN (TO_CHAR( EXPC_DL_DT,'mi') ) <![CDATA[<=]]> 30 THEN  0 ELSE 30 END AS S_MM
                    ,CASE WHEN (TO_CHAR( EXPC_DL_DT,'mi') ) <![CDATA[<=]]> 30 THEN 20 ELSE 50 END AS E_MM
                    ,SUBSTR(TO_CHAR( EXPC_DL_DT ,'hh24mi'),0,2) S_DATE
                    ,REG_USR_ID
                    ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                    ,FN_CMM_CD_NM('SER031',A.RO_TP,#{sLangCd},'N') AS RO_TP_NM
                    ,FN_CMM_CD_NM('SER030',A.RO_STAT_CD,#{sLangCd},'N') AS RO_STAT_NM
                FROM SE_0300T A
               WHERE A.DLR_CD = #{sDlrCd}
                <if test='sExpcDlFromDt != null'>
                    AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt} AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlFromDt} + 1
                </if>
                 AND A.RO_STAT_CD != '06'
                 AND EXPC_DL_DT IS NOT NULL
                 AND (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL)
            ) T
            <where>
                <if test='sRegUsrId != null and sRegUsrId != ""'>
                    AND T.REG_USR_ID = #{sRegUsrId}
                </if>
                <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                    AND T.REG_USR_NM = #{sRegUsrNm}
                </if>
            </where>
            ORDER BY RO_DT DESC
    </select>

    <!--  인도현황 간반보드  가로 컬럼 정보 조회 -->
    <select id="selectDeliveryKanbanRowsByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectDeliveryKanbanRowsByCondition] */

        SELECT LEVEL AS GRP_NO
          FROM DUAL
         CONNECT BY LEVEL <![CDATA[<=]]> 10
    </select>

    <!--  RO 세차및품질검사 칸반 -->
    <select id="selectCarWashKanban" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectCarWashKanban] */
            SELECT
                MAX(T1.DLR_CD) AS DLR_CD
                ,MAX(T1.VIN_NO) AS VIN_NO
                ,MAX(T1.CAR_REG_NO) AS CAR_REG_NO
                ,MAX(T1.CAR_OWNER_ID) AS CAR_OWNER_ID
                ,MAX(T1.CAR_OWNER_NM) AS CAR_OWNER_NM
                ,MAX(T1.DRIVER_ID) AS DRIVER_ID
                ,MAX(T1.DRIVER_NM) AS DRIVER_NM
                ,T1.RO_GRP_NO
                ,MAX(T1.CAR_WASH_PRSN_CD) AS CAR_WASH_PRSN_CD
                ,MAX(T1.CAR_WASH_PRSN_NM) AS CAR_WASH_PRSN_NM
                ,MAX(T1.CAR_WASH_START_DT) AS CAR_WASH_START_DT
                ,MAX(NVL(T1.CAR_WASH_END_DT,T1.QT_TEST_START_DT+1/24)) AS CAR_WASH_END_DT
                ,MAX(T1.QT_TEST_PRSN_CD) AS QT_TEST_PRSN_CD
                ,MAX(T1.QT_TEST_PRSN_NM) AS QT_TEST_PRSN_NM
                ,MAX(T1.QT_TEST_START_DT) AS QT_TEST_START_DT
                ,MAX(NVL(T1.QT_TEST_END_DT,T1.QT_TEST_START_DT+1/24)) AS QT_TEST_END_DT
                ,MAX(T1.RO_START_DT+(SELECT SUM(LBR_HM) FROM SE_0320T WHERE DLR_CD=T1.DLR_CD AND RO_DOC_NO = T1.RO_DOC_NO)/24) AS RO_END_DT
            FROM SE_0300T T1
           WHERE (GOODWILL_YN != 'Y' OR GOODWILL_YN IS NULL )
            <if test='sRoFromDt != null'>
                AND T1.RO_DT <![CDATA[>=]]> #{sRoFromDt} AND T1.RO_DT <![CDATA[<]]> #{sRoFromDt} + 1
            </if>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND T1.DLR_CD = #{sDlrCd}
            </if>
            GROUP BY T1.RO_GRP_NO
            ORDER BY RO_GRP_NO DESC
    </select>

     <!-- 사전점검 마스터 수정 -->
    <update id="updatePreCheckStat" parameterType="RepairOrderVO" >
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.updatePreCheckStat] */
         UPDATE SE_0200T    --입고점검
            SET DIAG_STAT_CD      = #{diagStatCd}   --사전점검상태
               ,UPDT_DT           = SYSDATE         --수정일자
               ,UPDT_USR_ID       = #{updtUsrId}    --수정자ID
          WHERE DIAG_DOC_NO      = #{diagDocNo}               --진단문서번호
            AND DLR_CD           = #{dlrCd}                   --딜러코드
   </update>

    <!-- 정비진도 목록 조회. -->
    <select id="selectRepairOrderProcessByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderProcessByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT F.* FROM (
                    SELECT B.*, C.PAUSE_CAU_CD FROM (
                        SELECT A.*
                        FROM SE_0300T A
                       WHERE A.DLR_CD = #{sDlrCd}
                        <if test='sRoDocNo != null and sRoDocNo != ""'>
                            AND A.RO_DOC_NO like '%'||#{sRoDocNo}||'%'
                        </if>
                        <if test='sVinNo != null and sVinNo != ""'>
                            AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                        </if>
                        <if test='sTecNm != null and sTecNm != ""'>
                            AND A.TEC_NM LIKE '%'||#{sTecNm}||'%'
                        </if>
                        <if test='sSaNm != null and sSaNm != ""'>
                            AND A.SA_NM LIKE '%'||#{sSaNm}||'%'
                        </if>
                        <if test='sSaId != null and sSaId != ""'>
                            AND A.SA_ID = #{sSaId}
                        </if>
                        <if test='sDriverId != null and sDriverId != ""'>
                            AND DRIVER_ID = #{sDriverId}
                        </if>
                        <if test='sDriverNm != null and sDriverNm != ""'>
                            AND DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                        </if>
                        <if test='sCarRegNo != null and sCarRegNo != ""'>
                            AND CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                        </if>
                        <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                            AND CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                        </if>
                        <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                            AND A.CAR_OWNER_ID = #{sCarOwnerId}
                        </if>
                        <if test='sBayNo != null and sBayNo != ""'>
                            AND A.BAY_NO = #{sBayNo}
                        </if>
                        <if test='sRoStatCd != null and sRoStatCd != ""'>
                            AND A.RO_STAT_CD = #{sRoStatCd}
                        </if>
                        <if test='sAtqProcTp != null and sAtqProcTp != ""'>
                            AND A.ATQ_PROC_TP = #{sAtqProcTp}
                        </if>
                        <if test='sPaintStatCd != null and sPaintStatCd != ""'>
                            AND A.PAINT_STAT_CD = #{sPaintStatCd}
                        </if>
                        <if test='sQtTestStatCd != null and sQtTestStatCd != ""'>
                            AND A.QT_TEST_STAT_CD = #{sQtTestStatCd}
                        </if>
                        <if test='sCarWashStatCd != null and sCarWashStatCd != ""'>
                            AND A.CAR_WASH_STAT_CD = #{sCarWashStatCd}
                        </if>
                        <if test='sResvDocNo != null and sResvDocNo != ""'>
                            AND A.RESV_DOC_NO = #{sResvDocNo}
                        </if>
                        <if test='sRoTp != null and sRoTp != ""'>
                            AND A.RO_TP = #{sRoTp}
                        </if>
                        <if test='sRoFromDt != null'>
                            AND A.RO_DT <![CDATA[>=]]> #{sRoFromDt}
                        </if>
                        <if test='sRoToDt != null'>
                            AND A.RO_DT <![CDATA[<]]> #{sRoToDt} + 1
                        </if>
                        <if test='sExpcDlFromDt != null'>
                            AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
                        </if>
                        <if test='sExpcDlToDt != null'>
                            AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
                        </if>
                        <if test='sWrkStatCd != null and sWrkStatCd != ""'>
                            AND A.WRK_STAT_CD = #{sWrkStatCd}
                        </if>
                        <if test='sCarWashYn != null and sCarWashYn !=""'>
                            AND (A.CAR_WASH_TP != '04' OR A.CAR_WASH_TP IS NULL)
                        </if>
                        <if test='sQtTestYn != null and sQtTestYn !=""'>
                            AND A.QT_TEST_MTH_CD = '01'
                        </if>
                        <if test='sAllocStatCd != null and sAllocStatCd !=""'>
                            AND A.ALLOC_STAT_CD = #{sAllocStatCd}
                        </if>
                        <if test='sListType != null and sListType != ""'>
                            <choose>
                                <when test='sListType == "AL"'>
                                    AND A.RO_STAT_CD IN ('01', '02')
                                    AND A.ALLOC_STAT_CD IN ('01', '02', '03')
                                    AND (A.WRK_STAT_CD = '01' OR A.WRK_STAT_CD IS NULL)
                                    AND (A.GOODWILL_YN != 'Y' OR A.GOODWILL_YN IS NULL )
                                </when>
                                <when test='sListType == "WRK"'>
                                    AND A.RO_STAT_CD = '02'
                                    AND A.ALLOC_STAT_CD = '03'
                                    AND (A.QT_TEST_STAT_CD = 'Q5' OR A.QT_TEST_STAT_CD IS NULL)
                                    AND (A.DL_STAT_CD = '01' OR A.DL_STAT_CD IS NULL)
                                    AND A.WRK_STAT_CD IN ('01', '02', '03', '04', '05')
                                    AND (A.GOODWILL_YN != 'Y' OR A.GOODWILL_YN IS NULL )
                                </when>
                                <when test='sListType == "QT"'>
                                    AND A.RO_STAT_CD = '02'
                                    AND A.WRK_STAT_CD = '05'
                                    AND A.QT_TEST_STAT_CD IN ('Q1', 'Q2', 'Q3', 'Q5')
                                    AND (A.GOODWILL_YN != 'Y' OR A.GOODWILL_YN IS NULL )
                                </when>
                                <when test='sListType == "CWA"'>
                                    AND A.RO_STAT_CD = '02'
                                    AND A.WRK_STAT_CD = '05'
                                    AND A.CAR_WASH_TP IN ('01', '02', '03')
                                    AND (A.GOODWILL_YN != 'Y' OR A.GOODWILL_YN IS NULL )
                                </when>
                                <when test='sListType == "DL"'>
                                    AND A.RO_STAT_CD IN ('02', '03')
                                    AND A.WRK_STAT_CD = '05'
                                    AND A.DL_STAT_CD IN ('01', '02')
                                    AND (A.GOODWILL_YN != 'Y' OR A.GOODWILL_YN IS NULL )
                                </when>
                            </choose>
                        </if>
                    ) B LEFT OUTER JOIN SE_0330T C
                    ON B.RO_DOC_NO  = C.RO_DOC_NO
                    AND B.DLR_CD    = C.DLR_CD
                    AND C.LINE_NO = 1
                ) F
                <where>
                    <if test='sPauseCauCd != null and sPauseCauCd !=""'>
                        AND F.PAUSE_CAU_CD = #{sPauseCauCd}
                        AND F.PAUSE_CAU_CD IS NOT NULL
                    </if>
                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                    <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                        <choose>
                            <when test='item.field == "dlrCd"'>F.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roDocNo"'>F.RO_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "roTp"'>F.RO_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "resvDocNo"'>F.RESV_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "vinNo"'>F.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carRegNo"'>F.CAR_REG_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "enginNo"'>F.ENGIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carOwnerId"'>F.CAR_OWNER_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carOwnerNm"'>F.CAR_OWNER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "driverNm"'>F.DRIVER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <otherwise>
                             F.DLR_CD ASC
                            ,F.REG_DT DESC
                            ,F.RO_TP ASC
                            </otherwise>
                        </choose>
                    </foreach>
                    </when>
                    <otherwise>
                    F.DLR_CD ASC
                    ,F.REG_DT DESC
                    ,F.RO_TP ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 정비진도 목록수를 조회. -->
    <select id="selectRepairOrderProcessByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderProcessByConditionCnt] */
        SELECT COUNT(F.RO_DOC_NO) AS VALUE
            FROM (
                SELECT B.*, C.PAUSE_CAU_CD FROM (
                    SELECT A.*
                      FROM SE_0300T A
                     WHERE A.DLR_CD = #{sDlrCd}
                    <if test='sRoDocNo != null and sRoDocNo != ""'>
                        AND A.RO_DOC_NO like '%'||#{sRoDocNo}||'%'
                    </if>
                    <if test='sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>
                    <if test='sTecNm != null and sTecNm != ""'>
                        AND A.TEC_NM LIKE '%'||#{sTecNm}||'%'
                    </if>
                    <if test='sSaNm != null and sSaNm != ""'>
                        AND A.SA_NM LIKE '%'||#{sSaNm}||'%'
                    </if>
                    <if test='sSaId != null and sSaId != ""'>
                        AND A.SA_ID = #{sSaId}
                    </if>
                    <if test='sDriverId != null and sDriverId != ""'>
                        AND A.DRIVER_ID = #{sDriverId}
                    </if>
                    <if test='sDriverNm != null and sDriverNm != ""'>
                        AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                    </if>
                    <if test='sCarRegNo != null and sCarRegNo != ""'>
                        AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                    </if>
                    <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                        AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                    </if>
                    <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                        AND A.CAR_OWNER_ID = #{sCarOwnerId}
                    </if>
                    <if test='sBayNo != null and sBayNo != ""'>
                        AND A.BAY_NO = #{sBayNo}
                    </if>
                    <if test='sRoStatCd != null and sRoStatCd != ""'>
                        AND A.RO_STAT_CD = #{sRoStatCd}
                    </if>
                    <if test='sAtqProcTp != null and sAtqProcTp != ""'>
                        AND A.ATQ_PROC_TP = #{sAtqProcTp}
                    </if>
                    <if test='sPaintStatCd != null and sPaintStatCd != ""'>
                        AND A.PAINT_STAT_CD = #{sPaintStatCd}
                    </if>
                    <if test='sQtTestStatCd != null and sQtTestStatCd != ""'>
                        AND A.QT_TEST_STAT_CD = #{sQtTestStatCd}
                    </if>
                    <if test='sCarWashStatCd != null and sCarWashStatCd != ""'>
                        AND A.CAR_WASH_STAT_CD = #{sCarWashStatCd}
                    </if>
                    <if test='sResvDocNo != null and sResvDocNo != ""'>
                        AND A.RESV_DOC_NO = #{sResvDocNo}
                    </if>
                    <if test='sRoTp != null and sRoTp != ""'>
                        AND A.RO_TP = #{sRoTp}
                    </if>
                    <if test='sRoFromDt != null'>
                        AND A.RO_DT <![CDATA[>=]]> #{sRoFromDt}
                    </if>
                    <if test='sRoToDt != null'>
                        AND A.RO_DT <![CDATA[<]]> #{sRoToDt} + 1
                    </if>
                    <if test='sExpcDlFromDt != null'>
                        AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
                    </if>
                    <if test='sExpcDlToDt != null'>
                        AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
                    </if>
                    <if test='sWrkStatCd != null and sWrkStatCd != ""'>
                        AND A.WRK_STAT_CD = #{sWrkStatCd}
                    </if>
                    <if test='sCarWashYn != null and sCarWashYn !=""'>
                        AND (A.CAR_WASH_TP != '04' OR A.CAR_WASH_TP IS NULL)
                    </if>
                    <if test='sQtTestYn != null and sQtTestYn !=""'>
                        AND A.QT_TEST_MTH_CD = '01'
                    </if>
                    <if test='sAllocStatCd != null and sAllocStatCd !=""'>
                        AND A.ALLOC_STAT_CD = #{sAllocStatCd}
                    </if>
                    <if test='sListType != null and sListType != ""'>
                        <choose>
                            <when test='sListType == "AL"'>
                                AND A.RO_STAT_CD IN ('01', '02')
                                AND A.ALLOC_STAT_CD IN ('01', '02', '03')
                                AND (A.WRK_STAT_CD = '01' OR A.WRK_STAT_CD IS NULL)
                                AND (A.GOODWILL_YN != 'Y' OR A.GOODWILL_YN IS NULL )
                            </when>
                            <when test='sListType == "WRK"'>
                                AND A.RO_STAT_CD = '02'
                                AND A.ALLOC_STAT_CD = '03'
                                AND (A.QT_TEST_STAT_CD = 'Q5' OR A.QT_TEST_STAT_CD IS NULL)
                                AND (A.DL_STAT_CD = '01' OR A.DL_STAT_CD IS NULL)
                                AND A.WRK_STAT_CD IN ('01', '02', '03', '04', '05')
                                AND (A.GOODWILL_YN != 'Y' OR A.GOODWILL_YN IS NULL )
                            </when>
                            <when test='sListType == "QT"'>
                                AND A.RO_STAT_CD = '02'
                                AND A.WRK_STAT_CD = '05'
                                AND A.QT_TEST_STAT_CD IN ('Q1', 'Q2', 'Q3', 'Q5')
                                AND (A.GOODWILL_YN != 'Y' OR A.GOODWILL_YN IS NULL )
                            </when>
                            <when test='sListType == "CWA"'>
                                AND A.RO_STAT_CD = '02'
                                AND A.WRK_STAT_CD = '05'
                                AND A.CAR_WASH_TP IN ('01', '02', '03')
                                AND (A.GOODWILL_YN != 'Y' OR A.GOODWILL_YN IS NULL )
                            </when>
                            <when test='sListType == "DL"'>
                                AND A.RO_STAT_CD IN ('02', '03')
                                AND A.WRK_STAT_CD = '05'
                                AND A.DL_STAT_CD IN ('01', '02')
                                AND (A.GOODWILL_YN != 'Y' OR A.GOODWILL_YN IS NULL )
                            </when>
                        </choose>
                    </if>
            )B LEFT OUTER JOIN SE_0330T C
              ON B.RO_DOC_NO  = C.RO_DOC_NO
            AND B.DLR_CD     = C.DLR_CD
            AND C.LINE_NO = 1
        ) F
        <where>
            <if test='sPauseCauCd != null and sPauseCauCd !=""'>
                AND F.PAUSE_CAU_CD = #{sPauseCauCd}
                AND F.PAUSE_CAU_CD IS NOT NULL
            </if>
        </where>
    </select>

    <!-- 인도 체크 화면에서 RO 취소시 작업배분 데이터 삭제  -->
    <delete id="deleteDelivery" parameterType="RepairOrderVO" >
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.deleteDelivery] */
        DELETE FROM SE_0330T
         WHERE 1 = 1
           AND DLR_CD         = #{dlrCd}                   --딜러코드
           AND RO_DOC_NO      = #{roDocNo}               --RO문서번호
    </delete>

    <!-- 서비스이력 조회  -->
    <select id="selectRepairOrderHistoryByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderHistoryByCondition] */
        SELECT DLR_CD
              ,RO_DOC_NO
              ,RO_TP
              ,RO_TP_NM
              ,VIN_NO
              ,CAR_REG_NO
              ,CAR_OWNER_ID
              ,CAR_OWNER_NM
              ,DRIVER_ID
              ,DRIVER_NM
              ,RUN_DIST_VAL
              ,BASE_RO_NO
              ,RO_STAT_CD
              ,RO_STAT_NM
              ,RO_DT
              ,RO_GRP_NO
              ,RO_START_DT
              ,RO_END_DT
              ,RO_REMARK
              ,CALC_REMARK
              ,LAST_RUN_DIST_VAL
              ,REG_USR_NM
              ,CARLINE_NM
              ,MODEL_NM
              ,RO_PRINT_DT
              ,UPDT_DT
              ,CALC_DOC_NO
              ,CALC_PRSN_NM
              ,CALC_REG_DT
              ,CALC_DT
              ,CALC_COMP_USR_NM
              ,FN_CMM_CD_NM('COM020',PAYM_YN,#{sLangCd},'N') AS PAYM_YN_NM
            FROM (
            SELECT D.* , ROW_NUMBER() OVER(PARTITION BY DLR_CD , VIN_NO , RO_DOC_NO ORDER BY DLR_CD , VIN_NO , RO_DOC_NO ) AS RN
              FROM(
                  SELECT A.*
                        ,B.ITEM_CD
                        ,B.ITEM_NM
                        ,C.LBR_CD
                        ,C.LBR_NM
                    FROM (
                         SELECT RO.DLR_CD
                               ,RO.RO_DOC_NO
                               ,RO.RO_TP
                               ,FN_CMM_CD_NM('SER031',RO.RO_TP, #{sLangCd}, 'N') AS RO_TP_NM
                               ,RO.VIN_NO
                               ,RO.CAR_REG_NO
                               ,RO.CAR_OWNER_ID
                               ,RO.CAR_OWNER_NM
                               ,RO.DRIVER_ID
                               ,RO.DRIVER_NM
                               ,RO.RUN_DIST_VAL
                               ,RO.GI_RUN_DIST_VAL AS LAST_RUN_DIST_VAL
                               ,RO.BASE_RO_NO
                               ,RO.RO_STAT_CD
                               ,FN_CMM_CD_NM('SER030',RO.RO_STAT_CD, #{sLangCd}, 'N') AS RO_STAT_NM
                               ,RO.RO_DT
                               ,RO.RO_GRP_NO
                               ,RO.RO_START_DT
                               ,RO.RO_END_DT
                               ,RO.RO_REMARK
                               ,CA.CALC_REMARK
                               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = RO.REG_USR_ID AND DLR_CD = RO.DLR_CD) AS REG_USR_NM
                               ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = RO.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                               ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = RO.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                               ,RO.RO_PRINT_DT
                               ,RO.UPDT_DT
                               ,CA.CALC_DOC_NO
                               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = CA.REG_USR_ID AND DLR_CD = CA.DLR_CD) AS CALC_PRSN_NM
                               ,CA.REG_DT AS CALC_REG_DT
                               ,CA.CALC_DT
                               ,CA.CALC_COMP_USR_NM
                               ,CASE WHEN RO.RO_STAT_CD = '05' THEN 'Y' ELSE 'N' END AS PAYM_YN
                           FROM SE_0300T RO, SE_0500T CA, SE_0550T RCV, SA_0121T VM
                          WHERE RO.DLR_CD = #{sDlrCd}
                            AND CA.DLR_CD(+)     = RO.DLR_CD
                            AND CA.RO_DOC_NO(+)  = RO.RO_DOC_NO
                            AND RCV.DLR_CD(+)    = RO.DLR_CD
                            AND RCV.RO_DOC_NO(+) = RO.RO_DOC_NO
                            AND RO.VIN_NO = VM.VIN_NO
                            AND RO.RO_DT >= VM.CUST_SALE_DT
                            AND (RO.GOODWILL_YN != 'Y' OR RO.GOODWILL_YN IS NULL )
                            AND RO.RO_STAT_CD IN ('00', '05')
                            AND CA.CALC_STAT_CD(+) = '00'
                            AND CA.CALC_CANC_YN(+) = 'N'
                            <if test='sVinNo != null and sVinNo !=""'>
                                AND RO.VIN_NO = #{sVinNo}
                            </if>
                            <if test='sDlrCd != null and sDlrCd !=""'>
                                AND RO.DLR_CD = #{sDlrCd}
                            </if>
                            <if test='sRoDocNo != null and sRoDocNo !=""'>
                                AND RO.RO_DOC_NO = #{sRoDocNo}
                            </if>
                            <if test='sDriverNm != null and sDriverNm !=""'>
                                AND RO.DRIVER_NM = #{sDriverNm}
                            </if>
                            <if test='sRoTp != null and sRoTp !=""'>
                                AND RO.RO_TP = #{sRoTp}
                            </if>
                            <if test='sRoFromDt != null'>
                                AND RO.RO_DT <![CDATA[>=]]> #{sRoFromDt}
                            </if>
                            <if test='sRoToDt != null'>
                                AND RO.RO_DT <![CDATA[<]]> #{sRoToDt} + 1
                            </if>
                            <if test='sCarRegNo != null and sCarRegNo !=""'>
                                AND RO.CAR_REG_NO = #{sCarRegNo}
                            </if>
                            <if test='sCarOwnerId != null and sCarOwnerId !=""'>
                                AND RO.CAR_OWNER_ID = #{sCarOwnerId}
                            </if>
                            <if test='sCarOwnerNm != null and sCarOwnerNm !=""'>
                                AND RO.CAR_OWNER_NM = #{sCarOwnerNm}
                            </if>
                            <if test='sRoStatCd != null and sRoStatCd !=""'>
                                AND RO.RO_STAT_CD = #{sRoStatCd}
                            </if>
                     )A LEFT OUTER JOIN SE_0160T B
                     ON A.DLR_CD    = B.DLR_CD
                    AND A.RO_DOC_NO = B.DOC_NO
                    AND B.PREFIX_ID = 'RO'
                    LEFT OUTER JOIN SE_0170T C
                     ON A.DLR_CD    = C.DLR_CD
                    AND A.RO_DOC_NO = C.DOC_NO
                    AND C.PREFIX_ID = 'RO'
              )D WHERE 1=1
                 <if test='sLbrNm != null and sLbrNm !=""'>
                    AND LBR_NM = #{sLbrNm}
                 </if>
                 <if test='sItemNm != null and sItemNm !=""'>
                    AND ITEM_NM = #{sItemNm}
                 </if>
                 <if test='sRegUsrNm != null and sRegUsrNm !=""'>
                    AND REG_USR_NM = #{sRegUsrNm}
                 </if>
        ) WHERE RN = 1
        ORDER BY
        <choose>
            <when test='sort != null'>
                <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                    <choose>
                        <when test='item.field == "roDtFormat"'>      RO_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "roPrintDtFormat"'> RO_PRINT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "updtDtFormat"'>    UPDT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "calcRegDtFormat"'> CALC_REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "calcDtFormat"'>    CALC_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <otherwise>
                            RO_START_DT DESC
                        </otherwise>
                    </choose>
                </foreach>
            </when>
            <otherwise>
                RO_START_DT DESC
            </otherwise>
        </choose>
    </select>

    <select id="selectCarWashListByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectCarWashListByCondition] */

        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.*
              FROM (
                  SELECT A.RO_GRP_NO,
                         A.VIN_NO,
                         A.CAR_REG_NO,
                         A.CAR_OWNER_NM,
                         A.DRIVER_NM,
                         A.SA_NM,
                         FN_GET_CARLINE_NM_NC (B.CARLINE_CD) AS CARLINE_NM,
                         FN_GET_MODEL_NM (B.MODEL_CD) AS MODEL_NM,
                         A.RUN_DIST_VAL,
                         (SELECT CMM_CD_TXT
                             FROM CM_0304T
                            WHERE LANG_CD    = NVL( #{sLangCd} ,'zh')
                              AND CMM_GRP_CD = 'SER051'
                              AND CMM_CD     = A.CAR_WASH_STAT_CD ) CAR_WASH_STAT_NM,
                         A.CAR_WASH_STAT_CD,
                         A.CAR_WASH_PRSN_NM,
                         A.CAR_WASH_START_DT,
                         A.CAR_WASH_END_DT,
                         A.CAR_WASH_CANC_PRSN_NM,
                         A.CAR_WASH_CANC_DT,
                         C.PRE_CHK_DT,
                         A.CAR_WASH_CANC_REASON_CD,
                         A.CAR_WASH_CANC_REASON_CONT,
                         ROW_NUMBER() OVER(PARTITION BY  A.DLR_CD , A.VIN_NO ORDER BY A.VIN_NO ) AS RN
                    FROM SE_0300T A,
                         SA_0121T B,
                         SE_0200T C
                   WHERE A.VIN_NO      = B.VIN_NO
                     AND A.DLR_CD      = C.DLR_CD
                     AND A.DIAG_DOC_NO = C.DIAG_DOC_NO
                     AND (A.GOODWILL_YN != 'Y'  OR A.GOODWILL_YN IS NULL )
                     AND (A.CAR_WASH_TP != '04' OR A.CAR_WASH_TP IS NULL )
                     AND A.RO_STAT_CD  IN ('01','02')
                     AND A.CAR_WASH_TP IN ('01', '02', '03')
                     AND A.DLR_CD = #{sDlrCd}
                    <if test='sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>
                    <if test='sCarRegNo != null and sCarRegNo != ""'>
                        AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                    </if>
                    <if test='sCarWashStatCd != null and sCarWashStatCd != ""'>
                        AND A.CAR_WASH_STAT_CD = #{sCarWashStatCd}
                    </if>
                    <if test='sCarWashPrsnNm != null and sCarWashPrsnNm != ""'>
                        AND A.CAR_WASH_PRSN_NM LIKE '%'||#{sCarWashPrsnNm}||'%'
                    </if>
                    <if test='sCarWashStartFromDt != null'>
                        AND A.CAR_WASH_START_DT <![CDATA[>=]]> #{sCarWashStartFromDt}
                    </if>
                    <if test='sCarWashStartToDt != null'>
                        AND A.CAR_WASH_START_DT <![CDATA[<]]> #{sCarWashStartToDt} + 1
                    </if>
                    <if test='sCarWashEndFromDt != null'>
                        AND A.CAR_WASH_END_DT <![CDATA[>=]]> #{sCarWashEndFromDt}
                    </if>
                    <if test='sCarWashEndToDt != null'>
                        AND A.CAR_WASH_END_DT <![CDATA[<]]> #{sCarWashEndToDt} + 1
                    </if>
                    <if test='sPreChkFromDt != null'>
                        AND C.PRE_CHK_DT <![CDATA[>=]]> #{sPreChkFromDt}
                    </if>
                    <if test='sPreChkToDt != null'>
                        AND C.PRE_CHK_DT <![CDATA[<]]> #{sPreChkToDt} + 1
                    </if>
            ) T1
            WHERE RN = 1
            <if test='sCarlineNm != null and sCarlineNm != ""'>
            AND CARLINE_NM LIKE '%'||#{sCarlineNm}||'%'
            </if>
            <if test='firstIndex != -1 and lastIndex != -1'>
             AND ROWNUM <![CDATA[<=]]> #{lastIndex}
            </if>
            ORDER BY
            <choose>
                <when test='sort != null'>
                    <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                        <choose>
                            <when test='item.field == "carRegNo"'>          T1.CAR_REG_NO           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "vinNo"'>             T1.VIN_NO               <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "preChkDt"'>          T1.PRE_CHK_DT           <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carWashStartDt"'>    T1.CAR_WASH_START_DT    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carWashEndDt"'>      T1.CAR_WASH_END_DT      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <when test='item.field == "carWashCancDt"'>     T1.CAR_WASH_CANC_DT     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                            <otherwise>
                                PRE_CHK_DT DESC
                            </otherwise>
                        </choose>
                    </foreach>
                </when>
                <otherwise>
                    PRE_CHK_DT DESC
                </otherwise>
            </choose>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <select id="selectCarWashListByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectCarWashListByConditionCnt] */
            SELECT COUNT(T1.VIN_NO) AS VALUE
              FROM (
                  SELECT A.RO_GRP_NO,
                         A.VIN_NO,
                         A.CAR_REG_NO,
                         A.CAR_OWNER_NM,
                         A.DRIVER_NM,
                         A.SA_NM,
                         FN_GET_CARLINE_NM_NC (B.CARLINE_CD) AS CARLINE_NM,
                         FN_GET_MODEL_NM (B.MODEL_CD) AS MODEL_NM,
                         A.RUN_DIST_VAL,
                         A.CAR_WASH_STAT_CD,
                         A.CAR_WASH_PRSN_NM,
                         A.CAR_WASH_START_DT,
                         A.CAR_WASH_END_DT,
                         A.CAR_WASH_CANC_DT,
                         A.CAR_WASH_CANC_REASON_CD,
                         A.CAR_WASH_CANC_REASON_CONT,
                         ROW_NUMBER() OVER(PARTITION BY  A.DLR_CD , A.VIN_NO ORDER BY A.VIN_NO ) AS RN
                    FROM SE_0300T A,
                         SA_0121T B,
                         SE_0200T C
                   WHERE A.VIN_NO      = B.VIN_NO
                     AND A.DLR_CD      = C.DLR_CD
                     AND A.DIAG_DOC_NO = C.DIAG_DOC_NO
                     AND (A.GOODWILL_YN != 'Y' OR A.GOODWILL_YN IS NULL )
                     AND (A.CAR_WASH_TP != '04' OR A.CAR_WASH_TP IS NULL )
                     AND A.RO_STAT_CD  IN ('01','02')
                     AND A.CAR_WASH_TP IN('01', '02', '03')
                     AND A.DLR_CD = #{sDlrCd}
                    <if test='sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>
                    <if test='sCarRegNo != null and sCarRegNo != ""'>
                        AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                    </if>
                    <if test='sCarWashStatCd != null and sCarWashStatCd != ""'>
                        AND A.CAR_WASH_STAT_CD = #{sCarWashStatCd}
                    </if>
                    <if test='sCarWashPrsnNm != null and sCarWashPrsnNm != ""'>
                        AND A.CAR_WASH_PRSN_NM LIKE '%'||#{sCarWashPrsnNm}||'%'
                    </if>
                    <if test='sCarWashStartFromDt != null'>
                        AND A.CAR_WASH_START_DT <![CDATA[>=]]> #{sCarWashStartFromDt}
                    </if>
                    <if test='sCarWashStartToDt != null'>
                        AND A.CAR_WASH_START_DT <![CDATA[<]]> #{sCarWashStartToDt} + 1
                    </if>
                    <if test='sCarWashEndFromDt != null'>
                        AND A.CAR_WASH_END_DT <![CDATA[>=]]> #{sCarWashEndFromDt}
                    </if>
                    <if test='sCarWashEndToDt != null'>
                        AND A.CAR_WASH_END_DT <![CDATA[<]]> #{sCarWashEndToDt} + 1
                    </if>
                    <if test='sPreChkFromDt != null'>
                        AND C.PRE_CHK_DT <![CDATA[>=]]> #{sPreChkFromDt}
                    </if>
                    <if test='sPreChkToDt != null'>
                        AND C.PRE_CHK_DT <![CDATA[<]]> #{sPreChkToDt} + 1
                    </if>
            ) T1
            WHERE RN = 1
            <if test='sCarlineNm != null and sCarlineNm != ""'>
              AND CARLINE_NM LIKE '%'||#{sCarlineNm}||'%'
            </if>
    </select>


    <!-- 공임 이력 조회 목록수 -->
    <select id="selectLbrHistListByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectLbrHistListByConditionCnt] */

              SELECT COUNT(1) AS VALUE
                 FROM (
                    SELECT B.LBR_NM
                           ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                           ,C.REAL_TEC_NM AS TEC_NM
                           ,(SELECT MAX(RCV_CPLT_DT) FROM SE_0570T WHERE RCV_DOC_NO = E.RCV_DOC_NO) AS PAY_END_DT
                      FROM SE_0300T A
                      LEFT OUTER JOIN SE_0170T B ON A.DLR_CD = B.DLR_CD AND A.RO_DOC_NO = B.DOC_NO
                      LEFT OUTER JOIN SE_0330T C ON B.DLR_CD = C.DLR_CD AND B.DOC_NO = C.RO_DOC_NO AND B.LBR_CD = C.RPIR_CD
                      LEFT OUTER JOIN SE_0500T D ON A.DLR_CD = D.DLR_CD AND A.RO_DOC_NO = D.RO_DOC_NO AND D.CALC_CANC_YN = 'N'
                      LEFT OUTER JOIN SE_0550T E ON A.DLR_CD = E.DLR_CD AND A.RO_DOC_NO = E.RO_DOC_NO
                      WHERE A.DLR_CD = #{sDlrCd}
                      AND B.PREFIX_ID = 'RO'
                      AND A.RO_STAT_CD != '06'
                      <if test=' sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                      </if>
                      <if test=' sRoStatCd != null and sRoStatCd != ""'>
                        AND A.RO_STAT_CD = #{sRoStatCd}
                      </if>
                      <if test='sRoFromDt != null'>
                        AND A.RO_DT <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                      </if>
                      <if test='sRoToDt!= null'>
                        AND A.RO_DT <![CDATA[<]]> TO_CHAR(#{sRoToDt} + 1, 'YYYYMMDD')
                      </if>
                      <if test=' sRoTp != null and sRoTp != ""'>
                        AND A.RO_TP  = #{sRoTp}
                      </if>
                      <if test=' sLbrTp != null and sLbrTp != ""'>
                        AND B.LBR_TP  = #{sLbrTp}
                      </if>
                      <if test=' sCarRegNo != null and sCarRegNo != ""'>
                        AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                      </if>
                      <if test=' sRoDocNo != null and sRoDocNo != ""'>
                        AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                      </if>
                      <if test=' sLbrCd != null and sLbrCd != ""'>
                        AND B.LBR_CD LIKE '%'||#{sLbrCd}||'%'
                      </if>
                      <if test=' sCarOwnerNm != null and sCarOwnerNm != ""'>
                        AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                      </if>
                      <if test='sCalcFromDt != null'>
                        AND TO_CHAR(D.CALC_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sCalcFromDt}, 'YYYYMMDD')
                      </if>
                      <if test='sCalcToDt != null'>
                        AND TO_CHAR(D.CALC_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sCalcToDt}, 'YYYYMMDD')
                      </if>
                      <if test=' sCrNm != null and sCrNm != ""'>
                        AND B.CR_NM LIKE '%'||#{sCrNm}||'%'
                      </if>
                      <if test=' sCrTp != null and sCrTp != "" '>
                        AND B.CR_TP = #{sCrTp}
                      </if>
                )T1
                <where>
                    <if test=' sLbrNm != null and sLbrNm != "" '>
                        AND T1.LBR_NM LIKE '%'|| #{sLbrNm} ||'%'
                    </if>
                    <if test=' sRegUsrNm != null and sRegUsrNm != "" '>
                        AND T1.REG_USR_NM LIKE '%'|| #{sRegUsrNm} ||'%'
                    </if>
                    <if test=' sTecNm != null and sTecNm != ""'>
                        AND T1.TEC_NM LIKE '%'||#{sTecNm}||'%'
                    </if>
                    <if test='sPayFromDt != null'>
                        AND TO_CHAR(T1.PAY_END_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sPayFromDt}, 'YYYYMMDD')
                    </if>
                    <if test='sPayToDt != null'>
                        AND TO_CHAR(T1.PAY_END_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sPayToDt}, 'YYYYMMDD')
                    </if>
                </where>
    </select>

    <!-- 공임 이력 조회  -->
    <select id="selectLbrHistListByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectLbrHistListByCondition] */

          SELECT * FROM (
              SELECT ROWNUM AS RNUM , T1.*
                 FROM (
                    SELECT A.DLR_CD
                          ,A.VIN_NO
                          ,A.CAR_OWNER_NM
                          ,A.DRIVER_NM
                          ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                          ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                          ,A.CAR_REG_NO
                          ,(SELECT RUN_DIST_VAL
                              FROM SE_0200T
                              WHERE DLR_CD = A.DLR_CD
                                AND VIN_NO = A.VIN_NO
                                AND DIAG_DOC_NO = A.DIAG_DOC_NO
                                AND ROWNUM = 1 ) AS RUN_DIST_VAL
                          ,A.RUN_DIST_VAL  AS LAST_RUN_DIST_VAL
                          ,FN_CMM_CD_NM('SER030', A.RO_STAT_CD, #{sLangCd}, 'N') AS RO_STAT_NM
                          ,D.CALC_DT
                          ,A.RO_DOC_NO
                          ,A.RO_TP
                          ,FN_CMM_CD_NM('SER031', A.RO_TP , #{sLangCd}, 'N') AS RO_TP_NM
                          ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                          ,A.RO_DT
                          ,FN_CMM_CD_NM('SER036', B.LBR_TP , #{sLangCd}, 'N') AS LBR_TP_NM
                          ,B.PKG_ITEM_CD
                          ,B.LBR_CD
                          ,B.LBR_NM
                          ,NVL(B.LBR_HM,0) AS LBR_HM
                          ,NVL(C.ALLOC_HM, NVL(B.DSTB_HM,0)) AS DSTB_HM  --배정공임
                          ,B.LBR_PRC  --공임단가
                          ,CASE WHEN B.CR_NO IS NOT NULL THEN B.LBR_TOT_AMT ELSE (B.LBR_PRC * B.LBR_QTY * B.LBR_HM ) END AS LBR_AMT --공임금액
                          ,B.DC_RATE AS LBR_DC_RATE  --공임할인율
                          ,B.DC_AMT AS LBR_DC_AMT  --공임할인금액
                          ,B.LBR_TOT_AMT  --공임할인후 금액
                          ,C.REAL_TEC_ID AS TEC_ID
                          ,C.REAL_TEC_NM AS TEC_NM
                          ,C.WKGRP_NO
                          ,C.WKGRP_NM
                          ,C.BAY_NO
                          ,(SELECT BAY_NM FROM SE_1012T WHERE DLR_CD = A.DLR_CD AND BAY_NO = C.BAY_NO) AS BAY_NM
                          ,C.SHT_CNT
                          ,C.SHT_CNT AS SER_CNT
                          ,C.PAINT_CNT
                          ,C.LBR_CNT
                          ,C.DIFF_VAL
                          ,B.SUB_BP_CD               --점검코드
                          ,B.SUB_BP_NM               --의견번호
                          ,A.RO_PRINT_DT
                          ,A.UPDT_DT
                          ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) AS UPDT_USR_NM
                          ,FN_CMM_CD_NM('SER043', NVL(C.ALLOC_STAT_CD, '01') , #{sLangCd}, 'N') AS ALLOC_STAT_NM  --정비배정상태
                          ,(SELECT SA_NM FROM SE_0300T WHERE DLR_CD = C.DLR_CD AND RO_DOC_NO = C.RO_DOC_NO) AS SA_NM
                          ,(SELECT MIN(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO) AS ALLOC_START_DT         --배정시작시간
                          ,(SELECT MAX(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO) AS ALLOC_END_DT         --배정완료시간
                          ,C.ALLOC_START_DT AS EXPT_START_DT  --예정시작시간
                          ,C.ALLOC_END_DT AS EXPT_END_DT  --예정완료시간
                          ,C.ALLOC_REMARK --배정비고
                          ,FN_CMM_CD_NM('SER050', NVL(C.WRK_STAT_CD, '01') , #{sLangCd}, 'N') AS WRK_STAT_NM  --정비진도상태
                          ,FN_CMM_CD_NM('SER053', NVL(C.PAINT_STAT_CD, '') , #{sLangCd}, 'N') AS PAINT_STAT_NM  --판금페인트상태
                          ,C.WRK_START_DT  --작업시작시간
                          ,C.WRK_END_DT  --작업종료시간
                          ,C.PAUSE_CAU_CD --정비중단원인
                          ,C.PAUSE_CAU_RMK --정비중단비고
                          ,FN_CMM_CD_NM('SER052', NVL(C.QT_TEST_STAT_CD, 'Q5') , #{sLangCd}, 'N') AS QT_TEST_STAT_NM  --품질검사상태
                          ,C.QT_TEST_START_DT  --품질검사시작시간
                          ,C.QT_TEST_END_DT  --품질검사종료시간
                          ,B.CR_NO  --캠페인번호
                          ,B.CR_TP  --켐페인유형 코드
                          ,FN_CMM_CD_NM('SER930', B.CR_TP, #{sLangCd}, 'N') AS CR_TP_NM --캠페인유형 명칭
                          ,B.CR_NM  --캠페인명칭
                          ,NVL(ROUND(((SELECT MIN(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO) - A.RO_DT)*24,2),0) AS ALLOC_READY_TIME      --배정대기사용시간
                          ,NVL(ROUND(((SELECT MAX(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO) - (SELECT MIN(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO))*24,2),0) AS ALLOC_USE_TIME        --배정사용시간
                          ,NVL(ROUND((A.DL_CHK_DT - A.RO_DT)*24,2),0) AS RPIR_SER_TIME         --정비서비스사용시간
                          ,NVL(ROUND((C.WRK_START_DT - (SELECT MAX(REG_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO))*24,2),0) AS RPIR_READY_TIME       --정비서비스사용시간
                          ,NVL(ROUND((C.WRK_END_DT - C.WRK_START_DT)*24,2),0) AS RPIR_TIME             --정비조작사용시간
                          ,NVL(ROUND((C.QT_TEST_START_DT - C.WRK_END_DT)*24,2),0) AS QT_TEST_READY_TIME    --품질점검대기사용시간
                          ,NVL(ROUND((C.QT_TEST_END_DT - C.QT_TEST_START_DT)*24,2),0) AS QT_TEST_TIME          --품질점검사용시간
                          ,(CASE WHEN C.WRK_START_DT <![CDATA[<=]]> C.ALLOC_START_DT THEN 'Y' ELSE 'N' END) AS ON_TIME_START_YN  --On time 작업시작
                          ,(CASE WHEN C.WRK_END_DT   <![CDATA[<=]]> C.ALLOC_END_DT   THEN 'Y' ELSE 'N' END) AS ON_TIME_END_YN    --On time 작업완료
                          ,(CASE WHEN C.WRK_START_DT <![CDATA[>]]>  C.ALLOC_START_DT THEN 'Y' ELSE 'N' END) AS DELAY_START_YN    --지연 작업시작
                          ,(CASE WHEN C.WRK_END_DT   <![CDATA[>]]>  C.ALLOC_END_DT   THEN 'Y' ELSE 'N' END) AS DELAY_END_YN      --지연 작업완료
                          ,(SELECT MAX(RCV_CPLT_DT) FROM SE_0560T WHERE RCV_DOC_NO = E.RCV_DOC_NO) AS RCV_CPLT_DT --수납완료일자
                          ,(SELECT MAX(RCV_CPLT_DT) FROM SE_0570T WHERE RCV_DOC_NO = E.RCV_DOC_NO) AS PAY_END_DT --지불완료시간
                      FROM SE_0300T A
                      LEFT OUTER JOIN SE_0170T B ON A.DLR_CD = B.DLR_CD AND A.RO_DOC_NO = B.DOC_NO
                      LEFT OUTER JOIN SE_0330T C ON B.DLR_CD = C.DLR_CD AND B.DOC_NO = C.RO_DOC_NO AND B.LBR_CD = C.RPIR_CD
                      LEFT OUTER JOIN SE_0500T D ON A.DLR_CD = D.DLR_CD AND A.RO_DOC_NO = D.RO_DOC_NO AND D.CALC_CANC_YN = 'N'
                      LEFT OUTER JOIN SE_0550T E ON A.DLR_CD = E.DLR_CD AND A.RO_DOC_NO = E.RO_DOC_NO
                    WHERE A.DLR_CD = #{sDlrCd}
                      AND B.PREFIX_ID = 'RO'
                      AND A.RO_STAT_CD != '06'
                      <if test='sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                      </if>
                      <if test='sRoStatCd != null and sRoStatCd != ""'>
                        AND A.RO_STAT_CD = #{sRoStatCd}
                      </if>
                      <if test='sRoFromDt != null'>
                        AND A.RO_DT <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                      </if>
                      <if test='sRoToDt!= null'>
                        AND A.RO_DT <![CDATA[<]]> TO_CHAR(#{sRoToDt} + 1, 'YYYYMMDD')
                      </if>
                      <if test='sRoTp != null and sRoTp != ""'>
                        AND A.RO_TP  = #{sRoTp}
                      </if>
                      <if test='sLbrTp != null and sLbrTp != ""'>
                        AND B.LBR_TP  = #{sLbrTp}
                      </if>
                      <if test='sCarRegNo != null and sCarRegNo != ""'>
                        AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                      </if>
                      <if test='sRoDocNo != null and sRoDocNo != ""'>
                        AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                      </if>
                      <if test='sLbrCd != null and sLbrCd != ""'>
                        AND B.LBR_CD LIKE '%'||#{sLbrCd}||'%'
                      </if>
                      <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                        AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                      </if>
                      <if test='sCalcFromDt != null'>
                        AND TO_CHAR(D.CALC_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sCalcFromDt}, 'YYYYMMDD')
                      </if>
                      <if test='sCalcToDt != null'>
                        AND TO_CHAR(D.CALC_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sCalcToDt}, 'YYYYMMDD')
                      </if>
                      <if test='sCrNm != null and sCrNm != ""'>
                        AND B.CR_NM LIKE '%'||#{sCrNm}||'%'
                      </if>
                      <if test='sCrTp != null and sCrTp != "" '>
                        AND B.CR_TP = #{sCrTp}
                      </if>
                      ORDER BY
                      <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                    <when test='item.field == "carRegNo"'>              CAR_REG_NO                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "vinNo"'>                 VIN_NO                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carOwnerNm"'>            CAR_OWNER_NM                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "driverNm"'>              DRIVER_NM                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carlineNm"'>             CARLINE_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "modelNm"'>               MODEL_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "runDistVal"'>            RUN_DIST_VAL                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lastRunDistVal"'>        LAST_RUN_DIST_VAL             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roStatNm"'>              RO_STAT_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roDocNo"'>               RO_DOC_NO                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roTpNm"'>                RO_TP_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roDtFormat"'>            RO_DT                         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regUsrNm"'>              REG_USR_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roPrintDtFormat"'>       RO_PRINT_DT                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "updtDtFormat"'>          UPDT_DT                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "updtUsrNm"'>             UPDT_USR_NM                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "calcDtFormat"'>          CALC_DT                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "pkgItemCd"'>             PKG_ITEM_CD                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrCd"'>                 LBR_CD                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrNm"'>                 LBR_NM                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrTpNm"'>               LBR_TP_NM                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "subBpNm"'>               SUB_BP_NM                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "subBpCd"'>               SUB_BP_CD                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrHm"'>                 LBR_HM                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrPrc"'>                LBR_PRC                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrAmt"'>                LBR_AMT                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrDcRate"'>             LBR_DC_RATE                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrDcAmt"'>              LBR_DC_AMT                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lbrTotAmt"'>             LBR_TOT_AMT                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "tecNm"'>                 TEC_NM                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "tecId"'>                 TEC_ID                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "wkgrpNm"'>               WKGRP_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "wkgrpNo"'>               WKGRP_NO                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "bayNm"'>                 BAY_NM                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "bayNo"'>                 BAY_NO                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "serCnt"'>                SER_CNT                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "diffVal"'>               DIFF_VAL                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocStatNm"'>           ALLOC_STAT_NM                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "dstbHm"'>                DSTB_HM                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "saNm"'>                  SA_NM                         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocStartDtFormat"'>    ALLOC_START_DT                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocEndDtFormat"'>      ALLOC_END_DT                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "exptStartDtFormat"'>     EXPT_START_DT                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "exptEndDtFormat"'>       EXPT_END_DT                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocRemark"'>           ALLOC_REMARK                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "wrkStatNm"'>             WRK_STAT_NM                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "paintStatNm"'>           PAINT_STAT_NM                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "wrkStartDtFormat"'>      WRK_START_DT                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "wrkEndDtFormat"'>        WRK_END_DT                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "pauseCauCd"'>            PAUSE_CAU_CD                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "pauseCauRmk"'>           PAUSE_CAU_RMK                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "qtTestStatNm"'>          QT_TEST_STAT_NM               <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "qtTestStartDtFormat"'>   QT_TEST_START_DT              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "qtTestEndDtFormat"'>     QT_TEST_END_DT                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "crNo"'>                  CR_NO                         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "crTpNm"'>                CR_TP_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "crNm"'>                  CR_NM                         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocReadyTime"'>        ALLOC_READY_TIME              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "allocUseTime"'>          ALLOC_USE_TIME                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "rpirSerTime"'>           RPIR_SER_TIME                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "rpirReadyTime"'>         RPIR_READY_TIME               <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "rpirTime"'>              RPIR_TIME                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "qtTestReadyTime"'>       QT_TEST_READY_TIME            <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "qtTestTime"'>            QT_TEST_TIME                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "onTimeStartYn"'>         ON_TIME_START_YN              <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "onTimeEndYn"'>           ON_TIME_END_YN                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "delayStartYn"'>          DELAY_START_YN                <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "delayEndYn"'>            DELAY_END_YN                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "rcvCpltDtFormat"'>       RCV_CPLT_DT                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "payEndDtFormat"'>        PAY_END_DT                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <otherwise>
                                        RO_DT DESC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            RO_DT DESC
                        </otherwise>
                    </choose>
                )T1
                <where>
                    <if test='sLbrNm != null and sLbrNm != "" '>
                        AND T1.LBR_NM LIKE '%'|| #{sLbrNm} ||'%'
                    </if>
                    <if test='sRegUsrNm != null and sRegUsrNm != "" '>
                        AND T1.REG_USR_NM LIKE '%'|| #{sRegUsrNm} ||'%'
                    </if>
                    <if test='sTecNm != null and sTecNm != ""'>
                        AND T1.TEC_NM LIKE '%'||#{sTecNm}||'%'
                    </if>
                    <if test='sPayFromDt != null'>
                        AND TO_CHAR(T1.PAY_END_DT, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(#{sPayFromDt}, 'YYYYMMDD')
                    </if>
                    <if test='sPayToDt != null'>
                        AND TO_CHAR(T1.PAY_END_DT, 'YYYYMMDD') <![CDATA[<=]]> TO_CHAR(#{sPayToDt}, 'YYYYMMDD')
                    </if>
                    <if test='firstIndex != -1 and lastIndex != -1'>
                        AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                    </if>
                </where>

        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>


    <!-- RO 현황 목록 조회. -->
    <select id="selectRepairOrderInfoListByCondition" parameterType="RepairOrderSearchVO" resultType="repairordervo">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderInfoListByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM
                  ,T1.*
              FROM (
                 SELECT B.*
                   FROM(
                         SELECT DLR_CD                                                                            --딜러코드
                               ,RO_DOC_NO                                                                         --RO문서번호
                               ,RO_TP                                                                             --RO유형
                               ,FN_CMM_CD_NM('SER031',A.RO_TP,#{sLangCd},'N') AS RO_TP_NM                         --RO유형명
                               ,RESV_DOC_NO                                                                       --예약문서번호
                               ,VIN_NO                                                                            --차대번호
                               ,CAR_REG_NO                                                                        --차량등록번호
                               ,ENGIN_NO                                                                          --엔진번호
                               ,CAR_OWNER_ID                                                                      --차량소유자ID
                               ,CAR_OWNER_NM                                                                      --차량소유자명
                               ,DRIVER_ID                                                                         --운전자ID
                               ,DRIVER_NM                                                                         --운전자명
                               ,RESV_TP                                                                           --예약유형
                               ,RESV_DT                                                                           --예약일자
                               ,BAY_NO                                                                            --베이번호
                               ,TEC_ID                                                                            --TechManID
                               ,TEC_NM                                                                            --TechMan명
                               ,SA_ID                                                                             --SAID
                               ,SA_NM                                                                             --SA명
                               ,OPER_RESV_DT                                                                      --작업예약일자
                               ,SER_RESV_START_DT                                                                 --서비스예약시작일자
                               ,NVL(BAL_AMT ,0 ) BAL_AMT                                                          --예치금액
                               ,CANC_REASON_CD                                                                    --취소사유코드
                               ,FN_CMM_CD_NM('SER014',A.CANC_REASON_CD,#{sLangCd},'N') AS CANC_REASON_NM          --취소사유코드명
                               ,CANC_REASON_CONT                                                                  --취소사유내용
                               ,CASE WHEN RO_STAT_CD ='06' THEN UPDT_DT ELSE NULL END AS RO_CANC_DT               --RO 취소시간
                               ,DIST_UNIT_CD                                                                      --거리단위코드
                               ,RUN_DIST_VAL                                                                      --주행거리값
                               ,DIAG_DOC_NO                                                                       --진단문서번호
                               ,BASE_RO_NO                                                                        --원RO번호
                               ,INC_REQ_NO                                                                        --보험신청번호
                               ,CUST_WAIT_MTH_CD                                                                  --고객대기방법코드
                               ,FN_CMM_CD_NM('SER032',A.CUST_WAIT_MTH_CD,#{sLangCd},'N') AS CUST_WAIT_MTH_NM      --고객대기방법코드명
                               ,ATQ_PROC_TP                                                                       --고품처리유형
                               ,FN_CMM_CD_NM('SER033',A.ATQ_PROC_TP,#{sLangCd},'N') AS ATQ_PROC_TP_NM             --고품처리유형명
                               ,CAR_WASH_TP                                                                       --차량세차유형
                               ,FN_CMM_CD_NM('SER034',A.CAR_WASH_TP,#{sLangCd},'N') AS CAR_WASH_TP_NM             --차량세차유형명
                               ,CAR_DRIVE_REQ_TP                                                                  --차량시승요청유형
                               ,FN_CMM_CD_NM('SER035',A.CAR_DRIVE_REQ_TP,#{sLangCd},'N') AS CAR_DRIVE_REQ_TP_NM   --차량시승요청유형명
                               ,EXPC_DL_DT                                                                        --예정인도일자
                               ,ATQ_PROC_YN                                                                       --고품처리여부
                               ,CAR_WASH_YN                                                                       --차량세차여부
                               ,VSIT_CAR_RECEIVE_DT                                                               --방문차량수령일자
                               ,VSIT_CAR_RECEIVE_IF_NM                                                            --방문차량수령연계인명
                               ,VSIT_CAR_RECEIVE_CINO_NO                                                          --방문차량수령연락처번호
                               ,VSIT_CAR_RECEIVE_ADDR_NM                                                          --방문차량수령주소명
                               ,CAR_RECEIVE_DT                                                                    --차량수령일자
                               ,VSIT_DL_IF_NM                                                                     --방문인도연계인명
                               ,VSIT_DL_CINO_NO                                                                   --방문인도연락처번호
                               ,VSIT_DL_ADDR_NM                                                                   --방문인도주소명
                               ,VSIT_DT                                                                           --방문일자
                               ,VSIT_IF_NM                                                                        --방문연계인명
                               ,VSIT_CINO_NO                                                                      --방문연락처번호
                               ,VSIT_ADDR_NM                                                                      --방문주소명
                               ,REG_USR_ID                                                                        --등록자ID
                               ,UPDT_USR_ID                                                                       --수정자ID
                               ,UPDT_DT
                               ,ALLOC_EMP_ID                                                                      --배정자ID
                               ,SER_RESV_END_DT                                                                   --서비스예약종료일자
                               ,INC_REQ_DT                                                                        --보험신청일자
                               ,RO_STAT_CD                                                                        --RO상태코드
                               ,FN_CMM_CD_NM('SER030',A.RO_STAT_CD,#{sLangCd},'N') AS RO_STAT_NM                  --RO상태코드명
                               ,RO_DT                                                                             --RO일자
                               ,CAR_WASH_STAT_CD                                                                  --세차상태코드
                               ,PAINT_STAT_CD                                                                     --페인트상태코드
                               ,QT_TEST_STAT_CD                                                                   --품질검사상태코드
                               ,FN_CMM_CD_NM('SER052',QT_TEST_STAT_CD,#{sLangCd},'N')  AS QT_TEST_STAT_NM         --품질검사상태코드
                               ,RO_GRP_NO                                                                         --RO그룹번호
                               ,PAINT_QTY                                                                         --페인트수량
                               ,PAINT_COLOR_CD                                                                    --페인트색상코드
                               ,CAR_COLOR_CD                                                                      --차량색상코드
                               ,PAINT_TP                                                                          --페인트유형
                               ,RO_START_DT                                                                       --RO시작일자
                               ,RO_END_DT                                                                         --RO종료일자
                               ,RO_REMARK                                                                         --RO비고
                               ,QT_TEST_MTH_CD                                                                    --품질검사방법코드
                               ,FN_CMM_CD_NM('SER040',A.QT_TEST_MTH_CD,#{sLangCd},'N') AS QT_TEST_MTH_NM          --품질검사방법코드명
                               ,CHG_EXPC_DL_DT                                                                    --변경예정인도일자
                               ,CAU_CD1                                                                           --원인코드1
                               ,CAU_NM1                                                                           --원인명1
                               ,PHEN_CD1                                                                          --현상코드1
                               ,PHEN_NM1                                                                          --현상명1
                               ,CAU_CD2                                                                           --원인코드2
                               ,CAU_NM2                                                                           --원인명2
                               ,PHEN_CD2                                                                          --현상코드2
                               ,PHEN_NM2                                                                          --현상명2
                               ,QT_TEST_START_DT                                                                  --품질검사시작일자
                               ,QT_TEST_END_DT                                                                    --품질검사종료일자
                               ,QT_TEST_PRSN_CD                                                                   --품질검사담당자코드
                               ,QT_TEST_PRSN_NM                                                                   --품질검사담당자명
                               ,CAR_WASH_START_DT                                                                 --차량세차시작일자
                               ,CAR_WASH_END_DT                                                                   --차량세차종료일자
                               ,CAR_WASH_PRSN_CD                                                                  --차량세차담당자코드
                               ,CAR_WASH_PRSN_NM                                                                  --차량세차담당자명
                               ,ROAD_TEST_CD                                                                      --도로검사코드
                               ,PRE_AMT                                                                           --선수금액
                               ,RWRK_CD                                                                           --리워크코드
                               ,RWRK_REMARK                                                                       --리워크비고
                               ,RO_END_CHK_YN                                                                     --RO종료확인여부
                               ,ATQ_PROC_CHK_YN                                                                   --고품처리확인여부
                               ,QT_CHK_YN                                                                         --품질확인여부
                               ,CAR_WASH_CHK_YN                                                                   --차량세차확인여부
                               ,SER_TAG_CHK_YN                                                                    --서비스태그확인여부
                               ,GI_RUN_DIST_VAL                                                                   --주행거리값
                               ,DL_CHK_DT                                                                         --인도확인시간
                               ,DL_CHK_PRSN_CD                                                                    --인도확인자코드
                               ,DL_CHK_PRSN_NM                                                                    --인도확인자명
                               ,CAR_WASH_CANC_DT                                                                  --차량세차취소일자
                               ,ALLOC_STAT_CD                                                                     --배정상태코드
                               ,FN_CMM_CD_NM('SER043',ALLOC_STAT_CD,#{sLangCd},'N') AS ALLOC_STAT_NM              --배정상태코드명
                               ,WRK_STAT_CD                                                                       --작업상태코드
                               ,FN_CMM_CD_NM('SER050',A.WRK_STAT_CD,#{sLangCd},'N') AS WRK_STAT_NM                --작업상태코드명
                               ,DL_STAT_CD                                                                        --인도상태코드
                               ,FN_CMM_CD_NM('SER057',DL_STAT_CD,#{sLangCd},'N')    AS DL_STAT_NM                 --인도상태명
                               ,NVL(GOODWILL_YN,'N') AS GOODWILL_YN                                               --GOODWILL여부
                               ,FN_CMM_CD_NM('COM020',GOODWILL_YN,#{sLangCd},'N') AS GOODWILL_YN_NM               --GOODWILL여부명
                               ,NVL(GOODWILL_STAT_CD,'O') AS GOODWILL_STAT_CD                                     --GOODWILL 사용여부
                               ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1 ) AS LAST_RUN_DIST_VAL
                               ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO  AND ROWNUM = 1) AS CARLINE_NM
                               ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                               ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) AS UPDT_USR_NM
                               ,EXPC_DL_DT - 30/(24*60) AS EXPC_DL_START_DT                                       -- 예정인도시간
                               ,RO_PRINT_DT
                               ,DLR_RO_TP
                               ,FN_CMM_CD_NM('SER044',A.DLR_RO_TP,#{sLangCd},'N') AS DLR_RO_TP_NM
                               ,CASE WHEN RO_STAT_CD = '05' THEN 'Y' ELSE 'N' END AS PAID_YN
                               ,( SELECT MIN(WRK_START_DT)
                                   FROM SE_0330T
                                  WHERE DLR_CD = A.DLR_CD
                                    AND RO_DOC_NO = A.RO_DOC_NO
                                 ) AS WRK_START_DT                                                        --작업 시작시간
                               ,( SELECT MAX(WRK_END_DT)
                                   FROM SE_0330T
                                  WHERE DLR_CD = A.DLR_CD
                                    AND RO_DOC_NO = A.RO_DOC_NO
                                 ) AS WRK_END_DT                                                          --작업 완료시간
                               ,( SELECT MIN(REG_DT)
                                   FROM SE_0330T
                                  WHERE DLR_CD = A.DLR_CD
                                    AND RO_DOC_NO = A.RO_DOC_NO
                                 ) AS ALLOC_START_DT                                                      --배정 시작시간
                               ,( SELECT MAX(REG_DT)
                                   FROM SE_0330T
                                  WHERE DLR_CD = A.DLR_CD
                                    AND RO_DOC_NO = A.RO_DOC_NO
                                 ) AS ALLOC_END_DT                                                        --배정 완료시간
                        FROM SE_0300T A
                        <where>
                            <if test='sDlrCd != null and sDlrCd != ""'>
                                AND A.DLR_CD = #{sDlrCd}
                            </if>
                            <if test='sRoDocNo != null and sRoDocNo != ""'>
                                AND A.RO_DOC_NO like '%'||#{sRoDocNo}||'%'
                            </if>
                            <if test='sVinNo != null and sVinNo != ""'>
                                AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                            </if>
                            <if test='sDriverId != null and sDriverId != ""'>
                                AND A.DRIVER_ID = #{sDriverId}
                            </if>
                            <if test='sDriverNm != null and sDriverNm != ""'>
                                AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                            </if>
                            <if test='sCarRegNo != null and sCarRegNo != ""'>
                                AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                            </if>
                            <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                                AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                            </if>
                            <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                                AND A.CAR_OWNER_ID = #{sCarOwnerId}
                            </if>
                            <if test='sBayNo != null and sBayNo != ""'>
                                AND A.BAY_NO = #{sBayNo}
                            </if>
                            <if test='sRoTp != null and sRoTp != ""'>
                                AND A.RO_TP = #{sRoTp}
                            </if>
                            <if test='sRoStatCd != null and sRoStatCd != ""'>
                                AND A.RO_STAT_CD = #{sRoStatCd}
                            </if>
                            <if test='sRoFromDt != null'>
                                AND A.RO_DT <![CDATA[>=]]> #{sRoFromDt}
                            </if>
                            <if test='sRoToDt != null'>
                                AND A.RO_DT <![CDATA[<]]> #{sRoToDt} + 1
                            </if>
                            <if test='sExpcDlFromDt != null'>
                                AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
                            </if>
                            <if test='sExpcDlToDt != null'>
                                AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
                            </if>
                            <if test='sRoStartDt != null'>
                                AND A.RO_START_DT <![CDATA[>=]]> #{sRoStartDt}
                            </if>
                            <if test='sRoEndDt != null'>
                                AND A.RO_END_DT <![CDATA[<]]> #{sRoEndDt} + 1
                            </if>
                        </where>
                  )B
                   ORDER BY
                    <choose>
                        <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "carRegNo"'>B.CAR_REG_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "vinNo"'>B.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "carOwnerNm"'>B.CAR_OWNER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "driverNm"'>B.DRIVER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "carlineNm"'>B.CARLINE_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "modelNm"'>B.MODEL_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "runDistVal"'>B.RUN_DIST_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "lastRunDistVal"'>B.LAST_RUN_DIST_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roStatNm"'>B.RO_STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roDocNo"'>B.RO_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roTpNm"'>B.RO_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "regUsrNm"'>B.REG_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roDtFormat"'>B.RO_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "expcDlDtFormat"'>B.EXPC_DL_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roRemark"'>B.RO_REMARK <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "wrkStatNm"'>B.WRK_STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "rwrkCd"'>B.RWRK_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "dlStatNm"'>B.DL_STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "dlChkDtFormat"'>B.DL_CHK_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "allocStatNm"'>B.ALLOC_STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "allocStartDtFormat"'>B.ALLOC_START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "allocEndDtFormat"'>B.ALLOC_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "wrkStatNm"'>B.WRK_STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "wrkStartDtFormat"'>B.WRK_START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "wrkEndDtFormat"'>B.WRK_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "qtTestStatNm"'>B.QT_TEST_STAT_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "qtTestStartDtFormat"'>B.QT_TEST_START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "qtTestEndDtFormat"'>B.QT_TEST_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                 B.DLR_CD ASC
                                ,B.RO_DT DESC
                                ,B.RO_TP ASC
                                </otherwise>
                            </choose>
                        </foreach>
                        </when>
                        <otherwise>
                        B.DLR_CD ASC
                        ,B.RO_DT DESC
                        ,B.RO_TP ASC
                        </otherwise>
                    </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
                <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                    AND T1.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
                </if>
                <if test='sAssignFromDt != null'>
                    AND T1.ALLOC_END_DT <![CDATA[>=]]> #{sAssignFromDt}
                </if>
                <if test='sAssignToDt != null'>
                    AND T1.ALLOC_END_DT <![CDATA[<]]> #{sAssignToDt} + 1
                </if>
                <if test='sWorkFromDt != null'>
                    AND T1.WRK_END_DT <![CDATA[>=]]> #{sWorkFromDt}
                </if>
                <if test='sWorkToDt != null'>
                    AND T1.WRK_END_DT <![CDATA[<]]> #{sWorkToDt} + 1
                </if>
                <if test='sQtTestFromDt != null'>
                    AND T1.QT_TEST_END_DT <![CDATA[>=]]> #{sQtTestFromDt}
                </if>
                <if test='sQtTestToDt != null'>
                    AND T1.QT_TEST_END_DT <![CDATA[<]]> #{sQtTestToDt} + 1
                </if>
                <if test='sDlChkFromDt != null'>
                    AND T1.DL_CHK_DT <![CDATA[>=]]> #{sDlChkFromDt}
                </if>
                <if test='sDlChkToDt != null'>
                    AND T1.DL_CHK_DT <![CDATA[<]]> #{sDlChkToDt} + 1
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 정비진도현황 목록수를 조회. -->
    <select id="selectRepairOrderInfoListByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectRepairOrderInfoListByCondition] */
         SELECT COUNT(RO_DOC_NO) AS VALUE FROM (
              SELECT B.* FROM(
                    SELECT A.DLR_CD
                          ,A.RO_DOC_NO
                          ,A.RO_TP
                          ,A.QT_TEST_END_DT                                                              --품질검사종료일자
                          ,A.DL_CHK_DT                                                                   --인도확인일자
                          ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                          ,( SELECT MAX(WRK_END_DT)
                               FROM SE_0330T
                              WHERE DLR_CD = A.DLR_CD
                                AND RO_DOC_NO = A.RO_DOC_NO
                             ) AS WRK_END_DT                                                          --작업 완료시간
                          ,( SELECT MAX(REG_DT)
                               FROM SE_0330T
                              WHERE DLR_CD = A.DLR_CD
                                AND RO_DOC_NO = A.RO_DOC_NO
                             ) AS ALLOC_END_DT                                                        --배정 완료시간
                      FROM SE_0300T A
                    <where>
                        <if test='sDlrCd != null and sDlrCd != ""'>
                            AND A.DLR_CD = #{sDlrCd}
                        </if>
                        <if test='sRoDocNo != null and sRoDocNo != ""'>
                            AND A.RO_DOC_NO like '%'||#{sRoDocNo}||'%'
                        </if>
                        <if test='sVinNo != null and sVinNo != ""'>
                            AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                        </if>
                        <if test='sDriverId != null and sDriverId != ""'>
                            AND A.DRIVER_ID = #{sDriverId}
                        </if>
                        <if test='sDriverNm != null and sDriverNm != ""'>
                            AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                        </if>
                        <if test='sCarRegNo != null and sCarRegNo != ""'>
                            AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                        </if>
                        <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                            AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                        </if>
                        <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                            AND A.CAR_OWNER_ID = #{sCarOwnerId}
                        </if>
                        <if test='sBayNo != null and sBayNo != ""'>
                            AND A.BAY_NO = #{sBayNo}
                        </if>
                        <if test='sRoTp != null and sRoTp != ""'>
                            AND A.RO_TP = #{sRoTp}
                        </if>
                        <if test='sRoStatCd != null and sRoStatCd != ""'>
                            AND A.RO_STAT_CD = #{sRoStatCd}
                        </if>
                        <if test='sRoFromDt != null'>
                            AND A.RO_DT <![CDATA[>=]]> #{sRoFromDt}
                        </if>
                        <if test='sRoToDt != null'>
                            AND A.RO_DT <![CDATA[<]]> #{sRoToDt} + 1
                        </if>
                        <if test='sRoStartDt != null'>
                            AND A.RO_START_DT <![CDATA[>=]]> #{sRoStartDt}
                        </if>
                        <if test='sRoEndDt != null'>
                            AND A.RO_END_DT <![CDATA[<]]> #{sRoEndDt} + 1
                        </if>
                        <if test='sExpcDlFromDt != null'>
                            AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
                        </if>
                        <if test='sExpcDlToDt != null'>
                            AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
                        </if>
                    </where>
                )B
          )T1
          <where>
          <if test='sRegUsrNm != null and sRegUsrNm != ""'>
             T1.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
          </if>
          <if test='sAssignFromDt != null'>
              AND T1.ALLOC_END_DT <![CDATA[>=]]> #{sAssignFromDt}
          </if>
          <if test='sAssignToDt != null'>
              AND T1.ALLOC_END_DT <![CDATA[<]]> #{sAssignToDt} + 1
          </if>
          <if test='sWorkFromDt != null'>
              AND T1.WRK_END_DT <![CDATA[>=]]> #{sWorkFromDt}
          </if>
          <if test='sWorkToDt != null'>
              AND T1.WRK_END_DT <![CDATA[<]]> #{sWorkToDt} + 1
          </if>
          <if test='sQtTestFromDt != null'>
              AND T1.QT_TEST_END_DT <![CDATA[>=]]> #{sQtTestFromDt}
          </if>
          <if test='sQtTestToDt != null'>
              AND T1.QT_TEST_END_DT <![CDATA[<]]> #{sQtTestToDt} + 1
          </if>
          <if test='sDlChkFromDt != null'>
              AND T1.DL_CHK_DT <![CDATA[>=]]> #{sDlChkFromDt}
          </if>
          <if test='sDlChkToDt != null'>
              AND T1.DL_CHK_DT <![CDATA[<]]> #{sDlChkToDt} + 1
          </if>
          </where>
    </select>

    <!-- 공임 이력 조회 목록수 -->
    <select id="selectCustDmndHistListByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectCustDmndHistListByConditionCnt] */
        SELECT COUNT(T1.LINE_NO) AS VALUE
          FROM (
                SELECT B.LINE_NO
                      ,B.CUST_REQ_CONT
                  FROM SE_0300T A
                  INNER JOIN SE_0130T B
                     ON A.DLR_CD    = B.DLR_CD
                    AND A.RO_DOC_NO = B.JOB_NO
                    AND B.PREFIX_ID = 'RO'
                  WHERE A.DLR_CD = #{sDlrCd}
                    AND A.RO_STAT_CD != '06'
                  <if test=' sVinNo != null and sVinNo != ""'>
                    AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                  </if>
                  <if test=' sDriverNm != null and sDriverNm != ""'>
                    AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                  </if>
                  <if test=' sRoDocNo != null and sRoDocNo != ""'>
                    AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                  </if>
                  <if test='sRoFromDt != null'>
                    AND A.RO_DT <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                  </if>
                  <if test='sRoToDt!= null'>
                    AND A.RO_DT <![CDATA[<]]> TO_CHAR(#{sRoToDt} + 1, 'YYYYMMDD')
                  </if>
                  <if test=' sCarRegNo != null and sCarRegNo != ""'>
                    AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                  </if>
                  <if test=' sCustReqCd != null and sCustReqCd != ""'>
                    AND B.LINE_NO LIKE '%'||#{sCustReqCd}||'%'
                  </if>
                  <if test=' sCustReqCont != null and sCustReqCont != ""'>
                    AND B.CUST_REQ_CONT LIKE '%'||#{sCustReqCont}||'%'
                  </if>
                  <if test=' sRoTp != null and sRoTp != ""'>
                    AND A.RO_TP  = #{sRoTp}
                  </if>
                  <if test=' sRoStatCd != null and sRoStatCd != ""'>
                    AND A.RO_STAT_CD = #{sRoStatCd}
                  </if>
            )T1
    </select>

    <!-- 공임 이력 조회  -->
    <select id="selectCustDmndHistListByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectCustDmndHistListByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM , T1.*
              FROM (
                    SELECT A.DLR_CD
                          ,A.VIN_NO
                          ,A.CAR_OWNER_NM
                          ,A.DRIVER_NM
                          ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                          ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                          ,A.CAR_REG_NO
                          ,(SELECT RUN_DIST_VAL
                              FROM SE_0200T
                              WHERE DLR_CD = A.DLR_CD
                                AND VIN_NO = A.VIN_NO
                                AND DIAG_DOC_NO = A.DIAG_DOC_NO
                                AND ROWNUM = 1 ) AS RUN_DIST_VAL
                          ,RUN_DIST_VAL  AS LAST_RUN_DIST_VAL
                          ,A.RO_DOC_NO
                          ,A.RO_TP
                          ,FN_CMM_CD_NM('SER031', A.RO_TP , #{sLangCd} , 'N') AS RO_TP_NM
                          ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                          ,A.RO_DT
                          ,FN_CMM_CD_NM('SER030', A.RO_STAT_CD , #{sLangCd} , 'N') AS RO_STAT_NM
                          ,A.RO_PRINT_DT
                          ,A.UPDT_DT
                          ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) AS UPDT_USR_NM
                          ,B.LINE_NO AS CUST_REQ_CD
                          ,B.CUST_REQ_CONT
                      FROM SE_0300T A
                      INNER JOIN SE_0130T B
                       ON A.DLR_CD    = B.DLR_CD
                      AND A.RO_DOC_NO = B.JOB_NO
                      AND B.PREFIX_ID = 'RO'
                    WHERE A.DLR_CD = #{sDlrCd}
                      AND A.RO_STAT_CD != '06'
                      <if test=' sVinNo != null and sVinNo != ""'>
                      AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                      </if>
                      <if test=' sDriverNm != null and sDriverNm != ""'>
                      AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                      </if>
                      <if test=' sRoDocNo != null and sRoDocNo != ""'>
                      AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                      </if>
                      <if test='sRoFromDt != null'>
                      AND A.RO_DT <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                      </if>
                      <if test='sRoToDt!= null'>
                      AND A.RO_DT <![CDATA[<]]> TO_CHAR(#{sRoToDt} + 1, 'YYYYMMDD')
                      </if>
                      <if test=' sCarRegNo != null and sCarRegNo != ""'>
                      AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                      </if>
                      <if test=' sCustReqCd != null and sCustReqCd != ""'>
                      AND B.LINE_NO LIKE '%'||#{sCustReqCd}||'%'
                      </if>
                      <if test=' sCustReqCont != null and sCustReqCont != ""'>
                      AND B.CUST_REQ_CONT LIKE '%'||#{sCustReqCont}||'%'
                      </if>
                      <if test=' sRoTp != null and sRoTp != ""'>
                      AND A.RO_TP  = #{sRoTp}
                      </if>
                      <if test=' sRoStatCd != null and sRoStatCd != ""'>
                      AND A.RO_STAT_CD = #{sRoStatCd}
                      </if>
                   ORDER BY
                   <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                    <when test='item.field == "carRegNo"'>              CAR_REG_NO                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "vinNo"'>                 VIN_NO                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carOwnerNm"'>            CAR_OWNER_NM                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "driverNm"'>              DRIVER_NM                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carlineNm"'>             CARLINE_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "modelNm"'>               MODEL_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "runDistVal"'>            RUN_DIST_VAL                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lastRunDistVal"'>        LAST_RUN_DIST_VAL             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roStatNm"'>              RO_STAT_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roDocNo"'>               RO_DOC_NO                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roTpNm"'>                RO_TP_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roDtFormat"'>            RO_DT                         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regUsrNm"'>              REG_USR_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roPrintDtFormat"'>       RO_PRINT_DT                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "updtDtFormat"'>          UPDT_DT                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "updtUsrNm"'>             UPDT_USR_NM                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custReqCd"'>             CUST_REQ_CD                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custReqCont"'>           CUST_REQ_CONT                 <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <otherwise>
                                        RO_DT DESC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            RO_DT DESC
                        </otherwise>
                    </choose>
                )T1
                <where>
                    <if test='firstIndex != -1 and lastIndex != -1'>
                        AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                    </if>
                </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 기타사항 조회 목록수 -->
    <select id="selectEtcHistListByConditionCnt" parameterType="RepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectEtcHistListByConditionCnt] */
        SELECT COUNT(T1.ETC_TP_CD) AS VALUE
          FROM (
                SELECT B.ETC_TP_CD
                      ,B.ETC_TP_NM
                      ,B.ETC_REQ_PRC
                  FROM SE_0300T A
                  INNER JOIN SE_0140T B
                     ON A.DLR_CD    = B.DLR_CD
                    AND A.RO_DOC_NO = B.JOB_NO
                    AND B.PREFIX_ID = 'RO'
                  WHERE A.DLR_CD = #{sDlrCd}
                    AND A.RO_STAT_CD != '06'
                  <if test='sVinNo != null and sVinNo != ""'>
                    AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                  </if>
                  <if test='sDriverNm != null and sDriverNm != ""'>
                    AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                  </if>
                  <if test='sRoDocNo != null and sRoDocNo != ""'>
                    AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                  </if>
                  <if test='sRoFromDt != null'>
                    AND A.RO_DT <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                  </if>
                  <if test='sRoToDt!= null'>
                    AND A.RO_DT <![CDATA[<]]> TO_CHAR(#{sRoToDt} + 1, 'YYYYMMDD')
                  </if>
                  <if test='sCarRegNo != null and sCarRegNo != ""'>
                    AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                  </if>
                  <if test='sEtcTpCd != null and sEtcTpCd != ""'>
                    AND B.ETC_TP_CD LIKE '%'||#{sEtcTpCd}||'%'
                  </if>
                  <if test='sRoTp != null and sRoTp != ""'>
                    AND A.RO_TP  = #{sRoTp}
                  </if>
                  <if test='sRoStatCd != null and sRoStatCd != ""'>
                    AND A.RO_STAT_CD = #{sRoStatCd}
                  </if>
            )T1
    </select>

    <!-- 기타사항 조회  -->
    <select id="selectEtcHistListByCondition" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectEtcHistListByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM , T1.*
              FROM (
                    SELECT A.DLR_CD
                          ,A.VIN_NO
                          ,A.CAR_OWNER_NM
                          ,A.DRIVER_NM
                          ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                          ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                          ,A.CAR_REG_NO
                          ,(SELECT RUN_DIST_VAL
                              FROM SE_0200T
                              WHERE DLR_CD = A.DLR_CD
                                AND VIN_NO = A.VIN_NO
                                AND DIAG_DOC_NO = A.DIAG_DOC_NO
                                AND ROWNUM = 1 ) AS RUN_DIST_VAL
                          ,RUN_DIST_VAL  AS LAST_RUN_DIST_VAL
                          ,A.RO_DOC_NO
                          ,A.RO_TP
                          ,FN_CMM_CD_NM('SER031', A.RO_TP , #{sLangCd} , 'N') AS RO_TP_NM
                          ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                          ,A.RO_DT
                          ,FN_CMM_CD_NM('SER030', A.RO_STAT_CD , #{sLangCd} , 'N') AS RO_STAT_NM
                          ,A.RO_PRINT_DT
                          ,A.UPDT_DT
                          ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) AS UPDT_USR_NM
                          ,B.ETC_TP_CD
                          ,B.ETC_TP_NM
                          ,B.ETC_REQ_PRC
                      FROM SE_0300T A
                      INNER JOIN SE_0140T B
                       ON A.DLR_CD    = B.DLR_CD
                      AND A.RO_DOC_NO = B.JOB_NO
                      AND B.PREFIX_ID = 'RO'
                    WHERE A.DLR_CD = #{sDlrCd}
                      AND A.RO_STAT_CD != '06'
                      <if test='sVinNo != null and sVinNo != ""'>
                      AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                      </if>
                      <if test='sDriverNm != null and sDriverNm != ""'>
                      AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                      </if>
                      <if test='sRoDocNo != null and sRoDocNo != ""'>
                      AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                      </if>
                      <if test='sRoFromDt != null'>
                      AND A.RO_DT <![CDATA[>=]]> TO_CHAR(#{sRoFromDt}, 'YYYYMMDD')
                      </if>
                      <if test='sRoToDt!= null'>
                      AND A.RO_DT <![CDATA[<]]> TO_CHAR(#{sRoToDt} + 1, 'YYYYMMDD')
                      </if>
                      <if test='sCarRegNo != null and sCarRegNo != ""'>
                      AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                      </if>
                      <if test='sEtcTpCd != null and sEtcTpCd != ""'>
                      AND B.ETC_TP_CD LIKE '%'||#{sEtcTpCd}||'%'
                      </if>
                      <if test='sRoTp != null and sRoTp != ""'>
                      AND A.RO_TP  = #{sRoTp}
                      </if>
                      <if test='sRoStatCd != null and sRoStatCd != ""'>
                      AND A.RO_STAT_CD = #{sRoStatCd}
                      </if>
                   ORDER BY
                     <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                    <when test='item.field == "carRegNo"'>              CAR_REG_NO                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "vinNo"'>                 VIN_NO                        <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carOwnerNm"'>            CAR_OWNER_NM                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "driverNm"'>              DRIVER_NM                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carlineNm"'>             CARLINE_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "modelNm"'>               MODEL_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "runDistVal"'>            RUN_DIST_VAL                  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "lastRunDistVal"'>        LAST_RUN_DIST_VAL             <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roStatNm"'>              RO_STAT_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roDocNo"'>               RO_DOC_NO                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roTpNm"'>                RO_TP_NM                      <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roDtFormat"'>            RO_DT                         <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "regUsrNm"'>              REG_USR_NM                    <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roPrintDtFormat"'>       RO_PRINT_DT                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "updtDtFormat"'>          UPDT_DT                       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "updtUsrNm"'>             UPDT_USR_NM                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "etcTpCd"'>               ETC_TP_CD                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "etcTpNm"'>               ETC_TP_NM                     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "etcReqPrc"'>             ETC_REQ_PRC                   <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <otherwise>
                                        RO_DT DESC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            RO_DT DESC
                        </otherwise>
                    </choose>
                )T1
                <where>
                    <if test='firstIndex != -1 and lastIndex != -1'>
                        AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                    </if>
                </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 처음수리여부 상태 판단. -->
    <select id="selectFirstRoYnCnt" parameterType="RepairOrderVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectFirstRoYnCnt] */
        SELECT COUNT(RO_DOC_NO)
          FROM SE_0300T
         WHERE VIN_NO       =  #{vinNo}
           AND DLR_CD       =  #{dlrCd}
           AND RO_STAT_CD  !=  '06'     --RO취소
    </select>

    <select id="selectBmRepairOrderInfoCnt" parameterType="RepairOrderSearchVO" resultType="int">
        SELECT COUNT(*) AS CNT
          FROM (
                SELECT RO_DOC_NO
                      ,CASE WHEN ((A.RO_STAT_CD = '02' AND A.ALLOC_STAT_CD = '03' AND A.WRK_STAT_CD = '01')) THEN '01'
                            WHEN (A.RO_STAT_CD = '02' AND A.WRK_STAT_CD = '02') THEN '02'
                            WHEN (A.RO_STAT_CD = '02' AND A.WRK_STAT_CD = '03') THEN '03'
                            WHEN (A.RO_STAT_CD = '02' AND (A.QT_TEST_STAT_CD = 'Q5' OR A.QT_TEST_STAT_CD = 'Q1')) THEN '04'
                            WHEN (A.RO_STAT_CD = '02' AND A.DL_STAT_CD = '01') THEN '05'
                            WHEN (A.RO_STAT_CD = '03' AND A.DL_STAT_CD = '02') THEN '06'
                        END AS RO_STAT_CD
                  FROM SE_0300T A
                       LEFT OUTER JOIN CR_0101T B ON B.DLR_CD = A.DLR_CD AND B.CUST_NO = A.CAR_OWNER_ID
                 WHERE (A.GOODWILL_YN != 'Y' OR A.GOODWILL_YN IS NULL )
                   AND A.DLR_CD = 'D0103'
                   AND A.VIN_NO = 'LBEADAFC2GY053467'
                ) T
         WHERE T.RO_STAT_CD IS NOT NULL
    </select>

    <select id="selectBmRepairOrderInfo" parameterType="RepairOrderSearchVO" resultType="RepairOrderVO">
        SELECT T.*
          FROM (
                SELECT B.HP_NO AS DRIVER_HP_NO --차량소유자전화
                      --,B.SSN_CRN_NO --신분증번호
                      ,(SELECT MODEL_CD FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS LTS_MODEL_CD --모델코드
                      --,(SELECT DLR_NM FROM CM_0101T WHERE DLR_CD = A.DLR_CD) AS DLR_NM --딜러명칭
                      ,RO_DOC_NO --RO번호
                      ,RO_DT --RO일자
                      ,FN_CMM_CD_NM('SER031', A.RO_TP, 'ko', 'N') AS RO_TP_NM --RO유형명칭
                      --,POINT_YN --포인트사용여부
                      --,PAY_AMT --실제지불금액
                      ,CASE WHEN ((A.RO_STAT_CD = '02' AND A.ALLOC_STAT_CD = '03' AND A.WRK_STAT_CD = '01')) THEN '01'      --정비대기
                            WHEN (A.RO_STAT_CD = '02' AND A.WRK_STAT_CD = '02') THEN '02'                                   --정비시작
                            WHEN (A.RO_STAT_CD = '02' AND A.WRK_STAT_CD = '03') THEN '03'                                   --정비중지
                            WHEN (A.RO_STAT_CD = '02' AND (A.QT_TEST_STAT_CD = 'Q5' OR A.QT_TEST_STAT_CD = 'Q1')) THEN '04' --품질검사완료
                            WHEN (A.RO_STAT_CD = '02' AND A.DL_STAT_CD = '01') THEN '05'                                    --인도대기
                            WHEN (A.RO_STAT_CD = '03' AND A.DL_STAT_CD = '02') THEN '06'                                    --인도확인
                        END AS RO_STAT_CD --RO상태(서비스진도보드의상태)
                      ,A.CAR_REG_NO --차량번호
                      --,A.RUN_DIST_VAL AS CAR_RUN_DIST_VAL --주행거리
                      ,A.DLR_CD --딜러코드
                      ,A.RO_START_DT --RO시작시간
                      ,A.RO_END_DT --RO종료시간
                      ,A.VIN_NO --VIN번호
                      ,A.TOT_AMT AS TOT_AMT --RO총비용
                      --,B.BLUE_GRADE_NM --BM회원등급
                      --,A.RO_REMARK AS REMARK --RO비고
                      --,(SELECT MIN(WRK_START_DT) FROM SE_0330T WHERE DLR_CD = A.DLR_CD AND RO_DOC_NO = A.RO_DOC_NO) AS WRK_START_DT --수리시작일자
                      ,A.EXPC_DL_DT --예정인도시간
                      ,A.QT_TEST_END_DT --품질점검완료시간
                      ,A.DL_CHK_DT --인도확인시간
                  FROM SE_0300T A
                       LEFT OUTER JOIN CR_0101T B ON B.DLR_CD = A.DLR_CD AND B.CUST_NO = A.CAR_OWNER_ID
                 WHERE (A.GOODWILL_YN != 'Y' OR A.GOODWILL_YN IS NULL )
                   AND A.DLR_CD = 'D0103'
                   AND A.VIN_NO = 'LBEADAFC2GY053467'
                ) T
         WHERE T.RO_STAT_CD IS NOT NULL
    </select>

    <!-- 2020.09.25 查询是否有维修委托权限 -->
    <select id="selectUsrServicePowerByCondition" parameterType="String" resultType="int">
     SELECT
        COUNT(*)
        FROM CM_0810T T1
        INNER JOIN CM_0809T T2 ON T1.VIEW_ID = T2.VIEW_ID
        WHERE
            T1.USE_YN      = 'Y'
            AND T1.SYS_CD  = 'D'
            AND T1.VIEW_ID = 'VIEW-D-10337'
            AND T1.REF_ID  =  #{userId}
	</select>
	
	<!-- 维修委托确认维修预约验证查询  -->
    <select id="selectResvDocNoInfoByKey" parameterType="RepairOrderVO" resultType="String">
        SELECT RESV_STAT_CD 
        FROM SE_0100T 
        WHERE DLR_CD     	= #{dlrCd}
        AND RESV_DOC_NO  	= #{resvDocNo}
    </select>
    
    <update id="updateResvDocNoInfoByKey" parameterType="repairOrderVO">
	     UPDATE SE_0100T 
	     SET RESV_STAT_CD 	='O' 
	     WHERE DLR_CD     	= #{dlrCd}
       	 AND RESV_DOC_NO  	= #{resvDocNo}
    </update>
    
    <!--查询是否一个接车单开了多张委托单  -->
    <select id="selectRodocInfoCnt" parameterType="RepairOrderVO" resultType="int">
        SELECT COUNT(1) 
        FROM SE_0300T 
        WHERE DLR_CD     	= #{dlrCd}
        AND RESV_DOC_NO  	= #{resvDocNo}
        AND VIN_NO          = #{vinNo}
    </select>
    
    <!-- 取消交车时  cust_confirm_cd JiaMing 2021-3-31 -->
    <update id="updateCustConfirmCd" parameterType="RepairOrderVO">
    /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.updateCustConfirmCd] */
	     UPDATE SE_0300T 
	        SET  CUST_CONFIRM_CD	='' 
	     WHERE 1 = 1
           AND DLR_CD         = #{dlrCd}                   
           AND RO_DOC_NO      = #{roDocNo}               
    </update>
    
    <!-- 查询 查询特殊车辆宴请工单表信息  jiaMing 2021-4-7-->
    <select id="selectSpecialInfo" parameterType="RepairOrderVO" resultType="chn.bhmc.dms.ser.ro.vo.SpecialVO">
         /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.selectSpecialInfo] */
         SELECT * FROM (select * from SE_1162T se where se.CANCEL_YN='N') as specialRequest 
             where specialRequest.RO_DOC_NO = #{roDocNo} and specialRequest.DLR_CD =#{dlrCd} 
             and specialRequest.VIN_NO =#{vinNo}
    </select>
    
    <!-- 需求 327 交车确认时提醒客户要在APP端进行确认，服务结算时校验是否已收到APP的确认   取消交车时，更改SE_1162T 表 CANCEL_YN 字段为 Y JiaMing 2021-4-7 -->
    <update id="updateCancelYn" parameterType="chn.bhmc.dms.ser.ro.vo.SpecialVO">
    /* [chn.bhmc.dms.ser.ro.service.dao.RepairOrderDAO.updateCancelYn] */
	     UPDATE SE_1162T 
	        SET  CANCEL_YN	='Y' 
	     WHERE 1 = 1
           AND DLR_CD         = #{dlrCd}                   
           AND REQ_NO      = #{reqNo}               
    </update>
</mapper>