<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : IssueReqDetailDAO_SqlMap.xml
    Description : 구매요청상세 관리.
    author In Bo Shim
    since 2016. 1. 11.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 01. 11.     In Bo Shim     최초 생성
-->

<mapper namespace="chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO">

    <!-- 정비RO요청 부품요청상세 정보를 추가한다. -->
    <insert id="insertIssueReqDetailRo" parameterType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.insertIssueReqDetailRo] */
        INSERT INTO PT_0502T(
            DLR_CD
            ,PAR_REQ_DOC_NO
            ,PAR_REQ_DOC_LINE_NO
            ,PAR_REQ_STAT_CD
            ,CANC_YN
            ,PAR_GI_TP
            ,RO_DOC_NO
            ,RO_LINE_NO
            ,RESV_DOC_NO
            ,RESV_DOC_LINE_NO
            ,GI_STRGE_CD
            ,GI_LOC_CD
            ,ITEM_CD
            ,REQ_QTY
            ,UNIT_CD
            ,END_QTY
            ,REQ_STRGE_CD
            ,ETC_GI_TP
            ,PKG_DOC_NO
            ,PKG_ITEM_CD
            ,READY_STAT_CD
            ,READY_DOC_NO
            ,READY_USR_ID
            ,READY_REMARK
            ,READY_REG_DT
            ,READY_CANC_USR_ID
            ,READY_CANC_REMARK
            ,READY_CANC_REG_DT
            ,BORROW_DOC_NO
            ,BORROW_LINE_NO
            ,BORROW_TP
            ,BORROW_STAT_CD
            ,BORROW_QTY
            ,BORROW_USR_ID
            ,BORROW_REG_DT
            ,ETC_RV_DOC_NO
            ,ETC_RV_LINE_NO
            ,ETC_RV_STAT_CD
            ,ETC_RV_QTY
            ,ETC_RV_PRSN_ID
            ,ETC_RV_REG_DT
            ,COM_ITEM_CD
            ,COM_ITEM_NM
            ,COM_ITEM_PRC
            ,ITEM_PRC
            ,ITEM_AMT
            ,TAX_AMT
            ,RO_TP
            ,REMARK
            ,PAYM_CD
            ,PAYM_TP
            ,PAYM_USR_NM
            ,PARTS_PRC_TP
            ,PAR_REQ_DOC_STOCK_LINE_NO
            ,MOVING_AVG_PRC
            ,MOVING_AVG_AMT
            ,REG_USR_ID
            ,REG_DT
            ,UPDT_USR_ID
            ,UPDT_DT
        ) VALUES (
            #{dlrCd}
            ,#{parReqDocNo}
            ,#{parReqDocLineNo}
            ,#{parReqStatCd}
            ,#{cancYn}
            ,#{parGiTp}
            ,#{roDocNo}
            ,#{roLineNo}
            ,#{resvDocNo}
            ,#{resvDocLineNo}
            ,#{giStrgeCd}
            ,#{giLocCd}
            ,#{itemCd}
            ,#{reqQty}
            ,#{unitCd}
            ,#{endQty}
            ,#{reqStrgeCd}
            ,#{etcGiTp}
            ,#{pkgDocNo}
            ,#{pkgItemCd}
            ,#{readyStatCd}
            ,#{readyDocNo}
            ,#{readyUsrId}
            ,#{readyRemark}
            ,SYSDATE
            ,#{readyCancUsrId}
            ,#{readyCancRemark}
            ,null
            ,#{borrowDocNo}
            ,#{borrowLineNo}
            ,#{borrowTp}
            ,#{borrowStatCd}
            ,#{borrowQty}
            ,#{borrowUsrId}
            ,SYSDATE
            ,#{etcRvDocNo}
            ,#{etcRvLineNo}
            ,#{etcRvStatCd}
            ,#{etcRvQty}
            ,#{etcRvPrsnId}
            ,SYSDATE
            ,#{comItemCd}
            ,#{comItemNm}
            ,#{comItemPrc}
            ,ROUND(#{itemPrc}, 2)
            ,ROUND(#{itemAmt}, 2)
            ,#{taxAmt}
            ,#{roTp}
            ,#{remark}
            ,#{paymCd}
            ,#{paymTp}
            ,#{paymUsrNm}
            ,#{partsPrcTp}
            ,CASE WHEN #{parReqStatCd} = '03' THEN #{parReqDocStockLineNo}
            ELSE
                (select NVL(MAX(T.PAR_REQ_DOC_LINE_NO),0)+1 FROM PT_0502T T WHERE T.PAR_REQ_DOC_NO = nvl(#{parReqDocNo},'-999'))
            END
            ,ROUND(#{movingAvgPrc}, 2)
            ,ROUND(#{movingAvgAmt}, 2)
            ,#{regUsrId}
            ,SYSDATE
            ,#{updtUsrId}
            ,SYSDATE
        )
    </insert>

    <!-- 정비RO 부품요청상세 최대 부품요청상세번호를 조회한다. -->
    <select id="selectIssueReqDetailsMaxNumByConditionCnt" parameterType="IssueReqSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqDetailsMaxNumByConditionCnt] */
        SELECT
            NVL(MAX(PAR_REQ_DOC_LINE_NO), 0) + 1 AS PAR_REQ_DOC_LINE_NO
        FROM PT_0502T
        WHERE DLR_CD = #{sDlrCd}
        AND RO_DOC_NO = #{sRoDocNo}
    </select>

    <!-- 부품요청상세 정보를 추가한다.(부품예류) -->
    <insert id="insertIssueReqDetailReady" parameterType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.insertIssueReqDetailReady] */
        INSERT INTO PT_0502T(
            DLR_CD
            ,PAR_REQ_DOC_NO
            ,PAR_REQ_DOC_LINE_NO
            ,PAR_REQ_STAT_CD
            ,CANC_YN
            ,PAR_GI_TP
            ,RO_DOC_NO
            ,RO_LINE_NO
            ,RESV_DOC_NO
            ,RESV_DOC_LINE_NO
            ,GI_STRGE_CD
            ,GI_LOC_CD
            ,ITEM_CD
            ,REQ_QTY
            ,UNIT_CD
            ,END_QTY
            ,REQ_STRGE_CD
            ,ETC_GI_TP
            ,PKG_DOC_NO
            ,PKG_ITEM_CD
            ,READY_STAT_CD
            ,READY_DOC_NO
            ,READY_USR_ID
            ,READY_REMARK
            ,READY_REG_DT
            ,READY_CANC_USR_ID
            ,READY_CANC_REMARK
            ,READY_CANC_REG_DT
            ,BORROW_DOC_NO
            ,BORROW_LINE_NO
            ,BORROW_TP
            ,BORROW_STAT_CD
            ,BORROW_QTY
            ,BORROW_USR_ID
            ,BORROW_REG_DT
            ,ETC_RV_DOC_NO
            ,ETC_RV_LINE_NO
            ,ETC_RV_STAT_CD
            ,ETC_RV_QTY
            ,ETC_RV_PRSN_ID
            ,ETC_RV_REG_DT
            ,COM_ITEM_CD
            ,COM_ITEM_NM
            ,COM_ITEM_PRC
            ,ITEM_PRC
            ,ITEM_AMT
            ,TAX_AMT
            ,RO_TP
            ,REMARK
            ,PAYM_CD
            ,PAYM_TP
            ,PAYM_USR_NM
            ,PARTS_PRC_TP
            ,PAR_REQ_DOC_STOCK_LINE_NO
            ,MOVING_AVG_PRC
            ,MOVING_AVG_AMT
            ,REG_USR_ID
            ,REG_DT
            ,UPDT_USR_ID
            ,UPDT_DT
        ) VALUES (
            #{dlrCd}
            ,#{parReqDocNo}
            ,(select NVL(MAX(T.PAR_REQ_DOC_LINE_NO),0)+1 FROM PT_0502T T WHERE T.PAR_REQ_DOC_NO = #{parReqDocNo})
            ,
            CASE WHEN #{parReqStatCdYn} = 'Y' THEN
                '02'
            ELSE
                #{parReqStatCd}
            END
            ,#{cancYn}
            ,#{parGiTp}
            ,#{roDocNo}
            ,#{roLineNo}
            ,#{resvDocNo}
            ,
            CASE WHEN #{parReqStatCd} = '03' THEN
                #{resvDocLineNo}
            ELSE
                (select NVL(MAX(T.PAR_REQ_DOC_LINE_NO),0)+1 FROM PT_0502T T WHERE T.PAR_REQ_DOC_NO = #{parReqDocNo})
            END
            ,#{giStrgeCd}
            ,#{giLocCd}
            ,#{itemCd}
            ,#{reqQty}
            ,#{unitCd}
            ,#{endQty}
            ,#{reqStrgeCd}
            ,#{etcGiTp}
            ,#{pkgDocNo}
            ,#{pkgItemCd}
            ,#{readyStatCd}
            ,#{readyDocNo}
            ,#{readyUsrId}
            ,#{readyRemark}
            ,
            CASE WHEN #{parGiTp} = 'OT' AND #{readyStatCd} = '01' THEN null
                 WHEN #{parGiTp} = 'OT' AND #{readyStatCd} != '01' THEN
                    CASE WHEN #{readyRegDtString} IS NOT NULL THEN TO_DATE(#{readyRegDtString},'YYYY-MM-DD HH24:MI:SS')
                    ELSE null
                    END
            ELSE
                SYSDATE
            END
            ,#{readyCancUsrId}
            ,#{readyCancRemark}
            ,
            CASE WHEN #{parGiTp} = 'OT' AND #{readyStatCd} = '01' THEN null
                 WHEN #{parGiTp} = 'OT' AND #{readyStatCd} != '01' THEN
                    CASE WHEN #{readyCancRegDtString} IS NOT NULL THEN TO_DATE(#{readyCancRegDtString},'YYYY-MM-DD HH24:MI:SS')
                    ELSE null
                    END
            ELSE
                SYSDATE
            END
            ,#{borrowDocNo}
            ,
            CASE WHEN #{parReqStatCd} = '03' THEN null
            ELSE
                (select NVL(MAX(T.BORROW_LINE_NO),0)+1 FROM PT_0502T T WHERE T.PAR_REQ_DOC_NO = #{parReqDocNo} AND T.BORROW_STAT_CD = '01')
            END
            ,#{borrowTp}
            ,#{borrowStatCd}
            ,#{borrowQty}
            ,#{borrowUsrId}
            ,SYSDATE
            ,#{etcRvDocNo}
            ,#{etcRvLineNo}
            ,#{etcRvStatCd}
            ,#{etcRvQty}
            ,#{etcRvPrsnId}
            ,null
            ,#{comItemCd}
            ,#{comItemNm}
            ,ROUND(#{comItemPrc}, 2)
            ,ROUND(#{itemPrc}, 2)
            ,ROUND(#{itemAmt}, 2)
            ,ROUND(#{taxAmt}, 2)
            ,#{roTp}
            ,#{remark}
            ,#{paymCd}
            ,#{paymTp}
            ,#{paymUsrNm}
            ,#{partsPrcTp}
            ,(select NVL(MAX(T.PAR_REQ_DOC_LINE_NO),0)+1 FROM PT_0502T T WHERE T.PAR_REQ_DOC_NO = #{parReqDocNo})
            ,ROUND(#{movingAvgPrc}, 2)
            ,ROUND(#{movingAvgAmt}, 2)
            ,#{regUsrId}
            ,SYSDATE
            ,#{updtUsrId}
            ,SYSDATE
        )
    </insert>


    <!-- 부품요청상세 정보를 추가한다. -->
    <insert id="insertIssueReqDetail" parameterType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.insertIssueReqDetail] */
        INSERT INTO PT_0502T(
            DLR_CD
            ,PAR_REQ_DOC_NO
            ,PAR_REQ_DOC_LINE_NO
            ,PAR_REQ_STAT_CD
            ,CANC_YN
            ,PAR_GI_TP
            ,RO_DOC_NO
            ,RO_LINE_NO
            ,RESV_DOC_NO
            ,RESV_DOC_LINE_NO
            ,GI_STRGE_CD
            ,GI_LOC_CD
            ,ITEM_CD
            ,REQ_QTY
            ,UNIT_CD
            ,END_QTY
            ,REQ_STRGE_CD
            ,ETC_GI_TP
            ,PKG_DOC_NO
            ,PKG_ITEM_CD
            ,READY_STAT_CD
            ,READY_DOC_NO
            ,READY_USR_ID
            ,READY_REMARK
            ,READY_REG_DT
            ,READY_CANC_USR_ID
            ,READY_CANC_REMARK
            ,READY_CANC_REG_DT
            ,BORROW_DOC_NO
            ,BORROW_LINE_NO
            ,BORROW_TP
            ,BORROW_STAT_CD
            ,BORROW_QTY
            ,BORROW_USR_ID
            ,BORROW_REG_DT
            ,ETC_RV_DOC_NO
            ,ETC_RV_LINE_NO
            ,ETC_RV_STAT_CD
            ,ETC_RV_QTY
            ,ETC_RV_PRSN_ID
            ,ETC_RV_REG_DT
            ,COM_ITEM_CD
            ,COM_ITEM_NM
            ,COM_ITEM_PRC
            ,ITEM_PRC
            ,ITEM_AMT
            ,TAX_AMT
            ,RO_TP
            ,REMARK
            ,PAYM_CD
            ,PAYM_TP
            ,PAYM_USR_NM
            ,PARTS_PRC_TP
            ,PAR_REQ_DOC_STOCK_LINE_NO
            ,MOVING_AVG_PRC
            ,MOVING_AVG_AMT
            ,REG_USR_ID
            ,REG_DT
            ,UPDT_USR_ID
            ,UPDT_DT
        ) VALUES (
            #{ dlrCd }
            ,#{ parReqDocNo }
            ,(select NVL(MAX(T.PAR_REQ_DOC_LINE_NO),0)+1 FROM PT_0502T T WHERE T.PAR_REQ_DOC_NO = #{ parReqDocNo })
            ,
            CASE WHEN #{ parReqStatCdYn } = 'Y' THEN
                '02'
            ELSE
                #{ parReqStatCd }
            END
            ,#{ cancYn }
            ,#{ parGiTp }
            ,#{ roDocNo }
            ,#{ roLineNo }
            ,#{ resvDocNo }
            ,#{ resvDocLineNo }
            ,#{ giStrgeCd }
            ,#{ giLocCd }
            ,#{ itemCd }
            ,#{ reqQty }
            ,#{ unitCd }
            ,#{ endQty }
            ,#{ reqStrgeCd }
            ,#{ etcGiTp }
            ,#{ pkgDocNo }
            ,#{ pkgItemCd }
            ,#{ readyStatCd }
            ,#{ readyDocNo }
            ,#{ readyUsrId }
            ,#{ readyRemark }
            ,
            CASE WHEN #{ parGiTp } = 'OT' AND #{ readyStatCd } = '01' THEN null
                 WHEN #{ parGiTp } = 'OT' AND #{ readyStatCd } != '01' THEN SYSDATE
            ELSE
                SYSDATE
            END
            ,#{ readyCancUsrId }
            ,#{ readyCancRemark }
            ,
            CASE WHEN #{ parGiTp } = 'OT' AND #{ readyStatCd } = '01' THEN null
                 WHEN #{ parGiTp } = 'OT' AND #{ readyStatCd } != '01' THEN SYSDATE
            ELSE
                SYSDATE
            END
            ,#{ borrowDocNo }
            ,
            CASE WHEN #{ parReqStatCd } = '03' THEN null
            ELSE
                (select NVL(MAX(T.BORROW_LINE_NO),0)+1 FROM PT_0502T T WHERE T.PAR_REQ_DOC_NO = #{ parReqDocNo } AND T.BORROW_STAT_CD = '01')
            END
            ,#{ borrowTp }
            ,#{ borrowStatCd }
            ,#{ borrowQty }
            ,#{ borrowUsrId }
            ,SYSDATE
            ,#{ etcRvDocNo }
            ,#{ etcRvLineNo }
            ,#{ etcRvStatCd }
            ,#{ etcRvQty }
            ,#{ etcRvPrsnId }
            ,null
            ,#{ comItemCd }
            ,#{ comItemNm }
            ,ROUND(#{ comItemPrc }, 2)
            ,ROUND(#{ itemPrc }, 2)
            ,ROUND(#{ itemAmt }, 2)
            ,ROUND(#{ taxAmt }, 2)
            ,#{ roTp }
            ,#{ remark }
            ,#{paymCd}
            ,#{paymTp}
            ,#{paymUsrNm}
            ,#{partsPrcTp}
            ,CASE WHEN #{ parReqStatCd } = '03' THEN #{ parReqDocStockLineNo }
            ELSE
                (select NVL(MAX(T.PAR_REQ_DOC_LINE_NO),0)+1 FROM PT_0502T T WHERE T.PAR_REQ_DOC_NO = #{ parReqDocNo })
            END
            ,ROUND(#{movingAvgPrc}, 2)
            ,ROUND(#{movingAvgAmt}, 2)
            ,#{regUsrId}
            ,SYSDATE
            ,#{updtUsrId}
            ,SYSDATE
        )
    </insert>

    <!-- 부품요청상세 정보를 수정한다. -->
    <update id="updateIssueReqDetail" parameterType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.updateIssueReqDetail] */
        UPDATE PT_0502T SET
            UPDT_DT = SYSDATE
            <if test='updtUsrId != null and updtUsrId != ""'>
            ,UPDT_USR_ID = #{ updtUsrId }
            </if>
            <if test='cancYn != null and cancYn != ""'>
            ,CANC_YN = #{ cancYn }
            </if>
            <if test='parReqStatCd != null and parReqStatCd != ""'>
            <choose>
                <when test='parReqStatCdYn == "Y"'>
                    ,PAR_REQ_STAT_CD = '02'
                </when>
                <otherwise>
                    ,PAR_REQ_STAT_CD = #{parReqStatCd}
                </otherwise>
            </choose>
            </if>
            <if test='giStrgeCd != null and giStrgeCd != ""'>
            ,GI_STRGE_CD = #{ giStrgeCd }
            </if>
            <if test='giLocCd != null and giLocCd != ""'>
            ,GI_LOC_CD = #{ giLocCd }
            </if>
            <if test='reqQty != null'>
            ,REQ_QTY = #{ reqQty }
            </if>
            <if test='unitCd != null and unitCd != ""'>
            ,UNIT_CD = #{ unitCd }
            </if>
            <if test='endQty != null'>
            ,END_QTY = #{ endQty }
            </if>
            <if test='reqStrgeCd != null and reqStrgeCd != ""'>
            ,REQ_STRGE_CD = #{ reqStrgeCd }
            </if>
            <if test='etcGiTp != null and etcGiTp != ""'>
            ,ETC_GI_TP = #{ etcGiTp }
            </if>
            <if test='itemCd != null and itemCd != ""'>
            ,ITEM_CD = #{ itemCd }
            </if>
            <if test='readyStatCd != null and readyStatCd != ""'>
            ,READY_STAT_CD = #{ readyStatCd }
            </if>
            <if test='readyDocNo != null and readyDocNo != ""'>
                <if test='parGiTp != null and parGiTp != ""'>
                    ,READY_DOC_NO = #{ readyDocNo }
                </if>
            </if>

            <if test='parGiTp != null and parGiTp != ""'>
            <choose>
                <when test='parGiTp == "OT" and readyStatCd =="03"'>
                    ,READY_REG_DT = #{ readyRegDt }
                </when>
                <otherwise>
                    <if test='readyRegDt != null'>
                        ,READY_REG_DT = #{ readyRegDt }
                    </if>
                </otherwise>
            </choose>
            </if>

            <if test='readyUsrId != null and readyUsrId != ""'>
            ,READY_USR_ID = #{ readyUsrId }
            </if>
            <if test='readyRemark != null and readyRemark != ""'>
            ,READY_REMARK = #{ readyRemark }
            </if>
            <if test='readyCancUsrId != null and readyCancUsrId != ""'>
            ,READY_CANC_USR_ID = #{ readyCancUsrId }
            </if>

            <if test='parGiTp != null and parGiTp != ""'>
            <choose>
                <when test='parGiTp == "OT" and readyStatCd =="05"'>
                    ,READY_CANC_REG_DT = SYSDATE
                </when>
                <otherwise>
                    <if test='readyCancRegDt != null'>
                    ,READY_CANC_REG_DT = SYSDATE
                    </if>
                </otherwise>
            </choose>
            </if>

            <if test='readyCancRemark != null and readyCancRemark != ""'>
            ,READY_CANC_REMARK = #{ readyCancRemark }
            </if>
            <if test='borrowDocNo != null and borrowDocNo != ""'>
            ,BORROW_DOC_NO = #{ borrowDocNo }
            </if>
            <if test='borrowLineNo != null and borrowLineNo != 0'>
            ,BORROW_LINE_NO = #{ borrowLineNo }
            </if>
            <if test='borrowTp != null and borrowTp != ""'>
            ,BORROW_TP = #{ borrowTp }
            </if>
            <if test='borrowStatCd != null and borrowStatCd != ""'>
            ,BORROW_STAT_CD = #{ borrowStatCd }
            </if>
            <if test='borrowQty != null and borrowQty != 0'>
            ,BORROW_QTY = #{ borrowQty }
            </if>
            <if test='borrowUsrId != null and borrowUsrId != ""'>
            ,BORROW_USR_ID = #{ borrowUsrId }
            </if>
            <if test='borrowUsrId != null and borrowUsrId != ""'>
            ,BORROW_REG_DT = SYSDATE
            </if>
            <if test='etcRvDocNo != null and etcRvDocNo != ""'>
            ,ETC_RV_DOC_NO = #{etcRvDocNo}
            </if>
            <if test='etcRvLineNo != null and etcRvLineNo != 0'>
            ,ETC_RV_LINE_NO = #{etcRvLineNo}
            </if>
            <if test='etcRvStatCd != null and etcRvStatCd != ""'>
            ,ETC_RV_STAT_CD = #{etcRvStatCd}
            </if>
            <if test='etcRvQty != null and etcRvQty != 0'>
            ,ETC_RV_QTY = #{etcRvQty}
            </if>
            <if test='etcRvPrsnId != null and etcRvPrsnId != ""'>
            ,ETC_RV_PRSN_ID = #{etcRvPrsnId}
            </if>
            <if test='etcRvPrsnId != null and etcRvPrsnId != ""'>
            ,ETC_RV_REG_DT = SYSDATE
            </if>
            <if test='comItemCd != null and comItemCd != ""'>
            ,COM_ITEM_CD = #{ comItemCd }
            </if>
            <if test='comItemNm != null and comItemNm != ""'>
            ,COM_ITEM_NM = #{ comItemNm }
            </if>
            <if test='comItemPrc != null '>
            ,COM_ITEM_PRC = ROUND(#{ comItemPrc }, 2)
            </if>
            <if test='itemPrc != null '>
            ,ITEM_PRC = ROUND(#{ itemPrc },2)
            </if>
            <if test='itemAmt != null '>
            ,ITEM_AMT = ROUND(#{ itemAmt },2)
            </if>
            <if test='taxAmt != null '>
            ,TAX_AMT = ROUND(#{ taxAmt },2)
            </if>
            <if test='roTp != null and roTp != ""'>
            ,RO_TP = #{ roTp }
            </if>
            <if test='remark != null'>
            ,REMARK = #{ remark }
            </if>
            <if test='paymCd != null and paymCd != ""'>
            ,PAYM_CD = #{ paymCd }
            </if>
            <if test='paymTp != null and paymTp != ""'>
            ,PAYM_TP = #{ paymTp }
            </if>
            <if test='paymUsrNm != null and paymUsrNm != ""'>
            ,PAYM_USR_NM = #{ paymUsrNm }
            </if>
            <if test='partsPrcTp != null and partsPrcTp != ""'>
            ,PARTS_PRC_TP = #{ partsPrcTp }
            </if>
            <if test='movingAvgPrc != null'>
            ,MOVING_AVG_PRC = ROUND(#{movingAvgPrc},2)
            </if>
            <if test='movingAvgAmt != null'>
            ,MOVING_AVG_AMT = ROUND(#{movingAvgAmt},2)
            </if>
        WHERE DLR_CD = #{dlrCd}
        AND PAR_REQ_DOC_NO = #{parReqDocNo}
        <if test='parReqDocLineNo != null and parReqDocLineNo != 0'>
            AND PAR_REQ_DOC_LINE_NO = #{parReqDocLineNo}
        </if>
        <if test='roDocNo != null and roDocNo != ""'>
            AND RO_DOC_NO = #{roDocNo}
        </if>
        <if test='roLineNo != null and roLineNo != 0'>
            AND RO_LINE_NO = #{roLineNo}
        </if>
        <if test='resvDocNo != null and resvDocNo != ""'>
            AND RESV_DOC_NO = #{resvDocNo}
        </if>
        <if test='resvDocLineNo != null and resvDocLineNo != 0'>
            AND RESV_DOC_LINE_NO = #{resvDocLineNo}
        </if>
        <if test='dbItemCd != null and dbItemCd != ""'>
            AND ITEM_CD = #{dbItemCd}
        </if>
        <if test='parReqStatCd != null and parReqStatCd != ""'>
            AND PAR_REQ_STAT_CD = #{parReqStatCd}
        </if>

    </update>

    <!-- RO번호 기준 부품요청상세 예류상태 정보 예류로 수정한다. -->
    <update id="updateIssueReqDetailReadyStatusReturn" parameterType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.updateIssueReqDetailReadyStatusReturn] */
        UPDATE PT_0502T SET
            UPDT_DT = SYSDATE
            <if test='updtUsrId != null and updtUsrId != ""'>
            ,UPDT_USR_ID = #{ updtUsrId }
            </if>
            ,READY_STAT_CD = '03'
        WHERE READY_DOC_NO IN (
            SELECT
                A.READY_DOC_NO
            FROM PT_0502T A
            INNER JOIN PT_0502T B ON A.DLR_CD = B.DLR_CD AND A.READY_DOC_NO = B.READY_DOC_NO
            WHERE A.RO_DOC_NO = #{roDocNo}
            AND B.READY_DOC_NO IS NOT NULL
            AND B.READY_STAT_CD = '06'<!-- 예류상태:정비예약만 -->
        ) AND RO_DOC_NO IS NULL
    </update>

    <!-- 부품요청상세 예류상태정보를 수정한다. -->
    <update id="updateIssueReqDetailReady" parameterType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.updateIssueReqDetail] */
        UPDATE PT_0502T SET
            UPDT_DT = SYSDATE
            <if test='updtUsrId != null and updtUsrId != ""'>
            ,UPDT_USR_ID = #{ updtUsrId }
            </if>
            <if test='readyStatCd != null and readyStatCd != ""'>
            ,READY_STAT_CD = #{ readyStatCd }
            </if>
            <if test='readyDocNo != null and readyDocNo != ""'>
                <if test='parGiTp != null and parGiTp != ""'>
                    ,READY_DOC_NO = #{ readyDocNo }
                </if>
            </if>

            <if test='parGiTp != null and parGiTp != ""'>
            <choose>
                <when test='parGiTp == "OT" and readyStatCd =="03"'>
                    ,READY_REG_DT = #{ readyRegDt }
                </when>
                <otherwise>
                    <if test='readyRegDt != null'>
                        ,READY_REG_DT = #{ readyRegDt }
                    </if>
                </otherwise>
            </choose>
            </if>

            <if test='readyUsrId != null and readyUsrId != ""'>
            ,READY_USR_ID = #{ readyUsrId }
            </if>
            <if test='readyRemark != null and readyRemark != ""'>
            ,READY_REMARK = #{ readyRemark }
            </if>
            <if test='readyCancUsrId != null and readyCancUsrId != ""'>
            ,READY_CANC_USR_ID = #{ readyCancUsrId }
            </if>

            <if test='parGiTp != null and parGiTp != ""'>
            <choose>
                <when test='parGiTp == "OT" and readyStatCd =="05"'>
                    ,READY_CANC_REG_DT = SYSDATE
                </when>
                <otherwise>
                    <if test='readyCancRegDt != null'>
                    ,READY_CANC_REG_DT = SYSDATE
                    </if>
                </otherwise>
            </choose>
            </if>

            <if test='readyCancRemark != null and readyCancRemark != ""'>
            ,READY_CANC_REMARK = #{ readyCancRemark }
            </if>
        WHERE DLR_CD = #{dlrCd}
        AND PAR_REQ_DOC_NO = #{parReqDocNo}
        <if test='parReqDocLineNo != null and parReqDocLineNo != 0'>
            AND PAR_REQ_DOC_LINE_NO = #{parReqDocLineNo}
        </if>
        <if test='roDocNo != null and roDocNo != ""'>
            AND RO_DOC_NO = #{roDocNo}
        </if>
        <if test='roLineNo != null and roLineNo != 0'>
            AND RO_LINE_NO = #{roLineNo}
        </if>
        <if test='resvDocNo != null and resvDocNo != ""'>
            AND RESV_DOC_NO = #{resvDocNo}
        </if>
        <if test='resvDocLineNo != null and resvDocLineNo != 0'>
            AND RESV_DOC_LINE_NO = #{resvDocLineNo}
        </if>
        <if test='dbItemCd != null and dbItemCd != ""'>
            AND ITEM_CD = #{dbItemCd}
        </if>
        <if test='parReqStatCd != null and parReqStatCd != ""'>
            AND PAR_REQ_STAT_CD = #{parReqStatCd}
        </if>

    </update>

    <!-- 정비수령 차용 부품이동 시 부품요청상세 정보를 수정한다. -->
    <update id="updateIssueReqDetailBorrow" parameterType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.updateIssueReqDetailBorrow] */
        UPDATE PT_0502T SET
            UPDT_DT = SYSDATE
            <if test='roLineNo != null'>
            ,RO_LINE_NO = #{roLineNo}
            </if>
            <if test='updtUsrId != null and updtUsrId != ""'>
            ,UPDT_USR_ID = #{ updtUsrId }
            </if>
            <if test='reqQty != null'>
            ,REQ_QTY = #{ reqQty }
            </if>
            <if test='unitCd != null and unitCd != ""'>
            ,UNIT_CD = #{ unitCd }
            </if>
            <if test='endQty != null'>
            ,END_QTY = #{ endQty }
            </if>
            <if test='reqStrgeCd != null and reqStrgeCd != ""'>
            ,REQ_STRGE_CD = #{ reqStrgeCd }
            </if>
            <if test='borrowDocNo != null and borrowDocNo != ""'>
            ,BORROW_DOC_NO = #{ borrowDocNo }
            </if>
            <if test='borrowLineNo != null and borrowLineNo != 0'>
            ,BORROW_LINE_NO = #{ borrowLineNo }
            </if>
            <if test='borrowTp != null and borrowTp != ""'>
            ,BORROW_TP = #{ borrowTp }
            </if>
            <if test='borrowStatCd != null and borrowStatCd != ""'>
            ,BORROW_STAT_CD = #{ borrowStatCd }
            </if>
            <if test='borrowQty != null and borrowQty != 0'>
            ,BORROW_QTY = #{ borrowQty }
            </if>
            <if test='borrowUsrId != null and borrowUsrId != ""'>
            ,BORROW_USR_ID = #{ borrowUsrId }
            </if>
            <if test='borrowUsrId != null and borrowUsrId != ""'>
            ,BORROW_REG_DT = SYSDATE
            </if>
            <if test='comItemCd != null and comItemCd != ""'>
            ,COM_ITEM_CD = #{ comItemCd }
            </if>
            <if test='comItemNm != null and comItemNm != ""'>
            ,COM_ITEM_NM = #{ comItemNm }
            </if>
            <if test='comItemPrc != null '>
            ,COM_ITEM_PRC = ROUND(#{ comItemPrc },2)
            </if>
            <if test='itemPrc != null '>
            ,ITEM_PRC = ROUND(#{ itemPrc },2)
            </if>
            <if test='itemAmt != null '>
            ,ITEM_AMT = ROUND(#{ itemAmt },2)
            </if>
            <if test='taxAmt != null '>
            ,TAX_AMT = ROUND(#{ taxAmt },2)
            </if>
            <if test='roTp != null and roTp != ""'>
            ,RO_TP = #{ roTp }
            </if>
            <if test='remark != null'>
            ,REMARK = #{ remark }
            </if>
            <if test='paymCd != null and paymCd != ""'>
            ,PAYM_CD = #{ paymCd }
            </if>
            <if test='paymTp != null and paymTp != ""'>
            ,PAYM_TP = #{ paymTp }
            </if>
            <if test='paymUsrNm != null and paymUsrNm != ""'>
            ,PAYM_USR_NM = #{ paymUsrNm }
            </if>
            <if test='partsPrcTp != null and partsPrcTp != ""'>
            ,PARTS_PRC_TP = #{ partsPrcTp }
            </if>
            <if test='movingAvgPrc != null'>
            ,MOVING_AVG_PRC = ROUND(#{movingAvgPrc},2)
            </if>
            <if test='movingAvgAmt != null'>
            ,MOVING_AVG_AMT = ROUND(#{movingAvgAmt},2)
            </if>
        WHERE DLR_CD = #{dlrCd}
        AND PAR_REQ_DOC_NO = #{parReqDocNo}
        AND PAR_REQ_DOC_LINE_NO = #{parReqDocLineNo}
        AND RO_DOC_NO = #{roDocNo}
        AND ITEM_CD = #{dbItemCd}
    </update>

    <!-- 부품요청상세 예류상태정보를 수정한다. -->
    <delete id="updateCancelIssueResvReadyStatus" parameterType="map">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.updateCancelIssueResvReadyStatus] */
        UPDATE PT_0502T SET
            READY_STAT_CD = #{readyStatCd}
        WHERE DLR_CD = #{dlrCd}
        AND RESV_DOC_NO = #{resvDocNo}
        AND READY_STAT_CD = '01'<!-- 준비상태코드 : 요청 -->
    </delete>

    <!-- 부품요청상세 차용상태정보를 수정한다. -->
    <delete id="updateCancelIssueDetailBorrowStatus" parameterType="map">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.updateCancelIssueDetailBorrowStatus] */
        UPDATE PT_0502T SET
            BORROW_STAT_CD = #{borrowStatCd}
        WHERE DLR_CD = #{dlrCd}
        AND PAR_REQ_DOC_NO = #{parReqDocNo}
        AND PAR_REQ_DOC_LINE_NO = #{parReqDocLineNo}
        AND ITEM_CD = #{itemCd}
        AND BORROW_DOC_NO = #{borrowDocNo}
    </delete>

    <!-- 부품요청상세 정보를 삭제한다. -->
    <delete id="deleteIssueReqDetail" parameterType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.deleteIssueReqDetail] */
        DELETE FROM PT_0502T
        WHERE DLR_CD = #{dlrCd}
        AND RO_DOC_NO = #{roDocNo}
        <if test='parReqDocNo != null and parReqDocNo != ""'>
            AND PAR_REQ_DOC_NO = #{parReqDocNo}
        </if>
        <if test='parReqDocLineNo != null and parReqDocLineNo != 0'>
            AND PAR_REQ_DOC_LINE_NO = #{parReqDocLineNo}
        </if>
        <if test='parReqStatCd != null and parReqStatCd != ""'>
            AND PAR_REQ_STAT_CD = #{parReqStatCd}
        </if>
        <if test='roLineNo != null and roLineNo != 0'>
            AND RO_LINE_NO = #{roLineNo}
        </if>
        <if test='resvDocNo != null and resvDocNo != ""'>
            AND RESV_DOC_NO = #{resvDocNo}
        </if>
        <if test='resvDocLineNo != null and resvDocLineNo != 0'>
            AND RESV_DOC_LINE_NO = #{resvDocLineNo}
        </if>
        <if test='itemCd != null and itemCd != ""'>
            AND ITEM_CD = #{itemCd}
        </if>
        <if test='reqStrgeCd != null and reqStrgeCd != ""'>
            AND REQ_STRGE_CD = #{reqStrgeCd}
        </if>
        <if test='readyStatCd != null and readyStatCd != ""'>
            AND READY_STAT_CD = #{readyStatCd}
        </if>
        <if test='borrowDocNoUseYn != null and borrowDocNoUseYn != "Y"'>
            AND BORROW_DOC_NO IS NULL <!-- 차용번호 없는 부품 -->
        </if>

    </delete>

    <!-- 부품요청상세 기타예류정보를 삭제한다. -->
    <delete id="deleteIssueReqDetailOtherReady" parameterType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.deleteIssueReqDetailOtherReady] */
        DELETE FROM PT_0502T
        WHERE DLR_CD = #{dlrCd}
        AND PAR_REQ_DOC_NO = #{parReqDocNo}
        AND PAR_GI_TP = #{parGiTp}
        AND ITEM_CD = #{itemCd}
    </delete>

    <!-- 부품요청상세 차용정보를 삭제한다. -->
    <delete id="deleteIssueReqDetailBorrow" parameterType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.deleteIssueReqDetailBorrow] */
        DELETE FROM PT_0502T
        WHERE DLR_CD = #{dlrCd}
        AND PAR_REQ_DOC_NO = #{parReqDocNo}
        <if test='borrowDocNo != null and borrowDocNo != ""'>
        AND BORROW_DOC_NO = #{borrowDocNo}
        </if>
        AND BORROW_LINE_NO = #{borrowLineNo}
        AND ITEM_CD = #{itemCd}
    </delete>

    <!-- 구매요청상세 정보를 조회한다. -->
    <select id="selectIssueReqDetailByKey" parameterType="map" resultType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqDetailByKey] */
        SELECT * FROM PT_0502T
        WHERE DLR_CD = #{dlrCd}
        AND PAR_REQ_DOC_NO = #{parReqDocNo}
        <if test='parReqDocLineNo != null and parReqDocLineNo != 0'>
            AND PAR_REQ_DOC_LINE_NO = #{parReqDocLineNo}
        </if>
        <if test='parReqStatCd != null and parReqStatCd != ""'>
            AND PAR_REQ_STAT_CD = #{parReqStatCd}
        </if>
        <if test='roDocNo != null and roDocNo != ""'>
            AND RO_DOC_NO = #{roDocNo}
        </if>
        <if test='roDocLineNo != null and roDocLineNo != 0'>
            AND RO_LINE_NO = #{roDocLineNo}
        </if>
        <if test='resvDocNo != null and resvDocNo != ""'>
            AND RESV_DOC_NO = #{resvDocNo}
        </if>
        <if test='resvDocLineNo != null and resvDocLineNo != 0'>
            AND RESV_DOC_LINE_NO = #{resvDocLineNo}
        </if>
        <if test='minParReqDocLineNoYn != null and minParReqDocLineNoYn != "Y"'>
            AND PAR_REQ_DOC_LINE_NO IN (SELECT MAX(PAR_REQ_DOC_LINE_NO) AS PAR_REQ_DOC_LINE_NO FROM PT_0502T WHERE DLR_CD = #{dlrCd} AND PAR_REQ_DOC_NO = #{parReqDocNo})
        </if>
        AND ITEM_CD = #{dbItemCd}
    </select>

    <!-- 정비 예약,부품번호 기준 구매요청상세 리스트 정보를 조회한다. -->
    <select id="selectIssueReqDetailSrSpItemList" parameterType="map" resultType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqDetailSrSpItemList] */
        SELECT * FROM PT_0502T
        WHERE DLR_CD = #{dlrCd}
        AND RO_DOC_NO = #{roDocNo}
        AND ITEM_CD = #{dbItemCd}
        AND RO_LINE_NO = #{roDocLineNo}
        AND PAR_GI_TP = #{parGiTp}
    </select>

    <!-- 정비 RO번호 기준 구매요청상세 리스트 정보를 조회한다. -->
    <select id="selectIssueReqDetailRoItemList" parameterType="map" resultType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqDetailRoItemList] */
        SELECT * FROM PT_0502T
        WHERE DLR_CD = #{dlrCd}
        AND RO_DOC_NO = #{roDocNo}
        AND ITEM_CD = #{dbItemCd}
        AND RO_LINE_NO = #{roDocLineNo}
        AND PAR_GI_TP = #{parGiTp}
    </select>

    <!-- 정비수령 부품요청상세 정보 목록을 조회한다. -->
    <select id="selectIssueReqDetailsByCondition" parameterType="IssueReqSearchVO" resultType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqDetailsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T2.* FROM (
                SELECT
                    T1.DLR_CD
                    ,T1.PAR_REQ_DOC_NO
                    ,T1.PAR_REQ_DOC_LINE_NO
                    ,T1.PAR_REQ_DOC_STOCK_LINE_NO
                    ,T1.PAR_REQ_STAT_CD
                    ,T1.PURC_REQ_NO
                    ,T1.CANC_YN
                    ,T1.PAR_GI_TP
                    ,T1.RO_DOC_NO
                    ,T1.RO_LINE_NO
                    ,T1.RESV_DOC_NO
                    ,T1.RESV_DOC_LINE_NO
                    ,T1.GR_STRGE_CD
                    ,T1.GI_STRGE_CD
                    ,T1.GI_LOC_CD
                    ,T1.DB_ITEM_CD
                    ,T1.ITEM_CD
                    ,T1.BRAND_CD
                    ,T1.ITEM_PRC
                    ,CASE WHEN T1.PAR_REQ_STAT_CD = '03' THEN ROUND(T1.ITEM_PRC * T1.END_QTY, 2)
                          WHEN T1.PAR_REQ_STAT_CD = '01' AND T1.END_QTY = 0 THEN ROUND(T1.ITEM_PRC * T1.REQ_QTY, 2)
                     ELSE T1.ITEM_AMT
                     END ITEM_AMT
                    ,T1.TAX_DDCT_AMT
                    ,T1.TAX_AMT
                    ,T1.REQ_QTY
                    ,T1.RESV_QTY
                    ,T1.END_QTY
                    ,T1.REQ_STRGE_CD
                    ,T1.REG_DT
                    ,T1.REG_USR_ID
                    ,T1.REG_USR_NM
                    ,T1.UPDT_USR_NM
                    ,T1.DEPT_CD
                    ,T1.DEPT_NM
                    ,T1.UPDT_DT
                    ,T1.UPDT_USR_ID
                    ,T1.ITEM_NM
                    ,T1.TOT_STOCK_QTY
                    ,T1.AVLB_STOCK_QTY
                    ,T1.RESV_STOCK_QTY
                    ,T1.CLAM_STOCK_QTY
                    ,T1.BORROW_STOCK_QTY
                    ,T1.RENT_QTY
                    ,T1.GR_SCHE_QTY
                    ,T1.GI_SCHE_QTY
                    ,T1.REG_DT AS PURC_REQ_DT
                    ,T1.GI_DOC_NO
                    ,T1.GI_DOC_TP
                    ,T1.GI_DOC_STAT_CD
                    ,T1.MVT_DOC_YY_MM
                    ,T1.MVT_DOC_NO
                    ,T1.MVT_DOC_LINE_NO
                    ,T1.CUST_CD
                    ,T1.CUST_NM
                    ,T1.SER_PRSN_ID
                    ,T1.VIN_NO
                    ,T1.CAR_NO
                    ,T1.DB_YN
                    ,T1.GI_STAT_CD
                    ,T1.RECEIVE_ID
                    ,T1.RECEIVE_NM
                    ,T1.GI_DT
                    ,T1.RECEIVE_DT
                    ,T1.RECEIVE_TIME
                    ,T1.RETURN_ID
                    ,T1.RETURN_DT
                    ,T1.CANC_ID
                    ,T1.CANC_DT
                    ,T1.GI_CAU_NM
                    ,T1.ETC_GI_TP
                    ,T1.PKG_DOC_NO
                    ,T1.PKG_ITEM_CD
                    ,T1.PKG_DETL_DC_RATE
                    ,T1.PKG_DETL_DC_TOT_AMT
                    ,T1.PKG_DETL_DC_AMT
                    ,T1.RETURN_PARTS_QTY
                    ,T1.MOVING_AVG_PRC
                    ,T1.MOVING_AVG_AMT
                    ,T1.MOVING_AVG_TAX_DDCT_PRC
                    ,T1.MOVING_AVG_TAX_DDCT_AMT
                    ,T1. READY_STAT_CD
                    ,T1.READY_DOC_NO
                    ,T1.READY_REMARK
                    ,T1.READY_USR_ID
                    ,T1.READY_REG_DT
                    ,T1.READY_CANC_REMARK
                    ,T1.READY_CANC_USR_ID
                    ,T1.READY_CANC_REG_DT
                    ,T1.BORROW_DOC_NO
                    ,T1.BORROW_LINE_NO
                    ,T1.BORROW_TP
                    ,T1.BORROW_STAT_CD
                    ,T1.BORROW_QTY
                    ,T1.BORROW_USR_ID
                    ,T1.BORROW_USR_NM
                    ,T1.BORROW_DEPT_NM
                    ,T1.BORROW_REG_DT
                    ,T1.ETC_RV_DOC_NO
                    ,T1.ETC_RV_LINE_NO
                    ,T1.ETC_RV_STAT_CD
                    ,T1.ETC_RV_QTY
                    ,T1.ETC_RV_PRSN_ID
                    ,T1.ETC_RV_REG_DT
                    ,T1.COM_ITEM_CD
                    ,T1.COM_ITEM_NM
                    ,T1.COM_ITEM_PRC
                    ,T1.RO_TP
                    ,T1.PRC_TP
                    ,T1.RETL_PRC
                    ,T1.WHSL_PRC
                    ,T1.INC_PRC
                    ,T1.GRTE_PRC
                    ,T1.REMARK
                    ,T1.ITEM_SALE_PRC
                    ,T1.ITEM_SALE_AMT
                    ,T1.DC_RATE
                    ,T1.DC_AMT
                    ,T1.ITEM_TOT_AMT
                    ,T1.PAYM_CD
                    ,T1.PAYM_TP
                    ,T1.PAYM_USR_NM
                    ,T1.PARTS_PRC_TP
                    ,T1.TAX_DDCT_GRTE_PRC
                    ,T1.TAX_RATE
                    ,T1.MARK_UP
                    ,T1.SPYR_CD
                FROM (
                    SELECT
                        A.DLR_CD
                        ,A.PAR_REQ_DOC_NO
                        ,A.PAR_REQ_DOC_LINE_NO
                        ,A.PAR_REQ_DOC_STOCK_LINE_NO
                        ,A.PAR_REQ_STAT_CD
                        ,G.PURC_REQ_NO
                        ,A.CANC_YN
                        ,A.PAR_GI_TP
                        ,A.RO_DOC_NO
                        ,A.RO_LINE_NO
                        ,A.RESV_DOC_NO
                        ,A.RESV_DOC_LINE_NO
                        ,B.GI_STRGE_CD AS GR_STRGE_CD
                        ,NVL(A.GI_STRGE_CD,B.GI_STRGE_CD) AS GI_STRGE_CD
                        ,NVL((
                            SELECT
                                T1.LOC_CD_MIG
                            FROM PT_0224T T1
                            WHERE T1.DLR_CD = A.DLR_CD
                            AND T1.STRGE_CD = A.REQ_STRGE_CD
                            AND T1.ITEM_CD = A.ITEM_CD
                        ), A.GI_LOC_CD) AS GI_LOC_CD
                        ,A.ITEM_CD AS DB_ITEM_CD
                        ,A.ITEM_CD
                        ,B.BRAND_CD
                        ,B.STOCK_UNIT_CD AS UNIT_CD
                        ,CASE WHEN A.ITEM_PRC <![CDATA[<]]> 0 THEN ROUND(A.ITEM_PRC) * -1
                        ELSE A.ITEM_PRC
                        END AS ITEM_PRC
                        ,A.ITEM_AMT
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (ROUND(ROUND(A.ITEM_PRC * A.END_QTY,2) / ( 1 + FN_GET_VAT(null,'ALL')), 2))
                              WHEN A.PAR_REQ_STAT_CD = '01' AND A.END_QTY = 0 THEN (ROUND(ROUND(A.ITEM_PRC * A.REQ_QTY,2) / ( 1 + FN_GET_VAT(null,'ALL')), 2))
                        ELSE ROUND(ROUND(A.ITEM_PRC * A.END_QTY,2) / ( 1 + FN_GET_VAT(null,'ALL')), 2)
                        END AS TAX_DDCT_AMT
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN ROUND((ROUND(A.ITEM_PRC * A.END_QTY, 2) - (ROUND(ROUND(A.ITEM_PRC  * A.END_QTY,2) / ( 1 + FN_GET_VAT(null,'ALL')), 2))),2)
                              WHEN A.PAR_REQ_STAT_CD = '01' AND A.END_QTY = 0 THEN (ROUND(A.ITEM_PRC * A.REQ_QTY, 2) - (ROUND(ROUND(A.ITEM_PRC * A.REQ_QTY,2) / ( 1 + FN_GET_VAT(null,'ALL')), 2)))
                        ELSE A.TAX_AMT
                        END TAX_AMT
                        ,A.REQ_QTY
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '01' THEN A.REQ_QTY
                              WHEN A.PAR_REQ_STAT_CD = '03' THEN A.END_QTY
                        ELSE A.END_QTY
                        END AS RESV_QTY
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '01' THEN A.REQ_QTY
                              WHEN A.PAR_REQ_STAT_CD = '03' THEN A.END_QTY
                        ELSE A.END_QTY
                        END AS END_QTY
                        ,A.REQ_STRGE_CD
                        ,A.REG_DT
                        ,A.REG_USR_ID
                        ,K3.USR_NM AS REG_USR_NM
                        ,(SELECT BK.USR_NM FROM CM_0801T BK WHERE BK.USR_ID = A.UPDT_USR_ID) AS UPDT_USR_NM
                        ,K4.DEPT_CD
                        ,K4.DEPT_NM
                        ,CASE WHEN A.PAR_GI_TP = 'OT' AND A.READY_STAT_CD <![CDATA[!=]]> '05' THEN null
                        ELSE A.UPDT_DT
                        END AS UPDT_DT
                        ,A.UPDT_USR_ID
                        ,B.ITEM_NM
                        ,NVL(C.AVLB_STOCK_QTY,0) + NVL(C.RESV_STOCK_QTY,0) - NVL(C.BORROW_QTY,0) + NVL(C.RENT_QTY,0) AS TOT_STOCK_QTY
                        ,NVL(C.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY
                        ,NVL(C.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY
                        ,NVL(C.CLAM_STOCK_QTY,0) AS CLAM_STOCK_QTY
                        ,NVL(C.BORROW_QTY,0) AS BORROW_STOCK_QTY
                        ,NVL(C.RENT_QTY,0) AS RENT_QTY
                        ,NVL(C.GR_SCHE_QTY,0) AS GR_SCHE_QTY
                        ,NVL(C.GI_SCHE_QTY,0) AS GI_SCHE_QTY
                        ,A.REG_DT AS PURC_REQ_DT
                        ,NVL(F.GI_DOC_NO,'-') AS GI_DOC_NO
                        ,NVL(E.GI_DOC_TP,'01') AS GI_DOC_TP
                        ,NVL(F.GI_DOC_STAT_CD,'01') AS GI_DOC_STAT_CD
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_YY_MM) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                        ELSE F.MVT_DOC_YY_MM
                        END AS MVT_DOC_YY_MM
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_NO) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                        ELSE F.MVT_DOC_NO
                        END AS MVT_DOC_NO
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_LINE_NO) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                        ELSE F.MVT_DOC_LINE_NO
                        END AS MVT_DOC_LINE_NO
                        ,H.CUST_CD
                        ,H.CUST_NM
                        ,H.SER_PRSN_ID
                        ,H.VIN_NO
                        ,H.CAR_NO
                        ,'Y' AS DB_YN
                        ,F.GI_STAT_CD
                        ,F.RECEIVE_ID
                        ,K2.USR_NM AS RECEIVE_NM
                        ,F.GI_DT
                        ,F.RECEIVE_DT
                        ,F.RECEIVE_DT AS RECEIVE_TIME
                        ,F.RETURN_ID
                        ,F.RETURN_DT
                        ,F.CANC_ID
                        ,F.CANC_DT
                        ,F.GI_CAU_NM
                        ,A.ETC_GI_TP
                        ,A.PKG_DOC_NO
                        ,A.PKG_ITEM_CD
                        ,L.PKG_DETL_DC_RATE
                        ,NVL((L.ITEM_PRC * L.ITEM_QTY) - (L.ITEM_QTY * (L.ITEM_PRC * (L.PKG_DETL_DC_RATE / 100))),0) AS PKG_DETL_DC_TOT_AMT
                        ,NVL(L.ITEM_QTY * (L.ITEM_PRC * (L.PKG_DETL_DC_RATE/100)),0) AS PKG_DETL_DC_AMT
                        ,NVL(F.RETURN_PARTS_QTY, 0) AS RETURN_PARTS_QTY
                        ,NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) AS MOVING_AVG_PRC
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '01' --등록
                                THEN ROUND(A.REQ_QTY * NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0),2)
                              WHEN A.PAR_REQ_STAT_CD = '03' --반품
                                THEN ROUND(A.END_QTY * NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0),2)
                              ELSE K5.MOVING_AVG_AMT
                          END MOVING_AVG_AMT
                        ,NVL(A.READY_STAT_CD ,'01') AS READY_STAT_CD
                        ,A.READY_DOC_NO
                        ,A.READY_REMARK
                        ,A.READY_USR_ID
                        ,A.READY_REG_DT
                        ,A.READY_CANC_REMARK
                        ,A.READY_CANC_USR_ID
                        ,A.READY_CANC_REG_DT
                        ,CASE WHEN NVL(A.BORROW_STAT_CD, '01') != '01' THEN A.BORROW_DOC_NO
                        ELSE ''
                        END AS BORROW_DOC_NO
                        ,A.BORROW_LINE_NO
                        ,A.BORROW_TP
                        ,A.BORROW_STAT_CD
                        ,A.BORROW_QTY
                        ,A.BORROW_USR_ID
                        ,(SELECT BK.USR_NM FROM CM_0801T BK WHERE BK.USR_ID = A.BORROW_USR_ID) AS BORROW_USR_NM
                        ,(SELECT AB.DEPT_NM FROM CM_0801T AA
                            LEFT JOIN CM_3401T AB ON AA.DEPT_CD = AB.DEPT_CD
                            WHERE AA.USR_ID = A.BORROW_USR_ID
                        ) AS BORROW_DEPT_NM
                        ,A.BORROW_REG_DT
                        ,A.ETC_RV_DOC_NO
                        ,A.ETC_RV_LINE_NO
                        ,A.ETC_RV_STAT_CD
                        ,A.ETC_RV_QTY
                        ,A.ETC_RV_PRSN_ID
                        ,A.ETC_RV_REG_DT
                        ,A.COM_ITEM_CD
                        ,A.COM_ITEM_NM
                        ,A.COM_ITEM_PRC
                        ,NVL(A.RO_TP, '01') AS RO_TP
                        ,DECODE(A.RO_TP,'02','04' <!--RO유형 보증(02) : 가격보증(04) -->
                                       ,'03','03' <!--RO유형 보험(03) : 가격보험(03) -->
                                       ,'01') AS PRC_TP<!--그외 일반가(01) -->
                        ,I.RETL_PRC
                        ,I.WHSL_PRC
                        ,I.INC_PRC
                        ,I.GRTE_PRC
                        ,A.REMARK
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(ITEM_SALE_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(ITEM_SALE_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(ITEM_SALE_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS ITEM_SALE_PRC
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(ITEM_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(ITEM_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(ITEM_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS ITEM_SALE_AMT
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(DC_RATE, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(DC_RATE, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(DC_RATE, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS DC_RATE
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(DC_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(DC_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(DC_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS DC_AMT
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(ITEM_TOT_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(ITEM_TOT_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(ITEM_TOT_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS ITEM_TOT_AMT
                        ,A.PAYM_CD
                        ,A.PAYM_TP
                        ,A.PAYM_USR_NM
                        ,A.PARTS_PRC_TP
                        ,I.TAX_DDCT_GRTE_PRC
                        ,(
                            SELECT
                                TB.PTUP_DUMP AS MARK_UP
                            FROM(
                                SELECT
                                    TRIM(T1.APCP_PART_NO) AS APCP_PART_NO
                                    ,T1.APCP_APPLY_DATE
                                    ,T1.APCP_PRICE_NAT_AMT
                                FROM PT_0216I T1
                                INNER JOIN(
                                SELECT
                                    TRIM(APCP_PART_NO) AS APCP_PART_NO
                                    ,MAX(APCP_APPLY_DATE) AS APCP_APPLY_DATE
                                FROM PT_0216I
                                GROUP BY APCP_PART_NO
                                ) T2 ON T1.APCP_PART_NO = T2.APCP_PART_NO AND T1.APCP_APPLY_DATE = T2.APCP_APPLY_DATE
                            )TA LEFT JOIN (
                                SELECT
                                    TRIM(PTUP_PART_NO) AS PTUP_PART_NO
                                    ,MAX(PTUP_CDAT) AS PTUP_CDAT
                                    ,MAX(PTUP_DUMP) AS PTUP_DUMP
                                    ,'Y' AS MARKUP_USE_YN
                                FROM PT_0215I
                                GROUP BY PTUP_PART_NO
                            )TB ON TA.APCP_PART_NO = TB.PTUP_PART_NO
                            WHERE TA.APCP_PART_NO = B.ITEM_CD
                        ) AS MARK_UP
                        ,B.SPYR_CD
                        ,ROUND(NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) / ( 1 + FN_GET_VAT(TO_CHAR(A.REG_DT,'YYYYMMDD'),'ALL')), 2) AS MOVING_AVG_TAX_DDCT_PRC
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '01' --등록
                                THEN ROUND(ROUND(NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) * A.REQ_QTY,2) / ( 1 + FN_GET_VAT(TO_CHAR(A.REG_DT,'YYYYMMDD'),'ALL')), 2)
                              ELSE ROUND(ROUND(NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) * A.END_QTY,2) / ( 1 + FN_GET_VAT(TO_CHAR(A.REG_DT,'YYYYMMDD'),'ALL')), 2)
                          END MOVING_AVG_TAX_DDCT_AMT
                        ,(FN_GET_VAT(TO_CHAR(A.REG_DT,'YYYYMMDD'),'ALL') * 100) AS TAX_RATE
                    FROM PT_0502T A
                    LEFT JOIN PT_0201T B ON A.DLR_CD = B.DLR_CD AND A.ITEM_CD = B.ITEM_CD
                    LEFT JOIN SE_0300T R ON A.DLR_CD = R.DLR_CD AND A.RO_DOC_NO = R.RO_DOC_NO
                    LEFT JOIN PT_0301T C ON A.DLR_CD = C.DLR_CD AND A.ITEM_CD = C.ITEM_CD AND A.REQ_STRGE_CD = C.STRGE_CD
                    LEFT JOIN PT_0302T D ON A.DLR_CD = D.DLR_CD AND A.ITEM_CD = D.ITEM_CD AND A.REQ_STRGE_CD = D.STRGE_CD AND A.RESV_DOC_NO = D.RESV_DOC_NO AND A.RESV_DOC_LINE_NO = D.RESV_DOC_LINE_NO
                    LEFT JOIN PT_0511T E ON A.DLR_CD = E.DLR_CD AND A.RO_DOC_NO = E.RO_DOC_NO
                    LEFT JOIN PT_0512T F ON A.DLR_CD = F.DLR_CD AND A.PAR_REQ_DOC_NO = F.PAR_REQ_DOC_NO AND A.PAR_REQ_DOC_LINE_NO = F.PAR_REQ_DOC_LINE_NO
                    AND A.PAR_REQ_DOC_LINE_NO = F.GI_DOC_LINE_NO
                    AND A.PAR_REQ_STAT_CD = F.GI_DOC_STAT_CD
                    LEFT JOIN PT_0411T G ON A.DLR_CD = G.DLR_CD AND A.RO_DOC_NO = G.REF_DOC_NO AND A.RO_LINE_NO = G.REF_DOC_LINE_NO AND A.ITEM_CD = G.ITEM_CD
                    LEFT JOIN PT_0501T H ON A.DLR_CD = H.DLR_CD AND A.PAR_REQ_DOC_NO = H.PAR_REQ_DOC_NO
                    LEFT JOIN PT_0214T I ON A.DLR_CD = I.DLR_CD AND A.REQ_STRGE_CD = I.STRGE_CD AND A.ITEM_CD = I.ITEM_CD
                    LEFT JOIN PT_0208T J ON A.DLR_CD = J.DLR_CD AND A.REQ_STRGE_CD = J.STRGE_CD AND A.ITEM_CD = J.ITEM_CD
                    LEFT JOIN PT_0224T K ON A.DLR_CD = K.DLR_CD  AND A.REQ_STRGE_CD = K.STRGE_CD AND A.ITEM_CD = K.ITEM_CD AND K.LOC_CD != ''
                    LEFT JOIN PT_0231T L ON A.DLR_CD = L.DLR_CD AND A.PKG_ITEM_CD = L.PKG_ITEM_CD AND A.ITEM_CD = L.ITEM_CD AND A.PKG_DOC_NO = L.PKG_DOC_NO
                    LEFT JOIN CM_0801T K2 ON F.RECEIVE_ID = K2.USR_ID
                    LEFT JOIN CM_0801T K3 ON A.REG_USR_ID = K3.USR_ID
                    LEFT JOIN CM_3401T K4 ON K3.DEPT_CD = K4.DEPT_CD
                    LEFT OUTER JOIN PT_0312T K5
                      ON A.DLR_CD = K5.DLR_CD
                     AND A.PAR_REQ_DOC_NO = K5.REF_DOC_NO
                     AND A.PAR_REQ_DOC_LINE_NO = K5.REF_DOC_LINE_NO
                     AND A.REQ_STRGE_CD = K5.STRGE_CD
                     AND A.ITEM_CD = K5.ITEM_CD
                    <where>
                        <if test='sDlrCd != null and sDlrCd != ""'>
                            AND A.DLR_CD = #{sDlrCd}
                        </if>

                        <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                            AND A.PAR_REQ_DOC_NO = #{sParReqDocNo}
                        </if>

                        <if test='sParReqDocLineNo != null and sParReqDocLineNo != 0'>
                            AND A.PAR_REQ_DOC_LINE_NO = #{sParReqDocLineNo}
                        </if>

                        <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                            AND A.PAR_REQ_STAT_CD = #{sParReqStatCd}
                        </if>

                        <if test='sRoDocNo != null and sRoDocNo != ""'>
                            AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                        </if>

                        <if test='sRoLineNo != null and sRoLineNo != 0'>
                            AND A.RO_LINE_NO = #{sRoLineNo}
                        </if>

                        <if test='sResvDocNo != null and sResvDocNo != ""'>
                            AND A.RESV_DOC_NO = #{sResvDocNo}
                        </if>

                        <if test='sResvDocLineNo != null and sResvDocLineNo != 0'>
                            AND A.RESV_DOC_LINE_NO = #{sResvDocLineNo}
                        </if>

                        <if test='sParGiTp != null and sParGiTp != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG01")'>
                                    AND (A.PAR_GI_TP in ('RO') OR A.BORROW_DOC_NO IS NOT NULL)
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG02")'>
                                    AND A.BORROW_DOC_NO IS NOT NULL
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG03")'>
                                    AND A.PAR_GI_TP in ('RO') AND A.BORROW_DOC_NO IS NULL
                                </when>
                                <otherwise>
                                    AND A.PAR_GI_TP = #{sParGiTp}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sItemCd != null and sItemCd != ""'>
                            AND A.ITEM_CD LIKE '%'||#{sItemCd}||'%'
                        </if>

                        <if test='sItemCdOnly != null and sItemCdOnly != ""'>
                            AND A.ITEM_CD = #{sItemCdOnly}
                        </if>

                        <if test='sCancYn != null and sCancYn != ""'>
                            AND A.CANC_YN = #{sCancYn}
                        </if>

                        <if test='sEtcGiTp != null and sEtcGiTp != ""'>
                            AND A.ETC_GI_TP = #{sEtcGiTp}
                        </if>

                        <if test='sReqStrgeCd != null and sReqStrgeCd != ""'>
                            AND A.REQ_STRGE_CD = #{sReqStrgeCd}
                        </if>

                        <if test='sGiStrgeCd != null and sGiStrgeCd != ""'>
                            AND A.GI_STRGE_CD = #{sGiStrgeCd}
                        </if>

                        <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                            AND A.GR_STRGE_CD = #{sGrStrgeCd}
                        </if>

                        <if test='sReadyDocNo != null and sReadyDocNo != ""'>
                            AND A.READY_DOC_NO LIKE '%'||#{sReadyDocNo}||'%'
                        </if>

                        <if test='sReadyStatCd != null and sReadyStatCd != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE01")'>
                                     AND A.READY_STAT_CD IN ('01','02','04')
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE02")'>
                                     AND A.READY_STAT_CD IN ('02','03','05')
                                </when>
                                <otherwise>
                                     AND A.READY_STAT_CD = #{sReadyStatCd}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sReqStartDt != null'>
                            <choose>
                                <otherwise>
                                     AND A.REG_DT <![CDATA[>=]]> #{sReqStartDt}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sReqEndDt != null'>
                            <choose>
                                <otherwise>
                                     AND A.REG_DT <![CDATA[<=]]> #{sReqEndDt} + 1
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sVinNo != null and sVinNo != ""'>
                            AND H.VIN_NO LIKE '%'||#{sVinNo}||'%'
                        </if>

                        <if test='sCarNo != null and sCarNo != ""'>
                            AND H.CAR_NO LIKE '%'||#{sCarNo}||'%'
                        </if>

                        <if test='sCustNm != null and sCustNm != ""'>
                            AND H.CUST_NM LIKE '%'||#{sCustNm}||'%'
                        </if>

                        <if test='sBorrowStatCd != null and sBorrowStatCd != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_01")'>
                                    AND (A.BORROW_STAT_CD = '01' OR A.BORROW_DOC_NO IS NULL )
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_02")'>
                                    AND (A.BORROW_STAT_CD IN ('05','04') OR A.BORROW_DOC_NO IS NULL OR A.READY_STAT_CD = '06' )
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_03")'>
                                    AND A.BORROW_STAT_CD in ('02')<!-- 차용 -->
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_04")'>
                                    AND A.BORROW_DOC_NO IS NOT NULL
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_05")'>
                                    AND A.BORROW_STAT_CD in ('04','05')<!-- 정비차용확정, 차용대기 -->
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_06")'>
                                    AND A.BORROW_STAT_CD != '03'<!-- 반환 제외 -->
                                </when>
                                <otherwise>
                                    AND A.BORROW_STAT_CD = #{sBorrowStatCd}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sBorrowDocNoUseYn != null and sBorrowDocNoUseYn == "Y"'>
                            AND A.BORROW_DOC_NO IS NOT NULL
                        </if>

                        <if test='sGiDocStatCd != null and sGiDocStatCd != ""'>
                            AND F.GI_DOC_STAT_CD = #{sGiDocStatCd}
                        </if>

                        <if test='sGiDocNo != null and sGiDocNo != ""'>
                            AND F.GI_DOC_NO LIKE '%'||#{sGiDocNo}||'%'
                        </if>

                        <if test='sGiDocReqStartDt != null'>
                            <choose>
                                <otherwise>
                                     AND F.REG_DT <![CDATA[>=]]> #{sGiDocReqStartDt}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sGiDocReqEndDt != null'>
                            <choose>
                                <otherwise>
                                     AND F.REG_DT <![CDATA[<=]]> #{sGiDocReqEndDt} + 1
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sReceiveId != null and sReceiveId != ""'>
                            AND F.RECEIVE_ID LIKE '%'||#{sReceiveId}||'%'
                        </if>

                        <if test='sReceiveNm != null and sReceiveNm != ""'>
                            AND K2.USR_NM LIKE '%'||#{sReceiveNm}||'%'
                        </if>

                        <if test='sPartsOutUseYn != null and sPartsOutUseYn != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sPartsOutUseYn,"Y")'>
                                     AND F.GI_DOC_STAT_CD IN ('02','03')
                                </when>
                                <otherwise>
                                </otherwise>
                            </choose>
                        </if>

                    </where>
                    ORDER BY
                    <choose>
                        <when test='sort != null'>
                            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                <choose>
                                    <when test='item.field == "parReqDocNo"'>A.PAR_REQ_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "parReqDocLineNo"'>A.PAR_REQ_DOC_LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "parReqStatCd"'>A.PAR_REQ_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "cancYn"'>A.CANC_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "parGiTp"'>A.PAR_GI_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "resvDocNo"'>A.RESV_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "resvDocLineNo"'>A.RESV_DOC_LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roDocNo"'>A.RO_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "roLineNo"'>A.RO_LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "itemCd"'>A.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "itemNm"'>B.ITEM_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "giStrgeCd"'>A.GI_STRGE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "reqQty"'>A.REQ_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "endQty"'>A.END_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "reqStrgeCd"'>A.REQ_STRGE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "unitCd"'>A.UNIT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custCd"'>A.CUST_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "custNm"'>A.CUST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "vinNo"'>A.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "carNo"'>A.CAR_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "avlbStockQty"'>AVLB_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "resvStockQty"'>RESV_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "clamStockQty"'>CLAM_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "grScheQty"'>GR_SCHE_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "giScheQty"'>GI_SCHE_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "resvQty"'>RESV_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "purcReqDt"'>PURC_REQ_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "giDocNo"'>GI_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "giDocTp"'>GI_DOC_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <when test='item.field == "giDocStatCd"'>GI_DOC_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                    <otherwise>
                                        A.DLR_CD, A.PAR_REQ_DOC_STOCK_LINE_NO ASC, A.PAR_REQ_DOC_LINE_NO ASC
                                    </otherwise>
                                </choose>
                            </foreach>
                        </when>
                        <otherwise>
                            A.DLR_CD, A.PAR_REQ_DOC_STOCK_LINE_NO ASC, A.PAR_REQ_DOC_LINE_NO ASC
                        </otherwise>
                    </choose>
                ) T1
            ) T2
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 정비 수령 부품요청상세 정보 카운트를 조회한다. -->
    <select id="selectIssueReqDetailsByConditionCnt" parameterType="IssueReqSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqDetailsByConditionCnt] */
        SELECT
            count(*)
        FROM PT_0502T A
        LEFT JOIN PT_0501T B ON A.RO_DOC_NO = B.RO_DOC_NO
        LEFT JOIN SE_0300T R ON A.DLR_CD = R.DLR_CD AND A.RO_DOC_NO = R.RO_DOC_NO
        LEFT JOIN PT_0511T E ON A.DLR_CD = E.DLR_CD AND A.RO_DOC_NO = E.RO_DOC_NO
        LEFT JOIN PT_0512T F ON A.DLR_CD = F.DLR_CD AND A.PAR_REQ_DOC_NO = F.PAR_REQ_DOC_NO AND A.PAR_REQ_DOC_LINE_NO = F.PAR_REQ_DOC_LINE_NO
        AND A.PAR_REQ_DOC_LINE_NO = F.GI_DOC_LINE_NO
        AND A.PAR_REQ_STAT_CD = F.GI_DOC_STAT_CD
        LEFT JOIN CM_0801T K ON F.RECEIVE_ID = K.USR_ID
        <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND A.DLR_CD = #{sDlrCd}
            </if>

            <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                AND A.PAR_REQ_DOC_NO = #{sParReqDocNo}
            </if>

            <if test='sParReqDocLineNo != null and sParReqDocLineNo != 0'>
                AND A.PAR_REQ_DOC_LINE_NO = #{sParReqDocLineNo}
            </if>

            <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                AND A.PAR_REQ_STAT_CD = #{sParReqStatCd}
            </if>

            <if test='sRoDocNo != null and sRoDocNo != ""'>
                AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
            </if>

            <if test='sRoLineNo != null and sRoLineNo != 0'>
                AND A.RO_LINE_NO = #{sRoLineNo}
            </if>

            <if test='sResvDocNo != null and sResvDocNo != ""'>
                AND A.RESV_DOC_NO = #{sResvDocNo}
            </if>

            <if test='sResvDocLineNo != null and sResvDocLineNo != 0'>
                AND A.RESV_DOC_LINE_NO = #{sResvDocLineNo}
            </if>

            <if test='sParGiTp != null and sParGiTp != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG01")'>
                         AND (A.PAR_GI_TP in ('RO') OR A.BORROW_DOC_NO IS NOT NULL)
                    </when>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG02")'>
                         AND A.BORROW_DOC_NO IS NOT NULL
                    </when>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG03")'>
                        AND A.PAR_GI_TP in ('RO') AND A.BORROW_DOC_NO IS NULL
                    </when>
                    <otherwise>
                         AND A.PAR_GI_TP = #{sParGiTp}
                    </otherwise>
                </choose>
            </if>

            <if test='sItemCd != null and sItemCd != ""'>
                AND A.ITEM_CD LIKE '%'||#{sItemCd}||'%'
            </if>

            <if test='sItemCdOnly != null and sItemCdOnly != ""'>
                AND A.ITEM_CD = #{sItemCdOnly}
            </if>

            <if test='sCancYn != null and sCancYn != ""'>
                AND A.CANC_YN = #{sCancYn}
            </if>

            <if test='sEtcGiTp != null and sEtcGiTp != ""'>
                AND A.ETC_GI_TP = #{sEtcGiTp}
            </if>

            <if test='sReqStrgeCd != null and sReqStrgeCd != ""'>
                AND A.REQ_STRGE_CD = #{sReqStrgeCd}
            </if>

            <if test='sGiStrgeCd != null and sGiStrgeCd != ""'>
                AND A.GI_STRGE_CD = #{sGiStrgeCd}
            </if>

            <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                AND A.GR_STRGE_CD = #{sGrStrgeCd}
            </if>

            <if test='sReadyDocNo != null and sReadyDocNo != ""'>
                AND A.READY_DOC_NO LIKE '%'||#{sReadyDocNo}||'%'
            </if>

            <if test='sReadyStatCd != null and sReadyStatCd != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE01")'>
                         AND A.READY_STAT_CD IN ('01','02','04')
                    </when>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE02")'>
                         AND A.READY_STAT_CD IN ('02','03','05')
                    </when>
                    <otherwise>
                         AND A.READY_STAT_CD = #{sReadyStatCd}
                    </otherwise>
                </choose>
            </if>

            <if test='sReqStartDt != null'>
                <choose>
                    <otherwise>
                         AND A.REG_DT <![CDATA[>=]]> #{sReqStartDt}
                    </otherwise>
                </choose>
            </if>

            <if test='sReqEndDt != null'>
                <choose>
                    <otherwise>
                         AND A.REG_DT <![CDATA[<=]]> #{sReqEndDt} + 1
                    </otherwise>
                </choose>
            </if>

            <if test='sVinNo != null and sVinNo != ""'>
                AND B.VIN_NO LIKE '%'||#{sVinNo}||'%'
            </if>

            <if test='sCarNo != null and sCarNo != ""'>
                AND B.CAR_NO LIKE '%'||#{sCarNo}||'%'
            </if>

            <if test='sCustNm != null and sCustNm != ""'>
                AND B.CUST_NM LIKE '%'||#{sCustNm}||'%'
            </if>

            <if test='sBorrowStatCd != null and sBorrowStatCd != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_01")'>
                        AND (A.BORROW_STAT_CD = '01' OR A.BORROW_DOC_NO IS NULL )
                    </when>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_02")'>
                        AND (A.BORROW_STAT_CD IN ('05','04') OR A.BORROW_DOC_NO IS NULL OR A.READY_STAT_CD = '06' )
                    </when>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_03")'>
                        AND A.BORROW_STAT_CD in ('02')
                    </when>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_04")'>
                        AND A.BORROW_DOC_NO IS NOT NULL
                    </when>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_05")'>
                        AND A.BORROW_STAT_CD in ('04','05')<!-- 정비차용확정, 차용대기 -->
                    </when>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_06")'>
                        AND A.BORROW_STAT_CD != '03'<!-- 반환 제외 -->
                    </when>
                    <otherwise>
                        AND A.BORROW_STAT_CD = #{sBorrowStatCd}
                    </otherwise>
                </choose>
            </if>

            <if test='sBorrowDocNoUseYn != null and sBorrowDocNoUseYn == "Y"'>
                AND A.BORROW_DOC_NO IS NOT NULL
            </if>

            <if test='sGiDocStatCd != null and sGiDocStatCd != ""'>
                AND F.GI_DOC_STAT_CD = #{sGiDocStatCd}
            </if>

            <if test='sGiDocNo != null and sGiDocNo != ""'>
                AND F.GI_DOC_NO LIKE '%'||#{sGiDocNo}||'%'
            </if>

            <if test='sGiDocReqStartDt != null'>
                <choose>
                    <otherwise>
                         AND F.REG_DT <![CDATA[>=]]> #{sGiDocReqStartDt}
                    </otherwise>
                </choose>
            </if>

            <if test='sGiDocReqEndDt != null'>
                <choose>
                    <otherwise>
                        AND F.REG_DT <![CDATA[<=]]> #{sGiDocReqEndDt} + 1
                    </otherwise>
                </choose>
            </if>

            <if test='sReceiveId != null and sReceiveId != ""'>
                AND F.RECEIVE_ID LIKE '%'||#{sReceiveId}||'%'
            </if>

            <if test='sReceiveNm != null and sReceiveNm != ""'>
                AND K.USR_NM LIKE '%'||#{sReceiveNm}||'%'
            </if>

            <if test='sPartsOutUseYn != null and sPartsOutUseYn != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sPartsOutUseYn,"Y")'>
                        AND F.GI_DOC_STAT_CD IN ('02','03')
                    </when>
                    <otherwise>
                    </otherwise>
                </choose>
            </if>

        </where>
    </select>

    <!-- 정비수령집계 부품요청상세 정보 카운트를 조회한다. -->
    <select id="selectIssueReqDetailStatusByConditionCnt" parameterType="IssueReqSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqDetailStatusByConditionCnt] */
        SELECT count(*) FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                    TA.*
                FROM(
                   SELECT
                        A.DLR_CD
                        ,A.PAR_REQ_DOC_NO
                        ,A.PAR_REQ_DOC_LINE_NO
                        ,A.PAR_REQ_DOC_STOCK_LINE_NO
                        ,A.PAR_REQ_STAT_CD
                        ,G.PURC_REQ_NO
                        ,A.CANC_YN
                        ,A.PAR_GI_TP
                        ,A.RO_DOC_NO
                        ,A.RO_LINE_NO
                        ,A.RESV_DOC_NO
                        ,A.RESV_DOC_LINE_NO
                        ,B.GI_STRGE_CD AS GR_STRGE_CD
                        ,NVL(A.GI_STRGE_CD,B.GI_STRGE_CD) AS GI_STRGE_CD
                        ,(
                            SELECT
                                T1.LOC_CD_MIG
                            FROM PT_0224T T1
                            WHERE T1.DLR_CD = A.DLR_CD
                            AND T1.STRGE_CD = A.REQ_STRGE_CD
                            AND T1.ITEM_CD = A.ITEM_CD
                        ) AS GI_LOC_CD
                        ,NVL(A.GI_LOC_CD,K.LOC_CD) AS GI_LOC_CD
                        ,A.ITEM_CD AS DB_ITEM_CD
                        ,A.ITEM_CD
                        ,B.BRAND_CD
                        ,B.STOCK_UNIT_CD AS UNIT_CD
                        ,CASE WHEN A.ITEM_PRC <![CDATA[<]]> 0 THEN ROUND(A.ITEM_PRC) * -1
                        ELSE A.ITEM_PRC
                        END AS ITEM_PRC
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN ROUND(A.ITEM_PRC * A.END_QTY, 2)
                              WHEN A.PAR_REQ_STAT_CD = '01' AND A.END_QTY = 0 THEN ROUND(A.ITEM_PRC * A.REQ_QTY, 2)
                        ELSE A.ITEM_AMT
                        END AS ITEM_AMT
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.END_QTY )
                              WHEN A.PAR_REQ_STAT_CD = '01' AND A.END_QTY = 0 THEN (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.REQ_QTY )
                        ELSE ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.END_QTY
                        END AS TAX_DDCT_AMT
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (ROUND(A.ITEM_PRC * A.END_QTY, 2) - (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.END_QTY ))
                              WHEN A.PAR_REQ_STAT_CD = '01' AND A.END_QTY = 0 THEN (ROUND(A.ITEM_PRC * A.REQ_QTY, 2) - (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.REQ_QTY ))
                        ELSE A.TAX_AMT
                        END TAX_AMT
                        ,A.REQ_QTY
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '01' THEN A.REQ_QTY
                              WHEN A.PAR_REQ_STAT_CD = '03' THEN A.END_QTY
                        ELSE A.END_QTY
                        END AS RESV_QTY
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '01' THEN A.REQ_QTY
                              WHEN A.PAR_REQ_STAT_CD = '03' THEN A.END_QTY
                        ELSE A.END_QTY
                        END AS END_QTY
                        ,A.REQ_STRGE_CD
                        ,A.REG_DT
                        ,A.REG_USR_ID
                        ,K3.USR_NM AS REG_USR_NM
                        ,K4.DEPT_CD
                        ,K4.DEPT_NM
                        ,CASE WHEN A.PAR_GI_TP = 'OT' AND A.READY_STAT_CD <![CDATA[!=]]> '05' THEN null
                        ELSE A.UPDT_DT
                        END AS UPDT_DT
                        ,A.UPDT_USR_ID
                        ,B.ITEM_NM
                        ,NVL(C.AVLB_STOCK_QTY,0) + NVL(C.RESV_STOCK_QTY,0) - NVL(C.BORROW_QTY,0) + NVL(C.RENT_QTY,0) AS TOT_STOCK_QTY
                        ,NVL(C.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY
                        ,NVL(C.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY
                        ,NVL(C.CLAM_STOCK_QTY,0) AS CLAM_STOCK_QTY
                        ,NVL(C.BORROW_QTY,0) AS BORROW_STOCK_QTY
                        ,NVL(C.RENT_QTY,0) AS RENT_QTY
                        ,NVL(C.GR_SCHE_QTY,0) AS GR_SCHE_QTY
                        ,NVL(C.GI_SCHE_QTY,0) AS GI_SCHE_QTY
                        ,A.REG_DT AS PURC_REQ_DT
                        ,NVL(F.GI_DOC_NO,'-') AS GI_DOC_NO
                        ,NVL(E.GI_DOC_TP,'01') AS GI_DOC_TP
                        ,NVL(F.GI_DOC_STAT_CD,'01') AS GI_DOC_STAT_CD
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_YY_MM) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                        ELSE F.MVT_DOC_YY_MM
                        END AS MVT_DOC_YY_MM
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_NO) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                        ELSE F.MVT_DOC_NO
                        END AS MVT_DOC_NO
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_LINE_NO) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                        ELSE F.MVT_DOC_LINE_NO
                        END AS MVT_DOC_LINE_NO
                        ,H.CUST_CD
                        ,H.CUST_NM
                        ,H.SER_PRSN_ID
                        ,H.VIN_NO
                        ,H.CAR_NO
                        ,'Y' AS DB_YN
                        ,F.GI_STAT_CD
                        ,F.RECEIVE_ID
                        ,K2.USR_NM AS RECEIVE_NM
                        ,F.GI_DT
                        ,F.RECEIVE_DT
                        ,F.RECEIVE_DT AS RECEIVE_TIME
                        ,F.RETURN_ID
                        ,F.RETURN_DT
                        ,F.CANC_ID
                        ,F.CANC_DT
                        ,F.GI_CAU_NM
                        ,A.ETC_GI_TP
                        ,A.PKG_DOC_NO
                        ,A.PKG_ITEM_CD
                        ,L.PKG_DETL_DC_RATE
                        ,NVL((L.ITEM_PRC * L.ITEM_QTY) - (L.ITEM_QTY * (L.ITEM_PRC * (L.PKG_DETL_DC_RATE / 100))),0) AS PKG_DETL_DC_TOT_AMT
                        ,NVL(L.ITEM_QTY * (L.ITEM_PRC * (L.PKG_DETL_DC_RATE/100)),0) AS PKG_DETL_DC_AMT
                        ,NVL(F.RETURN_PARTS_QTY, 0) AS RETURN_PARTS_QTY
                        ,NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) AS MOVING_AVG_PRC
                        ,CASE WHEN A.PAR_REQ_STAT_CD IN ('01','03') THEN ROUND(A.MOVING_AVG_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')),2)
                              ELSE NVL(K6.MOVING_AVG_TAX_DDCT_PRC,0)
                         END MOVING_AVG_TAX_DDCT_PRC
                        --,A.REQ_QTY * NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) AS MOVING_AVG_AMT
                        ,NVL(CASE WHEN A.PAR_REQ_STAT_CD = '01' THEN A.REQ_QTY
                                  WHEN A.PAR_REQ_STAT_CD = '03' THEN A.END_QTY
                                  ELSE A.END_QTY
                              END, 0) * NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) AS MOVING_AVG_AMT
                        ,CASE WHEN A.PAR_REQ_STAT_CD IN ('01','03') THEN ROUND(A.END_QTY * ROUND(A.MOVING_AVG_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')),2),2)
                              ELSE ROUND(A.END_QTY * NVL(K6.MOVING_AVG_TAX_DDCT_PRC,0),2)
                         END MOVING_AVG_TAX_DDCT_AMT
                        ,NVL(A.READY_STAT_CD ,'01') AS READY_STAT_CD
                        ,A.READY_DOC_NO
                        ,A.READY_REMARK
                        ,A.READY_USR_ID
                        ,A.READY_REG_DT
                        ,A.READY_CANC_REMARK
                        ,A.READY_CANC_USR_ID
                        ,A.READY_CANC_REG_DT
                        ,CASE WHEN NVL(A.BORROW_STAT_CD, '01') != '01' THEN A.BORROW_DOC_NO
                        ELSE ''
                        END AS BORROW_DOC_NO
                        ,A.BORROW_LINE_NO
                        ,A.BORROW_TP
                        ,A.BORROW_STAT_CD
                        ,A.BORROW_QTY
                        ,A.BORROW_USR_ID
                        ,(SELECT BK.USR_NM FROM CM_0801T BK WHERE BK.USR_ID = A.BORROW_USR_ID) AS BORROW_USR_NM
                        ,(SELECT AB.DEPT_NM FROM CM_0801T AA
                            LEFT JOIN CM_3401T AB ON AA.DEPT_CD = AB.DEPT_CD
                            WHERE AA.USR_ID = A.BORROW_USR_ID
                        ) AS BORROW_DEPT_NM
                        ,A.BORROW_REG_DT
                        ,A.ETC_RV_DOC_NO
                        ,A.ETC_RV_LINE_NO
                        ,A.ETC_RV_STAT_CD
                        ,A.ETC_RV_QTY
                        ,A.ETC_RV_PRSN_ID
                        ,A.ETC_RV_REG_DT
                        ,A.COM_ITEM_CD
                        ,A.COM_ITEM_NM
                        ,A.COM_ITEM_PRC
                        ,NVL(A.RO_TP, '01') AS RO_TP
                        ,NVL(R.RO_STAT_CD,'01') AS RO_STAT_CD
                        ,DECODE(A.RO_TP,'02','04' <!--RO유형 보증(02) : 가격보증(04) -->
                                       ,'03','03' <!--RO유형 보험(03) : 가격보험(03) -->
                                       ,'01') AS PRC_TP<!--그외 일반가(01) -->
                        ,I.RETL_PRC
                        ,I.WHSL_PRC
                        ,I.INC_PRC
                        ,I.GRTE_PRC
                        ,A.REMARK
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(ITEM_SALE_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(ITEM_SALE_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(ITEM_SALE_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS ITEM_SALE_PRC
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(ITEM_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(ITEM_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(ITEM_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS ITEM_SALE_AMT
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(DC_RATE, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(DC_RATE, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(DC_RATE, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS DC_RATE
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(DC_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(DC_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(DC_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS DC_AMT
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(ITEM_TOT_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(ITEM_TOT_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(ITEM_TOT_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS ITEM_TOT_AMT
                        ,A.PAYM_CD
                        ,A.PAYM_TP
                        ,A.PAYM_USR_NM
                        ,A.PARTS_PRC_TP
                        ,K2.USR_NM
                        ,K5.USR_NM AS RO_REG_USR_NM
                        ,(FN_GET_VAT(TO_CHAR(A.REG_DT,'YYYYMMDD'),'ALL') * 100) AS TAX_RATE
                   --     ,TO_CHAR(X.CALC_DT,'YYYY-MM-DD HH24:MI:SS') AS CALC_DT_FORMAT
                    FROM PT_0502T A
                    LEFT JOIN PT_0201T B ON A.DLR_CD = B.DLR_CD AND A.ITEM_CD = B.ITEM_CD
                    LEFT JOIN SE_0300T R ON A.DLR_CD = R.DLR_CD AND A.RO_DOC_NO = R.RO_DOC_NO
                    LEFT JOIN PT_0301T C ON A.DLR_CD = C.DLR_CD AND A.ITEM_CD = C.ITEM_CD AND A.REQ_STRGE_CD = C.STRGE_CD
                    LEFT JOIN PT_0302T D ON A.DLR_CD = D.DLR_CD AND A.ITEM_CD = D.ITEM_CD AND A.REQ_STRGE_CD = D.STRGE_CD AND A.RESV_DOC_NO = D.RESV_DOC_NO AND A.RESV_DOC_LINE_NO = D.RESV_DOC_LINE_NO
                    LEFT JOIN PT_0511T E ON A.DLR_CD = E.DLR_CD AND A.RO_DOC_NO = E.RO_DOC_NO
                    LEFT JOIN PT_0512T F ON A.DLR_CD = F.DLR_CD AND A.PAR_REQ_DOC_NO = F.PAR_REQ_DOC_NO AND A.PAR_REQ_DOC_LINE_NO = F.PAR_REQ_DOC_LINE_NO
                    AND A.PAR_REQ_DOC_LINE_NO = F.GI_DOC_LINE_NO
                    AND A.PAR_REQ_STAT_CD = F.GI_DOC_STAT_CD
                    LEFT JOIN PT_0411T G ON A.DLR_CD = G.DLR_CD AND A.RO_DOC_NO = G.REF_DOC_NO AND A.RO_LINE_NO = G.REF_DOC_LINE_NO AND A.ITEM_CD = G.ITEM_CD
                    LEFT JOIN PT_0501T H ON A.DLR_CD = H.DLR_CD AND A.PAR_REQ_DOC_NO = H.PAR_REQ_DOC_NO
                    LEFT JOIN PT_0214T I ON A.DLR_CD = I.DLR_CD AND A.REQ_STRGE_CD = I.STRGE_CD AND A.ITEM_CD = I.ITEM_CD
                    LEFT JOIN PT_0208T J ON A.DLR_CD = J.DLR_CD AND A.REQ_STRGE_CD = J.STRGE_CD AND A.ITEM_CD = J.ITEM_CD
                    LEFT JOIN PT_0224T K ON A.DLR_CD = K.DLR_CD  AND A.REQ_STRGE_CD = K.STRGE_CD AND A.ITEM_CD = K.ITEM_CD AND K.LOC_CD != ''
                    LEFT JOIN PT_0231T L ON A.DLR_CD = L.DLR_CD AND A.PKG_ITEM_CD = L.PKG_ITEM_CD AND A.ITEM_CD = L.ITEM_CD AND A.PKG_DOC_NO = L.PKG_DOC_NO
                    LEFT JOIN CM_0801T K2 ON F.RECEIVE_ID = K2.USR_ID
                    LEFT JOIN CM_0801T K3 ON A.REG_USR_ID = K3.USR_ID
                    LEFT JOIN CM_3401T K4 ON K3.DEPT_CD = K4.DEPT_CD
                    LEFT JOIN CM_0801T K5 ON R.REG_USR_ID = K5.USR_ID
                    LEFT JOIN PT_0312T K6 ON K6.DLR_CD = F.DLR_CD AND K6.MVT_DOC_NO = F.MVT_DOC_NO AND K6.ITEM_CD = F.ITEM_CD
                   -- LEFT JOIN SE_0500T X ON A.DLR_CD = X.DLR_CD AND A.RO_DOC_NO = X.RO_DOC_NO
                    <where>
                        <if test='sDlrCd != null and sDlrCd != ""'>
                            AND A.DLR_CD = #{sDlrCd}
                        </if>

                        <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                            AND A.PAR_REQ_DOC_NO = #{sParReqDocNo}
                        </if>

                        <if test='sParReqDocLineNo != null and sParReqDocLineNo != 0'>
                            AND A.PAR_REQ_DOC_LINE_NO = #{sParReqDocLineNo}
                        </if>

                        <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                            AND A.PAR_REQ_STAT_CD = #{sParReqStatCd}
                        </if>

                        <if test='sRoDocNo != null and sRoDocNo != ""'>
                            AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                        </if>

                        <if test='sRoLineNo != null and sRoLineNo != 0'>
                            AND A.RO_LINE_NO = #{sRoLineNo}
                        </if>

                        <if test='sResvDocNo != null and sResvDocNo != ""'>
                            AND A.RESV_DOC_NO = #{sResvDocNo}
                        </if>

                        <if test='sResvDocLineNo != null and sResvDocLineNo != 0'>
                            AND A.RESV_DOC_LINE_NO = #{sResvDocLineNo}
                        </if>

                        <if test='sParGiTp != null and sParGiTp != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG01")'>
                                    AND (A.PAR_GI_TP in ('RO','IN') OR A.BORROW_DOC_NO IS NOT NULL)
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG02")'>
                                    AND A.BORROW_DOC_NO IS NOT NULL
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG03")'>
                                    AND A.PAR_GI_TP in ('RO') AND A.BORROW_DOC_NO IS NULL
                                </when>
                                <otherwise>
                                    AND A.PAR_GI_TP = #{sParGiTp}
                                </otherwise>
                            </choose>
                        </if>

                        AND A.BORROW_STAT_CD != '03'<!-- 정비차용상태 반환 아닌 것 -->

                        <if test='sItemCd != null and sItemCd != ""'>
                            AND A.ITEM_CD LIKE '%'||#{sItemCd}||'%'
                        </if>

                        <if test='sItemCdOnly != null and sItemCdOnly != ""'>
                            AND A.ITEM_CD = #{sItemCdOnly}
                        </if>

                        <if test='sCancYn != null and sCancYn != ""'>
                            AND A.CANC_YN = #{sCancYn}
                        </if>

                        <if test='sEtcGiTp != null and sEtcGiTp != ""'>
                            AND A.ETC_GI_TP = #{sEtcGiTp}
                        </if>

                        <if test='sReqStrgeCd != null and sReqStrgeCd != ""'>
                            AND A.REQ_STRGE_CD = #{sReqStrgeCd}
                        </if>

                        <if test='sGiStrgeCd != null and sGiStrgeCd != ""'>
                            AND A.GI_STRGE_CD = #{sGiStrgeCd}
                        </if>

                        <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                            AND A.GR_STRGE_CD = #{sGrStrgeCd}
                        </if>

                        <if test='sReadyDocNo != null and sReadyDocNo != ""'>
                            AND A.READY_DOC_NO LIKE '%'||#{sReadyDocNo}||'%'
                        </if>

                        <if test='sReadyStatCd != null and sReadyStatCd != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE01")'>
                                     AND A.READY_STAT_CD IN ('01','02','04')
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE02")'>
                                     AND A.READY_STAT_CD IN ('02','03','05')
                                </when>
                                <otherwise>
                                     AND A.READY_STAT_CD = #{sReadyStatCd}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sReqStartDt != null'>
                            <choose>
                                <otherwise>
                                     AND A.REG_DT <![CDATA[>=]]> #{sReqStartDt}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sReqEndDt != null'>
                            <choose>
                                <otherwise>
                                     AND A.REG_DT <![CDATA[<=]]> #{sReqEndDt} + 1
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sVinNo != null and sVinNo != ""'>
                            AND H.VIN_NO LIKE '%'||#{sVinNo}||'%'
                        </if>

                        <if test='sCarNo != null and sCarNo != ""'>
                            AND H.CAR_NO LIKE '%'||#{sCarNo}||'%'
                        </if>

                        <if test='sCustNm != null and sCustNm != ""'>
                            AND H.CUST_NM LIKE '%'||#{sCustNm}||'%'
                        </if>

                        <if test='sBorrowStatCd != null and sBorrowStatCd != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_01")'>
                                    AND (A.BORROW_STAT_CD = '01' OR A.BORROW_DOC_NO IS NULL )
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_02")'>
                                    AND (A.BORROW_STAT_CD IN ('05','04') OR A.BORROW_DOC_NO IS NULL OR A.READY_STAT_CD = '06' )
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_03")'>
                                    AND A.BORROW_STAT_CD in ('02')<!-- 차용 -->
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_04")'>
                                    AND A.BORROW_DOC_NO IS NOT NULL
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_05")'>
                                    AND A.BORROW_STAT_CD in ('04','05')<!-- 정비차용확정, 차용대기 -->
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_06")'>
                                    AND A.BORROW_STAT_CD != '03'<!-- 반환 제외 -->
                                </when>
                                <otherwise>
                                    AND A.BORROW_STAT_CD = #{sBorrowStatCd}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sBorrowDocNoUseYn != null and sBorrowDocNoUseYn == "Y"'>
                            AND A.BORROW_DOC_NO IS NOT NULL
                        </if>

                        <if test='sGiDocStatCd != null and sGiDocStatCd != ""'>
                            AND F.GI_DOC_STAT_CD = #{sGiDocStatCd}
                        </if>

                        <if test='sGiDocNo != null and sGiDocNo != ""'>
                            AND F.GI_DOC_NO LIKE '%'||#{sGiDocNo}||'%'
                        </if>

                        <if test='sGiDocReqStartDt != null'>
                            <choose>
                                <otherwise>
                                     AND F.RECEIVE_DT <![CDATA[>=]]> #{sGiDocReqStartDt}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sGiDocReqEndDt != null'>
                            <choose>
                                <otherwise>
                                     AND F.RECEIVE_DT <![CDATA[<=]]> #{sGiDocReqEndDt} + 1
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sReceiveId != null and sReceiveId != ""'>
                            AND F.RECEIVE_ID LIKE '%'||#{sReceiveId}||'%'
                        </if>

                        <if test='sReceiveNm != null and sReceiveNm != ""'>
                            AND K2.USR_NM LIKE '%'||#{sReceiveNm}||'%'
                        </if>

                        <if test='sRoStatCd != null and sRoStatCd != ""'>
                            AND NVL(R.RO_STAT_CD,'01') = #{sRoStatCd}
                        </if>

                        <if test='sPartsOutUseYn != null and sPartsOutUseYn != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sPartsOutUseYn,"Y")'>
                                    AND F.GI_DOC_STAT_CD IN ('02','03')
                                </when>
                                <otherwise>
                                </otherwise>
                            </choose>
                        </if>
                        AND NVL(R.RO_STAT_CD, '01') IN ('01','02')
                    </where>
                    UNION ALL
                    SELECT
                        A.DLR_CD
                        ,A.PAR_REQ_DOC_NO
                        ,A.PAR_REQ_DOC_LINE_NO
                        ,A.PAR_REQ_DOC_STOCK_LINE_NO
                        ,A.PAR_REQ_STAT_CD
                        ,G.PURC_REQ_NO
                        ,A.CANC_YN
                        ,A.PAR_GI_TP
                        ,A.RO_DOC_NO
                        ,A.RO_LINE_NO
                        ,A.RESV_DOC_NO
                        ,A.RESV_DOC_LINE_NO
                        ,B.GI_STRGE_CD AS GR_STRGE_CD
                        ,NVL(A.GI_STRGE_CD,B.GI_STRGE_CD) AS GI_STRGE_CD
                        ,(
                            SELECT
                                T1.LOC_CD_MIG
                            FROM PT_0224T T1
                            WHERE T1.DLR_CD = A.DLR_CD
                            AND T1.STRGE_CD = A.REQ_STRGE_CD
                            AND T1.ITEM_CD = A.ITEM_CD
                        ) AS GI_LOC_CD
                        ,NVL(A.GI_LOC_CD,K.LOC_CD) AS GI_LOC_CD
                        ,A.ITEM_CD AS DB_ITEM_CD
                        ,A.ITEM_CD
                        ,B.BRAND_CD
                        ,B.STOCK_UNIT_CD AS UNIT_CD
                        ,CASE WHEN A.ITEM_PRC <![CDATA[<]]> 0 THEN ROUND(A.ITEM_PRC) * -1
                        ELSE A.ITEM_PRC
                        END AS ITEM_PRC
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN ROUND(A.ITEM_PRC * A.END_QTY, 2)
                              WHEN A.PAR_REQ_STAT_CD = '01' AND A.END_QTY = 0 THEN ROUND(A.ITEM_PRC * A.REQ_QTY, 2)
                        ELSE A.ITEM_AMT
                        END AS ITEM_AMT
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.END_QTY )
                              WHEN A.PAR_REQ_STAT_CD = '01' AND A.END_QTY = 0 THEN (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.REQ_QTY )
                        ELSE ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.END_QTY
                        END AS TAX_DDCT_AMT
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (ROUND(A.ITEM_PRC * A.END_QTY, 2) - (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.END_QTY ))
                              WHEN A.PAR_REQ_STAT_CD = '01' AND A.END_QTY = 0 THEN (ROUND(A.ITEM_PRC * A.REQ_QTY, 2) - (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.REQ_QTY ))
                        ELSE A.TAX_AMT
                        END TAX_AMT
                        ,A.REQ_QTY
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '01' THEN A.REQ_QTY
                              WHEN A.PAR_REQ_STAT_CD = '03' THEN A.END_QTY
                        ELSE A.END_QTY
                        END AS RESV_QTY
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '01' THEN A.REQ_QTY
                              WHEN A.PAR_REQ_STAT_CD = '03' THEN A.END_QTY
                        ELSE A.END_QTY
                        END AS END_QTY
                        ,A.REQ_STRGE_CD
                        ,A.REG_DT
                        ,A.REG_USR_ID
                        ,K3.USR_NM AS REG_USR_NM
                        ,K4.DEPT_CD
                        ,K4.DEPT_NM
                        ,CASE WHEN A.PAR_GI_TP = 'OT' AND A.READY_STAT_CD <![CDATA[!=]]> '05' THEN null
                        ELSE A.UPDT_DT
                        END AS UPDT_DT
                        ,A.UPDT_USR_ID
                        ,B.ITEM_NM
                        ,NVL(C.AVLB_STOCK_QTY,0) + NVL(C.RESV_STOCK_QTY,0) - NVL(C.BORROW_QTY,0) + NVL(C.RENT_QTY,0) AS TOT_STOCK_QTY
                        ,NVL(C.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY
                        ,NVL(C.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY
                        ,NVL(C.CLAM_STOCK_QTY,0) AS CLAM_STOCK_QTY
                        ,NVL(C.BORROW_QTY,0) AS BORROW_STOCK_QTY
                        ,NVL(C.RENT_QTY,0) AS RENT_QTY
                        ,NVL(C.GR_SCHE_QTY,0) AS GR_SCHE_QTY
                        ,NVL(C.GI_SCHE_QTY,0) AS GI_SCHE_QTY
                        ,A.REG_DT AS PURC_REQ_DT
                        ,NVL(F.GI_DOC_NO,'-') AS GI_DOC_NO
                        ,NVL(E.GI_DOC_TP,'01') AS GI_DOC_TP
                        ,NVL(F.GI_DOC_STAT_CD,'01') AS GI_DOC_STAT_CD
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_YY_MM) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                        ELSE F.MVT_DOC_YY_MM
                        END AS MVT_DOC_YY_MM
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_NO) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                        ELSE F.MVT_DOC_NO
                        END AS MVT_DOC_NO
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_LINE_NO) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                        ELSE F.MVT_DOC_LINE_NO
                        END AS MVT_DOC_LINE_NO
                        ,H.CUST_CD
                        ,H.CUST_NM
                        ,H.SER_PRSN_ID
                        ,H.VIN_NO
                        ,H.CAR_NO
                        ,'Y' AS DB_YN
                        ,F.GI_STAT_CD
                        ,F.RECEIVE_ID
                        ,K2.USR_NM AS RECEIVE_NM
                        ,F.GI_DT
                        ,F.RECEIVE_DT
                        ,F.RECEIVE_DT AS RECEIVE_TIME
                        ,F.RETURN_ID
                        ,F.RETURN_DT
                        ,F.CANC_ID
                        ,F.CANC_DT
                        ,F.GI_CAU_NM
                        ,A.ETC_GI_TP
                        ,A.PKG_DOC_NO
                        ,A.PKG_ITEM_CD
                        ,L.PKG_DETL_DC_RATE
                        ,NVL((L.ITEM_PRC * L.ITEM_QTY) - (L.ITEM_QTY * (L.ITEM_PRC * (L.PKG_DETL_DC_RATE / 100))),0) AS PKG_DETL_DC_TOT_AMT
                        ,NVL(L.ITEM_QTY * (L.ITEM_PRC * (L.PKG_DETL_DC_RATE/100)),0) AS PKG_DETL_DC_AMT
                        ,NVL(F.RETURN_PARTS_QTY, 0) AS RETURN_PARTS_QTY
                        ,NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) AS MOVING_AVG_PRC
                        ,CASE WHEN A.PAR_REQ_STAT_CD IN ('01','03') THEN ROUND(A.MOVING_AVG_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')),2)
                              ELSE NVL(K6.MOVING_AVG_TAX_DDCT_PRC,0)
                         END MOVING_AVG_TAX_DDCT_PRC
                        --,A.REQ_QTY * NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) AS MOVING_AVG_AMT
                        ,NVL(CASE WHEN A.PAR_REQ_STAT_CD = '01' THEN A.REQ_QTY
                                  WHEN A.PAR_REQ_STAT_CD = '03' THEN A.END_QTY
                                  ELSE A.END_QTY
                              END, 0) * NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) AS MOVING_AVG_AMT
                        ,CASE WHEN A.PAR_REQ_STAT_CD IN ('01','03') THEN ROUND(A.END_QTY * ROUND(A.MOVING_AVG_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')),2),2)
                              ELSE ROUND(A.END_QTY * NVL(K6.MOVING_AVG_TAX_DDCT_PRC,0),2)
                         END MOVING_AVG_TAX_DDCT_AMT
                        ,NVL(A.READY_STAT_CD ,'01') AS READY_STAT_CD
                        ,A.READY_DOC_NO
                        ,A.READY_REMARK
                        ,A.READY_USR_ID
                        ,A.READY_REG_DT
                        ,A.READY_CANC_REMARK
                        ,A.READY_CANC_USR_ID
                        ,A.READY_CANC_REG_DT
                        ,CASE WHEN NVL(A.BORROW_STAT_CD, '01') != '01' THEN A.BORROW_DOC_NO
                        ELSE ''
                        END AS BORROW_DOC_NO
                        ,A.BORROW_LINE_NO
                        ,A.BORROW_TP
                        ,A.BORROW_STAT_CD
                        ,A.BORROW_QTY
                        ,A.BORROW_USR_ID
                        ,(SELECT BK.USR_NM FROM CM_0801T BK WHERE BK.USR_ID = A.BORROW_USR_ID) AS BORROW_USR_NM
                        ,(SELECT AB.DEPT_NM FROM CM_0801T AA
                            LEFT JOIN CM_3401T AB ON AA.DEPT_CD = AB.DEPT_CD
                            WHERE AA.USR_ID = A.BORROW_USR_ID
                        ) AS BORROW_DEPT_NM
                        ,A.BORROW_REG_DT
                        ,A.ETC_RV_DOC_NO
                        ,A.ETC_RV_LINE_NO
                        ,A.ETC_RV_STAT_CD
                        ,A.ETC_RV_QTY
                        ,A.ETC_RV_PRSN_ID
                        ,A.ETC_RV_REG_DT
                        ,A.COM_ITEM_CD
                        ,A.COM_ITEM_NM
                        ,A.COM_ITEM_PRC
                        ,NVL(A.RO_TP, '01') AS RO_TP
                        ,NVL(R.RO_STAT_CD,'01') AS RO_STAT_CD
                        ,DECODE(A.RO_TP,'02','04' <!--RO유형 보증(02) : 가격보증(04) -->
                                       ,'03','03' <!--RO유형 보험(03) : 가격보험(03) -->
                                       ,'01') AS PRC_TP<!--그외 일반가(01) -->
                        ,I.RETL_PRC
                        ,I.WHSL_PRC
                        ,I.INC_PRC
                        ,I.GRTE_PRC
                        ,A.REMARK
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(ITEM_SALE_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(ITEM_SALE_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(ITEM_SALE_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS ITEM_SALE_PRC
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(ITEM_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(ITEM_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(ITEM_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS ITEM_SALE_AMT
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(DC_RATE, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(DC_RATE, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(DC_RATE, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS DC_RATE
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(DC_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(DC_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(DC_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS DC_AMT
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(ITEM_TOT_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(ITEM_TOT_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(ITEM_TOT_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS ITEM_TOT_AMT
                        ,A.PAYM_CD
                        ,A.PAYM_TP
                        ,A.PAYM_USR_NM
                        ,A.PARTS_PRC_TP
                        ,K2.USR_NM
                        ,K5.USR_NM AS RO_REG_USR_NM
                        ,(FN_GET_VAT(TO_CHAR(A.REG_DT,'YYYYMMDD'),'ALL') * 100) AS TAX_RATE
                   --     ,TO_CHAR(X.CALC_DT,'YYYY-MM-DD HH24:MI:SS') AS CALC_DT_FORMAT
                    FROM PT_0502T A
                    LEFT JOIN PT_0201T B ON A.DLR_CD = B.DLR_CD AND A.ITEM_CD = B.ITEM_CD
                    LEFT JOIN SE_0300T R ON A.DLR_CD = R.DLR_CD AND A.RO_DOC_NO = R.RO_DOC_NO
                    LEFT JOIN PT_0301T C ON A.DLR_CD = C.DLR_CD AND A.ITEM_CD = C.ITEM_CD AND A.REQ_STRGE_CD = C.STRGE_CD
                    LEFT JOIN PT_0302T D ON A.DLR_CD = D.DLR_CD AND A.ITEM_CD = D.ITEM_CD AND A.REQ_STRGE_CD = D.STRGE_CD AND A.RESV_DOC_NO = D.RESV_DOC_NO AND A.RESV_DOC_LINE_NO = D.RESV_DOC_LINE_NO
                    LEFT JOIN PT_0511T E ON A.DLR_CD = E.DLR_CD AND A.RO_DOC_NO = E.RO_DOC_NO
                    LEFT JOIN PT_0512T F ON A.DLR_CD = F.DLR_CD AND A.PAR_REQ_DOC_NO = F.PAR_REQ_DOC_NO AND A.PAR_REQ_DOC_LINE_NO = F.PAR_REQ_DOC_LINE_NO
                    AND A.PAR_REQ_DOC_LINE_NO = F.GI_DOC_LINE_NO
                    AND A.PAR_REQ_STAT_CD = F.GI_DOC_STAT_CD
                    LEFT JOIN PT_0411T G ON A.DLR_CD = G.DLR_CD AND A.RO_DOC_NO = G.REF_DOC_NO AND A.RO_LINE_NO = G.REF_DOC_LINE_NO AND A.ITEM_CD = G.ITEM_CD
                    LEFT JOIN PT_0501T H ON A.DLR_CD = H.DLR_CD AND A.PAR_REQ_DOC_NO = H.PAR_REQ_DOC_NO
                    LEFT JOIN PT_0214T I ON A.DLR_CD = I.DLR_CD AND A.REQ_STRGE_CD = I.STRGE_CD AND A.ITEM_CD = I.ITEM_CD
                    LEFT JOIN PT_0208T J ON A.DLR_CD = J.DLR_CD AND A.REQ_STRGE_CD = J.STRGE_CD AND A.ITEM_CD = J.ITEM_CD
                    LEFT JOIN PT_0224T K ON A.DLR_CD = K.DLR_CD  AND A.REQ_STRGE_CD = K.STRGE_CD AND A.ITEM_CD = K.ITEM_CD AND K.LOC_CD != ''
                    LEFT JOIN PT_0231T L ON A.DLR_CD = L.DLR_CD AND A.PKG_ITEM_CD = L.PKG_ITEM_CD AND A.ITEM_CD = L.ITEM_CD AND A.PKG_DOC_NO = L.PKG_DOC_NO
                    LEFT JOIN CM_0801T K2 ON F.RECEIVE_ID = K2.USR_ID
                    LEFT JOIN CM_0801T K3 ON A.REG_USR_ID = K3.USR_ID
                    LEFT JOIN CM_3401T K4 ON K3.DEPT_CD = K4.DEPT_CD
                    LEFT JOIN CM_0801T K5 ON R.REG_USR_ID = K5.USR_ID
                    LEFT JOIN PT_0312T K6 ON K6.DLR_CD = F.DLR_CD AND K6.MVT_DOC_NO = F.MVT_DOC_NO AND K6.ITEM_CD = F.ITEM_CD
                 --   LEFT JOIN SE_0500T X ON A.DLR_CD = X.DLR_CD AND A.RO_DOC_NO = X.RO_DOC_NO
                    <where>
                        <if test='sDlrCd != null and sDlrCd != ""'>
                            AND A.DLR_CD = #{sDlrCd}
                        </if>

                        <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                            AND A.PAR_REQ_DOC_NO = #{sParReqDocNo}
                        </if>

                        <if test='sParReqDocLineNo != null and sParReqDocLineNo != 0'>
                            AND A.PAR_REQ_DOC_LINE_NO = #{sParReqDocLineNo}
                        </if>

                        <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                            AND A.PAR_REQ_STAT_CD = #{sParReqStatCd}
                        </if>

                        <if test='sRoDocNo != null and sRoDocNo != ""'>
                            AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                        </if>

                        <if test='sRoLineNo != null and sRoLineNo != 0'>
                            AND A.RO_LINE_NO = #{sRoLineNo}
                        </if>

                        <if test='sResvDocNo != null and sResvDocNo != ""'>
                            AND A.RESV_DOC_NO = #{sResvDocNo}
                        </if>

                        <if test='sResvDocLineNo != null and sResvDocLineNo != 0'>
                            AND A.RESV_DOC_LINE_NO = #{sResvDocLineNo}
                        </if>

                        <if test='sParGiTp != null and sParGiTp != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG01")'>
                                    AND (A.PAR_GI_TP in ('RO','IN') OR A.BORROW_DOC_NO IS NOT NULL)
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG02")'>
                                    AND A.BORROW_DOC_NO IS NOT NULL
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG03")'>
                                    AND A.PAR_GI_TP in ('RO') AND A.BORROW_DOC_NO IS NULL
                                </when>
                                <otherwise>
                                    AND A.PAR_GI_TP = #{sParGiTp}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sItemCd != null and sItemCd != ""'>
                            AND A.ITEM_CD LIKE '%'||#{sItemCd}||'%'
                        </if>

                        <if test='sItemCdOnly != null and sItemCdOnly != ""'>
                            AND A.ITEM_CD = #{sItemCdOnly}
                        </if>

                        <if test='sCancYn != null and sCancYn != ""'>
                            AND A.CANC_YN = #{sCancYn}
                        </if>

                        <if test='sEtcGiTp != null and sEtcGiTp != ""'>
                            AND A.ETC_GI_TP = #{sEtcGiTp}
                        </if>

                        <if test='sReqStrgeCd != null and sReqStrgeCd != ""'>
                            AND A.REQ_STRGE_CD = #{sReqStrgeCd}
                        </if>

                        <if test='sGiStrgeCd != null and sGiStrgeCd != ""'>
                            AND A.GI_STRGE_CD = #{sGiStrgeCd}
                        </if>

                        <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                            AND A.GR_STRGE_CD = #{sGrStrgeCd}
                        </if>

                        <if test='sReadyDocNo != null and sReadyDocNo != ""'>
                            AND A.READY_DOC_NO LIKE '%'||#{sReadyDocNo}||'%'
                        </if>

                        <if test='sReadyStatCd != null and sReadyStatCd != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE01")'>
                                     AND A.READY_STAT_CD IN ('01','02','04')
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE02")'>
                                     AND A.READY_STAT_CD IN ('02','03','05')
                                </when>
                                <otherwise>
                                     AND A.READY_STAT_CD = #{sReadyStatCd}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sReqStartDt != null'>
                            <choose>
                                <otherwise>
                                     AND A.REG_DT <![CDATA[>=]]> #{sReqStartDt}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sReqEndDt != null'>
                            <choose>
                                <otherwise>
                                     AND A.REG_DT <![CDATA[<=]]> #{sReqEndDt} + 1
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sVinNo != null and sVinNo != ""'>
                            AND H.VIN_NO LIKE '%'||#{sVinNo}||'%'
                        </if>

                        <if test='sCarNo != null and sCarNo != ""'>
                            AND H.CAR_NO LIKE '%'||#{sCarNo}||'%'
                        </if>

                        <if test='sCustNm != null and sCustNm != ""'>
                            AND H.CUST_NM LIKE '%'||#{sCustNm}||'%'
                        </if>

                        <if test='sBorrowStatCd != null and sBorrowStatCd != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_01")'>
                                    AND (A.BORROW_STAT_CD = '01' OR A.BORROW_DOC_NO IS NULL )
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_02")'>
                                    AND (A.BORROW_STAT_CD IN ('05','04') OR A.BORROW_DOC_NO IS NULL OR A.READY_STAT_CD = '06' )
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_03")'>
                                    AND A.BORROW_STAT_CD in ('02')<!-- 차용 -->
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_04")'>
                                    AND A.BORROW_DOC_NO IS NOT NULL
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_05")'>
                                    AND A.BORROW_STAT_CD in ('04','05')<!-- 정비차용확정, 차용대기 -->
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_06")'>
                                    AND A.BORROW_STAT_CD != '03'<!-- 반환 제외 -->
                                </when>
                                <otherwise>
                                    AND A.BORROW_STAT_CD = #{sBorrowStatCd}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sBorrowDocNoUseYn != null and sBorrowDocNoUseYn == "Y"'>
                            AND A.BORROW_DOC_NO IS NOT NULL
                        </if>

                        <if test='sGiDocStatCd != null and sGiDocStatCd != ""'>
                            AND F.GI_DOC_STAT_CD = #{sGiDocStatCd}
                        </if>

                        <if test='sGiDocNo != null and sGiDocNo != ""'>
                            AND F.GI_DOC_NO LIKE '%'||#{sGiDocNo}||'%'
                        </if>

                        <if test='sGiDocReqStartDt != null'>
                            <choose>
                                <otherwise>
                                     AND F.RECEIVE_DT <![CDATA[>=]]> #{sGiDocReqStartDt}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sGiDocReqEndDt != null'>
                            <choose>
                                <otherwise>
                                     AND F.RECEIVE_DT <![CDATA[<=]]> #{sGiDocReqEndDt} + 1
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sReceiveId != null and sReceiveId != ""'>
                            AND F.RECEIVE_ID LIKE '%'||#{sReceiveId}||'%'
                        </if>

                        <if test='sReceiveNm != null and sReceiveNm != ""'>
                            AND K2.USR_NM LIKE '%'||#{sReceiveNm}||'%'
                        </if>

                        <if test='sRoStatCd != null and sRoStatCd != ""'>
                            AND NVL(R.RO_STAT_CD,'01') = #{sRoStatCd}
                        </if>

                        <if test='sPartsOutUseYn != null and sPartsOutUseYn != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sPartsOutUseYn,"Y")'>
                                     AND F.GI_DOC_STAT_CD IN ('02','03')
                                </when>
                                <otherwise>
                                </otherwise>
                            </choose>
                        </if>
                        AND NVL(R.RO_STAT_CD, '01') NOT IN ('01','02')
                        AND A.PAR_REQ_STAT_CD IN ('01','02','03')
                    </where>
                )TA
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        AND TA.DLR_CD = #{sDlrCd}
                    </if>

                    <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                        AND TA.PAR_REQ_DOC_NO = #{sParReqDocNo}
                    </if>

                    <if test='sParReqDocLineNo != null and sParReqDocLineNo != 0'>
                        AND TA.PAR_REQ_DOC_LINE_NO = #{sParReqDocLineNo}
                    </if>

                    <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                        AND TA.PAR_REQ_STAT_CD = #{sParReqStatCd}
                    </if>

                    <if test='sRoDocNo != null and sRoDocNo != ""'>
                        AND TA.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                    </if>

                    <if test='sRoLineNo != null and sRoLineNo != 0'>
                        AND TA.RO_LINE_NO = #{sRoLineNo}
                    </if>

                    <if test='sResvDocNo != null and sResvDocNo != ""'>
                        AND TA.RESV_DOC_NO = #{sResvDocNo}
                    </if>

                    <if test='sResvDocLineNo != null and sResvDocLineNo != 0'>
                        AND TA.RESV_DOC_LINE_NO = #{sResvDocLineNo}
                    </if>

                    <if test='sSerPrsnId != null and sSerPrsnId != ""'>
                        AND TA.RO_REG_USR_NM LIKE '%'||#{sSerPrsnId}||'%'
                    </if>

                    <if test='sParGiTp != null and sParGiTp != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG01")'>
                                AND (TA.PAR_GI_TP in ('RO','IN') OR TA.BORROW_DOC_NO IS NOT NULL)
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG02")'>
                                AND TA.BORROW_DOC_NO IS NOT NULL
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG03")'>
                                AND TA.PAR_GI_TP in ('RO') AND TA.BORROW_DOC_NO IS NULL
                            </when>
                            <otherwise>
                                AND TA.PAR_GI_TP = #{sParGiTp}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sItemCd != null and sItemCd != ""'>
                        AND TA.ITEM_CD LIKE '%'||#{sItemCd}||'%'
                    </if>

                    <if test='sItemCdOnly != null and sItemCdOnly != ""'>
                        AND TA.ITEM_CD = #{sItemCdOnly}
                    </if>

                    <if test='sCancYn != null and sCancYn != ""'>
                        AND TA.CANC_YN = #{sCancYn}
                    </if>

                    <if test='sEtcGiTp != null and sEtcGiTp != ""'>
                        AND TA.ETC_GI_TP = #{sEtcGiTp}
                    </if>

                    <if test='sReqStrgeCd != null and sReqStrgeCd != ""'>
                        AND TA.REQ_STRGE_CD = #{sReqStrgeCd}
                    </if>

                    <if test='sGiStrgeCd != null and sGiStrgeCd != ""'>
                        AND TA.GI_STRGE_CD = #{sGiStrgeCd}
                    </if>

                    <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                        AND TA.GR_STRGE_CD = #{sGrStrgeCd}
                    </if>

                    <if test='sReadyDocNo != null and sReadyDocNo != ""'>
                        AND TA.READY_DOC_NO LIKE '%'||#{sReadyDocNo}||'%'
                    </if>

                    <if test='sReadyStatCd != null and sReadyStatCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE01")'>
                                 AND TA.READY_STAT_CD IN ('01','02','04')
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE02")'>
                                 AND TA.READY_STAT_CD IN ('02','03','05')
                            </when>
                            <otherwise>
                                 AND TA.READY_STAT_CD = #{sReadyStatCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReqStartDt != null'>
                        <choose>
                            <otherwise>
                                 AND TA.REG_DT <![CDATA[>=]]> #{sReqStartDt}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReqEndDt != null'>
                        <choose>
                            <otherwise>
                                 AND TA.REG_DT <![CDATA[<=]]> #{sReqEndDt} + 1
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sVinNo != null and sVinNo != ""'>
                        AND TA.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>

                    <if test='sCarNo != null and sCarNo != ""'>
                        AND TA.CAR_NO LIKE '%'||#{sCarNo}||'%'
                    </if>

                    <if test='sCustNm != null and sCustNm != ""'>
                        AND TA.CUST_NM LIKE '%'||#{sCustNm}||'%'
                    </if>

                    <if test='sBorrowStatCd != null and sBorrowStatCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_01")'>
                                AND (TA.BORROW_STAT_CD = '01' OR TA.BORROW_DOC_NO IS NULL )
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_02")'>
                                AND (TA.BORROW_STAT_CD IN ('05','04') OR TA.BORROW_DOC_NO IS NULL OR TA.READY_STAT_CD = '06' )
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_03")'>
                                AND TA.BORROW_STAT_CD in ('02')<!-- 차용 -->
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_04")'>
                                AND TA.BORROW_DOC_NO IS NOT NULL
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_05")'>
                                AND TA.BORROW_STAT_CD in ('04','05')<!-- 정비차용확정, 차용대기 -->
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_06")'>
                                AND TA.BORROW_STAT_CD != '03'<!-- 반환 제외 -->
                            </when>
                            <otherwise>
                                AND TA.BORROW_STAT_CD = #{sBorrowStatCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sBorrowDocNoUseYn != null and sBorrowDocNoUseYn == "Y"'>
                        AND TA.BORROW_DOC_NO IS NOT NULL
                    </if>

                    <if test='sGiDocStatCd != null and sGiDocStatCd != ""'>
                        AND TA.GI_DOC_STAT_CD = #{sGiDocStatCd}
                    </if>

                    <if test='sGiDocNo != null and sGiDocNo != ""'>
                        AND TA.GI_DOC_NO LIKE '%'||#{sGiDocNo}||'%'
                    </if>

                    <if test='sGiDocReqStartDt != null'>
                        <choose>
                            <otherwise>
                                 AND TA.RECEIVE_DT <![CDATA[>=]]> #{sGiDocReqStartDt}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sGiDocReqEndDt != null'>
                        <choose>
                            <otherwise>
                                 AND TA.RECEIVE_DT <![CDATA[<=]]> #{sGiDocReqEndDt} + 1
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReceiveId != null and sReceiveId != ""'>
                        AND TA.RECEIVE_ID LIKE '%'||#{sReceiveId}||'%'
                    </if>

                    <if test='sReceiveNm != null and sReceiveNm != ""'>
                        AND TA.USR_NM LIKE '%'||#{sReceiveNm}||'%'
                    </if>

                    <if test='sRoStatCd != null and sRoStatCd != ""'>
                        AND TA.RO_STAT_CD = #{sRoStatCd}
                    </if>

                    <if test='sPartsOutUseYn != null and sPartsOutUseYn != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sPartsOutUseYn,"Y")'>
                                 AND TA.GI_DOC_STAT_CD IN ('02','03')
                            </when>
                            <otherwise>
                            </otherwise>
                        </choose>
                    </if>
                </where>
            ) T1
        )

    </select>

    <!-- 정비수령집계 부품요청상세 정보 목록을 조회한다. -->
    <select id="selectIssueReqDetailStatusByCondition" parameterType="IssueReqSearchVO" resultType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqDetailStatusByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.*,( select max(calc_dt) from se_0500t t where t.RO_DOC_NO = t1.RO_DOC_NO)  CALC_DT FROM (
                SELECT
                    TA.*
                     
                FROM(
                   SELECT
                        A.DLR_CD
                        ,A.PAR_REQ_DOC_NO
                        ,A.PAR_REQ_DOC_LINE_NO
                        ,A.PAR_REQ_DOC_STOCK_LINE_NO
                        ,A.PAR_REQ_STAT_CD
                        ,G.PURC_REQ_NO
                        ,A.CANC_YN
                        ,A.PAR_GI_TP
                        ,A.RO_DOC_NO
                        ,A.RO_LINE_NO
                        ,A.RESV_DOC_NO
                        ,A.RESV_DOC_LINE_NO
                        ,B.GI_STRGE_CD AS GR_STRGE_CD
                        ,NVL(A.GI_STRGE_CD,B.GI_STRGE_CD) AS GI_STRGE_CD
                        ,(
                            SELECT
                                T1.LOC_CD_MIG
                            FROM PT_0224T T1
                            WHERE T1.DLR_CD = A.DLR_CD
                            AND T1.STRGE_CD = A.REQ_STRGE_CD
                            AND T1.ITEM_CD = A.ITEM_CD
                        ) AS GI_LOC_CD
                        ,NVL(A.GI_LOC_CD,K.LOC_CD) AS GI_LOC_CD
                        ,A.ITEM_CD AS DB_ITEM_CD
                        ,A.ITEM_CD
                        ,B.BRAND_CD
                        ,B.STOCK_UNIT_CD AS UNIT_CD
                        ,CASE WHEN A.ITEM_PRC <![CDATA[<]]> 0 THEN ROUND(A.ITEM_PRC) * -1
                        ELSE A.ITEM_PRC
                        END AS ITEM_PRC
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN ROUND(A.ITEM_PRC * A.END_QTY, 2)
                              WHEN A.PAR_REQ_STAT_CD = '01' AND A.END_QTY = 0 THEN ROUND(A.ITEM_PRC * A.REQ_QTY, 2)
                        ELSE A.ITEM_AMT
                        END AS ITEM_AMT
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.END_QTY )
                              WHEN A.PAR_REQ_STAT_CD = '01' AND A.END_QTY = 0 THEN (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.REQ_QTY )
                        ELSE ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.END_QTY
                        END AS TAX_DDCT_AMT
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (ROUND(A.ITEM_PRC * A.END_QTY, 2) - (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.END_QTY ))
                              WHEN A.PAR_REQ_STAT_CD = '01' AND A.END_QTY = 0 THEN (ROUND(A.ITEM_PRC * A.REQ_QTY, 2) - (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.REQ_QTY ))
                        ELSE A.TAX_AMT
                        END TAX_AMT
                        ,A.REQ_QTY
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '01' THEN A.REQ_QTY
                              WHEN A.PAR_REQ_STAT_CD = '03' THEN A.END_QTY
                        ELSE A.END_QTY
                        END AS RESV_QTY
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '01' THEN A.REQ_QTY
                              WHEN A.PAR_REQ_STAT_CD = '03' THEN A.END_QTY
                        ELSE A.END_QTY
                        END AS END_QTY
                        ,A.REQ_STRGE_CD
                        ,A.REG_DT
                        ,A.REG_USR_ID
                        ,K3.USR_NM AS REG_USR_NM
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN K3.USR_NM
                        ELSE (SELECT BK.USR_NM FROM CM_0801T BK WHERE BK.USR_ID = A.UPDT_USR_ID)
                        END UPDT_USR_NM
                        ,K4.DEPT_CD
                        ,K4.DEPT_NM
                        ,CASE WHEN A.PAR_GI_TP = 'OT' AND A.READY_STAT_CD <![CDATA[!=]]> '05' THEN null
                        ELSE A.UPDT_DT
                        END AS UPDT_DT
                        ,A.UPDT_USR_ID
                        ,B.ITEM_NM
                        ,NVL(C.AVLB_STOCK_QTY,0) + NVL(C.RESV_STOCK_QTY,0) - NVL(C.BORROW_QTY,0) + NVL(C.RENT_QTY,0) AS TOT_STOCK_QTY
                        ,NVL(C.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY
                        ,NVL(C.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY
                        ,NVL(C.CLAM_STOCK_QTY,0) AS CLAM_STOCK_QTY
                        ,NVL(C.BORROW_QTY,0) AS BORROW_STOCK_QTY
                        ,NVL(C.RENT_QTY,0) AS RENT_QTY
                        ,NVL(C.GR_SCHE_QTY,0) AS GR_SCHE_QTY
                        ,NVL(C.GI_SCHE_QTY,0) AS GI_SCHE_QTY
                        ,A.REG_DT AS PURC_REQ_DT
                        ,NVL(F.GI_DOC_NO,'-') AS GI_DOC_NO
                        ,NVL(E.GI_DOC_TP,'01') AS GI_DOC_TP
                        ,NVL(F.GI_DOC_STAT_CD,'01') AS GI_DOC_STAT_CD
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_YY_MM) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                        ELSE F.MVT_DOC_YY_MM
                        END AS MVT_DOC_YY_MM
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_NO) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                        ELSE F.MVT_DOC_NO
                        END AS MVT_DOC_NO
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_LINE_NO) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                        ELSE F.MVT_DOC_LINE_NO
                        END AS MVT_DOC_LINE_NO
                        ,H.CUST_CD
                        ,H.CUST_NM
                        ,H.SER_PRSN_ID
                        ,H.VIN_NO
                        ,H.CAR_NO
                        ,'Y' AS DB_YN
                        ,F.GI_STAT_CD
                        ,F.RECEIVE_ID
                        ,K2.USR_NM AS RECEIVE_NM
                        ,F.GI_DT
                        ,F.RECEIVE_DT
                        ,F.RECEIVE_DT AS RECEIVE_TIME
                        ,F.RETURN_ID
                        ,F.RETURN_DT
                        ,F.CANC_ID
                        ,F.CANC_DT
                        ,F.GI_CAU_NM
                        ,A.ETC_GI_TP
                        ,A.PKG_DOC_NO
                        ,A.PKG_ITEM_CD
                        ,L.PKG_DETL_DC_RATE
                        ,NVL((L.ITEM_PRC * L.ITEM_QTY) - (L.ITEM_QTY * (L.ITEM_PRC * (L.PKG_DETL_DC_RATE / 100))),0) AS PKG_DETL_DC_TOT_AMT
                        ,NVL(L.ITEM_QTY * (L.ITEM_PRC * (L.PKG_DETL_DC_RATE/100)),0) AS PKG_DETL_DC_AMT
                        ,NVL(F.RETURN_PARTS_QTY, 0) AS RETURN_PARTS_QTY
                        ,NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) AS MOVING_AVG_PRC
                        ,CASE WHEN A.PAR_REQ_STAT_CD IN ('01','03') THEN ROUND(A.MOVING_AVG_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')),2)
                              ELSE NVL(K6.MOVING_AVG_TAX_DDCT_PRC,0)
                         END MOVING_AVG_TAX_DDCT_PRC
                        --,A.REQ_QTY * NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) AS MOVING_AVG_AMT
                        ,NVL(CASE WHEN A.PAR_REQ_STAT_CD = '01' THEN A.REQ_QTY
                                  WHEN A.PAR_REQ_STAT_CD = '03' THEN A.END_QTY
                                  ELSE A.END_QTY
                              END, 0) * NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) AS MOVING_AVG_AMT
                        ,CASE WHEN A.PAR_REQ_STAT_CD IN ('01','03') THEN ROUND(A.END_QTY * ROUND(A.MOVING_AVG_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')),2),2)
                              ELSE ROUND(A.END_QTY * NVL(K6.MOVING_AVG_TAX_DDCT_PRC,0),2)
                         END MOVING_AVG_TAX_DDCT_AMT
                        ,NVL(A.READY_STAT_CD ,'01') AS READY_STAT_CD
                        ,A.READY_DOC_NO
                        ,A.READY_REMARK
                        ,A.READY_USR_ID
                        ,A.READY_REG_DT
                        ,A.READY_CANC_REMARK
                        ,A.READY_CANC_USR_ID
                        ,A.READY_CANC_REG_DT
                        ,CASE WHEN NVL(A.BORROW_STAT_CD, '01') != '01' THEN A.BORROW_DOC_NO
                        ELSE ''
                        END AS BORROW_DOC_NO
                        ,A.BORROW_LINE_NO
                        ,A.BORROW_TP
                        ,A.BORROW_STAT_CD
                        ,A.BORROW_QTY
                        ,A.BORROW_USR_ID
                        ,(SELECT BK.USR_NM FROM CM_0801T BK WHERE BK.USR_ID = A.BORROW_USR_ID) AS BORROW_USR_NM
                        ,(SELECT AB.DEPT_NM FROM CM_0801T AA
                            LEFT JOIN CM_3401T AB ON AA.DEPT_CD = AB.DEPT_CD
                            WHERE AA.USR_ID = A.BORROW_USR_ID
                        ) AS BORROW_DEPT_NM
                        ,A.BORROW_REG_DT
                        ,A.ETC_RV_DOC_NO
                        ,A.ETC_RV_LINE_NO
                        ,A.ETC_RV_STAT_CD
                        ,A.ETC_RV_QTY
                        ,A.ETC_RV_PRSN_ID
                        ,A.ETC_RV_REG_DT
                        ,A.COM_ITEM_CD
                        ,A.COM_ITEM_NM
                        ,A.COM_ITEM_PRC
                        ,NVL(A.RO_TP, '01') AS RO_TP
                        ,NVL(R.RO_STAT_CD,'01') AS RO_STAT_CD
                        ,DECODE(A.RO_TP,'02','04' <!--RO유형 보증(02) : 가격보증(04) -->
                                       ,'03','03' <!--RO유형 보험(03) : 가격보험(03) -->
                                       ,'01') AS PRC_TP<!--그외 일반가(01) -->
                        ,I.RETL_PRC
                        ,I.WHSL_PRC
                        ,I.INC_PRC
                        ,I.GRTE_PRC
                        ,A.REMARK
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(ITEM_SALE_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(ITEM_SALE_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(ITEM_SALE_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS ITEM_SALE_PRC
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(ITEM_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(ITEM_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(ITEM_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS ITEM_SALE_AMT
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(DC_RATE, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(DC_RATE, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(DC_RATE, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS DC_RATE
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(DC_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(DC_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(DC_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS DC_AMT
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(ITEM_TOT_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(ITEM_TOT_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(ITEM_TOT_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS ITEM_TOT_AMT
                        ,A.PAYM_CD
                        ,A.PAYM_TP
                        ,A.PAYM_USR_NM
                        ,A.PARTS_PRC_TP
                        ,K2.USR_NM
                        ,K5.USR_NM AS RO_REG_USR_NM
                        ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_CD FROM SA_0121T WHERE VIN_NO = H.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                        ,(FN_GET_VAT(TO_CHAR(A.REG_DT,'YYYYMMDD'),'ALL') * 100) AS TAX_RATE
                      --  ,TO_CHAR(X.CALC_DT,'YYYY-MM-DD HH24:MI:SS') AS CALC_DT_FORMAT
                    FROM PT_0502T A
                    LEFT JOIN PT_0201T B ON A.DLR_CD = B.DLR_CD AND A.ITEM_CD = B.ITEM_CD
                    LEFT JOIN SE_0300T R ON A.DLR_CD = R.DLR_CD AND A.RO_DOC_NO = R.RO_DOC_NO
                    LEFT JOIN PT_0301T C ON A.DLR_CD = C.DLR_CD AND A.ITEM_CD = C.ITEM_CD AND A.REQ_STRGE_CD = C.STRGE_CD
                    LEFT JOIN PT_0302T D ON A.DLR_CD = D.DLR_CD AND A.ITEM_CD = D.ITEM_CD AND A.REQ_STRGE_CD = D.STRGE_CD AND A.RESV_DOC_NO = D.RESV_DOC_NO AND A.RESV_DOC_LINE_NO = D.RESV_DOC_LINE_NO
                    LEFT JOIN PT_0511T E ON A.DLR_CD = E.DLR_CD AND A.RO_DOC_NO = E.RO_DOC_NO
                    LEFT JOIN PT_0512T F ON A.DLR_CD = F.DLR_CD AND A.PAR_REQ_DOC_NO = F.PAR_REQ_DOC_NO AND A.PAR_REQ_DOC_LINE_NO = F.PAR_REQ_DOC_LINE_NO
                    AND A.PAR_REQ_DOC_LINE_NO = F.GI_DOC_LINE_NO
                    AND A.PAR_REQ_STAT_CD = F.GI_DOC_STAT_CD
                    LEFT JOIN PT_0411T G ON A.DLR_CD = G.DLR_CD AND A.RO_DOC_NO = G.REF_DOC_NO AND A.RO_LINE_NO = G.REF_DOC_LINE_NO AND A.ITEM_CD = G.ITEM_CD
                    LEFT JOIN PT_0501T H ON A.DLR_CD = H.DLR_CD AND A.PAR_REQ_DOC_NO = H.PAR_REQ_DOC_NO
                    LEFT JOIN PT_0214T I ON A.DLR_CD = I.DLR_CD AND A.REQ_STRGE_CD = I.STRGE_CD AND A.ITEM_CD = I.ITEM_CD
                    LEFT JOIN PT_0208T J ON A.DLR_CD = J.DLR_CD AND A.REQ_STRGE_CD = J.STRGE_CD AND A.ITEM_CD = J.ITEM_CD
                    LEFT JOIN PT_0224T K ON A.DLR_CD = K.DLR_CD  AND A.REQ_STRGE_CD = K.STRGE_CD AND A.ITEM_CD = K.ITEM_CD AND K.LOC_CD != ''
                    LEFT JOIN PT_0231T L ON A.DLR_CD = L.DLR_CD AND A.PKG_ITEM_CD = L.PKG_ITEM_CD AND A.ITEM_CD = L.ITEM_CD AND A.PKG_DOC_NO = L.PKG_DOC_NO
                    LEFT JOIN CM_0801T K2 ON F.RECEIVE_ID = K2.USR_ID
                    LEFT JOIN CM_0801T K3 ON A.REG_USR_ID = K3.USR_ID
                    LEFT JOIN CM_3401T K4 ON K3.DEPT_CD = K4.DEPT_CD
                    LEFT JOIN CM_0801T K5 ON R.REG_USR_ID = K5.USR_ID
                    LEFT JOIN PT_0312T K6 ON K6.DLR_CD = F.DLR_CD AND K6.MVT_DOC_NO = F.MVT_DOC_NO AND K6.ITEM_CD = F.ITEM_CD
                    --LEFT JOIN SE_0500T X ON A.DLR_CD = X.DLR_CD AND A.RO_DOC_NO = X.RO_DOC_NO
                    <where>
                        <if test='sDlrCd != null and sDlrCd != ""'>
                            AND A.DLR_CD = #{sDlrCd}
                        </if>

                        <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                            AND A.PAR_REQ_DOC_NO = #{sParReqDocNo}
                        </if>

                        <if test='sParReqDocLineNo != null and sParReqDocLineNo != 0'>
                            AND A.PAR_REQ_DOC_LINE_NO = #{sParReqDocLineNo}
                        </if>

                        <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                            AND A.PAR_REQ_STAT_CD = #{sParReqStatCd}
                        </if>

                        <if test='sRoDocNo != null and sRoDocNo != ""'>
                            AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                        </if>

                        <if test='sRoLineNo != null and sRoLineNo != 0'>
                            AND A.RO_LINE_NO = #{sRoLineNo}
                        </if>

                        <if test='sResvDocNo != null and sResvDocNo != ""'>
                            AND A.RESV_DOC_NO = #{sResvDocNo}
                        </if>

                        <if test='sResvDocLineNo != null and sResvDocLineNo != 0'>
                            AND A.RESV_DOC_LINE_NO = #{sResvDocLineNo}
                        </if>

                        <if test='sParGiTp != null and sParGiTp != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG01")'>
                                    AND (A.PAR_GI_TP in ('RO','IN') OR A.BORROW_DOC_NO IS NOT NULL)
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG02")'>
                                    AND A.BORROW_DOC_NO IS NOT NULL
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG03")'>
                                    AND A.PAR_GI_TP in ('RO') AND A.BORROW_DOC_NO IS NULL
                                </when>
                                <otherwise>
                                    AND A.PAR_GI_TP = #{sParGiTp}
                                </otherwise>
                            </choose>
                        </if>

                        AND A.BORROW_STAT_CD != '03'<!-- 정비차용상태 반환 아닌 것 -->

                        <if test='sItemCd != null and sItemCd != ""'>
                            AND A.ITEM_CD LIKE '%'||#{sItemCd}||'%'
                        </if>

                        <if test='sItemCdOnly != null and sItemCdOnly != ""'>
                            AND A.ITEM_CD = #{sItemCdOnly}
                        </if>

                        <if test='sCancYn != null and sCancYn != ""'>
                            AND A.CANC_YN = #{sCancYn}
                        </if>

                        <if test='sEtcGiTp != null and sEtcGiTp != ""'>
                            AND A.ETC_GI_TP = #{sEtcGiTp}
                        </if>

                        <if test='sReqStrgeCd != null and sReqStrgeCd != ""'>
                            AND A.REQ_STRGE_CD = #{sReqStrgeCd}
                        </if>

                        <if test='sGiStrgeCd != null and sGiStrgeCd != ""'>
                            AND A.GI_STRGE_CD = #{sGiStrgeCd}
                        </if>

                        <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                            AND A.GR_STRGE_CD = #{sGrStrgeCd}
                        </if>

                        <if test='sReadyDocNo != null and sReadyDocNo != ""'>
                            AND A.READY_DOC_NO LIKE '%'||#{sReadyDocNo}||'%'
                        </if>

                        <if test='sReadyStatCd != null and sReadyStatCd != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE01")'>
                                     AND A.READY_STAT_CD IN ('01','02','04')
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE02")'>
                                     AND A.READY_STAT_CD IN ('02','03','05')
                                </when>
                                <otherwise>
                                     AND A.READY_STAT_CD = #{sReadyStatCd}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sReqStartDt != null'>
                            <choose>
                                <otherwise>
                                     AND A.REG_DT <![CDATA[>=]]> #{sReqStartDt}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sReqEndDt != null'>
                            <choose>
                                <otherwise>
                                     AND A.REG_DT <![CDATA[<=]]> #{sReqEndDt} + 1
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sVinNo != null and sVinNo != ""'>
                            AND H.VIN_NO LIKE '%'||#{sVinNo}||'%'
                        </if>

                        <if test='sCarNo != null and sCarNo != ""'>
                            AND H.CAR_NO LIKE '%'||#{sCarNo}||'%'
                        </if>

                        <if test='sCustNm != null and sCustNm != ""'>
                            AND H.CUST_NM LIKE '%'||#{sCustNm}||'%'
                        </if>

                        <if test='sBorrowStatCd != null and sBorrowStatCd != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_01")'>
                                    AND (A.BORROW_STAT_CD = '01' OR A.BORROW_DOC_NO IS NULL )
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_02")'>
                                    AND (A.BORROW_STAT_CD IN ('05','04') OR A.BORROW_DOC_NO IS NULL OR A.READY_STAT_CD = '06' )
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_03")'>
                                    AND A.BORROW_STAT_CD in ('02')<!-- 차용 -->
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_04")'>
                                    AND A.BORROW_DOC_NO IS NOT NULL
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_05")'>
                                    AND A.BORROW_STAT_CD in ('04','05')<!-- 정비차용확정, 차용대기 -->
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_06")'>
                                    AND A.BORROW_STAT_CD != '03'<!-- 반환 제외 -->
                                </when>
                                <otherwise>
                                    AND A.BORROW_STAT_CD = #{sBorrowStatCd}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sBorrowDocNoUseYn != null and sBorrowDocNoUseYn == "Y"'>
                            AND A.BORROW_DOC_NO IS NOT NULL
                        </if>

                        <if test='sGiDocStatCd != null and sGiDocStatCd != ""'>
                            AND F.GI_DOC_STAT_CD = #{sGiDocStatCd}
                        </if>

                        <if test='sGiDocNo != null and sGiDocNo != ""'>
                            AND F.GI_DOC_NO LIKE '%'||#{sGiDocNo}||'%'
                        </if>

                        <if test='sGiDocReqStartDt != null'>
                            <choose>
                                <otherwise>
                                     AND F.RECEIVE_DT <![CDATA[>=]]> #{sGiDocReqStartDt}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sGiDocReqEndDt != null'>
                            <choose>
                                <otherwise>
                                     AND F.RECEIVE_DT <![CDATA[<=]]> #{sGiDocReqEndDt} + 1
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sReceiveId != null and sReceiveId != ""'>
                            AND F.RECEIVE_ID LIKE '%'||#{sReceiveId}||'%'
                        </if>

                        <if test='sReceiveNm != null and sReceiveNm != ""'>
                            AND K2.USR_NM LIKE '%'||#{sReceiveNm}||'%'
                        </if>

                        <if test='sRoStatCd != null and sRoStatCd != ""'>
                            AND NVL(R.RO_STAT_CD,'01') = #{sRoStatCd}
                        </if>

                        <if test='sPartsOutUseYn != null and sPartsOutUseYn != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sPartsOutUseYn,"Y")'>
                                    AND F.GI_DOC_STAT_CD IN ('02','03')
                                </when>
                                <otherwise>
                                </otherwise>
                            </choose>
                        </if>
                        AND NVL(R.RO_STAT_CD, '01') IN ('01','02')
                    </where>
                    UNION ALL
                    SELECT
                        A.DLR_CD
                        ,A.PAR_REQ_DOC_NO
                        ,A.PAR_REQ_DOC_LINE_NO
                        ,A.PAR_REQ_DOC_STOCK_LINE_NO
                        ,A.PAR_REQ_STAT_CD
                        ,G.PURC_REQ_NO
                        ,A.CANC_YN
                        ,A.PAR_GI_TP
                        ,A.RO_DOC_NO
                        ,A.RO_LINE_NO
                        ,A.RESV_DOC_NO
                        ,A.RESV_DOC_LINE_NO
                        ,B.GI_STRGE_CD AS GR_STRGE_CD
                        ,NVL(A.GI_STRGE_CD,B.GI_STRGE_CD) AS GI_STRGE_CD
                        ,(
                            SELECT
                                T1.LOC_CD_MIG
                            FROM PT_0224T T1
                            WHERE T1.DLR_CD = A.DLR_CD
                            AND T1.STRGE_CD = A.REQ_STRGE_CD
                            AND T1.ITEM_CD = A.ITEM_CD
                        ) AS GI_LOC_CD
                        ,NVL(A.GI_LOC_CD,K.LOC_CD) AS GI_LOC_CD
                        ,A.ITEM_CD AS DB_ITEM_CD
                        ,A.ITEM_CD
                        ,B.BRAND_CD
                        ,B.STOCK_UNIT_CD AS UNIT_CD
                        ,CASE WHEN A.ITEM_PRC <![CDATA[<]]> 0 THEN ROUND(A.ITEM_PRC) * -1
                        ELSE A.ITEM_PRC
                        END AS ITEM_PRC
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN ROUND(A.ITEM_PRC * A.END_QTY, 2)
                              WHEN A.PAR_REQ_STAT_CD = '01' AND A.END_QTY = 0 THEN ROUND(A.ITEM_PRC * A.REQ_QTY, 2)
                        ELSE A.ITEM_AMT
                        END AS ITEM_AMT
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.END_QTY )
                              WHEN A.PAR_REQ_STAT_CD = '01' AND A.END_QTY = 0 THEN (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.REQ_QTY )
                        ELSE ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.END_QTY
                        END AS TAX_DDCT_AMT
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (ROUND(A.ITEM_PRC * A.END_QTY, 2) - (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.END_QTY ))
                              WHEN A.PAR_REQ_STAT_CD = '01' AND A.END_QTY = 0 THEN (ROUND(A.ITEM_PRC * A.REQ_QTY, 2) - (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')), 2) * A.REQ_QTY ))
                        ELSE A.TAX_AMT
                        END TAX_AMT
                        ,A.REQ_QTY
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '01' THEN A.REQ_QTY
                              WHEN A.PAR_REQ_STAT_CD = '03' THEN A.END_QTY
                        ELSE A.END_QTY
                        END AS RESV_QTY
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '01' THEN A.REQ_QTY
                              WHEN A.PAR_REQ_STAT_CD = '03' THEN A.END_QTY
                        ELSE A.END_QTY
                        END AS END_QTY
                        ,A.REQ_STRGE_CD
                        ,A.REG_DT
                        ,A.REG_USR_ID
                        ,K3.USR_NM AS REG_USR_NM
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN K3.USR_NM
                        ELSE (SELECT BK.USR_NM FROM CM_0801T BK WHERE BK.USR_ID = A.UPDT_USR_ID)
                        END UPDT_USR_NM
                        ,K4.DEPT_CD
                        ,K4.DEPT_NM
                        ,CASE WHEN A.PAR_GI_TP = 'OT' AND A.READY_STAT_CD <![CDATA[!=]]> '05' THEN null
                        ELSE A.UPDT_DT
                        END AS UPDT_DT
                        ,A.UPDT_USR_ID
                        ,B.ITEM_NM
                        ,NVL(C.AVLB_STOCK_QTY,0) + NVL(C.RESV_STOCK_QTY,0) - NVL(C.BORROW_QTY,0) + NVL(C.RENT_QTY,0) AS TOT_STOCK_QTY
                        ,NVL(C.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY
                        ,NVL(C.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY
                        ,NVL(C.CLAM_STOCK_QTY,0) AS CLAM_STOCK_QTY
                        ,NVL(C.BORROW_QTY,0) AS BORROW_STOCK_QTY
                        ,NVL(C.RENT_QTY,0) AS RENT_QTY
                        ,NVL(C.GR_SCHE_QTY,0) AS GR_SCHE_QTY
                        ,NVL(C.GI_SCHE_QTY,0) AS GI_SCHE_QTY
                        ,A.REG_DT AS PURC_REQ_DT
                        ,NVL(F.GI_DOC_NO,'-') AS GI_DOC_NO
                        ,NVL(E.GI_DOC_TP,'01') AS GI_DOC_TP
                        ,NVL(F.GI_DOC_STAT_CD,'01') AS GI_DOC_STAT_CD
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_YY_MM) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                        ELSE F.MVT_DOC_YY_MM
                        END AS MVT_DOC_YY_MM
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_NO) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                        ELSE F.MVT_DOC_NO
                        END AS MVT_DOC_NO
                        ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_LINE_NO) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                        ELSE F.MVT_DOC_LINE_NO
                        END AS MVT_DOC_LINE_NO
                        ,H.CUST_CD
                        ,H.CUST_NM
                        ,H.SER_PRSN_ID
                        ,H.VIN_NO
                        ,H.CAR_NO
                        ,'Y' AS DB_YN
                        ,F.GI_STAT_CD
                        ,F.RECEIVE_ID
                        ,K2.USR_NM AS RECEIVE_NM
                        ,F.GI_DT
                        ,F.RECEIVE_DT
                        ,F.RECEIVE_DT AS RECEIVE_TIME
                        ,F.RETURN_ID
                        ,F.RETURN_DT
                        ,F.CANC_ID
                        ,F.CANC_DT
                        ,F.GI_CAU_NM
                        ,A.ETC_GI_TP
                        ,A.PKG_DOC_NO
                        ,A.PKG_ITEM_CD
                        ,L.PKG_DETL_DC_RATE
                        ,NVL((L.ITEM_PRC * L.ITEM_QTY) - (L.ITEM_QTY * (L.ITEM_PRC * (L.PKG_DETL_DC_RATE / 100))),0) AS PKG_DETL_DC_TOT_AMT
                        ,NVL(L.ITEM_QTY * (L.ITEM_PRC * (L.PKG_DETL_DC_RATE/100)),0) AS PKG_DETL_DC_AMT
                        ,NVL(F.RETURN_PARTS_QTY, 0) AS RETURN_PARTS_QTY
                        ,NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) AS MOVING_AVG_PRC
                        ,CASE WHEN A.PAR_REQ_STAT_CD IN ('01','03') THEN ROUND(A.MOVING_AVG_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')),2)
                              ELSE NVL(K6.MOVING_AVG_TAX_DDCT_PRC,0)
                         END MOVING_AVG_TAX_DDCT_PRC
                        --,A.REQ_QTY * NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) AS MOVING_AVG_AMT
                        ,NVL(CASE WHEN A.PAR_REQ_STAT_CD = '01' THEN A.REQ_QTY
                                  WHEN A.PAR_REQ_STAT_CD = '03' THEN A.END_QTY
                                  ELSE A.END_QTY
                              END, 0) * NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) AS MOVING_AVG_AMT
                        ,CASE WHEN A.PAR_REQ_STAT_CD IN ('01','03') THEN ROUND(A.END_QTY * ROUND(A.MOVING_AVG_PRC / ( 1 + FN_GET_VAT(to_char(A.reg_dt,'yyyymmdd'),'ALL')),2),2)
                              ELSE ROUND(A.END_QTY * NVL(K6.MOVING_AVG_TAX_DDCT_PRC,0),2)
                         END MOVING_AVG_TAX_DDCT_AMT
                        ,NVL(A.READY_STAT_CD ,'01') AS READY_STAT_CD
                        ,A.READY_DOC_NO
                        ,A.READY_REMARK
                        ,A.READY_USR_ID
                        ,A.READY_REG_DT
                        ,A.READY_CANC_REMARK
                        ,A.READY_CANC_USR_ID
                        ,A.READY_CANC_REG_DT
                        ,CASE WHEN NVL(A.BORROW_STAT_CD, '01') != '01' THEN A.BORROW_DOC_NO
                        ELSE ''
                        END AS BORROW_DOC_NO
                        ,A.BORROW_LINE_NO
                        ,A.BORROW_TP
                        ,A.BORROW_STAT_CD
                        ,A.BORROW_QTY
                        ,A.BORROW_USR_ID
                        ,(SELECT BK.USR_NM FROM CM_0801T BK WHERE BK.USR_ID = A.BORROW_USR_ID) AS BORROW_USR_NM
                        ,(SELECT AB.DEPT_NM FROM CM_0801T AA
                            LEFT JOIN CM_3401T AB ON AA.DEPT_CD = AB.DEPT_CD
                            WHERE AA.USR_ID = A.BORROW_USR_ID
                        ) AS BORROW_DEPT_NM
                        ,A.BORROW_REG_DT
                        ,A.ETC_RV_DOC_NO
                        ,A.ETC_RV_LINE_NO
                        ,A.ETC_RV_STAT_CD
                        ,A.ETC_RV_QTY
                        ,A.ETC_RV_PRSN_ID
                        ,A.ETC_RV_REG_DT
                        ,A.COM_ITEM_CD
                        ,A.COM_ITEM_NM
                        ,A.COM_ITEM_PRC
                        ,NVL(A.RO_TP, '01') AS RO_TP
                        ,NVL(R.RO_STAT_CD,'01') AS RO_STAT_CD
                        ,DECODE(A.RO_TP,'02','04' <!--RO유형 보증(02) : 가격보증(04) -->
                                       ,'03','03' <!--RO유형 보험(03) : 가격보험(03) -->
                                       ,'01') AS PRC_TP<!--그외 일반가(01) -->
                        ,I.RETL_PRC
                        ,I.WHSL_PRC
                        ,I.INC_PRC
                        ,I.GRTE_PRC
                        ,A.REMARK
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(ITEM_SALE_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(ITEM_SALE_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(ITEM_SALE_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS ITEM_SALE_PRC
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(ITEM_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(ITEM_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(ITEM_PRC, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS ITEM_SALE_AMT
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(DC_RATE, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(DC_RATE, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(DC_RATE, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS DC_RATE
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(DC_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(DC_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(DC_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS DC_AMT
                        ,CASE WHEN A.PAR_GI_TP = 'SR' THEN (SELECT NVL(ITEM_TOT_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RE' AND LINE_NO = A.RO_LINE_NO)<!-- 예약접수 -->
                              WHEN A.PAR_GI_TP = 'RO' THEN (SELECT NVL(ITEM_TOT_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RO_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'RO' AND LINE_NO = A.RO_LINE_NO)<!-- RO -->
                              WHEN A.PAR_GI_TP = 'SP' THEN (SELECT NVL(ITEM_TOT_AMT, 0) ITEM_PRC FROM SE_0160T WHERE DLR_CD = #{sDlrCd} AND DOC_NO = A.RESV_DOC_NO AND ITEM_CD = A.ITEM_CD AND PREFIX_ID = 'PE' AND LINE_NO = A.RO_LINE_NO)<!-- 부품예약 -->
                        ELSE 0
                        END AS ITEM_TOT_AMT
                        ,A.PAYM_CD
                        ,A.PAYM_TP
                        ,A.PAYM_USR_NM
                        ,A.PARTS_PRC_TP
                        ,K2.USR_NM
                        ,K5.USR_NM AS RO_REG_USR_NM
                        ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_CD FROM SA_0121T WHERE VIN_NO = H.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                        ,(FN_GET_VAT(TO_CHAR(A.REG_DT,'YYYYMMDD'),'ALL') * 100) AS TAX_RATE
                    --   ,TO_CHAR(X.CALC_DT,'YYYY-MM-DD HH24:MI:SS') AS CALC_DT_FORMAT
                    FROM PT_0502T A
                    LEFT JOIN PT_0201T B ON A.DLR_CD = B.DLR_CD AND A.ITEM_CD = B.ITEM_CD
                    LEFT JOIN SE_0300T R ON A.DLR_CD = R.DLR_CD AND A.RO_DOC_NO = R.RO_DOC_NO
                    LEFT JOIN PT_0301T C ON A.DLR_CD = C.DLR_CD AND A.ITEM_CD = C.ITEM_CD AND A.REQ_STRGE_CD = C.STRGE_CD
                    LEFT JOIN PT_0302T D ON A.DLR_CD = D.DLR_CD AND A.ITEM_CD = D.ITEM_CD AND A.REQ_STRGE_CD = D.STRGE_CD AND A.RESV_DOC_NO = D.RESV_DOC_NO AND A.RESV_DOC_LINE_NO = D.RESV_DOC_LINE_NO
                    LEFT JOIN PT_0511T E ON A.DLR_CD = E.DLR_CD AND A.RO_DOC_NO = E.RO_DOC_NO
                    LEFT JOIN PT_0512T F ON A.DLR_CD = F.DLR_CD AND A.PAR_REQ_DOC_NO = F.PAR_REQ_DOC_NO AND A.PAR_REQ_DOC_LINE_NO = F.PAR_REQ_DOC_LINE_NO
                    AND A.PAR_REQ_DOC_LINE_NO = F.GI_DOC_LINE_NO
                    AND A.PAR_REQ_STAT_CD = F.GI_DOC_STAT_CD
                    LEFT JOIN PT_0411T G ON A.DLR_CD = G.DLR_CD AND A.RO_DOC_NO = G.REF_DOC_NO AND A.RO_LINE_NO = G.REF_DOC_LINE_NO AND A.ITEM_CD = G.ITEM_CD
                    LEFT JOIN PT_0501T H ON A.DLR_CD = H.DLR_CD AND A.PAR_REQ_DOC_NO = H.PAR_REQ_DOC_NO
                    LEFT JOIN PT_0214T I ON A.DLR_CD = I.DLR_CD AND A.REQ_STRGE_CD = I.STRGE_CD AND A.ITEM_CD = I.ITEM_CD
                    LEFT JOIN PT_0208T J ON A.DLR_CD = J.DLR_CD AND A.REQ_STRGE_CD = J.STRGE_CD AND A.ITEM_CD = J.ITEM_CD
                    LEFT JOIN PT_0224T K ON A.DLR_CD = K.DLR_CD  AND A.REQ_STRGE_CD = K.STRGE_CD AND A.ITEM_CD = K.ITEM_CD AND K.LOC_CD != ''
                    LEFT JOIN PT_0231T L ON A.DLR_CD = L.DLR_CD AND A.PKG_ITEM_CD = L.PKG_ITEM_CD AND A.ITEM_CD = L.ITEM_CD AND A.PKG_DOC_NO = L.PKG_DOC_NO
                    LEFT JOIN CM_0801T K2 ON F.RECEIVE_ID = K2.USR_ID
                    LEFT JOIN CM_0801T K3 ON A.REG_USR_ID = K3.USR_ID
                    LEFT JOIN CM_3401T K4 ON K3.DEPT_CD = K4.DEPT_CD
                    LEFT JOIN CM_0801T K5 ON R.REG_USR_ID = K5.USR_ID
                    LEFT JOIN PT_0312T K6 ON K6.DLR_CD = F.DLR_CD AND K6.MVT_DOC_NO = F.MVT_DOC_NO AND K6.ITEM_CD = F.ITEM_CD
                   -- LEFT JOIN SE_0500T X ON A.DLR_CD = X.DLR_CD AND A.RO_DOC_NO = X.RO_DOC_NO
                    <where>
                        <if test='sDlrCd != null and sDlrCd != ""'>
                            AND A.DLR_CD = #{sDlrCd}
                        </if>

                        <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                            AND A.PAR_REQ_DOC_NO = #{sParReqDocNo}
                        </if>

                        <if test='sParReqDocLineNo != null and sParReqDocLineNo != 0'>
                            AND A.PAR_REQ_DOC_LINE_NO = #{sParReqDocLineNo}
                        </if>

                        <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                            AND A.PAR_REQ_STAT_CD = #{sParReqStatCd}
                        </if>

                        <if test='sRoDocNo != null and sRoDocNo != ""'>
                            AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                        </if>

                        <if test='sRoLineNo != null and sRoLineNo != 0'>
                            AND A.RO_LINE_NO = #{sRoLineNo}
                        </if>

                        <if test='sResvDocNo != null and sResvDocNo != ""'>
                            AND A.RESV_DOC_NO = #{sResvDocNo}
                        </if>

                        <if test='sResvDocLineNo != null and sResvDocLineNo != 0'>
                            AND A.RESV_DOC_LINE_NO = #{sResvDocLineNo}
                        </if>

                        <if test='sParGiTp != null and sParGiTp != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG01")'>
                                    AND (A.PAR_GI_TP in ('RO','IN') OR A.BORROW_DOC_NO IS NOT NULL)
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG02")'>
                                    AND A.BORROW_DOC_NO IS NOT NULL
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG03")'>
                                    AND A.PAR_GI_TP in ('RO') AND A.BORROW_DOC_NO IS NULL
                                </when>
                                <otherwise>
                                    AND A.PAR_GI_TP = #{sParGiTp}
                                </otherwise>
                            </choose>
                        </if>

                        AND A.BORROW_STAT_CD != '03'<!-- 정비차용상태 반환 아닌 것 -->

                        <if test='sItemCd != null and sItemCd != ""'>
                            AND A.ITEM_CD LIKE '%'||#{sItemCd}||'%'
                        </if>

                        <if test='sItemCdOnly != null and sItemCdOnly != ""'>
                            AND A.ITEM_CD = #{sItemCdOnly}
                        </if>

                        <if test='sCancYn != null and sCancYn != ""'>
                            AND A.CANC_YN = #{sCancYn}
                        </if>

                        <if test='sEtcGiTp != null and sEtcGiTp != ""'>
                            AND A.ETC_GI_TP = #{sEtcGiTp}
                        </if>

                        <if test='sReqStrgeCd != null and sReqStrgeCd != ""'>
                            AND A.REQ_STRGE_CD = #{sReqStrgeCd}
                        </if>

                        <if test='sGiStrgeCd != null and sGiStrgeCd != ""'>
                            AND A.GI_STRGE_CD = #{sGiStrgeCd}
                        </if>

                        <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                            AND A.GR_STRGE_CD = #{sGrStrgeCd}
                        </if>

                        <if test='sReadyDocNo != null and sReadyDocNo != ""'>
                            AND A.READY_DOC_NO LIKE '%'||#{sReadyDocNo}||'%'
                        </if>

                        <if test='sReadyStatCd != null and sReadyStatCd != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE01")'>
                                     AND A.READY_STAT_CD IN ('01','02','04')
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE02")'>
                                     AND A.READY_STAT_CD IN ('02','03','05')
                                </when>
                                <otherwise>
                                     AND A.READY_STAT_CD = #{sReadyStatCd}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sReqStartDt != null'>
                            <choose>
                                <otherwise>
                                     AND A.REG_DT <![CDATA[>=]]> #{sReqStartDt}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sReqEndDt != null'>
                            <choose>
                                <otherwise>
                                     AND A.REG_DT <![CDATA[<=]]> #{sReqEndDt} + 1
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sVinNo != null and sVinNo != ""'>
                            AND H.VIN_NO LIKE '%'||#{sVinNo}||'%'
                        </if>

                        <if test='sCarNo != null and sCarNo != ""'>
                            AND H.CAR_NO LIKE '%'||#{sCarNo}||'%'
                        </if>

                        <if test='sCustNm != null and sCustNm != ""'>
                            AND H.CUST_NM LIKE '%'||#{sCustNm}||'%'
                        </if>

                        <if test='sBorrowStatCd != null and sBorrowStatCd != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_01")'>
                                    AND (A.BORROW_STAT_CD = '01' OR A.BORROW_DOC_NO IS NULL )
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_02")'>
                                    AND (A.BORROW_STAT_CD IN ('05','04') OR A.BORROW_DOC_NO IS NULL OR A.READY_STAT_CD = '06' )
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_03")'>
                                    AND A.BORROW_STAT_CD in ('02')<!-- 차용 -->
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_04")'>
                                    AND A.BORROW_DOC_NO IS NOT NULL
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_05")'>
                                    AND A.BORROW_STAT_CD in ('04','05')<!-- 정비차용확정, 차용대기 -->
                                </when>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_06")'>
                                    AND A.BORROW_STAT_CD != '03'<!-- 반환 제외 -->
                                </when>
                                <otherwise>
                                    AND A.BORROW_STAT_CD = #{sBorrowStatCd}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sBorrowDocNoUseYn != null and sBorrowDocNoUseYn == "Y"'>
                            AND A.BORROW_DOC_NO IS NOT NULL
                        </if>

                        <if test='sGiDocStatCd != null and sGiDocStatCd != ""'>
                            AND F.GI_DOC_STAT_CD = #{sGiDocStatCd}
                        </if>

                        <if test='sGiDocNo != null and sGiDocNo != ""'>
                            AND F.GI_DOC_NO LIKE '%'||#{sGiDocNo}||'%'
                        </if>

                        <if test='sGiDocReqStartDt != null'>
                            <choose>
                                <otherwise>
                                     AND F.RECEIVE_DT <![CDATA[>=]]> #{sGiDocReqStartDt}
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sGiDocReqEndDt != null'>
                            <choose>
                                <otherwise>
                                     AND F.RECEIVE_DT <![CDATA[<=]]> #{sGiDocReqEndDt} + 1
                                </otherwise>
                            </choose>
                        </if>

                        <if test='sReceiveId != null and sReceiveId != ""'>
                            AND F.RECEIVE_ID LIKE '%'||#{sReceiveId}||'%'
                        </if>

                        <if test='sReceiveNm != null and sReceiveNm != ""'>
                            AND K2.USR_NM LIKE '%'||#{sReceiveNm}||'%'
                        </if>

                        <if test='sRoStatCd != null and sRoStatCd != ""'>
                            AND NVL(R.RO_STAT_CD,'01') = #{sRoStatCd}
                        </if>

                        <if test='sPartsOutUseYn != null and sPartsOutUseYn != ""'>
                            <choose>
                                <when test='@org.apache.commons.lang3.StringUtils@contains(sPartsOutUseYn,"Y")'>
                                     AND F.GI_DOC_STAT_CD IN ('02','03')
                                </when>
                                <otherwise>
                                </otherwise>
                            </choose>
                        </if>
                        AND NVL(R.RO_STAT_CD, '01') NOT IN ('01','02')
                        AND A.PAR_REQ_STAT_CD IN ('01','02','03')
                    </where>
                )TA
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        AND TA.DLR_CD = #{sDlrCd}
                    </if>

                    <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                        AND TA.PAR_REQ_DOC_NO = #{sParReqDocNo}
                    </if>

                    <if test='sParReqDocLineNo != null and sParReqDocLineNo != 0'>
                        AND TA.PAR_REQ_DOC_LINE_NO = #{sParReqDocLineNo}
                    </if>

                    <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                        AND TA.PAR_REQ_STAT_CD = #{sParReqStatCd}
                    </if>

                    <if test='sRoDocNo != null and sRoDocNo != ""'>
                        AND TA.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                    </if>

                    <if test='sRoLineNo != null and sRoLineNo != 0'>
                        AND TA.RO_LINE_NO = #{sRoLineNo}
                    </if>

                    <if test='sResvDocNo != null and sResvDocNo != ""'>
                        AND TA.RESV_DOC_NO = #{sResvDocNo}
                    </if>

                    <if test='sResvDocLineNo != null and sResvDocLineNo != 0'>
                        AND TA.RESV_DOC_LINE_NO = #{sResvDocLineNo}
                    </if>

                    <if test='sSerPrsnId != null and sSerPrsnId != ""'>
                        AND TA.RO_REG_USR_NM LIKE '%'||#{sSerPrsnId}||'%'
                    </if>

                    <if test='sParGiTp != null and sParGiTp != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG01")'>
                                AND (TA.PAR_GI_TP in ('RO','IN') OR TA.BORROW_DOC_NO IS NOT NULL)
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG02")'>
                                AND TA.BORROW_DOC_NO IS NOT NULL
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG03")'>
                                AND TA.PAR_GI_TP in ('RO') AND TA.BORROW_DOC_NO IS NULL
                            </when>
                            <otherwise>
                                AND TA.PAR_GI_TP = #{sParGiTp}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sItemCd != null and sItemCd != ""'>
                        AND TA.ITEM_CD LIKE '%'||#{sItemCd}||'%'
                    </if>

                    <if test='sItemCdOnly != null and sItemCdOnly != ""'>
                        AND TA.ITEM_CD = #{sItemCdOnly}
                    </if>

                    <if test='sCancYn != null and sCancYn != ""'>
                        AND TA.CANC_YN = #{sCancYn}
                    </if>

                    <if test='sEtcGiTp != null and sEtcGiTp != ""'>
                        AND TA.ETC_GI_TP = #{sEtcGiTp}
                    </if>

                    <if test='sReqStrgeCd != null and sReqStrgeCd != ""'>
                        AND TA.REQ_STRGE_CD = #{sReqStrgeCd}
                    </if>

                    <if test='sGiStrgeCd != null and sGiStrgeCd != ""'>
                        AND TA.GI_STRGE_CD = #{sGiStrgeCd}
                    </if>

                    <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                        AND TA.GR_STRGE_CD = #{sGrStrgeCd}
                    </if>

                    <if test='sReadyDocNo != null and sReadyDocNo != ""'>
                        AND TA.READY_DOC_NO LIKE '%'||#{sReadyDocNo}||'%'
                    </if>

                    <if test='sReadyStatCd != null and sReadyStatCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE01")'>
                                 AND TA.READY_STAT_CD IN ('01','02','04')
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE02")'>
                                 AND TA.READY_STAT_CD IN ('02','03','05')
                            </when>
                            <otherwise>
                                 AND TA.READY_STAT_CD = #{sReadyStatCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReqStartDt != null'>
                        <choose>
                            <otherwise>
                                 AND TA.REG_DT <![CDATA[>=]]> #{sReqStartDt}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReqEndDt != null'>
                        <choose>
                            <otherwise>
                                 AND TA.REG_DT <![CDATA[<=]]> #{sReqEndDt} + 1
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sVinNo != null and sVinNo != ""'>
                        AND TA.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>

                    <if test='sCarNo != null and sCarNo != ""'>
                        AND TA.CAR_NO LIKE '%'||#{sCarNo}||'%'
                    </if>

                    <if test='sCustNm != null and sCustNm != ""'>
                        AND TA.CUST_NM LIKE '%'||#{sCustNm}||'%'
                    </if>

                    <if test='sBorrowStatCd != null and sBorrowStatCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_01")'>
                                AND (TA.BORROW_STAT_CD = '01' OR TA.BORROW_DOC_NO IS NULL )
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_02")'>
                                AND (TA.BORROW_STAT_CD IN ('05','04') OR TA.BORROW_DOC_NO IS NULL OR TA.READY_STAT_CD = '06' )
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_03")'>
                                AND TA.BORROW_STAT_CD in ('02')<!-- 차용 -->
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_04")'>
                                AND TA.BORROW_DOC_NO IS NOT NULL
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_05")'>
                                AND TA.BORROW_STAT_CD in ('04','05')<!-- 정비차용확정, 차용대기 -->
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_06")'>
                                AND TA.BORROW_STAT_CD != '03'<!-- 반환 제외 -->
                            </when>
                            <otherwise>
                                AND TA.BORROW_STAT_CD = #{sBorrowStatCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sBorrowDocNoUseYn != null and sBorrowDocNoUseYn == "Y"'>
                        AND TA.BORROW_DOC_NO IS NOT NULL
                    </if>

                    <if test='sGiDocStatCd != null and sGiDocStatCd != ""'>
                        AND TA.GI_DOC_STAT_CD = #{sGiDocStatCd}
                    </if>

                    <if test='sGiDocNo != null and sGiDocNo != ""'>
                        AND TA.GI_DOC_NO LIKE '%'||#{sGiDocNo}||'%'
                    </if>

                    <if test='sGiDocReqStartDt != null'>
                        <choose>
                            <otherwise>
                                 AND TA.RECEIVE_DT <![CDATA[>=]]> #{sGiDocReqStartDt}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sGiDocReqEndDt != null'>
                        <choose>
                            <otherwise>
                                 AND TA.RECEIVE_DT <![CDATA[<=]]> #{sGiDocReqEndDt} + 1
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReceiveId != null and sReceiveId != ""'>
                        AND TA.RECEIVE_ID LIKE '%'||#{sReceiveId}||'%'
                    </if>

                    <if test='sReceiveNm != null and sReceiveNm != ""'>
                        AND TA.USR_NM LIKE '%'||#{sReceiveNm}||'%'
                    </if>

                    <if test='sRoStatCd != null and sRoStatCd != ""'>
                        AND TA.RO_STAT_CD = #{sRoStatCd}
                    </if>

                    <if test='sPartsOutUseYn != null and sPartsOutUseYn != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sPartsOutUseYn,"Y")'>
                                 AND TA.GI_DOC_STAT_CD IN ('02','03')
                            </when>
                            <otherwise>
                            </otherwise>
                        </choose>
                    </if>
                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "parReqDocNo"'>TA.PAR_REQ_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "parReqDocLineNo"'>TA.PAR_REQ_DOC_LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "parReqStatCd"'>TA.PAR_REQ_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "cancYn"'>TA.CANC_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "parGiTp"'>TA.PAR_GI_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "resvDocNo"'>TA.RESV_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "resvDocLineNo"'>TA.RESV_DOC_LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roDocNo"'>TA.RO_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roLineNo"'>TA.RO_LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "itemCd"'>TA.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "itemNm"'>TA.ITEM_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "giStrgeCd"'>TA.GI_STRGE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "reqQty"'>TA.REQ_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "endQty"'>TA.END_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "reqStrgeCd"'>TA.REQ_STRGE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "unitCd"'>TA.UNIT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "custCd"'>TA.CUST_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "custNm"'>TA.CUST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "vinNo"'>TA.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "carNo"'>TA.CAR_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "avlbStockQty"'>TA.AVLB_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "resvStockQty"'>TA.RESV_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "clamStockQty"'>TA.CLAM_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "grScheQty"'>TA.GR_SCHE_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "giScheQty"'>TA.GI_SCHE_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "resvQty"'>TA.RESV_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "purcReqDt"'>TA.PURC_REQ_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "giDocNo"'>TA.GI_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "giDocTp"'>TA.GI_DOC_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "giDocStatCd"'>TA.GI_DOC_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "receiveNm"'>TA.RECEIVE_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "updtUsrNm"'>TA.UPDT_USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                    TA.DLR_CD, TA.RO_DOC_NO DESC, TA.RO_LINE_NO ASC, TA.PAR_REQ_DOC_LINE_NO ASC, TA.PAR_REQ_DOC_STOCK_LINE_NO ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        TA.DLR_CD, TA.RO_DOC_NO DESC, TA.RO_LINE_NO ASC, TA.PAR_REQ_DOC_LINE_NO ASC, TA.PAR_REQ_DOC_STOCK_LINE_NO ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 정비 수령 부품요청상세 정보 카운트를 조회한다. -->
    <select id="selectIssueReqDetailsByConditionForItemDeleteCnt" parameterType="IssueReqSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqDetailsByConditionForItemDeleteCnt] */
        SELECT
            count(*)
        FROM PT_0502T A
         WHERE A.DLR_CD = #{sDlrCd}
           AND A.ITEM_CD = #{sItemCd}
           <if test='sParGiTp != null and sParGiTp != ""'>
                <choose>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG01")'>
                         AND (A.PAR_GI_TP in ('RO') OR A.BORROW_DOC_NO IS NOT NULL)
                    </when>
                    <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG02")'>
                         AND A.BORROW_DOC_NO IS NOT NULL
                    </when>
                    <otherwise>
                         AND A.PAR_GI_TP = #{sParGiTp}
                    </otherwise>
                </choose>
            </if>
    </select>

    <!-- 정비수령 부품요청상세 정보 목록을 조회한다. -->
    <select id="selectPrintIssueReqDetailsByCondition" parameterType="IssueReqSearchVO" resultType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectPrintIssueReqDetailsByCondition] */
                SELECT
                    NVL(F.GI_DOC_NO,'-') AS GI_DOC_NO
                    ,F.RECEIVE_ID
                    ,MAX(F.RECEIVE_DT) AS RECEIVE_DT
                FROM PT_0502T A
                LEFT JOIN PT_0201T B ON A.DLR_CD = B.DLR_CD AND A.ITEM_CD = B.ITEM_CD
                LEFT JOIN SE_0300T R ON A.DLR_CD = R.DLR_CD AND A.RO_DOC_NO = R.RO_DOC_NO
                LEFT JOIN PT_0301T C ON A.DLR_CD = C.DLR_CD AND A.ITEM_CD = C.ITEM_CD AND A.REQ_STRGE_CD = C.STRGE_CD
                LEFT JOIN PT_0302T D ON A.DLR_CD = D.DLR_CD AND A.ITEM_CD = D.ITEM_CD AND A.REQ_STRGE_CD = D.STRGE_CD AND A.RESV_DOC_NO = D.RESV_DOC_NO AND A.RESV_DOC_LINE_NO = D.RESV_DOC_LINE_NO
                LEFT JOIN PT_0511T E ON A.DLR_CD = E.DLR_CD AND A.RO_DOC_NO = E.RO_DOC_NO
                LEFT JOIN PT_0512T F ON A.DLR_CD = F.DLR_CD AND A.PAR_REQ_DOC_NO = F.PAR_REQ_DOC_NO AND A.PAR_REQ_DOC_LINE_NO = F.PAR_REQ_DOC_LINE_NO
                AND A.PAR_REQ_DOC_LINE_NO = F.GI_DOC_LINE_NO
                AND A.PAR_REQ_STAT_CD = F.GI_DOC_STAT_CD
                LEFT JOIN PT_0411T G ON A.DLR_CD = G.DLR_CD AND A.RO_DOC_NO = G.REF_DOC_NO AND A.RO_LINE_NO = G.REF_DOC_LINE_NO AND A.ITEM_CD = G.ITEM_CD
                LEFT JOIN PT_0501T H ON A.DLR_CD = H.DLR_CD AND A.PAR_REQ_DOC_NO = H.PAR_REQ_DOC_NO
                LEFT JOIN PT_0214T I ON A.DLR_CD = I.DLR_CD AND A.REQ_STRGE_CD = I.STRGE_CD AND A.ITEM_CD = I.ITEM_CD
                LEFT JOIN PT_0208T J ON A.DLR_CD = J.DLR_CD AND A.REQ_STRGE_CD = J.STRGE_CD AND A.ITEM_CD = J.ITEM_CD
                LEFT JOIN PT_0224T K ON A.DLR_CD = K.DLR_CD AND A.REQ_STRGE_CD = K.STRGE_CD AND A.ITEM_CD = K.ITEM_CD  AND K.LOC_CD != ''
                LEFT JOIN PT_0231T L ON A.DLR_CD = L.DLR_CD AND A.PKG_ITEM_CD = L.PKG_ITEM_CD AND A.ITEM_CD = L.ITEM_CD AND A.PKG_DOC_NO = L.PKG_DOC_NO
                LEFT JOIN CM_0801T K2 ON F.RECEIVE_ID = K2.USR_ID
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        AND A.DLR_CD = #{sDlrCd}
                    </if>

                    <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                        AND A.PAR_REQ_DOC_NO = #{sParReqDocNo}
                    </if>

                    <if test='sParReqDocLineNo != null and sParReqDocLineNo != 0'>
                        AND A.PAR_REQ_DOC_LINE_NO = #{sParReqDocLineNo}
                    </if>

                    <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                        AND A.PAR_REQ_STAT_CD = #{sParReqStatCd}
                    </if>

                    <if test='sRoDocNo != null and sRoDocNo != ""'>
                        AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                    </if>

                    <if test='sRoLineNo != null and sRoLineNo != 0'>
                        AND A.RO_LINE_NO = #{sRoLineNo}
                    </if>

                    <if test='sResvDocNo != null and sResvDocNo != ""'>
                        AND A.RESV_DOC_NO = #{sResvDocNo}
                    </if>

                    <if test='sResvDocLineNo != null and sResvDocLineNo != 0'>
                        AND A.RESV_DOC_LINE_NO = #{sResvDocLineNo}
                    </if>

                    <if test='sParGiTp != null and sParGiTp != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG01")'>
                                AND (A.PAR_GI_TP in ('RO') OR A.BORROW_DOC_NO IS NOT NULL)
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG02")'>
                                AND A.BORROW_DOC_NO IS NOT NULL
                            </when>
                            <otherwise>
                                AND A.PAR_GI_TP = #{sParGiTp}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sItemCd != null and sItemCd != ""'>
                        AND A.ITEM_CD LIKE '%'||#{sItemCd}||'%'
                    </if>

                    <if test='sItemCdOnly != null and sItemCdOnly != ""'>
                        AND A.ITEM_CD = #{sItemCdOnly}
                    </if>

                    <if test='sCancYn != null and sCancYn != ""'>
                        AND A.CANC_YN = #{sCancYn}
                    </if>

                    <if test='sEtcGiTp != null and sEtcGiTp != ""'>
                        AND A.ETC_GI_TP = #{sEtcGiTp}
                    </if>

                    <if test='sReqStrgeCd != null and sReqStrgeCd != ""'>
                        AND A.REQ_STRGE_CD = #{sReqStrgeCd}
                    </if>

                    <if test='sGiStrgeCd != null and sGiStrgeCd != ""'>
                        AND A.GI_STRGE_CD = #{sGiStrgeCd}
                    </if>

                    <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                        AND A.GR_STRGE_CD = #{sGrStrgeCd}
                    </if>

                    <if test='sReadyDocNo != null and sReadyDocNo != ""'>
                        AND A.READY_DOC_NO LIKE '%'||#{sReadyDocNo}||'%'
                    </if>

                    <if test='sReadyStatCd != null and sReadyStatCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE01")'>
                                 AND A.READY_STAT_CD IN ('01','02','04')
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE02")'>
                                 AND A.READY_STAT_CD IN ('02','03','05')
                            </when>
                            <otherwise>
                                 AND A.READY_STAT_CD = #{sReadyStatCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReqStartDt != null'>
                        <choose>
                            <otherwise>
                                 AND A.REG_DT <![CDATA[>=]]> #{sReqStartDt}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReqEndDt != null'>
                        <choose>
                            <otherwise>
                                 AND A.REG_DT <![CDATA[<=]]> #{sReqEndDt} + 1
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sVinNo != null and sVinNo != ""'>
                        AND H.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>

                    <if test='sCarNo != null and sCarNo != ""'>
                        AND H.CAR_NO LIKE '%'||#{sCarNo}||'%'
                    </if>

                    <if test='sCustNm != null and sCustNm != ""'>
                        AND H.CUST_NM LIKE '%'||#{sCustNm}||'%'
                    </if>

                    <if test='sBorrowStatCd != null and sBorrowStatCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_01")'>
                                AND (A.BORROW_STAT_CD = '01' OR A.BORROW_DOC_NO IS NULL )
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_02")'>
                                AND (A.BORROW_STAT_CD IN ('05','04') OR A.BORROW_DOC_NO IS NULL OR A.READY_STAT_CD = '06' )
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_03")'>
                                AND A.BORROW_STAT_CD in ('02')
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_04")'>
                                AND A.BORROW_DOC_NO IS NOT NULL
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_05")'>
                                AND A.BORROW_STAT_CD in ('04','05')<!-- 정비차용확정, 차용대기 -->
                            </when>
                            <otherwise>
                                AND A.BORROW_STAT_CD = #{sBorrowStatCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sGiDocStatCd != null and sGiDocStatCd != ""'>
                        AND F.GI_DOC_STAT_CD = #{sGiDocStatCd}
                    </if>

                    <if test='sGiDocNo != null and sGiDocNo != ""'>
                        AND F.GI_DOC_NO LIKE '%'||#{sGiDocNo}||'%'
                    </if>

                    <if test='sGiDocReqEndDt != null'>
                        <choose>
                            <otherwise>
                                 AND F.REG_DT <![CDATA[>=]]> #{sGiDocReqEndDt}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sGiDocReqEndDt != null'>
                        <choose>
                            <otherwise>
                                 AND F.REG_DT <![CDATA[<=]]> #{sGiDocReqEndDt} + 1
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReceiveId != null and sReceiveId != ""'>
                        AND F.RECEIVE_ID LIKE '%'||#{sReceiveId}||'%'
                    </if>

                    <if test='sReceiveNm != null and sReceiveNm != ""'>
                        AND K2.USR_NM LIKE '%'||#{sReceiveNm}||'%'
                    </if>

                    <if test='sPartsOutUseYn != null and sPartsOutUseYn != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sPartsOutUseYn,"Y")'>
                                 AND F.GI_DOC_STAT_CD IN ('02','03')
                            </when>
                            <otherwise>
                            </otherwise>
                        </choose>
                    </if>

                    AND NVL(R.RO_STAT_CD, '01') <![CDATA[<>]]> '06'<!-- RO상태 취소 제외 -->

                </where>
                GROUP BY F.GI_DOC_NO,F.RECEIVE_ID

    </select>

    <!-- 정비 수령 부품요청상세 정보 카운트를 조회한다. -->
    <select id="selectPrintIssueReqDetailsByConditionCnt" parameterType="IssueReqSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectPrintIssueReqDetailsByConditionCnt] */
        SELECT
            COUNT(0)
        FROM
        (
            SELECT
                    NVL(F.GI_DOC_NO,'-') AS GI_DOC_NO
                    ,F.RECEIVE_ID
                    ,F.RECEIVE_DT
                FROM PT_0502T A
                LEFT JOIN PT_0201T B ON A.DLR_CD = B.DLR_CD AND A.ITEM_CD = B.ITEM_CD
                LEFT JOIN SE_0300T R ON A.DLR_CD = R.DLR_CD AND A.RO_DOC_NO = R.RO_DOC_NO
                LEFT JOIN PT_0301T C ON A.DLR_CD = C.DLR_CD AND A.ITEM_CD = C.ITEM_CD AND A.REQ_STRGE_CD = C.STRGE_CD
                LEFT JOIN PT_0302T D ON A.DLR_CD = D.DLR_CD AND A.ITEM_CD = D.ITEM_CD AND A.REQ_STRGE_CD = D.STRGE_CD AND A.RESV_DOC_NO = D.RESV_DOC_NO AND A.RESV_DOC_LINE_NO = D.RESV_DOC_LINE_NO
                LEFT JOIN PT_0511T E ON A.DLR_CD = E.DLR_CD AND A.RO_DOC_NO = E.RO_DOC_NO
                LEFT JOIN PT_0512T F ON A.DLR_CD = F.DLR_CD AND A.PAR_REQ_DOC_NO = F.PAR_REQ_DOC_NO AND A.PAR_REQ_DOC_LINE_NO = F.PAR_REQ_DOC_LINE_NO
                AND A.PAR_REQ_DOC_LINE_NO = F.GI_DOC_LINE_NO
                AND A.PAR_REQ_STAT_CD = F.GI_DOC_STAT_CD
                LEFT JOIN PT_0411T G ON A.DLR_CD = G.DLR_CD AND A.RO_DOC_NO = G.REF_DOC_NO AND A.RO_LINE_NO = G.REF_DOC_LINE_NO AND A.ITEM_CD = G.ITEM_CD
                LEFT JOIN PT_0501T H ON A.DLR_CD = H.DLR_CD AND A.PAR_REQ_DOC_NO = H.PAR_REQ_DOC_NO
                LEFT JOIN PT_0214T I ON A.DLR_CD = I.DLR_CD AND A.REQ_STRGE_CD = I.STRGE_CD AND A.ITEM_CD = I.ITEM_CD
                LEFT JOIN PT_0208T J ON A.DLR_CD = J.DLR_CD AND A.REQ_STRGE_CD = J.STRGE_CD AND A.ITEM_CD = J.ITEM_CD
                LEFT JOIN PT_0224T K ON A.DLR_CD = K.DLR_CD AND A.REQ_STRGE_CD = K.STRGE_CD AND A.ITEM_CD = K.ITEM_CD  AND K.LOC_CD != ''
                LEFT JOIN PT_0231T L ON A.DLR_CD = L.DLR_CD AND A.PKG_ITEM_CD = L.PKG_ITEM_CD AND A.ITEM_CD = L.ITEM_CD AND A.PKG_DOC_NO = L.PKG_DOC_NO
                LEFT JOIN CM_0801T K2 ON F.RECEIVE_ID = K2.USR_ID
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        AND A.DLR_CD = #{sDlrCd}
                    </if>

                    <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                        AND A.PAR_REQ_DOC_NO = #{sParReqDocNo}
                    </if>

                    <if test='sParReqDocLineNo != null and sParReqDocLineNo != 0'>
                        AND A.PAR_REQ_DOC_LINE_NO = #{sParReqDocLineNo}
                    </if>

                    <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                        AND A.PAR_REQ_STAT_CD = #{sParReqStatCd}
                    </if>

                    <if test='sRoDocNo != null and sRoDocNo != ""'>
                        AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                    </if>

                    <if test='sRoLineNo != null and sRoLineNo != 0'>
                        AND A.RO_LINE_NO = #{sRoLineNo}
                    </if>

                    <if test='sResvDocNo != null and sResvDocNo != ""'>
                        AND A.RESV_DOC_NO = #{sResvDocNo}
                    </if>

                    <if test='sResvDocLineNo != null and sResvDocLineNo != 0'>
                        AND A.RESV_DOC_LINE_NO = #{sResvDocLineNo}
                    </if>

                    <if test='sParGiTp != null and sParGiTp != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG01")'>
                                AND (A.PAR_GI_TP in ('RO') OR A.BORROW_DOC_NO IS NOT NULL)
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sParGiTp,"PG02")'>
                                AND A.BORROW_DOC_NO IS NOT NULL
                            </when>
                            <otherwise>
                                AND A.PAR_GI_TP = #{sParGiTp}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sItemCd != null and sItemCd != ""'>
                        AND A.ITEM_CD LIKE '%'||#{sItemCd}||'%'
                    </if>

                    <if test='sItemCdOnly != null and sItemCdOnly != ""'>
                        AND A.ITEM_CD = #{sItemCdOnly}
                    </if>

                    <if test='sCancYn != null and sCancYn != ""'>
                        AND A.CANC_YN = #{sCancYn}
                    </if>

                    <if test='sEtcGiTp != null and sEtcGiTp != ""'>
                        AND A.ETC_GI_TP = #{sEtcGiTp}
                    </if>

                    <if test='sReqStrgeCd != null and sReqStrgeCd != ""'>
                        AND A.REQ_STRGE_CD = #{sReqStrgeCd}
                    </if>

                    <if test='sGiStrgeCd != null and sGiStrgeCd != ""'>
                        AND A.GI_STRGE_CD = #{sGiStrgeCd}
                    </if>

                    <if test='sGrStrgeCd != null and sGrStrgeCd != ""'>
                        AND A.GR_STRGE_CD = #{sGrStrgeCd}
                    </if>

                    <if test='sReadyDocNo != null and sReadyDocNo != ""'>
                        AND A.READY_DOC_NO LIKE '%'||#{sReadyDocNo}||'%'
                    </if>

                    <if test='sReadyStatCd != null and sReadyStatCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE01")'>
                                 AND A.READY_STAT_CD IN ('01','02','04')
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE02")'>
                                 AND A.READY_STAT_CD IN ('02','03','05')
                            </when>
                            <otherwise>
                                 AND A.READY_STAT_CD = #{sReadyStatCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReqStartDt != null'>
                        <choose>
                            <otherwise>
                                 AND A.REG_DT <![CDATA[>=]]> #{sReqStartDt}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReqEndDt != null'>
                        <choose>
                            <otherwise>
                                 AND A.REG_DT <![CDATA[<=]]> #{sReqEndDt} + 1
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sVinNo != null and sVinNo != ""'>
                        AND H.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>

                    <if test='sCarNo != null and sCarNo != ""'>
                        AND H.CAR_NO LIKE '%'||#{sCarNo}||'%'
                    </if>

                    <if test='sCustNm != null and sCustNm != ""'>
                        AND H.CUST_NM LIKE '%'||#{sCustNm}||'%'
                    </if>

                    <if test='sBorrowStatCd != null and sBorrowStatCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_01")'>
                                AND (A.BORROW_STAT_CD = '01' OR A.BORROW_DOC_NO IS NULL )
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_02")'>
                                AND (A.BORROW_STAT_CD IN ('05','04') OR A.BORROW_DOC_NO IS NULL OR A.READY_STAT_CD = '06' )
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_03")'>
                                AND A.BORROW_STAT_CD in ('02')
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_04")'>
                                AND A.BORROW_DOC_NO IS NOT NULL
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_05")'>
                                AND A.BORROW_STAT_CD in ('04','05')<!-- 정비차용확정, 차용대기 -->
                            </when>
                            <otherwise>
                                AND A.BORROW_STAT_CD = #{sBorrowStatCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sGiDocStatCd != null and sGiDocStatCd != ""'>
                        AND F.GI_DOC_STAT_CD = #{sGiDocStatCd}
                    </if>

                    <if test='sGiDocNo != null and sGiDocNo != ""'>
                        AND F.GI_DOC_NO LIKE '%'||#{sGiDocNo}||'%'
                    </if>

                    <if test='sGiDocReqEndDt != null'>
                        <choose>
                            <otherwise>
                                 AND F.REG_DT <![CDATA[>=]]> #{sGiDocReqEndDt}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sGiDocReqEndDt != null'>
                        <choose>
                            <otherwise>
                                 AND F.REG_DT <![CDATA[<=]]> #{sGiDocReqEndDt} + 1
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReceiveId != null and sReceiveId != ""'>
                        AND F.RECEIVE_ID LIKE '%'||#{sReceiveId}||'%'
                    </if>

                    <if test='sReceiveNm != null and sReceiveNm != ""'>
                        AND K2.USR_NM LIKE '%'||#{sReceiveNm}||'%'
                    </if>

                    <if test='sPartsOutUseYn != null and sPartsOutUseYn != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sPartsOutUseYn,"Y")'>
                                 AND F.GI_DOC_STAT_CD IN ('02','03')
                            </when>
                            <otherwise>
                            </otherwise>
                        </choose>
                    </if>

                    AND NVL(R.RO_STAT_CD, '01') <![CDATA[<>]]> '06'<!-- RO상태 취소 제외 -->

                </where>
                GROUP BY F.GI_DOC_NO,F.RECEIVE_DT ,F.RECEIVE_ID
            )
    </select>


    <!-- 내부수령 부품요청상세 정보 목록을 조회한다. -->
    <select id="selectIssueReqInnerDetailsByCondition" parameterType="IssueReqSearchVO" resultType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqInnerDetailsByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                    A.DLR_CD
                    ,A.PAR_REQ_DOC_NO
                    ,A.PAR_REQ_DOC_LINE_NO
                    ,A.PAR_REQ_STAT_CD
                    ,G.PURC_REQ_NO
                    ,A.CANC_YN
                    ,A.PAR_GI_TP
                    ,A.RO_DOC_NO
                    ,A.RO_LINE_NO
                    ,A.RESV_DOC_NO
                    ,A.RESV_DOC_LINE_NO
                    ,B.GI_STRGE_CD AS GR_STRGE_CD
                    ,NVL(A.GI_STRGE_CD,B.GI_STRGE_CD) AS GI_STRGE_CD
                    ,NVL(A.GI_LOC_CD,B.LOC_CD) AS GI_LOC_CD
                    ,A.ITEM_CD AS DB_ITEM_CD
                    ,A.ITEM_CD
                    ,B.BRAND_CD
                    ,B.STOCK_UNIT_CD AS UNIT_CD
                    ,A.ITEM_PRC
                    ,A.ITEM_AMT
                    ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(null,'ALL')), 2) * A.END_QTY ) * -1
                    ELSE ROUND(A.ITEM_PRC / ( 1 + FN_GET_VAT(null,'ALL')), 2) * A.END_QTY
                    END AS TAX_DDCT_AMT
                    ,A.TAX_AMT
                    ,A.REQ_QTY
                    ,A.END_QTY AS RESV_QTY
                    ,A.END_QTY
                    ,A.REQ_STRGE_CD
                    ,A.REG_DT
                    ,A.REG_USR_ID
                    ,A.UPDT_DT
                    ,A.UPDT_USR_ID
                    ,B.ITEM_NM
                    ,#{sPltCd} AS PLT_CD
                    ,NVL(C.AVLB_STOCK_QTY,0) + NVL(C.RESV_STOCK_QTY,0) - NVL(C.BORROW_QTY,0) + NVL(C.RENT_QTY,0) AS TOT_STOCK_QTY
                    ,NVL(C.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY
                    ,NVL(C.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY
                    ,NVL(C.CLAM_STOCK_QTY,0) AS CLAM_STOCK_QTY
                    ,NVL(C.GR_SCHE_QTY,0) AS GR_SCHE_QTY
                    ,NVL(C.GI_SCHE_QTY,0) AS GI_SCHE_QTY
                    ,A.REG_DT AS PURC_REQ_DT
                    ,NVL(F.GI_DOC_NO,'-') AS GI_DOC_NO
                    ,NVL(E.GI_DOC_TP,'01') AS GI_DOC_TP
                    ,NVL(F.GI_DOC_STAT_CD,'01') AS GI_DOC_STAT_CD
                    ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_YY_MM) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                    ELSE F.MVT_DOC_YY_MM
                    END AS MVT_DOC_YY_MM
                    ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_NO) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                    ELSE F.MVT_DOC_NO
                    END AS MVT_DOC_NO
                    ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT MIN(AA.MVT_DOC_LINE_NO) FROM PT_0512T AA WHERE AA.DLR_CD = #{sDlrCd} AND AA.PAR_REQ_DOC_NO = #{sParReqDocNo} AND AA.GI_DOC_STAT_CD = '02')
                    ELSE F.MVT_DOC_LINE_NO
                    END AS MVT_DOC_LINE_NO
                    ,H.CUST_CD
                    ,H.CUST_NM
                    ,H.SER_PRSN_ID
                    ,H.VIN_NO
                    ,H.CAR_NO
                    ,'Y' AS DB_YN
                    ,F.GI_STAT_CD
                    ,NVL(F.RECEIVE_ID,H.CUST_CD) AS RECEIVE_ID
                    ,NVL(K2.USR_NM,H.CUST_NM) AS RECEIVE_NM
                    ,(SELECT BK.USR_NM FROM CM_0801T BK WHERE BK.USR_ID = A.REG_USR_ID) AS REG_USR_NM
                    ,CASE WHEN A.PAR_REQ_STAT_CD = '03' THEN (SELECT BK.USR_NM FROM CM_0801T BK WHERE BK.USR_ID = A.REG_USR_ID)
                    ELSE (SELECT BK.USR_NM FROM CM_0801T BK WHERE BK.USR_ID = A.UPDT_USR_ID)
                    END UPDT_USR_NM
                    ,F.GI_DT
                    ,F.RECEIVE_DT
                    ,F.RETURN_ID
                    ,F.RETURN_DT
                    ,F.CANC_ID
                    ,F.CANC_DT
                    ,F.GI_CAU_NM
                    ,A.ETC_GI_TP
                    ,A.PKG_DOC_NO
                    ,A.PKG_ITEM_CD
                    ,NVL(F.RETURN_PARTS_QTY, 0) AS RETURN_PARTS_QTY
                    ,NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) AS MOVING_AVG_PRC
                    ,A.REQ_QTY * NVL(NVL(A.MOVING_AVG_PRC,NVL(J.MOVING_AVG_PRC, B.MOVING_AVG_PRC)),0) AS MOVING_AVG_AMT
                    ,NVL(A.READY_STAT_CD ,'01') AS READY_STAT_CD
                    ,A.READY_DOC_NO
                    ,A.READY_REMARK
                    ,A.READY_USR_ID
                    ,A.READY_REG_DT
                    ,A.READY_CANC_REMARK
                    ,A.READY_CANC_USR_ID
                    ,A.READY_CANC_REG_DT
                    ,A.BORROW_DOC_NO
                    ,A.BORROW_LINE_NO
                    ,A.BORROW_TP
                    ,A.BORROW_STAT_CD
                    ,A.BORROW_QTY
                    ,A.BORROW_USR_ID
                    ,A.BORROW_REG_DT
                    ,A.ETC_RV_DOC_NO
                    ,A.ETC_RV_LINE_NO
                    ,A.ETC_RV_STAT_CD
                    ,A.ETC_RV_QTY
                    ,A.ETC_RV_PRSN_ID
                    ,A.ETC_RV_REG_DT
                    ,A.COM_ITEM_CD
                    ,A.COM_ITEM_NM
                    ,A.COM_ITEM_PRC
                    ,NVL(A.RO_TP, '01') AS RO_TP
                    ,A.REMARK
                FROM PT_0502T A
                LEFT JOIN PT_0201T B ON A.DLR_CD = B.DLR_CD AND A.ITEM_CD = B.ITEM_CD
                LEFT JOIN PT_0301T C ON A.DLR_CD = C.DLR_CD AND A.ITEM_CD = C.ITEM_CD AND A.REQ_STRGE_CD = C.STRGE_CD
                LEFT JOIN PT_0302T D ON A.DLR_CD = D.DLR_CD AND A.ITEM_CD = D.ITEM_CD AND A.REQ_STRGE_CD = D.STRGE_CD AND A.RESV_DOC_NO = D.RESV_DOC_NO AND A.RESV_DOC_LINE_NO = D.RESV_DOC_LINE_NO
                LEFT JOIN PT_0511T E ON A.DLR_CD = E.DLR_CD AND A.RO_DOC_NO = E.RO_DOC_NO
                LEFT JOIN PT_0512T F ON A.DLR_CD = F.DLR_CD AND A.PAR_REQ_DOC_NO = F.PAR_REQ_DOC_NO AND A.PAR_REQ_DOC_LINE_NO = F.PAR_REQ_DOC_LINE_NO AND A.PAR_REQ_STAT_CD = F.GI_DOC_STAT_CD
                LEFT JOIN PT_0411T G ON A.DLR_CD = G.DLR_CD AND A.RO_DOC_NO = G.REF_DOC_NO AND A.RO_LINE_NO = G.REF_DOC_LINE_NO AND A.ITEM_CD = G.ITEM_CD
                LEFT JOIN PT_0501T H ON A.DLR_CD = H.DLR_CD AND A.PAR_REQ_DOC_NO = H.PAR_REQ_DOC_NO
                LEFT JOIN PT_0214T I ON A.DLR_CD = I.DLR_CD AND A.REQ_STRGE_CD = I.STRGE_CD AND A.ITEM_CD = I.ITEM_CD
                LEFT JOIN PT_0208T J ON A.DLR_CD  = J.DLR_CD AND A.REQ_STRGE_CD = J.STRGE_CD AND A.ITEM_CD = J.ITEM_CD
                LEFT JOIN CM_0801T K2 ON F.RECEIVE_ID = K2.USR_ID
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        AND A.DLR_CD LIKE '%'||#{sDlrCd}||'%'
                    </if>

                    <if test='sParReqDocNo != null and sParReqDocNo != ""'>
                        AND A.PAR_REQ_DOC_NO = #{sParReqDocNo}
                    </if>

                    <if test='sParReqDocLineNo != null and sParReqDocLineNo != 0'>
                        AND A.PAR_REQ_DOC_LINE_NO = #{sParReqDocLineNo}
                    </if>

                    <if test='sParReqStatCd != null and sParReqStatCd != ""'>
                        AND A.PAR_REQ_STAT_CD = #{sParReqStatCd}
                    </if>

                    <if test='sRoDocNo != null and sRoDocNo != ""'>
                        AND A.RO_DOC_NO LIKE '%'||#{sRoDocNo}||'%'
                    </if>

                    <if test='sRoLineNo != null and sRoLineNo != 0'>
                        AND A.RO_LINE_NO = #{sRoLineNo}
                    </if>

                    <if test='sResvDocNo != null and sResvDocNo != ""'>
                        AND A.RESV_DOC_NO = #{sResvDocNo}
                    </if>

                    <if test='sResvDocLineNo != null and sResvDocLineNo != 0'>
                        AND A.RESV_DOC_LINE_NO = #{sResvDocLineNo}
                    </if>

                    <if test='sParGiTp != null and sParGiTp != ""'>
                        AND A.PAR_GI_TP LIKE '%'||#{sParGiTp}||'%'
                    </if>

                    <if test='sItemCd != null and sItemCd != ""'>
                        AND A.ITEM_CD LIKE '%'||#{sItemCd}||'%'
                    </if>

                    <if test='sItemCdOnly != null and sItemCdOnly != ""'>
                        AND A.ITEM_CD = #{sItemCdOnly}
                    </if>

                    <if test='sCancYn != null and sCancYn != ""'>
                        AND A.CANC_YN = #{sCancYn}
                    </if>

                    <if test='sEtcGiTp != null and sEtcGiTp != ""'>
                        AND A.ETC_GI_TP = #{sEtcGiTp}
                    </if>

                    <if test='sReadyDocNo != null and sReadyDocNo != ""'>
                        AND A.READY_DOC_NO LIKE '%'||#{sReadyDocNo}||'%'
                    </if>

                    <if test='sReadyStatCd != null and sReadyStatCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE01")'>
                                 AND A.READY_STAT_CD IN ('01','02','04')
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sReadyStatCd,"RE02")'>
                                 AND A.READY_STAT_CD IN ('02','03','05')
                            </when>
                            <otherwise>
                                 AND A.READY_STAT_CD = #{sReadyStatCd}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReqStartDt != null'>
                        <choose>
                            <otherwise>
                                 AND A.REG_DT <![CDATA[>=]]> #{sReqStartDt}
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sReqEndDt != null'>
                        <choose>
                            <otherwise>
                                 AND A.REG_DT <![CDATA[<=]]> #{sReqEndDt} + 1
                            </otherwise>
                        </choose>
                    </if>

                    <if test='sVinNo != null and sVinNo != ""'>
                        AND H.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>

                    <if test='sCarNo != null and sCarNo != ""'>
                        AND H.CAR_NO LIKE '%'||#{sCarNo}||'%'
                    </if>

                    <if test='sCustNm != null and sCustNm != ""'>
                        AND H.CUST_NM LIKE '%'||#{sCustNm}||'%'
                    </if>

                    <if test='sBorrowStatCd != null and sBorrowStatCd != ""'>
                        <choose>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_01")'>
                                AND (A.BORROW_STAT_CD = '01' OR A.BORROW_DOC_NO IS NULL )
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_02")'>
                                AND (A.BORROW_STAT_CD IN ('05','04') OR A.BORROW_DOC_NO IS NULL OR A.READY_STAT_CD = '06' )
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_03")'>
                                AND A.BORROW_STAT_CD in ('02')
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_04")'>
                                AND A.BORROW_DOC_NO IS NOT NULL
                            </when>
                            <when test='@org.apache.commons.lang3.StringUtils@contains(sBorrowStatCd,"BORROW_STAT_05")'>
                                AND A.BORROW_STAT_CD in ('04','05')<!-- 정비차용확정, 차용대기 -->
                            </when>
                            <otherwise>
                                AND A.BORROW_STAT_CD = #{sBorrowStatCd}
                            </otherwise>
                        </choose>
                    </if>

                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "parReqDocNo"'>A.PAR_REQ_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "parReqDocLineNo"'>A.PAR_REQ_DOC_LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "parReqStatCd"'>A.PAR_REQ_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "cancYn"'>A.CANC_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "parGiTp"'>A.PAR_GI_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "resvDocNo"'>A.RESV_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "resvDocLineNo"'>A.RESV_DOC_LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roDocNo"'>A.RO_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "roLineNo"'>A.RO_LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "itemCd"'>A.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "itemNm"'>B.ITEM_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "giStrgeCd"'>A.GI_STRGE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "reqQty"'>A.REQ_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "endQty"'>A.END_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "reqStrgeCd"'>A.REQ_STRGE_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "unitCd"'>A.UNIT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "custCd"'>A.CUST_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "custNm"'>A.CUST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "vinNo"'>A.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "carNo"'>A.CAR_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "avlbStockQty"'>AVLB_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "resvStockQty"'>RESV_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "clamStockQty"'>CLAM_STOCK_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "grScheQty"'>GR_SCHE_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "giScheQty"'>GI_SCHE_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "resvQty"'>RESV_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "purcReqDt"'>PURC_REQ_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "giDocNo"'>GI_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "giDocTp"'>GI_DOC_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "giDocStatCd"'>GI_DOC_STAT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                    A.DLR_CD ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        A.DLR_CD, A.PAR_REQ_DOC_NO DESC, A.RO_DOC_NO, A.RO_LINE_NO ASC ,A.PAR_REQ_DOC_LINE_NO ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 정비수령 부품그룹별 부품요청상세 정보 목록을 조회한다. -->
    <select id="selectIssueReqItemsGroupDetailsByCondition" parameterType="IssueReqSearchVO" resultType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqItemsGroupDetailsByCondition] */

        SELECT
            A.ITEM_CD
            ,SUM(A.END_QTY) AS END_QTY
            ,A.PAR_REQ_STAT_CD
            ,MIN(A.ITEM_PRC) AS ITEM_PRC
        FROM PT_0502T A
        WHERE A.DLR_CD = #{sDlrCd}
        AND A.RO_DOC_NO = #{sRoDocNo}
        AND A.PAR_REQ_STAT_CD IN ('01')
        GROUP BY A.ITEM_CD, A.PAR_REQ_STAT_CD

    </select>

    <!-- 정비수령 부품별 부품요청상세 완료수량 정보 목록을 조회한다. -->
    <select id="selectIssueReqItemsGroupEndQtyDetailsByCondition" parameterType="IssueReqSearchVO" resultType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqItemsGroupEndQtyDetailsByCondition] */

        SELECT
            T1.ITEM_CD
            ,(
                SELECT NVL(SUM(A.REQ_QTY),0) FROM PT_0502T A
                WHERE A.DLR_CD = #{sDlrCd}
                AND A.RO_DOC_NO = #{sRoDocNo}
                AND A.PAR_REQ_STAT_CD IN ('01')
                AND A.ITEM_CD = T1.ITEM_CD
            ) AS REQ_QTY
            ,(
                SELECT NVL(SUM(A.END_QTY),0) FROM PT_0502T A
                WHERE A.DLR_CD = #{sDlrCd}
                AND A.RO_DOC_NO = #{sRoDocNo}
                AND A.PAR_REQ_STAT_CD IN ('02','03')
                AND A.ITEM_CD = T1.ITEM_CD
            ) AS CAL_END_QTY
            ,T1.END_QTY
            ,T1.ITEM_PRC
            ,T1.MOVING_AVG_PRC
            ,ROUND(T1.ITEM_PRC, 2) - ROUND(T1.ITEM_PRC / ( 1 + FN_GET_VAT(null,'ALL')), 2) AS TAX_PRC
            ,(
                SELECT NVL(SUM(A.ITEM_AMT),0) FROM PT_0502T A
                WHERE A.DLR_CD = #{sDlrCd}
                AND A.RO_DOC_NO = #{sRoDocNo}
                AND A.ITEM_CD = T1.ITEM_CD
            ) AS ITEM_AMT
            ,(ROUND(T1.ITEM_PRC * T1.END_QTY, 2) - (ROUND(T1.ITEM_PRC / ( 1 + FN_GET_VAT(null,'ALL')), 2) * T1.END_QTY )) AS TAX_AMT
            ,(
                SELECT NVL(MAX(B.BMP_PURC_PRC),0) FROM PT_0502T A
                LEFT JOIN PT_0214T B ON A.REQ_STRGE_CD = B.STRGE_CD AND A.ITEM_CD = B.ITEM_CD
                WHERE A.DLR_CD = #{sDlrCd}
                AND A.RO_DOC_NO = #{sRoDocNo}
                AND A.ITEM_CD = T1.ITEM_CD
            ) AS BMP_PURC_PRC
        FROM(
            SELECT
                TA.RNUM
                ,TA.ITEM_CD
                ,(SELECT
                    SUM(TB.END_QTY) AS END_QTY
                  FROM PT_0502T TB
                  WHERE TB.DLR_CD = #{sDlrCd}
                  AND TB.ITEM_CD = TA.ITEM_CD
                  AND TB.RO_DOC_NO = #{sRoDocNo}
                  AND TB.RO_TP = #{sRoTp}
                  AND TB.PAR_REQ_STAT_CD IN ('01','02','03')
                  AND TB.PAR_GI_TP = 'RO'
                  AND (TB.BORROW_DOC_NO IS NULL OR TB.BORROW_STAT_CD = '04' OR TB.BORROW_STAT_CD = '05')
                  GROUP BY TB.ITEM_CD
                ) AS END_QTY
                ,TA.ITEM_PRC
                ,TA.MOVING_AVG_PRC
                ,TA.ITEM_AMT
            FROM(
                SELECT
                    ROW_NUMBER() OVER(PARTITION BY A.ITEM_CD ORDER BY A.PAR_REQ_DOC_LINE_NO DESC) RNUM
                    ,A.ITEM_CD
                    ,NVL(A.ITEM_PRC, 0) AS ITEM_PRC
                    ,NVL(A.MOVING_AVG_PRC, 0) AS MOVING_AVG_PRC
                    ,A.ITEM_AMT
                FROM PT_0502T A
                WHERE A.DLR_CD = #{sDlrCd}
                AND A.RO_DOC_NO = #{sRoDocNo}
                AND A.RO_TP = #{sRoTp}
                AND A.PAR_REQ_STAT_CD IN ('01','02','03')
                AND A.PAR_GI_TP = 'RO'
                AND (A.BORROW_DOC_NO IS NULL OR A.BORROW_STAT_CD = '04' OR A.BORROW_STAT_CD = '05')<!-- 정비차용확정,정비차용대기 포함 -->
            ) TA
            WHERE TA.RNUM = 1
        )T1

    </select>

    <!-- 정비수령 부품그룹별 부품요청상세 정보 목록을 조회한다. -->
    <select id="selectIssueReqItemsGroupDetailsByConditionCnt" parameterType="IssueReqSearchVO" resultType="int">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqItemsGroupDetailsByConditionCnt] */
        SELECT
            count(0)
        FROM PT_0502T A
        WHERE A.DLR_CD = #{sDlrCd}
        AND A.PAR_REQ_DOC_NO  = #{sParReqDocNo}
        AND A.RO_DOC_NO = #{sRoDocNo}
        AND A.ITEM_CD = #{sItemCd}
        AND A.PAR_REQ_STAT_CD IN ('01')
    </select>

    <!-- 정비수령 부품요청상세 완료수량 소계정보를 조회한다. -->
    <select id="selectIssueReqItemsEndQtySumDetailsByCondition" parameterType="IssueReqSearchVO" resultType="IssueReqRoItemDelVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqItemsEndQtySumDetailsByCondition] */
        SELECT
            RO_DOC_NO
            ,ITEM_CD
            ,SUM(END_QTY) AS END_QTY
        FROM PT_0502T
        WHERE DLR_CD = #{sDlrCd}
        AND RO_DOC_NO = #{sRoDocNo}
        <!-- AND PAR_REQ_STAT_CD IN ('01','02','03') -->
        GROUP BY RO_DOC_NO, ITEM_CD
        HAVING SUM(END_QTY) <![CDATA[<=]]> 0
    </select>

    <!-- 삭제 할 부품별 정비수령 부품요청상세 완료수량 소계정보를 조회한다. -->
    <select id="selectIssueReqItemsEndQtySumDetailsRoByCondition" parameterType="IssueReqSearchVO" resultType="IssueReqRoItemDelVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqItemsEndQtySumDetailsRoByCondition] */
        SELECT
            A.DOC_NO AS RO_DOC_NO
            ,A.ITEM_CD
            ,NVL(SUM(B.END_QTY),0) AS END_QTY
        FROM SE_0160T A
        LEFT JOIN PT_0502T B ON A.DOC_NO = B.RO_DOC_NO AND A.LINE_NO = B.RO_LINE_NO
        WHERE A.DLR_CD = #{sDlrCd}
        AND A.DOC_NO = #{sRoDocNo}
        GROUP BY A.DOC_NO, A.ITEM_CD
    </select>

    <!-- 정비수령 부품요청상세 완료/반품 계산 수량정보를 조회.
                 수정 전: [내용] 동일 RO + 동일 RO LINE_NO + 동일 부품인 경우 헤더 상태가 반품으로 표시되는 상황으로 인하여 수정.
     -->
    <select id="selectIssueReqDetailMaxEndQty" parameterType="IssueReqSearchVO" resultType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqDetailMaxEndQty] */
        SELECT
            (SUM(T1.END_QTY) + SUM(T1.RETRUN_PART_QTY)) AS END_QTY
        FROM
        (
            SELECT
                A.PAR_REQ_DOC_NO
                ,A.PAR_REQ_STAT_CD
                ,A.ITEM_CD
                ,A.END_QTY
                ,(
                    SELECT
                        NVL(SUM(AA.END_QTY),0) AS RETURN_PARTS_QTY
                    FROM PT_0502T AA
                    WHERE AA.DLR_CD = A.DLR_CD
                    AND AA.PAR_REQ_DOC_NO = A.PAR_REQ_DOC_NO
                    AND AA.PAR_REQ_DOC_STOCK_LINE_NO = A.PAR_REQ_DOC_LINE_NO
                    AND AA.RO_DOC_NO = A.RO_DOC_NO
                    AND AA.RO_LINE_NO = A.RO_LINE_NO
                    AND AA.ITEM_CD = A.ITEM_CD
                    AND AA.PAR_REQ_STAT_CD = '03'
                )AS RETRUN_PART_QTY
                ,A.RO_DOC_NO
                ,A.RO_LINE_NO
            FROM PT_0502T A
            WHERE A.DLR_CD = #{sDlrCd}
            AND A.PAR_REQ_DOC_NO = #{sParReqDocNo}
            <if test='sParReqDocLineNo != null and sParReqDocLineNo != 0'>
                AND A.PAR_REQ_DOC_LINE_NO = #{sParReqDocLineNo}
            </if>
            AND A.PAR_REQ_STAT_CD = '02'
            ORDER BY  A.RO_LINE_NO ASC
        ) T1
        GROUP BY T1.PAR_REQ_DOC_NO

    </select>

    <!-- 부품요청상세 가격체크 리스트를 조회한다. -->
    <select id="selectIssueReqDetailItemPriceCheckList" parameterType="IssueReqSearchVO" resultType="IssueReqDetailVO">
        /* [chn.bhmc.dms.par.ism.service.dao.IssueReqDetailDAO.selectIssueReqDetailItemPriceCheckList] */

        SELECT
            T1.DLR_CD
            ,T1.ITEM_CD
            ,T1.REQ_STRGE_CD
            ,T1.ITEM_PRC
            ,T1.PAR_REQ_DOC_NO
            ,T1.PAR_REQ_STAT_CD
            ,NVL(T1.END_QTY, 0) AS END_QTY
        FROM PT_0502T T1
        WHERE T1.PAR_REQ_DOC_NO = #{sParReqDoceNo}
        AND T1.PAR_REQ_STAT_CD != '01'
        AND T1.ITEM_CD = #{sItemCd}
        AND T1.REQ_STRGE_CD = #{sReqStrgeCd}

    </select>


</mapper>