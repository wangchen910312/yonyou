<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : PackageManageDAO_SqlMap.xml
    Description : Package 마스터에 관한 데이터처리
    author Yin Xueyuan
    since 2016. 2. 17.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 2. 27.  Yin Xueyuan      최초 생성
-->

<mapper namespace="chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO">

    <!-- Package 헤더 등록-->
    <insert id="insertPackageMaster" parameterType="PackageMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.insertPackageMaster] */
        INSERT INTO PT_0230T
        (
             DLR_CD
            ,PKG_DOC_NO
            ,PKG_ITEM_CD
            ,PKG_ITEM_NM
            ,LTS_MODEL_CD
            ,BRAND_CD
            ,PKG_START_DT
            ,PKG_END_DT
            ,REG_USR_ID
            ,REG_DT
            ,PKG_TP
        )
        VALUES
        (
            #{dlrCd}
            ,#{pkgDocNo}
            ,#{pkgItemCd}
            ,#{pkgItemNm}
            ,#{ltsModelCd}
            ,#{brandCd}
            ,#{pkgStartDt}
            ,#{pkgEndDt}
            ,#{regUsrId}
            ,SYSDATE
            ,#{pkgTp}
        )
    </insert>

    <!-- Package 헤더 수정 -->
    <update id="updatePackageMaster" parameterType="PackageMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.updatePackageMaster] */
        UPDATE PT_0230T
        SET
            BRAND_CD = #{brandCd}
            ,PKG_START_DT = #{pkgStartDt}
            ,PKG_END_DT = #{pkgEndDt}
            ,UPDT_USR_ID = #{updtUsrId}
            ,UPDT_DT = SYSDATE
        WHERE 1 = 1
        AND DLR_CD = #{dlrCd}
        AND PKG_DOC_NO = #{pkgDocNo}
    </update>

    <!-- Package 공임 등록-->
    <insert id="insertPackageLts" parameterType="PackageLtsVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.insertPackageLts] */
        INSERT INTO PT_0232T
        (
            DLR_CD
            ,PKG_ITEM_CD
            ,LINE_NO
            ,PKG_DOC_NO
            ,LBR_CD
            ,LBR_NM
            ,LBR_QTY
            ,LBR_HM
            ,LBR_PRC_TP
            ,LBR_PRC
            ,LBR_AMT
            ,REG_USR_ID
            ,REG_DT
            ,DSTIN_CD
        )
        VALUES
        (
            #{dlrCd}
            ,#{pkgItemCd}
            ,(
                SELECT
                    NVL(MAX(LINE_NO),0)+1
                FROM PT_0232T
                WHERE DLR_CD = #{dlrCd}
                AND PKG_ITEM_CD = #{pkgItemCd}
                AND PKG_DOC_NO = #{pkgDocNo}
            )
            ,#{pkgDocNo}
            ,#{lbrCd}
            ,#{lbrNm}
            ,#{lbrQty}
            ,#{lbrHm}
            ,#{lbrTp}
            ,#{lbrPrc}
            ,#{lbrAmt}
            ,#{regUsrId}
            ,SYSDATE
            ,#{dstinCd}
        )
    </insert>

    <!-- Package 부품 등록-->
    <insert id="insertPackagePar" parameterType="PackageParVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.insertPackagePar] */
        INSERT INTO PT_0231T
        (
            DLR_CD
            ,PKG_ITEM_CD
            ,LINE_NO
            ,PKG_DOC_NO
            ,ITEM_CD
            ,ITEM_NM
            ,ITEM_QTY
            ,ITEM_SALE_PRC
            ,ITEM_UNIT_CD
            ,ITEM_PRC
            ,ITEM_AMT
            ,PKG_DETL_DC_RATE
            ,PKG_DETL_DC_PRC
            ,USE_YN
            ,STRGE_CD
            ,REG_USR_ID
            ,REG_DT
        )
        VALUES
        (
            #{dlrCd}
            ,#{pkgItemCd}
            ,(
                SELECT
                    NVL(MAX(LINE_NO),0)+1
                FROM PT_0231T
                WHERE DLR_CD = #{dlrCd}
                AND PKG_ITEM_CD = #{pkgItemCd}
                AND PKG_DOC_NO = #{pkgDocNo}
            )
            ,#{pkgDocNo}
            ,#{itemCd}
            ,#{itemNm}
            ,#{itemQty}
            ,#{itemSalePrc}
            ,#{itemUnitCd}
            ,#{itemPrc}
            ,#{itemAmt}
            ,#{pkgDetlDcRate}
            ,#{pkgDetlDcPrc}
            ,'Y'
            ,#{strgeCd}
            ,#{regUsrId}
            ,SYSDATE
        )
    </insert>


    <!-- Package 공임 수정 -->
    <update id="updatePackageLts" parameterType="PackageLtsVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.updatePackageLts] */
        UPDATE PT_0232T
        SET
             LBR_QTY = #{lbrQty}
            ,LBR_HM = #{lbrHm}
            ,LBR_PRC_TP = #{lbrTp}
            ,LBR_PRC = #{lbrPrc}
            ,LBR_AMT = #{lbrAmt}
            ,UPDT_USR_ID = #{updtUsrId}
            ,PKG_ITEM_CD = #{pkgItemCd}
            ,UPDT_DT = SYSDATE
            ,DSTIN_CD = #{dstinCd}
        WHERE 1 = 1
        AND DLR_CD = #{dlrCd}
        AND PKG_ITEM_CD = #{pkgItemCd}
        AND LINE_NO = #{lineNo}
        AND PKG_DOC_NO = #{pkgDocNo}
    </update>


    <!-- Package 부품 수정 -->
    <update id="updatePackagePar" parameterType="PackageParVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.updatePackagePar] */
        UPDATE PT_0231T
        SET
            ITEM_QTY = #{itemQty}
            ,ITEM_UNIT_CD = #{itemUnitCd}
            ,ITEM_PRC = #{itemPrc}
            ,ITEM_AMT = #{itemAmt}
            ,PKG_DETL_DC_RATE = #{pkgDetlDcRate}
            ,PKG_DETL_DC_PRC = #{pkgDetlDcPrc}
            ,USE_YN = NVL(#{useYn},'Y')
            ,UPDT_USR_ID = #{updtUsrId}
            ,UPDT_DT = SYSDATE
        WHERE 1 = 1
        <if test='pkgItemCd != null and pkgItemCd != ""'>
        AND PKG_ITEM_CD = #{pkgItemCd}
        </if>
        <if test='lineNo != null'>
        AND LINE_NO = #{lineNo}
        </if>
        <if test='pkgDocNo != null and pkgDocNo != ""'>
        AND PKG_DOC_NO = #{pkgDocNo}
        </if>
        <if test='dlrCd != null and dlrCd != ""'>
        AND DLR_CD = #{dlrCd}
        </if>
    </update>

    <!-- Package 삭제 -->
    <delete id="deletePackages" parameterType="PackageMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.deletePackage] */

        DELETE FROM PT_0230T
        WHERE 1 = 1
        <if test='dlrCd !=null and dlrCd != "" ' >
        AND DLR_CD = #{dlrCd}
        </if>
        <if test='pkgItemCd !=null and pkgItemCd != "" ' >
        AND PKG_ITEM_CD = #{pkgItemCd}
        </if>
        <if test='pkgDocNo !=null and pkgDocNo != "" ' >
        AND PKG_DOC_NO = #{pkgDocNo}
        </if>

    </delete>

    <!-- Package  공임 삭제 -->
    <delete id="deletePackageLts" parameterType="PackageLtsVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.deletePackageLts] */
        DELETE FROM PT_0232T
        WHERE 1 = 1
        <if test='dlrCd !=null and dlrCd != "" ' >
        AND DLR_CD = #{dlrCd}
        </if>
        <if test='pkgItemCd !=null and pkgItemCd != "" ' >
        AND PKG_ITEM_CD = #{pkgItemCd}
        </if>
        <if test='lineNo !=null and lineNo != "" ' >
        AND LINE_NO = #{lineNo}
        </if>
        <if test='pkgDocNo !=null and pkgDocNo != "" ' >
        AND PKG_DOC_NO = #{pkgDocNo}
        </if>

    </delete>

    <!-- Package  부품 삭제 -->
    <delete id="deletePackagePar" parameterType="PackageParVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.deletePackagePar] */
        DELETE FROM PT_0231T
        WHERE 1 = 1
        <if test='dlrCd != null and dlrCd !=""'>
        AND DLR_CD = #{dlrCd}
        </if>
        <if test='pkgItemCd != null and pkgItemCd != ""'>
        AND PKG_ITEM_CD = #{pkgItemCd}
        </if>
        <if test='lineNo != null and lineNo != ""'>
        AND LINE_NO = #{lineNo}
        </if>
        <if test='pkgDocNo != null and pkgDocNo != ""'>
        AND PKG_DOC_NO = #{pkgDocNo}
        </if>
    </delete>

    <!-- Package 헤더 수정 -->
    <update id="updatePackageMasterUpdtDt" parameterType="PackageMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.updatePackageMasterUpdtDt] */
        UPDATE PT_0230T
        SET  UPDT_USR_ID = #{regUsrId}
            ,UPDT_DT = SYSDATE
        WHERE DLR_CD       = #{dlrCd}
          AND PKG_ITEM_CD  = #{pkgItemCd}    --패키지번호
          AND PKG_DOC_NO   = #{pkgDocNo}
    </update>

    <select id="selectPakDocNoByKey" parameterType="PackageMasterSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.selectPakDocNoByKey] */
        SELECT
            NVL(MAX(PKG_DOC_NO),0) +1 AS VALUE
        FROM PT_0230T
        WHERE DLR_CD = #{sDlrCd}
        AND PKG_ITEM_CD = #{sPkgItemCd}
        <if test='sLtsModelCd != null and sLtsModelCd != ""'>
        AND LTS_MODEL_CD = #{sLtsModelCd}
        </if>
    </select>

    <!-- Package 헤더 리스트 -->
    <select id="selectPackageMasterByCondition" parameterType="PackageMasterSearchVO" resultType="PackageMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.selectPackageMasterByCondition] */

        SELECT
            T2.*
            ,(T2.ITEM_TOT_AMT + T2.LBR_TOT_AMT) AS TOT_AMT
        FROM (
            SELECT
                ROWNUM AS RNUM ,T1.*
                ,NVL((
                 SELECT SUM(ITEM_AMT)
                   FROM PT_0231T A
                  WHERE A.DLR_CD      = T1.DLR_CD
                    AND A.PKG_ITEM_CD = T1.PKG_ITEM_CD
                    AND A.PKG_DOC_NO  = T1.PKG_DOC_NO
                ),0)AS ITEM_TOT_AMT
                ,NVL((
                 SELECT SUM(LBR_AMT)
                   FROM PT_0232T A
                  WHERE A.DLR_CD      = T1.DLR_CD
                    AND A.PKG_ITEM_CD = T1.PKG_ITEM_CD
                    AND A.PKG_DOC_NO  = T1.PKG_DOC_NO
                ),0) AS LBR_TOT_AMT
            FROM (
                SELECT E.*
                      ,ROW_NUMBER() OVER(PARTITION BY E.DLR_CD , E.PKG_DOC_NO , E.LTS_MODEL_CD ,E.PKG_ITEM_CD ORDER BY E.PKG_DOC_NO , E.LTS_MODEL_CD ,E.PKG_ITEM_CD ) AS RN
                FROM (
                        SELECT
                            A.*
                        FROM(
                            SELECT
                                 A.DLR_CD
                                ,A.PKG_DOC_NO
                                ,A.BRAND_CD
                                ,NVL(A.LTS_MODEL_CD,'-') AS LTS_MODEL_CD
                                ,A.PKG_ITEM_CD
                                ,A.PKG_ITEM_NM
                                ,A.PKG_START_DT
                                ,A.PKG_END_DT
                            FROM PT_0230T A
                                 INNER JOIN PT_0201T B
                                    ON A.DLR_CD      = B.DLR_CD
                                   AND A.PKG_ITEM_CD = B.ITEM_CD
                            WHERE A.DLR_CD = #{sDlrCd}
                            <if test='sItemDstinCd != null and sItemDstinCd != ""'>
                            AND B.ITEM_DSTIN_CD = #{sItemDstinCd}
                            </if>
                            <if test='sPkgItemCd != null and sPkgItemCd != ""'>
                            AND A.PKG_ITEM_CD LIKE '%${sPkgItemCd}%'
                            </if>
                            <if test='sPkgItemNm != null and sPkgItemNm != ""'>
                            AND A.PKG_ITEM_NM LIKE '%${sPkgItemNm}%'
                            </if>
                            <if test='sLtsModelCd != null and sLtsModelCd != ""'>
                            AND (A.LTS_MODEL_CD =  #{sLtsModelCd} OR  A.LTS_MODEL_CD ='ALL')
                            </if>
                            <if test='sBrandCd != null and sBrandCd != ""'>
                            AND A.BRAND_CD =  #{sBrandCd}
                            </if>
                            <if test='sPkgTp != null and sPkgTp != ""'>
                            AND A.PKG_TP = #{sPkgTp}
                            </if>
                            AND B.END_YN != 'Y'
                        ) A
                        LEFT OUTER JOIN PT_0231T B ON A.DLR_CD = B.DLR_CD AND A.PKG_ITEM_CD = B.PKG_ITEM_CD AND A.PKG_DOC_NO = B.PKG_DOC_NO
                        LEFT OUTER JOIN PT_0232T C ON A.DLR_CD = C.DLR_CD AND A.PKG_ITEM_CD = C.PKG_ITEM_CD AND A.PKG_DOC_NO  = C.PKG_DOC_NO
                    <where>
                        <if test=' sLbrCd != null and sLbrCd != "" '>
                        AND C.LBR_CD LIKE '%'|| #{sLbrCd}||'%'
                        </if>
                        <if test=' sLbrNm != null and sLbrNm != "" '>
                        AND C.LBR_NM LIKE '%'||#{sLbrNm}||'%'
                        </if>
                        <if test=' sItemCd != null and sItemCd != "" '>
                        AND B.ITEM_CD LIKE '%'|| #{sItemCd}||'%'
                        </if>
                        <if test=' sItemNm != null and sItemNm != "" '>
                        AND B.ITEM_NM LIKE  '%'||#{sItemNm}||'%'
                        </if>
                    </where>
                )E
            )T1
            WHERE RN = 1
            <if test='firstIndex != -1 and lastIndex != -1'>
            AND ROWNUM <![CDATA[<=]]> #{lastIndex}
            </if>
        )T2
        <where>
        <if test='firstIndex != -1 and lastIndex != -1'>
        RNUM > #{firstIndex}
        </if>
    </where>

    </select>

    <!-- Package 헤더 목록수 -->
    <select id="selectPackageMasterByConditionCnt" parameterType="PackageMasterSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.selectPackageMasterByConditionCnt] */
        SELECT COUNT(T1.PKG_DOC_NO) AS VALUE
        FROM (
            SELECT E.*
                  ,ROW_NUMBER() OVER(PARTITION BY E.DLR_CD , E.PKG_DOC_NO , E.LTS_MODEL_CD ,E.PKG_ITEM_CD ORDER BY E.PKG_DOC_NO , E.LTS_MODEL_CD ,E.PKG_ITEM_CD ) AS RN
            FROM (
                SELECT D.*
                FROM (
                    SELECT A.*
                          ,B.ITEM_CD
                          ,B.ITEM_NM
                          ,C.LBR_CD
                          ,C.LBR_NM
                    FROM (
                          SELECT
                                A.DLR_CD
                               ,A.PKG_DOC_NO
                               ,NVL(A.LTS_MODEL_CD,'-') AS LTS_MODEL_CD
                               ,A.PKG_ITEM_CD
                               ,A.PKG_ITEM_NM
                            FROM PT_0230T A
                                 INNER JOIN PT_0201T B
                                    ON A.DLR_CD      = B.DLR_CD
                                   AND A.PKG_ITEM_CD = B.ITEM_CD
                            WHERE A.DLR_CD = #{sDlrCd}
                            <if test='sItemDstinCd != null and sItemDstinCd != ""'>
                            AND B.ITEM_DSTIN_CD = #{sItemDstinCd}
                            </if>
                            <if test='sPkgItemCd != null and sPkgItemCd != ""'>
                            AND A.PKG_ITEM_CD LIKE '%${sPkgItemCd}%'
                            </if>
                            <if test='sPkgItemNm != null and sPkgItemNm != ""'>
                            AND A.PKG_ITEM_NM LIKE '%${sPkgItemNm}%'
                            </if>
                            <if test='sLtsModelCd != null and sLtsModelCd != ""'>
                            AND (A.LTS_MODEL_CD =  #{sLtsModelCd} OR  A.LTS_MODEL_CD ='ALL')
                            </if>
                            <if test='sBrandCd != null and sBrandCd != ""'>
                            AND A.BRAND_CD =  #{sBrandCd}
                            </if>
                            <if test='sPkgTp != null and sPkgTp != ""'>
                            AND A.PKG_TP = #{sPkgTp}
                            </if>
                            AND B.END_YN != 'Y'
                    ) A
                    LEFT OUTER JOIN PT_0231T B
                     ON A.DLR_CD      = B.DLR_CD
                    AND A.PKG_ITEM_CD = B.PKG_ITEM_CD
                    AND A.PKG_DOC_NO  = B.PKG_DOC_NO
                    LEFT OUTER JOIN PT_0232T C
                     ON A.DLR_CD = C.DLR_CD
                    AND A.PKG_ITEM_CD = C.PKG_ITEM_CD
                    AND A.PKG_DOC_NO  = C.PKG_DOC_NO
                <where>
                    <if test=' sLbrCd != null and sLbrCd != "" '>
                    AND C.LBR_CD = #{sLbrCd}
                    </if>
                    <if test=' sLbrNm != null and sLbrNm != "" '>
                    AND C.LBR_NM LIKE '%'||#{sLbrNm}||'%'
                    </if>
                    <if test=' sItemCd != null and sItemCd != "" '>
                    AND B.ITEM_CD = #{sItemCd}
                    </if>
                    <if test=' sItemNm != null and sItemNm != "" '>
                    AND B.ITEM_NM LIKE  '%'||#{sItemNm}||'%'
                    </if>
                </where>
                )D
            )E
        )T1
        WHERE RN = 1
    </select>

    <!-- 저장된 package 공임조회 -->
    <select id="selectPackageLtsByCondition" parameterType="PackageMasterSearchVO" resultType="PackageLtsVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.selectPackageLtsByCondition] */
        SELECT * FROM (
            SELECT
                ROWNUM AS RNUM
                ,T1.*
            FROM (
                SELECT
                    '04' AS ITEM_DSTIN_CD
                    ,A.DLR_CD
                    ,A.PKG_DOC_NO
                    ,B.PKG_ITEM_CD
                    ,B.LINE_NO
                    ,B.LBR_CD
                    ,B.LBR_NM
                    ,B.LBR_QTY
                    ,B.LBR_HM
                    ,B.LBR_PRC
                    ,B.LBR_PRC_TP AS LBR_TP
                    ,B.LBR_PRC AS LBR_RATE
                    ,B.LBR_AMT
                    ,B.DSTIN_CD
                FROM PT_0230T A , PT_0232T B
                WHERE A.DLR_CD = B.DLR_CD
                  AND A.PKG_DOC_NO = B.PKG_DOC_NO
                  AND A.PKG_ITEM_CD = B.PKG_ITEM_CD
                  <if test='sDlrCd != null and sDlrCd != ""'>
                  AND A.LTS_MODEL_CD = #{sLtsModelCd}
                  </if>
                  <if test='sDlrCd != null and sDlrCd != ""'>
                  AND B.DLR_CD = #{sDlrCd}
                  </if>
                  <if test='sPkgItemCd != null and sPkgItemCd != ""'>
                  AND B.PKG_ITEM_CD = #{sPkgItemCd}
                  </if>
                  <if test='sPkgDocNo != null and sPkgDocNo != ""'>
                  AND B.PKG_DOC_NO = #{sPkgDocNo}
                  </if>
                ORDER BY
                <choose>
                <when test='sort != null'>
                    <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                    <choose>
                        <when test='item.field == "dlrCd"'>B.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "pkgItemCd"'>B.PKG_ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "lineNo"'>B.LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "lbrCd"'>B.LBR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "lbrNm"'>B.LBR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "lbrQty"'>B.LBR_QTY <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "lbrTp"'>B.LBR_PRC_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "lbrPrc"'>B.LBR_PRC <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "lbrAmt"'>B.LBR_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <otherwise>
                        B.DLR_CD ASC ,B.PKG_ITEM_CD ASC ,B.LINE_NO ASC
                        </otherwise>
                    </choose>
                    </foreach>
                </when>
                <otherwise>
                B.DLR_CD ASC ,B.PKG_ITEM_CD ASC ,B.LINE_NO ASC
                </otherwise>
                </choose>
            ) T1
            <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
            ROWNUM <![CDATA[<=]]> #{lastIndex}
            </if>
            </where>
        )
        <where>
        <if test='firstIndex != -1 and lastIndex != -1'>
        RNUM > #{firstIndex}
        </if>
        </where>
    </select>

    <!-- 저장된 Package 공임 목록수 -->
    <select id="selectPackageLtsByConditionCnt" parameterType="PackageMasterSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.selectPackageLtsByConditionCnt] */
        SELECT
            COUNT(*) AS VALUE
        FROM PT_0230T A , PT_0232T B
        WHERE A.DLR_CD = B.DLR_CD AND A.PKG_DOC_NO = B.PKG_DOC_NO
        <if test='sDlrCd != null and sDlrCd != ""'>
        AND A.LTS_MODEL_CD = #{sLtsModelCd}
        </if>
        <if test='sDlrCd != null and sDlrCd != ""'>
        AND B.DLR_CD = #{sDlrCd}
        </if>
        <if test='sPkgItemCd != null and sPkgItemCd != ""'>
        AND B.PKG_ITEM_CD = #{sPkgItemCd}
        </if>
        <if test='sPkgDocNo != null and sPkgDocNo != ""'>
        AND B.PKG_DOC_NO = #{sPkgDocNo}
        </if>

    </select>


    <select id="selectPackageParByCondition" parameterType="PackageMasterSearchVO" resultType="PackageParVO">
         /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.selectPackageParByCondition] */
        SELECT * FROM (
            SELECT
                ROWNUM AS RNUM
                ,T1.*
            FROM(
                SELECT
                    PK.DLR_CD
                    ,PK.ITEM_CD
                    ,PK.LINE_NO
                    ,PK.PKG_DOC_NO
                    ,PK.PKG_ITEM_CD
                    ,PK.PKG_ITEM_NM
                    ,PK.ITEM_NM
                    ,PK.ITEM_PRC
                    ,PK.ITEM_AMT
                    ,PK.ITEM_SALE_PRC
                    ,PK.ITEM_QTY
                    ,PT.STOCK_UNIT_CD AS ITEM_UNIT_CD
                    ,PK.MOVING_AVG_PRC
                    ,PK.MOVING_AVG_TAX_DDCT_PRC
                    ,PK.PKG_DETL_TOT_AMT
                    ,PK.PKG_DETL_DC_RATE
                    ,PK.PKG_DETL_DC_TOT_AMT
                    ,PK.PKG_DETL_DC_AMT
                    ,PK.USE_YN
                    ,PK.TOT_STOCK_QTY
                    ,PK.STRGE_STOCK_QTY
                    ,PK.AVLB_STOCK_QTY
                    ,PK.RESV_STOCK_QTY
                    ,PK.BORROW_QTY
                    ,PK.RENT_QTY
                    ,PK.GR_SCHE_QTY
                    ,PK.GI_SCHE_QTY
                    ,PT.ABC_IND
                    ,PT.CARLINE_CD
                    ,PT.PURC_LEAD_HM
                    ,NVL(PT.GR_STRGE_CD ,' ') AS GR_STRGE_CD
                    ,NVL(PK.STRGE_CD , ' ') AS GI_STRGE_CD
                    ,PK.STRGE_CD
                    ,NVL(PK.LOC_CD , ' ') AS GI_LOC_CD
                    ,NVL(PK.LOC_NM , ' ') AS GI_LOC_NM
                    ,(
                     SELECT STRGE_NM
                       FROM CM_0104T D
                      WHERE D.DLR_CD   = PK.DLR_CD
                        AND D.STRGE_CD = PK.STRGE_CD
                     ) AS STRGE_NM
                    ,PK.LTS_MODEL_CD
                    ,PK.STRGE_CD
                    ,PK.RETL_PRC
                    ,PK.WHSL_PRC
                    ,PK.INC_PRC
                    ,PK.GRTE_PRC
                    ,PT.SPYR_CD
                    ,PK.TAX_DDCT_GRTE_PRC
                    ,PK.MARK_UP
                FROM PT_0201T PT ,
                (
                    SELECT
                        A.DLR_CD
                        ,A.PKG_ITEM_CD
                        ,A.PKG_ITEM_NM
                        ,A.LTS_MODEL_CD
                        ,B.ITEM_CD
                        ,B.LINE_NO
                        ,B.PKG_DOC_NO
                        ,B.ITEM_NM
                        ,B.ITEM_PRC
                        ,B.ITEM_SALE_PRC
                        ,B.ITEM_AMT
                        ,B.ITEM_QTY
                        ,NVL(NVL(J.MOVING_AVG_PRC, C.MOVING_AVG_PRC),0) AS MOVING_AVG_PRC
                        ,NVL(NVL(J.MOVING_AVG_TAX_DDCT_PRC, 0),0) AS MOVING_AVG_TAX_DDCT_PRC
                        ,NVL((B.ITEM_PRC * B.ITEM_QTY),0) AS PKG_DETL_TOT_AMT
                        ,B.PKG_DETL_DC_RATE
                        ,NVL((B.ITEM_PRC * B.ITEM_QTY) - (B.ITEM_QTY * (B.ITEM_PRC * (NVL(B.PKG_DETL_DC_RATE,0)/ 100))),0) AS PKG_DETL_DC_TOT_AMT
                        ,NVL(B.ITEM_QTY * (B.ITEM_PRC * (NVL(B.PKG_DETL_DC_RATE,0)/100)),0) AS PKG_DETL_DC_AMT
                        ,B.USE_YN
                        ,NVL(D.AVLB_STOCK_QTY,0) + NVL(D.RESV_STOCK_QTY,0) AS TOT_STOCK_QTY
                        ,NVL(D.AVLB_STOCK_QTY,0) + NVL(D.RESV_STOCK_QTY,0) - NVL(D.BORROW_QTY,0) + NVL(D.RENT_QTY,0) AS STRGE_STOCK_QTY
                        ,NVL(D.AVLB_STOCK_QTY,0) AS AVLB_STOCK_QTY
                        ,NVL(D.RESV_STOCK_QTY,0) AS RESV_STOCK_QTY
                        ,NVL(D.BORROW_QTY,0) AS BORROW_QTY
                        ,NVL(D.RENT_QTY,0) AS RENT_QTY
                        ,D.GR_SCHE_QTY
                        ,D.GI_SCHE_QTY
                        ,E.LOC_CD
                        ,E.LOC_NM
                        ,(SELECT
                             B1.STRGE_CD
                        FROM PT_0301T B1
                        INNER JOIN PT_0208T B2
                           ON B1.DLR_CD = B2.DLR_CD
                          AND B1.STRGE_CD = B2.STRGE_CD
                          AND B1.ITEM_CD = B2.ITEM_CD
                        WHERE B1.DLR_CD = A.DLR_CD
                        AND B1.ITEM_CD = B.ITEM_CD
                        AND B1.AVLB_STOCK_QTY =
                        (
                            SELECT
                                MAX(C1.AVLB_STOCK_QTY) AS AVLB_STOCK_QTY
                            FROM PT_0301T C1
                            WHERE C1.DLR_CD = A.DLR_CD
                            AND C1.ITEM_CD = B.ITEM_CD
                            GROUP BY C1.ITEM_CD
                        )
                        AND ROWNUM = 1
                         )AS STRGE_CD
                        ,K.RETL_PRC
                        ,K.WHSL_PRC
                        ,K.INC_PRC
                        ,K.GRTE_PRC
                        ,K.TAX_DDCT_GRTE_PRC
                        ,(
                            SELECT
                                TB.PTUP_DUMP AS MARK_UP
                            FROM(
                                SELECT
                                    TRIM(T1.APCP_PART_NO) AS APCP_PART_NO
                                    ,T1.APCP_APPLY_DATE
                                    ,T1.APCP_PRICE_NAT_AMT
                                FROM PT_0216I T1
                                INNER JOIN(
                                SELECT
                                    TRIM(APCP_PART_NO) AS APCP_PART_NO
                                    ,MAX(APCP_APPLY_DATE) AS APCP_APPLY_DATE
                                FROM PT_0216I
                                GROUP BY APCP_PART_NO
                                ) T2 ON T1.APCP_PART_NO = T2.APCP_PART_NO AND T1.APCP_APPLY_DATE = T2.APCP_APPLY_DATE
                            )TA LEFT JOIN (
                                SELECT
                                    TRIM(PTUP_PART_NO) AS PTUP_PART_NO
                                    ,MAX(PTUP_CDAT) AS PTUP_CDAT
                                    ,MAX(PTUP_DUMP) AS PTUP_DUMP
                                    ,'Y' AS MARKUP_USE_YN
                                FROM PT_0215I
                                GROUP BY PTUP_PART_NO
                            )TB ON TA.APCP_PART_NO = TB.PTUP_PART_NO
                            WHERE TA.APCP_PART_NO = C.ITEM_CD
                        ) AS MARK_UP
                    FROM PT_0230T A
                    INNER JOIN PT_0231T B ON A.DLR_CD = B.DLR_CD AND A.PKG_ITEM_CD = B.PKG_ITEM_CD AND A.PKG_DOC_NO  = B.PKG_DOC_NO
                    LEFT JOIN PT_0201T C ON A.DLR_CD = C.DLR_CD AND B.ITEM_CD = C.ITEM_CD
                    LEFT JOIN PT_0301T D ON A.DLR_CD = D.DLR_CD AND B.STRGE_CD = D.STRGE_CD AND C.ITEM_CD = D.ITEM_CD
                    LEFT JOIN PT_0224T E ON A.DLR_CD = E.DLR_CD AND B.STRGE_CD = E.STRGE_CD AND C.ITEM_CD = E.ITEM_CD AND E.LOC_CD != ''
                    LEFT JOIN PT_0208T J ON D.DLR_CD = J.DLR_CD AND D.STRGE_CD = J.STRGE_CD AND D.ITEM_CD = J.ITEM_CD
                    LEFT JOIN PT_0214T K ON A.DLR_CD = K.DLR_CD AND K.STRGE_CD =  (SELECT
                                                                                    T1.STRGE_CD
                                                                                FROM PT_0214T T1
                                                                                WHERE T1.DLR_CD =  B.DLR_CD
                                                                                AND T1.ITEM_CD = B.ITEM_CD
                                                                                AND ROWNUM = 1)
                        AND B.ITEM_CD = K.ITEM_CD
                    WHERE A.DLR_CD = #{sDlrCd}
                    AND B.USE_YN= 'Y'
                    <if test='sPkgItemCd !=null and sPkgItemCd != ""'>
                    AND A.PKG_ITEM_CD = #{sPkgItemCd}
                    </if>
                    <if test='sPkgDocNo !=null and sPkgDocNo != ""'>
                    AND A.PKG_DOC_NO = #{sPkgDocNo}
                    </if>
                    <if test='sLtsModelCd != null and sLtsModelCd != ""'>
                    AND A.LTS_MODEL_CD = #{sLtsModelCd}
                    </if>
                    <if test='sPkgTp != null and sPkgTp != ""'>
                        AND A.PKG_TP = #{sPkgTp}
                    </if>
                )PK
                WHERE PT.DLR_CD  = PK.DLR_CD
                AND PT.ITEM_CD = PK.ITEM_CD
                AND PT.END_YN != 'Y'
                --AND PT.GR_STRGE_CD IS NOT NULL
                --AND PT.GI_STRGE_CD IS NOT NULL
                <choose>
                    <when test='sPkgTp == 03'>  --용품
                        AND PT.ITEM_DSTIN_CD in ('20','05')
                    </when>
                    <otherwise>
                        AND PT.ITEM_DSTIN_CD in ('02','05')
                    </otherwise>
               </choose>
                ORDER BY
                <choose>
                <when test='sort != null'>
                <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                    <choose>
                    <when test='item.field == "itemCd"'>PK.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                    <when test='item.field == "itemNm"'>PK.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                    <otherwise>
                    PK.ITEM_CD ASC ,PK.ITEM_CD ASC
                    </otherwise>
                    </choose>
                </foreach>
                </when>
                <otherwise>
                PK.ITEM_CD ASC ,PK.ITEM_CD ASC
                </otherwise>
                </choose>
            ) T1
            <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                ROWNUM <![CDATA[<=]]> #{lastIndex}
            </if>
            </where>
        )
        <where>
        <if test='firstIndex != -1 and lastIndex != -1'>
            RNUM > #{firstIndex}
        </if>
        </where>
    </select>

    <!-- 품목리스트(판매단가용)를 조회한다. -->
    <select id="selectPackageParByConditionCnt" parameterType="PackageMasterSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.selectPackageParByConditionCnt] */
        SELECT
            COUNT(PK.ITEM_CD) AS VALUE
        FROM PT_0201T PT ,
        (
            SELECT
                A.DLR_CD
                ,B.ITEM_CD
            FROM PT_0230T A , PT_0231T B
            WHERE A.DLR_CD = B.DLR_CD
            AND A.PKG_ITEM_CD = B.PKG_ITEM_CD
            AND A.PKG_DOC_NO  = B.PKG_DOC_NO
            AND A.DLR_CD = #{sDlrCd}
            AND B.USE_YN = 'Y'
            <if test='sPkgItemCd !=null and sPkgItemCd != ""'>
            AND A.PKG_ITEM_CD = #{sPkgItemCd}
            </if>
            <if test='sPkgDocNo !=null and sPkgDocNo != ""'>
            AND A.PKG_DOC_NO = #{sPkgDocNo}
            </if>
            <if test='sLtsModelCd != null and sLtsModelCd != ""'>
            AND A.LTS_MODEL_CD = #{sLtsModelCd}
            </if>
            <if test='sPkgTp != null and sPkgTp != ""'>
                AND A.PKG_TP = #{sPkgTp}
            </if>
        )PK
        WHERE PT.DLR_CD = PK.DLR_CD
        AND PT.ITEM_CD = PK.ITEM_CD
        AND PT.END_YN != 'Y'
        <choose>
            <when test='sPkgTp == 03'>  <!-- 용품 -->
                AND PT.ITEM_DSTIN_CD in ('20','05')
            </when>
            <otherwise>
                AND PT.ITEM_DSTIN_CD in ('02','05')
            </otherwise>
       </choose>
    </select>

    <!-- 품목리스트(패키지 서머리용)를 조회한다. -->
    <select id="selectPackageParSummaryByCondition" parameterType="PackageMasterSearchVO" resultType="PackageParVO">
         /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.selectPackageParSummaryByCondition] */
        SELECT * FROM 
         (SELECT
            ROWNUM AS RNUM
            ,T1.*
        FROM(
            SELECT
                A.DLR_CD
                ,A.ITEM_DSTIN_CD
                ,A.SPYR_CD
                ,A.ITEM_CD
                ,A.ITEM_NM
                ,A.ITEM_CD AS PKG_ITEM_CD
                ,A.ITEM_NM AS PKG_ITEM_NM
                ,A.BRAND_CD
                ,A.LTS_MODEL_CD
                ,A.LTS_MODEL_NM
                ,A.PKG_TOT_AMT
                ,A.PKG_DC_AMT
                ,A.PKG_DC_TOT_AMT
                ,A.REG_DT
                ,A.PKG_START_DT
                ,A.PKG_END_DT
                ,A.PKG_DOC_NO
                ,A.PKG_UPDT_DT_STR
                ,A.UPDT_DT_STR
            FROM (
                    SELECT
                        A.DLR_CD
                       ,B.ITEM_DSTIN_CD
                       ,B.SPYR_CD
                       ,B.ITEM_CD
                       ,B.ITEM_NM
                       ,A.PKG_TP
                       ,CASE WHEN A.PKG_TP != '02' THEN DECODE(B.BRAND_CD,'HD','N','OT','O')
                       ELSE A.BRAND_CD
                       END AS BRAND_CD
                       ,C.PKG_TOT_AMT
                       ,C.PKG_DC_AMT
                       ,C.PKG_DC_TOT_AMT
                       ,A.LTS_MODEL_CD
                       ,D.LTS_MODEL_NM
                       ,A.REG_DT
                       ,A.PKG_DOC_NO
                       ,A.PKG_START_DT
                       ,A.PKG_END_DT
                       ,TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS PKG_UPDT_DT_STR
                       ,TO_CHAR(NVL(B.UPDT_DT,B.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
                    FROM PT_0230T A
                    INNER JOIN PT_0201T B ON A.PKG_ITEM_CD = B.ITEM_CD
                    LEFT JOIN
                    (
                        SELECT
                            A.DLR_CD
                            ,A.PKG_ITEM_CD
                            ,A.PKG_DOC_NO
                            ,SUM(NVL(A.ITEM_PRC,0) * NVL(A.ITEM_QTY,0)) AS PKG_TOT_AMT
                            ,SUM(
                                CASE WHEN NVL(A.PKG_DETL_DC_RATE,0) = 0 THEN 0
                                ELSE ROUND(NVL(A.ITEM_QTY,0) * (NVL(A.ITEM_PRC,0) * (NVL(A.PKG_DETL_DC_RATE,0) / 100)),2)
                                END
                            ) AS PKG_DC_AMT
                            ,SUM(
                                CASE WHEN NVL(A.PKG_DETL_DC_RATE,0) = 0 THEN NVL(A.ITEM_PRC,0) * NVL(A.ITEM_QTY,0)
                                ELSE ROUND((NVL(A.ITEM_PRC,0) * NVL(A.ITEM_QTY,0)) - (NVL(A.ITEM_QTY,0) * (NVL(A.ITEM_PRC,0) * (NVL(A.PKG_DETL_DC_RATE,0) / 100))),2)
                                END
                            ) AS PKG_DC_TOT_AMT
                        FROM PT_0231T A
                        WHERE A.DLR_CD = #{sDlrCd} AND A.USE_YN = 'Y'
                        GROUP BY A.DLR_CD, A.PKG_ITEM_CD,A.PKG_DOC_NO
                    )C ON A.DLR_CD = C.DLR_CD AND A.PKG_ITEM_CD = C.PKG_ITEM_CD AND A.PKG_DOC_NO = C.PKG_DOC_NO
                    LEFT OUTER JOIN (
                        SELECT
                            LTS_MODEL_CD
                            ,MAX(VALID_START_DT) AS VALID_START_DT
                            ,MAX(LTS_CHN_NM) AS LTS_MODEL_NM
                        FROM SE_1064T
                        GROUP BY LTS_MODEL_CD
                    ) D ON A.LTS_MODEL_CD = D.LTS_MODEL_CD
                    WHERE A.DLR_CD = #{sDlrCd}
                    AND B.END_YN != 'Y'
                    <if test='sItemDstinCd != null and sItemDstinCd != ""'>
                    AND B.ITEM_DSTIN_CD = #{sItemDstinCd}
                    </if>
                    <if test='sPkgItemCd != null and sPkgItemCd != ""'>
                    AND B.ITEM_CD LIKE '%'||#{sPkgItemCd}||'%'
                    </if>
                    <if test='sPkgItemNm != null and sPkgItemNm != ""'>
                    AND B.ITEM_NM LIKE '%'||#{sPkgItemNm}||'%'
                    </if>
                    <if test='sItemCd != null and sItemCd != ""'>
                    AND A.PKG_ITEM_CD IN (
                        SELECT
                            AA.PKG_ITEM_CD
                        FROM PT_0231T AA
                        WHERE AA.DLR_CD = #{sDlrCd}
                        AND AA.ITEM_CD LIKE '%'||#{sItemCd}||'%'
                        )
                    </if>
                    <if test='sItemNm != null and sItemNm != ""'>
                    AND A.PKG_ITEM_CD IN (
                        SELECT
                            AA.PKG_ITEM_CD
                        FROM PT_0231T AA
                        WHERE AA.DLR_CD = #{sDlrCd}
                        AND AA.ITEM_NM LIKE '%'||#{sItemNm}||'%'
                        )
                    </if>
                    <if test='sLtsModelCd != null and sLtsModelCd != ""'>
                    AND A.LTS_MODEL_CD = #{sLtsModelCd}
                    </if>
                    <if test='sPkgDcTotAmt != null and sPkgDcTotAmt != ""'>
                    AND C.PKG_DC_TOT_AMT <![CDATA[>=]]> #{sPkgDcTotAmt}
                    </if>
                    <if test='sPkgTp != null and sPkgTp != ""'>
                    AND A.PKG_TP = #{sPkgTp}
                    </if>
            )A
            WHERE A.DLR_CD = #{sDlrCd}
            <if test='sBrandCd != null and sBrandCd != ""'>
                AND A.BRAND_CD  = #{sBrandCd}
            </if>
            ORDER BY
            <choose>
            <when test='sort != null'>
            <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                <choose>
                <when test='item.field == "itemDstinCd"'>A.ITEM_DSTIN_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "itemCd"'>A.ITEM_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "itemNm"'>A.ITEM_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "pkgTotAmt"'>A.PKG_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "pkgDcAmt"'>A.PKG_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "pkgDcTotAmt"'>A.PKG_DC_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <otherwise>
                A.DLR_CD ASC,A.ITEM_CD ASC
                </otherwise>
                </choose>
            </foreach>
            </when>
            <otherwise>
            A.DLR_CD ASC, A.ITEM_CD ASC
            </otherwise>
            </choose>
        ) T1
        <where>
        <if test='firstIndex != -1 and lastIndex != -1'>
        ROWNUM <![CDATA[<=]]> #{lastIndex} 
        </if>
        </where>
        )
        <where>
        <if test='firstIndex != -1 and lastIndex != -1'>
        AND RNUM <![CDATA[>]]> #{firstIndex}
        </if>
        </where>
    </select>

    <!-- 품목리스트(패키지 서머리용)를 조회한다. -->
    <select id="selectPackageParSummaryByConditionCnt" parameterType="PackageMasterSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.selectPackageParSummaryByConditionCnt] */
        SELECT
            COUNT(0) VALUE
        FROM PT_0230T A
        INNER JOIN PT_0201T B ON A.PKG_ITEM_CD = B.ITEM_CD
        LEFT JOIN (
            SELECT
                 A.DLR_CD, A.PKG_ITEM_CD,A.PKG_DOC_NO
                ,SUM(NVL(A.ITEM_AMT,0)) AS PKG_DC_TOT_AMT
            FROM PT_0231T A
            WHERE A.DLR_CD = #{sDlrCd}
            GROUP BY A.DLR_CD, A.PKG_ITEM_CD,A.PKG_DOC_NO
        )C ON A.DLR_CD = C.DLR_CD AND A.PKG_ITEM_CD = C.PKG_ITEM_CD AND A.PKG_DOC_NO  = C.PKG_DOC_NO
        WHERE A.DLR_CD = #{sDlrCd}
        AND B.END_YN != 'Y'
        <if test='sItemDstinCd != null and sItemDstinCd != ""'>
            AND B.ITEM_DSTIN_CD = #{sItemDstinCd}
        </if>
        <if test='sBrandCd != null and sBrandCd != ""'>
        <choose>
            <when test='sPkgTp != "02"'>
                <choose>
                <when test='sBrandCd =="N"'>
                    AND B.BRAND_CD  = 'HD'
                </when>
                <when test='sBrandCd =="O"'>
                    AND B.BRAND_CD  = 'OT'
                </when>
                </choose>
            </when>
            <otherwise>
                AND B.BRAND_CD  = #{sBrandCd}
            </otherwise>
        </choose>

        </if>
        <if test='sPkgItemCd != null and sPkgItemCd != ""'>
        AND B.ITEM_CD LIKE '%'||#{sPkgItemCd}||'%'
        </if>
        <if test='sPkgItemNm != null and sPkgItemNm != ""'>
        AND B.ITEM_NM LIKE '%'||#{sPkgItemNm}||'%'
        </if>
        <if test='sItemCd != null and sItemCd != ""'>
        AND A.PKG_ITEM_CD IN (
            SELECT
                AA.PKG_ITEM_CD
            FROM PT_0231T AA
            WHERE AA.DLR_CD = #{sDlrCd}
            AND AA.ITEM_CD LIKE '%'||#{sItemCd}||'%'
            )
        </if>
        <if test='sItemNm != null and sItemNm != ""'>
        AND A.PKG_ITEM_CD IN (
            SELECT
                AA.PKG_ITEM_CD
            FROM PT_0231T AA
            WHERE AA.DLR_CD = #{sDlrCd}
            AND AA.ITEM_NM LIKE '%'||#{sItemNm}||'%'
            )
        </if>
        <if test='sLtsModelCd != null and sLtsModelCd != ""'>
        AND A.LTS_MODEL_CD = #{sLtsModelCd}
        </if>
        <if test='sPkgDcTotAmt != null and sPkgDcTotAmt != ""'>
        AND C.PKG_DC_TOT_AMT <![CDATA[>=]]> #{sPkgDcTotAmt}
        </if>
        <if test='sPkgTp != null and sPkgTp != ""'>
        AND A.PKG_TP = #{sPkgTp}
        </if>
    </select>

    <!-- 패키지 부품상세 카운트를 조회한다. -->
    <select id="selectPackageDetailByConditionCnt" parameterType="PackageMasterSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.selectPackageDetailByConditionCnt] */
        SELECT
            COUNT(*)
        FROM PT_0231T
        WHERE DLR_CD = #{sDlrCd}
        <if test='sPkgItemCd !=null and sPkgItemCd != ""'>
        AND PKG_ITEM_CD = #{sPkgItemCd}
        </if>
        <if test='sItemCd !=null and sItemCd != ""'>
        AND ITEM_CD = #{sItemCd}
        </if>
        <if test='sPkgDocNo !=null and sPkgDocNo != 0'>
        AND PKG_DOC_NO = #{sPkgDocNo}
        </if>
    </select>

     <!-- 기타입고 헤더 수정일자정보를 조회한다. -->
    <select id="selectPackageMasterUpdtDtByKey" parameterType="PackageMasterVO" resultType="String">
        /* [chn.bhmc.dms.ser.svi.service.dao.PackageManageDAO.selectPackageMasterUpdtDtByKey] */
        SELECT  TO_CHAR(NVL(A.UPDT_DT,A.REG_DT), 'YYYYMMDDHH24MISS') AS UPDT_DT_STR
          FROM  DMSDB.PT_0230T A    --패키지헤더정보
         WHERE  A.DLR_CD             = #{dlrCd}
           AND  A.PKG_ITEM_CD        = #{pkgItemCd}    --패키지번호
           AND  A.PKG_DOC_NO         = #{pkgDocNo}    --패키지번호
    </select>

</mapper>