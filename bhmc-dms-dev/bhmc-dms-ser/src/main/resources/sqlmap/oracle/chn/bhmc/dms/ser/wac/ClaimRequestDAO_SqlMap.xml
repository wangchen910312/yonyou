<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : ClaimRequestDAO_SqlMap.xml
    Description : 클레임 요청 에 관한 데이터처리
    author Kwon Ki Hyun
    since 2016. 02. 29.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 05. 17.  Kwon Ki Hyun     최초 생성
-->

<mapper namespace="chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO">

    <!-- 클레임등록 -->
    <insert id="insertClaimRequest" parameterType="ClaimReqVO">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.insertClaimRequest] */

        INSERT INTO SE_0710T    --클레임정보
        (
          DLR_CD                      --딜러코드
         ,CLAIM_DOC_NO                --클레임문서번호
         ,VIN_NO                      --차대번호
         ,RO_DOC_NO                   --RO문서번호
         ,CLAIM_YY                    --클레임연도
         ,RO_GRP_NO                   --RO그룹번호
         ,RO_TP                       --RO유형
         ,CLAIM_TP                    --클레임유형
         ,CLAIM_STAT_CD               --클레임상태코드
         ,CLAIM_VER_CD                --클레임버젼
         ,CAR_REG_NO                  --차량등록번호
         ,LTS_MODEL_CD                --LTS모델코드
         ,ENGIN_NO                    --엔진번호
         ,CAR_OWNER_ID                --차량소유자ID
         ,CAR_OWNER_NM                --차량소유자명
         ,RUN_DIST_VAL                --주행거리값
         ,WART_DT                     --보증일자
         ,CAR_DSTIN_CD                --차량구분코드
         ,CAU_OPER_ATC_CD             --원인작업항목코드
         ,CAU_OPER_ATC_NM             --원인작업항목명
         ,CAU_ITEM_CD                 --원인품목코드
         ,CAU_ITEM_NM                 --원인품목명
         ,CAU_CD                      --원인코드
         ,CAU_NM                      --원인명
         ,PHEN_CD                     --현상코드
         ,PHEN_NM                     --현상명
         ,RO_START_DT                 --RO시작일자
         ,RO_END_DT                   --RO종료일자
         ,CLAIM_START_DT              --클레임시작일자
         ,PWA_APPROVE_NO              --PWA승인번호
         ,CR_NO                       --캠페인리콜번호
         ,RESV_DOC_NO                 --예약문서번호
         ,SUB_AMT                     --외주금액
         ,SUB_DSTIN_CD                --외주구분코드
         ,BEF_RO_DT                   --이전RO일자
         ,BEF_RUN_DIST_VAL            --이전주행거리값
         ,BEF_RO_DOC_NO               --이전RO문서번호
         ,LBR_AMT                     --공임금액
         ,ITEM_AMT                    --부품금액
         ,SUB_LBR_AMT                 --외주공임금액
         ,SUB_ITEM_AMT                --외주부품금액
         ,TOT_AMT                     --총금액
         ,REQ_LBR_AMT                 --청구공임금액
         ,REQ_ITEM_AMT                --청구부품금액
         ,REQ_SUB_LBR_AMT             --청구외주공임금액
         ,REQ_SUB_ITEM_AMT            --청구외주부품금액
         ,REMARK                      --비고
         ,AS_PAR_WART_DSTIN_CD        --AS부품보증구분코드
         ,CLAIM_TCAV_NO               --클레임기술자문번호
         ,FILE_KEY_NM                 --파일키명
         ,BRAND_CD                    --브랜드코드
         ,DTC1_USE_YN                 --DTC1사용여부
         ,DTC2_USE_YN                 --DTC2사용여부
         ,DTC3_USE_YN                 --DTC3사용여부
         ,DTC4_USE_YN                 --DTC4사용여부
         ,DTC1_CD                     --DTC1코드
         ,DTC2_CD                     --DTC2코드
         ,DTC3_CD                     --DTC3코드
         ,DTC4_CD                     --DTC4코드
         ,REG_USR_ID                  --등록자ID
         ,REG_DT                      --등록일자
        )
        VALUES
        (
          #{dlrCd}                      --딜러코드
         ,#{claimDocNo}                 --클레임문서번호
         ,#{vinNo}                      --차대번호
         ,#{roDocNo}                    --RO문서번호
         ,TO_CHAR(SYSDATE,'YYYY')       --클레임연도
         ,#{roGrpNo}                    --RO그룹번호
         ,#{roTp}                       --RO유형
         ,#{claimTp}                    --클레임유형
         ,#{claimStatCd}                --클레임상태코드
         ,'00'                          --클레임버젼
         ,#{carRegNo}                   --차량등록번호
         ,#{ltsModelCd}                 --LTS모델코드
         ,#{enginNo}                    --엔진번호
         ,#{carOwnerId}                 --차량소유자ID
         ,#{carOwnerNm}                 --차량소유자명
         ,NVL(#{runDistVal},0)          --주행거리값
         ,#{wartDt}                     --보증일자
         ,#{carDstinCd}                 --차량구분코드
         ,#{cauOperAtcCd}               --원인작업항목코드
         ,#{cauOperAtcNm}               --원인작업항목명
         ,#{cauItemCd}                  --원인품목코드
         ,#{cauItemNm}                  --원인품목명
         ,#{cauCd}                      --원인코드
         ,#{cauNm}                      --원인명
         ,#{phenCd}                     --현상코드
         ,#{phenNm}                     --현상명
         ,#{roStartDt}                  --RO시작일자
         ,#{roEndDt}                    --RO종료일자
         ,SYSDATE                       --클레임시작일자
         ,#{pwaApproveNo}               --PWA승인번호
         ,#{crNo}                       --캠페인리콜번호
         ,#{resvDocNo}                  --예약문서번호
         ,#{subAmt}                     --외주금액
         ,#{subDstinCd}                 --외주구분코드
         ,#{befRoDt}                    --이전RO일자
         ,NVL(#{befRunDistVal},0)       --이전주행거리값
         ,#{befRoDocNo}                 --이전RO문서번호
         ,NVL(#{lbrAmt},0)              --공임금액
         ,NVL(#{itemAmt},0)             --부품금액
         ,NVL(#{subLbrAmt},0)           --외주공임금액
         ,NVL(#{subItemAmt},0)          --외주부품금액
         ,NVL(#{totAmt},0)              --총금액
         ,#{reqLbrAmt}                  --청구공임금액
         ,#{reqItemAmt}                 --청구부품금액
         ,#{reqSubLbrAmt}               --청구외주공임금액
         ,#{reqSubItemAmt}              --청구외주부품금액
         ,#{remark}                     --비고
         ,#{asParWartDstinCd}           --AS부품보증구분코드
         ,#{claimTcavNo}                --클레임기술자문번호
         ,#{fileKeyNm}                  --파일키명
         ,NVL(#{brandCd},'HD')          --브랜드코드
         ,NVL(#{dtc1UseYn},'N')         --DTC1사용여부
         ,NVL(#{dtc2UseYn},'N')         --DTC2사용여부
         ,NVL(#{dtc3UseYn},'N')         --DTC3사용여부
         ,NVL(#{dtc4UseYn},'N')         --DTC4사용여부
         ,#{dtc1Cd}                     --DTC1코드
         ,#{dtc2Cd}                     --DTC2코드
         ,#{dtc3Cd}                     --DTC3코드
         ,#{dtc4Cd}                     --DTC4코드
         ,#{regUsrId}                   --등록자ID
         ,SYSDATE                       --등록일자
        )
    </insert>

    <!-- 클레임 공임 등록 -->
    <insert id="insertClaimRequestLabour" parameterType="ClaimReqLbrVO">
    /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.insertClaimRequestLabour] */

        INSERT INTO SE_0712T    --클레임공임정보
        (
          DLR_CD                 --딜러코드
         ,CLAIM_DOC_NO           --클레임문서번호
         ,LINE_NO                --라인번호
         ,RO_DOC_NO              --RO문서번호
         ,LBR_CD                 --공임코드
         ,LBR_NM                 --공임명
         ,LBR_PRC                --공임단가
         ,LBR_HM                 --공임시간
         ,LBR_QTY                --공임수량
         ,LBR_AMT                --공임금액
         ,CR_NO                  --캠페인리콜번호
         ,CLAIM_YY               --클레임연도
         ,CAU_LBR_YN             --원인공임여부
         ,DSTIN_CD               --공임구분코드
         ,REG_USR_ID             --등록자ID
         ,REG_DT                 --등록일자
        )
        VALUES
        (
          #{dlrCd}                 --딜러코드
         ,#{claimDocNo}            --클레임문서번호
         ,(SELECT NVL(MAX(LINE_NO),0) +1
             FROM SE_0712T
            WHERE DLR_CD = #{dlrCd}
              AND CLAIM_DOC_NO = #{claimDocNo}
         )                         --라인번호
         ,#{roDocNo}               --RO문서번호
         ,#{lbrCd}                 --공임코드
         ,#{lbrNm}                 --공임명
         ,#{lbrPrc}                --공임단가
         ,#{lbrHm}                 --공임시간
         ,#{lbrQty}                --공임수량
         ,#{lbrAmt}                --공임금액
         ,#{crNo}                  --캠페인리콜번호
         ,SUBSTR(SYSDATE ,3,2)     --클레임연도
         ,#{cauLbrYn}              --원인공임여부
         ,#{dstinCd}               --공임구분코드
         ,#{regUsrId}              --등록자ID
         ,SYSDATE                  --등록일자
        )

    </insert>

    <!-- 클레임 부품 등록 -->
    <insert id="insertClaimRequestPart" parameterType="ClaimReqPartVO">
    /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.insertClaimRequestPart] */

        INSERT INTO SE_0711T    --클레임부품정보
        (
          DLR_CD                  --딜러코드
         ,CLAIM_DOC_NO            --클레임문서번호
         ,LINE_NO                 --라인번호
         ,RO_DOC_NO               --RO문서번호
         ,ITEM_CD                 --품목코드
         ,ITEM_NM                 --품목명
         ,PKG_ITEM_CD             --패키지품목코드
         ,ITEM_PRC                --품목단가
         ,ITEM_QTY                --품목수량
         ,ITEM_AMT                --품목금액
         ,SALE_UNIT_CD            --판매단위코드
         ,REQ_QTY                 --요청수량
         ,CR_NO                   --캠페인리콜번호
         ,GR_STRGE_CD             --입고창고코드
         ,GI_STRGE_CD             --출고창고코드
         ,CAU_ITEM_YN             --원인부품여부
         ,CLAIM_YY                --클레임연도
         ,NPNP_MAX_AMT            --NPN PART MAX AMT
         ,NPNP_YN                 --NPN PART YN
         ,REG_USR_ID              --등록자ID
         ,REG_DT                  --등록일자
        )
        VALUES
        (
          #{dlrCd}                    --딜러코드
         ,#{claimDocNo}               --클레임문서번호
         ,(SELECT NVL(MAX(LINE_NO),0) +1
             FROM SE_0711T
            WHERE DLR_CD = #{dlrCd}
              AND CLAIM_DOC_NO = #{claimDocNo}
         )                            --라인번호
         ,#{roDocNo}                  --RO문서번호
         ,#{itemCd}                   --품목코드
         ,#{itemNm}                   --품목명
         ,#{pkgItemCd}                --패키지품목코드
         ,#{itemPrc}                  --품목단가
         ,NVL(#{itemQty},1)           --품목수량
         ,#{itemAmt}                  --품목금액
         ,NVL(#{saleUnitCd},'EA')     --판매단위코드
         ,NVL(#{reqQty},1)            --요청수량
         ,#{crNo}                     --캠페인리콜번호
         ,#{grStrgeCd}                --입고창고코드
         ,#{giStrgeCd}                --출고창고코드
         ,#{cauItemYn}                --원인부품여부
         ,SUBSTR(SYSDATE ,3,2)        --클레임연도
         ,#{npnpMaxAmt}               --NPN PART MAX AMT
         ,#{npnpYn}                   --NPN PART YN
         ,#{regUsrId}                 --등록자ID
         ,SYSDATE                     --등록일자
        )
    </insert>

    <!-- 클레임 수정 -->
    <update id="updateClaimRequest" parameterType="ClaimReqVO">
    /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.updateClaimRequest] */
         UPDATE SE_0710T    --클레임정보
          SET

               UPDT_USR_ID          = #{updtUsrId}                  --수정자ID
              ,UPDT_DT              = sysdate                       --수정일자
              ,SUB_AMT              = #{subAmt, jdbcType=DOUBLE}    --외주금액
              ,SUB_DSTIN_CD         = #{subDstinCd}                 --외주구분코드
              <if test='claimStatCd != null and claimStatCd != "" '>
              ,CLAIM_STAT_CD        = #{claimStatCd}                --클레임상태코드
              </if>
              <if test='claimTp != null and claimTp != "" '>
              ,CLAIM_TP             = #{claimTp}                    --클레임유형
              </if>
              <if test='cauOperAtcCd != null and cauOperAtcCd != "" '>
              ,CAU_OPER_ATC_CD      = #{cauOperAtcCd}               --원인작업항목코드
              </if>
              <if test='cauOperAtcNm != null and cauOperAtcNm != "" '>
              ,CAU_OPER_ATC_NM      = #{cauOperAtcNm}               --원인작업항목명
              </if>
              <if test='cauItemCd != null and cauItemCd != "" '>
              ,CAU_ITEM_CD          = #{cauItemCd}                  --원인품목코드
              </if>
              <if test='cauItemNm != null and cauItemNm != "" '>
              ,CAU_ITEM_NM          = #{cauItemNm}                  --원인품목명
              </if>
              <if test='cauCd != null and cauCd != "" '>
              ,CAU_CD               = #{cauCd}                      --원인코드
              </if>
              <if test='cauNm != null and cauNm != "" '>
              ,CAU_NM               = #{cauNm}                      --원인명
              </if>
              <if test='phenCd != null and phenCd != "" '>
              ,PHEN_CD              = #{phenCd}                     --현상코드
              </if>
              <if test='phenNm != null and phenNm != "" '>
              ,PHEN_NM              = #{phenNm}                     --현상명
              </if>
              <if test='roStartDt != null '>
              ,RO_START_DT          = #{roStartDt}                  --RO시작일자
              </if>
              <if test='roEndDt != null '>
              ,RO_END_DT            = #{roEndDt}                    --RO종료일자
              </if>
              <choose>
                  <when test='pwaApproveNo != null and pwaApproveNo != "" '>
                      <if test='pwaApproveNoYn == "Y"'>
                      ,PWA_APPROVE_NO       = #{pwaApproveNo}          --PWA승인번호
                      </if>
                      <if test='pwaApproveNoYn == "N"'>
                      ,PWA_APPROVE_NO       = ''                       --PWA승인번호
                      </if>
                  </when>
              </choose>
              <if test='befRoDt != null '>
              ,BEF_RO_DT            = #{befRoDt}                    --이전RO일자
              </if>
              <if test='befRunDistVal != 0 '>
              ,BEF_RUN_DIST_VAL     = #{befRunDistVal}              --이전주행거리값
              </if>
              <if test='befRoDocNo != null and befRoDocNo != "" '>
              ,BEF_RO_DOC_NO        = #{befRoDocNo}                 --이전RO문서번호
              </if>
              <if test='claimStatCd != null and claimStatCd != "" '>
              ,LBR_AMT              = #{lbrAmt}                     --공임금액
              </if>
              <if test='itemAmt != 0 '>
              ,ITEM_AMT             = #{itemAmt}                     --부품금액
              </if>
              <if test='subAmt != 0'>
              ,SUB_LBR_AMT          = #{subAmt}                     --외주공임금액
              </if>
              <if test='totAmt != 0 '>
              ,TOT_AMT              = #{totAmt}                     --총금액
              </if>
              <if test='claimStatCd !=null and claimStatCd !="" '>
                <choose>
                   <when test='claimStatCd == "Q" '>
                        ,CLAIM_REQ_DT         = SYSDATE               --클레임청구일자
                        ,REQ_LBR_AMT          = #{lbrAmt}             --청구공임금액
                        ,REQ_ITEM_AMT         = #{itemAmt}            --청구부품금액
                        ,REQ_SUB_LBR_AMT      = #{subAmt}             --청구외주공임금액
                        ,CLAIM_REQ_ID         = #{claimReqId}         --클레임 요청자 ID
                        ,CLAIM_REQ_NM         = #{claimReqNm}         --클레임 요청자
                   </when>
                </choose>
              </if>
              <if test='remark != null and remark != "" '>
              ,REMARK               = #{remark}                     --비고
              </if>
              <if test='asParWartDstinCd != null and asParWartDstinCd != "" '>
              ,AS_PAR_WART_DSTIN_CD = #{asParWartDstinCd}           --AS부품보증구분코드
              </if>
              <choose>
                <when test=' claimTcavNo != null and claimTcavNo != "" '>
                    <if test='claimTcavNoYn == "Y" '>
                    ,CLAIM_TCAV_NO        = #{claimTcavNo}          --클레임기술자문번호
                    </if>
                    <if test='claimTcavNoYn == "N" '>
                    ,CLAIM_TCAV_NO        = ''                      --클레임기술자문번호
                    </if>
                </when>
              </choose>
              <if test='fileKeyNm != null and fileKeyNm != "" '>
              ,FILE_KEY_NM          = #{fileKeyNm}                  --파일키명
              </if>
              <if test='brandCd != null and brandCd != "" '>
              ,BRAND_CD             = #{brandCd}                    --브랜드코드
              </if>
              <if test='dtc1UseYn != null and dtc1UseYn != "" '>
              ,DTC1_USE_YN          = NVL(#{dtc1UseYn},'N')         --DTC1사용여부
              </if>
              <if test='dtc2UseYn != null and dtc2UseYn != "" '>
              ,DTC2_USE_YN          = NVL(#{dtc2UseYn},'N')         --DTC2사용여부
              </if>
              <if test='dtc3UseYn != null and dtc3UseYn != "" '>
              ,DTC3_USE_YN          = NVL(#{dtc3UseYn},'N')         --DTC3사용여부
              </if>
              <if test='dtc4UseYn != null and dtc4UseYn != "" '>
              ,DTC4_USE_YN          = NVL(#{dtc4UseYn},'N')         --DTC4사용여부
              </if>
              <if test='dtc1Cd != null and dtc1Cd != "" '>
              ,DTC1_CD              = #{dtc1Cd}                     --DTC1코드
              </if>
              <if test='dtc2Cd != null and dtc2Cd != "" '>
              ,DTC2_CD              = #{dtc2Cd}                     --DTC2코드
              </if>
              <if test='dtc3Cd != null and dtc3Cd != "" '>
              ,DTC3_CD              = #{dtc3Cd}                     --DTC3코드
              </if>
              <if test='dtc4Cd != null and dtc4Cd != "" '>
              ,DTC4_CD              = #{dtc4Cd}                     --DTC4코드
              </if>
         WHERE 1 = 1
           AND DLR_CD               = #{dlrCd}                      --딜러코드
           AND CLAIM_DOC_NO         = #{claimDocNo}                 --클레임문서번호
           AND VIN_NO               = #{vinNo}                      --차대번호

    </update>

    <!-- 클레임 공임 수정 -->
    <update id="updateClaimRequestLabour" parameterType="ClaimReqLbrVO">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.updateClaimRequestLabour] */
       UPDATE SE_0712T    --클레임공임정보
          SET
               LBR_PRC         = #{lbrPrc}                --공임단가
              ,LBR_HM          = #{lbrHm}                 --공임시간
              ,LBR_QTY         = #{lbrQty}                --공임수량
              ,LBR_AMT         = #{lbrAmt}                --공임금액
              ,CAU_LBR_YN      = #{cauLbrYn}              --원인공임여부
              ,UPDT_USR_ID     = #{updtUsrId}             --수정자ID
              ,UPDT_DT         = sysdate                  --수정일자
         WHERE 1 = 1
           AND DLR_CD          = #{dlrCd}                 --딜러코드
           AND CLAIM_DOC_NO    = #{claimDocNo}            --클레임문서번호
           AND LINE_NO         = #{lineNo}                --라인번호
           AND RO_DOC_NO       = #{roDocNo}               --RO문서번호
           AND LBR_CD          = #{lbrCd}                 --공임코드


    </update>

    <!-- 클레임 부품 수정 -->
    <update id="updateClaimRequestPart" parameterType="ClaimReqPartVO">
    /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.updateClaimRequestPart] */
         UPDATE SE_0711T    --클레임부품정보
          SET
               ITEM_PRC        = #{itemPrc}               --품목단가
              ,ITEM_AMT        = #{itemAmt}               --품목금액
              ,SALE_UNIT_CD    = NVL(#{saleUnitCd},'EA')  --판매단위코드
              ,ITEM_QTY        = #{itemQty}               --요청수량
              ,REQ_QTY         = #{reqQty}                --요청수량
              ,GR_STRGE_CD     = #{grStrgeCd}             --입고창고코드
              ,GI_STRGE_CD     = #{giStrgeCd}             --출고창고코드
              ,CAU_ITEM_YN     = #{cauItemYn}             --원인부품여부
              ,UPDT_USR_ID     = #{updtUsrId}             --수정자ID
              ,UPDT_DT         = SYSDATE                  --수정일자
         WHERE 1 = 1
           AND DLR_CD          = #{dlrCd}                 --딜러코드
           AND CLAIM_DOC_NO    = #{claimDocNo}            --클레임문서번호
           AND LINE_NO         = #{lineNo}                --라인번호
           AND RO_DOC_NO       = #{roDocNo}               --RO문서번호
           AND ITEM_CD         = #{itemCd}                --품목코드

    </update>

    <!-- 클레임 부품 삭제 -->
    <delete id="deleteClaimRequestPart" parameterType="ClaimReqPartVO">
    /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.deleteClaimRequestPart] */

            DELETE FROM SE_0711T
             WHERE 1 = 1
               AND DLR_CD          = #{dlrCd}                 --딜러코드
               AND CLAIM_DOC_NO    = #{claimDocNo}            --클레임문서번호
               <if test='lineNo != null '>
               AND LINE_NO         = #{lineNo}                --라인번호
               </if>
               AND RO_DOC_NO       = #{roDocNo}               --RO문서번호
               <if test='itemCd != null and itemCd != "" '>
               AND ITEM_CD         = #{itemCd}                --품목코드
               </if>

    </delete>

    <!-- 클레임 공임 삭제 -->
    <delete id="deleteClaimRequestLabour" parameterType="ClaimReqLbrVO">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.deleteClaimRequestLabour] */

            DELETE FROM SE_0712T
             WHERE 1 = 1
               AND DLR_CD          = #{dlrCd}                 --딜러코드
               AND CLAIM_DOC_NO    = #{claimDocNo}            --클레임문서번호
               <if test='lineNo != null '>
               AND LINE_NO         = #{lineNo}                --라인번호
               </if>
               AND RO_DOC_NO       = #{roDocNo}               --RO문서번호
               <if test='lbrCd != null and lbrCd != "" '>
               AND LBR_CD          = #{lbrCd}                 --공임코드
               </if>
    </delete>

    <!-- 클레임 인터페이스  삭제 -->
    <delete id="deleteClaimRequestIf" parameterType="ClaimReqVO">
    /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.deleteClaimRequestIf] */

            DELETE FROM SE_0710I
             WHERE 1 = 1
               AND DLR_CD          = #{dlrCd}                 --딜러코드
               AND CLAIM_DOC_NO    = #{claimDocNo}            --클레임문서번호
               AND RO_DOC_NO       = #{roDocNo}               --RO문서번호

    </delete>

    <!-- 클레임 인터페이스 부품 삭제 -->
    <delete id="deleteClaimRequestPartIf" parameterType="ClaimReqVO">
    /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.deleteClaimRequestPartIf] */

            DELETE FROM SE_0711I
             WHERE 1 = 1
               AND DLR_CD          = #{dlrCd}                 --딜러코드
               AND CLAIM_DOC_NO    = #{claimDocNo}            --클레임문서번호
               AND RO_DOC_NO       = #{roDocNo}               --RO문서번호

    </delete>

    <!-- 클레임 인터페이스 공임 삭제 -->
    <delete id="deleteClaimRequestLabourIf" parameterType="ClaimReqVO">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.deleteClaimRequestLabourIf] */

            DELETE FROM SE_0712I
             WHERE 1 = 1
               AND DLR_CD          = #{dlrCd}                 --딜러코드
               AND CLAIM_DOC_NO    = #{claimDocNo}            --클레임문서번호
               AND RO_DOC_NO       = #{roDocNo}               --RO문서번호
    </delete>

     <!-- 클레임 인터페이스  전송 여부 정보 -->
    <select id="selectClaimRequestIf" parameterType="ClaimReqVO" resultType="int" >
    /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestIf] */

            SELECT COUNT(CLAIM_DOC_NO) AS VALUE
              FROM SE_0710I
             WHERE 1 = 1
               AND DLR_CD          = #{dlrCd}                 --딜러코드
               AND CLAIM_DOC_NO    = #{claimDocNo}            --클레임문서번호
               AND RO_DOC_NO       = #{roDocNo}               --RO문서번호
               <if test ='ifResltYn != null and ifResltYn != ""'>
                AND IFRESULT = #{ifResltYn}
               </if>

    </select>

     <!-- 클레임 인터페이스  부품 전송 여부 정보 -->
    <select id="selectClaimPartRequestIf" parameterType="ClaimReqVO" resultType="int" >
    /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimPartRequestIf] */

            SELECT COUNT(CLAIM_DOC_NO) AS VALUE
              FROM SE_0711I
             WHERE 1 = 1
               AND DLR_CD          = #{dlrCd}                 --딜러코드
               AND CLAIM_DOC_NO    = #{claimDocNo}            --클레임문서번호
               AND RO_DOC_NO       = #{roDocNo}               --RO문서번호
               <if test ='ifResltYn != null and ifResltYn != ""'>
                AND IFRESULT = #{ifResltYn}
               </if>

    </select>

     <!-- 클레임 인터페이스  공임 전송 여부 정보 -->
    <select id="selectClaimLaborRequestIf" parameterType="ClaimReqVO" resultType="int" >
    /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimLaborRequestIf] */

        SELECT COUNT(CLAIM_DOC_NO) AS VALUE
          FROM SE_0712I
         WHERE 1 = 1
           AND DLR_CD          = #{dlrCd}                 --딜러코드
           AND CLAIM_DOC_NO    = #{claimDocNo}            --클레임문서번호
           AND RO_DOC_NO       = #{roDocNo}               --RO문서번호
          <if test ='ifResltYn != null and ifResltYn != ""'>
           AND IFRESULT = #{ifResltYn}
          </if>

    </select>


    <!-- RO 클레임 요청목록 수 조회 -->
    <select id="selectClaimRequestForRoByConditionCnt" parameterType="ClaimReqSearchVO" resultType="int">
     /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForRoByConditionCnt] */

               SELECT COUNT(T1.RO_DOC_NO)AS VALUE
                 FROM (
                        SELECT A.*
                              ,CA.CALC_DOC_NO
                              ,CA.CALC_DT
                              ,CA.CALC_TOT_AMT
                              ,CA.PAR_CALC_SUM_AMT
                              ,CA.LBR_CALC_SUM_AMT
                              ,CA.DC_TOT_AMT
                              ,CA.ETC_TOT_AMT
                          FROM(
                            SELECT RO.DLR_CD
                                  ,RO.RO_DOC_NO
                                  ,RO.RO_TP
                                  ,RO.VIN_NO
                                  ,RO.RO_DT
                                  ,RO.RO_STAT_CD
                                  ,RO.CAR_REG_NO                      --차량등록번호
                                  ,RO.ENGIN_NO                        --엔진번호
                                  ,RO.CAR_OWNER_ID                    --차량소유자ID
                                  ,RO.CAR_OWNER_NM                    --차량소유자명
                                  ,RO.DRIVER_ID                       --운전자ID
                                  ,RO.DRIVER_NM                       --운전자명
                                  ,RO.RUN_DIST_VAL                    --주행거리값
                                  ,LB.LBR_CD
                                  ,LB.CR_NO
                                  ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = RO.VIN_NO AND ROWNUM = 1) AS CAR_RUN_DIST_VAL
                                  ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = RO.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                                  ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = RO.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                                  ,ROW_NUMBER() OVER(PARTITION BY RO.DLR_CD , RO.RO_DOC_NO  , RO.RO_TP ,LB.CR_NO ORDER BY RO.DLR_CD , RO.RO_DOC_NO DESC , RO.RO_TP ASC) AS RN
                              FROM SE_0300T RO, SE_0170T LB
                             WHERE LB.DLR_CD    = RO.DLR_CD
                               AND LB.DOC_NO    = RO.RO_DOC_NO
                               AND RO.RO_STAT_CD IN ('00', '05')
                               AND RO.RO_TP     = '02'
                               AND RO.DLR_CD    = #{sDlrCd}
                               <if test='sVinNo != null and sVinNo != "" '>
                               AND RO.VIN_NO LIKE '%'|| #{sVinNo} || '%'
                               </if>
                               <if test='sRoDocNo != null and sRoDocNo != "" '>
                               AND RO.RO_DOC_NO  = #{sRoDocNo}
                               </if>
                               <if test='sRoFromDt !=null'>
                               AND RO.RO_DT <![CDATA[>=]]> #{sRoFromDt}
                               </if>
                               <if test='sRoToDt !=null'>
                               AND RO.RO_DT <![CDATA[<=]]> #{sRoToDt}+1
                               </if>
                               AND LB.PREFIX_ID = 'RO'
                               AND NOT EXISTS (
                                       SELECT CH.DLR_CD
                                             ,CH.RO_DOC_NO
                                             ,CH.RO_TP
                                             ,CH.VIN_NO
                                             ,CH.CLAIM_DOC_NO
                                             ,CL.LBR_CD
                                             ,CL.LINE_NO
                                         FROM SE_0710T CH, SE_0712T CL
                                        WHERE CL.DLR_CD       = CH.DLR_CD
                                          AND CL.RO_DOC_NO    = CH.RO_DOC_NO
                                          AND CL.CLAIM_DOC_NO = CH.CLAIM_DOC_NO
                                          AND CH.CLAIM_STAT_CD  <![CDATA[<>]]>  'C'
                                          AND CH.DLR_CD       = #{sDlrCd}
                                          AND CH.DLR_CD       = RO.DLR_CD
                                          AND CH.RO_DOC_NO    = RO.RO_DOC_NO
                                          AND CH.VIN_NO       = RO.VIN_NO
                                          AND CH.RO_TP        = RO.RO_TP
                                          AND CL.LBR_CD       = LB.LBR_CD
                                     )
                         )A LEFT OUTER JOIN SE_0500T CA
                          ON CA.DLR_CD    = A.DLR_CD
                         AND CA.RO_DOC_NO = A.RO_DOC_NO
                         AND CA.VIN_NO    = A.VIN_NO
                         AND CA.CALC_CANC_YN = 'N'
                        WHERE RN = 1
                      ORDER BY DLR_CD , RO_DOC_NO DESC , RO_TP ASC
                 )T1
    </select>


    <!-- RO 클레임 요청목록조회 -->
    <select id="selectClaimRequestForRoByCondition_BACK" parameterType="ClaimReqSearchVO" resultType="ClaimReqVO">
     /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForRoByCondition_BACK] */
        SELECT *
          FROM (
                SELECT ROWNUM AS RNUM
                      ,T1.DLR_CD
                      ,T1.RO_DOC_NO
                      ,T1.RO_TP
                      ,T1.RO_DT
                      ,T1.RO_STAT_CD
                      ,T1.VIN_NO                          --차대번호
                      ,T1.CAR_REG_NO                      --차량등록번호
                      ,T1.ENGIN_NO                        --엔진번호
                      ,T1.CAR_OWNER_ID                    --차량소유자ID
                      ,T1.CAR_OWNER_NM                    --차량소유자명
                      ,T1.DRIVER_ID                       --운전자ID
                      ,T1.DRIVER_NM                       --운전자명
                      ,T1.RUN_DIST_VAL                    --주행거리값
                      ,T1.LBR_CD
                      ,T1.CR_NO
                      ,T1.CAR_RUN_DIST_VAL
                      ,T1.CARLINE_NM
                      ,T1.MODEL_NM
                      ,T1.CALC_DOC_NO
                      ,T1.CALC_DT
                      ,T1.CALC_TOT_AMT
                      ,T1.PAR_CALC_SUM_AMT
                      ,T1.LBR_CALC_SUM_AMT
                      ,T1.DC_TOT_AMT
                      ,T1.ETC_TOT_AMT
                 FROM (
                        SELECT A.*
                              ,ROW_NUMBER() OVER(PARTITION BY A.DLR_CD , A.RO_DOC_NO  , A.RO_TP ,A.CR_NO ORDER BY A.DLR_CD , A.RO_DOC_NO DESC , A.RO_TP ASC) AS RN
                         FROM (
                            SELECT RO.DLR_CD
                                  ,RO.RO_DOC_NO
                                  ,RO.RO_TP
                                  ,RO.VIN_NO
                                  ,RO.RO_DT
                                  ,RO.RO_STAT_CD
                                  ,RO.CAR_REG_NO                      --차량등록번호
                                  ,RO.ENGIN_NO                        --엔진번호
                                  ,RO.CAR_OWNER_ID                    --차량소유자ID
                                  ,RO.CAR_OWNER_NM                    --차량소유자명
                                  ,RO.DRIVER_ID                       --운전자ID
                                  ,RO.DRIVER_NM                       --운전자명
                                  ,RO.RUN_DIST_VAL                    --주행거리값
                                  ,LB.LBR_CD
                                  ,LB.CR_NO
                                  ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = RO.VIN_NO AND ROWNUM = 1) AS CAR_RUN_DIST_VAL
                                  ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = RO.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                                  ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = RO.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                                  ,CA.CALC_DOC_NO
                                  ,CA.CALC_DT
                                  ,CA.CALC_TOT_AMT
                                  ,CA.PAR_CALC_SUM_AMT
                                  ,CA.LBR_CALC_SUM_AMT
                                  ,CA.DC_TOT_AMT
                                  ,CA.ETC_TOT_AMT
                              FROM SE_0300T RO, SE_0500T CA , SE_0170T LB
                             WHERE CA.DLR_CD    = RO.DLR_CD
                               AND CA.RO_DOC_NO = RO.RO_DOC_NO
                               AND CA.RO_TP     = RO.RO_TP
                               AND CA.VIN_NO    = RO.VIN_NO
                               AND LB.DOC_NO    = CA.CALC_DOC_NO
                               AND LB.DLR_CD    = CA.DLR_CD
                               AND RO.DLR_CD    = #{sDlrCd}
                              <if test='sVinNo != null and sVinNo != "" '>
                               AND RO.VIN_NO LIKE '%'|| #{sVinNo} || '%'
                              </if>
                              <if test='sRoFromDt !=null'>
                               AND RO.RO_DT <![CDATA[>=]]> #{sRoFromDt}
                             </if>
                             <if test='sRoToDt !=null'>
                               AND RO.RO_DT <![CDATA[<=]]> #{sRoToDt}+1
                             </if>
                             <if test='sRoDocNo != null and sRoDocNo != "" '>
                               AND RO.RO_DOC_NO  = #{sRoDocNo}
                             </if>
                               AND RO.RO_STAT_CD IN ('00', '05')
                               AND CA.CALC_CANC_YN  = 'N'
                               AND RO.RO_TP         = '02'
                               AND LB.PREFIX_ID     = 'CA'
                               AND NOT EXISTS (
                                               SELECT CH.DLR_CD
                                                     ,CH.RO_DOC_NO
                                                     ,CH.RO_TP
                                                     ,CH.VIN_NO
                                                     ,CH.CLAIM_DOC_NO
                                                     ,CL.LBR_CD
                                                     ,CL.LINE_NO
                                                 FROM SE_0710T CH, SE_0712T CL
                                                WHERE CL.DLR_CD       = CH.DLR_CD
                                                  AND CL.RO_DOC_NO    = CH.RO_DOC_NO
                                                  AND CL.CLAIM_DOC_NO = CH.CLAIM_DOC_NO
                                                  AND CH.CLAIM_STAT_CD <![CDATA[<>]]> 'C'
                                                  AND CH.DLR_CD       = #{sDlrCd}
                                                  AND CH.DLR_CD       = RO.DLR_CD
                                                  AND CH.RO_DOC_NO    = RO.RO_DOC_NO
                                                  AND CH.VIN_NO       = RO.VIN_NO
                                                  AND CH.RO_TP        = RO.RO_TP
                                                  AND CL.LBR_CD       = LB.LBR_CD
                                             )
                          )A
                          ORDER BY DLR_CD , RO_DOC_NO DESC , RO_TP ASC
                 )T1 WHERE RN = 1
                  <if test='firstIndex != -1 and lastIndex != -1'>
                   AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                  </if>
            )
        <where>
           <if test='firstIndex != -1 and lastIndex != -1'>
             RNUM > #{firstIndex}
           </if>
        </where>

    </select>
    <!-- RO 클레임 요청목록조회 -->
    <select id="selectClaimRequestForRoByCondition" parameterType="ClaimReqSearchVO" resultType="ClaimReqVO">
     /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForRoByCondition] */

        SELECT *
          FROM (
                SELECT ROWNUM AS RNUM
                      ,T1.DLR_CD
                      ,T1.RO_DOC_NO
                      ,T1.RO_TP
                      ,T1.RO_TP_NM                        --excel
                      ,T1.RO_DT
                      ,T1.REG_USR_NM
                      ,T1.RO_STAT_CD
                      ,T1.RO_STAT_NM                      --excel
                      ,T1.VIN_NO                          --차대번호
                      ,T1.CAR_REG_NO                      --차량등록번호
                      ,T1.ENGIN_NO                        --엔진번호
                      ,T1.CAR_OWNER_ID                    --차량소유자ID
                      ,T1.CAR_OWNER_NM                    --차량소유자명
                      ,T1.DRIVER_ID                       --운전자ID
                      ,T1.DRIVER_NM                       --운전자명
                      ,T1.RUN_DIST_VAL                    --주행거리값
                      ,T1.LBR_CD
                      ,T1.CR_NO
                      ,T1.CAR_RUN_DIST_VAL
                      ,T1.CARLINE_NM
                      ,T1.MODEL_NM
                      ,T1.CALC_DOC_NO
                      ,T1.CALC_DT
                      ,T1.CALC_DT_FORMAT
                      ,T1.CALC_TOT_AMT
                      ,T1.PAR_CALC_SUM_AMT
                      ,T1.LBR_CALC_SUM_AMT
                      ,T1.DC_TOT_AMT
                      ,T1.ETC_TOT_AMT
                 FROM (
                        SELECT A.*
                              ,CA.CALC_DOC_NO
                              ,CA.CALC_DT
                              ,TO_CHAR(CALC_DT,'YYYY/MM/DD HH24:MI:SS') AS CALC_DT_FORMAT
                              ,CA.CALC_TOT_AMT
                              ,CA.PAR_CALC_SUM_AMT
                              ,CA.LBR_CALC_SUM_AMT
                              ,CA.DC_TOT_AMT
                              ,CA.ETC_TOT_AMT
                          FROM(
                            SELECT RO.DLR_CD
                                  ,RO.RO_DOC_NO
                                  ,RO.RO_TP
                                  ,(SELECT CMM_CD_TXT
                            		FROM CM_0304T          
                            		WHERE LANG_CD  ='zh'
                              		AND CMM_GRP_CD ='SER031'
                              		AND CMM_CD = RO.RO_TP ) RO_TP_NM
                                  ,RO.VIN_NO
                                  ,RO.RO_DT
                                  ,RO.RO_STAT_CD
                                  ,(SELECT CMM_CD_TXT
                            		FROM CM_0304T          
                            		WHERE LANG_CD  ='zh'
                              		AND CMM_GRP_CD ='SER030'
                              		AND CMM_CD = RO.RO_STAT_CD ) RO_STAT_NM
                                  ,RO.CAR_REG_NO                      --차량등록번호
                                  ,RO.ENGIN_NO                        --엔진번호
                                  ,RO.CAR_OWNER_ID                    --차량소유자ID
                                  ,RO.CAR_OWNER_NM                    --차량소유자명
                                  ,RO.DRIVER_ID                       --운전자ID
                                  ,RO.DRIVER_NM                       --운전자명
                                  ,RO.RUN_DIST_VAL                    --주행거리값
                                  ,LB.LBR_CD
                                  ,LB.CR_NO
                                  ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = RO.VIN_NO AND ROWNUM = 1) AS CAR_RUN_DIST_VAL
                                  ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = RO.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                                  ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = RO.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                                  ,ROW_NUMBER() OVER(PARTITION BY RO.DLR_CD , RO.RO_DOC_NO  , RO.RO_TP ,LB.CR_NO ORDER BY RO.DLR_CD , RO.RO_DOC_NO DESC , RO.RO_TP ASC) AS RN
                                  ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = RO.REG_USR_ID AND DLR_CD = RO.DLR_CD) AS REG_USR_NM
                              FROM SE_0300T RO, SE_0170T LB
                             WHERE LB.DLR_CD    = RO.DLR_CD
                               AND LB.DOC_NO    = RO.RO_DOC_NO
                               AND RO.RO_STAT_CD IN ('00', '05')
                               AND RO.RO_TP     = '02'
                               AND RO.DLR_CD    = #{sDlrCd}
                               <if test='sVinNo != null and sVinNo != "" '>
                               AND RO.VIN_NO LIKE '%'|| #{sVinNo} || '%'
                               </if>
                               <if test='sRoDocNo != null and sRoDocNo != "" '>
                               AND RO.RO_DOC_NO  = #{sRoDocNo}
                               </if>
                               <if test='sRoFromDt !=null'>
                               AND RO.RO_DT <![CDATA[>=]]> #{sRoFromDt}
                               </if>
                               <if test='sRoToDt !=null'>
                               AND RO.RO_DT <![CDATA[<=]]> #{sRoToDt}+1
                               </if>
                               AND LB.PREFIX_ID = 'RO'
                               AND NOT EXISTS (
                                       SELECT CH.DLR_CD
                                             ,CH.RO_DOC_NO
                                             ,CH.RO_TP
                                             ,CH.VIN_NO
                                             ,CH.CLAIM_DOC_NO
                                             ,CL.LBR_CD
                                             ,CL.LINE_NO
                                         FROM SE_0710T CH, SE_0712T CL
                                        WHERE CL.DLR_CD       = CH.DLR_CD
                                          AND CL.RO_DOC_NO    = CH.RO_DOC_NO
                                          AND CL.CLAIM_DOC_NO = CH.CLAIM_DOC_NO
                                          AND CH.CLAIM_STAT_CD  <![CDATA[<>]]>  'C'
                                          AND CH.DLR_CD       = #{sDlrCd}
                                          AND CH.DLR_CD       = RO.DLR_CD
                                          AND CH.RO_DOC_NO    = RO.RO_DOC_NO
                                          AND CH.VIN_NO       = RO.VIN_NO
                                          AND CH.RO_TP        = RO.RO_TP
                                          AND CL.LBR_CD       = LB.LBR_CD
                                     )
                         )A LEFT OUTER JOIN SE_0500T CA
                          ON CA.DLR_CD    = A.DLR_CD
                         AND CA.RO_DOC_NO = A.RO_DOC_NO
                         AND CA.VIN_NO    = A.VIN_NO
                         AND CA.CALC_CANC_YN = 'N'
                        WHERE RN = 1
                      ORDER BY DLR_CD , RO_DOC_NO DESC , RO_TP ASC
                 )T1
                 <where>
                     <if test='firstIndex != -1 and lastIndex != -1'>
                        ROWNUM <![CDATA[<=]]> #{lastIndex}
                     </if>
                 </where>
            )
        <where>
           <if test='firstIndex != -1 and lastIndex != -1'>
             RNUM > #{firstIndex}
           </if>
        </where>
    </select>

    <!-- 클레임목록 수-->
    <select id="selectClaimRequestForClaimByConditionCnt" parameterType="ClaimReqSearchVO" resultType="int">
     /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForClaimByConditionCnt] */


        SELECT COUNT(A.CLAIM_DOC_NO) AS VALUE
          FROM SE_0710T A , SE_0300T B
         WHERE B.DLR_CD = A.DLR_CD
           AND B.RO_DOC_NO = A.RO_DOC_NO
           AND B.VIN_NO = A.VIN_NO
           AND B.RO_TP = A.RO_TP
           AND A.DLR_CD = #{sDlrCd}
           <if test='sVinNo != null and sVinNo != "" '>
               AND A.VIN_NO LIKE '%'|| #{sVinNo} || '%'
            </if>
           <if test='sClaimFromDt !=null'>
               AND A.CLAIM_START_DT <![CDATA[>=]]> #{sClaimFromDt}
           </if>
           <if test='sClaimToDt !=null'>
               AND A.CLAIM_START_DT <![CDATA[<=]]> #{sClaimToDt}+1
           </if>
           <if test='sClaimDocNo !=null and sClaimDocNo !=""'>
               AND A.CLAIM_DOC_NO = #{sClaimDocNo}
           </if>
           <if test='sRoDocNo !=null and sRoDocNo !=""'>
               AND A.RO_DOC_NO = #{sRoDocNo}
           </if>
           <if test='sClaimStatCd !=null and sClaimStatCd !=""'>
               AND A.CLAIM_STAT_CD = #{sClaimStatCd}
           </if>
           <if test='sClaimTp !=null and sClaimTp !=""'>
               AND A.CLAIM_TP = #{sClaimTp}
           </if>
           <if test='sCancelYn !=null and sCancelYn !=""'>
               AND A.CLAIM_STAT_CD <![CDATA[<>]]> 'C'
           </if>
           <choose>
               <when test='sField != null and sField != "" '>
                   <if test='sField == 01 and sText != null and sText != "" '>
                       AND A.CLAIM_DOC_NO = #{sText}
                   </if>
                   <if test='sField == 02 and sText != null and sText != "" '>
                       AND A.RO_DOC_NO = #{sText}
                   </if>
                   <if test='sField == 03 and sText != null and sText != "" '>
                       AND A.VIN_NO LIKE '%'|| #{sText} || '%'
                   </if>
               </when>
           </choose>
    </select>

    <!-- 클레임목록 -->
    <select id="selectClaimRequestForClaimByCondition" parameterType="ClaimReqSearchVO" resultType="ClaimReqVO">
     /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForClaimByCondition] */

        SELECT *
         FROM (
              SELECT ROWNUM AS RNUM , T1.*
                FROM (
                   SELECT
                         A.DLR_CD
                        ,A.CLAIM_DOC_NO
                        ,A.VIN_NO
                        ,A.RO_DOC_NO
                        ,A.CLAIM_TP
                        ,A.CLAIM_STAT_CD
                        ,A.LTS_MODEL_CD
                        ,A.CLAIM_START_DT
                        ,A.CAU_OPER_ATC_CD
                        ,A.CAU_OPER_ATC_NM
                        ,A.CAU_ITEM_CD
                        ,A.CAU_ITEM_NM
                        ,A.CR_NO
                        ,(SELECT USR_NM
                            FROM CM_0801T
                            WHERE USR_ID = A.REG_USR_ID
                         ) AS WRTR_NM
                        ,(SELECT CMM_CD_TXT
                            FROM CM_0304T
                            WHERE LANG_CD    = NVL( #{sLangCd} ,'zh')
                              AND CMM_GRP_CD ='SER090'
                              AND CMM_CD     = CLAIM_STAT_CD ) CLAIM_STAT_NM
                        ,(SELECT CMM_CD_TXT
                            FROM CM_0304T
                            WHERE LANG_CD    = NVL( #{sLangCd} ,'zh')
                              AND CMM_GRP_CD ='SER091'
                              AND CMM_CD     = A.CLAIM_TP ) CLAIM_TP_NM
                        ,CLAIM_REQ_ID
                        ,CLAIM_REQ_NM
                        ,CLAIM_REQ_DT
                    FROM SE_0710T A , SE_0300T B
                   WHERE B.DLR_CD    = A.DLR_CD
                     AND B.RO_DOC_NO = A.RO_DOC_NO
                     AND B.VIN_NO    = A.VIN_NO
                     AND B.RO_TP     = A.RO_TP
                     AND A.DLR_CD    = #{sDlrCd}
                    <if test='sVinNo != null and sVinNo != "" '>
                     AND A.VIN_NO LIKE LIKE '%' || #{sVinNo} || '%'
                    </if>
                    <if test='sClaimFromDt !=null'>
                     AND A.CLAIM_START_DT <![CDATA[>=]]> #{sClaimFromDt}
                    </if>
                    <if test='sClaimToDt !=null'>
                     AND A.CLAIM_START_DT <![CDATA[<=]]> #{sClaimToDt}+1
                    </if>
                    <if test='sClaimDocNo !=null and sClaimDocNo !=""'>
                     AND A.CLAIM_DOC_NO = #{sClaimDocNo}
                    </if>
                    <if test='sRoDocNo !=null and sRoDocNo !=""'>
                     AND A.RO_DOC_NO = #{sRoDocNo}
                    </if>
                    <if test='sClaimStatCd !=null and sClaimStatCd !=""'>
                     AND A.CLAIM_STAT_CD = #{sClaimStatCd}
                    </if>
                    <if test='sClaimTp !=null and sClaimTp !=""'>
                     AND A.CLAIM_TP = #{sClaimTp}
                    </if>
                    <choose>
                        <when test='sField != null and sField != "" '>
                            <if test='sField == 01 and sText != null and sText != "" '>
                                AND A.CLAIM_DOC_NO = #{sText}
                            </if>
                            <if test='sField == 02 and sText != null and sText != "" '>
                                AND A.RO_DOC_NO = #{sText}
                            </if>
                            <if test='sField == 03 and sText != null and sText != "" '>
                                AND A.VIN_NO LIKE '%'|| #{sText} || '%'
                            </if>
                        </when>
                    </choose>
                    ORDER BY A.DLR_CD , A.CLAIM_START_DT DESC
                ) T1
                 <where>
                     <if test='firstIndex != -1 and lastIndex != -1'>
                       AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                     </if>
                 </where>
         )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- RO정보조회 -->
    <select id="selectClaimRequestForRoByKey" parameterType="ClaimReqSearchVO" resultType="ClaimReqVO">
     /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForRoByKey] */

        SELECT RO.*
              ,CM.CAU_OPER_ATC_CD
              ,CM.CAU_OPER_ATC_NM
              ,CM.CR_NO
              ,CASE WHEN RO.GOODWILL_YN = 'Y' THEN 'G'
                    WHEN CM.CR_TP IS NOT NULL THEN CM.CR_TP
                    ELSE ''
                    END AS CLAIM_TP
              ,CM.CAU_ITEM_CD
              ,CM.CAU_ITEM_NM
              ,CM.CAU_CD
              ,CM.CAU_NM
              ,CM.PHEN_CD
              ,CM.PHEN_NM
          FROM (
                SELECT A.DLR_CD
                      ,A.RO_DOC_NO
                      ,A.RO_GRP_NO
                      ,(SELECT CALC_DOC_NO
                          FROM SE_0500T
                         WHERE DLR_CD    = A.DLR_CD
                           AND RO_DOC_NO = A.RO_DOC_NO
                           AND VIN_NO    = A.VIN_NO
                           AND CALC_CANC_YN = 'N'
                           AND ROWNUM = 1
                       )AS CALC_DOC_NO
                      ,A.RESV_DOC_NO
                      ,A.RO_STAT_CD
                      ,A.VIN_NO
                      ,A.CAR_REG_NO
                      ,A.RO_DT
                      ,#{sLtsModelCd} AS  LTS_MODEL_CD
                      ,FN_SER_LTS_MODEL_NM( #{sLtsModelCd},#{sLangCd}) AS LTS_MODEL_NM
                      ,A.RUN_DIST_VAL
                      , NVL(B.CAR_RUN_DIST_VAL,0) AS LAST_RUN_DIST_VAL
                      ,B.CARLINE_CD
                      ,A.PAINT_TP
                      ,A.RO_DT   AS RO_START_DT
                      ,(SELECT CALC_DT
                          FROM SE_0500T
                         WHERE DLR_CD    = A.DLR_CD
                           AND RO_DOC_NO = A.RO_DOC_NO
                           AND VIN_NO    = A.VIN_NO
                           AND CALC_CANC_YN = 'N'
                           AND ROWNUM = 1
                       )AS RO_END_DT
                      ,A.ENGIN_NO
                      ,A.CAR_OWNER_ID
                      ,A.CAR_OWNER_NM
                      ,A.DRIVER_ID
                      ,A.DRIVER_NM
                      ,B.GRTE_START_DT  AS WART_DT
                      ,B.CAR_DSTIN_CD
                      ,A.RO_TP
                      ,'Y' AS DTC1_USE_YN
                      ,'Y' AS DTC2_USE_YN
                      ,'N' AS DTC3_USE_YN
                      ,'N' AS DTC4_USE_YN
                      ,GOODWILL_YN
                 FROM SE_0300T A , SA_0121T B
                WHERE A.DLR_CD    = #{sDlrCd}
                  AND A.RO_DOC_NO = #{sRoDocNo}
                  AND A.RO_STAT_CD IN ('00', '05')
                  AND B.VIN_NO    = A.VIN_NO
              )RO LEFT OUTER JOIN (
                                 SELECT A.DLR_CD
                                       ,A.RO_DOC_NO
                                       ,A.RO_TP
                                       ,B.LBR_CD AS CAU_OPER_ATC_CD
                                       ,B.LBR_NM AS CAU_OPER_ATC_NM
                                       ,B.CR_NO
                                       ,B.CR_TP
                                       ,C.CAU_ITEM_CD
                                       ,C.CAU_ITEM_NM
                                       ,C.CAU_CD
                                       ,C.CAU_NM
                                       ,C.PHEN_CD
                                       ,C.PHEN_NM
                                   FROM SE_0300T A , SE_0170T B , SE_1072T C
                                  WHERE B.CR_NO     = C.CR_NO
                                    AND B.LBR_CD    = C.LBR_CD
                                    AND B.DOC_NO    = A.RO_DOC_NO
                                    AND B.DLR_CD    = A.DLR_CD
                                    AND C.DLR_CD    = A.DLR_CD
                                    AND B.RO_TP     = A.RO_TP
                                    AND A.DLR_CD    = #{sDlrCd}
                                    AND A.RO_DOC_NO = #{sRoDocNo}
                                    AND B.PREFIX_ID = 'RO'
                                    AND A.RO_STAT_CD IN ('00', '05')
                                    AND B.LBR_CD NOT LIKE '%ZZ'
                                    <if test=' sCrNo != null and sCrNo != "" '>
                                    AND B.CR_NO     = #{sCrNo}
                                    </if>
             ) CM
              ON RO.DLR_CD    = CM.DLR_CD
             AND RO.RO_DOC_NO = CM.RO_DOC_NO
             AND RO.RO_TP     = CM.RO_TP
          <if test=' sCrNo == null or sCrNo == "" '>
          AND CM.CR_NO IS NULL
          </if>
    </select>

    <!-- RO정보조회 -->
    <select id="selectClaimRequestForRoByKey_BACK" parameterType="ClaimReqSearchVO" resultType="ClaimReqVO">
     /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForRoByKey] */
        SELECT RO.*
              ,CA.CAU_OPER_ATC_CD
              ,CA.CAU_OPER_ATC_NM
              ,CA.CR_NO
              ,CASE WHEN RO.GOODWILL_YN = 'Y' THEN 'G'
                    WHEN CA.CR_TP IS NOT NULL THEN CA.CR_TP
                    ELSE ''
                    END AS CLAIM_TP
              ,CA.CAU_ITEM_CD
              ,CA.CAU_ITEM_NM
              ,CA.CAU_CD
              ,CA.CAU_NM
              ,CA.PHEN_CD
              ,CA.PHEN_NM
          FROM (
            SELECT A.DLR_CD
                  ,A.RO_DOC_NO
                  ,A.RO_GRP_NO
                  ,B.CALC_DOC_NO
                  ,A.RESV_DOC_NO
                  ,A.RO_STAT_CD
                  ,A.VIN_NO
                  ,A.CAR_REG_NO
                  ,A.RO_DT
                  , #{sLtsModelCd} AS  LTS_MODEL_CD
                  ,FN_SER_LTS_MODEL_NM( #{sLtsModelCd},#{sLangCd}) AS LTS_MODEL_NM
                  ,A.RUN_DIST_VAL
                  ,(SELECT NVL(CAR_RUN_DIST_VAL,0)
                      FROM SA_0121T
                     WHERE VIN_NO = A.VIN_NO
                       AND ROWNUM = 1 ) AS LAST_RUN_DIST_VAL
                  ,(SELECT CARLINE_CD
                      FROM SA_0121T
                     WHERE VIN_NO = A.VIN_NO
                       AND ROWNUM = 1 ) AS CARLINE_CD
                  ,A.PAINT_TP
                  ,A.RO_DT   AS RO_START_DT
                  ,B.CALC_DT AS RO_END_DT
                  ,A.ENGIN_NO
                  ,A.CAR_OWNER_ID
                  ,A.CAR_OWNER_NM
                  ,A.DRIVER_ID
                  ,A.DRIVER_NM
                  ,C.GRTE_START_DT  AS WART_DT
                  ,C.CAR_DSTIN_CD
                  ,A.RO_TP
                  ,'Y' AS DTC1_USE_YN
                  ,'Y' AS DTC2_USE_YN
                  ,'N' AS DTC3_USE_YN
                  ,'N' AS DTC4_USE_YN
                  ,GOODWILL_YN
             FROM SE_0300T A , SE_0500T B  , SA_0121T C
            WHERE A.DLR_CD    = B.DLR_CD
              AND A.RO_DOC_NO = B.RO_DOC_NO
              AND A.RO_TP     = B.RO_TP
              AND A.VIN_NO    = B.VIN_NO
              AND A.DLR_CD    = #{sDlrCd}
              AND A.RO_DOC_NO = #{sRoDocNo}
              AND A.RO_STAT_CD IN ('00', '05')
              AND B.CALC_CANC_YN = 'N'
              AND C.VIN_NO = A.VIN_NO
          )RO LEFT OUTER JOIN (
                                 SELECT A.DLR_CD
                                       ,A.RO_DOC_NO
                                       ,A.RO_TP
                                       ,B.LBR_CD AS CAU_OPER_ATC_CD
                                       ,B.LBR_NM AS CAU_OPER_ATC_NM
                                       ,B.CR_NO
                                       ,B.CR_TP
                                       ,C.CAU_ITEM_CD
                                       ,C.CAU_ITEM_NM
                                       ,C.CAU_CD
                                       ,C.CAU_NM
                                       ,C.PHEN_CD
                                       ,C.PHEN_NM
                                   FROM SE_0500T A , SE_0170T B , SE_1072T C
                                  WHERE B.CR_NO     = C.CR_NO
                                    AND B.LBR_CD    = C.LBR_CD
                                    AND B.DOC_NO    = A.CALC_DOC_NO
                                    AND B.DLR_CD    = A.DLR_CD
                                    AND C.DLR_CD    = A.DLR_CD
                                    AND B.RO_TP     = A.RO_TP
                                    AND A.DLR_CD    = #{sDlrCd}
                                    AND A.RO_DOC_NO = #{sRoDocNo}
                                    AND B.PREFIX_ID = 'CA'
                                    AND A.CALC_CANC_YN = 'N'
                                    <if test=' sCrNo != null and sCrNo != "" '>
                                    AND B.CR_NO     = #{sCrNo}
                                    </if>
           )CA
           ON RO.DLR_CD = CA.DLR_CD
          AND RO.RO_DOC_NO = CA.RO_DOC_NO
          AND RO.RO_TP = CA.RO_TP
          <if test=' sCrNo == null or sCrNo == "" '>
          AND CA.CR_NO IS NULL
          </if>
    </select>

    <!-- GOODWILL RO정보조회 -->
    <select id="selectClaimRequestForRoGoodWillByKey" parameterType="ClaimReqSearchVO" resultType="ClaimReqVO">
     /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForRoGoodWillByKey] */

        SELECT RO.*
          FROM (
            SELECT A.DLR_CD
                  ,A.RO_DOC_NO
                  ,A.RO_GRP_NO
                  ,'' AS CALC_DOC_NO
                  ,A.RESV_DOC_NO
                  ,A.RO_STAT_CD
                  ,A.VIN_NO
                  ,A.CAR_REG_NO
                  ,A.RO_DT
                  ,#{sLtsModelCd} AS  LTS_MODEL_CD
                  ,FN_SER_LTS_MODEL_NM( #{sLtsModelCd},#{sLangCd}) AS LTS_MODEL_NM
                  ,A.RUN_DIST_VAL
                  ,(SELECT NVL(CAR_RUN_DIST_VAL,0)
                      FROM SA_0121T
                     WHERE VIN_NO = A.VIN_NO
                       AND ROWNUM = 1 ) AS LAST_RUN_DIST_VAL
                  ,(SELECT CARLINE_CD
                      FROM SA_0121T
                     WHERE VIN_NO = A.VIN_NO
                       AND ROWNUM = 1) AS CARLINE_CD
                  ,A.PAINT_TP
                  ,A.RO_DT AS RO_START_DT
                  ,A.RO_DT AS RO_END_DT
                  ,A.ENGIN_NO
                  ,A.CAR_OWNER_ID
                  ,A.CAR_OWNER_NM
                  ,A.DRIVER_ID
                  ,A.DRIVER_NM
                  ,C.GRTE_START_DT  AS WART_DT
                  ,C.CAR_DSTIN_CD
                  ,A.RO_TP
                  ,'N' AS DTC1_USE_YN
                  ,'N' AS DTC2_USE_YN
                  ,'N' AS DTC3_USE_YN
                  ,'N' AS DTC4_USE_YN
                  ,GOODWILL_YN
                  ,'G' AS CLAIM_TP
             FROM SE_0300T A  , SA_0121T C
            WHERE A.DLR_CD      = #{sDlrCd}
              AND A.RO_DOC_NO   = #{sRoDocNo}
              AND A.GOODWILL_YN = 'Y'
              AND A.GOODWILL_STAT_CD = 'O'
              AND C.VIN_NO = A.VIN_NO
          )RO
    </select>

    <!-- RO 부품 갯수 정보조회 -->
    <select id="selectClaimRequestForRoPartByConditionCnt" parameterType="ClaimReqSearchVO" resultType="int">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForRoPartByConditionCnt] */


        SELECT COUNT(A.RO_DOC_NO) AS VALUE
          FROM SE_0300T A , SE_0160T B
         WHERE B.DOC_NO     = A.RO_DOC_NO
           AND B.DLR_CD     = A.DLR_CD
           AND A.DLR_CD     = #{sDlrCd}
           AND A.RO_DOC_NO  = #{sRoDocNo}
           AND B.PREFIX_ID  = 'RO'
           AND A.RO_TP      = '02'
           AND A.RO_STAT_CD IN ('00', '05')
           AND B.PAYM_TP    = '01'
           <choose>
               <when test=' sCrNo != null and sCrNo != "" '>
           AND B.CR_NO      = #{sCrNo}
               </when>
               <otherwise>
           AND B.CR_NO IS NULL
               </otherwise>
           </choose>
           AND NOT EXISTS(
                          SELECT CH.DLR_CD
                                ,CH.RO_DOC_NO
                                ,CH.RO_TP
                                ,CH.VIN_NO
                                ,CH.CLAIM_DOC_NO
                                ,PT.ITEM_CD
                                ,PT.LINE_NO
                            FROM SE_0710T CH, SE_0711T PT
                           WHERE PT.DLR_CD       = CH.DLR_CD
                             AND PT.RO_DOC_NO    = CH.RO_DOC_NO
                             AND PT.CLAIM_DOC_NO = CH.CLAIM_DOC_NO
                             AND CH.CLAIM_STAT_CD  <![CDATA[<>]]>  'C'
                             AND CH.DLR_CD       = A.DLR_CD
                             AND CH.RO_DOC_NO    = A.RO_DOC_NO
                             AND CH.VIN_NO       = A.VIN_NO
                             AND CH.RO_TP        = A.RO_TP
                             AND PT.ITEM_CD      = B.ITEM_CD
           )
    </select>

    <!-- RO 부품 정보조회 -->
    <select id="selectClaimRequestForRoPartByCondition" parameterType="ClaimReqSearchVO" resultType="ClaimReqPartVO">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForRoPartByCondition] */

        SELECT T1.*
              ,CASE WHEN T1.CR_ITEM_CD = T1.ITEM_CD THEN 'Y' END AS  CAU_ITEM_YN
          FROM (
                 SELECT A.DLR_CD
                       ,A.RO_DOC_NO
                       ,B.LINE_NO
                       ,B.ITEM_CD
                       ,B.ITEM_NM
                       ,B.ITEM_SALE_PRC AS ITEM_PRC
                       ,B.ITEM_QTY
                       ,B.REQ_QTY
                       ,B.ITEM_TOT_AMT AS ITEM_AMT
                       ,NVL(B.CALC_UNIT_CD,'EA') AS SALE_UNIT_CD
                       ,B.CR_NO
                       ,B.GR_STRGE_CD
                       ,B.GI_STRGE_CD
                       ,B.GI_TP
                       ,B.DOC_NO
                       ,(SELECT CAU_ITEM_CD
                           FROM SE_1072T
                          WHERE CR_NO  = B.CR_NO
                            AND CR_TP  = B.CR_TP
                            AND LBR_CD = B.ITEM_CD
                            AND ROWNUM = 1
                        ) AS CR_ITEM_CD
                        ,'N' AS NPNP_YN
                   FROM SE_0300T A , SE_0160T B
                  WHERE B.DOC_NO     = A.RO_DOC_NO
                    AND B.DLR_CD     = A.DLR_CD
                    AND A.DLR_CD     = #{sDlrCd}
                    AND A.RO_DOC_NO  = #{sRoDocNo}
                    AND B.PREFIX_ID  = 'RO'
                    AND A.RO_TP      = '02'
                    AND A.RO_STAT_CD IN ('00', '05')
                    AND B.PAYM_TP    = '01'
                    <choose>
                        <when test=' sCrNo != null and sCrNo != "" '>
                    AND B.CR_NO      = #{sCrNo}
                        </when>
                        <otherwise>
                    AND B.CR_NO IS NULL
                        </otherwise>
                    </choose>
                    AND NOT EXISTS(
                                   SELECT CH.DLR_CD
                                         ,CH.RO_DOC_NO
                                         ,CH.RO_TP
                                         ,CH.VIN_NO
                                         ,CH.CLAIM_DOC_NO
                                         ,PT.ITEM_CD
                                         ,PT.LINE_NO
                                     FROM SE_0710T CH, SE_0711T PT
                                    WHERE PT.DLR_CD       = CH.DLR_CD
                                      AND PT.RO_DOC_NO    = CH.RO_DOC_NO
                                      AND PT.CLAIM_DOC_NO = CH.CLAIM_DOC_NO
                                      AND CH.CLAIM_STAT_CD  <![CDATA[<>]]>  'C'
                                      AND CH.DLR_CD       = A.DLR_CD
                                      AND CH.RO_DOC_NO    = A.RO_DOC_NO
                                      AND CH.VIN_NO       = A.VIN_NO
                                      AND CH.RO_TP        = A.RO_TP
                                      AND PT.ITEM_CD      = B.ITEM_CD
                    )
         )T1
    </select>

    <!-- GOODWILL RO 부품 수 조회 -->
    <select id="selectClaimRequestForRoGoodWillPartByConditionCnt" parameterType="ClaimReqSearchVO" resultType="int">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForRoGoodWillPartByConditionCnt] */

        SELECT COUNT(B.ITEM_CD) AS VALUE
          FROM SE_0300T A , SE_0160T B
         WHERE B.DOC_NO     = A.RO_DOC_NO
           AND B.DLR_CD     = A.DLR_CD
           AND A.DLR_CD     = #{sDlrCd}
           AND A.RO_DOC_NO  = #{sRoDocNo}
           AND B.PREFIX_ID  = 'RO'
           AND A.RO_TP      = '02'
           AND A.GOODWILL_YN = 'Y'
           AND A.GOODWILL_STAT_CD = 'O'
           AND NOT EXISTS(
                          SELECT CH.DLR_CD
                                ,CH.RO_DOC_NO
                                ,CH.RO_TP
                                ,CH.VIN_NO
                                ,CH.CLAIM_DOC_NO
                                ,PT.ITEM_CD
                                ,PT.LINE_NO
                            FROM SE_0710T CH, SE_0711T PT
                           WHERE PT.DLR_CD       = CH.DLR_CD
                             AND PT.RO_DOC_NO    = CH.RO_DOC_NO
                             AND PT.CLAIM_DOC_NO = CH.CLAIM_DOC_NO
                             AND CH.CLAIM_STAT_CD  <![CDATA[<>]]>   'C'
                             AND CH.DLR_CD       = A.DLR_CD
                             AND CH.RO_DOC_NO    = A.RO_DOC_NO
                             AND CH.VIN_NO       = A.VIN_NO
                             AND CH.RO_TP        = A.RO_TP
                             AND PT.ITEM_CD      = B.ITEM_CD
           )

    </select>

    <!-- GOODWILL RO 부품 정보조회 -->
    <select id="selectClaimRequestForRoGoodWillPartByCondition" parameterType="ClaimReqSearchVO" resultType="ClaimReqPartVO">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForRoGoodWillPartByCondition] */

        SELECT T1.*
              ,CASE WHEN T1.CR_ITEM_CD = T1.ITEM_CD THEN 'Y' END AS CAU_ITEM_YN
          FROM (
                 SELECT A.DLR_CD
                       ,A.RO_DOC_NO
                       ,B.LINE_NO
                       ,B.ITEM_CD
                       ,B.ITEM_NM
                       ,B.ITEM_SALE_PRC AS ITEM_PRC
                       ,B.ITEM_QTY
                       ,B.REQ_QTY
                       ,B.ITEM_TOT_AMT AS ITEM_AMT
                       ,NVL(B.CALC_UNIT_CD,'EA') AS SALE_UNIT_CD
                       ,B.CR_NO
                       ,B.GR_STRGE_CD
                       ,B.GI_STRGE_CD
                       ,B.GI_TP
                       ,B.DOC_NO
                       ,(SELECT CAU_ITEM_CD
                           FROM SE_1072T
                          WHERE CR_NO  = B.CR_NO
                            AND CR_TP  = B.CR_TP
                            AND LBR_CD = B.ITEM_CD
                            AND ROWNUM = 1
                        ) AS CR_ITEM_CD
               FROM SE_0300T A , SE_0160T B
              WHERE B.DOC_NO     = A.RO_DOC_NO
                AND B.DLR_CD     = A.DLR_CD
                AND A.DLR_CD     = #{sDlrCd}
                AND A.RO_DOC_NO  = #{sRoDocNo}
                AND B.PREFIX_ID  = 'RO'
                AND A.RO_TP      = '02'
                AND A.GOODWILL_YN = 'Y'
                AND A.GOODWILL_STAT_CD = 'O'
                AND NOT EXISTS(
                               SELECT CH.DLR_CD
                                     ,CH.RO_DOC_NO
                                     ,CH.RO_TP
                                     ,CH.VIN_NO
                                     ,CH.CLAIM_DOC_NO
                                     ,PT.ITEM_CD
                                     ,PT.LINE_NO
                                 FROM SE_0710T CH, SE_0711T PT
                                WHERE PT.DLR_CD       = CH.DLR_CD
                                  AND PT.RO_DOC_NO    = CH.RO_DOC_NO
                                  AND PT.CLAIM_DOC_NO = CH.CLAIM_DOC_NO
                                  AND CH.CLAIM_STAT_CD  <![CDATA[<>]]>   'C'
                                  AND CH.DLR_CD       = A.DLR_CD
                                  AND CH.RO_DOC_NO    = A.RO_DOC_NO
                                  AND CH.VIN_NO       = A.VIN_NO
                                  AND CH.RO_TP        = A.RO_TP
                                  AND PT.ITEM_CD      = B.ITEM_CD
                )
         )T1

    </select>


    <!-- RO 공임 갯수 정보조회 -->
    <select id="selectClaimRequestForRoLabourByConditionCnt" parameterType="ClaimReqSearchVO" resultType="int">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForRoLabourByConditionCnt] */


        SELECT COUNT(A.RO_DOC_NO) AS VALUE
          FROM SE_0300T A , SE_0170T B
         WHERE B.DOC_NO     = A.RO_DOC_NO
           AND B.DLR_CD     = A.DLR_CD
           AND B.RO_TP      = A.RO_TP
           AND A.DLR_CD     = #{sDlrCd}
           AND A.RO_DOC_NO  = #{sRoDocNo}
           AND B.PREFIX_ID  = 'RO'
           AND A.RO_TP      = '02'
           AND A.RO_STAT_CD IN ('00', '05')
           <choose>
               <when test=' sCrNo != null and sCrNo != "" '>
           AND B.CR_NO      = #{sCrNo}
               </when>
               <otherwise>
           AND B.CR_NO IS NULL
               </otherwise>
           </choose>
           AND NOT EXISTS(
                          SELECT CH.DLR_CD
                                ,CH.RO_DOC_NO
                                ,CH.RO_TP
                                ,CH.VIN_NO
                                ,CH.CLAIM_DOC_NO
                                ,CL.LBR_CD
                                ,CL.LINE_NO
                            FROM SE_0710T CH, SE_0712T CL
                           WHERE CL.DLR_CD       = CH.DLR_CD
                             AND CL.RO_DOC_NO    = CH.RO_DOC_NO
                             AND CL.CLAIM_DOC_NO = CH.CLAIM_DOC_NO
                             AND CH.CLAIM_STAT_CD  <![CDATA[<>]]>   'C'
                             AND CH.DLR_CD       = A.DLR_CD
                             AND CH.RO_DOC_NO    = A.RO_DOC_NO
                             AND CH.VIN_NO       = A.VIN_NO
                             AND CH.RO_TP        = A.RO_TP
                             AND CL.LBR_CD       = B.LBR_CD
           )

    </select>

    <!-- RO 공임 정보조회 -->
    <select id="selectClaimRequestForRoLabourByCondition" parameterType="ClaimReqSearchVO" resultType="ClaimReqLbrVO">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForRoLabourByCondition] */

        SELECT T1.*
              ,CASE WHEN T1.CR_LBR_CD = T1.LBR_CD
              THEN
              NVL(                                      --외주공임이 없을때 모두 주업무, 있을때 ZZ공임이 아닌 공임 중 하나만 주업무
               (SELECT 'Y'
                  FROM DUAL
                 WHERE 'ZZ' NOT IN (SELECT SUBSTR(C1.LBR_CD,-2,2)
                                      FROM SE_0170T C1
                                     WHERE C1.DLR_CD  = T1.DLR_CD
                                       AND C1.PREFIX_ID = 'RO'
                                       AND C1.DOC_NO    = T1.RO_DOC_NO
                                       AND C1.RO_TP =   '02'
                                   )
               )
               ,DECODE(T1.LBR_CD,(SELECT C2.LBR_CD
                                   FROM SE_0170T C2
                                  WHERE C2.DLR_CD  = T1.DLR_CD
                                       AND C2.PREFIX_ID = 'RO'
                                       AND C2.DOC_NO    = T1.RO_DOC_NO
                                       AND C2.RO_TP =   '02'
                                       AND SUBSTR(C2.LBR_CD,-2,2) != 'ZZ'
                                       AND ROWNUM = 1
                                 ),'Y','N')
              )
              END AS  CAU_LBR_YN
        FROM(
             SELECT A.DLR_CD
                   ,A.RO_DOC_NO
                   ,B.LINE_NO
                   ,B.LBR_CD
                   ,B.LBR_NM
                   ,B.LBR_TP
                   ,B.LBR_QTY
                   ,B.LBR_PRC
                   ,B.LBR_HM
                   <choose>
                    <when test=' sCrNo != null and sCrNo != ""'>
                   ,(SELECT CAU_CD
                      FROM SE_1072T
                     WHERE CR_NO  = B.CR_NO
                       AND LBR_CD = B.LBR_CD
                       AND ROWNUM = 1
                       ) AS CAU_CD
                    ,(SELECT CAU_NM
                      FROM SE_1072T
                     WHERE CR_NO  = B.CR_NO
                       AND LBR_CD = B.LBR_CD
                       AND ROWNUM = 1
                       ) AS CAU_NM
                   ,(SELECT PHEN_CD
                      FROM SE_1072T
                     WHERE CR_NO  = B.CR_NO
                       AND LBR_CD = B.LBR_CD
                       AND ROWNUM = 1 ) AS PHEN_CD
                   ,(SELECT PHEN_NM
                      FROM SE_1072T
                     WHERE CR_NO  = B.CR_NO
                       AND LBR_CD = B.LBR_CD
                       AND ROWNUM = 1 ) AS PHEN_NM
                    </when>
                    <otherwise>
                   ,B.CAU_CD
                   ,B.CAU_NM
                   ,B.PHEN_CD
                   ,B.PHEN_NM
                    </otherwise>
                  </choose>
                   ,LBR_TOT_AMT AS LBR_AMT
                   ,B.CR_NO
                   ,B.CR_TP
                   ,(SELECT LBR_CD
                       FROM SE_1072T
                      WHERE CR_NO  = B.CR_NO
                        AND CR_TP  = B.CR_TP
                        AND LBR_CD = B.LBR_CD
                        AND DLR_CD = B.DLR_CD
                        AND ROWNUM = 1
                    ) AS CR_LBR_CD
                   ,(SELECT 'N'
                       FROM SE_1140T
                      WHERE LTS_MODEL_CD = #{sLtsModelCd}
                        AND TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'),'YYYYMMDD') BETWEEN APPLY_START_DT AND APPLY_END_DT
                        AND SUB_LBR_CD   = B.LBR_CD
                    ) AS REL_CAU_LBR_YN
                    ,B.DSTIN_CD
                    ,(SELECT LBR_TP FROM SE_1060T WHERE DSTIN_CD = B.DSTIN_CD AND DLR_CD = DECODE(B.DSTIN_CD, 'H', 'A07AA', B.DLR_CD) AND LBR_CD = B.LBR_CD) AS LBR_TP
                    ,(SELECT LBR_CD_TP FROM SE_1060T WHERE DSTIN_CD = B.DSTIN_CD AND DLR_CD = DECODE(B.DSTIN_CD, 'H', 'A07AA', B.DLR_CD) AND LBR_CD = B.LBR_CD) AS LBR_CD_TP
               FROM SE_0300T A , SE_0170T B
              WHERE B.DOC_NO     = A.RO_DOC_NO
                AND B.DLR_CD     = A.DLR_CD
                AND B.RO_TP      = A.RO_TP
                AND A.DLR_CD     = #{sDlrCd}
                AND A.RO_DOC_NO  = #{sRoDocNo}
                AND B.PREFIX_ID  = 'RO'
                AND A.RO_TP      = '02'
                AND A.RO_STAT_CD IN ('00', '05')
                <choose>
                    <when test=' sCrNo != null and sCrNo != "" '>
                AND B.CR_NO      = #{sCrNo}
                    </when>
                    <otherwise>
                AND B.CR_NO IS NULL
                    </otherwise>
                </choose>
                AND NOT EXISTS(
                               SELECT CH.DLR_CD
                                     ,CH.RO_DOC_NO
                                     ,CH.RO_TP
                                     ,CH.VIN_NO
                                     ,CH.CLAIM_DOC_NO
                                     ,CL.LBR_CD
                                     ,CL.LINE_NO
                                 FROM SE_0710T CH, SE_0712T CL
                                WHERE CL.DLR_CD       = CH.DLR_CD
                                  AND CL.RO_DOC_NO    = CH.RO_DOC_NO
                                  AND CL.CLAIM_DOC_NO = CH.CLAIM_DOC_NO
                                  AND CH.CLAIM_STAT_CD  <![CDATA[<>]]>   'C'
                                  AND CH.DLR_CD       = A.DLR_CD
                                  AND CH.RO_DOC_NO    = A.RO_DOC_NO
                                  AND CH.VIN_NO       = A.VIN_NO
                                  AND CH.RO_TP        = A.RO_TP
                                  AND CL.LBR_CD       = B.LBR_CD
                )
        )T1

    </select>

    <!-- RO 공임 정보조회 -->
    <select id="selectClaimRequestForRoLabourByCondition_BACK" parameterType="ClaimReqSearchVO" resultType="ClaimReqLbrVO">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForRoLabourByCondition] */

        SELECT T1.*
              ,CASE WHEN T1.CR_LBR_CD = T1.LBR_CD THEN 'Y' END AS  CAU_LBR_YN
        FROM(
             SELECT A.DLR_CD
                   ,A.RO_DOC_NO
                   ,B.LINE_NO
                   ,B.LBR_CD
                   ,B.LBR_NM
                   ,B.LBR_TP
                   ,B.LBR_QTY
                   ,B.LBR_PRC
                   ,B.LBR_HM
                   <choose>
                    <when test=' sCrNo != null and sCrNo != ""'>
                   ,(SELECT CAU_CD
                      FROM SE_1072T
                     WHERE CR_NO  = B.CR_NO
                       AND LBR_CD = B.LBR_CD
                       AND ROWNUM = 1
                       ) AS CAU_CD
                    ,(SELECT CAU_NM
                      FROM SE_1072T
                     WHERE CR_NO  = B.CR_NO
                       AND LBR_CD = B.LBR_CD
                       AND ROWNUM = 1
                       ) AS CAU_NM
                   ,(SELECT PHEN_CD
                      FROM SE_1072T
                     WHERE CR_NO  = B.CR_NO
                       AND LBR_CD = B.LBR_CD
                       AND ROWNUM = 1 ) AS PHEN_CD
                   ,(SELECT PHEN_NM
                      FROM SE_1072T
                     WHERE CR_NO  = B.CR_NO
                       AND LBR_CD = B.LBR_CD
                       AND ROWNUM = 1 ) AS PHEN_NM
                    </when>
                    <otherwise>
                   ,B.CAU_CD
                   ,B.CAU_NM
                   ,B.PHEN_CD
                   ,B.PHEN_NM
                    </otherwise>
                  </choose>
                   ,LBR_TOT_AMT AS LBR_AMT
                   ,B.CR_NO
                   ,B.CR_TP
                   ,(SELECT LBR_CD
                       FROM SE_1072T
                      WHERE CR_NO = B.CR_NO
                        AND CR_TP = B.CR_TP
                        AND LBR_CD = B.LBR_CD
                        AND DLR_CD = B.DLR_CD
                        AND ROWNUM = 1
                    ) AS CR_LBR_CD
                   ,(SELECT 'N'
                       FROM SE_1140T
                      WHERE LTS_MODEL_CD = #{sLtsModelCd}
                        AND TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'),'YYYYMMDD') BETWEEN APPLY_START_DT AND APPLY_END_DT
                        AND SUB_LBR_CD = B.LBR_CD
                    ) AS REL_CAU_LBR_YN
                    ,B.DSTIN_CD
               FROM SE_0500T A , SE_0170T B
              WHERE B.DOC_NO     = A.CALC_DOC_NO
                AND B.DLR_CD     = A.DLR_CD
                AND B.RO_TP      = A.RO_TP
                AND A.DLR_CD     = #{sDlrCd}
                AND A.RO_DOC_NO  = #{sRoDocNo}
                AND B.PREFIX_ID  = 'CA'
                AND A.RO_TP      = '02'
                AND A.CALC_CANC_YN = 'N'
                <choose>
                    <when test=' sCrNo != null and sCrNo != "" '>
                AND B.CR_NO      = #{sCrNo}
                    </when>
                    <otherwise>
                AND B.CR_NO IS NULL
                    </otherwise>
                </choose>
                AND NOT EXISTS(
                               SELECT CH.DLR_CD
                                     ,CH.RO_DOC_NO
                                     ,CH.RO_TP
                                     ,CH.VIN_NO
                                     ,CH.CLAIM_DOC_NO
                                     ,CL.LBR_CD
                                     ,CL.LINE_NO
                                 FROM SE_0710T CH, SE_0712T CL
                                WHERE CL.DLR_CD       = CH.DLR_CD
                                  AND CL.RO_DOC_NO    = CH.RO_DOC_NO
                                  AND CL.CLAIM_DOC_NO = CH.CLAIM_DOC_NO
                                  AND CH.CLAIM_STAT_CD  <![CDATA[<>]]>   'C'
                                  AND CH.DLR_CD       = A.DLR_CD
                                  AND CH.RO_DOC_NO    = A.RO_DOC_NO
                                  AND CH.VIN_NO       = A.VIN_NO
                                  AND CH.RO_TP        = A.RO_TP
                                  AND CL.LBR_CD       = B.LBR_CD
                )
        )T1

    </select>

    <!--GOODWILL RO 공임 수 조회 -->
    <select id="selectClaimRequestForRoGoodWillLabourByConditionCnt" parameterType="ClaimReqSearchVO" resultType="int">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForRoGoodWillLabourByConditionCnt] */

        SELECT COUNT(B.LBR_CD) AS VALUE
          FROM SE_0300T A , SE_0170T B
         WHERE B.DOC_NO     = A.RO_DOC_NO
           AND B.DLR_CD     = A.DLR_CD
           AND B.RO_TP      = A.RO_TP
           AND A.DLR_CD     = #{sDlrCd}
           AND A.RO_DOC_NO  = #{sRoDocNo}
           AND B.PREFIX_ID  = 'RO'
           AND A.RO_TP      = '02'
            AND NOT EXISTS(
                          SELECT CH.DLR_CD
                                ,CH.RO_DOC_NO
                                ,CH.RO_TP
                                ,CH.VIN_NO
                                ,CH.CLAIM_DOC_NO
                                ,CL.LBR_CD
                                ,CL.LINE_NO
                            FROM SE_0710T CH, SE_0712T CL
                           WHERE CL.DLR_CD       = CH.DLR_CD
                             AND CL.RO_DOC_NO    = CH.RO_DOC_NO
                             AND CL.CLAIM_DOC_NO = CH.CLAIM_DOC_NO
                             AND CH.CLAIM_STAT_CD <![CDATA[<>]]> 'C'
                             AND CH.DLR_CD       = A.DLR_CD
                             AND CH.RO_DOC_NO    = A.RO_DOC_NO
                             AND CH.VIN_NO       = A.VIN_NO
                             AND CH.RO_TP        = A.RO_TP
                             AND CL.LBR_CD       = B.LBR_CD
           )

    </select>

    <!--GOODWILL RO 공임 정보조회 -->
    <select id="selectClaimRequestForRoGoodWillLabourByCondition" parameterType="ClaimReqSearchVO" resultType="ClaimReqLbrVO">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForRoGoodWillLabourByCondition] */

        SELECT T1.*
           ,CASE WHEN T1.CR_LBR_CD = T1.LBR_CD
           THEN
           NVL(                                      --외주공임이 없을때 모두 주업무, 있을때 ZZ공임이 아닌 공임 중 하나만 주업무
               (SELECT 'Y'
                  FROM DUAL
                 WHERE 'ZZ' NOT IN (SELECT SUBSTR(C1.LBR_CD,-2,2)
                                      FROM SE_0170T C1
                                     WHERE C1.DLR_CD  = T1.DLR_CD
                                       AND C1.PREFIX_ID = 'RO'
                                       AND C1.DOC_NO    = T1.RO_DOC_NO
                                       AND C1.RO_TP =   '02'
                                   )
               )
               ,DECODE(T1.LBR_CD,(SELECT C2.LBR_CD
                                   FROM SE_0170T C2
                                  WHERE C2.DLR_CD  = T1.DLR_CD
                                       AND C2.PREFIX_ID = 'RO'
                                       AND C2.DOC_NO    = T1.RO_DOC_NO
                                       AND C2.RO_TP =   '02'
                                       AND SUBSTR(C2.LBR_CD,-2,2) != 'ZZ'
                                       AND ROWNUM = 1
                                 ),'Y','N')
           )
           END AS  CAU_LBR_YN
        FROM(
             SELECT A.DLR_CD
                   ,A.RO_DOC_NO
                   ,B.LINE_NO
                   ,B.LBR_CD
                   ,B.LBR_NM
                   ,B.LBR_TP
                   ,B.LBR_QTY
                   ,B.LBR_PRC
                   ,B.LBR_HM
                   ,B.CAU_CD
                   ,B.CAU_NM
                   ,B.PHEN_CD
                   ,B.PHEN_NM
                   ,LBR_TOT_AMT AS LBR_AMT
                   ,B.CR_NO
                   ,B.CR_TP
                   ,(SELECT LBR_CD
                       FROM SE_1072T
                      WHERE CR_NO  = B.CR_NO
                        AND CR_TP  = B.CR_TP
                        AND LBR_CD = B.LBR_CD
                        AND DLR_CD = B.DLR_CD
                        AND ROWNUM = 1
                    ) AS CR_LBR_CD
                   ,(SELECT 'N'
                       FROM SE_1140T
                      WHERE LTS_MODEL_CD = #{sLtsModelCd}
                        AND TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'),'YYYYMMDD') BETWEEN APPLY_START_DT AND APPLY_END_DT
                        AND SUB_LBR_CD = B.LBR_CD
                    ) AS REL_CAU_LBR_YN
               FROM SE_0300T A , SE_0170T B
              WHERE B.DOC_NO     = A.RO_DOC_NO
                AND B.DLR_CD     = A.DLR_CD
                AND B.RO_TP      = A.RO_TP
                AND A.DLR_CD     = #{sDlrCd}
                AND A.RO_DOC_NO  = #{sRoDocNo}
                AND B.PREFIX_ID  = 'RO'
                AND A.RO_TP      = '02'
                 AND NOT EXISTS(
                               SELECT CH.DLR_CD
                                     ,CH.RO_DOC_NO
                                     ,CH.RO_TP
                                     ,CH.VIN_NO
                                     ,CH.CLAIM_DOC_NO
                                     ,CL.LBR_CD
                                     ,CL.LINE_NO
                                 FROM SE_0710T CH, SE_0712T CL
                                WHERE CL.DLR_CD       = CH.DLR_CD
                                  AND CL.RO_DOC_NO    = CH.RO_DOC_NO
                                  AND CL.CLAIM_DOC_NO = CH.CLAIM_DOC_NO
                                  AND CH.CLAIM_STAT_CD <![CDATA[<>]]> 'C'
                                  AND CH.DLR_CD       = A.DLR_CD
                                  AND CH.RO_DOC_NO    = A.RO_DOC_NO
                                  AND CH.VIN_NO       = A.VIN_NO
                                  AND CH.RO_TP        = A.RO_TP
                                  AND CL.LBR_CD       = B.LBR_CD
                )
        )T1

    </select>

    <!-- 클레임 정보조회 -->
    <select id="selectClaimRequestForClaimByKey" parameterType="ClaimReqSearchVO" resultType="ClaimReqVO">
     /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForClaimByKey] */

            SELECT
                 A.DLR_CD
                ,A.CLAIM_DOC_NO
                ,A.VIN_NO
                ,A.RO_DOC_NO
                ,A.CLAIM_YY
                ,A.RO_GRP_NO
                ,A.RO_TP
                ,B.RO_DT
                ,B.RO_STAT_CD
                ,A.CLAIM_TP
                ,A.CLAIM_STAT_CD
                ,A.CLAIM_VER_CD
                ,A.CAR_REG_NO
                ,A.LTS_MODEL_CD
                ,FN_SER_LTS_MODEL_NM( A.LTS_MODEL_CD,#{sLangCd}) AS LTS_MODEL_NM
                ,A.ENGIN_NO
                ,A.CAR_OWNER_ID
                ,A.CAR_OWNER_NM
                ,A.RUN_DIST_VAL
                ,(SELECT NVL(CAR_RUN_DIST_VAL,0)
                    FROM SA_0121T
                   WHERE VIN_NO = A.VIN_NO) AS LAST_RUN_DIST_VAL
                ,(SELECT CARLINE_CD
                    FROM SA_0121T
                   WHERE VIN_NO = A.VIN_NO) AS CARLINE_CD
                ,A.WART_DT
                ,A.CAR_DSTIN_CD
                ,A.CAU_OPER_ATC_CD
                ,A.CAU_OPER_ATC_NM
                ,A.CAU_ITEM_CD
                ,A.CAU_ITEM_NM
                ,A.CAU_CD
                ,A.CAU_NM
                ,A.PHEN_CD
                ,A.PHEN_NM
                ,A.RO_START_DT
                ,A.RO_END_DT
                ,A.CLAIM_START_DT
                ,A.CLAIM_END_DT
                ,A.PWA_APPROVE_NO
                ,A.CR_NO
                ,A.RESV_DOC_NO
                ,A.SUB_AMT
                ,A.SUB_DSTIN_CD
                ,A.BEF_RO_DT
                ,A.BEF_RUN_DIST_VAL
                ,A.BEF_RO_DOC_NO
                ,CASE WHEN A.CLAIM_STAT_CD ='A' THEN A.CONFIRM_LBR_AMT ELSE A.LBR_AMT END AS LBR_AMT
                ,CASE WHEN A.CLAIM_STAT_CD ='A' THEN A.CONFIRM_ITEM_AMT ELSE A.ITEM_AMT END AS ITEM_AMT
                ,A.VAT_AMT
                ,A.SUB_LBR_AMT
                ,A.SUB_ITEM_AMT
                ,A.DC_AMT
                ,CASE WHEN A.CLAIM_STAT_CD ='A'
                      THEN (NVL(A.CONFIRM_LBR_AMT,0)+NVL(A.CONFIRM_ITEM_AMT,0)+NVL(A.SUB_LBR_AMT,0)+NVL(A.SUB_ITEM_AMT,0))
                      ELSE A.TOT_AMT END AS TOT_AMT
                ,A.CLAIM_REQ_DT
                ,A.REMARK
                ,A.AS_PAR_WART_DSTIN_CD
                ,A.CLAIM_TCAV_NO
                ,A.FILE_KEY_NM
                ,A.BRAND_CD
                ,A.REG_DT
                ,DTC1_USE_YN
                ,DTC2_USE_YN
                ,DTC3_USE_YN
                ,DTC4_USE_YN
                ,DTC1_CD
                ,DTC2_CD
                ,DTC3_CD
                ,DTC4_CD
            FROM SE_0710T A , SE_0300T B
           WHERE A.DLR_CD = #{sDlrCd}
            <if test='sClaimDocNo != null and sClaimDocNo != ""'>
            AND A.CLAIM_DOC_NO = #{sClaimDocNo}
            </if>
            <if test='sRoDocNo != null and sRoDocNo != ""'>
            AND A.RO_DOC_NO = #{sRoDocNo}
            </if>
            <if test='sVinNo != null and sVinNo != ""'>
            AND A.VIN_NO    = #{sVinNo}
            </if>
            AND B.DLR_CD    = A.DLR_CD
            AND B.RO_DOC_NO = A.RO_DOC_NO
            AND B.VIN_NO    = A.VIN_NO
            AND B.RO_TP     = A.RO_TP
    </select>

    <!-- 클레임 부품 정보조회 -->
    <select id="selectClaimRequestForClaimPartByCondition" parameterType="ClaimReqSearchVO" resultType="ClaimReqPartVO">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForClaimPartByCondition] */

        SELECT ROWNUM AS RNUM
              ,A.DLR_CD
              ,A.CLAIM_DOC_NO
              ,A.LINE_NO
              ,A.RO_DOC_NO
              ,A.ITEM_CD
              ,A.ITEM_NM
              ,A.ITEM_PRC
              ,NVL(A.CONFIRM_ITEM_AMT,A.ITEM_AMT) AS ITEM_AMT
              ,A.SALE_UNIT_CD
              ,A.ITEM_QTY
              ,A.REQ_QTY
              ,A.CONFIRM_ITEM_AMT
              ,A.CR_NO
              ,A.GR_STRGE_CD
              ,A.GI_STRGE_CD
              ,A.CAU_ITEM_YN
              ,A.CLAIM_YY
              ,NVL(A.NPNP_MAX_AMT,0) AS NPNP_MAX_AMT
              ,NVL(NPNP_YN,'N') AS NPNP_YN
              ,A.REQ_QTY
              ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = B.VIN_NO AND ROWNUM = 1) AS MODEL_NM
              ,(SELECT FN_CMM_CD_NM('SAL120', CAR_DSTIN_CD, #{sLangCd}, 'N') AS CAR_DSTIN_CD FROM SA_0121T WHERE VIN_NO = B.VIN_NO AND ROWNUM = 1) AS CAR_DSTIN_NM
          FROM SE_0711T A, SE_0710T B
         WHERE A.DLR_CD = B.DLR_CD
           AND A.CLAIM_DOC_NO = B.CLAIM_DOC_NO
           AND A.DLR_CD       = #{sDlrCd}
           <if test='sClaimDocNo != null and sClaimDocNo != ""'>
               AND A.CLAIM_DOC_NO = #{sClaimDocNo}
           </if>
           <if test='sRoDocNo != null and sRoDocNo != ""'>
               AND A.RO_DOC_NO    = #{sRoDocNo}
           </if>
           <if test='sClaimStatCd != null and sClaimStatCd != ""'>
               AND B.CLAIM_STAT_CD = #{sClaimStatCd}
           </if>
           <if test='sClaimFromDt !=null'>
               AND B.CLAIM_START_DT <![CDATA[>=]]> #{sClaimFromDt}
           </if>
           <if test='sClaimToDt !=null'>
               AND B.CLAIM_START_DT <![CDATA[<=]]> #{sClaimToDt}+1
           </if>
           <if test='sClaimConfirmFromDt !=null'>
               AND B.CLAIM_CONFIRM_DT <![CDATA[>=]]> #{sClaimConfirmFromDt}
           </if>
           <if test='sClaimConfirmToDt !=null'>
               AND B.CLAIM_CONFIRM_DT <![CDATA[<=]]> #{sClaimConfirmToDt}+1
           </if>
        ORDER BY
            <choose>
                <when test='sort != null'>
                <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                    <choose>
                        <when test='item.field == "claimDocNo"'>  A.CLAIM_DOC_NO  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "itemCd"'>      A.ITEM_CD       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "itemNm"'>      A.ITEM_NM       <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "roDocNo"'>     A.RO_DOC_NO     <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <otherwise>
                         A.CLAIM_DOC_NO
                        </otherwise>
                    </choose>
                </foreach>
                </when>
                <otherwise>
                 A.CLAIM_DOC_NO
                </otherwise>
            </choose>
    </select>

     <!-- 索赔申请页面客户主诉信息查询 -->
    <select id="selectClaimRequestForClaimCustRemarkByCondition" parameterType="ClaimReqSearchVO" resultType="ClaimReqCustRemarkVO">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForClaimCustRemarkByCondition] */
      	SELECT 
      		A.LINE_NO
      	   ,A.CUST_REQ_CONT 
		FROM SE_0130T A
		WHERE DLR_CD = #{sDlrCd}
		AND JOB_NO = #{sRoDocNo}
		ORDER BY
            <choose>
                <when test='sort != null'>
                <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                    <choose>
                        <when test='item.field == "lineNo"'>  A.LINE_NO  <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <otherwise>
                         A.LINE_NO
                        </otherwise>
                    </choose>
                </foreach>
                </when>
                <otherwise>
                 A.LINE_NO
                </otherwise>
            </choose>
	</select>
    <!-- 클레임 부품 갯수 정보조회 -->
    <select id="selectClaimRequestForClaimPartByConditionCnt" parameterType="ClaimReqSearchVO" resultType="int">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForClaimPartByConditionCnt] */

        SELECT COUNT(A.CLAIM_DOC_NO) AS VALUE
          FROM SE_0711T A, SE_0710T B
         WHERE A.DLR_CD = B.DLR_CD
           AND A.CLAIM_DOC_NO = B.CLAIM_DOC_NO
           AND A.DLR_CD       = #{sDlrCd}
           <if test='sClaimDocNo != null and sClaimDocNo != ""'>
               AND A.CLAIM_DOC_NO = #{sClaimDocNo}
           </if>
           <if test='sRoDocNo != null and sRoDocNo != ""'>
               AND A.RO_DOC_NO    = #{sRoDocNo}
           </if>
           <if test='sClaimStatCd != null and sClaimStatCd != ""'>
               AND B.CLAIM_STAT_CD = #{sClaimStatCd}
           </if>
           <if test='sClaimFromDt !=null'>
               AND B.CLAIM_START_DT <![CDATA[>=]]> #{sClaimFromDt}
           </if>
           <if test='sClaimToDt !=null'>
               AND B.CLAIM_START_DT <![CDATA[<=]]> #{sClaimToDt}+1
           </if>
           <if test='sClaimConfirmFromDt !=null'>
               AND B.CLAIM_CONFIRM_DT <![CDATA[>=]]> #{sClaimConfirmFromDt}
           </if>
           <if test='sClaimConfirmToDt !=null'>
               AND B.CLAIM_CONFIRM_DT <![CDATA[<=]]> #{sClaimConfirmToDt}+1
           </if>
    </select>

    <!-- 클레임 공임 정보조회 -->
    <select id="selectClaimRequestForClaimLabourByCondition" parameterType="ClaimReqSearchVO" resultType="ClaimReqLbrVO">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForClaimLabourByCondition] */

        SELECT ROWNUM AS RNUM
              ,A.DLR_CD
              ,A.CLAIM_DOC_NO
              ,A.LINE_NO
              ,A.RO_DOC_NO
              ,A.LBR_CD
              ,A.LBR_NM
              ,A.LBR_PRC
              ,A.LBR_HM
              ,A.LBR_QTY
              ,NVL(A.COMFIRM_LBR_AMT , A.LBR_AMT )AS LBR_AMT
              ,A.COMFIRM_LBR_AMT
              ,A.CR_NO
              ,A.CLAIM_YY
              ,A.CAU_LBR_YN
              <choose>
                <when test=' sCrNo != null and sCrNo != ""'>
                ,(SELECT CAU_CD
                   FROM SE_1072T
                  WHERE CR_NO  = A.CR_NO
                    AND LBR_CD = A.LBR_CD
                    AND ROWNUM = 1
                  ) AS CAU_CD
                ,(SELECT PHEN_CD
                    FROM SE_1072T
                   WHERE CR_NO  = A.CR_NO
                     AND LBR_CD = A.LBR_CD
                     AND ROWNUM = 1 ) AS PHEN_CD
                </when>
                <otherwise>
                 ,(SELECT CAU_CD
                   FROM SE_0170T
                  WHERE PREFIX_ID ='RO'
                    AND DLR_CD = A.DLR_CD
                    AND DOC_NO = A.RO_DOC_NO
                    AND LBR_CD = A.LBR_CD
                    AND ROWNUM = 1) AS  CAU_CD
                 ,(SELECT PHEN_CD
                    FROM SE_0170T
                   WHERE PREFIX_ID ='RO'
                     AND DLR_CD = A.DLR_CD
                     AND DOC_NO = A.RO_DOC_NO
                     AND LBR_CD = A.LBR_CD
                     AND ROWNUM = 1) PHEN_CD
                </otherwise>
              </choose>
              ,(SELECT 'N'
                 FROM SE_1140T
                WHERE LTS_MODEL_CD = #{sLtsModelCd}
                  AND TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'),'YYYYMMDD') BETWEEN APPLY_START_DT AND APPLY_END_DT
                  AND SUB_LBR_CD = A.LBR_CD
               ) AS REL_CAU_LBR_YN
              ,NVL(A.DSTIN_CD,'H') AS DSTIN_CD
              ,(SELECT LBR_TP FROM SE_1060T WHERE DSTIN_CD = A.DSTIN_CD AND DLR_CD = DECODE(A.DSTIN_CD, 'H', 'A07AA', A.DLR_CD) AND LBR_CD = A.LBR_CD) AS LBR_TP
              ,(SELECT LBR_CD_TP FROM SE_1060T WHERE DSTIN_CD = A.DSTIN_CD AND DLR_CD = DECODE(A.DSTIN_CD, 'H', 'A07AA', A.DLR_CD) AND LBR_CD = A.LBR_CD) AS LBR_CD_TP
          FROM SE_0712T A
         WHERE A.DLR_CD        = #{sDlrCd}
           AND A.CLAIM_DOC_NO  = #{sClaimDocNo}
           AND A.RO_DOC_NO     = #{sRoDocNo}

    </select>
    <!-- 클레임 공임 정보조회 -->
    <select id="selectClaimRequestForClaimLabourByConditionCnt" parameterType="ClaimReqSearchVO" resultType="int">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestForClaimLabourByConditionCnt] */

        SELECT COUNT(A.CLAIM_DOC_NO) AS VALUE
          FROM SE_0712T A
         WHERE A.DLR_CD = #{sDlrCd}
           AND A.CLAIM_DOC_NO = #{sClaimDocNo}
           AND A.RO_DOC_NO = #{sRoDocNo}

    </select>

    <!-- 클레임 반송원인 조회 -->
    <select id="selectClaimRequestReturnByCondition" parameterType="ClaimReqSearchVO" resultType="ClaimReqRtnVO">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestReturnByCondition] */

        SELECT ROWNUM AS RNUM
             ,A.DLR_CD
             ,A.CLAIM_DOC_NO
             ,A.VIN_NO
             ,A.RO_DOC_NO
             ,A.CLAIM_STAT_CD
             ,A.CLAIM_YY
             ,B.CLAIM_VER_CD
             ,B.ERR_CD
             ,B.ERR_NM
         FROM SE_0710T A , SE_0713T B
        WHERE A.DLR_CD = B.DLR_CD
          AND A.CLAIM_DOC_NO = B.CLAIM_DOC_NO
          AND A.RO_DOC_NO = B.RO_DOC_NO
          AND A.CLAIM_YY = B.CLAIM_YY
          AND A.CLAIM_VER_CD = B.CLAIM_VER_CD
          <if test='sDlrCd != null and sDlrCd != ""'>
            AND A.DLR_CD = #{sDlrCd}
          </if>
          <if test='sClaimDocNo != null and sClaimDocNo!= ""'>
            AND A.CLAIM_DOC_NO = #{sClaimDocNo}
          </if>
          <if test='sRoDocNo != null and sRoDocNo != ""'>
            AND A.RO_DOC_NO = #{sRoDocNo}
          </if>
          ORDER BY B.ERR_CD

    </select>

    <!-- 클레임 PIO 부품 사용 내역 조회 -->
    <select id="selectClaimRequestChkPioItems" parameterType="ClaimReqVO" resultType="int">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestChkPioItems] */

        SELECT COUNT(ITEM_CD) AS VALUE
          FROM SE_0714T
        WHERE ITEM_CD = #{cauItemCd}
          AND USE_YN  ='Y'

    </select>

    <!-- 클레임 청구/취소 체크 -->
    <select id="selectClaimRequestChk" parameterType="hMap" resultType="hMap">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.selectClaimRequestChk] */
    <![CDATA[

        SELECT CANCEL_YN
              ,SUBMIT_YN
              ,B.RETURN_APPROVE_NO
              ,B.PWA_APPROVE_NO
              ,A.CLM_PWA_APPROVE_NO
              ,CASE WHEN  B.RETURN_APPROVE_NO IS NULL
                    THEN 'Y' ELSE ( CASE WHEN A.CLM_PWA_APPROVE_NO IS NULL THEN 'N' ELSE 'Y' END ) END RETURN_YN
        FROM (
            SELECT DLR_CD
                  ,CLAIM_DOC_NO
                  ,RO_DOC_NO,VIN_NO
                  ,CLAIM_REQ_DT
                  ,CLAIM_STAT_CD
                  ,PWA_APPROVE_NO AS CLM_PWA_APPROVE_NO
                  ,CASE WHEN CLAIM_STAT_CD = 'Q'
                             AND TO_CHAR(SYSDATE,'YYYYMMDD HH24:MI')  >=  TO_CHAR(SYSDATE,'YYYYMMDD')||' ${cancelStartHm}'
                             AND TO_CHAR(SYSDATE,'YYYYMMDD HH24:MI')  <=  TO_CHAR(SYSDATE,'YYYYMMDD')||' ${cancelEndHm}'
                             AND TO_CHAR(CLAIM_REQ_DT,'YYYYMMDD')      = TO_CHAR(SYSDATE,'YYYYMMDD')
                        THEN 'Y'
                        ELSE 'N'
                        END AS CANCEL_YN
                  ,CASE WHEN (TO_CHAR(SYSDATE,'YYYYMMDD HH24:MI')  >= TO_CHAR(SYSDATE,'YYYYMMDD')||' ${submitStartHm}'
                          AND TO_CHAR(SYSDATE,'YYYYMMDD HH24:MI')  <= TO_CHAR(SYSDATE,'YYYYMMDD')||' ${submitEndHm}' )
                        THEN 'Y'
                        ELSE 'N' END  AS SUBMIT_YN
              FROM SE_0710T
             WHERE DLR_CD       = #{dlrCd}
               AND CLAIM_DOC_NO = #{claimDocNo}
               AND RO_DOC_NO    = #{roDocNo}
        ) A LEFT OUTER JOIN SE_0760T B
         ON A.DLR_CD         = B.DLR_CD
        AND A.VIN_NO         = B.VIN_NO
        AND B.RETURN_STAT_CD ='A'
        AND B.PWA_USE_YN     ='N'

    ]]>
    </select>

    <!-- Claim 데이타 Rollback. : 프로시져  -->
    <insert id="updateClaimReqRollBack" parameterType="ClaimReqVO" statementType="CALLABLE">
        {CALL SP_SER_CLAIM_REQ_ROLLBACK(
              #{dlrCd, mode=IN, jdbcType=VARCHAR}
            , #{claimDocNo, mode=IN, jdbcType=VARCHAR}
            , #{roDocNo, mode=IN, jdbcType=VARCHAR}
            , #{claimOrgStatCd, mode=IN, jdbcType=VARCHAR}
            , #{claimOrgReqDt, mode=IN, jdbcType=VARCHAR}
        )}
    </insert>

    <!-- Claim 데이타 TEMP로 전송. : 프로시져  -->
    <insert id="insertClaimToTemp" parameterType="ClaimReqVO" statementType="CALLABLE">
        {CALL SP_SER_CLAIM_REQ(
              #{dlrCd, mode=IN, jdbcType=VARCHAR}
            , #{claimDocNo, mode=IN, jdbcType=VARCHAR}
            , #{roDocNo, mode=IN, jdbcType=VARCHAR}
        )}
    </insert>

    <!-- RO 클레임의 가격(ITEM_SALE_PRC)가 BMP 부품(BMP_PURC_PRC) 가격 update -->
    <update id="itemSalePrcJudgeUpdate" parameterType="ClaimReqSearchVO">
      /* [chn.bhmc.dms.ser.wac.service.dao.ClaimRequestDAO.itemSalePrcJudgeUpdate] */
            UPDATE SE_0160T
            SET
            ITEM_SALE_PRC = (SELECT BMP_PURC_PRC
                    FROM PT_0214T
                     WHERE ITEM_CD = #{sItemCd}
                     AND DLR_CD    = #{sDlrCd}
                     AND ROWNUM    = 1 )
            WHERE DOC_NO = #{sRoDocNo}
            AND ITEM_CD  = #{sItemCd}
            AND DLR_CD   = #{sDlrCd}
    </update>

</mapper>
