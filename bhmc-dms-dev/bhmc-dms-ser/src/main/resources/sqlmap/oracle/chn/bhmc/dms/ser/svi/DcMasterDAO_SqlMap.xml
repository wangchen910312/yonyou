<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- SQL File Name : DcMasterDAO_SqlMap.xml Description : 할인관리 마스터에 관한 데이터처리
    author Yin Xueyuan since 2016. 2. 16. version 1.0 Modification Information
    since author description =========== ============= ===========================
    2016. 2. 16. Yin Xueyuan 최초 생성 -->

<mapper namespace="chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO">

    <!-- 할인관리 등록 -->
    <insert id="insertDcMaster" parameterType="DcMasterVO">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.insertDcMaster] */
        INSERT INTO SE_1015T --할인정보
        (
        DLR_CD --딜러코드
        ,DC_CD --할인코드
        ,DC_TP --할인유형
        ,DC_NM --할인명
        ,LBR_DC_RATE --공임할인율
        ,LBR_DC_AMT --공임할인금액
        ,PAR_DC_RATE --부품할인율
        ,PAR_DC_AMT --부품할인금액
        ,SUB_DC_RATE --외주할인율
        ,SUB_DC_AMT --외주할인금액
        ,TOT_DC_RATE --총할인율
        ,TOT_DC_AMT --총할인금액
        ,DC_APPLY_START_DT --할인적용시작일자
        ,DC_APPLY_END_DT --할인적용종료일자
        ,DC_SCORE_VAL --할인순위값
        ,DC_USE_YN --할인사용여부
        ,REG_USR_ID --등록자ID
        ,REG_DT --등록일자
        ,UPDT_USR_ID --수정자ID
        ,UPDT_DT --수정일자
        ,DC_DSTIN_CD --할인구분코드
        ,DC_PERM_TP --할인권한유형
        )
        VALUES
        (
        #{dlrCd} --딜러코드
        ,#{dcCd} --할인코드
        ,#{dcTp} --할인유형
        ,#{dcNm} --할인명
        ,#{lbrDcRate} --공임할인율
        ,#{lbrDcAmt} --공임할인금액
        ,#{parDcRate} --부품할인율
        ,#{parDcAmt} --부품할인금액
        ,#{subDcRate} --외주할인율
        ,#{subDcAmt} --외주할인금액
        ,#{totDcRate} --총할인율
        ,#{totDcAmt} --총할인금액
        ,#{dcApplyStartDt} --할인적용시작일자
        ,#{dcApplyEndDt} --할인적용종료일자
        ,#{dcScoreVal} --할인순위값
        ,#{dcUseYn} --할인사용여부
        ,#{regUsrId} --등록자ID
        ,SYSDATE --등록일자
        ,#{updtUsrId} --수정자ID
        ,SYSDATE --수정일자
        ,#{dcDstinCd} --할인구분코드
        ,#{dcPermTp} --할인권한유형
        )
    </insert>

    <!-- 할인관리상세 등록 -->
    <insert id="insertDcDetail" parameterType="DcDetailVO">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.insertDcDetail] */

        INSERT INTO SE_1150T --할인관리대상
        (
        DLR_CD --딜러코드
        ,PREFIX_ID --PREFIX ID
        ,DC_CD --할인코드
        ,DC_SEQ --할인일련번호
        ,CUST_NO --고객번호
        ,CUST_NM --고객명
        ,TOT_CNT --총횟수
        ,USE_CNT --사용횟수
        ,USR_ID --사용자ID
        ,USR_NM --사용자명
        ,USE_YN --사용여부
        ,REG_USR_ID --등록자ID
        ,REG_DT --등록일자
        )
        VALUES
        (
        #{dlrCd} --딜러코드
        ,#{preFixId} --PREFIX ID
        ,#{dcCd} --할인코드
        ,(
        SELECT NVL(MAX(DC_SEQ),0)+1
        FROM SE_1150T
        WHERE DLR_CD = #{dlrCd}
        AND PREFIX_ID = #{preFixId}
        AND DC_CD = #{dcCd}
        ) --할인일련번호
        ,#{custNo} --고객번호
        ,#{custNm} --고객명
        ,#{totCnt} --총횟수
        ,#{useCnt} --사용횟수
        ,#{usrId} --사용자ID
        ,#{usrNm} --사용자명
        ,#{useYn} --사용여부
        ,#{regUsrId} --등록자ID
        ,SYSDATE --등록일자
        )
    </insert>

    <!-- 할인관리 수정 -->
    <update id="updateDcMaster" parameterType="DcMasterVO">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.updateDcMaster] */
        UPDATE SE_1015T --할인정보
        SET
        DC_TP = #{dcTp} --할인유형
        ,DC_NM = #{dcNm} --할인명
        ,DC_DSTIN_CD = #{dcDstinCd} --할인구분코드
        ,DC_PERM_TP = #{dcPermTp} --할인권한유형
        ,LBR_DC_RATE = #{lbrDcRate} --공임할인율
        ,LBR_DC_AMT = #{lbrDcAmt} --공임할인금액
        ,PAR_DC_RATE = #{parDcRate} --부품할인율
        ,PAR_DC_AMT = #{parDcAmt} --부품할인금액
        ,SUB_DC_RATE = #{subDcRate} --외주할인율
        ,SUB_DC_AMT = #{subDcAmt} --외주할인금액
        ,TOT_DC_RATE = #{totDcRate} --총할인율
        ,TOT_DC_AMT = #{totDcAmt} --총할인금액
        ,DC_APPLY_START_DT = #{dcApplyStartDt} --할인적용시작일자
        ,DC_APPLY_END_DT = #{dcApplyEndDt} --할인적용종료일자
        ,DC_SCORE_VAL = #{dcScoreVal} --할인순위값
        ,DC_USE_YN = #{dcUseYn} --할인사용여부
        ,UPDT_USR_ID = #{updtUsrId} --수정자ID
        ,UPDT_DT = SYSDATE --수정일자
        WHERE 1 = 1
        AND DC_CD = #{dcCd} --할인코드
        AND DLR_CD = #{dlrCd} --딜러코드
	</update>

    <!-- 할인관리상세 수정 -->
    <update id="updateDcDetail" parameterType="DcDetailVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.updateDcDetail]
        */
        UPDATE SE_1150T --할인관리대상
        SET UPDT_USR_ID = #{updtUsrId} --수정자ID
        ,UPDT_DT = #{updtDt} --수정일자
        <if test='custNo != null and custNo != ""'>
            ,CUST_NO = #{custNo} --고객번호
              </if>
        <if test='custNm != null and custNm != ""'>
            ,CUST_NM = #{custNm} --고객명
              </if>
        <if test='totCnt != null and totCnt != ""'>
            ,TOT_CNT = #{totCnt} --총횟수
              </if>
        <if test='useCnt != null and useCnt != ""'>
            ,USE_CNT = #{useCnt} --사용횟수
              </if>
        <if test='usrId != null and usrId != ""'>
            ,USR_ID = #{usrId} --사용자ID
              </if>
        <if test='usrNm != null and usrNm != ""'>
            ,USR_NM = #{usrNm} --사용자명
              </if>
        <if test='useYn != null and useYn != ""'>
            ,USE_YN = #{useYn} --사용여부
              </if>
        WHERE 1 = 1
        AND PREFIX_ID = #{preFixId} --PREFIX_ID
        AND DC_CD = #{dcCd} --할인코드
        AND DC_SEQ = #{dcSeq} --할인일련번호
        AND DLR_CD = #{dlrCd} --딜러코드
    </update>

    <!-- 할인관리 삭제 -->
    <delete id="deleteDcMaster" parameterType="DcMasterVO">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.deleteDcMaster] */
        DELETE FROM SE_1015T
        WHERE 1 = 1
        AND DC_CD = #{dcCd} --할인코드
        AND DLR_CD = #{dlrCd} --딜러코드
    </delete>

    <!-- 할인관리 상세 삭제 -->
    <delete id="deleteDcDetail" parameterType="DcDetailVO">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.deleteDcDetail] */
        DELETE FROM SE_1150T
        WHERE 1 = 1
        AND PREFIX_ID = #{preFixId} --PREFIX_ID
        AND DC_CD = #{dcCd} --할인코드
        AND DC_SEQ = #{dcSeq} --할인일련번호
        AND DLR_CD = #{dlrCd} --딜러코드
    </delete>

    <!-- 할인관리 리스트 -->
    <select id="selectDcMasterByCondition" parameterType="DcMasterSearchVO" resultType="DcMasterVO">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.selectDcMasterByCondition]
        */
        SELECT * FROM (
        SELECT ROWNUM AS RNUM, T1.* FROM (
        SELECT *
        FROM SE_1015T T1
        <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND DLR_CD = #{sDlrCd}
                    </if>
            <if test='sDcTp != null and sDcTp != ""'>
                AND DC_TP = #{sDcTp}
                    </if>
            <if test='sDcDstinCd != null and sDcDstinCd != ""'>
                AND DC_DSTIN_CD = #{sDcDstinCd}
                    </if>
            <if test='sDcCd != null and sDcCd != ""'>
                AND DC_CD LIKE '%'|| #{sDcCd} || '%'
                    </if>
            <if test='sDcNm != null and sDcNm != ""'>
                AND DC_NM LIKE '%'|| #{sDcNm} ||'%'
                    </if>
            <if test='sDcUseYn != null and sDcUseYn != ""'>
                AND DC_USE_YN = #{sDcUseYn}
                    </if>
            <if test='sDcPermTp != null and sDcPermTp != ""'>
                AND DC_PERM_TP = #{sDcPermTp}
                    </if>
            <if test='sDcPermTpLst        != null and !sDcPermTpLst.isEmpty'>
                AND DC_PERM_TP IN
                <foreach item="item" index="index" collection="sDcPermTpLst"
                    open="(" separator="," close=")">
                    #{item}
                       </foreach>
            </if>--할인권한코드
            <if test='sToday != null '>
                AND #{sToday} BETWEEN DC_APPLY_START_DT AND DC_APPLY_END_DT
            </if>
        </where>
        ORDER BY
        <choose>
            <when test='sort != null'>
                <foreach item="item" index="index" collection="sort"
                    open="" separator="," close="">
                    <choose>
                        <when test='item.field == "dlrCd"'> T1.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                        <when test='item.field == "dcCd"'> T1.DC_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                        <when test='item.field == "dcTp"'> T1.DC_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                        <when test='item.field == "dcNm"'> T1.DC_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                        <when test='item.field == "lbrDcRate"'> T1.LBR_DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                        <when test='item.field == "lbrDcAmt"'> T1.LBR_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                        <when test='item.field == "parDcRate"'> T1.PAR_DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                        <when test='item.field == "parDcAmt"'> T1.PAR_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                        <when test='item.field == "subDcRate"'> T1.SUB_DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                        <when test='item.field == "subDcAmt"'> T1.SUB_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                        <when test='item.field == "totDcRate"'> T1.TOT_DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                        <when test='item.field == "totDcAmt"'> T1.TOT_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                        <when test='item.field == "dcApplyStartDt"'> T1.DC_APPLY_START_DT
                            <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "dcApplyEndDt"'> T1.DC_APPLY_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                        <when test='item.field == "dcScoreVal"'> T1.DC_SCORE_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                        <when test='item.field == "dcUseYn"'> T1.DC_USE_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                        <when test='item.field == "regUsrId"'> T1.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                        <when test='item.field == "regDt"'> T1.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                        <when test='item.field == "updtUsrId"'> T1.UPDT_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                        <when test='item.field == "updtDt"'> T1.UPDT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                        <otherwise>
                            T1.DLR_CD ASC ,T1.DC_CD ASC
                                 </otherwise>
                    </choose>
                </foreach>
            </when>
            <otherwise>
                T1.DLR_CD ASC ,T1.DC_CD ASC
                    </otherwise>
        </choose>
        ) T1
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                ROWNUM <![CDATA[<=]]>
                #{lastIndex}
            </if>
        </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 할인관리 목록수 -->
    <select id="selectDcMasterByConditionCnt" parameterType="DcMasterSearchVO"
        resultType="int">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.selectDcMasterByConditionCnt]
        */
        SELECT COUNT(*) AS VALUE
        FROM SE_1015T
        <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND DLR_CD = #{sDlrCd}
            </if>
            <if test='sDcTp != null and sDcTp != ""'>
                AND DC_TP = #{sDcTp}
            </if>
            <if test='sDcDstinCd != null and sDcDstinCd != ""'>
                AND DC_DSTIN_CD = #{sDcDstinCd}
            </if>
            <if test='sDcCd != null and sDcCd != ""'>
                AND DC_CD LIKE '%'|| #{sDcCd} || '%'
            </if>
            <if test='sDcNm != null and sDcNm != ""'>
                AND DC_NM LIKE '%'|| #{sDcNm} ||'%'
            </if>
            <if test='sDcUseYn != null and sDcUseYn != ""'>
                AND DC_USE_YN = #{sDcUseYn}
            </if>
            <if test='sDcPermTp != null and sDcPermTp != ""'>
                AND DC_PERM_TP = #{sDcPermTp}
            </if>
            <if test='sDcPermTpLst        != null and !sDcPermTpLst.isEmpty'>
                AND DC_PERM_TP IN
                <foreach item="item" index="index" collection="sDcPermTpLst"
                    open="(" separator="," close=")">
                    #{item}
               </foreach>
            </if>--할인권한코드
            <if test='sToday != null '>
                AND #{sToday} BETWEEN DC_APPLY_START_DT AND DC_APPLY_END_DT
            </if>
        </where>
    </select>

    <!-- 할인관리 상세 목록수 -->
    <select id="selectDcDetailByConditionCnt" parameterType="DcMasterSearchVO"
        resultType="int">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.selectDcDetailByConditionCnt]
        */
        SELECT COUNT(DC_SEQ) AS VALUE
        FROM SE_1150T M1
        LEFT JOIN SE_1026T T1 ON M1.DLR_CD = T1.DLR_CD AND M1.USR_ID = T1.TEC_ID
        LEFT JOIN CM_0801T V1 ON M1.USR_ID = V1.USR_ID
        LEFT JOIN CM_3401T V2 ON V1.DEPT_CD = V2.DEPT_CD AND V2.CMP_TP = '10'
        LEFT JOIN CM_2801T V3 ON V1.TSK_CD = V3.TSK_CD AND V3.CMP_TP = '10'
        <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND M1.DLR_CD = #{sDlrCd} --딜러코드
                    </if>
            <if test='sDcPermTp != null and sDcPermTp != ""'>
                AND M1.DC_PERM_TP = #{sDcPermTp} --할인권한구분
                    </if>
            <if test='sDcCd != null and sDcCd != ""'>
                AND M1.DC_CD = #{sDcCd} --할인코드
                    </if>
            <if test='sPreFixId != null and sPreFixId != ""'>
                AND M1.PREFIX_ID = #{sPreFixId}
                    </if>
        </where>
    </select>

    <!-- 할인관리 상세 목록 -->
    <select id="selectDcDetailByCondition" parameterType="DcMasterSearchVO"
        resultType="DcDetailVO">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.selectDcDetailByCondition]
        */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT
                    M1.DLR_CD
                    ,M1.PREFIX_ID
                    ,M1.DC_CD
                    ,M1.DC_SEQ
                    ,M1.CUST_NO
                    ,M1.CUST_NM
                    ,M1.TOT_CNT
                    ,M1.USE_CNT
                    ,M1.USR_ID
                    ,M1.USR_NM
                    ,M1.USE_YN
                    ,T1.SYS_NO
                    ,V1.TSK_CD
                    ,V1.DEPT_CD
                    ,V2.DEPT_NM
                    ,V3.TSK_NM
                    FROM SE_1150T M1
                    LEFT JOIN SE_1026T T1 ON M1.DLR_CD = T1.DLR_CD AND M1.USR_ID = T1.TEC_ID
                    LEFT JOIN CM_0801T V1 ON M1.USR_ID = V1.USR_ID
                    LEFT JOIN CM_3401T V2 ON V1.DEPT_CD = V2.DEPT_CD AND V2.CMP_TP = '10'
                    LEFT JOIN CM_2801T V3 ON V1.TSK_CD = V3.TSK_CD AND V3.CMP_TP = '10'
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        AND M1.DLR_CD = #{sDlrCd} --딜러코드
                            </if>
                    <if test='sDcPermTp != null and sDcPermTp != ""'>
                        AND M1.DC_PERM_TP = #{sDcPermTp} --할인권한구분
                            </if>
                    <if test='sDcCd != null and sDcCd != ""'>
                        AND M1.DC_CD = #{sDcCd} --할인코드
                            </if>
                    <if test='sPreFixId != null and sPreFixId != ""'>
                        AND M1.PREFIX_ID = #{sPreFixId}
                            </if>
                </where>
                ORDER BY
                <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort"
                            open="" separator="," close="">
                            <choose>
                                <when test='item.field == "dlrCd"'> M1.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                <when test='item.field == "dcCd"'> M1.DC_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                <when test='item.field == "dcSeq"'> M1.DC_SEQ <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                <when test='item.field == "custNo"'> M1.CUST_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                <when test='item.field == "custNm"'> M1.CUST_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                <when test='item.field == "totCnt"'> M1.TOT_CNT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                <when test='item.field == "useCnt"'> M1.USE_CNT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                <when test='item.field == "usrId"'> M1.USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                <when test='item.field == "usrNm"'> M1.USR_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                <when test='item.field == "useYn"'> M1.USE_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                <when test='item.field == "regUsrId"'> M1.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                <when test='item.field == "regDt"'> M1.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                <when test='item.field == "updtUsrId"'> M1.UPDT_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "updtDt"'> M1.UPDT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                <otherwise>
                                    M1.DLR_CD ASC ,M1.DC_CD ASC ,M1.DC_SEQ ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        M1.DLR_CD ASC ,M1.DC_CD ASC ,M1.DC_SEQ ASC
                    </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]>
                    #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 할인관리 상세정보 -->
    <select id="selectDcDetailByKey" parameterType="DcMasterSearchVO"
        resultType="DcDetailVO">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.selectDcDetailByKey]
        */
        SELECT *
        FROM SE_1150T
        WHERE DLR_CD = #{sDlrCd}
        AND DC_CD = #{sDcCd}
        AND PREFIX_ID = #{sPreFixId}
        AND DC_SEQ = #{sDcSeq}
    </select>

    <!-- 할인관리 리스트 -->
    <select id="selectEtcDcTargetByCondition" parameterType="DcMasterSearchVO" resultType="DcMasterVO">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.selectEtcDcTargetByCondition]
        */
        SELECT * FROM (
              SELECT ROWNUM AS RNUM
                    ,TA.DC_NM
                    ,TA.DC_CD
                    ,TA.DC_TP
                    ,CASE WHEN TA.SUB_DC_AMT <![CDATA[>]]> 0 THEN 0 ELSE LBR_DC_AMT END AS LBR_DC_AMT
                    ,CASE WHEN TA.SUB_DC_AMT <![CDATA[>]]> 0 THEN 0 ELSE PAR_DC_AMT END AS PAR_DC_AMT
                    ,TA.SUB_DC_AMT
                    ,TA.DC_DIVISION
                    ,(SELECT MESG_TXT
                        FROM CM_0501T
                       WHERE MESG_KEY = 'ser.lbl.dealer'
                         AND USE_YN = 'Y'
                         AND LANG_CD = #{sLangCd}
                      )AS DC_DSTIN_CD
                    ,TA.DC_APPLY_START_DT
                    ,TA.DC_APPLY_END_DT
                 FROM (
                  SELECT T2.PUBLI_NO AS DC_CD
                        ,T1.CUPN_NM  AS DC_NM
                        ,DECODE(T1.DC_CD, '01', '02', '01') AS DC_TP
                        ,NVL(DECODE(T1.DC_CD, '01', T1.LBR_DC_RATE, T1.LBR_DC_AMT), 0) AS LBR_DC_AMT
                        ,NVL(DECODE(T1.DC_CD, '01', T1.PAR_DC_RATE, T1.PAR_DC_AMT), 0) AS PAR_DC_AMT
                        ,NVL(DECODE(T1.DC_CD, '01', T1.TOT_DC_RATE, T1.TOT_DC_AMT), 0) AS SUB_DC_AMT
                        ,'CRM' AS DC_DIVISION
                        ,T2.CUPN_FROM_DT AS DC_APPLY_START_DT
                        ,T2.CUPN_TO_DT   AS DC_APPLY_END_DT
                    FROM CR_0823T T1 INNER JOIN CR_0825T T2 ON T1.DLR_CD = T2.DLR_CD
                    AND T1.CUPN_SEQ = T2.CUPN_SEQ
                    AND T1.DLR_CD = #{sDlrCd}
                    AND T2.USE_YN = 'N'
                    AND T2.PUBLI_CD = '01'
                    AND (T1.DC_USE_TP = '01' OR T1.DC_USE_TP = #{sDcUseTp})
                    AND T2.CUST_NO = #{sCustNo}
                    AND TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN TO_CHAR(T2.CUPN_FROM_DT,'YYYYMMDD') AND TO_CHAR(T2.CUPN_TO_DT,'YYYYMMDD')
                 UNION ALL
                  SELECT T2.PUBLI_NO AS DC_CD
                        ,T1.CUPN_NM  AS DC_NM
                        ,DECODE(T1.DC_CD, '01', '02', '01') AS DC_TP
                        ,NVL(DECODE(T1.DC_CD, '01', T1.LBR_DC_RATE, T1.LBR_DC_AMT), 0) AS LBR_DC_AMT
                        ,NVL(DECODE(T1.DC_CD, '01', T1.PAR_DC_RATE, T1.PAR_DC_AMT), 0) AS PAR_DC_AMT
                        ,NVL(DECODE(T1.DC_CD, '01', T1.TOT_DC_RATE, T1.TOT_DC_AMT), 0) AS SUB_DC_AMT
                        ,'CRM' AS DC_DIVISION
                        ,T2.CUPN_FROM_DT AS DC_APPLY_START_DT
                        ,T2.CUPN_TO_DT   AS DC_APPLY_END_DT
                    FROM CR_0823T T1 INNER JOIN CR_0825T T2 ON T1.DLR_CD = T2.DLR_CD
                    AND T1.CUPN_SEQ = T2.CUPN_SEQ
                    AND T1.DLR_CD = #{sDlrCd}
                    AND T2.USE_YN = 'N'
                    AND T2.PUBLI_CD = '02'
                    AND (T1.DC_USE_TP = '01' OR T1.DC_USE_TP = #{sDcUseTp})
                    <choose>
                        <when test='sVinNo != null and sVinNo != ""'>
                            AND T2.VIN_NO = #{sVinNo}
                        </when>
                        <otherwise>
                            AND T2.VIN_NO IN (SELECT A.VIN_NO
                                                FROM SA_0121T A
                                               INNER JOIN SA_0123T B ON A.CAR_ID = B.CAR_ID
                                               WHERE B.DLR_CD = #{sDlrCd}
                                               AND B.BP_CD = #{sCustNo}
                                               AND B.USE_YN = 'Y')
                        </otherwise>
                    </choose>
                    AND TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN TO_CHAR(T2.CUPN_FROM_DT,'YYYYMMDD') AND TO_CHAR(T2.CUPN_TO_DT,'YYYYMMDD')
            ) TA
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
                <if test='sDcTp != null and sDcTp != "" '>
                    AND DC_TP  =  #{sDcTp}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 할인관리 리스트 -->
    <select id="selectEtcDcTargetByConditionCnt" parameterType="DcMasterSearchVO"
        resultType="int">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.selectEtcDcTargetByConditionCnt]
        */
        SELECT COUNT(*) FROM (
            SELECT T2.PUBLI_NO AS DC_CD
                ,T1.CUPN_NM AS DC_NM
                ,DECODE(T1.DC_CD, '01', '02', '01') AS DC_TP
                ,T1.LBR_DC_AMT
                ,T1.PAR_DC_AMT
                ,T1.TOT_DC_AMT AS SUB_DC_AMT
                ,T1.GOODS_CNT AS TOT_CNT
            FROM CR_0823T T1 INNER JOIN CR_0825T T2 ON T1.DLR_CD = T2.DLR_CD
            AND T1.CUPN_SEQ = T2.CUPN_SEQ
            AND T2.USE_YN = 'N'
            AND T2.PUBLI_CD = '01'
            AND T1.DLR_CD = #{sDlrCd}
            AND (T1.DC_USE_TP = '01' OR T1.DC_USE_TP = #{sDcUseTp})
            AND T2.CUST_NO = #{sCustNo}
            AND TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN TO_CHAR(T2.CUPN_FROM_DT,'YYYYMMDD') AND TO_CHAR(T2.CUPN_TO_DT,'YYYYMMDD')
            UNION ALL
            SELECT T2.PUBLI_NO AS DC_CD
                ,T1.CUPN_NM AS DC_NM
                ,DECODE(T1.DC_CD, '01', '02', '01') AS DC_TP
                ,T1.LBR_DC_AMT
                ,T1.PAR_DC_AMT
                ,T1.TOT_DC_AMT AS SUB_DC_AMT
                ,T1.GOODS_CNT AS TOT_CNT
            FROM CR_0823T T1 INNER JOIN CR_0825T T2 ON T1.DLR_CD = T2.DLR_CD
            AND T1.CUPN_SEQ = T2.CUPN_SEQ
            AND T2.USE_YN = 'N'
            AND T2.PUBLI_CD = '02'
            AND T1.DLR_CD = #{sDlrCd}
            AND (T1.DC_USE_TP = '01' OR T1.DC_USE_TP = #{sDcUseTp})
            <choose>
                <when test='sVinNo != null and sVinNo != ""'>
                    AND T2.VIN_NO = #{sVinNo}
                </when>
                <otherwise>
                    AND T2.VIN_NO IN (SELECT A.VIN_NO
                                        FROM SA_0121T A
                                       INNER JOIN SA_0123T B ON A.CAR_ID = B.CAR_ID
                                       WHERE B.DLR_CD = #{sDlrCd}
                                       AND B.BP_CD = #{sCustNo}
                                       AND B.USE_YN = 'Y')
                </otherwise>
            </choose>
            AND TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN TO_CHAR(T2.CUPN_FROM_DT,'YYYYMMDD') AND TO_CHAR(T2.CUPN_TO_DT,'YYYYMMDD')
        )
        <where>
          <if test='sDcTp != null and sDcTp != "" '>
           AND DC_TP  =  #{sDcTp}
        </if>
        </where>
    </select>

    <!-- 할인관리 리스트 -->
    <select id="selectEtcDcTargetByCondition_BAK" parameterType="DcMasterSearchVO"
        resultType="DcMasterVO">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.selectEtcDcTargetByCondition]
        */
        SELECT * FROM (
        SELECT ROWNUM AS RNUM, TA.* FROM (
        SELECT T1.*, T2.TOT_CNT, T2.USE_CNT, T2.PREFIX_ID, T2.DC_SEQ
        FROM SE_1015T T1, SE_1150T T2
        WHERE T1.DLR_CD = T2.DLR_CD
        AND T1.DC_CD = T2.DC_CD
        AND T1.DLR_CD = #{sDlrCd}
        AND T1.DC_USE_YN = 'Y'
        AND T1.DC_DSTIN_CD = 'ECT'
        AND T1.DC_PERM_TP = '01'
        AND T2.PREFIX_ID = '01'
        <if test='sSaId != null and sSaId != ""'>
            AND T2.USR_ID = #{sSaId}
        </if>
        <if test='sToday != null'>
            AND NVL(T1.DC_APPLY_START_DT, #{sToday}) <![CDATA[<=]]> #{sToday}
            AND NVL(T1.DC_APPLY_END_DT, #{sToday}) <![CDATA[>=]]> #{sToday} -1
        </if>

        UNION ALL

        SELECT T1.*, T2.TOT_CNT, T2.USE_CNT, T2.PREFIX_ID, T2.DC_SEQ
        FROM SE_1015T T1, SE_1150T T2
        WHERE T1.DLR_CD = T2.DLR_CD
        AND T1.DLR_CD = #{sDlrCd}
        AND T1.DC_CD = T2.DC_CD
        AND T1.DC_USE_YN = 'Y'
        AND T1.DC_DSTIN_CD = 'ECT'
        AND T1.DC_PERM_TP = '02'
        AND T2.PREFIX_ID = '02'
        <if test='sCustNo != null and sCustNo != ""'>
            AND T2.CUST_NO = #{sCustNo}
        </if>
        <if test='sToday != null'>
            AND NVL(T1.DC_APPLY_START_DT, #{sToday}) <![CDATA[<=]]> #{sToday}
            AND NVL(T1.DC_APPLY_END_DT, #{sToday}) <![CDATA[>=]]> #{sToday} -1
        </if>
        ) TA
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                ROWNUM <![CDATA[<=]]>
                #{lastIndex}
            </if>
        </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 할인관리 리스트 -->
    <select id="selectEtcDcTargetByConditionCnt_BAK" parameterType="DcMasterSearchVO"
        resultType="int">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.selectEtcDcTargetByConditionCnt]
        */
        SELECT COUNT(*) FROM (
        SELECT T1.*
        FROM SE_1015T T1, SE_1150T T2
        WHERE T1.DLR_CD = T2.DLR_CD
        AND T1.DC_CD = T2.DC_CD
        AND T1.DLR_CD = #{sDlrCd}
        AND T1.DC_USE_YN = 'Y'
        AND T1.DC_DSTIN_CD = 'ECT'
        AND T1.DC_PERM_TP = '01'
        AND T2.PREFIX_ID = '01'
        <if test='sSaId != null and sSaId != ""'>
            AND T2.USR_ID = #{sSaId}
        </if>
        <if test='sToday != null'>
            AND NVL(T1.DC_APPLY_START_DT, #{sToday}) <![CDATA[<=]]> #{sToday}
            AND NVL(T1.DC_APPLY_END_DT, #{sToday}) <![CDATA[>=]]> #{sToday} -1
        </if>

        UNION ALL

        SELECT T1.*
        FROM SE_1015T T1, SE_1150T T2
        WHERE T1.DLR_CD = T2.DLR_CD
        AND T1.DC_CD = T2.DC_CD
        AND T1.DLR_CD = #{sDlrCd}
        AND T1.DC_USE_YN = 'Y'
        AND T1.DC_DSTIN_CD = 'ECT'
        AND T1.DC_PERM_TP = '02'
        AND T2.PREFIX_ID = '02'
        <if test='sCustNo != null and sCustNo != ""'>
            AND T2.CUST_NO = #{sCustNo}
        </if>
        <if test='sToday != null'>
            AND NVL(T1.DC_APPLY_START_DT, #{sToday}) <![CDATA[<=]]> #{sToday}
            AND NVL(T1.DC_APPLY_END_DT, #{sToday}) <![CDATA[>=]]> #{sToday} -1
        </if>
        )
    </select>

    <!-- 할인관리 대상 리스트 -->
    <select id="selectDcAuthByCondition" parameterType="DcMasterSearchVO"
        resultType="DcMasterVO">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.selectDcAuthByCondition]
        */
        SELECT * FROM (
        SELECT ROWNUM AS RNUM, T1.* FROM (
        SELECT A.*
        FROM SE_1015T A , SE_1150T B
        WHERE A.DLR_CD = B.DLR_CD
        AND A.DC_CD = B.DC_CD
        AND A.DC_PERM_TP = B.PREFIX_ID
        AND ( (A.DC_PERM_TP ='01' AND B.USR_ID = #{sUserId} )
        OR (A.DC_PERM_TP ='02' AND B.CUST_NO =#{sCustNo} )
        OR (A.DC_PERM_TP ='03' AND B.USR_ID = #{sUserId} )
        )
        <if test='sDlrCd != null and sDlrCd != ""'>
            AND A.DLR_CD = #{sDlrCd}
        </if>
        <if test='sDcTp != null and sDcTp != ""'>
            AND DC_TP = #{sDcTp}
        </if>
        <if test='sDcDstinCd != null and sDcDstinCd != ""'>
            AND A.DC_DSTIN_CD = #{sDcDstinCd}
        </if>
        <if test='sDcCd != null and sDcCd != ""'>
            AND DC_CD LIKE '%'|| #{sDcCd} || '%'
        </if>
        <if test='sDcNm != null and sDcNm != ""'>
            AND DC_NM LIKE '%'|| #{sDcNm} ||'%'
        </if>
        <if test='sDcUseYn != null and sDcUseYn != ""'>
            AND A.DC_USE_YN = #{sDcUseYn}
        </if>
        <if test='sToday != null'>
            AND NVL(A.DC_APPLY_START_DT, #{sToday}) <![CDATA[<=]]> #{sToday}
            AND NVL(A.DC_APPLY_END_DT, #{sToday}) <![CDATA[>=]]> #{sToday} -1
        </if>
        <if test='sDcPermTpLst != null and !sDcPermTpLst.isEmpty'>
            AND DC_PERM_TP IN
            <foreach item="item" index="index" collection="sDcPermTpLst"
                open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        ORDER BY
        <choose>
            <when test='sort != null'>
                <foreach item="item" index="index" collection="sort"
                    open="" separator="," close="">
                    <choose>
                        <when test='item.field == "dlrCd"'> A.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                        <when test='item.field == "dcCd"'> A.DC_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                        <when test='item.field == "dcTp"'> A.DC_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                        <when test='item.field == "dcNm"'> A.DC_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>            </when>
                        <when test='item.field == "lbrDcRate"'> A.LBR_DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                        <when test='item.field == "lbrDcAmt"'> A.LBR_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                        <when test='item.field == "parDcRate"'> A.PAR_DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                        <when test='item.field == "parDcAmt"'> A.PAR_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                        <when test='item.field == "subDcRate"'> A.SUB_DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                        <when test='item.field == "subDcAmt"'> A.SUB_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                        <when test='item.field == "totDcRate"'> A.TOT_DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                        <when test='item.field == "totDcAmt"'> A.TOT_DC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                        <when test='item.field == "dcApplyStartDt"'> A.DC_APPLY_START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                        <when test='item.field == "dcApplyEndDt"'> A.DC_APPLY_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                        <when test='item.field == "dcScoreVal"'> A.DC_SCORE_VAL <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                        <when test='item.field == "dcUseYn"'> A.DC_USE_YN <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                        <when test='item.field == "regUsrId"'> A.REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                        <when test='item.field == "regDt"'> A.REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>           </when>
                        <when test='item.field == "updtUsrId"'> A.UPDT_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                        <when test='item.field == "updtDt"'> A.UPDT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                        <otherwise>
                            A.DLR_CD ASC ,A.DC_CD ASC
                                 </otherwise>
                    </choose>
                </foreach>
            </when>
            <otherwise>
                A.DLR_CD ASC ,A.DC_CD ASC
                    </otherwise>
        </choose>
        ) T1
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                ROWNUM <![CDATA[<=]]>
                #{lastIndex}
            </if>
        </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 할인관리 목록수 -->
    <select id="selectDcAuthByConditionCnt" parameterType="DcMasterSearchVO"
        resultType="int">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.selectDcAuthByConditionCnt]
        */
        SELECT COUNT(A.DC_CD)AS VALUE
        FROM SE_1015T A , SE_1150T B
        WHERE A.DLR_CD = B.DLR_CD
        AND A.DC_CD = B.DC_CD
        AND A.DC_PERM_TP = B.PREFIX_ID
        AND ( (A.DC_PERM_TP ='01' AND B.USR_ID = #{sUserId} )
        OR (A.DC_PERM_TP ='02' AND B.CUST_NO =#{sCustNo} )
        OR (A.DC_PERM_TP ='03' AND B.USR_ID = #{sUserId} )
        )
        <if test='sDlrCd != null and sDlrCd != ""'>
            AND A.DLR_CD = #{sDlrCd}
        </if>
        <if test='sDcTp != null and sDcTp != ""'>
            AND DC_TP = #{sDcTp}
        </if>
        <if test='sDcDstinCd != null and sDcDstinCd != ""'>
            AND A.DC_DSTIN_CD = #{sDcDstinCd}
        </if>
        <if test='sDcCd != null and sDcCd != ""'>
            AND DC_CD LIKE '%'|| #{sDcCd} || '%'
        </if>
        <if test='sDcNm != null and sDcNm != ""'>
            AND DC_NM LIKE '%'|| #{sDcNm} ||'%'
        </if>
        <if test='sDcUseYn != null and sDcUseYn != ""'>
            AND A.DC_USE_YN = #{sDcUseYn}
        </if>
        <if test='sToday != null'>
            AND NVL(A.DC_APPLY_START_DT, #{sToday}) <![CDATA[<=]]> #{sToday}
            AND NVL(A.DC_APPLY_END_DT, #{sToday}) <![CDATA[>=]]> #{sToday} -1
        </if>
        <if test='sDcPermTpLst        != null and !sDcPermTpLst.isEmpty'>
            AND DC_PERM_TP IN
            <foreach item="item" index="index" collection="sDcPermTpLst"
                open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
    </select>

    <!-- .부품 할인 최대율 -->
    <select id="selectParMaxDcRateByCondition" parameterType="DcMasterSearchVO" resultType="DcMasterVO">
        /*
        [chn.bhmc.dms.ser.svi.service.dao.DcMasterDAO.selectParMaxDcRateByCondition]
        */
        SELECT T.*
          FROM SE_1015T T
         WHERE (T.DLR_CD, T.PAR_DC_RATE) IN (
            SELECT A.DLR_CD, MAX(A.PAR_DC_RATE) AS PAR_DC_RATE
            FROM SE_1015T A , SE_1150T B
            WHERE A.DLR_CD = B.DLR_CD
            AND A.DC_CD = B.DC_CD
            AND A.DC_PERM_TP = B.PREFIX_ID
            AND ( (A.DC_PERM_TP ='01' AND B.USR_ID = #{sUserId} )
            OR (A.DC_PERM_TP ='02' AND B.CUST_NO =#{sCustNo} )
            OR (A.DC_PERM_TP ='03' AND B.USR_ID = #{sUserId} )
            )
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND A.DLR_CD = #{sDlrCd}
            </if>
            <if test='sDcTp != null and sDcTp != ""'>
                AND DC_TP = #{sDcTp}
            </if>
            <if test='sDcDstinCd != null and sDcDstinCd != ""'>
                AND A.DC_DSTIN_CD = #{sDcDstinCd}
            </if>
            <if test='sDcCd != null and sDcCd != ""'>
                AND DC_CD LIKE '%'|| #{sDcCd} || '%'
            </if>
            <if test='sDcNm != null and sDcNm != ""'>
                AND DC_NM LIKE '%'|| #{sDcNm} ||'%'
            </if>
            <if test='sDcUseYn != null and sDcUseYn != ""'>
                AND A.DC_USE_YN = #{sDcUseYn}
            </if>
            <if test='sToday != null'>
                AND NVL(A.DC_APPLY_START_DT, #{sToday}) <![CDATA[<=]]> #{sToday}
                AND NVL(A.DC_APPLY_END_DT, #{sToday}) <![CDATA[>=]]> #{sToday} -1
            </if>
            <if test='sDcPermTpLst != null and !sDcPermTpLst.isEmpty'>
                AND DC_PERM_TP IN
                <foreach item="item" index="index" collection="sDcPermTpLst"
                    open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            GROUP BY A.DLR_CD
          )
        AND ROWNUM = 1
    </select>

</mapper>