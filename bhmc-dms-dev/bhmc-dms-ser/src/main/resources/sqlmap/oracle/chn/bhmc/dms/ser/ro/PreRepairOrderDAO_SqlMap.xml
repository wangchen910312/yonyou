<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : PreRepairOrderDAO_SqlMap.xml
    Description : RO에 관한 데이터처리
    author KyungMok Kim
    since 2016. 03. 14.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 03. 14.  KyungMok Kim     최초 생성
-->

<mapper namespace="chn.bhmc.dms.ser.ro.service.dao.PreRepairOrderDAO">

    <!-- RO접수 등록. -->
    <insert id="insertPreRepairOrder" parameterType="PreRepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.PreRepairOrderDAO.insertPreRepairOrder] */
        INSERT INTO SE_0340T    --미리정비마스터
        (
          DLR_CD                          --딜러코드
         ,PRE_RO_DOC_NO                   --이전RO문서번호
         ,PRE_RO_TP                           --RO유형
         ,PRE_RO_STAT_CD                      --RO상태코드
         ,PRE_RO_DT                           --RO일자
         ,RO_DOC_NO                       --RO문서번호
         ,RO_GRP_NO                       --RO그룹번호
         ,RESV_DOC_NO                     --예약문서번호
         ,VIN_NO                          --차대번호
         ,CAR_REG_NO                      --차량등록번호
         ,ENGIN_NO                        --엔진번호
         ,CAR_OWNER_ID                    --차량소유자ID
         ,CAR_OWNER_NM                    --차량소유자명
         ,DRIVER_ID                       --운전자ID
         ,DRIVER_NM                       --운전자명
         ,RESV_TP                         --예약유형
         ,RESV_DT                         --예약일자
         ,BAY_NO                          --베이번호
         ,TEC_ID                          --TechManID
         ,TEC_NM                          --TechMan명
         ,SA_ID                           --SAID
         ,SA_NM                           --SA명
         ,OPER_RESV_DT                    --작업예약일자
         ,PAR_AMT                         --부품금액
         ,LBR_AMT                         --공임금액
         ,ETC_AMT                         --기타금액
         ,DC_AMT                          --할인금액
         ,SUM_AMT                         --합계금액
         ,VAT_AMT                         --부가가치세금액
         ,TOT_AMT                         --총금액
         ,BAL_AMT                         --예치금액
         ,CANC_REASON_CD                  --취소사유코드
         ,CANC_REASON_CONT                --취소사유내용
         ,DIST_UNIT_CD                    --거리단위코드
         ,RUN_DIST_VAL                    --주행거리값
         ,DIAG_DOC_NO                     --진단문서번호
         ,BASE_RO_NO                      --원RO번호
         ,INC_REQ_NO                      --보험신청번호
         ,CUST_WAIT_MTH_CD                --고객대기방법코드
         ,ATQ_PROC_TP                     --고품처리유형
         ,CAR_WASH_TP                     --차량세차유형
         ,CAR_DRIVE_REQ_TP                --차량시승요청유형
         ,EXPC_DL_DT                      --예정인도일자
         ,ATQ_PROC_YN                     --고품처리여부
         ,CAR_WASH_YN                     --차량세차여부
         ,VSIT_CAR_RECEIVE_DT             --방문차량수령일자
         ,VSIT_CAR_RECEIVE_IF_NM          --방문차량수령연계인명
         ,VSIT_CAR_RECEIVE_CI_NO          --방문차량수령연락처번호
         ,VSIT_CAR_RECEIVE_ADDR_NM        --방문차량수령주소명
         ,CAR_RECEIVE_DT                  --차량수령일자
         ,VSIT_DL_IF_NM                   --방문인도연계인명
         ,VSIT_DL_CI_NO                   --방문인도연락처번호
         ,VSIT_DL_ADDR_NM                 --방문인도주소명
         ,VSIT_DT                         --방문일자
         ,VSIT_IF_NM                      --방문연계인명
         ,VSIT_CI_NO                      --방문연락처번호
         ,VSIT_ADDR_NM                    --방문주소명
         ,ALLOC_EMP_ID                    --배정자ID
         ,SER_RESV_END_DT                 --서비스예약종료일자
         ,INC_REQ_DT                      --보험신청일자
         ,CAR_WASH_STAT_CD                --세차상태코드
         ,PAINT_STAT_CD                   --페인트상태코드
         ,QT_TEST_STAT_CD                 --품질검사상태코드
         ,PAINT_QTY                       --페인트수량
         ,PAINT_COLOR_CD                  --페인트색상코드
         ,CAR_COLOR_CD                    --차량색상코드
         ,PAINT_TP                        --페인트유형
         ,RO_START_DT                     --RO시작일자
         ,RO_END_DT                       --RO종료일자
         ,RO_REMARK                       --RO비고
         ,WRK_ALLOC_YN                    --작업배정여부
         ,QT_TEST_MTH_CD                  --품질검사방법코드
         ,CHG_EXPC_DL_DT                  --변경예정인도일자
         ,CAU_CD1                         --원인코드1
         ,CAU_NM1                         --원인명1
         ,PHEN_CD1                        --현상코드1
         ,PHEN_NM1                        --현상명1
         ,CAU_CD2                         --원인코드2
         ,CAU_NM2                         --원인명2
         ,PHEN_CD2                        --현상코드2
         ,PHEN_NM2                        --현상명2
         ,ROAD_TEST_CD                    --도로검사코드
         ,PRE_AMT                         --선수금금액
         ,REG_USR_ID                      --등록자ID
         ,REG_DT                          --등록일자
        )
        VALUES
        (
          #{dlrCd}                          --딜러코드
         ,#{preRoDocNo}                     --이전RO문서번호
         ,#{preRoTp}                           --RO유형
         ,#{preRoStatCd}                       --RO상태코드
         ,SYSDATE                           --RO일자
         ,#{roDocNo}                        --RO문서번호
         ,#{roGrpNo}                        --RO그룹번호
         ,#{resvDocNo}                      --예약문서번호
         ,#{vinNo}                          --차대번호
         ,#{carRegNo}                       --차량등록번호
         ,#{enginNo}                        --엔진번호
         ,#{carOwnerId}                     --차량소유자ID
         ,#{carOwnerNm}                     --차량소유자명
         ,#{driverId}                       --운전자ID
         ,#{driverNm}                       --운전자명
         ,#{resvTp}                         --예약유형
         ,#{resvDt}                         --예약일자
         ,#{bayNo}                          --베이번호
         ,#{tecId}                          --TechManID
         ,#{tecNm}                          --TechMan명
         ,#{saId}                           --SAID
         ,#{saNm}                           --SA명
         ,#{operResvDt}                     --작업예약일자
         ,#{parAmt}                         --부품금액
         ,#{lbrAmt}                         --공임금액
         ,#{etcAmt}                         --기타금액
         ,#{dcAmt}                          --할인금액
         ,#{sumAmt}                         --합계금액
         ,#{vatAmt}                         --부가가치세금액
         ,#{totAmt}                         --총금액
         ,#{balAmt}                         --예치금액
         ,#{cancReasonCd}                   --취소사유코드
         ,#{cancReasonCont}                 --취소사유내용
         ,#{distUnitCd}                     --거리단위코드
         ,#{runDistVal}                     --주행거리값
         ,#{diagDocNo}                      --진단문서번호
         ,#{baseRoNo}                       --원RO번호
         ,#{incReqNo}                       --보험신청번호
         ,#{custWaitMthCd}                  --고객대기방법코드
         ,#{atqProcTp}                      --고품처리유형
         ,#{carWashTp}                      --차량세차유형
         ,#{carDriveReqTp}                  --차량시승요청유형
         ,#{expcDlDt}                       --예정인도일자
         ,'N'                      --고품처리여부
         ,'N'                      --차량세차여부
         ,#{vsitCarReceiveDt}               --방문차량수령일자
         ,#{vsitCarReceiveIfNm}             --방문차량수령연계인명
         ,#{vsitCarReceiveCiNo}             --방문차량수령연락처번호
         ,#{vsitCarReceiveAddrNm}           --방문차량수령주소명
         ,#{carReceiveDt}                   --차량수령일자
         ,#{vsitDlIfNm}                     --방문인도연계인명
         ,#{vsitDlCiNo}                     --방문인도연락처번호
         ,#{vsitDlAddrNm}                   --방문인도주소명
         ,#{vsitDt}                         --방문일자
         ,#{vsitIfNm}                       --방문연계인명
         ,#{vsitCiNo}                       --방문연락처번호
         ,#{vsitAddrNm}                     --방문주소명
         ,#{allocEmpId}                     --배정자ID
         ,#{serResvEndDt}                   --서비스예약종료일자
         ,#{incReqDt}                       --보험신청일자
         ,#{carWashStatCd}                  --세차상태코드
         ,#{paintStatCd}                    --페인트상태코드
         ,#{qtTestStatCd}                   --품질검사상태코드
         ,#{paintQty}                       --페인트수량
         ,#{paintColorCd}                   --페인트색상코드
         ,#{carColorCd}                     --차량색상코드
         ,#{paintTp}                        --페인트유형
         ,#{roStartDt}                      --RO시작일자
         ,#{roEndDt}                        --RO종료일자
         ,#{roRemark}                       --RO비고
         ,'N'                     --작업배정여부
         ,#{qtTestMthCd}                    --품질검사방법코드
         ,#{chgExpcDlDt}                    --변경예정인도일자
         ,#{cauCd1}                         --원인코드1
         ,#{cauNm1}                         --원인명1
         ,#{phenCd1}                        --현상코드1
         ,#{phenNm1}                        --현상명1
         ,#{cauCd2}                         --원인코드2
         ,#{cauNm2}                         --원인명2
         ,#{phenCd2}                        --현상코드2
         ,#{phenNm2}                        --현상명2
         ,#{roadTestCd}                     --도로검사코드
         ,#{preAmt}                         --선수금금액
         ,#{regUsrId}                       --등록자ID
         ,SYSDATE                          --등록일자
        )
    </insert>

    <!-- RO접수  수정. -->
    <update id="updatePreRepairOrder" parameterType="PreRepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.PreRepairOrderDAO.updatePreRepairOrder] */
        UPDATE SE_0340T SET
            UPDT_USR_ID              = #{updtUsrId}                           --수정자ID
            ,UPDT_DT                  = SYSDATE                          --수정일자
            <if test='preRoTp != null and preRoTp != ""'>
            ,PRE_RO_TP                     = #{preRoTp}                            --RO유형
            </if>
            <if test='roDocNo != null and roDocNo != ""'>
            ,RO_DOC_NO              = #{roDocNo}                      --예약문서번호
            </if>
            <if test='resvDocNo != null and resvDocNo != ""'>
            ,RESV_DOC_NO              = #{resvDocNo}                      --예약문서번호
            </if>
            <if test='preRoStatCd != null and preRoStatCd != ""'>
            ,PRE_RO_STAT_CD              = #{preRoStatCd}                      --예약문서번호
            </if>
            <if test='vinNo != null and vinNo != ""'>
            ,VIN_NO                   = #{vinNo}                          --차대번호
            </if>
            <if test='carRegNo != null and carRegNo != ""'>
            ,CAR_REG_NO               = #{carRegNo}                       --차량등록번호
            </if>
            <if test='enginNo != null and enginNo != ""'>
            ,ENGIN_NO                 = #{enginNo}                  --엔진시리얼번호
            </if>
            <if test='carOwnerId != null and carOwnerId != ""'>
            ,CAR_OWNER_ID             = #{carOwnerId}                       --차량소유자ID
            </if>
            <if test='carOwnerNm != null and carOwnerNm != ""'>
            ,CAR_OWNER_NM             = #{carOwnerNm}                       --차량소유자명
            </if>
            <if test='driverId != null and driverId != ""'>
            ,DRIVER_ID                = #{driverId}                       --운전자ID
            </if>
            <if test='driverNm != null and driverNm != ""'>
            ,DRIVER_NM                = #{driverNm}                       --운전자명
            </if>
            <if test='bayNo != null and bayNo != ""'>
            ,BAY_NO                   = #{bayNo}                          --베이번호
            </if>
            <if test='tecId != null and tecId != ""'>
            ,TEC_ID                   = #{tecId}                          --TecManID
            </if>
            <if test='tecNm != null and tecNm != ""'>
            ,TEC_NM                   = #{tecNm}                          --TecMan명
            </if>
            <if test='saId != null and saId != ""'>
            ,SA_ID                    = #{saId}                           --SAID
            </if>
            <if test='saNm != null and saNm != ""'>
            ,SA_NM                    = #{saNm}                           --SA명
            </if>
            <if test='cancReasonCd != null and cancReasonCd != ""'>
            ,CANC_REASON_CD           = #{cancReasonCd}                   --취소사유코드
            </if>
            <if test='cancReasonCont != null and cancReasonCont != ""'>
            ,CANC_REASON_CONT         = #{cancReasonCont}                 --취소사유내용
            </if>
            <if test='runDistVal != null and runDistVal != ""'>
            ,RUN_DIST_VAL             = #{runDistVal}                     --주행거리값
            </if>
            <if test='diagDocNo != null and diagDocNo != ""'>
            ,DIAG_DOC_NO               = #{diagDocNo}                       --사전점검번호
            </if>
            <if test='baseRoNo != null and baseRoNo != ""'>
            ,BASE_RO_NO               = #{baseRoNo}                       --원RO번호
            </if>
            <if test='incReqNo != null and incReqNo != ""'>
            ,INC_REQ_NO               = #{incReqNo}                       --보험신청번호
            </if>
            <if test='custWaitMthCd != null and custWaitMthCd != ""'>
            ,CUST_WAIT_MTH_CD         = #{custWaitMthCd}                  --고객대기방법코드
            </if>
            <if test='atqProcTp != null and atqProcTp != ""'>
            ,ATQ_PROC_TP              = #{atqProcTp}                      --고품처리유형
            </if>
            <if test='carWashTp != null and carWashTp != ""'>
            ,CAR_WASH_TP              = #{carWashTp}                      --차량세차유형
            </if>
            <if test='carDriveReqTp != null and carDriveReqTp != ""'>
            ,CAR_DRIVE_REQ_TP         = #{carDriveReqTp}                  --차량시승요청유형
            </if>
            <if test='roadTestCd != null and roadTestCd != ""'>
            ,ROAD_TEST_CD         = #{roadTestCd}                  --차량시승요청유형
            </if>
            <if test='qtTestMthCd != null and qtTestMthCd != ""'>
            ,QT_TEST_MTH_CD          = #{qtTestMthCd}
            </if>
            <if test='expcDlDt != null'>
            ,EXPC_DL_DT               = #{expcDlDt}                       --예정인도일자
            </if>
            <if test='roRemark != null and roRemark != ""'>
            ,RO_REMARK          = #{roRemark}
            </if>
            <if test='wrkAllocYn != null and wrkAllocYn != ""'>
            ,WRK_ALLOC_YN          = #{wrkAllocYn}
            </if>
            <if test='preAmt != null'>
            ,PRE_AMT          = #{preAmt}
            </if>
            <if test='cauCd1 != null and cauCd1 != ""'>
            ,CAU_CD1 = #{cauCd1}
            </if>
            <if test='cauNm1 != null and cauNm1 != ""'>
            ,CAU_NM1 = #{cauNm1}
            </if>
            <if test='phenCd1 != null and phenCd1 != ""'>
            ,PHEN_CD1 = #{phenCd1}
            </if>
            <if test='phenNm1 != null and phenNm1 != ""'>
            ,PHEN_NM1 = #{phenNm1}
            </if>
            <if test='cauCd2 != null and cauCd2 != ""'>
            ,CAU_CD2 = #{cauCd2}
            </if>
            <if test='cauNm2 != null and cauNm2 != ""'>
            ,CAU_NM2 = #{cauNm2}
            </if>
            <if test='phenCd2 != null and phenCd2 != ""'>
            ,PHEN_CD2 = #{phenCd2}
            </if>
            <if test='phenNm2 != null and phenNm2 != ""'>
            ,PHEN_NM2 = #{phenNm2}
            </if>
            WHERE DLR_CD      = #{dlrCd}       --딜러코드
            <if test='preRoDocNo != null and preRoDocNo != ""'>
                AND PRE_RO_DOC_NO = #{preRoDocNo}
            </if>
    </update>

    <delete id="deletePreRepairOrder" parameterType="String">
        /* [chn.bhmc.dms.ser.ro.service.dao.PreRepairOrderDAO.deletePreRepairOrder] */
        DELETE FROM SE_0300T WHERE PRE_RO_DOC_NO = #{preRoDocNo}
    </delete>

    <!-- RO접수 목록 조회. -->
    <select id="selectPreRepairOrderByCondition" parameterType="PreRepairOrderSearchVO" resultType="PreRepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.PreRepairOrderDAO.selectPreRepairOrderByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM, T1.* FROM (
                SELECT A.*
                      ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1 ) AS LAST_RUN_DIST_VAL
                      ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                      ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                FROM SE_0340T A
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        AND A.DLR_CD = #{sDlrCd}
                    </if>
                    <if test='sPreRoDocNo != null and sPreRoDocNo != ""'>
                        AND A.PRE_RO_DOC_NO like '%'||#{sPreRoDocNo}||'%'
                    </if>
                    <if test='sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>
                    <if test='sTecNm != null and sTecNm != ""'>
                        AND A.TEC_NM LIKE '%'||#{sTecNm}||'%'
                    </if>
                    <if test='sSaNm != null and sSaNm != ""'>
                        AND A.SA_NM LIKE '%'||#{sSaNm}||'%'
                    </if>
                    <if test='sDriverNm != null and sDriverNm != ""'>
                        AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                    </if>
                    <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                        AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                    </if>
                    <if test='sCarRegNo != null and sCarRegNo != ""'>
                        AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                    </if>
                    <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                        AND A.CAR_OWNER_ID = #{sCarOwnerId}
                    </if>
                    <if test='sBayNo != null and sBayNo != ""'>
                        AND A.BAY_NO = #{sBayNo}
                    </if>
                    <if test='sPreRoStatCd != null and sPreRoStatCd != ""'>
                        AND A.PRE_RO_STAT_CD = #{sPreRoStatCd}
                    </if>
                    <if test='sPaintStatCd != null and sPaintStatCd != ""'>
                        AND A.PAINT_STAT_CD = #{sPaintStatCd}
                    </if>
                    <if test='sQtTestStatCd != null and sQtTestStatCd != ""'>
                        AND A.QT_TEST_STAT_CD = #{sQtTestStatCd}
                    </if>
                    <if test='sCarWashStatCd != null and sCarWashStatCd != ""'>
                        AND A.CAR_WASH_STAT_CD = #{sCarWashStatCd}
                    </if>
                    <if test='sResvDocNo != null and sResvDocNo != ""'>
                        AND A.RESV_DOC_NO = #{sResvDocNo}
                    </if>
                    <if test='sPreRoTp != null and sPreRoTp != ""'>
                        AND A.PRE_RO_TP = #{sPreRoTp}
                    </if>
                    <if test='sPreRoFromDt != null'>
                        AND A.PRE_RO_DT <![CDATA[>=]]> #{sPreRoFromDt}
                    </if>
                    <if test='sPreRoToDt != null'>
                        AND A.PRE_RO_DT <![CDATA[<]]> #{sPreRoToDt} + 1
                    </if>
                    <if test='sExpcDlFromDt != null'>
                        AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
                    </if>
                    <if test='sExpcDlToDt != null'>
                        AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
                    </if>
                    <if test='sRunDistFromVal != null'>
                        AND A.RUN_DIST_VAL <![CDATA[>=]]> #{sRunDistFromVal}
                    </if>
                    <if test='sRunDistToVal != null'>
                        AND A.RUN_DIST_VAL <![CDATA[<=]]> #{sRunDistToVal}
                    </if>
                </where>
                ORDER BY
                <choose>
                <when test='sort != null'>
                <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                <choose>
                <when test='item.field == "dlrCd"'>A.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "preRoDocNo"'>A.PRE_RO_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "preRoTp"'>A.PRE_RO_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "resvDocNo"'>A.RESV_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "vinNo"'>A.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "carRegNo"'>A.CAR_REG_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "enginNo"'>A.ENGIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "carOwnerId"'>A.CAR_OWNER_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "carOwnerNm"'>A.CAR_OWNER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "driverNm"'>A.DRIVER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <otherwise>
                A.DLR_CD ASC
                ,A.PRE_RO_DOC_NO DESC
                ,A.PRE_RO_TP ASC
                </otherwise>
                </choose>
                </foreach>
                </when>
                <otherwise>
                A.DLR_CD ASC
                ,A.PRE_RO_DOC_NO DESC
                ,A.PRE_RO_TP ASC
                </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- RO접수 목록수를 조회. -->
    <select id="selectPreRepairOrderByConditionCnt" parameterType="PreRepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.PreRepairOrderDAO.selectPreRepairOrderByConditionCnt] */
        SELECT COUNT(*) AS VALUE
        FROM SE_0340T A
        <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND A.DLR_CD = #{sDlrCd}
            </if>
            <if test='sPreRoDocNo != null and sPreRoDocNo != ""'>
                AND A.PRE_RO_DOC_NO like '%'||#{sPreRoDocNo}||'%'
            </if>
            <if test='sVinNo != null and sVinNo != ""'>
                AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
            </if>
            <if test='sTecNm != null and sTecNm != ""'>
                AND A.TEC_NM LIKE '%'||#{sTecNm}||'%'
            </if>
            <if test='sSaNm != null and sSaNm != ""'>
                AND A.SA_NM LIKE '%'||#{sSaNm}||'%'
            </if>
            <if test='sDriverNm != null and sDriverNm != ""'>
                AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
            </if>
            <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
            </if>
            <if test='sCarRegNo != null and sCarRegNo != ""'>
                AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
            </if>
            <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                AND A.CAR_OWNER_ID = #{sCarOwnerId}
            </if>
            <if test='sBayNo != null and sBayNo != ""'>
                AND A.BAY_NO = #{sBayNo}
            </if>
            <if test='sPreRoStatCd != null and sPreRoStatCd != ""'>
                AND A.PRE_RO_STAT_CD = #{sPreRoStatCd}
            </if>
            <if test='sPaintStatCd != null and sPaintStatCd != ""'>
                AND A.PAINT_STAT_CD = #{sPaintStatCd}
            </if>
            <if test='sQtTestStatCd != null and sQtTestStatCd != ""'>
                AND A.QT_TEST_STAT_CD = #{sQtTestStatCd}
            </if>
            <if test='sCarWashStatCd != null and sCarWashStatCd != ""'>
                AND A.CAR_WASH_STAT_CD = #{sCarWashStatCd}
            </if>
            <if test='sResvDocNo != null and sResvDocNo != ""'>
                AND A.RESV_DOC_NO = #{sResvDocNo}
            </if>
            <if test='sPreRoTp != null and sPreRoTp != ""'>
                AND A.PRE_RO_TP = #{sPreRoTp}
            </if>
            <if test='sPreRoFromDt != null'>
                AND A.PRE_RO_DT <![CDATA[>=]]> #{sPreRoFromDt}
            </if>
            <if test='sPreRoToDt != null'>
                AND A.PRE_RO_DT <![CDATA[<]]> #{sPreRoToDt} + 1
            </if>
            <if test='sExpcDlFromDt != null'>
                AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
            </if>
            <if test='sExpcDlToDt != null'>
                AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
            </if>
            <if test='sRunDistFromVal != null'>
                AND A.RUN_DIST_VAL <![CDATA[>=]]> #{sRunDistFromVal}
            </if>
            <if test='sRunDistToVal != null'>
                AND A.RUN_DIST_VAL <![CDATA[<=]]> #{sRunDistToVal}
            </if>
        </where>
    </select>

    <!-- RO접수 목록 조회. -->
    <select id="selectPreRepairOrderListByCondition" parameterType="PreRepairOrderSearchVO" resultType="PreRepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.PreRepairOrderDAO.selectPreRepairOrderByCondition] */
        SELECT * FROM (
            SELECT ROWNUM AS RNUM
                  ,T1.*
                  ,T1.PAR_AMT + T1.LBR_AMT + T1.ETC_AMT AS SUM_AMT  --합계금액
                  ,CASE WHEN T1.PRE_RO_STAT_CD ='06' THEN T1.UPDT_USR_NM ELSE NULL END AS RO_CANC_NM --RO 취소자
              FROM (
                 SELECT DLR_CD                          --딜러코드
                       ,PRE_RO_DOC_NO                   --이전RO문서번호
                       ,PRE_RO_TP                       --사전RO유형
                       ,PRE_RO_STAT_CD                  --사전RO상태코드
                       ,PRE_RO_DT                       --사전RO일자
                       ,RO_DOC_NO                       --RO문서번호
                       ,RO_GRP_NO                       --RO그룹번호
                       ,RESV_DOC_NO                     --예약문서번호
                       ,VIN_NO                          --차대번호
                       ,CAR_REG_NO                      --차량등록번호
                       ,ENGIN_NO                        --엔진번호
                       ,CAR_OWNER_ID                    --차량소유자ID
                       ,CAR_OWNER_NM                    --차량소유자명
                       ,DRIVER_ID                       --운전자ID
                       ,DRIVER_NM                       --운전자명
                       ,RESV_TP                         --예약유형
                       ,RESV_DT                         --예약일자
                       ,BAY_NO                          --베이번호
                       ,TEC_ID                          --TechManID
                       ,TEC_NM                          --TechMan명
                       ,SA_ID                           --SAID
                       ,SA_NM                           --SA명
                       ,OPER_RESV_DT                    --작업예약일자
                       ,(
                          SELECT NVL(SUM(ITEM_TOT_AMT),0)
                            FROM SE_0160T
                           WHERE DLR_CD    = A.DLR_CD
                             AND DOC_NO    = A.PRE_RO_DOC_NO
                             AND PREFIX_ID = #{sPreFixId}
                         )AS PAR_AMT                   --부품금액
                        ,(
                          SELECT NVL(SUM(LBR_TOT_AMT),0)
                            FROM SE_0170T
                           WHERE DLR_CD    = A.DLR_CD
                             AND DOC_NO    = A.PRE_RO_DOC_NO
                             AND PREFIX_ID = #{sPreFixId}
                         ) AS LBR_AMT                 --공임금액
                        ,(
                          SELECT NVL(SUM(ETC_REQ_PRC),0)
                            FROM SE_0140T
                           WHERE DLR_CD    = A.DLR_CD
                             AND JOB_NO    = A.PRE_RO_DOC_NO
                             AND PREFIX_ID = #{sPreFixId}
                         ) AS ETC_AMT                  --기타금액
                         ,(
                          SELECT NVL(SUM(DC_AMT),0)
                            FROM SE_0160T
                           WHERE DLR_CD    = A.DLR_CD
                             AND DOC_NO    = A.PRE_RO_DOC_NO
                             AND PREFIX_ID = #{sPreFixId}
                         )+(
                          SELECT NVL(SUM(DC_AMT),0)
                            FROM SE_0170T
                           WHERE DLR_CD    = A.DLR_CD
                             AND DOC_NO    = A.PRE_RO_DOC_NO
                             AND PREFIX_ID = #{sPreFixId}
                         )AS DC_AMT                     --할인금액
                       ,VAT_AMT                         --부가가치세금액
                       ,TOT_AMT                         --총금액
                       ,NVL(BAL_AMT,0) AS BAL_AMT       --예치금액
                       ,CANC_REASON_CD                  --취소사유코드
                       ,CANC_REASON_CONT                --취소사유내용
                       ,DIST_UNIT_CD                    --거리단위코드
                       ,RUN_DIST_VAL                    --주행거리값
                       ,DIAG_DOC_NO                     --진단문서번호
                       ,BASE_RO_NO                      --원RO번호
                       ,INC_REQ_NO                      --보험신청번호
                       ,CUST_WAIT_MTH_CD                --고객대기방법코드
                       ,ATQ_PROC_TP                     --고품처리유형
                       ,CAR_WASH_TP                     --차량세차유형
                       ,CAR_DRIVE_REQ_TP                --차량시승요청유형
                       ,EXPC_DL_DT                      --예정인도일자
                       ,ATQ_PROC_YN                     --고품처리여부
                       ,CAR_WASH_YN                     --차량세차여부
                       ,VSIT_CAR_RECEIVE_DT             --방문차량수령일자
                       ,VSIT_CAR_RECEIVE_IF_NM          --방문차량수령연계인명
                       ,VSIT_CAR_RECEIVE_CI_NO          --방문차량수령연락처번호
                       ,VSIT_CAR_RECEIVE_ADDR_NM        --방문차량수령주소명
                       ,CAR_RECEIVE_DT                  --차량수령일자
                       ,VSIT_DL_IF_NM                   --방문인도연계인명
                       ,VSIT_DL_CI_NO                   --방문인도연락처번호
                       ,VSIT_DL_ADDR_NM                 --방문인도주소명
                       ,VSIT_DT                         --방문일자
                       ,VSIT_IF_NM                      --방문연계인명
                       ,VSIT_CI_NO                      --방문연락처번호
                       ,VSIT_ADDR_NM                    --방문주소명
                       ,ALLOC_EMP_ID                    --배정자ID
                       ,SER_RESV_END_DT                 --서비스예약종료일자
                       ,INC_REQ_DT                      --보험신청일자
                       ,CAR_WASH_STAT_CD                --세차상태코드
                       ,PAINT_STAT_CD                   --페인트상태코드
                       ,QT_TEST_STAT_CD                 --품질검사상태코드
                       ,PAINT_QTY                       --페인트수량
                       ,PAINT_COLOR_CD                  --페인트색상코드
                       ,CAR_COLOR_CD                    --차량색상코드
                       ,PAINT_TP                        --페인트유형
                       ,RO_START_DT                     --RO시작일자
                       ,RO_END_DT                       --RO종료일자
                       ,RO_REMARK                       --RO비고
                       ,WRK_ALLOC_YN                    --작업배정여부
                       ,QT_TEST_MTH_CD                  --품질검사방법코드
                       ,CHG_EXPC_DL_DT                  --변경예정인도일자
                       ,ROAD_TEST_CD                    --도로검사코드
                       ,NVL(PRE_AMT,0) AS PRE_AMT       --선수금금액
                       ,REG_USR_ID                      --등록자ID
                       ,REG_DT                          --등록일자
                       ,UPDT_USR_ID                     --수정자ID
                       ,UPDT_DT                         --수정일자
                       ,CASE WHEN PRE_RO_STAT_CD ='06' THEN UPDT_DT ELSE NULL END AS RO_CANC_DT --RO 취소시간
                      ,(SELECT CAR_RUN_DIST_VAL FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS LAST_RUN_DIST_VAL
                      ,(SELECT FN_GET_CARLINE_NM(CARLINE_CD) AS CARLINE_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS CARLINE_NM
                      ,(SELECT FN_GET_MODEL_NM(MODEL_CD) AS MODEL_NM FROM SA_0121T WHERE VIN_NO = A.VIN_NO AND ROWNUM = 1) AS MODEL_NM
                      ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                      ,(SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.UPDT_USR_ID AND DLR_CD = A.DLR_CD) AS UPDT_USR_NM
                  FROM SE_0340T A
                 WHERE A.DLR_CD = #{sDlrCd}
                    <if test='sPreRoDocNo != null and sPreRoDocNo != ""'>
                        AND A.PRE_RO_DOC_NO like '%'||#{sPreRoDocNo}||'%'
                    </if>
                    <if test='sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>
                    <if test='sTecNm != null and sTecNm != ""'>
                        AND A.TEC_NM LIKE '%'||#{sTecNm}||'%'
                    </if>
                    <if test='sSaNm != null and sSaNm != ""'>
                        AND A.SA_NM LIKE '%'||#{sSaNm}||'%'
                    </if>
                    <if test='sDriverNm != null and sDriverNm != ""'>
                        AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                    </if>
                    <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                        AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                    </if>
                    <if test='sCarRegNo != null and sCarRegNo != ""'>
                        AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                    </if>
                    <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                        AND A.CAR_OWNER_ID = #{sCarOwnerId}
                    </if>
                    <if test='sBayNo != null and sBayNo != ""'>
                        AND A.BAY_NO = #{sBayNo}
                    </if>
                    <if test='sPreRoStatCd != null and sPreRoStatCd != ""'>
                        AND A.PRE_RO_STAT_CD = #{sPreRoStatCd}
                    </if>
                    <if test='sPaintStatCd != null and sPaintStatCd != ""'>
                        AND A.PAINT_STAT_CD = #{sPaintStatCd}
                    </if>
                    <if test='sQtTestStatCd != null and sQtTestStatCd != ""'>
                        AND A.QT_TEST_STAT_CD = #{sQtTestStatCd}
                    </if>
                    <if test='sCarWashStatCd != null and sCarWashStatCd != ""'>
                        AND A.CAR_WASH_STAT_CD = #{sCarWashStatCd}
                    </if>
                    <if test='sResvDocNo != null and sResvDocNo != ""'>
                        AND A.RESV_DOC_NO = #{sResvDocNo}
                    </if>
                    <if test='sPreRoTp != null and sPreRoTp != ""'>
                        AND A.PRE_RO_TP = #{sPreRoTp}
                    </if>
                    <if test='sPreRoFromDt != null'>
                        AND A.PRE_RO_DT <![CDATA[>=]]> #{sPreRoFromDt}
                    </if>
                    <if test='sPreRoToDt != null'>
                        AND A.PRE_RO_DT <![CDATA[<]]> #{sPreRoToDt} + 1
                    </if>
                    <if test='sExpcDlFromDt != null'>
                        AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
                    </if>
                    <if test='sExpcDlToDt != null'>
                        AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
                    </if>
                ORDER BY
                <choose>
                <when test='sort != null'>
                <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                <choose>
                <when test='item.field == "dlrCd"'>A.DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "preRoDocNo"'>A.PRE_RO_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "preRoTp"'>A.PRE_RO_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "resvDocNo"'>A.RESV_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "vinNo"'>A.VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "carRegNo"'>A.CAR_REG_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "enginNo"'>A.ENGIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "carOwnerId"'>A.CAR_OWNER_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "carOwnerNm"'>A.CAR_OWNER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <when test='item.field == "driverNm"'>A.DRIVER_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                <otherwise>
                 A.DLR_CD ASC
                ,A.PRE_RO_DOC_NO DESC
                ,A.PRE_RO_TP ASC
                </otherwise>
                </choose>
                </foreach>
                </when>
                <otherwise>
                A.DLR_CD ASC
                ,A.PRE_RO_DOC_NO DESC
                ,A.PRE_RO_TP ASC
                </otherwise>
                </choose>
            ) T1
            <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    ROWNUM <![CDATA[<=]]> #{lastIndex}
                </if>
                <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                    AND T1.REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
                </if>
            </where>
        )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- RO접수 목록수를 조회. -->
    <select id="selectPreRepairOrderListByConditionCnt" parameterType="PreRepairOrderSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ro.service.dao.PreRepairOrderDAO.selectPreRepairOrderByConditionCnt] */

            SELECT COUNT(*) AS VALUE FROM(
             SELECT *
              FROM (
                SELECT (SELECT USR_NM FROM CM_0801T WHERE USR_ID = A.REG_USR_ID AND DLR_CD = A.DLR_CD) AS REG_USR_NM
                 FROM SE_0340T A
                <where>
                    <if test='sDlrCd != null and sDlrCd != ""'>
                        AND A.DLR_CD = #{sDlrCd}
                    </if>
                    <if test='sPreRoDocNo != null and sPreRoDocNo != ""'>
                        AND A.PRE_RO_DOC_NO like '%'||#{sPreRoDocNo}||'%'
                    </if>
                    <if test='sVinNo != null and sVinNo != ""'>
                        AND A.VIN_NO LIKE '%'||#{sVinNo}||'%'
                    </if>
                    <if test='sTecNm != null and sTecNm != ""'>
                        AND A.TEC_NM LIKE '%'||#{sTecNm}||'%'
                    </if>
                    <if test='sSaNm != null and sSaNm != ""'>
                        AND A.SA_NM LIKE '%'||#{sSaNm}||'%'
                    </if>
                    <if test='sDriverNm != null and sDriverNm != ""'>
                        AND A.DRIVER_NM LIKE '%'||#{sDriverNm}||'%'
                    </if>
                    <if test='sCarOwnerNm != null and sCarOwnerNm != ""'>
                        AND A.CAR_OWNER_NM LIKE '%'||#{sCarOwnerNm}||'%'
                    </if>
                    <if test='sCarRegNo != null and sCarRegNo != ""'>
                        AND A.CAR_REG_NO LIKE '%'||#{sCarRegNo}||'%'
                    </if>
                    <if test='sCarOwnerId != null and sCarOwnerId != ""'>
                        AND A.CAR_OWNER_ID = #{sCarOwnerId}
                    </if>
                    <if test='sBayNo != null and sBayNo != ""'>
                        AND A.BAY_NO = #{sBayNo}
                    </if>
                    <if test='sPreRoStatCd != null and sPreRoStatCd != ""'>
                        AND A.PRE_RO_STAT_CD = #{sPreRoStatCd}
                    </if>
                    <if test='sPaintStatCd != null and sPaintStatCd != ""'>
                        AND A.PAINT_STAT_CD = #{sPaintStatCd}
                    </if>
                    <if test='sQtTestStatCd != null and sQtTestStatCd != ""'>
                        AND A.QT_TEST_STAT_CD = #{sQtTestStatCd}
                    </if>
                    <if test='sCarWashStatCd != null and sCarWashStatCd != ""'>
                        AND A.CAR_WASH_STAT_CD = #{sCarWashStatCd}
                    </if>
                    <if test='sResvDocNo != null and sResvDocNo != ""'>
                        AND A.RESV_DOC_NO = #{sResvDocNo}
                    </if>
                    <if test='sPreRoTp != null and sPreRoTp != ""'>
                        AND A.PRE_RO_TP = #{sPreRoTp}
                    </if>
                    <if test='sPreRoFromDt != null'>
                        AND A.PRE_RO_DT <![CDATA[>=]]> #{sPreRoFromDt}
                    </if>
                    <if test='sPreRoToDt != null'>
                        AND A.PRE_RO_DT <![CDATA[<]]> #{sPreRoToDt} + 1
                    </if>
                    <if test='sExpcDlFromDt != null'>
                        AND A.EXPC_DL_DT <![CDATA[>=]]> #{sExpcDlFromDt}
                    </if>
                    <if test='sExpcDlToDt != null'>
                        AND A.EXPC_DL_DT <![CDATA[<]]> #{sExpcDlToDt} + 1
                    </if>
                </where>
            )
            <where>
                 <if test='sRegUsrNm != null and sRegUsrNm != ""'>
                    AND REG_USR_NM LIKE '%'||#{sRegUsrNm}||'%'
                </if>
            </where>
          )
    </select>

    <!-- RO접수 상세 조회. -->
    <select id="selectPreRepairOrderByKey" parameterType="PreRepairOrderSearchVO" resultType="PreRepairOrderVO">
        /* [chn.bhmc.dms.ser.ro.service.dao.PreRepairOrderDAO.selectPreRepairOrderByKey] */
        SELECT A.*
              ,B.DIAG_DOC_NO
              ,B.PRE_CHK_DT
              ,FN_SER_LTS_MODEL_CD(A.VIN_NO) AS LTS_MODEL_CD
        FROM SE_0340T A
        LEFT JOIN SE_0200T B
        ON A.RESV_DOC_NO = B.RESV_DOC_NO
        <where>
            <if test='sDlrCd != null and sDlrCd != ""'>
                AND A.DLR_CD = #{sDlrCd}
            </if>
            <if test='sPreRoDocNo != null and sPreRoDocNo != ""'>
                AND A.PRE_RO_DOC_NO = #{sPreRoDocNo}
            </if>
            <if test='sResvDocNo != null and sResvDocNo != ""'>
                AND A.RESV_DOC_NO = #{sResvDocNo}
            </if>
        </where>
    </select>

    <!-- 출고취소시 RO 접수확인 -->
    <select id="selectPreRepairOrderCheckByKey" parameterType="PreRepairOrderSearchVO" resultType="string">
        /* [chn.bhmc.dms.ser.ro.service.dao.PreRepairOrderDAO.selectPreRepairOrderCheckByKey] */
         SELECT CASE WHEN NVL(RO_CNT,0) = 0 THEN 'Y' ELSE 'N' END RESULT_YN
           FROM(
             SELECT COUNT(PRE_RO_DOC_NO) AS RO_CNT
               FROM SE_0340T
              WHERE VIN_NO = #{sVinNo}
                AND PRE_RO_STAT_CD != '06'
           )DUAL
    </select>

    <!--  RO 정보 조회 -->
    <select id="selectPreRepairOrderInfoByKey" parameterType="PreRepairOrderSearchVO" resultType="PreRepairOrderVO">
        /* [chn.bhmc.dms.ser.cmm.service.dao.PreRepairOrderDAO.selectPreRepairOrderInfoByKey] */
            SELECT  DLR_CD
              ,RO_GRP_NO
              ,PRE_RO_DOC_NO
              ,PRE_RO_TP
              ,PRE_RO_DT
              ,SA_ID
              ,SA_NM
              ,RESV_DOC_NO
              ,DIAG_DOC_NO
              ,INC_REQ_NO
              ,BASE_RO_NO
              ,RUN_DIST_VAL
         FROM SE_0340T
        WHERE DLR_CD = #{sDlrCd}
          AND PRE_RO_DOC_NO =  #{sPreRoDocNo}
    </select>

</mapper>