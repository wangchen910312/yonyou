<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : InsRegManageDAO_SqlMap.xml
    Description : 보험등록 관리  마스터에 관한 데이터처리
    author Kwon Ki Hyun
    since 2016. 08. 05.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 08. 05.  Kwon Ki Hyun     최초 생성
-->


<mapper namespace="chn.bhmc.dms.ser.ins.service.dao.InsRegManageDAO">

    <!-- 보험등록관리 등록-->
    <insert id="insertInsRegManage" parameterType="InsRegVO">
        /* [chn.bhmc.dms.ser.ins.service.dao.InsRegManageDAO.insertInsRegManage] */

         INSERT INTO SE_1018T    --보험관리마스터
            (
              DLR_CD                --딜러코드
             ,VIN_NO                --차대번호
             ,INC_DOC_NO            --보험문서번호
             ,CAR_REG_NO            --차량등록번호
             ,INC_CMP_CD            --보험사코드
             ,INC_CMP_SHT_CD        --보험사약어코드
             ,RINC_PRSN_ID          --피보험자ID
             ,INC_DSTIN_CD          --보험구분코드
             ,INC_TOT_AMT           --보험총금액
             ,INC_START_DT          --보험시작일자
             ,INC_END_DT            --보험종료일자
             ,CMC_INC_CD            --상업보험코드
             ,CMC_INC_TP            --상업보험유형
             ,CMC_INC_NM            --상업보험명
             ,CMC_INC_REMARK        --상업보험비고
             ,REG_USR_ID            --등록자ID
             ,REG_DT                --등록일자
            )
            VALUES
            (
              #{dlrCd}                --딜러코드
             ,#{vinNo}                --차대번호
             ,#{incDocNo}             --보험문서번호
             ,#{carRegNo}             --차량등록번호
             ,#{incCmpCd}             --보험사코드
             ,#{incCmpShtCd}          --보험사약어코드
             ,#{rincPrsnId}           --피보험자ID
             ,#{incDstinCd}           --보험구분코드
             ,#{incTotAmt}            --보험총금액
             ,#{incStartDt}           --보험시작일자
             ,#{incEndDt}             --보험종료일자
             ,#{cmcIncCd}             --상업보험코드
             ,#{cmcIncTp}             --상업보험유형
             ,#{cmcIncNm}             --상업보험명
             ,#{cmcIncRemark}         --상업보험비고
             ,#{regUsrId}             --등록자ID
             ,sysdate                 --등록일자
            )
    </insert>

    <!-- 보험등록관리 수정 -->
    <update id="updateInsRegManage" parameterType="InsRegVO">
        /* [chn.bhmc.dms.ser.ins.service.dao.InsRegManageDAO.updateInsRegManage] */

        UPDATE SE_1018T    --보험관리마스터
          SET
               VIN_NO         = #{vinNo}                --차대번호
              ,CAR_REG_NO     = #{carRegNo}             --차량등록번호
              ,INC_CMP_CD     = #{incCmpCd}             --보험사코드
              ,INC_CMP_SHT_CD = #{incCmpShtCd}          --보험사약어코드
              ,RINC_PRSN_ID   = #{rincPrsnId}           --피보험자ID
              ,INC_DSTIN_CD   = #{incDstinCd}           --보험구분코드
              ,INC_TOT_AMT    = #{incTotAmt}            --보험총금액
              ,INC_START_DT   = #{incStartDt}           --보험시작일자
              ,INC_END_DT     = #{incEndDt}             --보험종료일자
              ,CMC_INC_CD     = #{cmcIncCd}             --상업보험코드
              ,CMC_INC_TP     = #{cmcIncTp}             --상업보험유형
              ,CMC_INC_NM     = #{cmcIncNm}             --상업보험명
              ,CMC_INC_REMARK = #{cmcIncRemark}         --상업보험비고
              ,UPDT_USR_ID    = #{updtUsrId}            --수정자ID
              ,UPDT_DT        = sysdate                 --수정일자
         WHERE 1 = 1
           AND INC_DOC_NO     = #{incDocNo}             --보험문서번호
           AND DLR_CD         = #{dlrCd}                --딜러코드
    </update>

    <!-- 보험등록관리 삭제 -->
    <delete id="deleteInsRegManage" parameterType="InsRegVO">
      /* [chn.bhmc.dms.ser.ins.service.dao.InsRegManageDAO.deleteInsRegManage] */

        DELETE FROM SE_1018T
         WHERE 1 = 1
           AND INC_DOC_NO     = #{incDocNo}             --보험문서번호
           AND DLR_CD         = #{dlrCd}                --딜러코드
           <if test='lineNo != null and lineNo != "" '>
            AND LINE_NO       = #{lineNo}
           </if>
    </delete>

    <!-- 보험등록관리 상세 등록-->
    <insert id="insertInsRegDetailManage" parameterType="InsRegDetailVO">
        /* [chn.bhmc.dms.ser.ins.service.dao.InsRegManageDAO.insertInsRegDetailManage] */

          INSERT INTO SE_1019T    --보험관리상세
            (
              DLR_CD                  --딜러코드
             ,INC_DOC_NO              --보험문서번호
             ,LINE_NO                 --라인번호
             ,CMC_INC_TP_CD           --상업보험유형코드
             ,CMC_INC_TP_NM           --상업보험유형명
             ,CMC_INC_TP              --상업보험유형
             ,CHG_AMT_RATE            --변경금액율
             ,INC_AMT                 --보험금액
             ,INC_COST_SUM_AMT        --보험비용합계금액
             ,INC_DC_RATE             --보험할인율
             ,INC_FEE_AMT             --보험수수료금액
             ,REG_USR_ID              --등록자ID
             ,REG_DT                  --등록일자
            )
            VALUES
            (
              #{dlrCd}                  --딜러코드
             ,#{incDocNo}               --보험문서번호
             ,(
                SELECT NVL(MAX(LINE_NO),0)+1
                  FROM SE_1019T
                 WHERE INC_DOC_NO     = #{incDocNo}  --보험문서번호
                   AND DLR_CD         = #{dlrCd}     --딜러코드
               )                        --라인번호
             ,#{cmcIncTpCd}             --상업보험유형코드
             ,#{cmcIncTpNm}             --상업보험유형명
             ,#{cmcIncTp}               --상업보험유형
             ,#{chgAmtRate}             --변경금액율
             ,#{incAmt}                 --보험금액
             ,#{incCostSumAmt}          --보험비용합계금액
             ,#{incDcRate}              --보험할인율
             ,#{incFeeAmt}              --보험수수료금액
             ,#{regUsrId}               --등록자ID
             ,sysdate                  --등록일자
            )
    </insert>

    <!-- 보험등록관리 상세 수정 -->
    <update id="updateInsRegDetailManage" parameterType="InsRegDetailVO">
        /* [chn.bhmc.dms.ser.ins.service.dao.InsRegManageDAO.updateInsRegDetailManage] */

        UPDATE SE_1019T    --보험관리상세
          SET
               CMC_INC_TP_CD    = #{cmcIncTpCd}             --상업보험유형코드
              ,CMC_INC_TP_NM    = #{cmcIncTpNm}             --상업보험유형명
              ,CMC_INC_TP       = #{cmcIncTp}               --상업보험유형
              ,CHG_AMT_RATE     = #{chgAmtRate}             --변경금액율
              ,INC_AMT          = #{incAmt}                 --보험금액
              ,INC_COST_SUM_AMT = #{incCostSumAmt}          --보험비용합계금액
              ,INC_DC_RATE      = #{incDcRate}              --보험할인율
              ,INC_FEE_AMT      = #{incFeeAmt}              --보험수수료금액
              ,UPDT_USR_ID      = #{updtUsrId}              --수정자ID
              ,UPDT_DT          = #{updtDt}                 --수정일자
         WHERE 1 = 1
           AND INC_DOC_NO       = #{incDocNo}               --보험문서번호
           AND LINE_NO          = #{lineNo}                 --라인번호
           AND DLR_CD           = #{dlrCd}                  --딜러코드

    </update>

    <!-- 보험등록관리 상세 삭제 -->
    <delete id="deleteInsRegDetailManage" parameterType="InsRegDetailVO">
        /* [chn.bhmc.dms.ser.ins.service.dao.InsRegManageDAO.deleteInsRegDetailManage] */

        DELETE FROM SE_1019T
         WHERE 1 = 1
           AND INC_DOC_NO     = #{incDocNo}             --보험문서번호
           AND DLR_CD         = #{dlrCd}                --딜러코드
           <if test='lineNo != null and lineNo != ""'>
            AND LINE_NO       = #{lineNo}
           </if>
    </delete>


    <!-- 보험등록관리 리스트 수량 -->
    <select id="selectInsRegManagesByConditionCnt" parameterType="InsRegSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ins.service.dao.InsRegManageDAO.selectInsRegManagesByConditionCnt] */

            SELECT COUNT(INC_DOC_NO) AS VALUE
              FROM SE_1018T    --보험관리마스터
             WHERE DLR_CD         = #{sDlrCd}                      --딜러코드
               <if test='sVinNo != null and sVinNo != ""'>
                AND VIN_NO         LIKE '%'|| #{sVinNo} ||'%'      --차대번호
               </if>
               <if test='sIncDocNo != null and sIncDocNo != ""'>
                AND INC_DOC_NO     LIKE '%'|| #{sIncDocNo} ||'%'  --보험문서번호
               </if>
               <if test='sCarRegNo != null and sCarRegNo != ""'>
               AND CAR_REG_NO     LIKE '%'|| #{sCarRegNo} ||'%'   --차량등록번호
               </if>
               <if test='sIncCmpCd != null and sIncCmpCd != ""'>
               AND INC_CMP_CD    LIKE '%'|| #{sIncCmpCd} ||'%'    --보험사코드
               </if>
               <if test='sIncCmpShtCd != null and sIncCmpShtCd != ""'>
               AND INC_CMP_SHT_CD LIKE '%'|| #{sIncCmpShtCd} ||'%'         --보험사약어코드
               </if>
               <if test='sRincPrsnId != null and sRincPrsnId != ""'>
               AND RINC_PRSN_ID   LIKE '%'|| #{sRincPrsnId} ||'%'       --피보험자ID
               </if>
               <if test='sIncDstinCd != null and sIncDstinCd != ""'>
               AND INC_DSTIN_CD   LIKE '%'|| #{sIncDstinCd} ||'%'                  --보험구분코드
               </if>
               <if test='sIncTotAmt     != null and sIncTotAmt     != ""'>
               AND INC_TOT_AMT   <![CDATA[>=]]> #{sIncTotAmt}       --보험총금액
               </if>
               <if test='sIncStartDt != null '>
               AND INC_START_DT  <![CDATA[>=]]> #{sIncStartDt}      --보험시작일자
               </if>
               <if test='sIncEndDt != null '>
               AND INC_END_DT    <![CDATA[<=]]> #{sIncEndDt}+1      --보험종료일자
               </if>
               <if test='sCmcIncTp != null and sCmcIncTp != ""'>
               AND CMC_INC_TP     = #{sCmcIncTp}                    --상업보험유형
               </if>
               <if test='sCmcIncNm != null and sCmcIncNm != ""'>
                 AND CMC_INC_NM  =  #{sCmcIncNm}       --상업보험명
               </if>
    </select>

    <!-- 보험관리 리스트 -->
    <select id="selectInsRegManagesByCondition" parameterType="InsRegSearchVO" resultType="InsRegVO">
        /* [chn.bhmc.dms.ser.ins.service.dao.InsRegManageDAO.selectInsRegManagesByCondition] */

        SELECT * FROM (
            SELECT ROWNUM AS RNUM , T1.*
              FROM (
                  SELECT
                        DLR_CD                --딜러코드
                       ,VIN_NO                --차대번호
                       ,INC_DOC_NO            --보험문서번호
                       ,CAR_REG_NO            --차량등록번호
                       ,INC_CMP_CD            --보험사코드
                       ,INC_CMP_SHT_CD        --보험사약어코드
                       ,RINC_PRSN_ID          --피보험자ID
                       ,INC_DSTIN_CD          --보험구분코드
                       ,INC_TOT_AMT           --보험총금액
                       ,INC_START_DT          --보험시작일자
                       ,INC_END_DT            --보험종료일자
                       ,CMC_INC_CD            --상업보험코드
                       ,CMC_INC_TP            --상업보험유형
                       ,CMC_INC_NM            --상업보험명
                       ,CMC_INC_REMARK        --상업보험비고
                       ,(SELECT USR_NM
                           FROM CM_0801T
                          WHERE USR_ID  = A.REG_USR_ID
                            AND DLR_CD  = A.DLR_CD) AS  REG_USR_ID  --등록자ID
                       ,REG_DT                --등록일자
                       ,UPDT_USR_ID           --수정자ID
                       ,UPDT_DT               --수정일자
                  FROM SE_1018T A    --보험관리마스터
                 WHERE DLR_CD         = #{sDlrCd}                      --딜러코드
                   <if test='sVinNo != null and sVinNo != ""'>
                    AND VIN_NO         LIKE '%'|| #{sVinNo} ||'%'      --차대번호
                   </if>
                   <if test='sIncDocNo != null and sIncDocNo != ""'>
                    AND INC_DOC_NO     LIKE '%'|| #{sIncDocNo} ||'%'  --보험문서번호
                   </if>
                   <if test='sCarRegNo != null and sCarRegNo != ""'>
                   AND CAR_REG_NO     LIKE '%'|| #{sCarRegNo} ||'%'   --차량등록번호
                   </if>
                   <if test='sIncCmpCd != null and sIncCmpCd != ""'>
                   AND INC_CMP_CD    LIKE '%'|| #{sIncCmpCd} ||'%'    --보험사코드
                   </if>
                   <if test='sIncCmpShtCd != null and sIncCmpShtCd != ""'>
                   AND INC_CMP_SHT_CD LIKE '%'|| #{sIncCmpShtCd} ||'%'         --보험사약어코드
                   </if>
                   <if test='sRincPrsnId != null and sRincPrsnId != ""'>
                   AND RINC_PRSN_ID   LIKE '%'|| #{sRincPrsnId} ||'%'       --피보험자ID
                   </if>
                   <if test='sIncDstinCd != null and sIncDstinCd != ""'>
                   AND INC_DSTIN_CD   LIKE '%'|| #{sIncDstinCd} ||'%'                  --보험구분코드
                   </if>
                   <if test='sIncTotAmt     != null and sIncTotAmt     != ""'>
                   AND INC_TOT_AMT   <![CDATA[>=]]> #{sIncTotAmt}       --보험총금액
                   </if>
                   <if test='sIncStartDt != null '>
                   AND INC_START_DT  <![CDATA[>=]]> #{sIncStartDt}      --보험시작일자
                   </if>
                   <if test='sIncEndDt != null '>
                   AND INC_END_DT    <![CDATA[<=]]> #{sIncEndDt}+1      --보험종료일자
                   </if>
                   <if test='sCmcIncTp != null and sCmcIncTp != ""'>
                   AND CMC_INC_TP     = #{sCmcIncTp}                    --상업보험유형
                   </if>
                   <if test='sCmcIncNm != null and sCmcIncNm != ""'>
                     AND CMC_INC_NM  =  #{sCmcIncNm}        --상업보험명
                   </if>
                 ORDER BY
                 <choose>
                     <when test='sort != null'>
                         <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                             <choose>
                                 <when test='item.field == "dlrCd"'>         DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                 <when test='item.field == "vinNo"'>         VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                 <when test='item.field == "incDocNo"'>      INC_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                 <when test='item.field == "carRegNo"'>      CAR_REG_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                 <when test='item.field == "incCmpCd"'>      INC_CMP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                 <when test='item.field == "incCmpShtCd"'>   INC_CMP_SHT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                 <when test='item.field == "rincPrsnId"'>    RINC_PRSN_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                                 <when test='item.field == "incDstinCd"'>    INC_DSTIN_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                                 <when test='item.field == "incTotAmt"'>     INC_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>   </when>
                                 <when test='item.field == "incStartDt"'>    INC_START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                                 <when test='item.field == "incEndDt"'>      INC_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                 <when test='item.field == "cmcIncCd"'>      CMC_INC_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                 <when test='item.field == "cmcIncTp"'>      CMC_INC_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                 <when test='item.field == "cmcIncNm"'>      CMC_INC_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                 <when test='item.field == "cmcIncRemark"'>  CMC_INC_REMARK <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                 <when test='item.field == "regUsrId"'>      REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                 <when test='item.field == "regDt"'>         REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                 <when test='item.field == "updtUsrId"'>     UPDT_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>   </when>
                                 <when test='item.field == "updtDt"'>        UPDT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                 <otherwise>
                                   DLR_CD ASC ,VIN_NO ASC ,INC_DOC_NO ASC
                                 </otherwise>
                             </choose>
                         </foreach>
                     </when>
                     <otherwise>
                       DLR_CD ASC,VIN_NO ASC ,INC_DOC_NO ASC
                     </otherwise>
                 </choose>
                 )T1
                 <where>
                      <if test='firstIndex != -1 and lastIndex != -1'>
                       AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                      </if>
                 </where>
         )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 보험등록관리 상세  수량 -->
    <select id="selectInsRegDetailManagesByConditionCnt" parameterType="InsRegSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ins.service.dao.InsRegManageDAO.selectInsRegDetailManagesByConditionCnt] */

             SELECT COUNT(INC_DOC_NO) AS VALUE
               FROM SE_1019T    --보험관리상세
              WHERE DLR_CD         = #{sDlrCd}                      --딜러코드
               <if test='sIncDocNo != null and sIncDocNo != ""'>
                AND INC_DOC_NO     = #{sIncDocNo}                  --보험문서번호
               </if>
               <if test='sLineNo != null and sLineNo != ""'>
                AND LINE_NO          = #{sLineNo}                  --라인번호
               </if>
    </select>

    <!-- 보험등록 관리 상세 리스트 -->
    <select id="selectInsRegDetailManagesByCondition" parameterType="InsRegSearchVO" resultType="InsRegDetailVO">
        /* [chn.bhmc.dms.ser.ins.service.dao.InsRegManageDAO.selectInsRegDetailManagesByCondition] */

        SELECT * FROM (
            SELECT ROWNUM AS RNUM , T1.*
              FROM (
                  SELECT
                        DLR_CD                  --딜러코드
                       ,INC_DOC_NO              --보험문서번호
                       ,LINE_NO                 --라인번호
                       ,CMC_INC_TP_CD           --상업보험유형코드
                       ,CMC_INC_TP_NM           --상업보험유형명
                       ,CMC_INC_TP              --상업보험유형
                       ,CHG_AMT_RATE            --변경금액율
                       ,INC_AMT                 --보험금액
                       ,INC_COST_SUM_AMT        --보험비용합계금액
                       ,INC_DC_RATE             --보험할인율
                       ,INC_FEE_AMT             --보험수수료금액
                       ,REG_USR_ID              --등록자ID
                       ,REG_DT                  --등록일자
                       ,UPDT_USR_ID             --수정자ID
                       ,UPDT_DT                 --수정일자
                   FROM SE_1019T    --보험관리상세
                  WHERE DLR_CD         = #{sDlrCd}                      --딜러코드
                   <if test='sIncDocNo != null and sIncDocNo != ""'>
                    AND INC_DOC_NO     = #{sIncDocNo}                  --보험문서번호
                   </if>
                   <if test='sLineNo != null and sLineNo != ""'>
                    AND LINE_NO          = #{sLineNo}                  --라인번호
                   </if>
                 ORDER BY
                 <choose>
                     <when test='sort != null'>
                         <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                             <choose>
                                 <when test='item.field == "dlrCd"'>           DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                 <when test='item.field == "incDocNo"'>        INC_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                 <when test='item.field == "lineNo"'>          LINE_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                 <when test='item.field == "cmcIncTpCd"'>      CMC_INC_TP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>   </when>
                                 <when test='item.field == "cmcIncTpNm"'>      CMC_INC_TP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>   </when>
                                 <when test='item.field == "cmcIncTp"'>        CMC_INC_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                 <when test='item.field == "chgAmtRate"'>      CHG_AMT_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                 <when test='item.field == "incAmt"'>          INC_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                 <when test='item.field == "incCostSumAmt"'>   INC_COST_SUM_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                 <when test='item.field == "incDcRate"'>       INC_DC_RATE <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                 <when test='item.field == "incFeeAmt"'>       INC_FEE_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                 <when test='item.field == "regUsrId"'>        REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>      </when>
                                 <when test='item.field == "regDt"'>           REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>          </when>
                                 <when test='item.field == "updtUsrId"'>       UPDT_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>     </when>
                                 <when test='item.field == "updtDt"'>          UPDT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>         </when>
                                 <otherwise>
                                   DLR_CD ASC,INC_DOC_NO ASC,LINE_NO ASC
                                 </otherwise>
                             </choose>
                         </foreach>
                     </when>
                     <otherwise>
                       DLR_CD ASC,INC_DOC_NO ASC,LINE_NO ASC
                     </otherwise>
                 </choose>
                 )T1
                 <where>
                  <if test='firstIndex != -1 and lastIndex != -1'>
                   AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                  </if>
             </where>
         )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>

    <!-- 보험등록 관리 현황 리스트 목록수 -->
    <select id="selectInsRegListByConditionCnt" parameterType="InsRegSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ins.service.dao.InsRegManageDAO.selectInsRegListByConditionCnt] */

                  SELECT COUNT(A.INC_DOC_NO) AS VALUE
                    FROM (
                          SELECT
                                DLR_CD                --딜러코드
                               ,VIN_NO                --차대번호
                               ,INC_DOC_NO            --보험문서번호
                          FROM SE_1018T    --보험관리마스터
                         WHERE DLR_CD         = #{sDlrCd}                      --딜러코드
                           <if test='sVinNo != null and sVinNo != ""'>
                            AND VIN_NO         LIKE '%'|| #{sVinNo} ||'%'      --차대번호
                           </if>
                           <if test='sIncDocNo != null and sIncDocNo != ""'>
                            AND INC_DOC_NO     LIKE '%'|| #{sIncDocNo} ||'%'  --보험문서번호
                           </if>
                           <if test='sCarRegNo != null and sCarRegNo != ""'>
                           AND CAR_REG_NO     LIKE '%'|| #{sCarRegNo} ||'%'   --차량등록번호
                           </if>
                           <if test='sIncCmpCd != null and sIncCmpCd != ""'>
                           AND INC_CMP_CD    LIKE '%'|| #{sIncCmpCd} ||'%'    --보험사코드
                           </if>
                           <if test='sIncCmpShtCd != null and sIncCmpShtCd != ""'>
                           AND INC_CMP_SHT_CD LIKE '%'|| #{sIncCmpShtCd} ||'%'         --보험사약어코드
                           </if>
                           <if test='sRincPrsnId != null and sRincPrsnId != ""'>
                           AND RINC_PRSN_ID   LIKE '%'|| #{sRincPrsnId} ||'%'       --피보험자ID
                           </if>
                           <if test='sIncDstinCd != null and sIncDstinCd != ""'>
                           AND INC_DSTIN_CD   LIKE '%'|| #{sIncDstinCd} ||'%'                  --보험구분코드
                           </if>
                           <if test='sIncTotAmt     != null and sIncTotAmt     != ""'>
                           AND INC_TOT_AMT   <![CDATA[>=]]> #{sIncTotAmt}       --보험총금액
                           </if>
                           <if test='sIncStartDt != null '>
                           AND INC_START_DT  <![CDATA[>=]]> #{sIncStartDt}      --보험시작일자
                           </if>
                           <if test='sIncEndDt != null '>
                           AND INC_END_DT    <![CDATA[<=]]> #{sIncEndDt}+1      --보험종료일자
                           </if>
                           <if test='sCmcIncTp != null and sCmcIncTp != ""'>
                           AND CMC_INC_TP     = #{sCmcIncTp}                    --상업보험유형
                           </if>
                           <if test='sCmcIncNm != null and sCmcIncNm != ""'>
                             AND CMC_INC_NM  =  #{sCmcIncNm}       --상업보험명
                           </if>
                         ORDER BY  DLR_CD ASC,VIN_NO ASC ,INC_DOC_NO ASC
                    )A LEFT OUTER JOIN SE_1019T B
                     ON A.DLR_CD     = B.DLR_CD
                    AND A.INC_DOC_NO = B.INC_DOC_NO


    </select>

    <!-- 보험등록 관리 현황 리스트  -->
    <select id="selectInsRegListByCondition" parameterType="InsRegSearchVO" resultType="InsRegVO">
        /* [chn.bhmc.dms.ser.ins.service.dao.InsRegManageDAO.selectInsRegListByCondition] */

        SELECT * FROM (
            SELECT ROWNUM AS RNUM , T1.*
              FROM (
                  SELECT A.*
                        ,B.LINE_NO                 --라인번호
                        ,NVL(B.CHG_AMT_RATE,0)      AS CHG_AMT_RATE     --변경금액율
                        ,NVL(B.INC_AMT,0)           AS INC_AMT          --보험금액
                        ,NVL(B.INC_COST_SUM_AMT ,0) AS INC_COST_SUM_AMT --보험비용합계금액
                        ,NVL(B.INC_DC_RATE , 0)     AS INC_DC_RATE      --보험할인율
                        ,NVL(B.INC_FEE_AMT,0)       AS INC_FEE_AMT      --보험수수료금액
                    FROM (
                          SELECT
                                DLR_CD                --딜러코드
                               ,VIN_NO                --차대번호
                               ,INC_DOC_NO            --보험문서번호
                               ,CAR_REG_NO            --차량등록번호
                               ,INC_CMP_CD            --보험사코드
                               ,INC_CMP_SHT_CD        --보험사약어코드
                               ,RINC_PRSN_ID          --피보험자ID
                               ,INC_DSTIN_CD          --보험구분코드
                               ,INC_TOT_AMT           --보험총금액
                               ,INC_START_DT          --보험시작일자
                               ,INC_END_DT            --보험종료일자
                               ,CMC_INC_CD            --상업보험코드
                               ,CMC_INC_TP            --상업보험유형
                               ,CMC_INC_NM            --상업보험명
                               ,CMC_INC_REMARK        --상업보험비고
                               ,(SELECT USR_NM
                                   FROM CM_0801T
                                  WHERE USR_ID  = A.REG_USR_ID
                                    AND DLR_CD  = A.DLR_CD) AS  REG_USR_ID  --등록자ID
                               ,REG_DT                --등록일자
                               ,UPDT_USR_ID           --수정자ID
                               ,UPDT_DT               --수정일자
                          FROM SE_1018T A   --보험관리마스터
                         WHERE DLR_CD         = #{sDlrCd}                      --딜러코드
                           <if test='sVinNo != null and sVinNo != ""'>
                            AND VIN_NO         LIKE '%'|| #{sVinNo} ||'%'      --차대번호
                           </if>
                           <if test='sIncDocNo != null and sIncDocNo != ""'>
                            AND INC_DOC_NO     LIKE '%'|| #{sIncDocNo} ||'%'  --보험문서번호
                           </if>
                           <if test='sCarRegNo != null and sCarRegNo != ""'>
                           AND CAR_REG_NO     LIKE '%'|| #{sCarRegNo} ||'%'   --차량등록번호
                           </if>
                           <if test='sIncCmpCd != null and sIncCmpCd != ""'>
                           AND INC_CMP_CD    LIKE '%'|| #{sIncCmpCd} ||'%'    --보험사코드
                           </if>
                           <if test='sIncCmpShtCd != null and sIncCmpShtCd != ""'>
                           AND INC_CMP_SHT_CD LIKE '%'|| #{sIncCmpShtCd} ||'%'         --보험사약어코드
                           </if>
                           <if test='sRincPrsnId != null and sRincPrsnId != ""'>
                           AND RINC_PRSN_ID   LIKE '%'|| #{sRincPrsnId} ||'%'       --피보험자ID
                           </if>
                           <if test='sIncDstinCd != null and sIncDstinCd != ""'>
                           AND INC_DSTIN_CD   LIKE '%'|| #{sIncDstinCd} ||'%'                  --보험구분코드
                           </if>
                           <if test='sIncTotAmt     != null and sIncTotAmt     != ""'>
                           AND INC_TOT_AMT   <![CDATA[>=]]> #{sIncTotAmt}       --보험총금액
                           </if>
                           <if test='sIncStartDt != null '>
                           AND INC_START_DT  <![CDATA[>=]]> #{sIncStartDt}      --보험시작일자
                           </if>
                           <if test='sIncEndDt != null '>
                           AND INC_END_DT    <![CDATA[<=]]> #{sIncEndDt}+1      --보험종료일자
                           </if>
                           <if test='sCmcIncTp != null and sCmcIncTp != ""'>
                           AND CMC_INC_TP     = #{sCmcIncTp}                    --상업보험유형
                           </if>
                           <if test='sCmcIncNm != null and sCmcIncNm != ""'>
                             AND CMC_INC_NM  =  #{sCmcIncNm}      --상업보험명
                           </if>
                         ORDER BY
                         <choose>
                             <when test='sort != null'>
                                 <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                                     <choose>
                                         <when test='item.field == "dlrCd"'>         DLR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                         <when test='item.field == "vinNo"'>         VIN_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                         <when test='item.field == "incDocNo"'>      INC_DOC_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                         <when test='item.field == "carRegNo"'>      CAR_REG_NO <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                         <when test='item.field == "incCmpCd"'>      INC_CMP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                         <when test='item.field == "incCmpShtCd"'>   INC_CMP_SHT_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                         <when test='item.field == "rincPrsnId"'>    RINC_PRSN_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                                         <when test='item.field == "incDstinCd"'>    INC_DSTIN_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                                         <when test='item.field == "incTotAmt"'>     INC_TOT_AMT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>   </when>
                                         <when test='item.field == "incStartDt"'>    INC_START_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>  </when>
                                         <when test='item.field == "incEndDt"'>      INC_END_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                         <when test='item.field == "cmcIncCd"'>      CMC_INC_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                         <when test='item.field == "cmcIncTp"'>      CMC_INC_TP <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                         <when test='item.field == "cmcIncNm"'>      CMC_INC_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                         <when test='item.field == "cmcIncRemark"'>  CMC_INC_REMARK <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                         <when test='item.field == "regUsrId"'>      REG_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>    </when>
                                         <when test='item.field == "regDt"'>         REG_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>        </when>
                                         <when test='item.field == "updtUsrId"'>     UPDT_USR_ID <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>   </when>
                                         <when test='item.field == "updtDt"'>        UPDT_DT <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose>       </when>
                                         <otherwise>
                                           DLR_CD ASC ,VIN_NO ASC ,INC_DOC_NO ASC
                                         </otherwise>
                                     </choose>
                                 </foreach>
                             </when>
                             <otherwise>
                               DLR_CD ASC,VIN_NO ASC ,INC_DOC_NO ASC
                             </otherwise>
                         </choose>
                    )A LEFT OUTER JOIN SE_1019T B
                     ON A.DLR_CD     = B.DLR_CD
                    AND A.INC_DOC_NO = B.INC_DOC_NO
                 )T1
                 <where>
                      <if test='firstIndex != -1 and lastIndex != -1'>
                       AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                      </if>
                 </where>
         )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>

    </select>
    
    <!-- 보험관리 팝업 리스트 갯수 -->
    <select id="selectInsuManagesByConditionCnt" parameterType="InsuranceManageSearchVO" resultType="int">
        /* [chn.bhmc.dms.ser.ins.service.dao.InsRegManageDAO.selectInsuManagesByConditionCnt] */

            SELECT  COUNT(INC_CMP_CD) AS VALUE
             FROM SE_1016T
             WHERE DLR_CD = #{sDlrCd}
             <if test='sIncCmpNm !=null and sIncCmpNm != "" '>
              AND INC_CMP_NM LIKE '%'||#{sIncCmpNm}||'%'
             </if>
             <if test='sIncUsrNm !=null and sIncUsrNm != "" '>
              AND INC_USR_NM LIKE '%'||#{sIncUsrNm}||'%'
             </if>
            
        
    </select>
    
        <!-- 보험관리 팝업 리스트 -->
        <select id="selectInsuManagesByCondition" parameterType="InsuranceManageSearchVO" resultType="InsuranceManageVO">
            /* [chn.bhmc.dms.ser.ins.service.dao.InsRegManageDAO.selectInsuManagesByCondition] */
    
          SELECT * FROM (
            SELECT ROWNUM AS RNUM , T1.*
              FROM (
                SELECT  DLR_CD,INC_CMP_CD,INC_CMP_NM,INC_CMP_TEL_NO,INC_DEPT_NM
                       ,INC_USR_NM,INC_RESP_TEL_NO,INC_RESP_HP_NO,REG_USR_ID
                       ,REG_DT,UPDT_USR_ID,UPDT_DT
                 FROM SE_1016T
                 WHERE DLR_CD = #{sDlrCd}
                 <if test='sIncCmpNm !=null and sIncCmpNm != "" '>
                  AND INC_CMP_NM LIKE '%'||#{sIncCmpNm}||'%'
                 </if>
                 <if test='sIncUsrNm !=null and sIncUsrNm != "" '>
                  AND INC_USR_NM LIKE '%'||#{sIncUsrNm}||'%'
                 </if>
                ORDER BY
                 <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "incCmpCd" '>INC_CMP_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                <when test='item.field == "incCmpNm" '>INC_CMP_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose> </when>
                                <otherwise>
                                    INC_CMP_CD ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        INC_CMP_CD ASC
                    </otherwise>
                 </choose>
                ) T1
                <where>
                    <if test='firstIndex != -1 and lastIndex != -1'>
                        ROWNUM <![CDATA[<=]]> #{lastIndex}
                    </if>
                </where>
             )
             <where>
                <if test='firstIndex != -1 and lastIndex != -1'>
                    RNUM > #{firstIndex}
                </if>
            </where>
        </select>
        


</mapper>