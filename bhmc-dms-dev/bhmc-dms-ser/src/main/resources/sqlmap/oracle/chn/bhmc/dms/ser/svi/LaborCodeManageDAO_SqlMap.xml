<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : LaborCodeManageDAO_SqlMap.xml
    Description : 공임관리 에 관한 데이터처리
    author Kwon Ki Hyun
    since 2016. 01. 14.
    version 1.0
    Modification Information
       since          author              description
    ===========    =============    ===========================
    2016. 01. 14.  Kwon Ki Hyun     최초 생성
-->

<mapper namespace="chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO">

    <!-- 공임코드 마스터 데이터를 입력 -->
    <insert id="insertLaborMaster" parameterType="LaborCodeMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.insertLaborMaster] */

             INSERT INTO SE_1060T    --LABOR LTS마스터
                (
                  DSTIN_CD           --구분코드
                 ,DLR_CD             --딜러코드
                 ,LBR_CD             --공임코드
                 ,LBR_EN_NM          --공임영문명
                 ,LBR_CHN_NM         --공임중문명
                 ,LBR_QTY            --공임수량
                 ,REG_USR_ID         --등록자ID
                 ,REG_DT             --등록일자
                 ,BRAND_CD           --브랜드코드
                 ,LBR_TP             --공임유형
                 ,LBR_CD_TP          --공임코드유형
                 ,REMARK             --공임비고
                )
                VALUES
                (
                  #{dstinCd}           --구분코드
                 ,#{dlrCd}             --딜러코드
                 ,#{lbrCd}             --공임코드
                 ,#{lbrEnNm}           --공임영문명
                 ,#{lbrChnNm}          --공임중문명
                 ,#{lbrQty}            --공임수량
                 ,#{regUsrId}          --등록자ID
                 ,SYSDATE              --등록일자
                 ,#{brandCd}           --브랜드코드
                 ,#{lbrTp}             --공임유형
                 ,#{lbrCdTp}           --공임코드유형
                 ,#{remark}            --공임비고
                )



    </insert>

    <!-- 공임코드 디테일 상세 데이터를 입력 -->
    <insert id="insertLaborCodeDetail" parameterType="LaborCodeDetailVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.insertLaborCodeDetail] */


             INSERT INTO SE_1061T    --LABOR HOUR
                (
                  DSTIN_CD              --구분코드
                 ,DLR_CD                --딜러코드
                 ,LBR_CD                --공임코드
                 ,LTS_MODEL_CD          --LTS모델코드
                 ,VALID_START_DT        --유효시작일자
                 ,VALID_END_DT          --유효종료일자
                 ,LBR_HM                --공임시간
                 ,DEL_YN                --삭제여부
                 ,REG_USR_ID            --등록자ID
                 ,REG_DT                --등록일자
                 ,BRAND_CD              --브랜드코드
                 ,ALLOC_LBR_HM          --배정공임시간
                 ,LBR_CNT               --공임수
                 ,DIFF_VAL              --난이도값
                 ,SER_CNT               --정비건수
                 ,PAY_LBR_HM            --지불공임시간
                )
                VALUES
                (
                  #{dstinCd}              --구분코드
                 ,#{dlrCd}                --딜러코드
                 ,#{lbrCd}                --공임코드
                 ,#{ltsModelCd}           --LTS모델코드
                 ,#{validStartDt}         --유효시작일자
                 ,#{validEndDt}           --유효종료일자
                 ,#{lbrHm}                --공임시간
                 ,#{delYn}                --삭제여부
                 ,#{regUsrId}             --등록자ID
                 ,SYSDATE                --등록일자
                 ,#{brandCd}              --브랜드코드
                 ,#{allocLbrHm}           --배정공임시간
                 ,#{lbrCnt}               --공임수
                 ,#{diffVal}              --난이도값
                 ,#{serCnt}               --정비건수
                 ,#{payLbrHm}             --지불공임시간
                )

    </insert>

    <delete id="deleteLaborCodeDetailExcelTemp" parameterType="LaborCodeDetailVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.deleteLaborCodeDetailExcelTemp] */

        DELETE FROM SE_1061T_TMP
         WHERE (DLR_CD = #{dlrCd} OR DLR_CD ='A07AA')
    </delete>

    <!-- 공임코드 디테일 상세 데이터를 입력 -->
    <insert id="insertLaborCodeDetailExcelTemp" parameterType="LaborCodeDetailVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.insertLaborCodeDetailExcelTemp] */


            INSERT INTO SE_1061T_TMP (
                 DSTIN_CD              --구분코드
                ,DLR_CD                --딜러코드
                ,LBR_CD                --공임코드
                ,LTS_MODEL_CD          --LTS모델코드
                ,VALID_START_DT        --유효시작일자
                ,VALID_END_DT          --유효종료일자
                ,LBR_HM                --공임시간
                ,BRAND_CD              --브랜드코드
                ,ALLOC_LBR_HM          --배정공임시간
                ,SER_CNT               --정비건수
                ,PAY_LBR_HM            --지불공임시간
            )VALUES(
                  #{dstinCd}              --구분코드
                 ,#{dlrCd}                --딜러코드
                 ,#{lbrCd}                --공임코드
                 ,#{ltsModelCd}           --LTS모델코드
                 ,#{validStartDt}         --유효시작일자
                 ,#{validEndDt}           --유효종료일자
                 ,#{lbrHm}                --공임시간
                 ,#{brandCd}              --브랜드코드
                 ,#{allocLbrHm}           --배정공임시간
                 ,#{serCnt}               --정비건수
                 ,#{payLbrHm}             --지불공임시간
            )

    </insert>

    <!-- 공임코드 디테일 상세 데이터를 입력 -->
    <insert id="insertLaborCodeDetailExcel" parameterType="LaborCodeDetailVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.insertLaborCodeDetailExcel] */

            MERGE INTO SE_1061T A
             USING(
                SELECT *
                  FROM (
                       SELECT B.DSTIN_CD              --구분코드
                             ,B.DLR_CD                --딜러코드
                             ,B.LBR_CD                --공임코드
                             ,B.LTS_MODEL_CD          --LTS모델코드
                             ,B.VALID_START_DT        --유효시작일자
                             ,B.VALID_END_DT          --유효종료일자
                             ,B.LBR_HM                --공임시간
                             ,B.BRAND_CD              --브랜드코드
                             ,B.ALLOC_LBR_HM          --배정공임시간
                             ,B.SER_CNT               --정비건수
                             ,B.PAY_LBR_HM            --지불공임시간
                             ,#{regUsrId}  AS REG_USR_ID
                             ,SYSDATE AS REG_DT
                             ,ROW_NUMBER() OVER(PARTITION BY B.DSTIN_CD,B.DLR_CD ,B.LBR_CD ,B.LTS_MODEL_CD ORDER BY B.LBR_CD) AS RN
                       FROM SE_1060T A , SE_1061T_TMP B
                      WHERE A.DSTIN_CD = B.DSTIN_CD
                        AND A.DLR_CD   = B.DLR_CD
                        AND A.LBR_CD   = B.LBR_CD
                 )WHERE RN = 1
             )B
             ON(
                    A.DSTIN_CD      = B.DSTIN_CD
                AND A.DLR_CD        = B.DLR_CD
                AND A.LBR_CD        = B.LBR_CD
                AND A.LTS_MODEL_CD  = B.LTS_MODEL_CD
             )
            WHEN MATCHED THEN UPDATE SET
                 A.VALID_START_DT  = CASE WHEN B.DSTIN_CD = 'H' OR B.DSTIN_CD = 'E' THEN  A.VALID_START_DT ELSE  B.VALID_START_DT END --유효시작일자
                ,A.VALID_END_DT    = CASE WHEN B.DSTIN_CD = 'H' OR B.DSTIN_CD = 'E' THEN  A.VALID_END_DT   ELSE  B.VALID_END_DT END      --유효종료일자
                ,A.LBR_HM          = CASE WHEN B.DSTIN_CD = 'H' OR B.DSTIN_CD = 'E' THEN  A.LBR_HM         ELSE  B.LBR_HM END                 --공임시간
                ,A.ALLOC_LBR_HM    = B.ALLOC_LBR_HM    --배정공임시간
                ,A.SER_CNT         = B.SER_CNT         --정비건수
                ,A.PAY_LBR_HM      = B.PAY_LBR_HM      --지불공임시간
            WHEN NOT MATCHED THEN
                INSERT
                (
                     A.DSTIN_CD              --구분코드
                    ,A.DLR_CD                --딜러코드
                    ,A.LBR_CD                --공임코드
                    ,A.LTS_MODEL_CD          --LTS모델코드
                    ,A.VALID_START_DT        --유효시작일자
                    ,A.VALID_END_DT          --유효종료일자
                    ,A.LBR_HM                --공임시간
                    ,A.BRAND_CD              --브랜드코드
                    ,A.ALLOC_LBR_HM          --배정공임시간
                    ,A.SER_CNT               --정비건수
                    ,A.PAY_LBR_HM            --지불공임시간
                    ,A.REG_USR_ID            --등록자ID
                    ,A.REG_DT                --등록일자
                )VALUES(
                     B.DSTIN_CD              --구분코드
                    ,B.DLR_CD                --딜러코드
                    ,B.LBR_CD                --공임코드
                    ,B.LTS_MODEL_CD          --LTS모델코드
                    ,B.VALID_START_DT        --유효시작일자
                    ,B.VALID_END_DT          --유효종료일자
                    ,B.LBR_HM                --공임시간
                    ,B.BRAND_CD              --브랜드코드
                    ,B.ALLOC_LBR_HM          --배정공임시간
                    ,B.SER_CNT               --정비건수
                    ,B.PAY_LBR_HM            --지불공임시간
                    ,B.REG_USR_ID            --등록자ID
                    ,B.REG_DT                --등록일자
                )
    </insert>

    <!-- 보증수리 공임 전체 이관 -->
    <insert id="insertWartLaborCodeDetail" parameterType="LaborCodeMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.insertWartLaborCodeDetail] */

            INSERT INTO SE_1060T(
            DSTIN_CD , DLR_CD , LBR_CD , LBR_EN_NM , LBR_CHN_NM, LBR_QTY
             ,REG_DT , REG_USR_ID , UPDT_USR_ID , UPDT_DT , BRAND_CD
            )
             SELECT DSTIN_CD , 'D0101' AS DLR_CD , LBR_CD , LBR_EN_NM , LBR_CHN_NM, LBR_QTY
                   ,SYSDATE , REG_USR_ID , UPDT_USR_ID , SYSDATE , BRAND_CD
               FROM SE_1060T
               WHERE DSTIN_CD ='H'
                  AND (LBR_CD , LBR_EN_NM , LBR_CHN_NM, LBR_QTY)
                  NOT IN (
                  SELECT LBR_CD , LBR_EN_NM , LBR_CHN_NM, LBR_QTY
                    FROM SE_1060T
                   WHERE DSTIN_CD='H'
                     AND DLR_CD = 'D0101'
                  );

    </insert>

    <!-- 공임코드디데일 상세 데이터를 수정 -->
    <update id="updateLaborCodeDetail" parameterType="LaborCodeDetailVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.updateLaborCodeDetail] */

            UPDATE SE_1061T                                 --LABOR HOUR
              SET
                   VALID_START_DT = #{validStartDt}         --유효시작일자
                  ,VALID_END_DT   = #{validEndDt}           --유효종료일자
                  ,LBR_HM         = #{lbrHm}                --공임시간
                  ,DEL_YN         = #{delYn}                --삭제여부
                  ,ALLOC_LBR_HM   = #{allocLbrHm}           --배정공임시간
                  ,LBR_CNT        = #{lbrCnt}               --공임수
                  ,DIFF_VAL       = #{diffVal}              --난이도값
                  ,SER_CNT        = #{serCnt}               --정비건수
                  ,PAY_LBR_HM     = #{payLbrHm}             --지불공임시간
                  ,UPDT_USR_ID    = #{updtUsrId}            --수정자ID
                  ,UPDT_DT        = sysdate                 --수정일자
             WHERE 1 = 1
               AND DLR_CD         = #{dlrCd}                --딜러코드
               AND DSTIN_CD       = #{dstinCd}              --구분코드
               AND LBR_CD         = #{lbrCd}                --공임코드
               AND LTS_MODEL_CD   = #{ltsModelCd}           --LTS모델코드



    </update>

    <!-- 공임코드마스터  데이터를 수정 -->
    <update id="updateLaborMaster" parameterType="LaborCodeDetailVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.updateLaborMaster] */

        UPDATE SE_1060T    --LABOR LTS마스터
          SET
               LBR_EN_NM   = #{lbrEnNm}           --공임영문명
              ,LBR_CHN_NM  = #{lbrChnNm}          --공임중문명
              ,LBR_QTY     = #{lbrQty}            --공임수량
              ,LBR_TP      = #{lbrTp}             --공임유형
              <if test=' lbrCdTp != null and lbrCdTp != "" ' >
              ,LBR_CD_TP  = #{lbrCdTp}            --공임코드유형
              </if>
              <if test=' remark != null and remark != "" ' >
              ,REMARK      = #{remark}            --공임비고
              </if>
              ,UPDT_USR_ID = #{updtUsrId}         --수정자ID
              ,UPDT_DT     = sysdate              --수정일자
         WHERE 1 = 1
           AND DSTIN_CD    = #{dstinCd}           --구분코드
           AND DLR_CD      = #{dlrCd}             --딜러코드
           AND LBR_CD      = #{lbrCd}             --공임코드

    </update>

    <!-- 공임코드상세  데이터를 삭제 -->
    <delete id="deleteLaborDetail" parameterType="LaborCodeDetailVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.deleteLaborDetail] */

        DELETE FROM SE_1061T
         WHERE DSTIN_CD       = #{dstinCd}
           AND DLR_CD         = #{dlrCd}
           AND LBR_CD         = #{lbrCd}
           <if test='ltsModelCd != null and ltsModelCd != "" '>
           AND LTS_MODEL_CD   = #{ltsModelCd}           --LTS모델코드
           </if>
    </delete>

    <!-- 공임코드마스터  데이터를 삭제 -->
    <delete id="deleteLabor" parameterType="LaborCodeMasterVO">
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.deleteLabor] */

        DELETE FROM SE_1060T
         WHERE DSTIN_CD       = #{dstinCd}
           AND DLR_CD         = #{dlrCd}
           AND LBR_CD         = #{lbrCd}

    </delete>

    <!-- 공임관리 목록 조회  -->
    <select id="selectLaborCodeManages" parameterType="LaborCodeSearchVO" resultType="LaborCodeMasterVO" >
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.selectLaborCodeManages] */

        SELECT *
          FROM (
              SELECT ROWNUM AS RNUM ,T1.*
                FROM (
                SELECT DSTIN_CD
                      ,DLR_CD
                      ,LBR_CD
                      ,LBR_TP
                      ,LBR_EN_NM
                      ,LBR_CHN_NM
                      ,BRAND_CD
                      ,LBR_CD_TP
                      ,REMARK
                  FROM SE_1060T A
                 WHERE DSTIN_CD = #{sDstinCd}
                   <if test='sBrandCd!=null and sBrandCd !="" '>
                   AND BRAND_CD = #{sBrandCd}
                   </if>
                   <if test='sDstinCd !=null and sDstinCd !="" '>
                      <choose>
                        <when test='sDstinCd == "H" or sDstinCd == "E" or sDstinCd == "G" '>
                   AND DLR_CD   = 'A07AA'
                        </when>
                        <otherwise>
                   AND (A.DLR_CD   = #{sDlrCd} OR A.DLR_CD ='A07AA')
                         </otherwise>
                      </choose>
                 </if>
                 <if test='sLbrCd != null and sLbrCd != "" '>
                   AND LBR_CD   LIKE '%' || #{sLbrCd} || '%'
                </if>
                <if test='sLbrTp != null and sLbrTp != "" '>
                   AND LBR_TP   = #{sLbrTp}
                </if>
                <if test='sLbrCdTp != null and sLbrCdTp != "" '>
                   AND LBR_CD_TP   = #{sLbrCdTp}
                </if>
                <if test='sLbrNm !=null and sLbrNm !="" '>
                    <choose>
                        <when test='sLangCd == "ko" '>
                   AND LBR_EN_NM LIKE '%' || #{sLbrNm} || '%'
                        </when>
                        <when test='sLangCd == "zh" '>
                   AND LBR_CHN_NM LIKE '%' || #{sLbrNm} || '%'
                        </when>
                    </choose>
              </if>
                 ORDER BY
                 <choose>
                    <when test='sort != null'>
                        <foreach item="item" index="index" collection="sort" open="" separator="," close="">
                            <choose>
                                <when test='item.field == "lbrCd"'>LBR_CD <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "lbrEnNm"'>LBR_EN_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <when test='item.field == "lbrChnNm"'>LBR_CHN_NM <choose><when test='item.dir == "asc"'>ASC</when><otherwise>DESC</otherwise></choose></when>
                                <otherwise>
                                    LBR_CD ASC
                                </otherwise>
                            </choose>
                        </foreach>
                    </when>
                    <otherwise>
                        LBR_CD ASC
                    </otherwise>
                </choose>
              ) T1
              <where>
                  <if test='firstIndex != -1 and lastIndex != -1'>
                   AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                  </if>
             </where>
             )
        <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>

    </select>

    <!-- 공임코드  데이터 목록수를 조회  -->
    <select id="selectLaborCodeManageByConditionCnt" parameterType="LaborCodeSearchVO" resultType="int" >
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.selectLaborCodeManageByConditionCnt] */


                SELECT COUNT(LBR_CD) AS VALUE
                  FROM SE_1060T A
                 WHERE DSTIN_CD = #{sDstinCd}
                 <if test='sBrandCd!=null and sBrandCd !="" '>
                   AND BRAND_CD = #{sBrandCd}
                 </if>
                 <if test='sDstinCd !=null and sDstinCd !="" '>
                 <choose>
                    <when test='sDstinCd == "H" or sDstinCd == "E" or sDstinCd == "G" '>
                   AND DLR_CD   = 'A07AA'
                    </when>
                    <otherwise>
                   AND (A.DLR_CD   = #{sDlrCd} OR A.DLR_CD ='A07AA')
                    </otherwise>
                 </choose>
                 </if>
                 <if test='sLbrCd != null and sLbrCd != "" '>
                   AND LBR_CD   LIKE '%' || #{sLbrCd} || '%'
                 </if>
                 <if test='sLbrTp != null and sLbrTp != "" '>
                   AND LBR_TP   = #{sLbrTp}
                 </if>
                 <if test='sLbrCdTp != null and sLbrCdTp != "" '>
                   AND LBR_CD_TP   = #{sLbrCdTp}
                 </if>
                 <if test='sLbrNm !=null and sLbrNm !="" '>
                    <choose>
                        <when test='sLangCd == "ko" '>
                   AND LBR_EN_NM LIKE '%' || #{sLbrNm} || '%'
                        </when>
                        <when test='sLangCd == "zh" '>
                   AND LBR_CHN_NM LIKE '%' || #{sLbrNm} || '%'
                        </when>
                    </choose>
                 </if>

    </select>

    <!-- 공임코드 상세 데이터를 조회  -->
    <select id="selectLaborCodeManageByCondition"   parameterType="LaborCodeSearchVO" resultType="LaborCodeDetailVO" >
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.selectLaborCodeManageByCondition] */

          SELECT ROWNUM AS RNUM ,T1.*
            FROM (
                SELECT A.DSTIN_CD
                      ,A.LBR_CD
                      ,A.DLR_CD
                      ,B.LTS_MODEL_CD
                      ,(SELECT
                       <choose>
                            <when test='sLangCd == "zh"'> LTS_CHN_NM </when>
                            <otherwise>LTS_EN_NM</otherwise>
                        </choose>
                           FROM SE_1064T
                          WHERE LTS_MODEL_CD = B.LTS_MODEL_CD
                            AND ROWNUM = 1) AS LTS_MODEL_NM
                      ,B.LBR_HM
                      ,B.VALID_START_DT
                      ,B.VALID_END_DT
                      ,B.DEL_YN
                      ,A.BRAND_CD
                      ,B.ALLOC_LBR_HM
                      ,B.PAY_LBR_HM            --지불공임시간
                      ,NVL(B.LBR_CNT , 1 ) AS LBR_CNT
                      ,B.DIFF_VAL
                      ,NVL(B.SER_CNT, 1 ) AS SER_CNT
                      ,A.LBR_CD_TP
                      ,A.REMARK
                  FROM SE_1060T A , SE_1061T B
                 WHERE A.DSTIN_CD = B.DSTIN_CD
                   AND A.LBR_CD   = B.LBR_CD
                   AND A.DLR_CD   = B.DLR_CD
                   <if test='sDstinCd !=null and sDstinCd !="" '>
                      <choose>
                        <when test='sDstinCd == "H" or sDstinCd == "E" or sDstinCd == "G" '>
                   AND A.DLR_CD   = 'A07AA'
                        </when>
                        <otherwise>
                   AND (A.DLR_CD   = #{sDlrCd} OR A.DLR_CD ='A07AA')
                         </otherwise>
                      </choose>
                   </if>
                 <if test='sDstinCd != null and sDstinCd != "" '>
                   AND A.DSTIN_CD = #{sDstinCd}
                 </if>
                 <if test='sLbrCd != null and sLbrCd != "" '>
                   AND A.LBR_CD   = #{sLbrCd}
                 </if>
                 <if test='sLbrTp != null and sLbrTp != "" '>
                   AND A.LBR_TP   = #{sLbrTp}
                </if>
                 <if test='sBrandCd!=null and sBrandCd !="" '>
                   AND A.BRAND_CD = #{sBrandCd}
                 </if>
                 ORDER BY LTS_MODEL_CD
             )T1

    </select>

    <!-- 공임코드 상세 데이터 엑셀 다운   -->
    <select id="selectLaborCodeManageExcelByCondition"   parameterType="LaborCodeSearchVO" resultType="LaborCodeDetailVO" >
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.selectLaborCodeManageExcelByCondition] */

          SELECT ROWNUM AS RNUM ,T2.*
            FROM (
                SELECT T1.* FROM (
                    SELECT A.DSTIN_CD
                          ,(SELECT CMM_CD_TXT
                              FROM CM_0304T
                             WHERE LANG_CD    = NVL( #{sLangCd} ,'zh')
                               AND CMM_GRP_CD = 'SER950'
                               AND CMM_CD     = A.DSTIN_CD ) AS DSTIN_CD_NM
                          ,A.LBR_CD
                          ,A.LBR_CHN_NM AS LBR_NM
                          ,(SELECT CMM_CD_TXT
                              FROM CM_0304T
                             WHERE LANG_CD    = NVL( #{sLangCd} ,'zh')
                               AND CMM_GRP_CD = 'SER036'
                               AND CMM_CD     = A.LBR_TP ) AS LBR_TP_NM
                          ,A.DLR_CD
                          ,B.LTS_MODEL_CD
                          ,B.LBR_HM
                          ,B.VALID_START_DT
                          ,B.VALID_END_DT
                          ,B.DEL_YN
                          ,A.BRAND_CD
                          ,B.ALLOC_LBR_HM
                          ,B.PAY_LBR_HM            --지불공임시간
                          ,NVL(B.LBR_CNT , 1 ) AS LBR_CNT
                          ,B.DIFF_VAL
                          ,NVL(B.SER_CNT, 1 ) AS SER_CNT
                      FROM SE_1060T A LEFT OUTER JOIN SE_1061T B
                        ON A.DSTIN_CD = B.DSTIN_CD
                       AND A.LBR_CD   = B.LBR_CD
                       AND A.DLR_CD   = B.DLR_CD
                       <where>
                           <if test='sDstinCd !=null and sDstinCd !="" '>
                              <choose>
                                <when test='sDstinCd == "H" or sDstinCd == "E" '>
                           AND A.DLR_CD   = 'A07AA'
                                </when>
                                <otherwise>
                           AND (A.DLR_CD   = #{sDlrCd} OR A.DLR_CD ='A07AA')
                                 </otherwise>
                              </choose>
                           </if>
                         <if test='sDstinCd != null and sDstinCd != "" '>
                           AND A.DSTIN_CD = #{sDstinCd}
                         </if>
                         <if test='sLbrCd != null and sLbrCd != "" '>
                           AND A.LBR_CD   LIKE '%'|| #{sLbrCd}||'%'
                         </if>
                         <if test='sLbrTp != null and sLbrTp != "" '>
                           AND A.LBR_TP   = #{sLbrTp}
                        </if>
                         <if test='sBrandCd!=null and sBrandCd !="" '>
                           AND A.BRAND_CD = #{sBrandCd}
                         </if>
                     </where>
                 )T1
                 <where>
                    <if test='sLbrNm !=null and sLbrNm !="" '>
                        AND T1.LBR_NM LIKE '%' || #{sLbrNm} || '%'
                    </if>
                 </where>
                 ORDER BY T1.LBR_CD , T1.LTS_MODEL_CD
             )T2

    </select>

    <!-- 엑셀 업로드 전 TEMP 테이블의 데이터 정보 목록수 -->
    <select id="selectLaborCodeManageExcelTmpByConditionCnt"   parameterType="LaborCodeSearchVO" resultType="int" >
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.selectLaborCodeManageExcelTmpByConditionCnt] */

                SELECT COUNT(LBR_CD) AS VALUE
                  FROM SE_1061T_TMP
                 WHERE (DLR_CD   = #{sDlrCd} OR DLR_CD ='A07AA')
    </select>

    <!-- 엑셀 업로드 전 TEMP 테이블의 데이터 정보 -->
    <select id="selectLaborCodeManageExcelTmpByCondition"   parameterType="LaborCodeSearchVO" resultType="LaborCodeDetailVO" >
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.selectLaborCodeManageExcelTmpByCondition] */

          SELECT ROWNUM AS RNUM ,T1.*
            FROM (
                SELECT DSTIN_CD
                      ,(
                         SELECT CMM_CD_TXT
                           FROM CM_0304T
                          WHERE CMM_GRP_CD = 'SER950'
                            AND LANG_CD    = #{sLangCd}
                            AND CMM_CD     = A.DSTIN_CD
                        ) AS DSTIN_NM
                      ,LBR_CD
                      ,DLR_CD
                      ,LTS_MODEL_CD
                      ,FN_SER_LTS_MODEL_NM(LTS_MODEL_CD, #{sLangCd}) AS LTS_MODEL_NM
                      ,LBR_HM
                      ,VALID_START_DT
                      ,VALID_END_DT
                      ,BRAND_CD
                      ,ALLOC_LBR_HM
                      ,PAY_LBR_HM            --지불공임시간
                      ,NVL(SER_CNT, 1 ) AS SER_CNT
                  FROM SE_1061T_TMP A
                 WHERE (DLR_CD   = #{sDlrCd} OR DLR_CD ='A07AA')
                 ORDER BY DSTIN_CD, LBR_CD , LTS_MODEL_CD
             )T1

    </select>

    <!-- 공임코드 마스터 데이터갯수 조회  -->
    <select id="selectLaborMasterByConditionCnt"  parameterType="LaborCodeMasterVO" resultType="int" >
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.selectLaborMasterByConditionCnt] */

         SELECT COUNT(LBR_CD) AS VALUE
           FROM SE_1060T
          WHERE DSTIN_CD  = #{dstinCd}
          <if test='dstinCd !=null and dstinCd !="" '>
              <choose>
                <when test='dstinCd == "H" or dstinCd == "E" or dstinCd == "G" '>
           AND DLR_CD   = 'A07AA'
                </when>
                <otherwise>
           AND DLR_CD   = #{dlrCd}
                 </otherwise>
              </choose>
           </if>
            AND LBR_CD    = #{lbrCd}
           <if test='brandCd !=null and brandCd !="" '>
            AND BRAND_CD   = #{brandCd}
           </if>
           <if test='lbrCdTp != null and lbrCdTp != "" '>
           AND LBR_CD_TP   = #{lbrCdTp}
           </if>
    </select>

    <!-- 공임코드 자체정의 데이터갯수 조회  -->
    <select id="selectLaborMasterByDstinCdCnt"  parameterType="LaborCodeMasterVO" resultType="int" >
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.selectLaborMasterByDstinCdCnt] */
         SELECT COUNT(LBR_CD) AS VALUE
           FROM SE_1060T
          WHERE DLR_CD   = #{dlrCd}
            AND DSTIN_CD = #{dstinCd}
    </select>

    <!-- 공임코드 사용 이력  조회  -->
    <select id="selectUsedLaborByConditionCnt"  parameterType="LaborCodeMasterVO" resultType="int" >
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.selectUsedLaborByConditionCnt] */

         SELECT COUNT(LBR_CD) AS VALUE
           FROM SE_0170T
          WHERE DSTIN_CD  = #{dstinCd}
            AND DLR_CD    = #{dlrCd}
            AND LBR_CD    = #{lbrCd}

    </select>

    <!-- 공임코드 팝업 데이터갯수 조회  -->
    <select id="selectLaborCodePopUpByConditionCnt"  parameterType="LaborCodeSearchVO" resultType="int" >
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.selectLaborCodePopUpByConditionCnt] */

              SELECT COUNT(LBR_CD) AS VALUE
                  FROM (
                    SELECT DSTIN_CD
                          ,DLR_CD
                          ,LBR_CD
                          ,LBR_NM
                          ,LBR_TP
                          ,LBR_CD_TP
                          ,REMARK
                          ,ROW_NUMBER() OVER(PARTITION BY DSTIN_CD, DLR_CD, LBR_CD ORDER BY DECODE(LTS_MODEL_CD, 'ALL', 1, 0) , LBR_CD) AS RN
                      FROM (
                      SELECT A.DSTIN_CD             -- 구분코드
                            ,A.DLR_CD               --딜러코드
                            ,A.LBR_CD               --공임코드
                            <choose>
                               <when test='sLangCd == "ko"' >, A.LBR_EN_NM AS LBR_NM </when>
                               <otherwise> , A.LBR_CHN_NM AS LBR_NM</otherwise>
                            </choose>
                            ,A.LBR_TP
                            ,A.LBR_CD_TP
                            ,A.REMARK
                            ,B.LTS_MODEL_CD
                        FROM SE_1060T A , SE_1061T B , SE_1065T C
                       WHERE A.DSTIN_CD = B.DSTIN_CD
                         AND A.LBR_CD   = B.LBR_CD
                         AND A.DLR_CD   = B.DLR_CD
                         AND TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'),'YYYYMMDD') BETWEEN B.VALID_START_DT AND B.VALID_END_DT
                         AND B.DEL_YN = 'N'
                         AND C.DLR_CD = #{sDlrCd}
                         AND RPIR_TP  = '01'
                         <choose>
                            <when test=' sDstinCd != null and sDstinCd != "" '>
                                <if test='sDstinCd == "H" or sDstinCd == "E" or sDstinCd == "G" '>
                         AND A.DLR_CD   = 'A07AA'
                                </if>
                                <if test=' sDstinCd == "D" or sDstinCd == "Z" '>
                         AND (A.DLR_CD   = #{sDlrCd} OR A.DLR_CD ='A07AA')
                                </if>
                            </when>
                            <otherwise>
                         AND ( A.DLR_CD ='A07AA' OR A.DLR_CD = #{sDlrCd}  )
                         AND ( A.DSTIN_CD = 'D' OR A.DSTIN_CD = 'E' OR A.DSTIN_CD = 'H' )
                            </otherwise>
                         </choose>
                         <if test=' sLtsModelCd != "ALL" ' >
                         AND (B.LTS_MODEL_CD = #{sLtsModelCd} OR B.LTS_MODEL_CD ='ALL' )
                         </if>
                         <if test='sDstinCd != null and sDstinCd != "" '>
                         AND A.DSTIN_CD = #{sDstinCd}
                         </if>
                         <if test='sLbrCd != null and sLbrCd != "" '>
                         AND A.LBR_CD   LIKE '%'|| #{sLbrCd}||'%'
                         </if>
                         <if test='sLbrTp != null and sLbrTp != "" '>
                         AND (A.LBR_TP   = #{sLbrTp}  OR A.LBR_TP IS NULL )
                        </if>
                        <if test='sLbrCdTp != null and sLbrCdTp != "" '>
                         AND A.LBR_CD_TP   = #{sLbrCdTp}
                        </if>
                         <if test='sLbrNm != null and sLbrNm != "" '>
                             <choose>
                               <when test='sLangCd == "ko"' >
                         AND A.LBR_EN_NM LIKE '%'|| #{sLbrNm} ||'%'
                               </when>
                               <otherwise>
                         AND A.LBR_CHN_NM LIKE '%'|| #{sLbrNm} ||'%'
                               </otherwise>
                             </choose>
                         </if>
                         <if test='sBrandCd != null and sBrandCd != ""'>
                         AND A.BRAND_CD = #{sBrandCd}
                         </if>
                     )
                     <where>
                     <if test='sLbrCd != null and sLbrCd != "" '>
                         AND LBR_CD   LIKE '%'|| #{sLbrCd}||'%'
                     </if>
                     <if test='sLbrTp != null and sLbrTp != "" '>
                         AND (LBR_TP   = #{sLbrTp}  OR LBR_TP IS NULL  )
                    </if>
                     <if test='sLbrNm != null and sLbrNm != "" '>
                         AND LBR_NM LIKE '%'|| #{sLbrNm} ||'%'
                     </if>
                     </where>
                     ORDER BY LBR_CD
                 )T1 WHERE RN = 1


    </select>

    <!-- 공임코드 팝업 데이터 조회  -->
    <select id="selectLaborCodePopUpByCondition"  parameterType="LaborCodeSearchVO" resultType="LaborCodeDetailVO" >
        /* [chn.bhmc.dms.ser.svi.service.dao.LaborCodeManageDAO.selectLaborCodePopUpByCondition] */

             SELECT * FROM (
                SELECT ROWNUM AS RNUM , T1.*
                  FROM (
                    SELECT DSTIN_CD
                          ,DLR_CD
                          ,LBR_CD
                          ,LBR_TP
                          ,LBR_NM
                          ,LBR_QTY
                          ,LBR_HM
                          ,VALID_START_DT
                          ,VALID_END_DT
                          ,BRAND_CD
                          ,ALLOC_LBR_HM
                          ,NVL(PAY_LBR_HM,LBR_HM) AS PAY_LBR_HM
                          ,LBR_CNT
                          ,DIFF_VAL
                          ,SER_CNT
                          ,LBR_RATE
                          ,REL_CAU_LBR_YN
                          ,LBR_CD_TP
                          ,REMARK
                          ,ROW_NUMBER() OVER(PARTITION BY DSTIN_CD, DLR_CD, LBR_CD ORDER BY DECODE(LTS_MODEL_CD, 'ALL', 1, 0) , LBR_CD) AS RN
                      FROM (
                      SELECT A.DSTIN_CD                --구분코드
                            ,A.DLR_CD                  --딜러코드
                            ,A.LBR_CD                  --공임코드
                            ,A.LBR_TP                  --공임유형
                            <choose>
                               <when test='sLangCd == "ko"' >, A.LBR_EN_NM AS LBR_NM </when>
                               <otherwise> , A.LBR_CHN_NM AS LBR_NM</otherwise>
                            </choose>
                            ,NVL(B.LBR_CNT ,1) LBR_QTY --공임수량
                            ,B.LBR_HM                  --공임시간
                            ,B.VALID_START_DT          --유효시작일자
                            ,B.VALID_END_DT            --유효종료일자
                            ,A.BRAND_CD                --브랜드코드
                            ,B.ALLOC_LBR_HM            --배정공임시간
                            ,B.PAY_LBR_HM              --지불공임시간
                            ,B.LBR_CNT                 --공임수
                            ,B.DIFF_VAL                --난이도
                            ,B.SER_CNT                 --정비건수
                            ,B.LTS_MODEL_CD
                            ,A.LBR_CD_TP
                            ,A.REMARK
                            ,CASE WHEN A.DSTIN_CD = 'H' THEN C.WART_RTE_RATE ELSE C.GNL_RTE_RATE END AS LBR_RATE
                            ,(  SELECT 'N'
                                  FROM SE_1140T
                                 WHERE LTS_MODEL_CD = #{sLtsModelCd}
                                   AND TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'),'YYYYMMDD') BETWEEN APPLY_START_DT AND APPLY_END_DT
                                   AND SUB_LBR_CD   = A.LBR_CD
                                   AND ROWNUM = 1
                              ) AS REL_CAU_LBR_YN
                        FROM SE_1060T A , SE_1061T B , SE_1065T C
                       WHERE A.DSTIN_CD = B.DSTIN_CD
                         AND A.LBR_CD   = B.LBR_CD
                         AND A.DLR_CD   = B.DLR_CD
                         AND TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'),'YYYYMMDD') BETWEEN B.VALID_START_DT AND B.VALID_END_DT
                         AND B.DEL_YN = 'N'
                         AND C.DLR_CD = #{sDlrCd}
                         AND C.RPIR_TP  = '01'
                         <choose>
                            <when test=' sDstinCd !=null and sDstinCd != "" '>
                                <if test='sDstinCd == "H" or sDstinCd == "E" or sDstinCd == "G" '>
                         AND A.DLR_CD   = 'A07AA'
                                </if>
                                <if test=' sDstinCd == "D" or sDstinCd == "Z" '>
                         AND (A.DLR_CD   = #{sDlrCd} OR A.DLR_CD ='A07AA')
                                </if>
                            </when>
                            <otherwise>
                         AND ( A.DLR_CD ='A07AA'  OR   A.DLR_CD = #{sDlrCd}  )
                         AND ( A.DSTIN_CD = 'D' OR A.DSTIN_CD = 'E' OR A.DSTIN_CD = 'H' )
                            </otherwise>
                         </choose>
                         <if test=' sLtsModelCd != "ALL" ' >
                         AND (B.LTS_MODEL_CD = #{sLtsModelCd} OR B.LTS_MODEL_CD ='ALL' )
                         </if>
                         <if test='sDstinCd != null and sDstinCd != "" '>
                         AND A.DSTIN_CD = #{sDstinCd}
                         </if>
                         <if test='sLbrCd != null and sLbrCd != "" '>
                         AND A.LBR_CD   LIKE '%'|| #{sLbrCd}||'%'
                         </if>
                         <if test='sLbrTp != null and sLbrTp != "" '>
                         AND (A.LBR_TP   = #{sLbrTp} OR A.LBR_TP IS NULL  )
                         </if>
                         <if test='sLbrCdTp != null and sLbrCdTp != "" '>
                         AND A.LBR_CD_TP   = #{sLbrCdTp}
                        </if>
                         <if test='sLbrNm != null and sLbrNm != "" '>
                             <choose>
                               <when test='sLangCd == "ko"' >
                         AND A.LBR_EN_NM LIKE '%'|| #{sLbrNm} ||'%'
                               </when>
                               <otherwise>
                         AND A.LBR_CHN_NM LIKE '%'|| #{sLbrNm} ||'%'
                               </otherwise>
                             </choose>
                         </if>
                         <if test='sBrandCd != null and sBrandCd != ""'>
                         AND A.BRAND_CD = #{sBrandCd}
                         </if>
                     )
                     <where>
                     <if test='sLbrCd != null and sLbrCd != "" '>
                         AND LBR_CD   LIKE '%'|| #{sLbrCd}||'%'
                     </if>
                     <if test='sLbrTp != null and sLbrTp != "" '>
                         AND (LBR_TP   = #{sLbrTp} OR LBR_TP IS NULL )
                     </if>
                     <if test='sLbrNm != null and sLbrNm != "" '>
                         AND LBR_NM LIKE '%'|| #{sLbrNm} ||'%'
                     </if>
                     </where>
                     ORDER BY LBR_CD
                 )T1 WHERE RN = 1
                  <if test='firstIndex != -1 and lastIndex != -1'>
                     AND ROWNUM <![CDATA[<=]]> #{lastIndex}
                  </if>
           )
         <where>
            <if test='firstIndex != -1 and lastIndex != -1'>
                RNUM > #{firstIndex}
            </if>
        </where>
    </select>


</mapper>